(function(b){var e=neo.core.readyNamespace("neo.webdb.pg_frame.DbMenu");if(!e){return}var a="OK";var d="キャンセル";var c=neo.webdb.pg_frame.DbMenu=new neo.core.Class({classProperties:{CMD_START_DB:"dbsettablesetstatusmod",CMD_STOP_DB:"dbsettablesetstatusmod",CMD_REMOVE_DB_CONF_MSG:"dbsettablesetdelconfmsg",CMD_REMOVE_DB:"dbsettablesetdel",CMD_CONFIGURE_DB:"dbsetmenu",CMD_CONFIGURE_VIEWS:"dbsetviewlist",VAL_START_DB_STATUS:"1",VAL_STOP_DB_STATUS:"0",CLS_ITEM:"db-item",CLS_DISABLED_ITEM:"db-item-disabled",defaultSetting:{}},properties:{setting:null,_targetDbId:null,_getTargetDbId:function(){return this._targetDbId},_setTargetDbId:function(f){return this._targetDbId=f},_getDbTree:function(){return this.setting.page._getDbTree()},_ajaxStart:null,_getAjaxStart:function(){return this._ajaxStart||this._initAjaxStart()},_initAjaxStart:function(){var f={url:neo.webdb.getDbSettingUrl(),getSendData:this.__closure(function(){var h={cmd:c.CMD_START_DB,tid:this._getTargetDbId(),status:c.VAL_START_DB_STATUS};return h}),onsuccess:this.__closure(this.onsuccessStartDb)};var g=new neo.webdb.Ajax(f);g.initialize();return this._ajaxStart=g},_ajaxStop:null,_getAjaxStop:function(){return this._ajaxStop||this._initAjaxStop()},_initAjaxStop:function(){var f={url:neo.webdb.getDbSettingUrl(),getSendData:this.__closure(function(){var h={cmd:c.CMD_STOP_DB,tid:this._getTargetDbId(),status:c.VAL_STOP_DB_STATUS};return h}),onsuccess:this.__closure(this.onsuccessStopDb)};var g=new neo.webdb.Ajax(f);g.initialize();return this._ajaxStop=g},_ajaxRemove:null,_getAjaxRemove:function(){return this._ajaxRemove||this._initAjaxRemove()},_initAjaxRemove:function(){var f={url:neo.webdb.getDbSettingUrl(),getSendData:this.__closure(function(){var h={cmd:c.CMD_REMOVE_DB,tid:this._getTargetDbId()};return h}),onsuccess:this.__closure(this.onsuccessRemoveDb),onerror:this.__closure(this.onerrorRemoveDb)};var g=new neo.webdb.Ajax(f);g.initialize();return this._ajaxRemove=g},_elConfigureDb:null,_getElConfigureDb:function(){return this._elConfigureDb||this._initElConfigureDb()},_initElConfigureDb:function(){var g=this._getElMenu();var f=g.find(".db_menu-configure");return this._elConfigureDb=f},_elConfigureViews:null,_getElConfigureViews:function(){return this._elConfigureViews||this._initElConfigureViews()},_initElConfigureViews:function(){var g=this._getElMenu();var f=g.find(".db_menu-configure_views");return this._elConfigureViews=f},_elStartDb:null,_getElStartDb:function(){return this._elStartDb||this._initElStartDb()},_initElStartDb:function(){var g=this._getElMenu();var f=g.find(".db_menu-start");return this._elStartDb=f},_elStopDb:null,_getElStopDb:function(){return this._elStopDb||this._initElStopDb()},_initElStopDb:function(){var g=this._getElMenu();var f=g.find(".db_menu-stop");return this._elStopDb=f},_elRemoveDb:null,_getElRemoveDb:function(){return this._elRemoveDb||this._initElRemoveDb()},_initElRemoveDb:function(){var g=this._getElMenu();var f=g.find(".db_menu-remove");return this._elRemoveDb=f},_elDbAllItem:null,_getElDbAllItem:function(){return this._elDbAllItem||this._initElDbAllItem()},_initElDbAllItem:function(){var h=c.CLS_ITEM;var g=this._getElList();var f=g.find("."+h);return this._elDbAllItem=f},_getElList:function(){return this.setting.elList},_getElMenu:function(){return this.setting.elMenu},_getElMainFrame:function(){return this.setting.elMainFrame},_elDelConfDialog:null,_getElDelConfDialog:function(){return this._elDelConfDialog||this._initElDelConfDialog()},_initElDelConfDialog:function(){var g=b("#dialog_deldb_conf");var i=g.attr("widthdialog");var h={width:Number(i),buttons:{}};h.buttons[a]=this.__closure(this.removeDb);h.buttons[d]=this.__closure(this.closeDialogDelConf);var f=neo.webdb.getDialog(g,h);return this._elDelConfDialog=f._getElSelfOrg()},isActiveDelTargetDb:false,__constructor:function(f){this.setting=f||{}},initialize:function(){this._initSetting();this._hook()},_initSetting:function(){var f=this._getDefaultSetting();this.setting=b.extend({},f,this.setting)},_getDefaultSetting:function(){return b.extend({},c.defaultSetting)},_hook:function(){var f;f=this._getElMenu();this.__bind(f,"click","Menu");f=this._getElConfigureDb();this.__bind(f,"click","ConfigureDb");f=this._getElConfigureViews();this.__bind(f,"click","ConfigureViews");f=this._getElStartDb();this.__bind(f,"click","StartDb");f=this._getElStopDb();this.__bind(f,"click","StopDb");f=this._getElRemoveDb();this.__bind(f,"click","RemoveDb")},openBy:function(f){var h=this._getDbIdOf(f);this._setTargetDbId(h);var g=this._isActiveDb(f);this._setMenuActiveStatus(g);this._adjustPosBy(f);this._show()},_setMenuActiveStatus:function(g){var h=this._getElStartDb();var f=this._getElStopDb();if(g){h.hide();f.show()}else{h.show();f.hide()}},_adjustPosBy:function(i){var j=neo.webdb.getRect(i,true);var o={left:j.left,top:j.top+j.height};var f=this._getElMenu();var g=f.outerHeight();var k=document.documentElement.clientHeight;if(o.top+g>k){var m=o.top-j.height-g;o.top=m}var l=f.outerWidth();var n=document.documentElement.clientWidth;if(o.left+l>n){var h=o.left+j.width-l;o.left=h}f.css(o)},close:function(){this._hide()},_show:function(){var f=this._getElMenu();f.show()},_hide:function(){var f=this._getElMenu();f.hide()},configureDb:function(){var i=this._getTargetDbId();var f=this._getConfigureDbUrl(i);var g=this._getElMainFrame();var h=g[0].contentWindow;h.location.href=f;this._getDbTree().setFocused(i)},_getConfigureDbUrl:function(h){var g={cmd:c.CMD_CONFIGURE_DB,tid:h};var f=neo.webdb.getDbSettingUrl(g);return f},configureViews:function(){var i=this._getTargetDbId();var f=this._getConfigureViewsUrl(i);var g=this._getElMainFrame();var h=g[0].contentWindow;h.location.href=f;this._getDbTree().setFocused(i)},_getConfigureViewsUrl:function(h){var g={cmd:c.CMD_CONFIGURE_VIEWS,tid:h,init:"1"};var f=neo.webdb.getDbSettingUrl(g);return f},startDb:function(){this._submitStartDb()},_submitStartDb:function(){var f=this._getAjaxStart();f.sendRequest()},stopDb:function(){var f=this;var g={onok:function(){f._stopDbLow()}};var h="停止してよろしいですか。";neo.webdb.confirm(h,g)},_stopDbLow:function(){this._setDbStyleStopped();this._submitStopDb()},_submitStopDb:function(){var f=this._getAjaxStop();f.sendRequest()},_setDbStyleStopped:function(){var g=this._getTargetDbId();var f=this._getElItemOf(g);f.addClass(c.CLS_DISABLED_ITEM)},_setDbStyleBack:function(){if(this.isActiveDelTargetDb){var g=this._getTargetDbId();var f=this._getElItemOf(g);f.removeClass(c.CLS_DISABLED_ITEM)}},getConfMsgDelDb:function(){var f={url:neo.webdb.getDbSettingUrl(),getSendData:this.__closure(function(){var h={cmd:c.CMD_REMOVE_DB_CONF_MSG,tid:this._getTargetDbId()};return h}),onsuccess:this.__closure(this.onsuccessGetMsg)};var g=new neo.webdb.Ajax(f);g.initialize();g.sendRequest()},closeDialogDelConf:function(){neo.webdb.getDialog(this._getElDelConfDialog()).close()},removeDb:function(){this.closeDialogDelConf();this._removeDbLow()},_removeDbLow:function(){var g=this._getTargetDbId();var f=this._getElItemOf(g);this.isActiveDelTargetDb=this._isActiveDb(f);this._setDbStyleStopped();this._submitRemoveDb()},_submitRemoveDb:function(){var f=this._getAjaxRemove();f.sendRequest()},isOnMenu:function(h){var i=this._getElMenu();var g=i[0];for(var f=h;f.length>0;f=f.parent()){if(f[0]==g){return true}}return false},_isActiveDb:function(g){var f=this._getElItemFrom(g);var h=!f.is(".db-item-disabled");return h},_getDbIdOf:function(g){var f=this._getElItemFrom(g);var h=f.attr("data-id");return h},_getElItemFrom:function(g){var h=c.CLS_ITEM;var f=g.closest("."+h);return f},_getElItemOf:function(h){var f=this._getElDbAllItem();var g=f.filter('[data-id="'+h+'"]');return g},__bind:neo.jq.bindListener,onclickMenu:function(f){this.close()},onclickConfigureDb:function(f){this.configureDb()},onclickConfigureViews:function(f){this.configureViews()},onclickStartDb:function(f){this.startDb()},onclickStopDb:function(f){this.stopDb()},onclickRemoveDb:function(f){this.getConfMsgDelDb()},onsuccessStartDb:function(g,h){var i=h.getSendData()["tid"];var f=h.getSendData()["status"];this._getDbTree().modifyDbService(i,f);if(f!=c.VAL_START_DB_STATUS){b("#main h2").html("&nbsp;");this._getElMainFrame().get(0).contentWindow.location="about:blank"}},onsuccessStopDb:function(){this.onsuccessStartDb.apply(this,arguments)},onsuccessRemoveDb:function(f,g){var h=g.getSendData()["tid"];this._getDbTree().removeElDbItem(h);b("#main h2").html("&nbsp;");this._getElMainFrame().get(0).contentWindow.location="about:blank"},onerrorRemoveDb:function(f,g){this._setDbStyleBack()},onsuccessGetMsg:function(g){var k=this._getElDelConfDialog();var n=k.find("#msg_deldb_conf_msg");var f=k.find("#msg_deldb_warning_msgs");n.empty();f.empty();var m=g.result.confmsg||"";m=neo.core.escape(m).replace(/(\n\r|\n|\r)/g,"<br>");n.html(m);var j=g.result.warningmsgs||[];if(j.length>0){for(var h=0;h<j.length;h++){var o=j[h];if(!o){continue}var l="<li>"+neo.core.escape(o)+"</li>";f.append(l)}f.show()}else{f.hide()}neo.webdb.getDialog(k).open()}}})})(jQuery);