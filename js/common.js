(function(a){var c=neo.core.readyNamespace("neo.webdb");if(!c){return}var b=neo.webdb={CGI_MAIN:"db",CGI_DB_SETTING:"dbset",CGI_ADMIN:"admin",dialogMan:null,COOKIE_SESSION:"WdSSS",_cgiExtension:null,_getCgiExtension:function(){return this._cgiExtension||this._initCgiExtension()},_initCgiExtension:function(){var d=location.href;return this._cgiExtension=this._getExtensionOf(d)},_elCover:null,_getElCover:function(){return this._elCover||this._initElCover()},_initElCover:function(){return this._elCover=a('<div class="window_cover" />').appendTo("body")},constructor:function(){},initialize:function(){this.dialogMan=new b.DialogMan();this._updateTitle();this._hook()},_updateTitle:function(){var d=this.getTopWindow();if(d==window){return}var e=a("h1").text();if(this._isMainFrame()){d.$("#main h2").text(e)}else{d.$("#sub h2").text(e)}},_isMainFrame:function(){var e=this.getTopWindow();var d=a("#main-frame",e.document);if(!d||d.length<1){return false}return(window==d[0].contentWindow)},_isSubFrame:function(){var d=this.getTopWindow();var e=a("#sub-frame",d.document);if(!e||e.length<1){return false}return(window==e[0].contentWindow)},getTopWindow:function(){var d=window;try{while(d!=d.parent&&d.parent.neo.webdb!="undefined"&&d.parent.neo.webdb!=null){d=d.parent}}catch(f){}return d},getMainWindow:function(){var e=this.getTopWindow();var d=a("#main-frame",e.document);var f=null;if(d.length>0){f=d[0].contentWindow}return f},getSubWindow:function(){var d=this.getTopWindow();var f=a("#sub-frame",d.document);var e=f[0].contentWindow;return e},_hook:function(){var d;d=a(window);this.__bind(d,"load");this.__bind(d,"unload");d=a(document);this.__bind(d,"keydown");d=a("html");this.__bind(d,"mousedown","Window")},openSubFrame:function(e,f){var d=this.getTopWindow();d.neo.webdb.pg_frame.openSubFrame(e,f)},closeSubFrame:function(){var d=this.getTopWindow();d.neo.webdb.pg_frame.closeSubFrame()},getDialog:function(d,f){var e=this.dialogMan.get(d,f);return e},destroyDialogs:function(){this.dialogMan.destroy()},info:function(g,f){var d=this.getTopWindow();if(window!=d){return d.neo.webdb.info(g,f)}var e=this.dialogMan.getInfo(g,f);e.open()},alert:function(g,f){var d=this.getTopWindow();if(window!=d){return d.neo.webdb.alert(g,f)}var e=this.dialogMan.getAlert(g,f);e.open()},confirm:function(g,f){var d=this.getTopWindow();if(window!=d){return d.neo.webdb.confirm(g,f)}var e=this.dialogMan.getConfirm(g,f);e.open()},image:function(e,f){var d=this.getTopWindow();if(window!=d){return d.neo.webdb.image(e,f)}this.dialogMan.getImage(e,f,function(g){g.open()})},bindUserSelectDialog:function(g,f){if(!g||g.length<1){throw new Error("neo.webdb.bindUserSelectDialog : <elBtn> is required.")}if(!f){f={}}var e=this.getTopWindow();if(window!=e){return e.neo.webdb.bindUserSelectDialog(g,f)}f.elBtnOpen=g;var d=new neo.webdb.SelectUsr(f);return d},bindGroupSelectDialog:function(g,e){if(!g||g.length<1){throw new Error("neo.webdb.bindGroupSelectDialog : <elBtn> is required.")}if(!e){e={}}var d=this.getTopWindow();if(window!=d){return d.neo.webdb.bindGroupSelectDialog(g,e)}e.elBtnOpen=g;var f=new neo.webdb.SelectOrg(e);return f},kickBatch:function(g,i,f){var e=neo.webdb.getUrl({cmd:g});var h=neo.webdb.getUrl({cmd:i});f.ajaxKick=e;f.ajaxWatch=h;var d=new neo.webdb.BatchController(f);d.initialize();d.start();return d},showCover:function(d){var e=this._getElCover();e.css({cursor:d||"default"}).show();if(a.browser.msie&&a.browser.version<=6){e.css({height:a("body").height()})}},hideCover:function(){var d=this._getElCover();d.hide()},locate:function(f,h){if(!f){f=location.href}if(h){var g="_="+new Date().getTime();if(f.indexOf("?")){f+="&"+g}else{f+="?"+g}}var i={url:f};var d=neo.webdb.getUrl(i);var e=this.getTopWindow();e.location.href=d},_getCurCgiName:function(){var d=parent.location.pathname.match(/\/([^\/]+)\.(?:[^.]+)?$/)[1];return d},getUrl:function(f,e){if(!e){e=this._getCurCgiName()}var g=this._getCgiExtension();var d=e+"."+g;if(f!=null){d+="?"+neo.core.joinParam(f)}return d},getMainUrl:function(e){var d=this.getUrl(e,neo.webdb.CGI_MAIN);return d},getDbSettingUrl:function(e){var d=this.getUrl(e,neo.webdb.CGI_DB_SETTING);return d},getAdminUrl:function(e){var d=this.getUrl(e,neo.webdb.CGI_ADMIN);return d},_getExtensionOf:function(e){var f=e;var d=f.indexOf("#");if(d>0){f=f.slice(0,d)}d=f.indexOf("?");if(d>0){f=f.slice(0,d)}d=f.lastIndexOf(".");var g;if(d>0){g=f.slice(d+1)}else{g=""}return g},getRect:function(d,f){var e;if(!d||d.length<1){e={height:0,left:0,top:0,width:0}}else{if(f){e=d.offset()}else{e=d.position()}e.height=d.outerHeight();e.width=d.outerWidth()}return e},newWindowId:function(){return"wd"+new Date().getTime()},getWindowId:function(){var d=window.neo_webdb_windowId;return d?d:""},__closure:neo.core.getClosure,__bind:neo.jq.bindListener,onmousedownWindow:function(e){var d=this.getTopWindow();var f=a(e.target);if(d.neo.webdb.pg_frame){d.neo.webdb.pg_frame.closeDbMenu(f)}},onload:function(d){},onunload:function(d){this.destroyDialogs();if(this._isMainFrame()){this.closeSubFrame()}},onkeydown:function(f){var e=27;var h=f.keyCode;if(h==e){if(this._isMainFrame()||this._isSubFrame()){var g=this.getSubWindow();if(g){var d=a(g.document.body).hasClass("close_on_escape");if(d){this.closeSubFrame()}}}}},setCookie:function(j,l,i,e,g){var f="";if(i!=null&&typeof i=="number"){var k=new Date();k.setTime(k.getTime()+i*24*60*60*1000);f="; expires="+k.toGMTString()}var h=j+"="+l+f+";";if(e){h+=" domain="+e+";"}if(g){h+=" path="+g+";"}document.cookie=h},login:function(e,d){},logout:function(){var d={url:neo.webdb.getMainUrl(),getSendData:this.__closure(function(){var f={};f.cmd="logout";return f}),onsuccess:function(f,g){neo.webdb.setCookie(neo.webdb.COOKIE_SESSION,"logout",-1,"","");location.href=neo.webdb.getMainUrl({pg:"login"})}};var e=new neo.webdb.Ajax(d);e.initialize();e.sendRequest()},banpei:null};b.constructor();a(document).ready(function(){b.initialize()})})(jQuery);