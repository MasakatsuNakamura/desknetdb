(function(b){var c=neo.core.readyNamespace("neo.webdb.pg_set_dbacc.PermissionSetting");if(!c){return}var a=neo.webdb.pg_set_dbacc.PermissionSetting=new neo.core.Class({classProperties:{CMD_REMOVE:"dbsetdbaccdel",CMD_TOGGLE_STATUS:"dbsetdbaccset",CLS_STATUS_ON:"permission-status-on",CLS_STATUS_OFF:"permission-status-off",CLS_STATUS_CELL_READ:"permission-read",CLS_STATUS_CELL_ADD:"permission-add",CLS_STATUS_CELL_WRITE:"permission-write",CLS_STATUS_CELL_REMOVE:"permission-remove",CLS_STATUS_CELL_COMMENT:"permission-comment",CLS_STATUS_CELL_EXPORT_CSV:"permission-export_csv",CLS_ROW_NOINHERITED:"permission-row-noinherited",CLS_ROW_INHERITED:"permission-row-inherited",PERMISSION_TYPE_READ:"v",PERMISSION_TYPE_ADD:"a",PERMISSION_TYPE_WRITE:"e",PERMISSION_TYPE_REMOVE:"d",PERMISSION_TYPE_COMMENT:"c",PERMISSION_TYPE_EXPORT_CSV:"x",PARAM_VAL_ON:"1",PARAM_VAL_OFF:"0",defaultSetting:{}},properties:{setting:null,_ajaxRemoveSetting:null,_getAjaxRemoveSetting:function(){return this._ajaxRemoveSetting||this._initAjaxRemoveSetting()},_initAjaxRemoveSetting:function(){var d=this;var e=this._getElSelectedRows();if(e.length<1){return}var h=this._getSelectedData(e);var f={url:neo.webdb.getDbSettingUrl(),getSendData:function(){var i=d._getSelectedIdList();var j={cmd:a.CMD_REMOVE,id:h.ids.join(","),targettype:h.types.join(","),tid:d._getTableId()};return j},onsuccess:this.__closure(this.onsuccess)};var g=new neo.webdb.Ajax(f);g.initialize();return this._ajaxRemoveSetting=g},_ajaxToggleStatus:null,_getAjaxToggleStatus:function(){return this._ajaxToggleStatus||this._initAjaxToggleStatus()},_initAjaxToggleStatus:function(){var d=this;var e={url:neo.webdb.getDbSettingUrl(),getSendData:function(){var g=d._getSendDataToToggleStatus();g.cmd=a.CMD_TOGGLE_STATUS;g.tid=d._getTableId();return g},onsuccess:this.__closure(this.onsuccess)};var f=new neo.webdb.Ajax(e);f.initialize();return this._ajaxToggleStatus=f},_sendDataToToggleStatus:null,_getSendDataToToggleStatus:function(){return this._sendDataToToggleStatus},_setSendDataToToggleStatus:function(d){return this._sendDataToToggleStatus=d},_boolRefreshList:true,_getRefreshList:function(){return this._boolRefreshList},_setRefreshList:function(d){return this._boolRefreshList=d},_getTableId:function(){return this.setting.tableId},_getElMultiEditor:function(){return this.setting.elMultiEditor},_getElToggleMultiEditorStatus:function(){return this.setting.elToggleMultiEditorStatus},_getElTable:function(){return this.setting.elTable},__constructor:function(d){this.setting=d||{}},initialize:function(){this._initSetting()},_initSetting:function(){var d=this._getDefaultSetting();this.setting=b.extend({},d,this.setting)},_getDefaultSetting:function(){return b.extend({},a.defaultSetting)},removeSetting:function(){var e=this._getSelectedIdList();if(e.length<1){var d="選択して下さい。";neo.webdb.alert(d);return}this._setRefreshList(true);this._submitRemoveRequest(e)},_submitRemoveRequest:function(d){var e=this._getAjaxRemoveSetting();e.sendRequest()},togglePermissionMultiEditor:function(){var d=this._getElMultiEditor();d.slideToggle()},toggleMultiEditorStatus:function(d){var f=this._hasAllowedSetting(d);var e=this._getNextMultiEditorStatus(f);this._setEditorStatus(d,e)},_getNextMultiEditorStatus:function(e){var d;if(e===true){d=false}else{if(e===false){d=null}else{d=true}}return d},decidePermissionMultiEditor:function(){var d=this._getElSelectedRows();var e=this._getMultiEditData(d);if(!e){return}this._setRefreshList(true);this._submitSetMultiStatuses(e)},_getMultiEditData:function(e){if(e.length<1){var f="選択して下さい。";neo.webdb.alert(f);return}var h=this._getSelectedData(e);var d=this._getMultiEditorValues();if(d.values.length==0){return}var g={ids:h.ids,targetTypes:h.types,types:d.types,values:d.values};return g},_getSelectedData:function(e){var h={ids:[],types:[]};for(var f=0;f<e.length;f++){var d=e.eq(f);var j=this._getItemIdOf(d);h.ids.push(j);var g=this._getItemTypeOf(d);h.types.push(g)}return h},_getMultiEditorValues:function(){var k={types:[],values:[]};var h=this._getElToggleMultiEditorStatus();for(var f=0;f<h.length;f++){var d=h.eq(f);var j=this._hasAllowedSetting(d);if(typeof j=="boolean"){var g=this._getPermissionTypeOf(d);k.types.push(g);var e=(j?a.PARAM_VAL_ON:a.PARAM_VAL_OFF);k.values.push(e)}}return k},_submitSetMultiStatuses:function(e){var d={id:e.ids.join(","),targettype:e.targetTypes.join(","),type:e.types.join(","),value:e.values.join(",")};this._submitToggleStatus(d)},toggleStatus:function(l){var h=this._hasAllowedSetting(l);var k=!h;var d=l.closest(".permission-row");var f=d.attr("data-type");var e=d.attr("data-id");var g=true;var j=b('input[name="gid"]').val();if(f=="u"||(j=="all_group"&&e!="-1")){g=false}this._setRefreshList(g);var i={id:this._getItemIdOf(l),targettype:this._getItemTypeOf(l),type:this._getPermissionTypeOf(l),value:(k?a.PARAM_VAL_ON:a.PARAM_VAL_OFF)};this._submitToggleStatus(i);this._setStatus(l,k)},_hasAllowedSetting:function(d){var e;if(d.hasClass(a.CLS_STATUS_ON)){e=true}else{if(d.hasClass(a.CLS_STATUS_OFF)){e=false}else{e=null}}return e},_submitToggleStatus:function(e){this._setSendDataToToggleStatus(e);var d=this._getAjaxToggleStatus();d.sendRequest()},_setEditorStatus:function(d,e){if(e===true){d.addClass(a.CLS_STATUS_ON).removeClass(a.CLS_STATUS_OFF)}else{if(e===false){d.removeClass(a.CLS_STATUS_ON).addClass(a.CLS_STATUS_OFF)}else{d.removeClass(a.CLS_STATUS_ON).removeClass(a.CLS_STATUS_OFF)}}},_setStatus:function(e,h){var d=this._getElRowFrom(e);if(d.hasClass(a.CLS_ROW_INHERITED)){d.removeClass(a.CLS_ROW_INHERITED).addClass(a.CLS_ROW_NOINHERITED)}if(h){e.addClass(a.CLS_STATUS_ON).removeClass(a.CLS_STATUS_OFF);var f=this._getPermissionTypeOf(e);if(f!=a.PERMISSION_TYPE_READ){var g=this._getElStatusOf(d,a.PERMISSION_TYPE_READ);this._setStatus(g,true)}}else{e.removeClass(a.CLS_STATUS_ON).addClass(a.CLS_STATUS_OFF);var f=this._getPermissionTypeOf(e);if(f==a.PERMISSION_TYPE_READ){var g=this._getElStatusOf(d);this._setStatus(g,false)}}},_getItemIdOf:function(e){var d=this._getElRowFrom(e);var f=d.attr("data-id");return f},_getSelectedIdList:function(){var e=this._getElSelectedRows();var g=[];for(var f=0;f<e.length;f++){var d=e.eq(f);var h=this._getItemIdOf(d);g.push(h)}return g},_getItemTypeOf:function(e){var d=this._getElRowFrom(e);var f=d.attr("data-type");return f},_getPermissionTypeOf:function(d){if(d.closest("."+a.CLS_STATUS_CELL_READ).length>0){return a.PERMISSION_TYPE_READ}else{if(d.closest("."+a.CLS_STATUS_CELL_ADD).length>0){return a.PERMISSION_TYPE_ADD}else{if(d.closest("."+a.CLS_STATUS_CELL_WRITE).length>0){return a.PERMISSION_TYPE_WRITE}else{if(d.closest("."+a.CLS_STATUS_CELL_REMOVE).length>0){return a.PERMISSION_TYPE_REMOVE}else{if(d.closest("."+a.CLS_STATUS_CELL_COMMENT).length>0){return a.PERMISSION_TYPE_COMMENT}else{if(d.closest("."+a.CLS_STATUS_CELL_EXPORT_CSV).length>0){return a.PERMISSION_TYPE_EXPORT_CSV}}}}}}},_getElCheckedCheckboxes:function(){var d=this._getElTable();var e=d.find(":checked");return e},_getElSelectedRows:function(){var e=this._getElCheckedCheckboxes();var d=this._getElRowFrom(e);return d},_getElRowFrom:function(e){var d=e.closest(".permission-row");return d},_getElStatusOf:function(e,g){var d;switch(g){case a.PERMISSION_TYPE_READ:d=a.CLS_STATUS_CELL_READ;break;case a.PERMISSION_TYPE_ADD:d=a.CLS_STATUS_CELL_ADD;break;case a.PERMISSION_TYPE_WRITE:d=a.CLS_STATUS_CELL_WRITE;break;case a.PERMISSION_TYPE_REMOVE:d=a.CLS_STATUS_CELL_REMOVE;break;case a.PERMISSION_TYPE_COMMENT:d=a.CLS_STATUS_CELL_COMMENT;break;case a.PERMISSION_TYPE_EXPORT_CSV:d=a.CLS_STATUS_CELL_EXPORT_CSV;break}var f;if(d){f=e.find("."+d+" .permission-status")}else{var h=a.CLS_STATUS_CELL_READ;f=e.find(":not(."+h+") .permission-status")}return f},onsuccess:function(){if(this._getRefreshList()){var d=this.setting.page;d.setRefreshListTimer()}},__closure:neo.core.getClosure}})})(jQuery);