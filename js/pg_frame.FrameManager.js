(function(a){var d=neo.core.readyNamespace("neo.webdb.pg_frame.FrameManager");if(!d){return}var c=neo.webdb.pg_frame;var b=neo.webdb.pg_frame.FrameManager=new neo.core.Class({classProperties:{MIN_WIDTH:100,MIN_HEIGHT:100,URL_BTN_SHOW_MENU:"/wdroot/img/btn-change_size-show_menu.gif",URL_BTN_HIDE_MENU:"/wdroot/img/btn-change_size-hide_menu.gif",URL_BTN_MAXIMIZE:"/wdroot/img/btn-change_size-maximize.gif",URL_BTN_NORMALIZE:"/wdroot/img/btn-change_size-normalize.gif",COOKIE_SUBBORDER:"!subborder",banpei:null},properties:{setting:null,_callbackCloseSubFrame:null,_getCallbackCloseSubFrame:function(){return this._callbackCloseSubFrame},_setCallbackCloseSubFrame:function(e){return this._callbackCloseSubFrame=e},_showingMenu:null,isShowingMenu:function(){return this._showingMenu},_setShowingMenu:function(e){return this._showingMenu=e},_maximized:null,isMaximized:function(){return this._maximized},_setMaximized:function(e){return this._maximized=e},_tmAdjust:null,_getTmAdjust:function(){return this._tmAdjust},_setTmAdjust:function(e){return this._tmAdjust=e},_actors:null,_getActors:function(){return this._actors||this._initActors()},_initActors:function(){return this._actors=[this._getMenuBorder(),this._getMenuArea(),this._getSubBorder(),this._getMainArea(),this._getSubArea(),]},_menuArea:null,_getMenuArea:function(){return this._menuArea||this._initMenuArea()},_initMenuArea:function(){var e={elMenuArea:this._getElMenuArea(),mediator:this};return this._menuArea=new c.MenuArea(e)},_menuBorder:null,_getMenuBorder:function(){return this._menuBorder||this._initMenuBorder()},_initMenuBorder:function(){var e={elBorder:this._getElMenuBorder(),mediator:this,minWidth:this._getMinWidth()};return this._menuBorder=new c.MenuBorder(e)},_mainArea:null,_getMainArea:function(){return this._mainArea||this._initMainArea()},_initMainArea:function(){var e={elMainArea:this._getElMainArea(),elMainFrame:this._getElMainFrame(),mediator:this};return this._mainArea=new c.MainArea(e)},_subBorder:null,_getSubBorder:function(){return this._subBorder||this._initSubBorder()},_initSubBorder:function(){var e={elBorder:this._getElSubBorder(),mediator:this,minHeight:this._getMinHeight()};return this._subBorder=new c.SubBorder(e)},_subArea:null,_getSubArea:function(){return this._subArea||this._initSubArea()},_initSubArea:function(){var e={elArea:this._getElSubArea(),elFrame:this._getElSubFrame(),mediator:this};return this._subArea=new c.SubArea(e)},_getElHeaderArea:function(){return this.setting.elHeaderArea},_getElMenuArea:function(){return this.setting.elMenuArea},_getElMenuBorder:function(){return this.setting.elMenuBorder},_getElMainArea:function(){return this.setting.elMainArea},_getElMainFrame:function(){return this.setting.elMainFrame},_getElSubBorder:function(){return this.setting.elSubBorder},_getElSubArea:function(){return this.setting.elSubArea},_getElSubFrame:function(){return this.setting.elSubFrame},_getElFooterArea:function(){return this.setting.elFooterArea},_getElBtnToggleMenu:function(){return this.setting.elBtnToggleMenu},_getElBtnToggleMaximize:function(){return this.setting.elBtnToggleMaximize},_getElBtnCloseSubFrame:function(){return this.setting.elBtnCloseSubFrame},__constructor:function(e){this._showingMenu=true;this._maximized=false;this.setting=e||{}},initialize:function(){if(this.setting.fullSize=="1"){this._setMaximized(true)}this._initAllActors();this.adjust();this._hook()},_initAllActors:function(){var g=this._getActors();for(var e=0;e<g.length;e++){var f=g[e];if(f){f.initialize()}}},_hook:function(){var e;e=this._getElBtnToggleMenu();this.__bind(e,"click","ToggleMenu");e=this._getElBtnToggleMaximize();this.__bind(e,"click","ToggleMaximize");e=this._getElBtnCloseSubFrame();this.__bind(e,"click","CloseSubFrame");e=this._getElMenuBorder();this.__bind(e,"dragstop","MenuBorder");e=this._getElSubBorder();this.__bind(e,"dragstop","SubBorder")},adjust:function(){var g=this._getActors();for(var e=0;e<g.length;e++){var f=g[e];if(f){f.adjust()}}},toggleMenu:function(){var f=this._getElBtnToggleMenu();var e=a("empty").add(this._getElMenuArea()).add(this._getElMenuBorder());if(this.isShowingMenu()){f.attr("src",b.URL_BTN_SHOW_MENU).attr("title","メニューを表示");this._setShowingMenu(false);e.hide()}else{f.attr("src",b.URL_BTN_HIDE_MENU).attr("title","メニューを非表示");this._setShowingMenu(true);e.show()}this.adjust()},toggleMaximize:function(){var f=this._getElBtnToggleMaximize();var e=a("empty").add(this._getElHeaderArea()).add(this._getElFooterArea()).add(this._getElBtnToggleMenu());if(this.isShowingMenu()){e=e.add(this._getElMenuArea()).add(this._getElMenuBorder())}if(this.isMaximized()){f.attr("src",b.URL_BTN_MAXIMIZE).attr("title","最大化");this._setMaximized(false);e.show()}else{f.attr("src",b.URL_BTN_NORMALIZE).attr("title","元のサイズに戻す");this._setMaximized(true);e.hide()}this.adjust()},openSubFrame:function(e,g){var f=this._getElSubFrame();f[0].contentWindow.location.href="about:blank";this._runCallbackCloseSubFrame();this._setCallbackCloseSubFrame(g);this._openSubFrameLow(e)},_openSubFrameLow:function(f){var j=this._getElSubBorder();if(j.css("display")!="none"){this._locationSubFrame(f);return}var k;var i=neo.core.getCookie(b.COOKIE_SUBBORDER);if(i!=null){k=parseInt(i)}else{k=this._getMinHeight()}var h=this.getClientSize();var l=h.height-(this.getFooterHeight()+this._getMinHeight());var m=this.getHeaderHeight()+k;var n=m-l;var q=this._getElSubBorder();q.show();var e=this._getElSubArea();e.show();var g=300;var p=new Date();var r=this;var o=setInterval(function(){var u=new Date();var t=(u-p)/g;if(t>1){t=1;clearInterval(o);r._locationSubFrame(f)}var s=l+n*t;q.css({top:s});r.adjust()},10)},_locationSubFrame:function(e){var f=this._getElSubFrame();f[0].contentWindow.location.href=e},closeSubFrame:function(){this._runCallbackCloseSubFrame();var e=this._getElSubBorder();e.hide();this.adjust()},_runCallbackCloseSubFrame:function(){var i=this._getCallbackCloseSubFrame();if(typeof i=="function"){var e=this._getElMainFrame();var f=e[0].contentWindow;var h=this._getElSubFrame();var g=h[0].contentWindow;i.apply(f,[g])}this._setCallbackCloseSubFrame(null)},getClientSize:function(){var e={height:document.documentElement.clientHeight,width:document.documentElement.clientWidth};return e},getHeaderHeight:function(){var e;if(this.isMaximized()){e=0}else{var f=this._getElHeaderArea();e=f.height()}return e},getFooterHeight:function(){var e;if(this.isMaximized()){e=0}else{var f=this._getElFooterArea();e=f.height()}return e},getMiddleHeight:function(){var f=this.getHeaderHeight();var h=this.getClientSize();var g=this.getFooterHeight();var e=h.height-(f+g);if(e<0){e=0}return e},getMenuBorderOffset:function(){var e=this._getElMenuBorder();var f=e.offset();return f},getMenuWidth:function(g){var f;if(!this.isShowingMenu()||this.isMaximized()){f=0}else{var e=this._getElMenuArea();f=e.outerWidth(g)}return f},getSubBorderTop:function(){var f=this._getElSubBorder();var e;if(f.css("display")=="none"){e=this.getHeaderHeight()+this.getMiddleHeight()}else{var g=f.offset();e=g.top}return e},_getMinWidth:function(){return b.MIN_WIDTH},_getMinHeight:function(){return b.MIN_HEIGHT},__bind:neo.jq.bindListener,onclickToggleMenu:function(e){this.toggleMenu()},onclickToggleMaximize:function(e){this.toggleMaximize()},onclickCloseSubFrame:function(e){this.closeSubFrame()},ondragstopMenuBorder:function(e,f){this.adjust()},ondragstopSubBorder:function(f,g){var e=this.getSubBorderTop()-this.getHeaderHeight();neo.core.setCookie(b.COOKIE_SUBBORDER,e);this.adjust()}}})})(jQuery);