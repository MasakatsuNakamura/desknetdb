(function(b){var c=neo.core.readyNamespace("neo.webdb.pg_viewList.ViewList");if(!c){return}var a=neo.webdb.pg_viewList.ViewList=new neo.core.Class({classProperties:{CMD_REMOVE:"dbsetdelview",CMD_VISIBILITY:"dbsetviewvisibility",CMD_DEFAULTVIEW:"dbsetviewdefview",CMD_SORT:"dbsetviewindex",VISIBILITY_ON:"1",VISIBILITY_OFF:"0",defaultSetting:{},defaultSelectableSetting:{},defaultSortableSetting:{nextPage:null,prevPage:null,ondrop:null},banpei:null},properties:{setting:null,_ajaxRemove:null,_getAjaxRemove:function(){return this._ajaxRemove||this._initAjaxRemove()},_initAjaxRemove:function(){var d={url:neo.webdb.getDbSettingUrl(),getSendData:this.__closure(function(){var f=b.extend({},this._getSendDataToRemove());f.cmd=a.CMD_REMOVE;f.tid=this._getTableId();return f}),onsuccess:function(f,g){location.reload()}};var e=new neo.webdb.Ajax(d);e.initialize();return this._ajaxRemove=e},_ajaxSetVisibility:null,_getAjaxSetVisibility:function(){return this._ajaxSetVisibility||this._initAjaxSetVisibility()},_initAjaxSetVisibility:function(){var d={url:neo.webdb.getDbSettingUrl(),getSendData:this.__closure(function(){var f=b.extend({},this._getSendDataToSetVisibility());f.cmd=a.CMD_VISIBILITY;f.tid=this._getTableId();return f})};var e=new neo.webdb.Ajax(d);e.initialize();return this._ajaxSetVisibility=e},_ajaxSetDefaultView:null,_getAjaxSetDefaultView:function(){return this._ajaxSetDefaultView||this._initAjaxSetDefaultView()},_initAjaxSetDefaultView:function(){var d={url:neo.webdb.getDbSettingUrl(),getSendData:this.__closure(function(){var f=b.extend({},this._getSendDataToSetDefaultView());f.cmd=a.CMD_DEFAULTVIEW;f.tid=this._getTableId();return f})};var e=new neo.webdb.Ajax(d);e.initialize();return this._ajaxSetDefaultView=e},_ajaxSort:null,_getAjaxSort:function(){return this._ajaxSort||this._initAjaxSort()},_initAjaxSort:function(){var d={url:neo.webdb.getDbSettingUrl(),getSendData:this.__closure(function(){var f=b.extend({},this._getSendDataToSort());f.cmd=a.CMD_SORT;f.tid=this._getTableId();return f}),onsuccess:function(f,g){var h=g.getSendData()["js_pagemoved"];if(h=="1"){location.href=location.href}}};var e=new neo.webdb.Ajax(d);e.initialize();return this._ajaxSort=e},_sendDataToRemove:null,_getSendDataToRemove:function(){return this._sendDataToRemove},_setSendDataToRemove:function(d){return this._sendDataToRemove=d},_sendDataToSetVisibility:null,_getSendDataToSetVisibility:function(){return this._sendDataToSetVisibility},_setSendDataToSetVisibility:function(d){return this._sendDataToSetVisibility=d},_sendDataToSetDefaultView:null,_getSendDataToSetDefaultView:function(){return this._sendDataToSetDefaultView},_setSendDataToSetDefaultView:function(d){return this._sendDataToSetDefaultView=d},_sendDataToSort:null,_getSendDataToSort:function(){return this._sendDataToSort},_setSendDataToSort:function(d){return this._sendDataToSort=d},_hasNextPage:function(){return this.setting.hasNextPage},_hasPrevPage:function(){return this.setting.hasPrevPage},_getOffset:function(){return this.setting.offset},_getTableId:function(){return this.setting.tableId},_getElStartSorting:function(){return this.setting.elStartSorting},_getElStopSorting:function(){return this.setting.elStopSorting},_getElTable:function(){return this.setting.elTable},_getPage:function(){return this.setting.page},__constructor:function(d){this.setting=d||{}},initialize:function(){this._initSetting()},_initSetting:function(){var d=this._getDefaultSetting();this.setting=b.extend({},d,this.setting)},_getDefaultSetting:function(){return b.extend({},a.defaultSetting)},initVisibility:function(){var f=this._getElAllRows();for(var g=0;g<f.length;g++){var e=f.eq(g);var d=this._hasVisibleSetting(e);this._setVisibilitySetting(e,d)}},create:function(){this._movePageToCreateView()},_movePageToCreateView:function(){var e=this._getParamsForCreateViewPage();var d=neo.webdb.getDbSettingUrl(e);location.href=d},_getParamsForCreateViewPage:function(){var d={};d.pg="dbseteditview";d.tid=this._getTableId();return d},startSortingViews:function(){var f=this._getElTable();f.webdbSortableTable("start");var d=this._getElStartSorting();d.hide();var e=this._getElStopSorting();e.show()},stopSortingViews:function(){var f=this._getElTable();f.webdbSortableTable("stop");var d=this._getElStartSorting();d.show();var e=this._getElStopSorting();e.hide()},remove:function(){var e=this._getElSelectedRows();if(e.length<1){var g="選択して下さい。";neo.webdb.alert(g);return}var g="削除します。";var d=this;var f={onok:function(){d._removeLow()}};neo.webdb.confirm(g,f)},_removeLow:function(){var d=this._getElSelectedRows();var e=this._getViewIdListOf(d);this._submitRemoving(e);d.find(":checked").attr("checked",false)},_submitRemoving:function(g){var f={vid:g.join(",")};this._setSendDataToRemove(f);var e=this._getAjaxRemove();e.sendRequest();for(var d=0;d<g.length;d++){this._setVisibilityParentFrame(g[d],false)}},switchVisibility:function(g){var e=this._getElTable();var f=e.webdbSortableTable("isSorting");if(!f){var d=this._getElRowFrom(g);this._switchVisibilitySetting(d)}},_switchVisibilitySetting:function(f){var g=this._hasVisibleSetting(f);var d=this._getViewIdOf(f);var e=!g;this._submitVisibilitySetting(d,e);this._setVisibilitySetting(f,e);this._setVisibilityParentFrame(d,e)},_submitVisibilitySetting:function(d,e){var f=(e?a.VISIBILITY_ON:a.VISIBILITY_OFF);var h={vid:d,dispflg:f};this._setSendDataToSetVisibility(h);var g=this._getAjaxSetVisibility();g.sendRequest()},_setVisibilitySetting:function(e,d){var h;if(d){h=a.VISIBILITY_ON}else{h=a.VISIBILITY_OFF}var g=this._getElVisibilityFrom(e);g.attr("data-visibility",h);var f;if(d){f="表示"}else{f="非表示"}g.text(f)},_hasVisibleSetting:function(d){var f=this._getElVisibilityFrom(d);var e=f.attr("data-visibility");var g=(e==a.VISIBILITY_ON);return g},_setVisibilityParentFrame:function(d,e){var g=this._getTableId();var h=this._getPage();var f=h._getDbTree();f.modifyViewVisibility(g,d,e)},setDefaultView:function(g){var e=this._getElTable();var f=e.webdbSortableTable("isSorting");if(!f){var d=this._getElRowFrom(g);this._setDefaultViewSetting(d)}},_setDefaultViewSetting:function(e){var d=this._getViewIdOf(e);this._submitDefaultViewSetting(d);this._setDispDefaultViewSetting(e)},_submitDefaultViewSetting:function(d){var f={vid:d};this._setSendDataToSetDefaultView(f);var e=this._getAjaxSetDefaultView();e.sendRequest()},_setDispDefaultViewSetting:function(d){var e=this._getElTable();e.find(".view-def_on").hide();e.find(".view-def_off").show();d.find(".view-def_off").hide();d.find(".view-def_on").show()},copyFrom:function(e){var d=this._getViewIdOf(e);this._movePageToCreateCopyView(d)},_movePageToCreateCopyView:function(d){var f=this._getParamsForCreateCopyViewPage(d);var e=neo.webdb.getDbSettingUrl(f);location.href=e},_getParamsForCreateCopyViewPage:function(d){var e=this._getParamsForCreateViewPage();e.vid=d;e.cpy=1;return e},_sort:function(f,e,d){var h=this._getViewIdListOf(f);var i=this._getOffset();if(i>0){i--}var g=e+i;this._submitSorting(h,g,d)},_submitSorting:function(h,e,d){var g={tgtrow:e,js_pagemoved:(d?"1":"0"),vid:h};this._setSendDataToSort(g);var f=this._getAjaxSort();f.sendRequest()},getSelectableSetting:function(){var d=b({},a.defaultSelectableSetting);return d},getSortableSetting:function(){var d=b({},a.defaultSortableSetting);d.nextPage=this._hasNextPage();d.prevPage=this._hasPrevPage();d.ondrop=this.__closure(this.ondropSortable);return d},_getViewIdOf:function(f){var e=f.closest(".view-row");var d=e.attr("data-id");return d},_getViewIdListOf:function(f){var h=[];for(var g=0;g<f.length;g++){var e=f.eq(g);var d=this._getViewIdOf(e);h.push(d)}return h},_getElAllRows:function(){var e=this._getElTable();var d=e.find(".view-row");return d},_getElRowFrom:function(e){var d=e.closest(".view-row");return d},_getElSelectedRows:function(){var f=this._getElTable();var e=f.find(":checked");var d=this._getElRowFrom(e);return d},_getElVisibilityFrom:function(e){var d=e.find(".view-switch_visibility");return d},ondropSortable:function(d,e){this._sort(e.elTargetRow,e.insertIntoIndex,e.pageMoved)},__closure:neo.core.getClosure,banpei:null}})})(jQuery);