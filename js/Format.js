(function(b){var c=neo.core.readyNamespace("neo.webdb.Format");if(!c){return}var a=neo.webdb.Format=new neo.core.Class({classProperties:{CLS_NAME:"format-col-name",CLS_SET_POS:"format-editor-pos",CLS_SET_POS_ON:"format-editor-pos-on",CLS_SET_STYLE_ON:"format-editor-style-on",PFX_FONT_SIZE_LV:"format-sample_cell-font_size-lv-",BOLD_VALUE_ON:"on",BOLD_VALUE_OFF:"off",ITALIC_VALUE_ON:"on",ITALIC_VALUE_OFF:"off",COLOR_TARGET_FONT:"font",COLOR_TARGET_BG:"bg",defaultSetting:{},defaultTitleStyle:{align:"c",bgcolor:"EEF2FF",color:"333333",fsize:3,fstyle:1,valign:"m"},defaultDataStyle:{align:"l",bgcolor:"FFFFFF",color:"333333",fsize:3,fstyle:0,valign:"t"}},properties:{setting:null,_colorTarget:null,_getColorTarget:function(){return this._colorTarget||this._initColorTarget()},_initColorTarget:function(){return this._colorTarget=a.COLOR_TARGET_FONT},_setColorTarget:function(d){return this._colorTarget=d},_elTarget:null,_getElTarget:function(){return this._elTarget},_setElTarget:function(d){return this._elTarget=d},_getLayoutItems:function(){return this.setting.layoutitems},_getFormat:function(){return this.setting.format},_getType:function(){return this.setting.layout.type||"l"},_getElTable:function(){return this.setting.elTable},_getElSample:function(){return this.setting.elSample},_getElEditor:function(){return this.setting.elEditor},_getElSetPosBtns:function(){return this.setting.elSetPosBtns},_getElSetBoldBtn:function(){return this.setting.elSetBoldBtn},_getElSetItalicBtn:function(){return this.setting.elSetItalicBtn},_getElIncreaseFontSizeBtn:function(){return this.setting.elIncreaseFontSizeBtn},_getElDecreaseFontSizeBtn:function(){return this.setting.elDecreaseFontSizeBtn},_getElColorTarget:function(){return this.setting.elColorTarget},_getElColorCodeR:function(){return this.setting.elColorCodeR},_getElColorCodeG:function(){return this.setting.elColorCodeG},_getElColorCodeB:function(){return this.setting.elColorCodeB},_getElColorPaletteBtn:function(){return this.setting.elColorPaletteBtn},__constructor:function(d){this.setting=d||{}},initialize:function(){this._initSetting();this._hook();this._initData()},_initSetting:function(){var d=this._getDefaultSetting();this.setting=b.extend({},d,this.setting)},_getDefaultSetting:function(){return b.extend({},a.defaultSetting)},_hook:function(){var d;d=this._getElSample();this.__bind(d,"click","Sample");var e=this._getElEditor();d=e.find(".btn-filter_detail-close");this.__bind(d,"click","CloseEditor");d=this._getElEditor();d.webdbBalloon();this.__bind(d,"submit","Editor");d=this._getElSetPosBtns();this.__bind(d,"click","SetPos");d=this._getElSetBoldBtn();this.__bind(d,"click","SetBold");d=this._getElSetItalicBtn();this.__bind(d,"click","SetItalic");d=this._getElIncreaseFontSizeBtn();this.__bind(d,"click","IncreaseFontSize");d=this._getElDecreaseFontSizeBtn();this.__bind(d,"click","DecreaseFontSize");d=this._getElColorTarget();this.__bind(d,"change","SelectColorTarget");d=this._getElColorCodeR().add(this._getElColorCodeG()).add(this._getElColorCodeB());this.__bind(d,"change","SetColor");d=this._getElColorPaletteBtn();this.__bind(d,"click","SetPaletteColor")},_initData:function(){var h=this._getLayoutItems();var i=this._getFormat();for(var f in h){if(!f){continue}var k=i[f];var j;var e;if(k){j=k.titleStyle;e=k.dataStyle}else{j=a.defaultTitleStyle;e=a.defaultDataStyle;if(this._getType()=="l"){var g=h[f];if(g){if(g.type=="number"||g.type=="numbercal"||g.type=="timespan"||g.type=="timespancal"){e.align="r"}}}}var d=this._getElRowOf(f);var l=this._getElTitleCellFrom(d);this._setData(l,j);var m=this._getElDataCellFrom(d);this._setData(m,e);e.align="l"}},_setData:function(k,d){var h=(d.fstyle>>0&1);this.setBold(k,h);var e=(d.fstyle>>1&1);this.setItalic(k,e);var m=d.fsize;this.setFontSize(k,m);var l=this._getElColorTarget();var i=l.children("[value="+a.COLOR_TARGET_FONT+"]");i.attr("selected",true);var g=d.color;this.setColor(k,g);i=l.children("[value="+a.COLOR_TARGET_BG+"]");i.attr("selected",true);var j=d.bgcolor;this.setColor(k,j);var f=d.valign+d.align;this.setPos(k,f)},showEditor:function(g){this._setElTarget(g);this._updateEditorVal(g);var e=this._getElColorTarget();var d=e.children(":selected");this.selectColorTarget(d);var f=this._getElEditor();f.webdbBalloon("option","elRelation",g);f.webdbBalloon("show")},hideEditor:function(){var d=this._getElEditor();d.webdbBalloon("hide")},_updateEditorVal:function(d){this._updateEditorPosVal(d);this._updateEditorStyleVal(d);this._updateEditorColorVal(d)},_updateEditorPosVal:function(g){var h=this._getElSetPosBtns();var i=a.CLS_SET_POS_ON;var e=h.filter("."+i);e.removeClass(i);var d=g.attr("data-pos");var f=h.filter('[data-pos="'+d+'"]');f.addClass(i)},_updateEditorStyleVal:function(e){var f=e.attr("data-bold");var i=a.CLS_SET_STYLE_ON;var h=this._getElSetBoldBtn();if(f=="on"){h.addClass(i)}else{h.removeClass(i)}var d=e.attr("data-italic");var g=this._getElSetItalicBtn();if(d=="on"){g.addClass(i)}else{g.removeClass(i)}},_updateEditorColorVal:function(e){var d=this._getElColorTarget();var f=e.attr("data-color");if(f){var i=d.children('[value="font"]');i.attr("data-color_code",f)}var h=e.attr("data-bgcolor");if(h){var g=d.children('[value="bg"]');g.attr("data-color_code",h)}},setPos:function(e,d){var f=this._getPosStyle({},d);e.css(f);e.hide().show();e.attr("data-pos",d);this._updateEditorPosVal(e)},_getPosStyle:function(e,d){var g;switch(d.charAt(0)){case"t":g="top";break;case"m":g="middle";break;case"b":g="bottom";break}e.verticalAlign=g;var f;switch(d.charAt(1)){case"l":f="left";break;case"c":f="center";break;case"r":f="right";break}e.textAlign=f;return e},setBold:function(e,f){var d=(f?a.BOLD_VALUE_ON:a.BOLD_VALUE_OFF);e.attr("data-bold",d);var g=this._getBoldStyle({},f);e.css(g);this._updateEditorStyleVal(e)},_isBold:function(f){var d=f.attr("data-bold");var e=(d==a.BOLD_VALUE_ON);return e},_getBoldStyle:function(e,d){if(d){e.fontWeight="bold"}else{e.fontWeight="normal"}return e},setItalic:function(f,e){var d=(e?a.ITALIC_VALUE_ON:a.ITALIC_VALUE_OFF);f.attr("data-italic",d);var g=this._getItalicStyle({},e);f.css(g);this._updateEditorStyleVal(f)},_isItalic:function(f){var d=f.attr("data-italic");var e=(d==a.ITALIC_VALUE_ON);return e},_getItalicStyle:function(e,d){if(d){e.fontStyle="italic"}else{e.fontStyle="normal"}return e},increaseFontSize:function(){var e=this._getElTarget();var d=Number(e.attr("data-font_size"));this.setFontSize(e,d+1)},decreaseFontSize:function(){var e=this._getElTarget();var d=Number(e.attr("data-font_size"));this.setFontSize(e,d-1)},setFontSize:function(h,f){var e=h.attr("data-font_size");var d=this._getClsFontSize(e);h.removeClass(d);if(f==null||isNaN(f)){f=3}else{if(f<1){f=1}else{if(f>5){f=5}}}var g=this._getClsFontSize(f);h.addClass(g);h.attr("data-font_size",f)},_getClsFontSize:function(e){var d=a.PFX_FONT_SIZE_LV+e;return d},selectColorTarget:function(d){var e=d.val();this._setColorTarget(e);var f=d.attr("data-color_code");this._updateColorCode(f)},_getColorCode:function(){var d=this._getElColorCodeR().add(this._getElColorCodeG()).add(this._getElColorCodeB());var h="0123456789ABCDEF";var f="";for(var e=0;e<d.length;e++){var g=parseInt(d.eq(e).val(),10);if(g<0||isNaN(g)){g=0}else{if(g>255){g=255}}f+=h.charAt(parseInt(g/16));f+=h.charAt((g%16))}return f},setColor:function(e,i){var g=this._getElColorTarget();var d=g.children(":selected");var f=d.val();var h=this._getColorStyle({},i,f);e.css(h);if(d.val()==a.COLOR_TARGET_FONT){e.attr("data-color",i)}else{e.attr("data-bgcolor",i)}d.attr("data-color_code",i);this._updateColorCode(i)},_getColorStyle:function(e,f,d){if(d==a.COLOR_TARGET_FONT){e.color="#"+f}else{e.backgroundColor="#"+f}return e},_updateColorCode:function(h){var f=this._colorCode16to10(h);var e=this._getElColorCodeR();e.val(f.r);var d=this._getElColorCodeG();d.val(f.g);var g=this._getElColorCodeB();g.val(f.b)},_colorCode16to10:function(e){if(!/[0-9A-F]{6}/.test(e)){e="000000"}var d={};d.r=parseInt(e.slice(0,2),16);d.g=parseInt(e.slice(2,4),16);d.b=parseInt(e.slice(4,6),16);return d},getData:function(j){var e=this._getElAllRows();for(var g=0;g<e.length;g++){var d=e.eq(g);var f;var l=this._getLayoutItemIdOf(d);f=this._getColDataKey(g,"id");j[f]=l;var k=this._getElTitleCellFrom(d);f=this._getColDataKey(g,"t_");this._getCellData(k,j,f);var h=this._getElDataCellFrom(d);f=this._getColDataKey(g,"d_");this._getCellData(h,j,f)}return j},_getCellData:function(j,d,f){var h=j.attr("data-bold");var e=j.attr("data-italic");d[f+"fstyle"]=((h=="on"?1:0)<<0)+((e=="on"?1:0)<<1)+0;var l=j.attr("data-font_size");d[f+"fsize"]=l;var g=j.attr("data-color");d[f+"fcolor"]=g;var k=j.attr("data-bgcolor");d[f+"bgcolor"]=k;var i=j.attr("data-pos");d[f+"align"]=i.charAt(1);d[f+"valign"]=i.charAt(0);return d},_getLayoutItemIdOf:function(d){return d.attr("data-id")},_getColDataKey:function(e,d){return neo.webdb.Layout.getColDataKey(e,d)},_elAllRows:null,_getElAllRows:function(){return this._elAllRows||this._initElAllRows()},_initElAllRows:function(){var e=this._getElTable();var d=e.find(">tr, >*>tr").filter("[data-id]");return this._elAllRows=d},_getElRowOf:function(f){var e=this._getElAllRows();var d=e.filter("[data-id="+f+"]");return d},_getElTitleCellFrom:function(d){return d.find(".format-sample_cell-title_cell")},_getElDataCellFrom:function(d){return d.find(".format-sample_cell-data_cell")},__bind:neo.jq.bindListener,onclickSample:function(d){var e=b(arguments[arguments.length-1]);this.showEditor(e)},onclickCloseEditor:function(d){this.hideEditor()},onclickSetPos:function(f){var e=this._getElTarget();var g=b(arguments[arguments.length-1]);var d=g.attr("data-pos");this.setPos(e,d)},onclickSetBold:function(f){var d=this._getElTarget();var e=this._isBold(d);this.setBold(d,!e)},onclickSetItalic:function(f){var e=this._getElTarget();var d=this._isItalic(e);this.setItalic(e,!d)},onclickIncreaseFontSize:function(d){var e=b(arguments[arguments.length-1]);this.increaseFontSize(e)},onclickDecreaseFontSize:function(d){var e=b(arguments[arguments.length-1]);this.decreaseFontSize(e)},onchangeSelectColorTarget:function(f){var e=this._getElColorTarget();var d=e.children(":selected");this.selectColorTarget(d)},onchangeSetColor:function(f){var d=this._getElTarget();var e=this._getColorCode();this.setColor(d,e)},onclickSetPaletteColor:function(f){var d=this._getElTarget();var g=b(arguments[arguments.length-1]);var e=g.attr("data-color_code");this.setColor(d,e)},onsubmitEditor:function(d){d.preventDefault()},banpei:null}})})(jQuery);