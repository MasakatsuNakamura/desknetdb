(function(b){var c=neo.core.readyNamespace("neo.webdb.pg_editView.Form");if(!c){return}var a=neo.webdb.pg_editView.Form=new neo.core.Class({classProperties:{defaultSetting:{}},properties:{setting:null,_needToMoveBack:null,_isNeedToMoveBack:function(){return this._needToMoveBack},_setNeedToMoveBack:function(d){return this._needToMoveBack=d},_connecting:null,_isConnecting:function(){return this._connecting},_setConnecting:function(d){return this._connecting=d},_ajaxEditView:null,_getAjaxEditView:function(){return this._ajaxEditView||this._initAjaxEditView()},_initAjaxEditView:function(){var d={url:neo.webdb.getDbSettingUrl(),getSendData:this.__closure(function(){var f=this._getData();f.cmd="dbsetsetview";return f}),onbeforesend:this.__closure(function(){this._setConnecting(true);var f=this._getPage();f.buttonOff()}),onsuccess:this.__closure(this.onsuccessEditView),onerror:this.__closure(function(){var f=this._getPage();f.buttonOn()}),onfinish:this.__closure(function(){this._setConnecting(false)})};var e=new neo.webdb.Ajax(d);e.initialize();return this._ajaxEditView=e},_getGeneralSetting:function(){return this.setting.general},_getPage:function(){return this.setting.page},_getElCommonViewName:function(){return this.setting.elCommonViewName},_getElBasicSortCol:function(){return this.setting.elBasicSortCol},_getElBasicSortOrder:function(){return this.setting.elBasicSortOrder},_getElBasicDispNum:function(){return this.setting.elBasicDispNum},__constructor:function(d){this.setting=d||{}},initialize:function(){this._initSetting()},_initSetting:function(){var d=this._getDefaultSetting();this.setting=b.extend({},d,this.setting)},_getDefaultSetting:function(){return b.extend({},a.defaultSetting)},finish:function(){this._setNeedToMoveBack(true);this._submit()},apply:function(){this._setNeedToMoveBack(false);this._submit()},_submit:function(){if(!this._isConnecting()){var d=this._getAjaxEditView();d.sendRequest();return true}else{return false}},_getData:function(){var d={};this._getGeneralData(d);this._getCommonData(d);this._getBasicData(d);this._getFormatData(d);this._getLayoutData(d);for(var e in d){if(d[e]===undefined){delete d[e]}}return d},_getGeneralData:function(e){var d=this._getGeneralSetting();e.tid=d.tid;e.vid=d.vid;e.l_id=d.lid;return e},_getCommonData:function(d){var e=this._getElCommonViewName();var f=e.val();d.name=f;return d},_getBasicData:function(g){var m=this._getPage();var p=m.getFilterIdList();g.filters=p.join(",");var k=this._getElBasicSortCol();for(var h=0;h<k.length;h++){var j=k.eq(h);var n=j.val();g["sort_"+h]=n}var e=this._getElBasicSortOrder();for(var h=0;h<e.length;h++){var f=e.eq(h);var d=f.val();g["order_"+h]=d}var o=this._getElBasicDispNum();var l=o.val();g.dispnum=l;return g},_getLayoutData:function(e){var d=this._getPage();return d.getLayoutData(e)},_getFormatData:function(e){var d=this._getPage();return d.getFormatData(e)},_updateId:function(e,d){var f=this._getPage();f.setViewId(e);f.setLayoutId(d)},_moveBack:function(){var d=this._getGeneralSetting();var f=d.tid;var e=neo.webdb.getDbSettingUrl({pg:"dbsetviewlist",tid:f});location.href=e},_setViewParentFrame:function(d){var e=this._getElCommonViewName().val();var g=this._getGeneralSetting();var i=g.tid;var j=this._getPage();var h=j._getDbTree();var f=h.getElViewItem(i,d);if(f.length==0){h.appendElViewItem(i,d,e)}else{h.modifyViewName(i,d,e)}},__closure:neo.core.getClosure,onsuccessEditView:function(f,g){var e=neo.core.get(f,"result.viewid","");var d=neo.core.get(f,"result.layoutid","");this._updateId(e,d);this._setViewParentFrame(e);if(this._isNeedToMoveBack()){this._moveBack()}else{var h="設定内容を保存しました。";neo.webdb.info(h);var i=this._getPage();i.buttonOn()}}}})})(jQuery);