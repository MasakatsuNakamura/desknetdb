(function(b){var c=neo.core.readyNamespace("neo.webdb.Record.ImageColumnSizeAdjustment");if(!c){return}var a=neo.webdb.Record.ImageColumnSizeAdjustment=new neo.core.Class({classProperties:{MODE_DETAIL:"detail",MODE_EDIT_DETAIL:"edit_detail",MODE_LIST:"list",MODE_LIST_DETAIL:"list_detail",MODE_EASY_EDIT:"easy_edit",defaultSetting:{editable:false},initialize:function(){},banpei:null},properties:{setting:null,_getMode:function(){return this.setting.mode},__constructor:function(d){this.setting=d||{}},initialize:function(){this._initSetting();this._hook()},_initSetting:function(){this.setting=b.extend({},a.defaultSetting,this.setting)},_getDefaults:function(){return b.extend({},a.defaultSetting)},_hook:function(){if(this._getMode()==a.MODE_EASY_EDIT){var f=b(".easy_edit .layout-item-data_image .data_image");var d=this;var g=f.attr("src");f.load(function(){if(b.browser.msie&&f.attr("src")==g){return}d.adjustByResize()});return}else{if(this._getMode()!=a.MODE_LIST){var f=b(".layout-item-data_image .data_image");var d=this;var g=f.attr("src");f.load(function(){if(b.browser.msie&&f.attr("src")==g){return}d.adjustByResize()})}}var e=b(window);this.__bind(e,"load","Window")},startAdjustMonitoring:function(){if(this._getMode()!=a.MODE_LIST){this.adjustFirst();var d=b(window);this.__bind(d,"resize","Window")}},adjustFirst:function(){var d=b(".layout-item-data_image .data_image");for(var f=0;f<d.length;f++){var g=d.eq(f);this.adjustElImage(g)}var e=this;setTimeout(function(){d.css("display","inline");if(e.setting.recordlist){e.setting.recordlist.updateTableSize()}},6)},adjustElImage:function(k){if(this._getMode()==a.MODE_DETAIL||this._getMode()==a.MODE_EDIT_DETAIL){var f=k.parents(".table_layout-row");var h=f.attr("data-id");if(!h){return}}else{var i=k.parents(".table-data_cell");var j=i.attr("data-id");var e=i.parents(".table-row");var g=e.attr("data-id");if(!g){e=k.parents(".record_detail_table");g=e.attr("data-id")}var h=g}var d=this;this.getOriginalImgSize(k,function(l){var m=d.getLimitWidth(k);var n=d.getLimitHeight(h);if(d._getMode()==a.MODE_EDIT_DETAIL){var o=k.nextAll('[name="delete"]');if(o.length){n-=o.eq(0).height()+4}}d.resizeElImage(k,l.width,l.height,m,n)})},getLimitHeight:function(d){if(this._getMode()==a.MODE_EASY_EDIT){return 200}if(this._getMode()==a.MODE_LIST){return 100}if(this._getMode()==a.MODE_LIST_DETAIL){return 130}if(!window.neo_webdb_layout_row_height){return 130}var e=neo_webdb_layout_row_height[d];if(!e||!e.height){return 13*10}return e.height},getLimitWidth:function(e){if(this._getMode()==a.MODE_EASY_EDIT){return 200}if(this._getMode()==a.MODE_LIST){return 100}var d=e.parents(".layout-item-data");return d.width()},getOriginalImgSize:function(f,g){var e={};var d=b("<img>");d.attr("src",f.attr("src"));d.css("display","none");b("body").append(d);e.width=d.width();e.height=d.height();if(e.width==0){d.one("load",function(){e.width=d.width();e.height=d.height();d.remove();g(e)})}else{d.remove();g(e)}},resizeElImage:function(e,i,g,d,f){var h=this.getResizedImageSize(i,g,d,f);if(this._getMode()==a.MODE_EASY_EDIT||this._getMode()==a.MODE_EDIT_DETAIL){if(!h.width||!h.height){return}e.width(h.width);e.height(h.height)}else{if(!h.width||!h.height){return}setTimeout(function(){e.width(h.width);e.height(h.height)},4)}},getResizedImageSize:function(j,h,i,e){var g=j;var k=h;var d=h/j;var f=j/h;if(g>i){g=i;k=d*g}if(k>e){k=e;g=f*k}var l={};l.width=Math.round(g);l.height=Math.round(k);return l},adjustByResize:function(){if(this._getMode()==a.MODE_LIST){return}var d;if(this._getMode()==a.MODE_EASY_EDIT){d=b(".easy_edit .layout-item-data_image .data_image")}else{d=b(".layout-item-data_image .data_image")}for(var f=0;f<d.length;f++){var g=d.eq(f);this.adjustElImage(g)}var e=this;setTimeout(function(){d.css("display","inline");if(e.setting.recordlist){e.setting.recordlist.updateTableSize()}},3)},__closure:neo.core.getClosure,__bind:neo.jq.bindListener,onloadWindow:function(){this.startAdjustMonitoring()},onresizeWindow:function(){this.adjustByResize()},banpei:null}});b(document).ready(function(){a.initialize()})})(jQuery);