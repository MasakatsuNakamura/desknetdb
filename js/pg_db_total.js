(function(c){var h=neo.core.readyNamespace("neo.webdb.pg_db_total");if(!h){return}var g=" 幅は200px以上、高さは100px以上で設定してください。";var f="必須パラメータが指定されていません。ログインIDは必ず指定してください。";var d="生成したコードをクリップボードにコピーしました。\nそのまま貼り付けてご利用ください。";var a="コードの生成には成功しましたが、コピーに失敗しました。\nブラウザのセキュリティ設定によっては、自動コピーがご利用になれない場合があります。\nブラウザの設定をご確認ください。";var e="コードの生成には成功しましたが、コピーに失敗しました。";var b=neo.webdb.pg_db_total={MIN_WIDTH:200,MIN_HEIGHT:100,_elBtnTotal:null,_getElBtnTotal:function(){return this._elBtnTotal||this._initElBtnTotal()},_initElBtnTotal:function(){return this._elBtnTotal=c("#dototal")},_elLinkSortSub:null,_getElLinkSortSub:function(){return this._elLinkSortSub||this._initElLinkSortSub()},_initElLinkSortSub:function(){return this._elLinkSortSub=c("#dosort_sub")},_elLinkSortTval:null,_getElLinkSortTval:function(){return this._elLinkSortTval||this._initElLinkSortTval()},_initElLinkSortTval:function(){return this._elLinkSortTval=c("#dosort_tval")},_elBtnCsv:null,_getElBtnCsv:function(){return this._elBtnCsv||this._initElBtnCsv()},_initElBtnCsv:function(){return this._elBtnCsv=c("#csv")},_elBtnPrint:null,_getElBtnPrint:function(){return this._elBtnPrint||this._initElBtnPrint()},_initElBtnPrint:function(){return this._elBtnPrint=c("#print")},_elSelDspNum:null,_getElSelDspNum:function(){return this._elSelDspNum||this._initElSelDspNum()},_initElSelDspNum:function(){return this._elSelDspNum=c("#dispnum")},_elToggleGadgetMenu:null,_getElToggleGadgetMenu:function(){return this._elToggleGadgetMenu||this._initElToggleGadgetMenu()},_initElToggleGadgetMenu:function(){return this._elToggleGadgetMenu=c("#gadget_menu-toggle")},_elBtnSaveTotal:null,_getElBtnSaveTotal:function(){return this._elBtnSaveTotal||this._initElBtnSaveTotal()},_initElBtnSaveTotal:function(){return this._elBtnSaveTotal=c("#savetotal")},_elBtnCreateCode:null,_getElBtnCreateCode:function(){return this._elBtnCreateCode||this._initElBtnCreateCode()},_initElBtnCreateCode:function(){return this._elBtnCreateCode=c("#create_code")},_elBtnDeleteCode:null,_getElBtnDeleteCode:function(){return this._elBtnDeleteCode||this._initElBtnDeleteCode()},_initElBtnDeleteCode:function(){return this._elBtnDeleteCode=c("#delete_code")},_elTextAreaCode:null,_getElTextAreaCode:function(){return this._elTextAreaCode||this._initElTextAreaCode()},_initElTextAreaCode:function(){return this._elTextAreaCode=c("#gadget_menu-code")},constructor:function(){},initialize:function(){this._hook()},_hook:function(){var i;i=this._getElBtnTotal();this.__bind(i,"click","Total");i=this._getElLinkSortSub();this.__bind(i,"click","SortSub");i=this._getElLinkSortTval();this.__bind(i,"click","SortTval");i=this._getElBtnCsv();this.__bind(i,"click","Csv");i=this._getElBtnPrint();this.__bind(i,"click","Print");i=this._getElSelDspNum();this.__bind(i,"change","DspNum");i=this._getElToggleGadgetMenu();this.__bind(i,"click","ToggleGadgetMenu");i=this._getElBtnSaveTotal();this.__bind(i,"click","SaveTotal");i=this._getElBtnCreateCode();this.__bind(i,"click","CreateCode");i=this._getElBtnDeleteCode();this.__bind(i,"click","DeleteCode");i=c(".gdgt_input");this.__bind(i,"change","InputGadget");this._getElTextAreaCode().focus(function(){c(this).select()}).click(function(){c(this).select();return false});this.monitorBat()},monitorBat:function(){var j=c('input[name="wk"]').val();if(j!="1"){return}this._buttonOff();var i=this._getBatchSetting();controller=new neo.webdb.BatchController(i);controller.initialize();controller.watch()},kickBat:function(){this._buttonOff();var i=this._getBatchSetting();controller=new neo.webdb.BatchController(i);controller.initialize();controller.start()},_getBatchSetting:function(){var k=this;var j=c("#dototal-form");var l={cmd:"totaldo"};var i={cmd:"totalmonitor",wid:neo.webdb.getWindowId()};var m={ajaxKick:neo.webdb.getMainUrl()+"?"+j.serialize(),ajaxWatch:neo.webdb.getMainUrl(i),onstart:function(n,o){c(".result_area").hide();c("#working").show();c("#result").hide()},onstopwatching:function(s,r){if(s=="ok"){var n=r.result.statcode;if(n=="0"){var q=c("input[name='tid']").val();var v=c("input[name='wid']").val();var o=c("select[name='ttlid'] option:selected").val();var t=c("input[name='dispnum']").val();var p={pg:"total",wid:v,tid:q,ttlid:o,dispnum:t};var u=neo.webdb.getMainUrl(p);location.href=u}else{c("#result-msg").text(r.result.statmsg);c("#working").hide();c("#result").show();k._buttonOn()}}else{c("#working").hide();k._buttonOn()}}};return m},_buttonOff:function(){var i=this._getElBtnTotal();i.attr("disabled","disabled").removeClass("btn")},_buttonOn:function(){var i=this._getElBtnTotal();i.removeAttr("disabled").addClass("btn")},saveTotal:function(){var i={url:neo.webdb.getMainUrl(),getSendData:function(){var k={cmd:"totalcopy",wid:c('input[name="wid"]').val(),tid:c('input[name="tid"]').val(),ttlid:c("#cur_ttlid").val()};return k},onsuccess:function(){var l=c("#cur_exec_date").val();var k=c("#exec_date");k.text(l)}};var j=new neo.webdb.Ajax(i);j.initialize();j.sendRequest()},generate:function(){var i=this.createCode();if(i.errmsg){return i}this.outputCode(i);return i},createCode:function(){var o=c('input[name="tid"]').val();var j=c("#cur_ttlid").val();var k=c("#gadgeturl").val();var m=this._createQuery();if(m==""){return m}var i=(k.match(/.*?:\/\/.+?(\/|$)/)||[""])[0];i=i.substr(0,i.lastIndexOf("/"));var n=i+"/wdroot/js/pg_gadget_total.js";var l='<script type="text/javascript" src="'+n+"?url="+encodeURIComponent(k)+"&amp;pg=gadgettotal&amp;tid="+o+"&amp;ttlid="+j+"&amp;"+m.replace(/&/g,"&amp;")+'"><\/script>';return l},_createQuery:function(){var j=[];j=this.validateFields(c("#gadget_menu").find("input:text"),function(k){return{name:k.name,value:k.value}},j);if(j.length==0){var i=new String("");i.errmsg=j.errmsg;return i}j=this.validateFields(c("#gadget_menu").find("input:password"),function(k){return{name:k.name,value:k.value}},j);if(j.length==0){var i=new String("");i.errmsg=j.errmsg;return i}j=this.validateFields(c("#gadget_menu").find("select"),function(k){return{name:k.name,value:k.value}},j);if(j.length==0){var i=new String("");i.errmsg=j.errmsg;return i}j=this.validateFields(c("#gadget_menu").find("input:radio:checked"),function(k){return{name:k.name,value:k.value}},j);if(j.length==0){var i=new String("");i.errmsg=j.errmsg;return i}j=this.validateFields(c("#gadget_menu").find("input:checkbox"),function(k){return{name:k.name,value:(k.checked?1:0)}},j);if(j.length==0){var i=new String("");i.errmsg=j.errmsg;return i}return j.join("&")},validateFields:function(j,m,o){for(var l=0;l<j.length;l++){var n=m(j[l]);n=this.validateField(n);if(n.errored){var k=new Array();k.errmsg=n.msg;return k}if(n.name&&n.name!=""&&n.value&&n.value!=""){if(n.useRow){o.push(n.name+"="+n.value)}else{o.push(n.name+"="+encodeURIComponent(n.value))}}}return o},validateField:function(i){switch(i.name){case"usesso":if(!this.isUseSSO()){return{}}return i;case"UserID":if(i.value!=undefined){if(this.isUseSSO()){i.value="$UID";i.useRow=true}else{if(i.value==""){return{errored:true,msg:f}}}}return i;case"_word":if(i.value!=undefined){if(this.isUseSSO()){i.value="$PWD";i.useRow=true}}return i;case"width":if(i.value!=undefined){if(isNaN(i.value)||i.value<b.MIN_WIDTH){return{errored:true,msg:g}}if(this.useAutoWidth()){i.value="0"}}return i;case"height":if(i.value!=undefined){if(isNaN(i.value)||i.value<b.MIN_HEIGHT){return{errored:true,msg:g}}}return i;case"dsprow":return i;default:return{}}},isUseSSO:function(){return c("input[name=usesso]:checked")[0].value==1},useAutoWidth:function(){return c("#autowidth").attr("checked")},outputCode:function(i){this._getElTextAreaCode().val(i)},__closure:neo.core.getClosure,__bind:neo.jq.bindListener,onclickTotal:function(i){i.preventDefault();this.kickBat()},onclickSortSub:function(m){m.preventDefault();var j=this._getElBtnTotal();if(j.attr("disabled")){return}var i="d";var l=c("input[name='cur_sort']").val();var k=c("input[name='cur_order']").val();if(l=="s"&&k=="d"){i="a"}c("input[name='sort']").val("s");c("input[name='order']").val(i);this.kickBat()},onclickSortTval:function(m){m.preventDefault();var j=this._getElBtnTotal();if(j.attr("disabled")=="disabled"){return}var i="d";var l=c("input[name='cur_sort']").val();var k=c("input[name='cur_order']").val();if(l=="t"&&k=="d"){i="a"}c("input[name='sort']").val("t");c("input[name='order']").val(i);this.kickBat()},onclickCsv:function(j){j.preventDefault();var l=c("input[name='tid']").val();var k=c("input[name='wid']").val();var i=neo.webdb.getMainUrl()+"?cmd=totalcsv&wid="+k+"&tid="+l;location.href=i},onclickPrint:function(j){j.preventDefault();var n=c("input[name='tid']").val();var k=c("input[name='wid']").val();var m=c("#dispnum").val();var i=neo.webdb.getMainUrl()+"?pg=totalprint&init=1&wid="+k+"&tid="+n+"&def_dispnum="+m;var l=window.open(i,"totalprint");l.focus()},onchangeDspNum:function(k){k.preventDefault();var n=c("input[name='tid']").val();var l=c("input[name='wid']").val();var j=c("select[name='ttlid'] option:selected").val();var m=c("#dispnum").val();var i=neo.webdb.getMainUrl()+"?pg=total&wid="+l+"&tid="+n+"&ttlid="+j+"&dispnum="+m;location.href=i},onclickToggleGadgetMenu:function(i){c("#gadget_menu").slideToggle()},onclickSaveTotal:function(i){i.preventDefault();this.saveTotal()},onclickCreateCode:function(j){var i=this.generate();if(i.errmsg!=undefined&&i.errmsg!=""){neo.webdb.alert(i.errmsg)}else{this._getElTextAreaCode().select()}},onchangeInputGadget:function(i){var k=c(arguments[arguments.length-1]);var j=this.validateField({name:k.attr("name"),value:k.val()});if(this._getElTextAreaCode().val()!=""){if(j.errored){this.outputCode("")}else{code=this.generate();if(code.errmsg!=undefined&&code.errmsg!=""){this.outputCode("")}else{this.outputCode(code)}}}},onclickDeleteCode:function(i){this.outputCode("")}};c(document).ready(function(){b.initialize()})})(jQuery);