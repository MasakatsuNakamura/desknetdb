(function(b){var d=neo.core.readyNamespace("neo.webdb.DialogMan");if(!d){return}var c=neo.jQuery.fn.webdbDialog;var a=neo.webdb.DialogMan=new neo.core.Class({classProperties:{},properties:{showcase:null,elDlgs:null,_dlgInfo:null,_dlgAlert:null,_dlgConfirm:null,_dlgImage:null,__constructor:function(){this.showcase=new neo.core.Showcase();this.elDlgs=[]},get:function(g,h){if(!g){throw new Error("neo.webdb.DialogMan.get : <elDlg> is null.")}if(!g.jquery||g.length<1){throw new Error("neo.webdb.DialogMan.get : <elDlg> is not Element Object.")}var f=neo.webdb.getTopWindow();if(window!=f){var i=f.neo.webdb.dialogMan;var e=i.getInstance(g);if(!e){if(b.browser.msie&&b.browser.version<8){g=b("body",f.document).append(g[0].outerHTML).children(":last")}e=i.get(g,h);this.elDlgs.push(g)}return e}var e=this.getInstance(g);if(!e){e=this._build(g,h)}return e},_build:function(f,g){var h=b("body");var i="data-tmp"+new Date().getTime();f.attr(i,i).remove();h.append(f);f=h.find("["+i+"]");f.webdbDialog(g);var e=c.getInstance(f);this.showcase.set(f,e);return e},getInstance:function(f){var e=neo.webdb.getTopWindow();f=e.$(f);return e.neo.webdb.dialogMan.showcase.getInstance(f)},removeInstance:function(f){var e=neo.webdb.getTopWindow();f=e.$(f);return e.neo.webdb.dialogMan.showcase.removeInstance(f)},_getElWidth:function(g){var e=b("<div />").insertAfter(g);g.css({position:"absolute",top:-9999}).appendTo("body");var f=g.width();g.css({position:"",top:""}).insertBefore(e);e.remove();return f},getInfo:function(l,k){if(!l&&l!=""){throw new Error("neo.webdb.DialogMan.getInfo : <message> is null.")}var f=neo.webdb.getTopWindow();if(window!=f){return f.neo.webdb.dialogMan.getInfo(l,k)}l=neo.core.escape(l).replace(/(\n\r|\n|\r)/g,"<br>");var i=this._dlgInfo;if(!i){var h=f.$("<div />");i=this.get(h,{});this._dlgInfo=i}var e=i._getElSelfOrg();e.html(l);var j=this._getElWidth(e);j=i.adjustDlgWidth(j);var g=this._getInfoSetting(e,k);i.option("title",g.title);i.option("dialogClass",g.dialogClass);i.option("buttons",g.buttons);i.option("close",g.close);i.option("width",j);return i},_getInfoSetting:function(e,g){if(!g){g={}}var f={};f.title="情報";f.dialogClass="neo-dialog neo-dialog-info";f.buttons={OK:function(){if(typeof g.onok=="function"){g.onok()}e.webdbDialog("close")}};var h=g.onclose;f.close=function(){if(typeof h=="function"){h.apply(this,arguments)}};return f},getAlert:function(l,k){if(!l&&l!=""){throw new Error("neo.webdb.DialogMan.getAlert : <message> is null.")}var f=neo.webdb.getTopWindow();if(window!=f){return f.neo.webdb.dialogMan.getAlert(l,k)}l=neo.core.escape(l).replace(/(\n\r|\n|\r)/g,"<br>");var i=this._dlgAlert;if(!i){var h=f.$("<div />");i=this.get(h,{});this._dlgAlert=i}var e=i._getElSelfOrg();e.html(l);var j=this._getElWidth(e);j=i.adjustDlgWidth(j);var g=this._getAlertSetting(e,k);i.option("title",g.title);i.option("dialogClass",g.dialogClass);i.option("buttons",g.buttons);i.option("close",g.close);i.option("width",j);return i},_getAlertSetting:function(e,g){if(!g){g={}}var f={};f.title="警告";f.dialogClass="neo-dialog neo-dialog-alert";f.buttons={OK:function(){if(typeof g.onok=="function"){g.onok()}e.webdbDialog("close")}};var h=g.onclose;f.close=function(){if(typeof h=="function"){h.apply(this,arguments)}};return f},getConfirm:function(l,k){if(!l&&l!=""){throw new Error("neo.webdb.DialogMan.getConfirm : <message> is null.")}var f=neo.webdb.getTopWindow();if(window!=f){return f.neo.webdb.dialogMan.getConfirm(l,k)}l=neo.core.escape(l).replace(/(\n\r|\n|\r)/g,"<br>");var i=this._dlgConfirm;if(!i){var h=f.$("<div />");i=this.get(h,{});this._dlgConfirm=i}var e=i._getElSelfOrg();e.html(l);var j=this._getElWidth(e);j=i.adjustDlgWidth(j);var g=this._getConfirmSetting(e,k);i.option("title",g.title);i.option("dialogClass",g.dialogClass);i.option("buttons",g.buttons);i.option("close",g.close);i.option("width",j);return i},_getConfirmSetting:function(f,i){if(!i){i={}}var g={};g.title="確認";g.dialogClass="neo-dialog neo-dialog-confirm";var e=i.onok;var k=i.oncancel;var h=function(){k=null;f.webdbDialog("close");if(typeof e=="function"){e.apply(this,arguments)}};var j=function(){f.webdbDialog("close")};g.buttons={OK:h,"キャンセル":j};g.close=function(){if(typeof k=="function"){k.apply(this,arguments)}};return g},getImage:function(f,s,p){if(!f&&f!=""){throw new Error("neo.webdb.DialogMan.getImage : <url> is null.")}var m=neo.webdb.getTopWindow();if(window!=m){return m.neo.webdb.dialogMan.getImage(message,s)}if(!s){s={}}var l=this._dlgImage;if(!l){var k=m.$("<div />");l=this.get(k,{});this._dlgImage=l}var o=l._getElSelfOrg();var h='<div style="text-align: center;"><img src="'+f+'" style="max-width: 400px;max-height: 300px">';o.html(h);var j="画像";if(s.fileName){j=s.fileName}var n='<a href="'+f+'" target="_blank" style="color: white;">'+j+"</a>";var r=this._getImageSetting(o,s);l.option("title",n);l.option("dialogClass",r.dialogClass);l.option("buttons",r.buttons);l.option("close",r.close);var q=this;var i=o.find("img");if(b.browser.msie&&b.browser.version<=6||b.browser.safari||b.browser.webkit){this._resizeImageByLimit(i.eq(0),400,300,function(){var t=q._getElWidth(o);t=l.adjustDlgWidth(t);l.option("width",t);p(l)})}else{var e=i.eq(0);var g=e.width();if(g==0){e.one("load",function(){var t=q._getElWidth(o);t=l.adjustDlgWidth(t);l.option("width",t);p(l)})}else{var g=q._getElWidth(o);g=l.adjustDlgWidth(g);l.option("width",g);p(l)}}},_getImageSetting:function(e,h){if(!h){h={}}var g={};g.dialogClass="neo-dialog neo-dialog-image";var f=function(){e.webdbDialog("close")};g.buttons={"閉じる":f};var i=h.oncancel;g.close=function(){if(typeof i=="function"){i.apply(this,arguments)}};return g},_resizeImageByLimit:function(g,f,h,i){var e=this;this._getOriginalImgSize(g,function(j){e._resizeElImage(g,j.width,j.height,f,h);i()})},_getOriginalImgSize:function(g,h){var f={};var e=b("<img>");e.attr("src",g.attr("src"));e.css("display","none");b("body").append(e);f.width=e.width();f.height=e.height();if(f.width==0){e.one("load",function(){f.width=e.width();f.height=e.height();e.remove();h(f)})}else{e.remove();h(f)}},_resizeElImage:function(f,j,h,e,g){var i=this._getResizedImageSize(j,h,e,g);if(!i.width||!i.height){return}f.width(i.width);f.height(i.height)},_getResizedImageSize:function(k,i,j,f){var h=k;var l=i;var e=i/k;var g=k/i;if(h>j){h=j;l=e*h}if(l>f){l=f;h=g*l}var m={};m.width=Math.round(h);m.height=Math.round(l);return m},remove:function(e){this.removeInstance(e);e.parents(".ui-dialog-content").remove()},destroy:function(){var f=neo.webdb.getTopWindow();for(var h=0;h<this.elDlgs.length;h++){var e=this.elDlgs[h];var g=f.neo.webdb.dialogMan.getInstance(e);f.neo.webdb.dialogMan.remove(e);g.destroy()}}}})})(jQuery);