(function(a){var c=neo.core.readyNamespace("neo.webdb.pg_recordEdit");if(!c){return}var b=neo.webdb.pg_recordEdit={CELL_MIN_WIDTH:130,_freeRecord:null,_getFreeRecord:function(){return this._freeRecord||this._initFreeRecord()},_initFreeRecord:function(){var d={columnManipulatorManager:this._getColumnManipulatorManager(),recordid:this.general.recordid,editable:true,elDetail:this._getElFreeRecord()};return this._freeRecord=new b.FreeRecord(d)},_columnManipulatorManager:null,_getColumnManipulatorManager:function(){return this._columnManipulatorManager||this._initColumnManipulatorManager()},_initColumnManipulatorManager:function(){var d=this;var e={columns:neo_webdb_columns,tid:this.general.tid,callbackOnSetTmpnm:function(g){d.general.tmpnm=g},callbackOnGetTmpnm:function(){return d.general.tmpnm},callbackOnImgSizeAdjust:function(){var g=d._getObjImgSizeAdjust();g.adjustByResize()},elDetail:this._getElFreeRecord()};var f=new neo.webdb.Record.ColumnManipulator.Manager(e);f.initialize();return this._columnManipulatorManager=f},_elFreeRecord:null,_getElFreeRecord:function(){return this._elFreeRecord||this._initElFreeRecord()},_initElFreeRecord:function(){return this._elFreeRecord=a(".record_edit_table")},_elBtnOk:null,_getElBtnOk:function(){return this._elBtnOk||this._initElBtnOk()},_initElBtnOk:function(){return this._elBtnOk=a("[name=s_ok]")},_elBtnClose:null,_getElBtnClose:function(){return this._elBtnClose||this._initElBtnClose()},_initElBtnClose:function(){return this._elBtnClose=a("[name=s_close]")},_objOk:null,_getObjOk:function(){return this._objOk||this._initObjOk()},_initObjOk:function(){var d=this;var e={onsuccess:function(){d._setRowEdited();d._refreshRow();d.close();d._refreshMainWindow()},onerror:function(){d.onerror()},onbeforesend:function(){d.onbeforesend()},onfinish:function(){d.onfinish()},noProcDefaultOnsuccess:true};var f=new b.Ok(e);return this._objOk=f},_objImgSizeAdjust:null,_getObjImgSizeAdjust:function(){return this._objImgSizeAdjust||this._initObjImgSizeAdjust()},_initObjImgSizeAdjust:function(){var e={mode:neo.webdb.Record.ImageColumnSizeAdjustment.MODE_EDIT_DETAIL};var d=new neo.webdb.Record.ImageColumnSizeAdjustment(e);return this._objImgSizeAdjust=d},_connecting:null,isConnecting:function(){return this._connecting},_setConnecting:function(d){return this._connecting=d},_close:null,isClose:function(){return this._close},_setClose:function(d){return this._close=d},constructor:function(){this._connecting=false},initialize:function(){this.general=neo_webdb_pg_record_edit_general;var e=this._getFreeRecord();e.setting.id=this.general.recordid;e.initialize();if(neo.webdb._isSubFrame()){this._getElBtnClose().show()}this._hook();var d=this._getObjImgSizeAdjust();d.initialize();this._adjustCellWidth()},_hook:function(){var d;d=a(window);this.__bind(d,"resize");d=this._getElBtnOk();this.__bind(d,"click","Ok");d=this._getElBtnClose();this.__bind(d,"click","Close");d=a(".layout-item-data .layout-item-data_image .data_image");this.__bind(d,"click","Image")},ok:function(){this._buttonOff();var h=this._getObjOk();var e=this.general.tid;var d=this.general.recordid;var f=this.general.tmpnm;var g=this._getFreeRecord().getQueryMap();h.exec(e,d,f,g)},close:function(){var d=neo.webdb.getTopWindow();this._setClose(true);if(d.neo.webdb.pg_frame){neo.webdb.closeSubFrame()}else{window.close()}},_setRowEdited:function(){var e=this.general.recordid;var d=neo.webdb.getMainWindow();if(d&&d.neo.webdb.pg_view&&e!=""){d.neo.webdb.pg_view.setRowEdited(e)}},_refreshRow:function(){var e=this.general.recordid;var d=neo.webdb.getMainWindow();if(d&&d.neo.webdb.pg_view&&e!=""){d.neo.webdb.pg_view.refreshRow(e)}},_refreshMainWindow:function(){var f=this.general.recordid;var d=neo.webdb.getMainWindow();if(d&&d.neo.webdb.pg_view&&f==""){var g={pg:"dbrecordlist",sv_tid:this.general.tid,wid:neo.webdb.getWindowId()};var e=neo.webdb.getMainUrl(g);location.href=e;d.location.href=e}},_buttonOff:function(){var d;d=this._getElBtnOk();d.attr("disabled","disabled");d=this._getElBtnClose();d.attr("disabled","disabled")},_buttonOn:function(){var d;d=this._getElBtnOk();d.removeAttr("disabled");d=this._getElBtnClose();d.removeAttr("disabled")},_adjustCellWidth:function(){var g;var d=a(".record_edit_table").find("table.normal-table-border-table");var j=0;for(var k=0;k<d.length;k++){var l=d.eq(k);var m=l.find("th.layout-item-title, th.layout-item-dummy-title").length;if(m>=3){g=l;j=m;break}if(j<m){g=l;j=m}}if(!g){return}var f=false;if(g.outerWidth()<(b.CELL_MIN_WIDTH*2*j)){f=true}var e=g.find("td.layout-item-data, td.layout-item-dummy-data");if(e.length>0){var h=0;var o=0;if(!f){h=e.outerWidth()}if(f||h<b.CELL_MIN_WIDTH){e.css("width",b.CELL_MIN_WIDTH+"px");o=g.outerWidth();e.css("width","")}else{o=g.outerWidth()}var n=document.documentElement.clientWidth;if(n>=o+20){a("table.record_edit_table").css("width","100%")}else{a("table.record_edit_table").css("width",o+"px")}}},__closure:neo.core.getClosure,__bind:neo.jq.bindListener,onclickOk:function(d){d.preventDefault();if(this.isClose()){return}if(this.isConnecting()){return}this.ok()},onclickClose:function(d){this.close()},onclickImage:function(f){var g=a(f.target);var e={fileName:g.attr("alt")};var d=g.attr("src");if(d){neo.webdb.image(d,e)}},onerror:function(){this._buttonOn()},onbeforesend:function(d){this._setConnecting(true)},onfinish:function(){this._setConnecting(false)},onresize:function(d){this._adjustCellWidth()},banpei:null};a(document).ready(function(){b.initialize()})})(jQuery);