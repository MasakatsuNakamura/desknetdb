(function(b){var c=neo.core.readyNamespace("neo.webdb.pg_frame.DbTree");if(!c){return}var a=neo.webdb.pg_frame.DbTree=new neo.core.Class({classProperties:{CLS_ITEM:"db-item",CLS_LABEL:"db-label",CLS_VIEW_LABEL:"view-label",CLS_DISABLED_ITEM:"db-item-disabled",CLS_OPEN:"db-open_menu",defaultSetting:{}},properties:{setting:null,_elDbAllItem:null,_getElDbAllItem:function(){return this._elDbAllItem||this._initElDbAllItem()},_initElDbAllItem:function(){var f=a.CLS_ITEM;var d=this._getElDbList();var e=d.find("."+f);return this._elDbAllItem=e},_getElDbList:function(){return this.setting.elDbList},_getElMainFrame:function(){return this.setting.elMainFrame},_getDbMenu:function(){return this.setting.page._getDbMenu()},_getTopTableId:function(){return this.setting.topTableId},_getElStoppingDbItems:function(){return this._getElDbList().find(".db-item-disabled")},__constructor:function(d){this.setting=d||{}},initialize:function(){var f;this._initSetting();f=this._getElStoppingDbItems();for(var e=0;e<f.length;e++){var g=f.eq(e).attr("data-id");this.modifyDbService(g,"0")}this._hook();var d=this._getTopTableId();this.setFocused(d)},_initSetting:function(){var d=this._getDefaultSetting();this.setting=b.extend({},d,this.setting)},_getDefaultSetting:function(){return b.extend({},a.defaultSetting)},_hook:function(){var d=this._getElDbList();this._hookToTarget(d)},_hookToTarget:function(e){var d;d=e.find(".db-toggle_list");this.__bind(d,"click","OpenCloseViewList");d=e.find("."+a.CLS_OPEN);this.__bind(d,"click","OpenDbMenu");d=e.find("."+a.CLS_LABEL);this.__bind(d,"click","DbLink");d=e.find("."+a.CLS_VIEW_LABEL);this.__bind(d,"click","DbLink")},appendElDbItem:function(i,j){var f={pg:"dbrecordlist",wid:neo.webdb.getWindowId(),sv_tid:i,init:"1"};var g=neo.webdb.getMainUrl(f);var l={pg:"dbrecordlist",wid:neo.webdb.getWindowId(),sv_tid:i,sv_vid:"-1",init:"1"};var h=neo.webdb.getMainUrl(l);var e='<li class="db-item" data-id="'+i+'"><div class="btn db-open_menu" tabindex="0"></div><div class="word_break db-label-area"><div class="db-toggle_list"></div><a class="db-label" href="'+g+'" target="main-frame">'+neo.core.escape(j)+'</a></div><ul class="view-list"><li class="view-item" data-id="-1"><a class="view-label" href="'+h+'" target="main-frame">基本ビュー</a></li></ul></li>';var k=this._getElDbList().find("#db-list");k.append(e);var d=this._getElDbItem(i);this._hookToTarget(d)},removeElDbItem:function(e){var d=this._getElDbItem(e);d.remove()},modifyDbName:function(e,f){var d=this._getElDbItem(e);this._setElDbItemName(d,f)},modifyDbService:function(d,f){var e;var g=this._getElDbItem(d);if(f=="1"){g.removeClass("db-item-disabled");e=g.find(".db-label,.view-label");e.removeClass("link-disabled")}else{g.addClass("db-item-disabled");e=g.find(".db-label,.view-label");e.addClass("link-disabled");this.setFocused(d)}},_setElDbItemName:function(e,d){e.find(".db-label").text(d)},_getElDbItem:function(d){var e=this._getElDbList().find(".db-item").filter('[data-id="'+d+'"]');return e},appendElViewItem:function(j,m,l){var g={pg:"dbrecordlist",wid:neo.webdb.getWindowId(),sv_tid:j,sv_vid:m,init:"1"};var e=neo.webdb.getMainUrl(g);var f='<li class="view-item word_break" data-id="'+m+'"><a class="view-label" href="'+e+'" target="main-frame">'+neo.core.escape(l)+"</a></li>";var d=this._getElDbItem(j);var h=d.find("ul.view-list");h.append(f);var k=this.getElViewItem(j,m);this._hookToTarget(k);if(d.hasClass("db-item-disabled")){var i=k.find(".view-label");i.addClass("link-disabled")}},removeElViewItem:function(f,d){var e=this.getElViewItem(f,d);e.remove()},modifyViewName:function(f,d,g){var e=this.getElViewItem(f,d);this._setElViewItemName(e,g)},modifyViewVisibility:function(g,d,e){var f=this.getElViewItem(g,d);if(e){f.removeClass("view-hide");f.show()}else{f.addClass("view-hide");f.hide()}},getElViewItem:function(f,e){var d=this._getElDbList().find(".db-item").filter('[data-id="'+f+'"]').find(".view-item").filter('[data-id="'+e+'"]');return d},_setElViewItemName:function(d,e){d.find(".view-label").text(e)},setFocused:function(d){var e=this._getElDbList();var f=this._getElDbItem(d);e.find(".db_item-focused").removeClass("db_item-focused");if(f.hasClass("db-item-disabled")){return}f.addClass("db_item-focused")},_cancelClickEventHandler:function(d){d.preventDefault();return false},__bind:neo.jq.bindListener,onclickOpenCloseViewList:function(){var d=b(arguments[arguments.length-1]).closest(".db-item");d.find(".view-list").toggle();d.toggleClass("db-item-opened")},onclickOpenDbMenu:function(e){var f=b(arguments[arguments.length-1]);var d=this._getDbMenu();d.openBy(f)},onclickDbLink:function(f){var e=b(arguments[arguments.length-1]);var g=e.closest("."+a.CLS_ITEM);var d=g.attr("data-id");this.setFocused(d)},banpei:null}})})(jQuery);