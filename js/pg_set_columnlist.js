(function(h){var a=neo.core.readyNamespace("neo.webdb.dbset_columnlist");if(!a){return}var l="追加";var n="OK";var b="キャンセル";var f="(項目を選択してください)";var o="取込元DBを選択してください。";var e="DB項目を選択してください。";var i="# 「$1$」を削除しようとしています。";var g="選択された以下のDB項目を削除してもよろしいですか？\n削除した場合、これらのDB項目に登録されているデータも削除されます。";var d="削除するDB項目が選択されていません。";var k="複写";var c="参照";var m=neo.webdb.dbset_columnlist.relcoldialog={__closure:neo.core.getClosure,__bind:neo.jq.bindListener,_elDialog:null,_getElDialog:function(){return this._elDialog||this._initElDialog()},_initElDialog:function(){var q=h("#dialog_relcol");var s=q.attr("widthdialog");var r={width:Number(s),buttons:{}};r.buttons[l]=this.__closure(this._onclickAdd);r.buttons[b]=this.__closure(this._onclickCancel);var p=neo.webdb.getDialog(q,r);return this._elDialog=p._getElSelfOrg()},_elTxtTblId:null,_getElTxtTblId:function(){return this._elTxtTblId||this._initElTxtTblId()},_initElTxtTblId:function(){var p=this._getElDialog();return this._elTxtTblId=p.find("[name=tid]")},_elTxtRelKeyColId:null,_getElTxtRelKeyColId:function(){return this._elTxtRelKeyColId||this._initElTxtRelKeyColId()},_initElTxtRelKeyColId:function(){var p=this._getElDialog();return this._elTxtRelKeyColId=p.find("[name=relkey]")},_elTdRelTblNm:null,_getElTdRelTblNm:function(){return this._elTdRelTblNm||this._initElTdRelTblNm()},_initElTdRelTblNm:function(){var p=this._getElDialog();return this._elTdRelTblNm=p.find("#reltotblname")},_elSelRelColId:null,_getElSelRelColId:function(){return this._elSelRelColId||this._initElSelRelColId()},_initElSelRelColId:function(){var p=this._getElDialog();return this._elSelRelColId=p.find("[name=relcid]")},_elTxtColName:null,_getElTxtColName:function(){return this._elTxtColName||this._initElTxtColName()},_initElTxtColName:function(){var p=this._getElDialog();return this._elTxtColName=p.find("[name=colname]")},_elRadioColType:null,_getElRadioColType:function(){return this._elRadioColType||this._initElRadioColType()},_initElRadioColType:function(){var p=this._getElDialog();return this._elRadioColType=p.find("[name=coltype]")},_getRelKeyData:function(p){return webdb_relto_cols.relkeys[p]},constructor:function(){},initialize:function(){this._hook()},_hook:function(){var q=this._getElSelRelColId();this.__bind(q,"change","RelColSelect");var p=this._getElRadioColType();this.__bind(p,"click","RadioColType")},openDialog:function(t){t=h.extend({tid:null,relkey:null,relcid:null,coltype:"relcpy",colnm:null,onsuccess:null,onerror:null},t);var u=this._getRelKeyData(t.relkey);var q='<option title="'+f+'" value="">'+f+"</option>";for(var r=0;r<u.cols.length;r++){var s=neo.core.escape(u.cols[r].colnm);s=s.replace(/\"/g,"&quot;");q+='<option title="'+s+'" value="'+u.cols[r].colid+'">'+s+"</option>"}this._getElTxtTblId().val(t.tid||"");this._getElTxtRelKeyColId().val(t.relkey||"");this._getElTxtColName().val(t.colnm||"");this._getElRadioColType().val([t.coltype]||"");this._getElTdRelTblNm().text(u.tblnm||"");this._getElSelRelColId().empty();this._getElSelRelColId().append(q);h(this).unbind("success");h(this).bind("success",t.onsuccess);h(this).unbind("error");h(this).bind("error",t.onerror);var p=this._getElDialog();neo.webdb.getDialog(p).open()},closeDialog:function(){neo.webdb.getDialog(this._getElDialog()).close()},_onclickAdd:function(q){q.preventDefault();var t=this._getElDialog();var w=neo.webdb.getDialog(t);var s=this._getElTxtTblId().val();var y=this._getElTxtRelKeyColId().val();var v=this._getElSelRelColId().val();var u=this._getElTxtColName().val();var p=this._getElRadioColType().filter(":checked").val();if(!v||v.length==0){var z={onclose:function(){w.reopen()}};neo.webdb.alert(e,z);return false}var r="cmd=dbsetcolumnadd_s&tid="+s+"&coltype="+p+"&colname="+encodeURIComponent(u)+"&relkey="+y+"&relcid="+v;var z={url:neo.webdb.getDbSettingUrl(),getSendData:function(){return r},onsuccess:(function(A){return function(){var B=jQuery.Event("success");h(A).trigger(B)}})(this),onerror:(function(A){return function(C){var D=jQuery.Event("error");h(A).trigger(D);var B={onclose:function(){w.reopen()}};neo.webdb.alert(C,B);return false}})(this)};var x=new neo.webdb.Ajax(z);x.initialize();x.sendRequest()},_onclickCancel:function(p){this.closeDialog()},onclickRadioColType:function(t){var s=this._getElTxtColName();var r=s.val();if(!r){return}var p=this._getElRadioColType().filter(":checked").val();if(p=="relcpy"){var q=new RegExp("\\("+c+"\\)$");r=r.replace(q,"("+k+")")}else{var q=new RegExp("\\("+k+"\\)$");r=r.replace(q,"("+c+")")}s.val(r)},onchangeRelColSelect:function(u){var r=this._getElSelRelColId();var t=this._getElTxtColName();var p=r.find(":selected");if(p&&p.val()){if(!t.val()){var s=p.text();var q=this._getElRadioColType().filter(":checked").val();switch(q){case"relcpy":t.val(s+" ("+k+")");break;case"relref":t.val(s+" ("+c+")");break}}}}};h(document).ready(function(){m.initialize()});var j=neo.webdb.dbset_columnlist={_elForm:null,_getElForm:function(){return this._elForm||this._initElForm()},_initElForm:function(){return this._elForm=h("#form")},_elBtnOk:null,_getElBtnOk:function(){return this._elBtnOk||this._initElBtnOk()},_initElBtnOk:function(){var p=this._getElForm();return this._elBtnOk=p.find("#btnok")},_elBtnDel:null,_getElBtnDel:function(){return this._elBtnDel||this._initElBtnDel()},_initElBtnDel:function(){var p=this._getElForm();return this._elBtnDel=p.find("#btndel")},_elBtnAdd:null,_getElBtnAdd:function(){return this._elBtnAdd||this._initElBtnAdd()},_initElBtnAdd:function(){var p=this._getElForm();return this._elBtnAdd=p.find("#btnadd")},_elSelColType:null,_getElSelColType:function(){return this._elSelColType||this._initElSelColType()},_initElSelColType:function(){var p=this._getElForm();return this._elSelColType=p.find("[name=coltype]")},_elTxtTblId:null,_getElTxtTblId:function(){return this._elTxtTblId||this._initElTxtTblId()},_initElTxtTblId:function(){var p=this._getElForm();return this._elTxtTblId=p.find("[name=tid]")},_elTxtColNm:null,_getElTxtColNm:function(){return this._elTxtColNm||this._initElTxtColNm()},_initElTxtColNm:function(){var p=this._getElForm();return this._elTxtColNm=p.find("[name=colname]")},_elSelRelTblId:null,_getElSelRelTblId:function(){return this._elSelRelTblId||this._initElSelRelTblId()},_initElSelRelTblId:function(){var p=this._getElForm();return this._elSelRelTblId=p.find("[name=reltid]")},_elSelRelTblIdContainer:null,_getElSelRelTblIdContainer:function(){return this._elSelRelTblIdContainer||this._initElSelRelTblIdContainer()},_initElSelRelTblIdContainer:function(){var p=this._getElForm();return this._elSelRelTblIdContainer=p.find("#relkeyselector")},_elStartSorting:null,_getElStartSorting:function(){return this._elStartSorting||this._initElStartSorting()},_initElStartSorting:function(){return this._elStartSorting=h("#total-start_sorting")},_elStopSorting:null,_getElStopSorting:function(){return this._elStopSorting||this._initElStopSorting()},_initElStopSorting:function(){return this._elStopSorting=h("#total-stop_sorting")},_elBtnCopy:null,_getElBtnCopy:function(){return this._elBtnCopy||this._initElBtnCopy()},_initElBtnCopy:function(){return this._elBtnCopy=h(".column_list-copy")},_elDelConfDialog:null,_getElDelConfDialog:function(){return this._elDelConfDialog||this._initElDelConfDialog()},_initElDelConfDialog:function(){var q=h("#dialog_del_conf");var s=q.attr("widthdialog");var r={width:Number(s),buttons:{}};r.buttons[n]=this.__closure(this.delColumn);r.buttons[b]=this.__closure(this.closeDialogDelConf);var p=neo.webdb.getDialog(q,r);return this._elDelConfDialog=p._getElSelfOrg()},constructor:function(){},initialize:function(){this._hook();this.onchangeColType()},_hook:function(){elBtnOk=this._getElBtnOk();this.__bind(elBtnOk,"click","Ok");elBtnDel=this._getElBtnDel();this.__bind(elBtnDel,"click","DelColumn");elBtnAdd=this._getElBtnAdd();this.__bind(elBtnAdd,"click","AddColumn");elSelColType=this._getElSelColType();this.__bind(elSelColType,"change","ColType");element=this._getElStartSorting();this.__bind(element,"click","StartSorting");element=this._getElStopSorting();this.__bind(element,"click","StopSorting");elBtnCopy=this._getElBtnCopy();this.__bind(elBtnCopy,"click","CopyColumn");var q;q=h(".selectable_table");q.webdbSelectableTable();q=h(".sortable_table");var p={prevPage:true,nextPage:true,ondrop:function(r,s){j.modSeqno(s)}};q.webdbSortableTable(p);if(q.webdbSortableTable("beforeReloadingIsSortMode")){this.startSorting()}else{this.stopSorting()}},addColumn:function(){var u=this._getElTxtTblId().val();var v=this._getElSelColType().val();var t=this._getElTxtColNm().val();var p=this._getElSelRelTblId().val();var r="cmd=dbsetcolumnadd_s&tid="+u+"&coltype="+v+"&colname="+encodeURIComponent(t);if(v=="relkey"){if(!p||p.length<=0){neo.webdb.alert(o);return false}r+="&reltid="+p}var q={url:neo.webdb.getDbSettingUrl(),getSendData:(function(){var w=r;return function(){return w}})(),onsuccess:function(){location.href=location.href},onerror:function(){}};var s=new neo.webdb.Ajax(q);s.initialize();s.sendRequest()},delColumn:function(){this._buttonOff();neo.webdb.dbset_columnlist.closeDialogDelConf();var p=this;var v=this._getElTxtTblId().val();var s=this._findSelectedColIds();var t="cmd=dbsetcolumndel&tid="+v;for(var q=0;q<s.size();q++){t+="&cid="+s.eq(q).val()}var r={url:neo.webdb.getDbSettingUrl(),getSendData:(function(){var w=t;return function(){return w}})(),onsuccess:function(){location.href=location.href},onerror:function(){p._buttonOn()}};var u=new neo.webdb.Ajax(r);u.initialize();u.sendRequest()},_buttonOff:function(){var p;p=this._getElBtnDel();p.attr("disabled","disabled").removeClass("btn");p=this._getElStartSorting();p.attr("disabled","disabled").removeClass("btn");p=this._getElStopSorting();p.attr("disabled","disabled").removeClass("btn")},_buttonOn:function(){var p;p=this._getElBtnDel();p.removeAttr("disabled").addClass("btn");p=this._getElStartSorting();p.removeAttr("disabled").addClass("btn");p=this._getElStopSorting();p.removeAttr("disabled").addClass("btn")},modSeqno:function(s){var r=this._getElTxtTblId().val();var p={url:neo.webdb.getDbSettingUrl(),getSendData:function(){var t=s.insertIntoIndex;var v=s.elTargetRow.find('input[type="checkbox"]:checked');var w="cmd=dbsetcolumnmodseq&tid="+r+"&tgtrow="+t;for(var u=0;u<v.size();u++){w+="&cid="+v.eq(u).val()}return w},onsuccess:function(){if(s.pageMoved){location.href=location.href}}};var q=new neo.webdb.Ajax(p);q.initialize();q.sendRequest()},getConfMsgDelColumn:function(){var u=this._getElTxtTblId().val();var r=this._findSelectedColIds();var s="cmd=dbsetcolumndelconfmsg&tid="+u;for(var p=0;p<r.size();p++){s+="&cid="+r.eq(p).val()}var q={url:neo.webdb.getDbSettingUrl(),getSendData:(function(){var v=s;return function(){return v}})(),onsuccess:this.__closure(this.onsuccessGetMsg)};var t=new neo.webdb.Ajax(q);t.initialize();t.sendRequest()},closeDialogDelConf:function(){neo.webdb.getDialog(this._getElDelConfDialog()).close()},startSorting:function(){var r=h(".sortable_table");r.webdbSortableTable("start");var p=this._getElStartSorting();p.hide();var q=this._getElStopSorting();q.show()},stopSorting:function(){var r=h(".sortable_table");r.webdbSortableTable("stop");var p=this._getElStartSorting();p.show();var q=this._getElStopSorting();q.hide()},__closure:neo.core.getClosure,__bind:neo.jq.bindListener,onclickOk:function(p){p.preventDefault()},onclickAddColumn:function(p){this.addColumn()},onclickDelColumn:function(p){var r=this._findSelectedColIds();if(r.length>0){this.getConfMsgDelColumn()}else{var q=d;neo.webdb.alert(q)}},onsuccessGetMsg:function(q){var t=this._getElDelConfDialog();var w=t.find("#msg_del_conf_msg");var p=t.find("#msg_del_warning_msgs");w.empty();p.empty();var v=q.result.confmsg||"";v=neo.core.escape(v).replace(/(\n\r|\n|\r)/g,"<br>");w.html(v);var s=q.result.warningmsgs||[];if(s.length>0){for(var r=0;r<s.length;r++){var x=s[r];if(!x){continue}var u="<li>"+neo.core.escape(x)+"</li>";p.append(u)}p.show()}else{p.hide()}neo.webdb.getDialog(t).open()},onclickCopyColumn:function(r){var s=h(arguments[arguments.length-1]);var u=s.closest("tr");var p=this._getElTxtTblId().val();var q=u.find("[name=chkcid]").val();var t=u.find("[name=h_coltype]").val();location.href=neo.webdb.getDbSettingUrl()+"?pg=dbsetcolumnset&mode=add&tid="+p+"&cid="+q+"&coltype="+t},onclickOpenDialogForAddRefColumn:function(p){var r=h(".sortable_table");var s=r.webdbSortableTable("isSorting");if(s){return}var t=this._getElTxtTblId().val();var q={tid:t,relkey:p,relcid:null,coltype:"relcpy",colnm:null,onsuccess:(function(u){var v=m;return function(w){v.closeDialog();location.href=location.href}})(this),onerror:(function(u){var v=m;return function(w){}})(this)};m.openDialog(q)},onchangeColType:function(p){var q=this._getElSelColType().val();if(q=="relkey"){this._getElSelRelTblIdContainer().show()}else{this._getElSelRelTblIdContainer().hide()}},onclickStartSorting:function(p){p.preventDefault();this.startSorting()},onclickStopSorting:function(p){p.preventDefault();this.stopSorting()},_findSelectedColIds:function(){return this._getElForm().find("[name=chkcid]:checked")}};h(document).ready(function(){j.initialize()})})(jQuery);