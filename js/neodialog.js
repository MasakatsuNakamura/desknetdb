(function(c){if(typeof c!="function"){throw new Error("NeoDialog : jQuery is required.")}if(typeof c.fn.dialog!="function"){throw new Error("NeoDialog : jQuery UI Dialog is required.")}if(!window.neo||!neo.core){throw new Error("NeoDialog : neocore is required.")}if(!neo.core.readyNamespace("neo.jQuery.fn.neoDialog")){return}var a=neo.jQuery.fn.neoDialog=new neo.core.Class({classProperties:{CLS_CONTAINER:"neo-dialog-container",CLS_SKIN_CONTENT:"neo-dialog-skin-content",showcase:null,defaults:{buttons:"auto",closeOnSubmit:true,dialogClass:"neo-dialog",height:"auto",minHeight:0,modal:true,reload:false,resizable:false,buttonType:"auto",width:"auto",open:undefined,close:undefined,beforeclose:undefined},initialize:function(){this.showcase=new neo.core.Showcase();this.defaults=c.extend({},c.ui.dialog.defaults,this.defaults)},getInstance:function(d){return this.showcase.getInstance(d)},setInstance:function(e,d){return this.showcase.set(e,d)},getSelectorHindrance:function(){var d="applet, embed, object, iframe";if(c.browser.msie&&c.browser.version<7){d+=", select"}return d}},properties:{options:null,param:null,param2:null,_ajaxLoad:null,_ajaxSubmit:null,_isForm:function(){return this._flgForm},_setFlgForm:function(d){return this._flgForm=d},_flgForm:null,_isLoaded:function(){return this._flgLoaded},_setFlgLoaded:function(d){return this._flgLoaded=d},_flgLoaded:null,_needRestore:null,_isNeedRestore:function(){return this._needRestore},_setNeedRestore:function(d){return this._needRestore=d},_initElSelf:function(d){this._setElSelfOrg(d);var e=d;if(!e.hasClass(a.CLS_CONTAINER)){e=c("<div />").addClass(a.CLS_CONTAINER).append(e)}return this._elSelf=e},_getElSelf:function(){return this._elSelf},_elSelf:null,_getElSelfOrg:function(){return this._elSelfOrg},_setElSelfOrg:function(d){return this._elSelfOrg=d},_elSelfOrg:null,_getElDialog:function(){if(!this._elDialog){return this._build()}return this._elDialog},_setElDialog:function(d){return this._elDialog=d},_elDialog:null,_initElSkin:function(){var d=this.options.elSkin;if(typeof d=="string"){d=c(d).clone().removeAttr("id")}return this._elSkin=d},_getElSkin:function(){return this._elSkin||this._initElSkin()},_elSkin:null,_getElHindrance:function(){return this._elHindrance},_setElHindrance:function(d){return this._elHindrance=d},_elHindrance:null,_getElContentOrg:function(){return this._elContentOrg},_setElContentOrg:function(d){return this._elContentOrg=d},_elContentOrg:null,__constructor:function(g,d,f,e){this._registerToShowcase(g);this._initElSelf(g);this._initOptions(d);this.param=f;this.param2=e;this._setFlgForm(false);this._setFlgLoaded(false);this._setNeedRestore(true);this._initElSkin()},_registerToShowcase:function(d){a.showcase.set(d,this)},_initOptions:function(d){this.options=this._getCompositedOptions(d);this._initOptionEvent();this._initOptionButtonType();this._initOptionTitle();this._initOptionWidth()},_getCompositedOptions:function(e){var d=this._getDefaults();return c.extend({},d,e)},_getDefaults:function(){return c.extend({},a.defaults)},_initOptionEvent:function(){this.onopenPref=this.options.open;this.onclosePref=this.options.close;this.options.open=this.__closure(this.ondialogopen);this.options.close=this.__closure(this.ondialogclose);this.options.beforeclose=this.__closure(this.ondialogbeforeclose)},_initOptionButtonType:function(){if(this.options.buttonType!="auto"){return}var d=this._getElSelf();if(d.children("form").length==1){this.options.buttonType="submit"}else{this.options.buttonType="info"}},_initOptionTitle:function(){if(this.options.title){return}var d=this._getElSelfOrg();var e=d.attr("title");d.removeAttr("title");this.options.title=e},_initOptionWidth:function(){if(this.options.width!="auto"){return}var d=this._getElSelfOrg();var e=c("<div />").insertAfter(d);d.css({position:"absolute",top:-9999}).appendTo("body");var f=d.width()+5;this.options.width=f;d.css({position:"",top:""}).insertBefore(e);e.remove()},initialize:function(){this._initForForm();if(this.options.autoOpen){this._build()}var d=this._getElSelf();return d},_initForForm:function(){if(this.options.autoForm===false){this._setFlgForm(false);return}var e=this._getElSelf();var d=e.children("form");if(d.length!=1){this._setFlgForm(false);return}this._setFlgForm(true);d.submit(this.__closure(this.onsubmit));neo.Ajax.setConfirm(d,false)},_build:function(){var d=this._getElSelf();var e=this._getElSkin();if(e){var f;if(e.hasClass(a.CLS_SKIN_CONTENT)){f=e}else{f=e.find("."+a.CLS_SKIN_CONTENT);if(f.length<1){throw new Error('NeoDialog._build() : elSkin has no container. An element with class "'+a.CLS_SKIN_CONTENT+'" is required.')}}f.append(d);d=e}this._setElDialog(d);this._initButtons();var g=this.options.autoOpen;this.options.autoOpen=false;d.dialog(this.options);if(g){this.open()}return d},_initButtons:function(){if(this.options.buttons=="auto"){this.options.buttons={};if(this.options.buttonType=="info"){this.options.buttons.OK=this.__closure(this.close)}if(this.options.buttonType=="submit"){this.options.buttons.Cancel=this.__closure(this.cancel);this.options.buttons.OK=this.__closure(this.submit)}}else{this._bindButtonActions(this.options.buttons)}},_bindButtonActions:function(e){if(!e){return}var d=this;c.each(e,function(g,i){if(typeof i=="string"){var h=function(f){d.call(i)};e[g]=h}})},_hideHindrances:function(){var e=this._getElDialog();var d=a.getSelectorHindrance();var f=e.find(d);var h="tmp_"+(new Date().getTime());f.addClass(h);var g=c(c.grep(c(d),function(j){var i=c(j);return(!i.hasClass(h)&&i.css("visibility")!="hidden")}));g.css({visibility:"hidden"});this._setElHindrance(g);f.removeClass(h)},_showHindrances:function(){var d=this._getElHindrance();if(d){d.css({visibility:"visible"})}},load:function(d){if(d==null){d=true}this._setNeedRestore(d);if(d){this._restore();this.reopen()}var e=this._getAjaxLoad();e.sendRequest()},_restore:function(){var e=this._getElContentOrg();if(!e){return}var d=this._getElSelf();d.empty().append(e)},_getAjaxLoad:function(){if(!this._ajaxLoad){var d=this._getAjaxOptionsLoad();this._ajaxLoad=new neo.Ajax(d)}return this._ajaxLoad},_getAjaxOptionsLoad:function(){var d={url:this.options.url,useDefaultXml:false,getSendData:this.__closure(this.getSendDataLoad),onAjaxSuccess:this.__closure(this.onsuccessLoad),beforeShowError:this.options.beforeShowErrorLoad};return d},getSendDataLoad:function(){var g=this._getParamLoad();var e=this.options.onreadydataLoad;if(typeof e=="function"){var d=this._getElDialog();g=e.apply(d[0],[g])}return g},_getParamLoad:function(){var d={url:this.options.url};return d},reload:function(d){return this.load(d)},open:function(){if(this._isForm()){this._reset()}this.openLow();if(this.options.url&&(!this._isLoaded()||this.options.reload)){this.load()}},openLow:function(){this._callSuper("open")},_reset:function(){var e=this._getElSelf();var d=e.find("form");d[0].reset()},submit:function(){if(typeof this.options.onsubmit=="function"){var d=this._getElSelfOrg();var e=this.options.onsubmit.apply(d[0],[]);if(e===false){return}}var f=this._getAjaxSubmit();f.sendRequest();if(this.options.closeOnSubmit){this.close()}},_getAjaxSubmit:function(){if(!this._ajaxSubmit){var d=this._getAjaxOptionsSubmit();this._ajaxSubmit=new neo.Ajax(d)}this._ajaxSubmit.options.url=this._getSubmitTo();return this._ajaxSubmit},_getAjaxOptionsSubmit:function(){var d=this;var e=c.extend({},a.ajaxDefaults,{getSendData:this.__closure(this.getSendDataSubmit),onAjaxSuccess:this.__closure(this.onsuccessSubmit),beforeShowError:this.options.beforeShowErrorSubmit,afterShowError:this.__closure(this.aftershowerrorSubmit)});e.url=this._getSubmitTo();return e},getSendDataSubmit:function(){var g=this._getInputValues();var e=this.options.onreadydataSubmit;if(typeof e=="function"){var d=this._getElDialog();g=e.apply(d[0],[g])}return g},_getInputValues:function(){var e=this._getElSelf();var d=e.find("form");var g=d.serialize();var f=neo.core.splitParam(g);return f},_getSubmitTo:function(){var f=this._getElSelf();var d=f.children("form");var e=d.attr("action");return e},cancel:function(){this.close()},close:function(){this.closeLow()},closeLow:function(){this._callSuper("close")},reopen:function(){this.closeLow();this.openLow()},revert:function(){this._restore();this._setFlgLoaded(false)},destroy:function(){delete this.options;this.options={};delete this._reset;this._reset=null;var d=this._getElSelfOrg();a.showcase.removeInstance(d);return;var f=this._callSuper("destroy");var e=this._getElDialog();var g=this._getElSelfOrg();g.hide();e.after(g).remove();return f},call:function(f,e,d){if(typeof f!="string"){f="open"}if(f.indexOf("_")==0){throw new Error("NeoDialog.call : Private method is called.")}if(typeof this[f]=="function"){return this[f](e,d)}else{return this._callSuper(f,e,d)}},_callSuper:function(g,f,e){var d=this._getElDialog();return d.dialog(g,f,e)},ondialogopen:function(e,f){this._hideHindrances();if(typeof this.onopenPref=="function"){var d=this._getElDialog();this.onopenPref.apply(d[0],arguments)}},ondialogclose:function(e,f){if(typeof this.onclosePref=="function"){var d=this._getElDialog();this.onclosePref.apply(d[0],arguments)}this._showHindrances()},ondialogbeforeclose:function(d,e){if(d.keyCode){this.close()}},onsubmit:function(d){d.preventDefault();this.submit()},onsuccessLoad:function(g){var h=this._getElSelf();this._setElContentOrg(h.children());var e=c(g);if(typeof this.options.onsuccessLoad=="function"){var f=this._getElDialog();var d=this.options.onsuccessLoad.apply(f[0],[e]);if(d instanceof jQuery){e=d}}h.empty().append(e);this._initForForm();this._setFlgLoaded(true);if(this._isNeedRestore()){this.closeLow();this.openLow()}},onsuccessSubmit:function(){if(typeof this.options.onsuccessSubmit=="function"){var d=this._getElDialog();this.options.onsuccessSubmit.apply(d[0],arguments)}},aftershowerrorSubmit:function(){this._callSuper("open")}}});c.fn.neoDialog=function(d,f,e){return this.each(function(){var i=c(this);var h=a.showcase.getInstance(i);if(h){h.call(d,f,e)}else{var g;if(typeof d=="string"){g=d;d=undefined}h=new a(i,d);h.initialize();if(g){i.neoDialog(g)}}})};var b=new neo.core.Class({classProperties:{hoge:function(){}}});a.initialize()})(window.jQuery);