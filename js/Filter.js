(function(b){var c=neo.core.readyNamespace("neo.webdb.Filter");if(!c){return}var a=neo.webdb.Filter=new neo.core.Class({classProperties:{CLS_NOT_EDITABLE:"filter_detail-not_editable",defaultSetting:{editable:false},initialize:function(){this.details=neo_webdb_Filter_details},banpei:null},properties:{setting:null,_elDetail:null,_getElDetail:function(){if(!this._elDetail){this._buildElDetail()}return this._elDetail},_setElDetail:function(d){return this._elDetail=d},_elConditionsList:null,_getElConditionsList:function(){return this._elConditionsList||this._initElConditionsList()},_initElConditionsList:function(){var d=this._getElDetail();return this._elConditionsList=d.find(".filter_condition-list")},__constructor:function(d){this.setting=d||{}},initialize:function(){this._initSetting()},_initSetting:function(){this.setting=b.extend({},a.defaultSetting,this.setting)},_getDefaults:function(){return b.extend({},a.defaultSetting)},show:function(){var e=this._getElDetail();var d=this._getElFilter();e.webdbBalloon("option","elRelation",d);e.webdbBalloon("show")},hide:function(){var d=this._getElDetail();d.webdbBalloon("hide")},_buildElDetail:function(){var h=this._getId();var d=this._getDetail(h);if(!d){throw new Error('neo.webdb.Filter._buildElDetail : Details for "id='+h+'" are not found.')}var e=this._getElTemplate().clone().removeAttr("id");this._setElDetail(e);if(!this.setting.editable){e.addClass(a.CLS_NOT_EDITABLE)}var g=e.find(".filter_detail-operation :radio");g.filter("[value="+d.type+"]").attr("checked",true);if(this._isEditable()){e.addClass("filter_detail-editable")}else{g.filter("[value="+d.type+"]").closest("label").addClass("filter_detail-operation-selected")}var f=d.conditions||[];this._appendElConditions(e,f);this._hook();return e},_getDetail:function(e){var d=a.details[e];return d},_appendElConditions:function(d,n){var e=d.find(".filter_condition-list");for(var j=0;j<n.length;j++){var h=n[j];if(!h){continue}var f=h.column;var k=this._getElCondition(f);var g=this.setting.editable;var m=this.setting.conditionManipulatorMan;var l=m.getManipulator(f);l.setConditionMap(k,h,g);e.append(k);this._hookCondition(k,f)}},_hook:function(){var d=this._getElDetail();d.webdbBalloon();d.submit(function(){return false});var e;e=d.find(".btn-filter_detail-close");this.__bind(e,"click","Close");e=d.find(".btn-filter_detail-add");this.__bind(e,"click","Add")},_hookCondition:function(h,g){var f=h.find("[name=column]");this.__bind(f,"change","ConditionColumn");var i=h.find(".btn-filter_condition-remove");this.__bind(i,"click","RemoveCondition");if(this._isEditable()){var e=this.setting.conditionManipulatorMan;var d=e.getManipulator(g);d.hookCondition(h)}},addCondition:function(){var e=this._getDefaultCondition();var d=this._getElDetail();this._appendElConditions(d,[e])},_getColumn:function(f){var d=neo_webdb_columns;var e=d[f]||{};return e},_isEditable:function(){return this.setting.editable},_getDefaultCondition:function(){var e=this.setting.elConditionsContainer;var d=e.find("#filter_condition-container_column-selection").find("option:first");var g=d.val();var f={column:g,keyword:""};return f},rebuildCondition:function(h){var g=h.find("[name=column]");var f=g.val();var e=this._getElCondition(f);var d=e.find("[name=column]");d.val(f);h.replaceWith(e);this._hookCondition(e,f)},resetCondition:function(e){if(!e){return}var f=this._getElDetail();var h=f.find(".filter_condition");h.remove();var g=f.find(".filter_detail-operation :radio");g.filter("[value="+e.type+"]").attr("checked",true);var d=e.conditions||[];this._appendElConditions(f,d)},removeCondition:function(e){var d=e.closest(".filter_condition");d.remove()},getQuery:function(f){var d=this._getElDetail();var k=d.find(".filter_detail-operation :checked");var e=k.val();var l="f_"+f+".ope="+e;var m=d.find(".filter_condition");for(var g=0;g<m.length;g++){var h=m.eq(g);var j=this._getQueryOne(h);l+="&f_"+f+".cond_"+g+"="+encodeURIComponent(j)}if(this.setting.id){l+="&f_"+f+".fid="+this.setting.id}return l},_getQueryOne:function(i){var h=i.find('[name="column"]');var g=h.val();var f=this.setting.conditionManipulatorMan;var d=f.getManipulator(g);var e=d.getConditionMap(i);var j=neo.core.joinParam(e);return j},_getId:function(){return this.setting.id},_getElFilter:function(){return this.setting.elFilter},_getElTemplate:function(){return b("#filter_detail-prototype")},_getElCondition:function(h){var f=this.setting.elConditionsContainer;var g=f.find('[data-id="'+h+'"]');var d=g.clone();var e=d.find("[name=column]");if(e.length>0){if(e.get(0).tagName.toUpperCase()=="SELECT"){elColumnOptions=f.find("#filter_condition-container_column-selection").find("option");elColumnOptions=elColumnOptions.clone();elColumnOptions.appendTo(e)}}return d},__bind:neo.jq.bindListener,onclickClose:function(d){this.hide()},onclickAdd:function(d){this.addCondition()},onchangeConditionColumn:function(e){var d=b(e.target).closest(".filter_condition");this.rebuildCondition(d)},onclickRemoveCondition:function(d){var e=b(d.target);this.removeCondition(e)},banpei:null}});b(document).ready(function(){a.initialize()})})(jQuery);