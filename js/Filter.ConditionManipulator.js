(function(h){var a=neo.core.readyNamespace("neo.webdb.Filter.ConditionManipulator");if(!a){return}var n="（未選択）";var f=neo.webdb.Filter.ConditionManipulator.KeyType={ABSOLUTE:"0",EMPTY:"1",DATETIME_SPECIFICATION_DATE_SELECT:"127",DATETIME_SPECIFICATION_DATE_INPUT:"128",DATETIME_SPECIFICATION_WEEK:"114",DATETIME_SPECIFICATION_OFFSET:"115",DATETIME_COMPARECOLID:"116",SELECT_USERDEFINE:"301",SELECT_NON_USERDEFINE:"302",SELECT_ALLUSERDEFINE:"305",USER_INPUTNAME:"201",USER_SELECTUSER:"202"};var j=neo.webdb.Filter.ConditionManipulator=new neo.core.Class({classProperties:{defaultSetting:{}},properties:{setting:null,__constructor:function(o){this.setting=o||{}},initialize:function(){this._initSetting()},_initSetting:function(){var o=this._getDefaultSetting();this.setting=h.extend({},o,this.setting)},_getDefaultSetting:function(){return h.extend({},j.defaultSetting)},getConditionMap:function(q){var p;var o={};p=q.find('[name="condition_id"]');o.condition_id=p.val();p=q.find('[name="column"]');o.column=p.val();p=q.find('[name="method"]:visible');o.method=p.val();return o},setConditionMap:function(q,o,p){if(p){this._setConditionMap_editable(q,o)}else{this._setConditionMap_nonEditable(q,o)}},_setConditionMap_editable:function(q,o){var p;p=q.find('[name="condition_id"]');p.val(o.condition_id);p=q.find('[name="column"]');p.val(o.column);p=q.find('[name="method"]');p.val(o.method)},_setConditionMap_nonEditable:function(s,q){var t={"0":null,"1":"(値なし)","2":"(値なし以外)","301":"","302":"（その他）","303":"（未選択）","304":"（未選択以外）","305":"（全選択）","306":"（全選択以外）"};var o={"==":"と同じ","!=":"と異なる","<=":"以下",">=":"以上","<":"より小さい",">":"より大きい",Like:"を含む","!Like":"を含まない",LLike:"で始まる",RLike:"で終わる"};var p=q.keyword?q.keyword:t[q.type]?t[q.type]:"";var u=o[q.method];var r;r=s.find(".filter_condition-method");r.text(u);r=s.find(".filter_condition-keyword");r.text(p)},hookCondition:function(o){},_onChangeType:function(o){this._setDefaultCondition(o);this._updateView(o)},_setDefaultCondition:function(p){var o=p.find(".filter_condition-default_selected");o.attr("selected","true")},_updateView:function(s){var p=s.find('[name="type"]');if(p.length<=0){return}var r=p.val();r=r.match(/^[0-9]*/);var q=s.find('[class*="filter_condition-type_"]');q.hide();var o=s.find(".filter_condition-type_"+r);o.show()}}});var g=neo.webdb.Filter.TextConditionManipulator=new neo.core.Class({superClass:j,properties:{getConditionMap:function(q){var p;var o=this.__call("getConditionMap",[q]);p=q.find('[name="keyword"]');o.keyword=p.val();return o},_setConditionMap_editable:function(q,o){var p;this.__call("_setConditionMap_editable",[q,o]);p=q.find('[name="keyword"]');p.val(o.keyword);this._updateView(q)},_setConditionMap_nonEditable:function(p,o){this.__call("_setConditionMap_nonEditable",[p,o])}}});var k=neo.webdb.Filter.UrlConditionManipulator=new neo.core.Class({superClass:j,properties:{getConditionMap:function(q){var p;var o=this.__call("getConditionMap",[q]);o.type=q.find('[name="type"]').val();o.keyword=q.find('[name="keyword"]').val();return o},_setConditionMap_editable:function(q,o){var p;this.__call("_setConditionMap_editable",[q,o]);p=q.find('[name="type"]');p.val(o.type);p=q.find('[name="keyword"]');p.val(o.keyword);this._updateView(q)},_setConditionMap_nonEditable:function(p,o){this.__call("_setConditionMap_nonEditable",[p,o])},hookCondition:function(o){element=o.find('[name="type"]');element.change(function(p){var q=o;return function(){p._onChangeType(q)}}(this));this._updateView(o)}}});var b=neo.webdb.Filter.NumberConditionManipulator=new neo.core.Class({superClass:j,properties:{getConditionMap:function(q){var p;var o=this.__call("getConditionMap",[q]);p=q.find('[name="keyword"]');o.keyword=p.val();return o},_setConditionMap_editable:function(q,o){var p;this.__call("_setConditionMap_editable",[q,o]);p=q.find('[name="keyword"]');p.val(o.keyword);this._updateView(q)},_setConditionMap_nonEditable:function(p,o){this.__call("_setConditionMap_nonEditable",[p,o])}}});var e=neo.webdb.Filter.DatetimeConditionManipulator=new neo.core.Class({superClass:j,properties:{getConditionMap:function(v){var t;var z=this.__call("getConditionMap",[v]);var o=v.find('[name="keyword-weekday"]');var p=v.find('[name="keyword-offset"]');var C=v.find('[name="method_0"]');var B=v.find('[name="method_1"]');var A=v.find('[name="method_2"]');t=v.find('[name="type"]');z.type=t.val();if(z.type==f.DATETIME_SPECIFICATION_DATE_SELECT||z.type==f.DATETIME_SPECIFICATION_DATE_INPUT){var w,s,y,r,u,o;if(z.type==f.DATETIME_SPECIFICATION_DATE_SELECT){w=v.find('[name="keyword-year"]');s=v.find('[name="keyword-month"]');y=v.find('[name="keyword-day"]');r=v.find('[name="keyword-hours"]');u=v.find('[name="keyword-minutes"]')}else{if(z.type==f.DATETIME_SPECIFICATION_DATE_INPUT){w=v.find('[name="keyword-input_year"]');s=v.find('[name="keyword-input_month"]');y=v.find('[name="keyword-input_day"]');r=v.find('[name="keyword-input_hours"]');u=v.find('[name="keyword-input_minutes"]')}}z.keyword="";var x="";x=w.val();if(x&&x!=""){x=x.match(/^[0-9]+$/);x=(x&&x!="")?x:"?"}else{x=""}z.keyword+=x;z.keyword+="/";x=s.val();if(x&&x!=""){x=x.match(/^[0-9]+$/);x=(x&&x!="")?x:"?"}else{x=""}z.keyword+=x;z.keyword+="/";x=y.val();if(x&&x!=""){x=x.match(/^[0-9]+$/);x=(x&&x!="")?x:"?"}else{x=""}z.keyword+=x;z.keyword+=" ";x=r.val();if(x&&x!=""){x=x.match(/^[0-9]+$/);x=(x&&x!="")?x:"?"}else{x=""}z.keyword+=x;z.keyword+=":";x=u.val();if(x&&x!=""){x=x.match(/^[0-9]+$/);x=(x&&x!="")?x:"?"}else{x=""}z.keyword+=x;z.method=B.val()}else{if(z.type==f.DATETIME_SPECIFICATION_WEEK){z.keyword=o.val();z.method=A.val()}else{if(z.type==f.DATETIME_SPECIFICATION_OFFSET){z.type=C.val();z.keyword=p.val();z.method=B.val()}else{if(z.type.indexOf(f.DATETIME_COMPARECOLID+":")==0){var q=z.type.split(":");z.type=q[0];z.keyword=q[1];z.method=B.val()}else{if(z.type==f.EMPTY){z.keyword="";z.method=A.val()}else{z.keyword="";z.method=B.val()}}}}}return z},_setConditionMap_editable:function(u,z){var s;this.__call("_setConditionMap_editable",[u,z]);var o=u.find('[name="keyword-weekday"]');var p=u.find('[name="keyword-offset"]');var D=u.find('[name="method_0"]');var B=u.find('[name="method_1"]');var A=u.find('[name="method_2"]');var x=u.find('[name="type"]');x.val(z.type);if(z.type==f.DATETIME_SPECIFICATION_DATE_SELECT||z.type==f.DATETIME_SPECIFICATION_DATE_INPUT){var w,r,y,q,t,o;if(z.type==f.DATETIME_SPECIFICATION_DATE_SELECT){w=u.find('[name="keyword-year"]');r=u.find('[name="keyword-month"]');y=u.find('[name="keyword-day"]');q=u.find('[name="keyword-hours"]');t=u.find('[name="keyword-minutes"]')}else{if(z.type==f.DATETIME_SPECIFICATION_DATE_INPUT){w=u.find('[name="keyword-input_year"]');r=u.find('[name="keyword-input_month"]');y=u.find('[name="keyword-input_day"]');q=u.find('[name="keyword-input_hours"]');t=u.find('[name="keyword-input_minutes"]')}}var v=z.keyword;var C=v.match(/(\d*)\/(\d*)\/(\d*) (\d*):(\d*)/);w.val(C[1]);r.val(C[2]);y.val(C[3]);q.val(C[4]);t.val(C[5]);B.val(z.method)}else{if(z.type==f.DATETIME_SPECIFICATION_WEEK){o.val(z.keyword);A.val(z.method)}else{if(z.type>="117"&&z.type<="126"){x.val(f.DATETIME_SPECIFICATION_OFFSET);p.val(z.keyword);D.val(z.type);B.val(z.method)}else{if(z.type==f.DATETIME_COMPARECOLID){x.val(f.DATETIME_COMPARECOLID+":"+z.keyword);B.val(z.method)}else{if(z.type==f.EMPTY){A.val(z.method)}else{B.val(z.method)}}}}}this._updateView(u)},_setConditionMap_nonEditable:function(r,w){var p={"101":"今日","102":"昨日","103":"明日","104":"今週","105":"先週","106":"来週","107":"今月","108":"先月","109":"来月","110":"今年","111":"去年","112":"来年","0":null,"114":null,"115":"（現在日時から）","1":"（値なし）","121":"日前","122":"日後","123":"ヶ月前","124":"ヶ月後","125":"年前","126":"年後"};var t={Sun:"日曜日",Mon:"月曜日",Tue:"火曜日",Wed:"水曜日",Thu:"木曜日",Fri:"金曜日",Sat:"土曜日"};var u={"==":"と等しい","!=":"と等しくない","<=":"以前",">=":"以降","<":"より過去",">":"より未来"};var s="";var o="";if(w.type==f.DATETIME_SPECIFICATION_DATE_SELECT||w.type==f.DATETIME_SPECIFICATION_DATE_INPUT){var v=w.keyword;var x=v.match(/(\d*)\/(\d*)\/(\d*) (\d*):(\d*)/);if(x[1]){s+=x[1]}if(x[2]){s+="/"+x[2]}if(x[3]){s+="/"+x[3]}if(x[4]){s+=" "+x[4]}if(x[5]){s+=":"+x[5]}o=u[w.method]}else{if(w.type==f.DATETIME_COMPARECOLID){s=neo_webdb_columns[w.keyword].name;o=u[w.method]}else{if(w.type==f.DATETIME_SPECIFICATION_WEEK){s=t[w.keyword];o=u[w.method]}else{if(w.type>="121"&&w.type<="126"){s=w.keyword;o=p[w.type]+u[w.method]}else{if(w.type==f.EMPTY){s=p[w.type];o=u[w.method]}else{s=p[w.type];o=u[w.method]}}}}}var q;q=r.find(".filter_condition-method");q.text(o);q=r.find(".filter_condition-keyword");q.text(s)},hookCondition:function(o){element=o.find('[name="type"]');element.change(function(p){var q=o;return function(){p._onChangeType(q)}}(this));this._updateView(o)}}});var d=neo.webdb.Filter.TimespanConditionManipulator=new neo.core.Class({superClass:j,properties:{getConditionMap:function(q){var o=this.__call("getConditionMap",[q]);var p=q.find('[name="type"]').val();o.type=p;if(o.type==f.ABSOLUTE){o.keyword="";var r="";r=q.find('[name="keyword_days"]').val();r=(r&&r!="")?r.match(/^\-?[0-9]+$/):"0";o.keyword+=(r&&r!="")?r:"?";o.keyword+=" ";r=q.find('[name="keyword_hours"]').val();r=(r&&r!="")?r.match(/^\-?[0-9]+$/):"0";o.keyword+=(r&&r!="")?r:"?";o.keyword+=":";r=q.find('[name="keyword_minutes"]').val();r=(r&&r!="")?r.match(/^\-?[0-9]+$/):"0";o.keyword+=(r&&r!="")?r:"?";o.keyword+=":";r=q.find('[name="keyword_seconds"]').val();r=(r&&r!="")?r.match(/^\-?[0-9]+$/):"0";o.keyword+=(r&&r!="")?r:"?"}return o},_setConditionMap_editable:function(r,p){var q;this.__call("_setConditionMap_editable",[r,p]);q=r.find('[name="type"]');q.val(p.type);if(p.type==f.ABSOLUTE){var o=p.keyword.match(/([0-9\+\-]*) ([0-9\+\-]*):([0-9\+\-]*):([0-9\+\-]*)/);q=r.find('[name="keyword_days"]');if(q&&o[1]){q.val(o[1])}q=r.find('[name="keyword_hours"]');if(q&&o[2]){q.val(o[2])}q=r.find('[name="keyword_minutes"]');if(q&&o[3]){q.val(o[3])}q=r.find('[name="keyword_seconds"]');if(q&&o[4]){q.val(o[4])}}this._updateView(r)},_setConditionMap_nonEditable:function(t,r){var u={"0":null,"1":"(値なし)","2":"(値なし以外)"};var o={"==":"と等しい","!=":"と等しくない","<=":"以下",">=":"以上","<":"より小さい",">":"より大きい"};var q="";var v="";if(r.type==f.ABSOLUTE){var p=r.keyword.match(/([0-9\+\-]*) ([0-9\+\-]*):([0-9\+\-]*):([0-9\+\-]*)/);if(p[1]){q+=p[1]+"日"}if(p[2]){q+=p[2]+"時間"}if(p[3]){q+=p[3]+"分"}if(p[4]){q+=p[4]+"秒"}v=o[r.method]}else{q=u[r.type];v=o[r.method]}var s;s=t.find(".filter_condition-method");s.text(v);s=t.find(".filter_condition-keyword");s.text(q)},hookCondition:function(o){element=o.find('[name="type"]');element.change(function(p){var q=o;return function(){p._onChangeType(q)}}(this));this._updateView(o)}}});var m=neo.webdb.Filter.SelectConditionManipulator=new neo.core.Class({superClass:j,properties:{getConditionMap:function(s){var r;var q=this.__call("getConditionMap",[s]);var o=s.find('[name="type"]');var u=s.find('[name="keyword"]');q.type=o.val();if(q.type==f.ABSOLUTE){q.keyword=u.val()}else{if(q.type.indexOf(f.SELECT_USERDEFINE+":")==0){var t=f.SELECT_USERDEFINE+":";var p=q.type.substring(t.length);q.type=f.SELECT_USERDEFINE;q.keyword=p}}return q},_setConditionMap_editable:function(r,p){var q;this.__call("_setConditionMap_editable",[r,p]);var o=r.find('[name="type"]');var s=r.find('[name="keyword"]');o.val(p.type);if(p.type==f.ABSOLUTE){s.val(p.keyword)}else{if(p.type==f.SELECT_USERDEFINE){o.val(p.type+":"+p.keyword)}}this._updateView(r)},_setConditionMap_nonEditable:function(p,o){this.__call("_setConditionMap_nonEditable",[p,o])},hookCondition:function(o){element=o.find('[name="type"]');element.change(function(p){var q=o;return function(){p._onChangeType(q)}}(this));this._updateView(o)}}});var i=neo.webdb.Filter.SelectsConditionManipulator=new neo.core.Class({superClass:j,properties:{getConditionMap:function(r){var q=this.__call("getConditionMap",[r]);var o=r.find('[name="type"]');var t=r.find('[name="keyword"]');q.type=o.val();if(q.type==f.ABSOLUTE){q.keyword=t.val()}else{if(q.type==f.SELECT_ALLUSERDEFINE){q.keyword=""}else{if(q.type.indexOf(f.SELECT_USERDEFINE+":")==0){var s=f.SELECT_USERDEFINE+":";var p=q.type.substring(s.length);q.type=f.SELECT_USERDEFINE;q.keyword=p}}}return q},_setConditionMap_editable:function(q,p){this.__call("_setConditionMap_editable",[q,p]);var o=q.find('[name="type"]');var r=q.find('[name="keyword"]');o.val(p.type);if(p.type==f.ABSOLUTE){r.val(p.keyword)}else{if(p.type==f.SELECT_ALLUSERDEFINE){}else{if(p.type==f.SELECT_USERDEFINE){o.val(p.type+":"+p.keyword)}}}this._updateView(q)},_setConditionMap_nonEditable:function(p,o){this.__call("_setConditionMap_nonEditable",[p,o])},hookCondition:function(o){element=o.find('[name="type"]');element.change(function(p){var q=o;return function(){p._onChangeType(q)}}(this));this._updateView(o)}}});var l=neo.webdb.Filter.UserConditionManipulator=new neo.core.Class({superClass:j,properties:{_userSelectDialog:null,_getUserSelectDialogSetting:function(r){var o=this;var q=this._getElSelectedUserName(r);var p={single:true,selectedUsers:[{id:"",name:q.text()}],selectedUserSearchByName:true,callbackOnChange:function(s){var t=s[0];if(t){q.text(t.name)}else{q.text(n)}}};return p},_getElSelectedUserName:function(o){return o.find("[name=username]")},getConditionMap:function(s){var p=this.__call("getConditionMap",[s]);var o=s.find('[name="type"]');var t=s.find('[name="keyword"]');var r=s.find('[name="method_1"]');var q=s.find('[name="method_2"]');p.type=o.val();if(p.type==f.USER_INPUTNAME){p.keyword=t.val();p.method=r.val()}else{if(p.type==f.USER_SELECTUSER){var u=this._getElSelectedUserName(s).text();p.keyword=u==n?"":u;p.method=q.val()}}return p},_setConditionMap_editable:function(t,p){this.__call("_setConditionMap_editable",[t,p]);var o=t.find('[name="type"]');var u=t.find('[name="keyword"]');var s=t.find('[name="method_1"]');var q=t.find('[name="method_2"]');var r=this._getElSelectedUserName(t);o.val(p.type);if(p.type==f.USER_INPUTNAME){u.val(p.keyword);s.val(p.method)}else{if(p.type==f.USER_SELECTUSER){if(p.keyword&&p.keyword!=""){r.text(p.keyword)}else{u.val("");r.text(n)}q.val(p.method)}}this._updateView(t)},_setConditionMap_nonEditable:function(s,p){var q;this.__call("_setConditionMap_nonEditable",[s,p]);var o=s.find('[name="type"]');var t=s.find(".filter_condition-keyword");q=s.find(".filter_condition-keyword");q.text(p.keyword);var r=p.type;if(p.type==f.USER_INPUTNAME){t.text(p.keyword)}else{if(p.type==f.USER_SELECTUSER){if(p.keyword&&p.keyword!=""){t.text(p.keyword)}else{t.text(n)}}}this._updateView(s)},hookCondition:function(q){o=q.find('[name="type"]');o.change(function(r){var s=q;return function(){r._onChangeType(s)}}(this));var o=q.find('[name="user-select_btn"]');var p=this._getUserSelectDialogSetting(q);this._userSelectDialog=neo.webdb.bindUserSelectDialog(o,p);this._updateView(q)}}});var c=neo.webdb.Filter.RelkeyConditionManipulator=new neo.core.Class({classProperties:{CHILD_CALL_BACK_FUNCK_NAME:"onChildWindowCallBackDecideRelKey",getCallBackFuncDecideRelKey:function(){var o=c.CHILD_CALL_BACK_FUNCK_NAME;if(!window[o]){window[o]=function(q){if(q&&q.windowId){var p=q.windowId;var r=c.getCallBackFuncs();if(r[p]){r[p](q)}}}}return window[o]},getCallBackFuncs:function(){c.getCallBackFuncDecideRelKey();var o=c.CHILD_CALL_BACK_FUNCK_NAME+"Funcs";if(!window[o]){window[o]={}}return window[o]},setCallBackFunc:function(o,p){var q=c.getCallBackFuncs();q[o]=p}},superClass:j,properties:{getConditionMap:function(q){var p;var o=this.__call("getConditionMap",[q]);p=q.find('[name="keyword"]');o.keyword=p.val();return o},_setConditionMap_editable:function(q,o){var p;this.__call("_setConditionMap_editable",[q,o]);p=q.find('[name="keyword"]');p.val(o.keyword);this._updateView(q)},_setConditionMap_nonEditable:function(p,o){this.__call("_setConditionMap_nonEditable",[p,o])},hookCondition:function(p){var o=p.find('[name="relkey-search_btn"]');this.__bind(o,"click","Search")},__bind:neo.jq.bindListener,onclickSearch:function(r){var s=h(arguments[arguments.length-1]);var q=s.closest(".filter_condition-keyword");var t=q.find('[name="relkey-reltid"]').val();var p=neo.webdb.newWindowId();url=neo.webdb.getMainUrl()+"?cmd=dbrecordsearchrelkey&init=1&sv_tid="+t+"&wid="+p;window.open(url,"_blank");var o=this;c.setCallBackFunc(p,function(w){var v=w.result.relKey;var u=q.find('[name="keyword"]');u.val(v);o._updateView(q)})}}})})(jQuery);