/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){a.extend(a.support,{inputEvent:typeof document.createElement("INPUT").oninput!="undefined"});a.extend(neo,{_testRegExpSplitResult:null,isSet:function(d,c){var b=typeof(d);var e=!!c?c:{};if(b=="undefined"){return !!e["undefined"]}else{if(d===null){return !!e["null"]}else{if(b=="number"&&isNaN(d)){return typeof e["NaN"]=="undefined"||!!e["NaN"]}else{if(d===0){return typeof e.zero=="undefined"||!!e.zero}else{if(d===""){return typeof e.blank=="undefined"||!!e.blank}else{if(d===false){return typeof e["false"]=="undefined"||!!e["false"]}}}}}}return true},supportStyle:function(b,e){var d=document.createElement("DIV").style;var g=["ms","Moz","webkit"];if(typeof d[b]!="undefined"){return this._supportStyleValue(d,b,e)}var f=b.replace(/^\w/,function(h){return h.toUpperCase()});for(var c=0;c<g.length;c++){if(typeof d[g[c]+f]!="undefined"){return this._supportStyleValue(d,g[c]+f,e)}}return false},regExpSplit:function(g,f,d){if(a.type(f)!="regexp"||this._testRegExpSplit()){return String(g).split(f,d)}var b=[],e=0,c=f.ignoreCase?"ig":"g";g.replace(new RegExp(f.source,c),function(h){var k=arguments[arguments.length-2];b.push(g.substring(e,k));for(var j=1;j<arguments.length-2;j++){b.push(arguments[j])}e=k+h.length});b.push(g.substring(e));if(typeof(d)=="number"&&d<b.length){b=b.slice(0,d)}return b},_supportStyleValue:function(c,b,e){if(typeof e!="undefined"&&e!==null){try{c[b]=e;return c[b]==e}catch(d){return false}}return true},_testRegExpSplit:function(){if(typeof this._testRegExpSplitResult!="boolean"){this._testRegExpSplitResult="a".split(/(a)/).length==3}return this._testRegExpSplitResult},decodeURIComponent:function(b){return decodeURIComponent(b.replace(/\+/g," "))},parseQueryString:function(d){var c=this,e={},b=d.split("&");a.each(b,function(g,j){var l=j.split("="),f,k,h;if(l.length>0&&l[0]!=""){f=c.decodeURIComponent(l[0]);k=l.length>1?c.decodeURIComponent(l[1]):null;h=a.type(e[f]);if(h=="array"){e[f].push(k)}else{if(h!="undefined"){e[f]=[e[f],k]}else{e[f]=k}}}});return e},});(function(b){neo.array={getKeyArray:function(e){var c=[];for(var d in e){c.push(d)}return c},getValueArray:function(e){var c=[];for(var d in e){c.push(e[d])}return c},remove:function(c,e,d){return this.subtract(c,[e],d)},subtract:function(c,e,d){var j=c.length;var g=[];var h=b.isFunction(d)?d:function(k,i){return k==i};for(var f=0;f<j;f++){if(!this._hasItemInv(c[f],e,h)){g.push(c[f])}}return g},_hasItemInv:function(f,c,d){var g=c.length;for(var e=0;e<g;e++){if(d(f,c[e])){return true}}return false}}})(jQuery);(function(b){neo.mailaddress={isAddrSpec:function(c){return !!c.match(/^[a-zA-Z0-9_!#\$\%&\x27*+/=?\^`{}~|\.\-]+@[a-zA-Z0-9_!#\$\%&\x27*+/=?\^`{}~|\.\-]+$/)},addToGroupInput:function(d,f){var c=this.parseMailGroup(d.val());var e=this.createMailGroup(b.merge(c,f));d.val(e)},createMailbox:function(c,d){if(typeof(c)=="string"&&c.length>0){if(typeof(d)=="string"&&d.length>0){return this._escapeName(c)+"<"+d+">"}else{return this._escapeName(c)}}else{return d}},createMailGroup:function(g,e){var c=this;var d="";var f=[];b.each(g,function(j,h){if(!!e||b.inArray(h.addr,f)<0){if(d.length>0){d+=","}d+=c.createMailbox(h.name,h.addr);f.push(h.addr)}});return d},parseMailbox:function(e){var c={name:"",addr:""};var d=this._parseMailbox(c,e,0);if(e.length==d&&this.isAddrSpec(c.addr)){return c}else{return null}},parseMailGroup:function(h,c,f){var j=[];var g=0;var i=0;var e=false;if(!neo.isSet(c)){c=true}if(!neo.isSet(f)){f=false}while(g<h.length){e=false;var d={name:"",addr:""};g=this._skipSpace(h,g);i=g;g=this._parseMailbox(d,h,g);g=this._skipSpace(h,g);if((g==h.length||h.charAt(g)==",")){if(c&&this.isAddrSpec(d.addr)||!c){j.push(d);e=true}}g=this._skipUntilNextComma(h,g);if(f&&!e){if(h.length!=g||h.charAt(h.length-1)==","){d.name=h.substring(i,g-1)}else{d.name=h.substring(i,g)}d.addr="";j.push(d)}}return j},_parseMailbox:function(c,e,d){if(e.charAt(d)=='"'){d=this._parseQuoted(c,e,d)}else{d=this._parseUnquoted(c,e,d)}d=this._skipSpace(e,d);if(d<e.length&&e.charAt(d)=="<"){d=this._parseAddrPart(c,e,d)}return d},_parseQuoted:function(d,g,e){var h=e+1;for(;;){var i=g.charAt(h);if(h>=g.length){break}else{if(i=='"'){var f=g.substring(e,h+1);d.name=this._unescapeName(f);h++;break}}if(i=="\\"){h++}h++}return h},_parseUnquoted:function(d,f,e){var g=e;for(;;){var h=f.charAt(g);if(g>=f.length||h==","){d.addr=b.trim(f.substring(e,g));break}else{if(h=="<"){d.name=b.trim(f.substring(e,g));break}else{if(h=='"'){break}}}g++}return g},_parseAddrPart:function(d,f,e){if(f.charAt(e)!="<"){return e}var g=e+1;for(;;){var h=f.charAt(g);if(g>=f.length){break}else{if(h==">"){d.addr=f.substring(e+1,g);g++;break}}g++}return g},_skipSpace:function(f,d){var e=d;while(e<f.length){var g=f.charAt(e);if(g!=" "&&g!="\t"&&g!="\r"&&g!="\n"){break}e++}return e},_skipUntilNextComma:function(f,d){var e=d;while(e<f.length&&g!=","){var g=f.charAt(e);if(g==","){e++;break}e++}return e},_escapeName:function(c){return'"'+c.replace(/([\x22\x5C])/g,"\\$1")+'"'},_unescapeName:function(d){var c=d.replace(/\x5C(.)/g,"$1");c=c.replace(/^\x22/,"");c=c.replace(/\x22$/,"");return c}}})(jQuery);neo.ajax={NEOAJAX_OBJJSON:"json",NEOAJAX_OBJXML:"xml",defaultOptions:{type:"POST",dataType:"xml"},_connections:{},_reserved:{},_numRequests:0,rest:function(b){var c=b.id;if(!!c&&!!this._connections[c]){this._addToReserved(c,b);return}this._execute(b)},submitForm:function(c,d){var b=this._getOptionsToSend(d);c.ajaxForm(b)},abort:function(c,b){if(b!==false&&!!this._reserved[c]){delete this._reserved[c]}if(!!this._connections[c]){this._connections[c].abort()}},getDataValue:function(d,c){if(!!d.responseXML){var b=a(d.responseXML).find(c);if(b.length>0){return b.text()}}else{try{return this._getJsonDataValue(a.parseJSON(d.responseText),c)}catch(e){}}},getErrorMessage:function(f,c){var e=!!f?parseInt(f.status):200;var b="",d="";if(e==0){b=String(f.statusText);d=neo.Resource.ajax[b+"_errorMessage"]}else{if(e>=400){b=String(f.status);d=neo.Resource.ajax[b+"_errorMessage"]}else{d=c}}if(typeof(d)=="string"){return d}return neo.Resource.ajax.errorMessage.replace("{{status}}",b)},_execute:function(b){var d=b.id;var c=a.ajax(this._getOptionsToSend(b));if(!!d){this._connections[d]=c}},_getOptionsToSend:function(e){var d=this;var c={};e.global=typeof(e.global)=="undefined"||!!(e.global);a.extend(c,this.defaultOptions,e);var b={global:false,beforeSend:function(g,f){d._onBeforeSend(g,f,c)},success:function(g,f,h){d._parse(g,f,h,c)},error:function(h,f,g){d._onError(h,f,g,c)},complete:function(g,f){d._onComplete(g,f,c)}};return a.extend({},c,b)},_parse:function(d,b,e,c){if(c.dataType=="json"){this._parseJson(d,b,e,c)}else{if(c.dataType=="html"){this._parseHtml(d,b,e,c)}else{this._parseXml(d,b,e,c)}}},_parseXml:function(e,b,h,d){var f=a(e.documentElement);if(f.is("parsererror")){d._dataStatus="parsererror";this._onError(h,"parsererror",f.find("parsererror").text(),d)}else{if(f.find("status").eq(0).text()=="ok"){this._onSuccess(e,b,h,d)}else{var c=f.find("errorno").eq(0).text();if(a.isFunction(d.errorconvmsg)){var g=d.errorconvmsg(this.NEOAJAX_OBJXML,f)}else{g=f.find("errormessage").eq(0).text()}this._parseErrorData(c,g,b,h,d)}}},_parseJson:function(f,b,g,d){var c=this._getSingleJsonError(f,d);if(!!c){this._parseErrorData(c.errorno,c.message,b,g,d);return}if(!!d.detectMultiError){for(var e=0;!!f[e.toString()];e++){var c=this._getSingleJsonError(f[e.toString()],d);if(!!c){this._parseErrorData(c.errorno,c.message,b,g,d);return}}}this._onSuccess(f,b,g,d)},_parseHtml:function(c,b,e,d){this._onSuccess(c,b,e,d)},_parseErrorData:function(e,d,b,h,c){var g=parseInt(e);var f=(typeof(d)=="string")?d:"";if(a.fn.jquery>="1.5"&&g<0){h.status=g}this._onError(h,b,f,c)},_getSingleJsonError:function(d,c){if(d==null){return{errorno:0,message:""}}else{if(d.status=="ok"){return null}else{var b=d.errorno;var e=d.errormessage;if(a.isFunction(c.errorconvmsg)){var e=c.errorconvmsg(this.NEOAJAX_OBJJSON,d)}return{errorno:b,message:e}}}},_onBeforeRequest:function(b){if(b.global&&this._numRequests<=0){a(document).trigger("ajaxStart")}this._numRequests++},_onAfterRequest:function(b){this._numRequests--;if(b.global&&this._numRequests<=0){a(document).trigger("ajaxStop")}if(!!b.id){this._startNextReserved(b.id)}},_addToReserved:function(c,b){if(!this._reserved[c]){this._reserved[c]=[b]}else{this._reserved[c].push(b)}},_startNextReserved:function(d){var c=this;if(!!c._connections[d]){delete c._connections[d]}if(!!c._reserved[d]){var b=c._reserved[d].shift();if(c._reserved[d].length<=0){delete c._reserved[d]}setTimeout(function(){c._execute(b)},0)}},_onBeforeSend:function(d,c,b){this._onBeforeRequest(b);if(a.isFunction(b.beforeSend)){b.beforeSend(d,c)}if(b.global){a(document).trigger("ajaxSend",[d,c])}},_onSuccess:function(d,b,e,c){if(a.isFunction(c.success)){c.success(d,b,e)}if(c.global){a(document).trigger("ajaxSuccess",[e,c])}},_onError:function(f,b,d,c){var e=this.getErrorMessage(f,d);if(a.isFunction(c.error)){c.error(f,b,e)}if(c.global){a("body").trigger("ajaxError",[f,c,e])}},_onComplete:function(d,b,c){if(c._dataStatus){b=c._dataStatus}if(a.isFunction(c.complete)){c.complete(d,b)}if(c.global){a(document).trigger("ajaxComplete",[d,c])}this._onAfterRequest(c)},_getJsonDataValue:function(e,d){var c=0,b=e;while(typeof b=="object"){var f=b[d];if(typeof f!="undefined"){return f}b=e[c.toString()];c++}}};neo.dateTime={parse:function(d){d=String(d);for(var c=0;c<this._parsers.length;c++){var b=this._parsers[c].apply(this,[d]);if(b!=null){return b}}return null},format:function(g,c){var b="";var h=false;var e=a.extend({},this._formatter,{date:!!c?c:new Date()});for(var d=0;d<g.length;d++){var f=g.charAt(d);if(f=="'"){h=!h;b+=h?e.beginLiteral():e.endLiteral()}else{if(h){e.leteral+=f}else{if(!e.isSymbol(f)){b+=e.getCurrentToken()+f}else{if(f!=e.symbolChar){b+=e.beginSymbol(f)}else{e.symbolLength++}}}}}b+=e.getCurrentToken();return b},compareOn:function(f,e,d){var g={year:function(h){return h.getFullYear()},month:function(h){return h.getMonth()},day:function(h){return h.getDate()},hour:function(h){return h.getHours()},minute:function(h){return h.getMinutes()},second:function(h){return h.getSeconds()}};for(var c in g){var b=g[c](f)-g[c](e);if(b!=0){return b/Math.abs(b)}if(d==c){break}}return 0},moveDate:function(c,d){var b=new Date(c.getTime());b.setDate(c.getDate()+d);return b},moveMonth:function(d,h){var b=d.getFullYear()*12+d.getMonth()+h;var e=Math.floor(b/12);var g=b%12;var c=d.getDate();var f=this.getMonthEndDay(e,g+1);return new Date(e,g,Math.min(c,f))},getDaysGap:function(e,d){var c=new Date(e.getFullYear(),e.getMonth(),e.getDate(),12);var b=new Date(d.getFullYear(),d.getMonth(),d.getDate(),12);return Math.round((b.getTime()-c.getTime())/86400000)},getMonthEndDay:function(b,d){var c=new Date(b,d,0);return c.getDate()},_parseFromComponents:function(g){var f=neo.isSet(g[0],{blank:false})?Number(g[0]):1970;var h=neo.isSet(g[1],{blank:false})?Number(g[1]):1;var c=neo.isSet(g[2],{blank:false})?Number(g[2]):1;var b=neo.isSet(g[3],{blank:false})?Number(g[3]):0;var i=neo.isSet(g[4],{blank:false})?Number(g[4]):0;var e=neo.isSet(g[5],{blank:false})?Number(g[5]):0;var d=new Date(f,h-1,c,b,i,e,0);return isNaN(d.getTime())?null:d},_parsers:[function(e){var g=0,b=4,f=[1970,1,1,0,0,0];for(var d=0;d<6&&g<e.length;d++){var c=Number(e.substring(g,b));if(isNaN(c)){return null}f[d]=c;g=b;b+=2}if(g>=6){return new Date(f[0],f[1]-1,f[2],f[3],f[4],f[5],0)}return null},function(b){var c=b.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!!c&&c.length>=4){return this._parseFromComponents(c.slice(1))}return null}],_formatter:{symbolChar:"",symbolLength:0,leteral:"",beginSymbol:function(c){var b=this.getCurrentToken();this.symbolChar=c;this.symbolLength=1;return b},beginLiteral:function(){var b=this.getCurrentToken();return b},endLiteral:function(){var b=this.leteral.length>0?this.leteral:"'";this.leteral="";return b},getCurrentToken:function(){var d=this.symbolChar;var b=this.symbolLength;this.symbolChar="";this.symbolLength=0;return this.isSymbol(d)?this[d](b):""},isSymbol:function(b){return typeof(b)=="string"&&b.length==1&&a.isFunction(this[b])},y:function(b){if(b<=2){return this._zeroPad(this.date.getYear()%100,b)}else{return this._zeroPad(this.date.getFullYear(),b)}},M:function(b){var c=this.date.getMonth()+1;if(b<=2){return this._zeroPad(c,b)}else{if(b==3){return neo.Resource.dateTime.shortMonthes[c-1]}else{return neo.Resource.dateTime.longMonthes[c-1]}}},d:function(c){var b=this.date.getDate();return this._zeroPad(b,c)},E:function(c){var b=this.date.getDay();if(c<=3){return neo.Resource.dateTime.shortWeeks[b]}else{return neo.Resource.dateTime.longWeeks[b]}},a:function(b){var c=(this.date.getHours()<12)?0:1;return neo.Resource.dateTime.periods[c]},h:function(c){var b=((this.date.getHours()+11)%12)+1;return this._zeroPad(b,c)},H:function(c){var b=this.date.getHours();return this._zeroPad(b,c)},K:function(c){var b=((this.date.getHours()+11)%12);return this._zeroPad(b,c)},k:function(c){var b=this.date.getHours()+1;return this._zeroPad(b,c)},m:function(b){var c=this.date.getMinutes();return this._zeroPad(c,b)},s:function(c){var b=this.date.getSeconds();return this._zeroPad(b,c)},_zeroPad:function(c,b){var d=c.toString();while(d.length<b){d="0"+d}return d}}};neo.html={convertToSafeHtml:function(c,b){var e=a.extend({deniedTags:["SCRIPT"],allowedFrameUri:[],allowedSchemas:["http","https"]},b);var d=document.createElement("DIV");d.innerHTML=c;this._updateToSafeChildren(d,e);return d.innerHTML},_updateToSafeChildren:function(d,b){for(var c=d.childNodes.length-1;c>=0;c--){var e=d.childNodes[c];if(e.nodeType==1){this._updateToSafeElement(e,b)}}},_updateToSafeElement:function(c,b){var d=["FRAME","FRAMESET","LINK","META"];a.each(b.deniedTags,function(f,e){d.push(e.toUpperCase())});if(a.inArray(c.tagName,d)>=0){c.parentNode.removeChild(c)}else{if(c.tagName=="IFRAME"&&!this._isSafeUrl(c.src,b.allowedFrameUri)){c.parentNode.removeChild(c)}else{if(c.tagName=="STYLE"){c.innerHTML=this._convertToSafeStyle(c.innerHTML,b)}else{this._updateToSafeAttributes(c,b);this._updateToSafeChildren(c,b)}}}},_updateToSafeAttributes:function(e,c){for(var d=e.attributes.length-1;d>=0;d--){var b=e.attributes[d];this._updateToSafeAttribute(e,e.attributes[d],c)}},_updateToSafeAttribute:function(e,b,d){var c=String(b.name).toLowerCase();if(c.indexOf("on")==0){e.removeAttribute(c)}else{if(c=="style"){b.value=this._convertToSafeStyle(String(b.value),d)}else{if(a.inArray(c,["href","src","data","code"])>=0){b.value=this._convertToSafeUri(String(b.value),d)}}}},_convertToSafeStyle:function(d,c){var b=this;return d.replace(/url\s*\((.*?)\)/g,function(f,e){e=b._removeQuote(a.trim(e));return b._isSafeUrlSchema(e,["http","https"])?f:"none"})},_convertToSafeUri:function(c,b){return this._isSafeUrlSchema(c,b.allowedSchemas)?c:"about:blank"},_removeQuote:function(d){var c=d.charAt(0);var b=d.charAt(d.length-1);if(c==b&&(c=="'"||c=='"')){return d.substring(1,d.length-1)}return d},_isSafeUrl:function(c,d){for(var b=0;b<d.length;b++){if(c.indexOf(d[b])==0){return true}}return false},_isSafeUrlSchema:function(c,b){var d=c.match(/^(\w+):/);return !d||a.inArray(d[1],b)>=0}};a.widget("neo.neoDateNav",{widgetEventPrefix:"datenav",options:{date:null,dateLabels:".neo-time",buttons:'a, input[type="button"], button[type="button"]',eventWait:0},_changeTimer:null,_notifyDate:true,_lastNotifiedDate:"",_create:function(){var b=this;if(!this.options.date){this.options.date=new Date()}b._lastNotifiedDate=neo.dateTime.format("yyyy-MM-dd",this.options.date);b._updateDateLabels();b.element.delegate(b.options.buttons,"click",function(d){var c=b._getDateWithText(a(this).data("date"));if(!!c){d.preventDefault();if(!b.options.disabled){b._setDate(c,d)}}})},destroy:function(){this.element.undelegate(this.options.buttons,"click")},date:function(b){if(!!b){this._setDate(b,null)}else{return this.options.date}},suspendEvent:function(){this._notifyDate=false},resumeEvent:function(){this._notifyDate=true;this._triggerChange(null)},_setDate:function(c,d){var b=new Date(c.getFullYear(),c.getMonth(),c.getDate());if(neo.dateTime.compareOn(this.options.date,b,"day")!=0){this.options.date=b;this._updateDateLabels();this._beginToTriggerChange(d)}},_beginToTriggerChange:function(c){var b=this;if(b.options.eventWait<=0){b._triggerChange(c)}else{if(!!b._changeTimer){clearTimeout(b._changeTimer)}b._changeTimer=setTimeout(function(){b._triggerChange(null)},b.options.eventWait)}},_triggerChange:function(b){var e=this.options.date;var c=neo.dateTime.format("yyyy-MM-dd",e);if(this._notifyDate&&this._lastNotifiedDate!=c){this._trigger("change",b,{date:e});this._lastNotifiedDate=c}},_getDateWithText:function(d){var b=new Date(),c;if(d=="today"){return b}if(d=="thisMonth"){return new Date(b.getFullYear(),b.getMonth(),1)}c=neo.dateTime.parse(d);if(!!c){return c}c=this._getRelativeDate(d);if(!!c){return c}return null},_updateDateLabels:function(){var b=this;this.element.find(this.options.dateLabels).each(function(){var e=a(this);var c=b._getRelativeDate(e.data("gap"));var d=e.data("format")||"yyyy-MM-dd";c=!!c?c:b.options.date;e.text(neo.dateTime.format(d,c))})},_getRelativeDate:function(b){var c;if(typeof b=="number"){return this._getRelativeDateWithParams(b,"d")}else{if(typeof b=="string"){c=b.match(/^([+-]?\d+)(\w?)$/);if(a.isArray(c)&&c.length>=2){return this._getRelativeDateWithParams(Number(c[1]),String(c[2]))}}}return null},_getRelativeDateWithParams:function(c,b){if(b=="m"){return neo.dateTime.moveMonth(this.options.date,c)}else{return neo.dateTime.moveDate(this.options.date,c)}}})})(jQuery);