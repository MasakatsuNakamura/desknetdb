/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.creport={MODULE_API_CREPORT:"zrcreport",MODULE_MAIN_CREPORT:"zcreport",CMD_CREPORTINDEX:"creportcmdindex",CMD_CREPORTLISTREAD:"creportcmdnoticeread",CMD_CREPORTLISTUNREAD:"creportcmdnoticeunread",CMD_CREPORTLISTCHECK:"creportcmdnoticecheck",CMD_CREPORTLISTDEL:"creportcmdnoticedel",CMD_CREPORTROUTE:"creportcmdroute",CMD_CREPORTCOMMENTENTRY:"creportcmdcomment",CMD_CREPORTLISTMOVE:"creportcmdnoticemove",CMD_CREPORTDISP:"creportcmddisp",CMD_CREPORTFINISH:"creportcmdfinish",CMD_CREPORTCOMMENTENTRY:"creportcmdcomment",CMD_CREPORTTAG:"creportcmdtag",CMD_CREPORTREFATTACH:"creportcmddispattach",CMD_CREPORTCOMMENTATTACHREF:"creportcmdcommentattachdisp",CMD_CREPORTUSERFOLDERLISTCHILD:"creportcmduserfolderlistchild",CMD_CREPORT_RTEATTACH:"creportrteattach",CMD_CREPORT_RTEATTACHPRI:"creportprirteattach",CMD_CREPORTMSET_RTEATTACH:"creportmsetrteattach",RECV_FOLDER_ID:"-1",SEND_FOLDER_ID:"-2",DRAFT_FOLDER_ID:"-3",DUST_FOLDER_ID:"-4",MY_ROOT_FOLDER_ID:"-5"};desknets.sp.creport={CMD_CREPORT_NOTICEINDEX:"creportcmdindex",init:function(){desknets.sp.mobjPages["creportlist-page"]=desknets.sp.creport.CReportList;desknets.sp.mobjPages["creportref-page"]=desknets.sp.creport.CReportRef;desknets.sp.mobjPages["creportfolder-page"]=desknets.sp.creport.CReportFolder;desknets.sp.mobjPages["creportcomment-page"]=desknets.sp.creport.CReportComment;desknets.sp.mobjPages["d-creportconf-page"]=desknets.sp.creport.CReportConf;desknets.sp.mobjPages["d-creportcomplete-page"]=desknets.sp.creport.CReportComplete;desknets.sp.mobjPages["d-creportunread-page"]=desknets.sp.creport.CReportUnread;desknets.sp.mobjPages["d-creportread-page"]=desknets.sp.creport.CReportRead;desknets.sp.mobjPages["d-creportdel-page"]=desknets.sp.creport.CReportDel;desknets.sp.mobjPages["d-creportcomment-page"]=desknets.sp.creport.CReportCommentEntry;desknets.sp.mobjPages["d-creporttag-page"]=desknets.sp.creport.CReportTag;desknets.sp.mobjPages["neotwi-page"]=desknets.sp.Neotwi;var c=[];var b=desknets.sp.getPrm();if(neo.isSet(b.id)){c=["creportref-page"]}desknets.sp.initSetEvents(c)},getRequestURL:function(){return desknets.sp.getUrl("zrcreport")}};desknets.page(desknets.sp.creport,"CReportList",desknets.sp.ListSetPage,{msFolder:desknets.creport.RECV_FOLDER_ID,msFolderName:"",mboProcConfirm:false,$_TmplSend:null,init:function(c){var b=this;b.callBase("init",c);b.$_TmplSend=b.$listElement.children(".jco-list-tmpl-send").removeClass("jco-list-tmpl-send").remove();b.$mRootElement.find(".jcreport-btn-recv").on("vclick",function(d){d.preventDefault();b.msFolder=desknets.creport.RECV_FOLDER_ID;b.reload()});b.$mRootElement.find(".jcreport-btn-sent").on("vclick",function(d){d.preventDefault();b.msFolder=desknets.creport.SEND_FOLDER_ID;b.reload()});b.$mRootElement.find(".jcreport-btn-conf").on("vclick",function(e){e.preventDefault();b.mboProcConfirm=true;var d=b.getChkId(true);b.mboProcConfirm=false;if(d!==false){desknets.sp.creport.CReportConf.setPage(d);desknets.sp.changePage("d-creportconf")}});b.$mRootElement.find(".jcreport-btn-unread").on("vclick",function(e){e.preventDefault();b.mboProcConfirm=false;var d=b.getChkId(false);if(d!==false){desknets.sp.creport.CReportUnread.setPage(d);desknets.sp.changePage("d-creportunread")}else{b._listChgClick()}});b.$mRootElement.find(".jcreport-btn-read").on("vclick",function(e){e.preventDefault();b.mboProcConfirm=false;var d=b.getChkId(false);if(d!==false){desknets.sp.creport.CReportRead.setPage(d);desknets.sp.changePage("d-creportread")}else{b._listChgClick()}});b.$mRootElement.find(".jcreport-btn-del").on("vclick",function(e){e.preventDefault();var d=b.getChkId(true);if(d!==false){desknets.sp.creport.CReportDel.setPage(d,b.msFolder,true);desknets.sp.changePage("d-creportdel")}});b.$mRootElement.find(".jcreport-btn-proc").on("vclick",function(d){d.preventDefault();if(b.msFolder==desknets.creport.RECV_FOLDER_ID||b.msFolder==desknets.creport.SEND_FOLDER_ID){desknets.sp.creport.CReportFolder.invalidate()}desknets.sp.changePage("creportfolder")})},getListRequestURL:function(){return desknets.sp.creport.getRequestURL()},getListRequestData:function(d,e){var b=this;if(b.msFolder==""){b.msFolder=desknets.creport.RECV_FOLDER_ID}var c={cmd:desknets.sp.creport.CMD_CREPORT_NOTICEINDEX,row:d,num:e,folder:b.msFolder,fldsort:"entrydate",order:"-1"};return c},getAjaxId:function(){return"dnsp-creportlist"},clearItems:function(){var b=this;b.callBase("clearItems");if(b.$mRootElement!=null){b.$mRootElement.find(".jcreport-list-new").hide();b.$mRootElement.find(".jcreport-list-sent").hide();b.$mRootElement.find(".jcreport-list-proc").hide();b.$mRootElement.find(".jcreport-list-new-set").hide();b.$mRootElement.find(".jcreport-list-sent-set").hide();b.$mRootElement.find(".jco-back").hide()}},executeOnItemsGot:function(f,g,e){var d=this;var c=0;var b="";c=f.allcnt;if(d.msFolder==desknets.creport.RECV_FOLDER_ID){b=desknets.Resource.creport.trayNew;if(d.mboSet){d.$mRootElement.find(".jcreport-list-new-set").show();d.$mRootElement.find(".co-list-folder").removeClass("_new")}else{d.$mRootElement.find(".jcreport-list-new").show();d.$mRootElement.find(".co-list-folder").addClass("_new");d.$mRootElement.find(".jco-back").hide()}}else{if(d.msFolder==desknets.creport.SEND_FOLDER_ID){b=desknets.Resource.creport.traySent;if(d.mboSet){d.$mRootElement.find(".jcreport-list-sent-set").show()}else{d.$mRootElement.find(".jcreport-list-sent").show();d.$mRootElement.find(".jco-back").hide()}d.$mRootElement.find(".co-list-folder").removeClass("_new")}else{b=d.msFolderName;if(d.mboSet){d.$mRootElement.find(".jcreport-list-sent-set").show()}else{d.$mRootElement.find(".jcreport-list-proc").show()}d.$mRootElement.find(".co-list-folder").removeClass("_new")}}b=b+"("+c+")";d.$mRootElement.find(".co-subtitle").text(b);if(d.msFolder!=desknets.creport.RECV_FOLDER_ID&&d.msFolder!=desknets.creport.SEND_FOLDER_ID){if(!d.mboSet){d.$mRootElement.find(".jco-back").show()}}d.callBase("executeOnItemsGot",f,g,e)},addListElementsTmpl:function(){var b=this;if(b.mboSet){if(b.msFolder==desknets.creport.SEND_FOLDER_ID){return b.$_TmplSend.clone()}else{return b.$_Tmpl.clone()}}if(b.msFolder==desknets.creport.SEND_FOLDER_ID){return b.$_TmplSend.clone()}return b.$_Tmpl.clone()},setUpListItem:function(i,e){var d=this;var b="creportlistid";this.callBase("setUpListItem",i,e);var c="";if(i.important=="1"){e.find(".co-importance.high").remove();e.find(".co-importance.low").remove()}else{if(i.important=="2"){e.find(".co-importance.haste").remove();e.find(".co-importance.low").remove()}else{if(i.important=="4"){e.find(".co-importance.haste").remove();e.find(".co-importance.high").remove()}else{e.find(".co-importance").remove()}}}e.find("h3").append(c+desknets.tmpl.escapeWord(i.subject));if(d.msFolder==desknets.creport.SEND_FOLDER_ID){e.find(".jcreport-list-entry").html("&nbsp;")}else{if(d.msFolder==desknets.creport.RECV_FOLDER_ID){e.find(".jcreport-list-entry").html(desknets.tmpl.escapeWord(i.fromname))}else{e.find(".jcreport-list-entry").html(desknets.tmpl.escapeWord(i.entryname))}}if(!d.mboSet){var h="";if(d.msFolder!=desknets.creport.RECV_FOLDER_ID&&d.msFolder!=desknets.creport.SEND_FOLDER_ID){h=desknets.dateTime.dispListDateTime("date",i.entrydate)}else{h=desknets.dateTime.dispDateTime(i.period,{type:"list"});var f=i.perioddays;var g=i.periodalert=="1";if(!neo.isSet(f,{blank:false})){}else{if(f=="0"){h+=" ";if(g){h+='<span class="creport-closedate-alert">'}h+="("+desknets.Resource.creport.byToday+")";if(g){h+="</span>"}}else{h+=" ";if(g){h+='<span class="creport-closedate-alert">'}h+="("+f+desknets.Resource.creport.daySymbol+")";if(g){h+="</span>"}}}}e.find(".co-li-time").html(h);if(i.unread=="1"){e.addClass("new")}}e.find("input[type=checkbox]").attr("id",b+i.id);e.find("label").attr("for",b+i.id)},openListItem:function(c,e){var b=this;if(b.mboSet){}else{c.removeClass("new");var d=false;if(b.msFolder=="-1"){d=true}desknets.sp.creport.CReportRef.setPage(e,d);desknets.sp.changePage("creportref")}},setPage:function(d,c){var b=this;b.msFolder=d;b.msFolderName=c},getNoChkMsg:function(){var b=this;if(b.mboProcConfirm){return desknets.Resource.Message.creport_check_nochecked}else{return desknets.Resource.Message.creport_check_nocheckeddel}},_listChg:function(){var b=this;b.callBase("_listChg");if(b.$mRootElement!=null){b.$mRootElement.find(".jcreport-list-new").hide();b.$mRootElement.find(".jcreport-list-sent").hide();b.$mRootElement.find(".jcreport-list-proc").hide();b.$mRootElement.find(".jcreport-list-new-set").hide();b.$mRootElement.find(".jcreport-list-sent-set").hide()}if(b.msFolder==desknets.creport.RECV_FOLDER_ID){if(b.mboSet){b.$mRootElement.find(".jcreport-list-new-set").show()}else{b.$mRootElement.find(".jcreport-list-new").show();b.$mRootElement.find(".jco-back").hide()}}else{if(b.msFolder==desknets.creport.SEND_FOLDER_ID){if(b.mboSet){b.$mRootElement.find(".jcreport-list-sent-set").show()}else{b.$mRootElement.find(".jcreport-list-sent").show();b.$mRootElement.find(".jco-back").hide()}}else{if(b.mboSet){b.$mRootElement.find(".jcreport-list-sent-set").show()}else{b.$mRootElement.find(".jcreport-list-proc").show()}}}}});desknets.page(desknets.sp.creport,"CReportRef",desknets.sp.RefPage,{mboNew:false,msEntryId:"",msTag:"",msStatus:"",initPage:function(){var b=this;b.callBase("initPage");if(!neo.isSet(b.msId,{blank:false})){var c=desknets.sp.getPrm();if(neo.isSet(c.id)){b.setPage(c.id,true)}else{desknets.sp.resetPage()}}b.$mRootElement.find(".jcreport-ref-recvconf").on("vclick",function(d){d.preventDefault();desknets.sp.creport.CReportCommentEntry.invalidate();desknets.sp.creport.CReportCommentEntry.setPage(b.msId,desknets.sp.getLoginUid());desknets.sp.changePage("d-creportcomment")});b.$mRootElement.find(".jcreport-ref-refcomment").on("vclick",function(d){d.preventDefault();desknets.sp.creport.CReportComment.setPage(b.msId,b.msEntryId,b.msStatus,false);desknets.sp.changePage("creportcomment")});b.$mRootElement.find(".jcreport-ref-refnewcomment").on("vclick",function(d){d.preventDefault();desknets.sp.creport.CReportComment.setPage(b.msId,b.msEntryId,b.msStatus,true);desknets.sp.changePage("creportcomment")});b.$mRootElement.find(".jcreport-tag").on("vclick",function(d){d.preventDefault();desknets.sp.creport.CReportTag.setPage(b.msId,b.msTag);desknets.sp.changePage("d-creporttag")})},setPage:function(d,c){var b=this;b.mboNew=c;b.msId=d;b.invalidate()},getReferRequestURL:function(){return desknets.sp.creport.getRequestURL()},getReferRequestData:function(){var b=this;var c={cmd:desknets.creport.CMD_CREPORTDISP,id:b.msId};return c},clearItems:function(){var b=this;b.callBase("clearItems");b.$mRootElement.find(".jcreport-ref-recv").hide();b.$mRootElement.find(".jcreport-ref-sent").hide();b.$mRootElement.find(".jcreport-ref-mysent").hide();b.$mRootElement.find(".jcreport-info-upd").hide()},setUpReferItem:function(g){var b=this;b.msTag=g.tagcolor;b.$mRootElement.find(".co-importance").hide();if(g.important=="1"){b.$mRootElement.find(".co-importance.haste").show()}else{if(g.important=="2"){b.$mRootElement.find(".co-importance.high").show()}else{if(g.important=="4"){b.$mRootElement.find(".co-importance.low").show()}}}b.setUpText(".jcreport-subject",g.subject);if(neo.isSet(g.memo,{blank:false})){var e=g.memo;e=desknets.tmpl.replaceWordHtml(e,"cmd",desknets.creport.CMD_CREPORT_RTEATTACH);var i=new RegExp('src="zcreport.',"ig");e=e.replace(i,'src="'+desknets.sp.MODULE_MAIN+".");i=new RegExp('href="zcreport.',"ig");e=e.replace(i,'href="'+desknets.sp.MODULE_MAIN+".");var h="cmd="+desknets.creport.CMD_CREPORT_RTEATTACH;e=desknets.sp.getAttachUrlDel(h,e);var h="cmd=creportcmddispattachformat";e=desknets.sp.getAttachUrlDel(h,e);var f=new RegExp('src="/'+desknets.DIR_RESHOME+"/","ig");e=e.replace(f,'src="'+desknets.sp.msTemplatePath);e=desknets.convertToSafeHtml(desknets.rte.convertForShow(e));var d=b.$mRootElement.find(".co-content");d.html(e);desknets.sp.setUpMailLink(d)}else{b.$mRootElement.find(".co-content").html("")}b.setUpText(".jcreport-info-makename",g.makename);b.setUpText(".jcreport-info-entry",g.entryname);b.setUpDate(".jcreport-info-cretime",g.cretime);if(neo.isSet(g.updtime,{blank:false})){b.setUpDate(".jcreport-info-updtime",g.updtime);b.$mRootElement.find(".jcreport-info-upd").show()}var c={cmd:desknets.creport.CMD_CREPORTREFATTACH,id:b.msId};b.setUpFile(".jcreport-attach",g.attach,c);if(g.sts=="4"||g.sts=="6"){b.$mRootElement.find(".jcreport-ref-sent").show()}else{if(g.entryid==desknets.sp.getLoginUid()){if(b.mboNew){b.$mRootElement.find(".jcreport-ref-mysent").show()}else{b.$mRootElement.find(".jcreport-ref-sent").show()}}else{b.$mRootElement.find(".jcreport-ref-recv").show()}}b.msEntryId=g.entryid;b.msStatus=g.sts}});desknets.page(desknets.sp.creport,"CReportComment",desknets.sp.ListPage,{mboNew:false,msId:"",msEntryId:"",msStatus:"",$_TmplName:null,$_TmplPost:null,$_TmplReadMore:null,init:function(c){var b=this;b.callBase("init",c);b.$_TmplName=b.$listElement.children(".jcreport-cmtlist-name-tmpl").removeClass("jcreport-cmtlist-name-tmpl").remove();b.$_TmplPost=b.$_Tmpl.find(".jcreport-list-tmpl-post").removeClass(".jcreport-list-tmpl-post").remove();b.$_TmplReadMore=b.$_Tmpl.find(".jcreport-list-tmpl-readmore").removeClass(".jcreport-list-tmpl-readmore").remove();b.$mRootElement.find(".co-list-folder").delegate(".creport-ref-comment","vclick",function(e){e.preventDefault();var d=a(this).closest("li").data("uid");desknets.sp.creport.CReportCommentEntry.invalidate();desknets.sp.creport.CReportCommentEntry.setPage(b.msId,d);desknets.sp.changePage("d-creportcomment")});b.$mRootElement.find(".jcreport-ref-conf").on("vclick",function(d){d.preventDefault();desknets.sp.creport.CReportCommentEntry.invalidate();desknets.sp.creport.CReportCommentEntry.setPage(b.msId,desknets.sp.getLoginUid());desknets.sp.changePage("d-creportcomment")});b.$mRootElement.find(".jco-list-itemdata").delegate("li","vclick",function(d){var e=a(this);if(!e.hasClass("ui-li-divider")&&!(d.target.nodeName=="A"||d.target.nodeName=="a")&&a(d.target).closest(".creport-ref-comment").length==0){$btn=e.find(".creport-ref-comment");if($btn.length>0){if($btn.css("display")=="none"){a(".creport-ref-comment").hide();$btn.show()}else{$btn.hide()}}}})},showing:function(){var b=this;b.callBase("showing");if(b.mboNew){b.$mRootElement.find(".co-bar-msg").html(b.$mRootElement.find(".jcreport-title-newcmt").html())}else{b.$mRootElement.find(".co-bar-msg").html(b.$mRootElement.find(".jcreport-title-cmt").html())}},getListRequestURL:function(){return desknets.sp.creport.getRequestURL()},getListRequestData:function(d,e){var b=this;var c={cmd:desknets.creport.CMD_CREPORTROUTE,id:b.msId,row:d,num:e};if(b.mboNew){c.filter="recv"}return c},getAjaxId:function(){return"dnsp-creportcmtlist"},clearItems:function(){var b=this;b.callBase("clearItems");if(b.$mRootElement!=null){b.$mRootElement.find(".jcreport-ref-sent").hide();b.$mRootElement.find(".jcreport-ref-recv").hide()}},addListElements:function(i,c){var b=this;var h=(c=="prepend")?b.$listElement.children(":first-child"):b.$listElement;var e=(c=="prepend")?"insertBefore":"appendTo";var d=i.length;for(var g=0;g<d;g++){var f=null;f=b.$_TmplName.clone();f[e](h);b.setUpListItem(i[g],f)}b.$listElement.enhanceWithin()},setUpListItem:function(g,m){var n=this;var i="";var b="creportlistid";this.callBase("setUpListItem",g,m);m.html(desknets.tmpl.escapeWord(g.uname));i=g.uid;var j=n.getCommentItems(g.comments);var c=j.length;var k=m;var e=n.$_Tmpl.clone();e.data("uid",i);if(n.msEntryId!=desknets.sp.getLoginUid()||n.msStatus=="4"||n.msStatus=="6"){e.find(".creport-ref-comment").remove()}if(c>0){e.insertAfter(k);n.setUpListItemComment(j[c-1],i,e);if(c>1){var d=a('<div id="jcreport-cmtlist" data-role="collapsible" data-collapsed="true" />');d.insertBefore(e.find("p:first"));var h=n.$_TmplReadMore.clone();k=h.find("ul");for(var l=0;l<c-1;l++){var f=null;f=n.$_TmplPost.clone();f.appendTo(k);n.setUpListItemComment(j[l],i,f)}d.append(a(h.html()));e.find("#jcreport-cmtlist").find("ul").listview().listview("refresh");e.find("#jcreport-cmtlist").collapsible();e.find("#jcreport-cmtlist").find("h3").on("vclick",function(o){a(this).closest("div").collapsible("expand")})}}else{e.find(".jcreport-comment-memo").html(desknets.Resource.creport.dataUnConfirm);e.find(".jcreport-comment-date").remove();e.addClass("unread");e.insertAfter(k)}},getCommentItems:function(b){if(!b){return[]}else{if(!a.isArray(b)){return[b]}else{return b}}},setUpListItemComment:function(g,f,c){var b=this;var h="";var e="";e=desknets.tmpl.escapeWordLF(g.memo);desknets.sp.attachDisp.boDelimitedBr=true;var d=desknets.sp.attachDisp.disp(g.attach,desknets.sp.MODULE_MAIN,{cmd:desknets.creport.CMD_CREPORTCOMMENTATTACHREF,id:b.msId,rid:g.uid,nid:g.id});if(typeof(d)=="string"&&d.length>0&&d!="&nbsp;"){e=e+"<BR />"+d}if(g.open=="1"||g.entryid==desknets.sp.getLoginUid()||f==desknets.sp.getLoginUid()||b.msEntryId==desknets.sp.getLoginUid()){if(g.open=="0"){e=c.find(".jcreport-comment-memo").html()+e}c.find(".jcreport-comment-memo").html(e)}if(f!=g.entryid){c.addClass("poster");h=desknets.Resource.creport.dataPoster}if(h!=""){c.find(".jcreport-comment-date").text(h+" - "+desknets.dateTime.dispDateTime(g.cretime))}else{c.find(".jcreport-comment-date").text(desknets.dateTime.dispDateTime(g.cretime))}c.enhanceWithin()},updateContainerElement:function(c){var b=this;b.callBase("updateContainerElement",c);if(b.msEntryId==desknets.sp.getLoginUid()||b.msStatus=="4"||b.msStatus=="6"){b.$mRootElement.find(".jcreport-ref-sent").show()}else{b.$mRootElement.find(".jcreport-ref-recv").show()}b.$mRootElement.find(".jco-attach-area").find("a").on("vclick",function(h){h.preventDefault();var g=a(this).attr("href");var e=a(this).attr("target");var d=function(){window.open(g,e)};var f=function(){var i=document.createElement("input");i.setAttribute("type","button");i.setAttribute("name","sal");i.setAttribute("style","display:none;");document.body.appendChild(i);i.onclick=d;setTimeout(function(){i.click()},100)};f()})},openListItem:function(b,c){},getItemCount:function(){var b=this;return b.$listElement.find('li:jqmData(role="list-divider")').length},getItemElementWithIndex:function(b){return this.callBase("getItemElementWithIndex",b*2)},setPage:function(e,d,f,c){var b=this;b.msId=e;b.msEntryId=d;b.msStatus=f;b.mboNew=c;b.invalidate()}});desknets.page(desknets.sp.creport,"CReportFolder",desknets.sp.FolderPage,{$_TmplAllProc:null,init:function(c){var b=this;b.mboChk=false;b.callBase("init",c);b.$_TmplAllProc=b.$mRootElement.find(".jcreport-allproc").remove();b.$mRootElement.find(".jcreport-btn-sent").on("vclick",function(d){d.preventDefault();desknets.sp.creport.CReportList.invalidate();desknets.sp.creport.CReportList.setPage(desknets.creport.SEND_FOLDER_ID);desknets.sp.changePage("creportlist")});b.$mRootElement.find(".jcreport-btn-recv").on("vclick",function(d){d.preventDefault();desknets.sp.creport.CReportList.invalidate();desknets.sp.creport.CReportList.setPage(desknets.creport.RECV_FOLDER_ID);desknets.sp.changePage("creportlist")})},getListRequestURL:function(){return desknets.sp.creport.getRequestURL()},getListRequestData:function(d,e){var b=this;var f="";if(b.mobjParent!=null){f=b.mobjParent.id}var c={cmd:desknets.creport.CMD_CREPORTUSERFOLDERLISTCHILD,pfolder:f};return c},getAjaxId:function(){return"dnsp-creportfolder"},updateContainerElement:function(c){var b=this;if(b.mobjParent==null){var d=b.$listElement.children(":first-child");if(d.length==0){b.$listElement.append(b.$_TmplAllProc.clone())}else{b.$_TmplAllProc.clone().insertBefore(d)}b.$listElement.find(".jcreport-allproc").removeClass("ui-li-has-alt").find(".jco-listsub").remove()}b.callBase("updateContainerElement",c)},setUpListItem:function(d,c){var b=this;b.callBase("setUpListItem",d,c);c.find("h3").html(desknets.tmpl.escapeWord(d.Name));if(!neo.isSet(d.list)){c.removeClass("ui-li-has-alt").find(".jco-listsub").remove()}},openListItem:function(c,d){var b=this;desknets.sp.creport.CReportList.invalidate();desknets.sp.creport.CReportList.setPage(d,c.find("h3").text());desknets.sp.changePage("creportlist")}});desknets.page(desknets.sp.creport,"CReportPopCom",desknets.sp.EntryPage,{mboList:false,init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jco-delclose").bind("vclick",function(d){d.preventDefault();b.delClose()})},replaceItems:function(){var b=this;b.pageViewEnd()},showingPage:function(){var b=this},getEntriesFromReferItem:function(){var b=this;var d=b.getCReportProcCmd();if(neo.isSet(d)&&d.length>0){var c={cmd:d,id:b.msId};return c}return null},getSubmitRequestURL:function(){return desknets.sp.creport.getRequestURL()},getCReportProcCmd:function(){return""},delClose:function(){var b=this;if(b.mboList===false){desknets.sp.changePage(b.delCloseId(),{changeHash:false,transition:"pop",reverse:true})}else{history.back()}},delCloseId:function(){return""},setPage:function(d,b){var c=this;c.callBase("setPage",d);if(b===true){c.mboList=b}},getSendRequestOption:function(){var b=this;var c={};c.error=function(e,d,f){desknets.sp.ajax.onError(e.status,f);b.setInvalidate()};return c},completeToSendEntries:function(){var b=this;b.setInvalidate();b.$mRootElement.dialog("close")},setInvalidate:function(){var b=this;desknets.sp.creport.CReportList.invalidate()}});desknets.page(desknets.sp.creport,"CReportConf",desknets.sp.creport.CReportPopCom,{getCReportProcCmd:function(){return desknets.creport.CMD_CREPORTLISTCHECK}});desknets.page(desknets.sp.creport,"CReportComplete",desknets.sp.creport.CReportPopCom,{getCReportProcCmd:function(){return desknets.creport.CMD_CREPORTFINISHCONF}});desknets.page(desknets.sp.creport,"CReportUnread",desknets.sp.creport.CReportPopCom,{getCReportProcCmd:function(){return desknets.creport.CMD_CREPORTLISTUNREAD}});desknets.page(desknets.sp.creport,"CReportRead",desknets.sp.creport.CReportPopCom,{getCReportProcCmd:function(){return desknets.creport.CMD_CREPORTLISTREAD}});desknets.page(desknets.sp.creport,"CReportDel",desknets.sp.creport.CReportPopCom,{msFolderId:"",getCReportProcCmd:function(){return desknets.creport.CMD_CREPORTLISTMOVE},setPage:function(d,b,e){var c=this;c.msId=d;c.msFolderId=b;c.mboList=e;c.invalidate()},getEntriesFromReferItem:function(){var b=this;var d=b.getCReportProcCmd();if(neo.isSet(d)&&d.length>0){var c={cmd:d,id:b.msId,destid:"-4",folder:b.msFolderId};return c}return null}});desknets.page(desknets.sp.creport,"CReportCommentEntry",desknets.sp.creport.CReportPopCom,{msUId:"",showing:function(){var b=this;b.$mRootElement.find('textarea[name="memo"]').val("");b.$mRootElement.find('input[name="open"]').prop("checked",false).checkboxradio("refresh")},getCReportProcCmd:function(){return desknets.creport.CMD_CREPORTCOMMENTENTRY},setPage:function(c,d){var b=this;b.msId=c;b.msUId=d;b.invalidate()},getEntriesFromReferItem:function(){var b=this;var d=b.getCReportProcCmd();if(neo.isSet(d)&&d.length>0){var c={cmd:d,id:b.msId,rid:b.msUId,memo:b.$mRootElement.find('textarea[name="memo"]').val(),open:b.$mRootElement.find('input[name="open"]').prop("checked")?0:1};return c}return null},completeToSendEntries:function(c){var b=this;desknets.sp.creport.CReportComment.invalidate();b.callBase("completeToSendEntries")}});desknets.page(desknets.sp.creport,"CReportTag",desknets.sp.TagPage,{setInvalidate:function(){var b=this;desknets.sp.creport.CReportList.invalidate()},getEntriesFromReferItem:function(){var b=this;var c=b.callBase("getEntriesFromReferItem");c.cmd=desknets.creport.CMD_CREPORTTAG;return c},getSubmitRequestURL:function(){return desknets.sp.creport.getRequestURL()},completeTag:function(c){var b=this;desknets.sp.creport.CReportRef.msTag=c}});desknets.sp.creport.init()})(jQuery);