/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.cab={MODULE_API_CABINET:"zrcabinet",CMD_CABINDEX:"cabcmdindex",CMD_CABENTRY:"cabcmdentry",CMD_CABREFER:"cabcmdrefer",CMD_CABDEL:"cabdel",CMD_CABREFSETTAG:"cabcmdsettag",CMD_CABREFATTACH:"cabdispattach",CMD_CABFOLDERLIST:"cabcmdfolderlist",CMD_CABFOLDERLISTCHILD:"cabcmdfolderlistchild",CMD_CABFOLDERENTRY:"cabcmdfolderentry",CMD_CABFOLDERDELETE:"cabcmdfolderdel",CMD_CABSEARCH:"cabcmdsearch",CMD_CABSEARCHSTOP:"cabsearchstop",};desknets.sp.cab={init:function(){desknets.sp.mobjPages["folder-page"]=desknets.sp.cab.FolderList;desknets.sp.mobjPages["folderentry-page"]=desknets.sp.cab.FolderEntry;desknets.sp.mobjPages["d-folderdel-page"]=desknets.sp.cab.FolderDel;desknets.sp.mobjPages["cab-page"]=desknets.sp.cab.CabList;desknets.sp.mobjPages["cabref-page"]=desknets.sp.cab.CabRef;desknets.sp.mobjPages["cabentry-page"]=desknets.sp.cab.CabEntry;desknets.sp.mobjPages["d-cabdel-page"]=desknets.sp.cab.CabDel;desknets.sp.mobjPages["d-cabtag-page"]=desknets.sp.cab.CabTag;desknets.sp.mobjPages["cabsetfolder-page"]=desknets.sp.cab.CabSetFolder;desknets.sp.mobjPages["cabsrch-page"]=desknets.sp.cab.CabSrch;desknets.sp.mobjPages["cabsetsrch-page"]=desknets.sp.cab.CabSetSrch;desknets.sp.mobjPages["neotwi-page"]=desknets.sp.Neotwi;desknets.sp.initSetEvents()},getRequestURL:function(){return desknets.sp.getUrl(desknets.cab.MODULE_API_CABINET)},};desknets.page(desknets.sp.cab,"FolderList",desknets.sp.FolderPage,{init:function(c){var b=this;b.mboChk=false;b.callBase("init",c);b.$mRootElement.find(".jcab-folderadd").bind("vclick",function(d){d.preventDefault();desknets.sp.cab.FolderEntry.setEntries({name:""});var e="";if(b.mobjParent!=null){e=b.mobjParent.id}desknets.sp.cab.FolderEntry.setPage("",e);desknets.sp.changePage("folderentry")});b.$mRootElement.find(".jcab-srch").bind("vclick",function(d){d.preventDefault();desknets.sp.cab.CabSrch.getDefSrch(true);desknets.sp.changePage("cabsrch")})},getListRequestURL:function(){return desknets.sp.cab.getRequestURL()},getListRequestData:function(d,e){var b=this;var f="";if(b.mobjParent!=null){f=b.mobjParent.id}var c={cmd:desknets.cab.CMD_CABFOLDERLISTCHILD,pfolder:f};return c},getAjaxId:function(){return"dnsp-cabfolder"},getFolderDef:function(){return true},setUpListItem:function(d,c){var b=this;b.callBase("setUpListItem",d,c);c.find("h3").html(desknets.tmpl.escapeWord(d.Name));if(!neo.isSet(d.list)){c.removeClass("ui-li-has-alt").children(".jco-listsub").remove()}},openListItem:function(d,f){var c=this;if(c.mboSet){desknets.sp.cab.FolderEntry.setEntries({name:d.find("h3").text()});var h="";if(c.mobjParent!=null){h=c.mobjParent.id}desknets.sp.cab.FolderEntry.setPage(f,h);desknets.sp.changePage("folderentry")}else{var e=[];var b=c.marFolderList.length;for(var g=0;g<b;g++){e[g]=c.marFolderList[g]}if(c.mobjParent!=null){e[b]=c.mobjParent}e[e.length]={id:f,Name:d.find("h3").text()};desknets.sp.cab.CabList.setFolder(f,d.find("h3").text(),e);desknets.sp.changePage("cab")}},});desknets.page(desknets.sp.cab,"FolderEntry",desknets.sp.EntryPage,{msParentId:"",init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jcab-del").bind("vclick",function(d){d.preventDefault();desknets.sp.cab.FolderDel.setPage(b.msId);desknets.sp.changePage("d-folderdel",{changeHash:false})})},setPage:function(c,d){var b=this;b.msParentId=d;b.callBase("setPage",c)},replaceItems:function(){var b=this;b.setUpReferItemFromEntries();b.pageViewEnd()},setUpReferItemFromEntries:function(){var b=this;b.$mRootElement.find('input[name="Name"]').val(b.mobjEntries.name)},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.cab.CMD_CABFOLDERENTRY;c.Name=b.$mRootElement.find('input[name="Name"]').val();c.pfolder=b.msParentId;if(!!b.msId&&b.msId!==""){c.folder=b.msId}return c},getSubmitRequestURL:function(){return desknets.sp.cab.getRequestURL()},completeToSendEntries:function(){var b=this;desknets.sp.cab.FolderList.invalidate();b.callBase("completeToSendEntries")},});desknets.page(desknets.sp.cab,"FolderDel",desknets.sp.DelPage,{delCloseId:function(){return"folderentry"},setInvalidate:function(){var b=this;desknets.sp.cab.FolderList.invalidate()},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.cab.CMD_CABFOLDERDELETE;c.folder=b.msId;return c},getSubmitRequestURL:function(){return desknets.sp.cab.getRequestURL()},});desknets.page(desknets.sp.cab,"CabList",desknets.sp.ListPage,{msFolderId:"",msFolderName:"",marFolderList:[],init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jcab-folder").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("folder",{reverse:true})});b.$mRootElement.find(".jcab-srch").bind("vclick",function(d){d.preventDefault();desknets.sp.cab.CabSrch.getDefSrch(true);desknets.sp.changePage("cabsrch")})},showing:function(){var b=this;b.callBase("showing");b.showingCabPage()},showingCabPage:function(){var b=this;b.setFolderView()},setFolderView:function(){var c=this;var b=c.marFolderList.length;var e="";for(var d=0;d<b;d++){e=e+" &gt; "+desknets.tmpl.escapeWord(c.marFolderList[d].Name)}c.$mRootElement.find(".co-subtitle").find("span").html(e)},setFolder:function(b,d,e){var c=this;c.msFolderId=b;c.msFolderName=d;c.marFolderList=e;c.invalidate()},addItems:function(c){var b=this;if(b.msFolderId!=""){b.callBase("addItems",c)}else{var d={url:b.getListRequestURL(),data:{cmd:desknets.cab.CMD_CABFOLDERLIST},success:function(f,e,g){b.getFolder(f);b.setFolderView();b.addItems(c)}};desknets.sp.ajax.rest(d)}},getFolder:function(c){var b=this;b.msFolderId=c.folder;b.msFolderName="";var d=desknets.sp.ajax.getJsonItems(c);b.msFolderName=b.getFolderName(d,0)},getFolderName:function(h,c){var d=this;var b=h.length;for(var f=0;f<b;f++){if(h[f].id==d.msFolderId){d.marFolderList[c]={id:h[f].id,Name:h[f].Name};return h[f].Name}var e=desknets.sp.ajax.getJsonItems(h[f]);var g=d.getFolderName(e,c+1);if(g!=""){d.marFolderList[c]={id:h[f].id,Name:h[f].Name};return g}}return""},getListRequestURL:function(){return desknets.sp.cab.getRequestURL()},getListRequestData:function(c,d){var b=this;return{cmd:desknets.cab.CMD_CABINDEX,folder:b.msFolderId,row:c,num:d,}},getAjaxId:function(){return"dnsp-cab"},setUpListItem:function(d,c){var b=this;b.callBase("setUpListItem",d,c);if(neo.isSet(d.modulecmd,{blank:false})){c.addClass(d.modulecmd)}c.find("h3").html(desknets.tmpl.escapeWord(d.Name))},openListItem:function(c,d){var b=this;desknets.sp.cab.CabRef.setPage(d);desknets.sp.changePage("cabref")},});desknets.page(desknets.sp.cab,"CabRef",desknets.sp.RefPage,{msTag:"0",initPage:function(){var b=this;b.callBase("initPage");b.$mRootElement.find(".jcab-mod").bind("vclick",function(c){c.preventDefault();desknets.sp.cab.CabEntry.setPage(b.msId);desknets.sp.changePage("cabentry")});b.$mRootElement.find(".jcab-del").bind("vclick",function(c){c.preventDefault();desknets.sp.cab.CabDel.setPage(b.msId);desknets.sp.changePage("d-cabdel",{changeHash:false})});b.$mRootElement.find(".jcab-tag").bind("vclick",function(c){c.preventDefault();desknets.sp.cab.CabTag.setPage(b.msId,b.msTag);desknets.sp.changePage("d-cabtag")})},getReferRequestURL:function(){return desknets.sp.cab.getRequestURL()},getReferRequestData:function(){var b=this;var c={cmd:desknets.cab.CMD_CABREFER,id:b.msId,text:"1",};return c},setUpReferItem:function(f){var b=this;b.msTag=f.tagcolor;b.setUpText(".co-page-info-title",f.Name);b.$mRootElement.find(".jcab-folder").html(desknets.tmpl.dispItems(f.folder,null,null,null," &gt;\n"));b.setUpText(".jcab-modulename",f.modulename);if(neo.isSet(f.modulename,{blank:false})&&neo.isSet(f.viewdata,{blank:false})){var e="";var h="";var d=f.viewdata;if(f.modulecmd=="creport"){e="zcreport";h="cmd=creportrteattach"}else{if(f.modulecmd=="info"){e="zinfo";h="cmd=infoimage"}}if(e!=""){var g=new RegExp('src="'+e+".","ig");d=d.replace(g,'src="'+desknets.sp.MODULE_MAIN+".");g=new RegExp('href="'+e+".","ig");d=d.replace(g,'href="'+desknets.sp.MODULE_MAIN+".");d=desknets.sp.getAttachUrlDel(h,d)}b.$mRootElement.find(".jcab-viewdata").html(d).closest("li").show()}else{if(neo.isSet(f.viewdata,{blank:false})){b.$mRootElement.find(".jcab-viewdata").text(f.viewdata).closest("li").show()}else{b.$mRootElement.find(".jcab-viewdata").html("").closest("li").hide()}}var c={cmd:desknets.cab.CMD_CABREFATTACH,id:b.msId};b.setUpFile(".jcab-attach",f.attach,c);b.setUpBody(".jcab-memo",f.memo);b.setUpDate(".jcab-cretime",f.cretime);b.setUpDate(".jcab-updtime",f.updtime);b.setUpText(".jcab-entryname",f.entryname)},});desknets.page(desknets.sp.cab,"CabEntry",desknets.sp.EntryPage,{init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jcab-set").bind("vclick",function(d){d.preventDefault();desknets.sp.cab.CabSetFolder.invalidate();desknets.sp.changePage("cabsetfolder")})},setCabFolder:function(c,d){var b=this;b.$mRootElement.find('input[name="folder"]').val(c);b.$mRootElement.find(".jcab-folder").val(d)},getReferRequestURL:function(){return desknets.sp.cab.getRequestURL()},getReferRequestData:function(){var b=this;var c={cmd:desknets.cab.CMD_CABREFER,id:b.msId,};return c},setUpReferItemFromEntries:function(){var b=this;b.$mRootElement.find('input[name="Name"]').val(b.mobjEntries.Name);var c=desknets.sp.ajax.getItems(b.mobjEntries.folder.item);var d=c[c.length-1];b.$mRootElement.find('input[name="folder"]').val(d.id);b.$mRootElement.find(".jcab-folder").val(d.val);b.$mRootElement.find(".jcab-memo").val(b.mobjEntries.memo).keyup()},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.cab.CMD_CABENTRY;c.id=b.msId;c.Name=b.$mRootElement.find('input[name="Name"]').val();c.folder=b.$mRootElement.find('input[name="folder"]').val();c.memo=b.$mRootElement.find(".jcab-memo").val();return c},completeToSendEntries:function(){var b=this;desknets.sp.cab.CabList.invalidate();desknets.sp.cab.CabRef.invalidate();desknets.sp.cab.CabSrch.invalidate();b.callBase("completeToSendEntries")},});desknets.page(desknets.sp.cab,"CabDel",desknets.sp.DelPage,{delCloseId:function(){return"cabref"},setInvalidate:function(){var b=this;desknets.sp.cab.CabList.invalidate();desknets.sp.cab.CabSrch.invalidate()},getEntriesFromReferItem:function(){var b=this;var c=b.callBase("getEntriesFromReferItem");c.cmd=desknets.cab.CMD_CABDEL;return c},getSubmitRequestURL:function(){return desknets.sp.cab.getRequestURL()},});desknets.page(desknets.sp.cab,"CabSetFolder",desknets.sp.cab.FolderList,{init:function(c){var b=this;b.mboChk=false;b.callBase("init",c);b.$mRootElement.find(".jcab-set").bind("vclick",function(e){e.preventDefault();var f=b.$mRootElement.find("input[type=radio]:checked").closest("li");var d=f.data("id");if(neo.isSet(d,{blank:false})){desknets.sp.cab.CabEntry.setCabFolder(f.data("id"),f.find("h3").text())}history.back()})},setUpListItem:function(d,c){var b=this;this.callBase("setUpListItem",d,c);c.find("input[type=radio]").attr("id","cab-chk-list-"+d.id);c.find("label").attr("for","cab-chk-list-"+d.id);c.find("h3").html(desknets.tmpl.escapeWord(d.Name));if(!neo.isSet(d.list)){c.removeClass("ui-li-has-alt").children(".jco-listsub").remove()}},openListItem:function(c,d){var b=this},});desknets.page(desknets.sp.cab,"CabTag",desknets.sp.TagPage,{setInvalidate:function(){var b=this;desknets.sp.cab.CabList.invalidate()},getEntriesFromReferItem:function(){var b=this;var c=b.callBase("getEntriesFromReferItem");c.cmd=desknets.cab.CMD_CABREFSETTAG;return c},getSubmitRequestURL:function(){return desknets.sp.cab.getRequestURL()},completeTag:function(c){var b=this;desknets.sp.cab.CabRef.msTag=c},});desknets.page(desknets.sp.cab,"CabSrch",desknets.sp.SearchBatPage,{mobjSrch:{},initPage:function(){var b=this;b.callBase("initPage");b.$mRootElement.find(".jcab-setsrch").bind("vclick",function(c){c.preventDefault();b._handleListClickSrch()});b.$mRootElement.find(".jcab-folder").bind("vclick",function(c){c.preventDefault();desknets.sp.changePage("folder",{reverse:true})})},showFirstPage:function(){var b=this;b.callBase("showFirstPage");b.setSrchView()},clearItems:function(){var b=this;b.callBase("clearItems");b.mboInit=true},replaceItems:function(){var b=this;b.callBase("replaceItems");b.setSrchView()},setSrchView:function(){var b=this;b.$mRootElement.find('input[name="srch_key"]').val(b.mobjSrch.srch_key).searchkeychg();if(b.mobjSrch.srch_size!=""){b.$mRootElement.find(".jcab-size").show();if(b.mobjSrch.srch_sizerange=="2"){b.$mRootElement.find(".jcab-srch_size-up").hide();b.$mRootElement.find(".jcab-srch_size-down").show()}else{b.$mRootElement.find(".jcab-srch_size-up").show();b.$mRootElement.find(".jcab-srch_size-down").hide()}b.$mRootElement.find(".jcab-srch_size").html(b.mobjSrch.srch_size)}else{b.$mRootElement.find(".jcab-size").hide()}if(b.mobjSrch.srch_extension!=""){b.$mRootElement.find(".jcab-ext").show();b.$mRootElement.find(".jcab-srch_extension").text(b.mobjSrch.srch_extension)}else{b.$mRootElement.find(".jcab-ext").hide()}if(b.mobjSrch.updtime!=""){b.$mRootElement.find(".jcab-upd").hide();b.$mRootElement.find(".jcab-upd-"+b.mobjSrch.updtime).show();b.$mRootElement.find(".jcab-upddate").show()}else{b.$mRootElement.find(".jcab-upddate").hide()}},getListRequestURL:function(){return desknets.sp.cab.getRequestURL()},getAjaxId:function(){return"dnsp-cabsrch"},getListRequestData:function(d,e){var b=this;var c=b.callBase("getListRequestData",d,e);a.extend(c,{cmd:desknets.cab.CMD_CABSEARCH,srch_key:b.mobjSrch.srch_key,srch_size:b.mobjSrch.srch_size,srch_sizerange:b.mobjSrch.srch_sizerange,srch_extension:b.mobjSrch.srch_extension,srch_updtime:b.mobjSrch.srch_updtime,srch_updunit:b.mobjSrch.srch_updunit,});return c},_getStopBatSearchCmd:function(){return desknets.cab.CMD_CABSEARCHSTOP},setUpListItem:function(d,c){var b=this;b.callBase("setUpListItem",d,c);if(neo.isSet(d.modulecmd,{blank:false})){c.addClass(d.modulecmd)}c.find("h3").html(desknets.tmpl.escapeWord(d.Name))},openListItem:function(c,d){var b=this;desknets.sp.cab.CabRef.setPage(d);desknets.sp.changePage("cabref")},_handleListClickSrch:function(){var b=this;desknets.sp.cab.CabSetSrch.setPage(b.mobjSrch);desknets.sp.changePage("cabsetsrch")},chkSearch:function(){var d=this;if(d.$mRootElement.find('input[name="srch_key"]').val()==""&&d.mobjSrch.srch_size==""&&d.mobjSrch.srch_extension==""&&d.mobjSrch.srch_updtime==""){var b=desknets.Resource.searchcond;var c="";var e=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",b);desknets.sp.msg.view(c,"W:"+e,false);return false}return true},getDefSrch:function(c){var b=this;b.callBase("getDefSrch",c);b.mobjSrch={srch_key:"",srch_size:"",srch_sizerange:"1",srch_extension:"",updtime:"7",srch_updtime:"7",srch_updunit:"1",}},});desknets.page(desknets.sp.cab,"CabSetSrch",desknets.sp.ComPage,{mobjSrch:{},init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jcab-srch").bind("vclick",function(h){h.preventDefault();var e="";var f="";var g="";var d={};d.srch_key=b.$mRootElement.find('input[name="srch_key"]').val();d.srch_size=b.$mRootElement.find('input[name="srch_size"]').val();d.srch_sizerange=b.$mRootElement.find('select[name="srch_sizerange"] option:selected').val();d.srch_extension=b.$mRootElement.find('input[name="srch_extension"]').val();d.updtime=b.$mRootElement.find('select[name="updtime"] option:selected').val();if(d.updtime=="7"||d.updtime=="14"){d.srch_updtime=d.updtime;d.srch_updunit="1"}else{if(d.updtime=="0"){d.srch_updtime="";d.srch_updunit="2"}else{d.srch_updtime=d.updtime;d.srch_updunit="2"}}if(d.srch_key==""&&d.srch_size==""&&d.srch_extension==""&&d.srch_updtime==""){e=desknets.Resource.searchcond;f="";g=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",e);desknets.sp.msg.view(f,"W:"+g,false)}else{if(neo.isSet(d.srch_size,{blank:false})&&d.srch_size.match(/[^0-9]/)){e=b.$mRootElement.find(".jcab-search-size").find("div").eq(0).text()+desknets.merrMsgConnect;g=desknets.getErrConvMsg({fieldid:"1",fieldname:e,msg:desknets.Resource.Message.com_invalid_number});desknets.sp.msg.view(f,g,false)}else{a.extend(b.mobjSrch,d);desknets.sp.cab.CabSrch.setSrch(b.mobjSrch);history.back()}}});b.$mRootElement.find(".jcab-clear").bind("vclick",function(d){d.preventDefault();b.$mRootElement.find('input[name="srch_key"]').val("").searchkeychg();b.$mRootElement.find('input[name="srch_size"]').val("");b.$mRootElement.find('select[name="srch_sizerange"]').val("1").selectmenu("refresh");b.$mRootElement.find('input[name="srch_extension"]').val("");b.$mRootElement.find('select[name="updtime"]').val("7").selectmenu("refresh")})},replaceItems:function(){var b=this;b.$mRootElement.find('input[name="srch_key"]').val(b.mobjSrch.srch_key).searchkeychg();b.$mRootElement.find('input[name="srch_size"]').val(b.mobjSrch.srch_size);b.$mRootElement.find('select[name="srch_sizerange"]').val(b.mobjSrch.srch_sizerange).selectmenu("refresh");b.$mRootElement.find('input[name="srch_extension"]').val(b.mobjSrch.srch_extension);b.$mRootElement.find('select[name="updtime"]').val(b.mobjSrch.updtime).selectmenu("refresh");b.callBase("replaceItems")},setPage:function(b){var c=this;c.mobjSrch=b;c.mbItemRetrieved=false}});desknets.sp.cab.init()})(jQuery);