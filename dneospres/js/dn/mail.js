/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2017 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.sp.mail={MODULE_API_ZRWEML:"zrweml",MODULE_API_ZRWEMLC:"zrwemlc",MODULE_API_ZRWRICH:"zrwrich",MODULE_API_ZRWUSET:"zrwuset",CMD_PSETGEN:"psetgen",CMD_MAILACCOUNTS:"mailaccounts",CMD_MAILFOLDERLISTEXP:"mailfolderlistexp",CMD_MAILCMDFOLDERENTRY:"mailcmdfolderentry",CMD_MAILFOLDERMOVE:"mailfoldermove",CMD_MAILFOLDERDEL:"mailfolderdel",CMD_ADDRSEARCHLIST:"addrsearchlist",CMD_ADDRINDEX:"addrindex",CMD_ADDRCHKDUPLICATE:"addrchkduplicate",CMD_USETSEARCH:"usetsearch",CMD_USETSEARCHLIST:"usetsearchlist",CMD_MAILLIST:"maillist",CMD_MAILSEARCHLIST:"mailsearchlist",CMD_MAILDISPHEAD:"maildisphead",CMD_MAILDISPBODY:"maildispbody",CMD_MAILDISPATTACH:"maildispattach",CMD_MAILDOWNLOADATTACH:"maildownloadattach",CMD_MAILMOVE:"mailmove",CMD_MAILDEL:"maildel",CMD_MAILFLAG:"mailflag",CMD_MAILOPEN:"mailopen",CMD_MAILSEND:"mailsend",CMD_MAILGENPRIVATE:"mailgenprivate",CMD_MAILSIGNLIST:"mailsignlist",CMD_MAILSENDDRAFT:"mailsenddraft",CMD_MAILLISTALLINBOX:"maillistallinbox",CMD_MAILRECV:"mailrecv",CMD_MAILNOTIFICATION:"mailbothnotify",CMD_MAILNOTIFYSEND:"mailnotifysend",CMD_MAILSIGNLISTSHARE:"mailshareaccsignlist",CMD_MAILSETGEN:"mailsetgen",CMD_MAILSIGNENTRY:"mailsignentry",CMD_MAILSHAREACCSIGN:"mailshareaccsign",CMD_MAILDISPATTACHE:"maildispattache",CMD_MAILATTACHDEL:"mailattachdel",CMD_MAILSETWLISTADDR:"mailsetwlistaddr",VAL_FOLDERTYPE_INBOX:"1",VAL_FOLDERTYPE_SENT:"2",VAL_FOLDERTYPE_TRASH:"3",VAL_FOLDERTYPE_DRAFT:"4",VAL_FOLDERTYPE_TEMPL:"5",VAL_FOLDERTYPE_OTHER:"9",VAL_SHAREACCOUNTID_PREFIX:"s",VAL_SENDMODERE:"re",VAL_SENDMODEREALL:"allre",VAL_SENDMODEFW:"fw",VAL_SENDMODEDF:"df",VAL_SENDFLGRE:"1",VAL_SENDFLGFW:"2",VAL_LISTKIND_ALLINBOX:"allinbox",VAL_LISTKIND_LIST:"list",VAL_LISTKIND_SEARCH:"search",init:function(){if(!a("body").hasClass("func_mail")){return}desknets.sp.mobjPages["account-page"]=desknets.sp.mail.AccountList;desknets.sp.mobjPages["folder-page"]=desknets.sp.mail.FolderList;desknets.sp.mobjPages["d-folderadd-page"]=desknets.sp.mail.FolderAdd;desknets.sp.mobjPages["foldermod-page"]=desknets.sp.mail.FolderMod;desknets.sp.mobjPages["d-folderdel-page"]=desknets.sp.mail.FolderDel;desknets.sp.mobjPages["folderselect-page"]=desknets.sp.mail.FolderSelect;desknets.sp.mobjPages["maillist-page"]=desknets.sp.mail.MailList;desknets.sp.mobjPages["mailsrch-page"]=desknets.sp.mail.MailSrch;desknets.sp.mobjPages["mailsetsrch-page"]=desknets.sp.mail.MailSetSrch;desknets.sp.mobjPages["mailref-page"]=desknets.sp.mail.MailRef;desknets.sp.mobjPages["d-mailmove-page"]=desknets.sp.mail.MailMove;desknets.sp.mobjPages["d-maildel-page"]=desknets.sp.mail.MailDel;desknets.sp.mobjPages["d-mailmark-page"]=desknets.sp.mail.MailMark;desknets.sp.mobjPages["d-mailclose-page"]=desknets.sp.mail.MailClose;desknets.sp.mobjPages["d-mailreply-page"]=desknets.sp.mail.MailReply;desknets.sp.mobjPages["d-mailaddaddrconf-page"]=desknets.sp.mail.MailAddAddrConf;desknets.sp.mobjPages["d-externallinkconf-page"]=desknets.sp.mail.MailExternalLinkConf;desknets.sp.mobjPages["d-mailnotify-page"]=desknets.sp.mail.MailNotify;desknets.sp.mobjPages["d-mailrecverr-page"]=desknets.sp.mail.MailRecvErr;desknets.sp.mobjPages["mailentry-page"]=desknets.sp.mail.MailEntry;desknets.sp.mobjPages["d-mailsave-page"]=desknets.sp.mail.MailSave;desknets.sp.mobjPages["d-mailsendconf-page"]=desknets.sp.mail.MailSendConf;desknets.sp.mobjPages["d-mailsendconfvalue-page"]=desknets.sp.mail.MailSendConfValue;desknets.sp.mobjPages["d-mailrecvconf-page"]=desknets.sp.mail.MailRecvConf;desknets.sp.mobjPages["d-maildelattconf-page"]=desknets.sp.mail.MailDelAttConf;desknets.sp.mobjPages["addrselect-page"]=desknets.sp.mail.AddrSelect;desknets.sp.mobjPages["userselect-page"]=desknets.sp.mail.UserSelect;desknets.sp.mobjPages["d-mailaddrselect-page"]=desknets.sp.mail.MailAddrSelect;desknets.sp.mobjPages["neotwi-page"]=desknets.sp.Neotwi;desknets.sp.mobjPages["addrentry-page"]=desknets.sp.addr.AddrEntry;var b=[];b[b.length]="mailentry-page";desknets.sp.initSetEvents(b)},getRequestURL:function(){return desknets.getUrl(desknets.sp.mail.MODULE_API_ZRWEML)},getAccountList:function(d){var b=this;var c={dataType:"xml",url:b.getRequestURL(),data:{cmd:desknets.sp.mail.CMD_MAILACCOUNTS,proc:"3"},success:function(f,e,g){b._parseAccountList(a(f),d)}};desknets.sp.ajax.rest(c)},_parseAccountList:function(c,g){var e=this;var b={};b.defacc=c.find("defacc").text();b.item=[];var d=c.find(":first > list > item");var f=false;d.each(function(k,h){var j=a(h);var l={id:j.attr("id"),use:j.attr("use"),rstatus:j.attr("rstatus"),account:j.children("account").text(),name:j.children("name").text(),mail:j.children("mail").text(),rstatusmsg:j.children("rstatus").text(),share:j.attr("share")};b.item.push(l);if(l.id==b.defacc&&l.share!="1"){f=true;b.defaccname=l.account}});if(!f){b.defacc="";b.defaccname="";if(b.item.length>0){if(b.item[0]["share"]!="1"){b.defacc=b.item[0]["id"]}else{b.defacc=desknets.sp.mail.getEditShareAccountId(b.item[0]["id"])}b.defaccname=b.item[0]["account"]}}if(a.isFunction(g)){g(b)}},getEditShareAccountId:function(c){var b=this;if(!b.isShareAccountId(c)){return desknets.sp.mail.VAL_SHAREACCOUNTID_PREFIX+c}return c},getRawShareAccountId:function(c){var b=this;if(b.isShareAccountId(c)){return c.substring(1)}return c},isShareAccountId:function(b){return(typeof(b)=="string"&&b.charAt(0)==desknets.sp.mail.VAL_SHAREACCOUNTID_PREFIX)}};desknets.sp.mail.receive={_ajaxId:"dnsp-mailrecv",_accId:null,_Interval:3000,_boBothd:false,startReceiveMail:function(h,b){var c=this;if(b===true){c._boBothd=true;c._accId=null}else{c._boBothd=false;c._accId=h}var g={};g.cmd=desknets.sp.mail.CMD_MAILRECV;g.exec="1";if(c._boBothd){g.proc="3"}else{if(!!c._accId){g.aid=c._accId}}var e=desknets.tmpl.escapeWord(desknets.Resource.mail.sp.receive);var f=function(){c._stopReceive();a(".jco-errclose").css("display","block")};desknets.sp.msg.mailrecvview(f,e);var d={id:c._ajaxId,dataType:"xml",url:desknets.sp.mail.getRequestURL(),data:g,success:function(j,i,k){c._checkReceive()},error:function(k,j,i){if(j!="abort"){desknets.sp.ajax.onError(k.status,i)}}};desknets.sp.ajax.rest(d)},_checkReceive:function(){var b=this;setTimeout(function(){b._checkReceiveAjax()},b._Interval)},_checkReceiveAjax:function(){var b=this;var c={id:b._ajaxId,dataType:"xml",url:desknets.sp.mail.getRequestURL(),data:{cmd:desknets.sp.mail.CMD_MAILRECV},success:function(g,e,h){var d=a(g);var f=d.find("running").text();if(f==="1"){b._checkReceive()}else{b._endReceive(d)}},error:function(f,e,d){if(e!="abort"){desknets.sp.ajax.onError(f.status,d)}}};desknets.sp.ajax.rest(c)},_stopReceive:function(){var b=this;neo.ajax.abort(b._ajaxId,true);b._endReceive()},_endReceive:function(l){var k=this;if(a(".ui-page-active").attr("id")!="dialog-page"){return}desknets.sp.mail.AccountList.invalidate();desknets.sp.mail.FolderList.invalidate();desknets.sp.mail.FolderSelect.invalidate();desknets.sp.mail.MailList.invalidate();desknets.sp.mail.MailSrch.invalidate();if(!!l){var e=l.find("recverr");var j=l.find("filtererr");var i="0";if(!!k._accId){var f=k._accId;if(desknets.sp.mail.isShareAccountId(f)){f=desknets.sp.mail.getRawShareAccountId(f);i="1"}e=e.filter('[id="'+f+'"]').filter('[share="'+i+'"]');j=j.filter('[aid="'+f+'"]').filter('[share="'+i+'"]')}else{if(!k._boBothd){e=e.filter('[share="'+i+'"]');j=j.filter('[share="'+i+'"]')}}if(e.length>0||j.length>0){var h=0;var b=[];var g=[];for(h=0;h<e.length;h++){var c=a(e[h]);var d={id:c.attr("id"),accname:c.attr("recverracc"),msg:c.text(),share:c.attr("share")};b.push(d)}for(h=0;h<j.length;h++){var c=a(j[h]);var d={id:c.attr("aid"),accname:c.attr("account"),filtername:c.attr("filter"),proc:c.attr("proc"),count:c.attr("count"),msg:c.text(),share:c.attr("share")};g.push(d)}desknets.sp.mail.MailRecvErr.setPage(b,g);desknets.sp.changePage("d-mailrecverr",{changeHash:false});return}if(a(".ui-page-active").attr("id")=="dialog-page"){desknets.sp.msg.$mRootElement.dialog("close")}}}};desknets.page(desknets.sp.mail,"util",null,{getReferRequestURL:function(){return desknets.sp.mail.getRequestURL()},openMail:function(d,f,e){var b=this;var c={dataType:"xml",url:b.getReferRequestURL(),data:{cmd:desknets.sp.mail.CMD_MAILOPEN,msgid:d,proc:"open"},success:function(h,g,i){desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();if(a.isFunction(f)){f()}}};if(e){c.data["said"]=e}desknets.sp.ajax.rest(c)}});desknets.page(desknets.sp.mail,"AccountList",desknets.sp.ListPage,{$listElementInbox:null,$_TmplInbox:null,$listElementInboxShare:null,$_TmplInboxShare:null,$listElementShare:null,$_TmplShare:null,mboExecRecv:false,init:function(c){var b=this;b.mboJson=false;b.callBase("init",c);b.$listElementInbox=b.$mRootElement.find("ul.mail-list-get");b.$_TmplInbox=b.$listElementInbox.children(".jmail-list-tmpl").removeClass("jmail-list-tmpl").remove();b.$listElementInbox.bind("vclick",function(e){e.preventDefault();var d=a(e.target).closest("li");if(d.length>0){b.openListItemInbox(d,d.data("id"))}});b.$listElementInboxShare=b.$mRootElement.find("ul.mail-list-com-get");b.$_TmplInboxShare=b.$listElementInboxShare.children(".jmail-list-tmpl").removeClass("jmail-list-tmpl").remove();b.$listElementInboxShare.bind("vclick",function(e){e.preventDefault();var d=a(e.target).closest("li");if(d.length>0){b.openListItemInbox(d,d.data("id"))}});b.$listElementShare=b.$mRootElement.find("ul.mail-list-com-account");b.$_TmplShare=b.$listElementShare.children(".jmail-list-tmpl").removeClass("jmail-list-tmpl").remove();b.$listElementShare.bind("vclick",function(e){e.preventDefault();var d=a(e.target).closest("li");if(d.length>0){b.openListItem(d,d.data("id"))}});b.$mRootElement.find(".jmail-recv").bind("vclick",function(d){d.preventDefault();b._execRecv()});b.$mRootElement.find(".jmail-srch").bind("vclick",function(d){d.preventDefault();desknets.sp.mail.MailSrch.setAccount(null,null);desknets.sp.mail.MailSrch.getDefSrch(true);desknets.sp.changePage("mailsrch")});b.$mRootElement.find(".jmail-mailentry").bind("vclick",function(d){d.preventDefault();desknets.sp.mail.MailEntry.setEntries({});desknets.sp.changePage("mailentry")})},showing:function(){var b=this;b.callBase("showing");b.$mRootElement.find(".jmail-nolist").hide();neo.storage.local(desknets.sp.COOKIENAME_MAILACCOUNTID,null)},getShareItemCount:function(){var b=this;return b.$listElementShare.children().length},setExecRecv:function(){var b=this;b.mboExecRecv=true},clearItems:function(){var b=this;b.callBase("clearItems");if(b.$mRootElement!==null){b.$listElementInbox.hide();var c=b.$listElementInbox.children(".jmail-all");b.$listElementInbox.empty().append(c);b.$listElementShare.empty();b.$listElementInboxShare.empty()}},pageViewEnd:function(){var b=this;b.callBase("pageViewEnd");if(b.mboExecRecv){b.mboExecRecv=false;setTimeout(function(){b._execRecv()},500)}},getListRequestURL:function(){return desknets.sp.mail.getRequestURL()},getAjaxId:function(){return"dnsp-mailaccount"},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.dataType="xml";c.success=function(e,d,f){var g=[];e=a(e);g=e.find("item");b.executeOnItemsGot(e,g,"append");b.pageViewEnd()};return c},getListRequestData:function(b,c){return{cmd:desknets.sp.mail.CMD_MAILACCOUNTS,sp:"1",proc:"3"}},executeOnItemsGot:function(h,i,e){var d=this;var c=0;var f=i.length;for(var g=0;g<f;g++){var b=a(i[g]);if(b.attr("share")!="1"){c+=parseInt(b.attr("closemailinbox"))}}d.$listElementInbox.children(".jmail-all").find(".ui-li-count").html(c);d.callBase("executeOnItemsGot",h,i,e)},addListElements:function(g,i){var k=this;var c=g.length;for(var h=0;h<c;h++){var j=a(g[h]);if(j.attr("share")=="1"){var e=null;e=k.$_TmplShare.clone();e.appendTo(k.$listElementShare);var f=null;f=k.$_TmplInboxShare.clone();f.appendTo(k.$listElementInboxShare);k.setUpListItem(j,e);k.setUpListItem(j,f)}else{var d=null;d=k.addListElementsTmpl();d.appendTo(k.$listElement);var b=null;b=k.$_TmplInbox.clone();b.appendTo(k.$listElementInbox);k.setUpListItem(j,d);k.setUpListItem(j,b)}}k.$listElement.enhanceWithin();k.$listElementInbox.enhanceWithin();k.$listElementShare.enhanceWithin();k.$listElementInboxShare.enhanceWithin()},removeListElements:function(b){return},setUpListItem:function(d,c){var b=this;if(d.attr("share")=="1"){var e=desknets.sp.mail.getEditShareAccountId(d.attr("id"));c.data("id",e);c.addClass("mail-com-account")}else{b.callBase("setUpListItem",d,c)}c.data("fidinbox",d.attr("fidinbox"));c.find("h3").html(desknets.tmpl.escapeWord(d.children("account").text()));if(b._isAccountListItem(c)){c.find(".ui-li-count").html(d.attr("closemail"))}else{c.find(".ui-li-count").html(d.attr("closemailinbox"))}},updateContainerElement:function(c){var b=this;if(b.getItemCount()>0||b.getShareItemCount()>0){b.$mRootElement.find(".jmail-list").show();b.$mRootElement.find(".jmail-nolist").hide();if(b.getItemCount()>0){b.$listElement.show();b.$listElementInbox.show()}else{b.$listElement.hide();b.$listElementInbox.hide()}if(b.getShareItemCount()>0){b.$listElementShare.show();b.$listElementInboxShare.show()}else{b.$listElementShare.hide();b.$listElementInboxShare.hide()}b.$noItemsContainerElement.hide()}else{b.$mRootElement.find(".jmail-list").hide();b.$mRootElement.find(".jmail-nolist").show();b.$listElement.hide();b.$listElementInbox.hide();b.$listElementShare.hide();b.$listElementInboxShare.hide();b.$noItemsContainerElement.show()}setTimeout(function(){b.$listElement.listview("refresh");b.$listElementInbox.listview("refresh");b.$listElementShare.listview("refresh");b.$listElementInboxShare.listview("refresh")},100)},openListItem:function(c,d){var b=this;desknets.sp.mail.FolderList.setAccId(d);desknets.sp.changePage("folder")},openListItemInbox:function(c,d){var b=this;if(!!d){var e=c.data("fidinbox");var f=c.find("h3").text();desknets.sp.mail.MailList.setAccFld(d,f,e,desknets.sp.mail.VAL_FOLDERTYPE_INBOX,false)}else{desknets.sp.mail.MailList.setAccFld(null,null,null,null,true)}desknets.sp.changePage("maillist")},_isAccountListItem:function(b){return b.parent("ul.co-list-folder").hasClass("mail-list-account")||b.parent("ul.co-list-folder").hasClass("mail-list-com-account")},_execRecv:function(){var b=this;var d=b.getItemCount();var c=b.getShareItemCount();if(d>0&&c>0){desknets.sp.changePage("d-mailrecvconf",{changeHash:false})}else{if(c>0){desknets.sp.mail.receive.startReceiveMail(null,true)}else{if(d>0){desknets.sp.mail.receive.startReceiveMail()}}}}});desknets.page(desknets.sp.mail,"FolderList",desknets.sp.FolderPage,{msAccId:null,msAccName:null,msTrashId:null,mboTrash:null,mboGoAccList:false,mboExecRecv:false,mboReceived:false,init:function(c){var b=this;b.mboJson=false;b.mboChk=false;b.callBase("init",c);b.$mRootElement.find(".jmail-recv").bind("vclick",function(d){d.preventDefault();desknets.sp.mail.receive.startReceiveMail(b.msAccId)});b.$mRootElement.find(".jmail-srch").bind("vclick",function(d){d.preventDefault();desknets.sp.mobjPages["mailsrch-page"].setAccount(b.msAccId,b.msAccName);desknets.sp.mobjPages["mailsrch-page"].getDefSrch(true);desknets.sp.changePage("mailsrch")});b.$mRootElement.find(".jmail-account").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("account")});b.$mRootElement.find(".jmail-folderadd").bind("vclick",function(e){e.preventDefault();desknets.sp.mobjPages["d-folderadd-page"].setEntries({Name:""});var f=null;if(desknets.sp.mail.isShareAccountId(b.msAccId)){f=desknets.sp.mail.getRawShareAccountId(b.msAccId)}var d="";if(b.mobjParent!=null){d=b.mobjParent.id}else{if(b.msAccId!=null){if(desknets.sp.mail.isShareAccountId(b.msAccId)){d="-"+f}else{d="-"+b.msAccId}}}desknets.sp.mobjPages["d-folderadd-page"].setPage(d,f);desknets.sp.changePage("d-folderadd")});b.initMailChangePage(null)},initMailChangePage:function(b){var c=this;if(!neo.isSet(c.msAccId,{blank:false})){var d=neo.storage.local(desknets.sp.COOKIENAME_MAILACCOUNTID);if(neo.isSet(d,{blank:false})){c.setAccId(d);c.mboExecRecv=true}else{c.mboReceived=true;c.mboGoAccList=true;desknets.sp.mail.AccountList.setExecRecv();desknets.sp.changePage("account",{transition:"none"})}}},show:function(){var b=this;b._checkAccId();if(b.mboGoAccList){b.mboGoAccList=false;return}b.callBase("show")},_checkAccId:function(){var b=this;if(!neo.isSet(b.msAccId,{blank:false})){b.mboGoAccList=true;desknets.sp.changePage("account",{transition:"none"})}},setAccId:function(c){var b=this;b.msAccId=c;b.mobjParent=null;b.marFolderList=[];b.invalidate()},replaceItems:function(){var b=this;b.callBase("replaceItems");neo.storage.local(desknets.sp.COOKIENAME_MAILACCOUNTID,b.msAccId)},getListRequestURL:function(){return desknets.sp.mail.getRequestURL()},getAjaxId:function(){return"dnsp-mailfolder"},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.dataType="xml";c.success=function(e,d,f){var g=[];e=a(e);g=e.find("item");b.executeOnItemsGot(e,g,"append");b.pageViewEnd()};c.error=function(f,e,d){if(f.status=="-6059"||f.status=="-6060"){b.mboReceived=true;b.mboExecRecv=false;desknets.sp.changePage("account",{transition:"none"});return}if(e!="abort"){desknets.sp.ajax.onError(f.status,d)}};return c},getListRequestData:function(d,e){var b=this;var f="";if(b.mobjParent!=null){f=b.mobjParent.id}var c={cmd:desknets.sp.mail.CMD_MAILFOLDERLISTEXP,aid:b.msAccId,pfid:f,row:"0",num:"0"};return c},setFolderView:function(){var b=this;if(b.mobjParent!=null){b.callBase("setFolderView")}},executeOnItemsGot:function(e,g,d){var c=this;if(c.mobjParent===null&&g.length==0){c.mboExecRecv=false;if(c.mboReceived==false){desknets.sp.mail.AccountList.setExecRecv()}c.mboReceived=true;c.invalidate();desknets.sp.changePage("account",{transition:"none"});return}c.msAccName=e.find("account").text()||"";if(c.mobjParent==null){var b=e.find("Mail").text()||"";var f=c.msAccName+" <"+b+">";c.$mRootElement.find(".co-subtitle").show().find("span").html(desknets.tmpl.escapeWord(f))}c.msTrashId=e.find("trashid").text();c.mboTrash=(e.find("intrash").text()=="1")?true:false;c.callBase("executeOnItemsGot",e,g,d);if(c.mboExecRecv){c.mboReceived=true;c.mboExecRecv=false;desknets.sp.mail.receive.startReceiveMail(c.msAccId)}},setUpListItem:function(f,d){var c=this;c.callBase("setUpListItem",f,d);if(c.mboSet){var b=f.attr("ftype");if(b===desknets.sp.mail.VAL_FOLDERTYPE_INBOX||b===desknets.sp.mail.VAL_FOLDERTYPE_SENT||b===desknets.sp.mail.VAL_FOLDERTYPE_TRASH||b===desknets.sp.mail.VAL_FOLDERTYPE_DRAFT||b===desknets.sp.mail.VAL_FOLDERTYPE_TEMPL){var e=a('<li class="co-li-folder"><h3></h3></li>');d.after(e).remove();d=e;c.$listElement.listview("refresh")}}d.find("h3").html(desknets.tmpl.escapeWord(f.children("Name").text()));d.find(".ui-li-count").html(f.attr("closemail"));d.data("ftype",f.attr("ftype"))},openListItem:function(d,e){var c=this;if(c.mboSet){desknets.sp.mobjPages["foldermod-page"].setEntries({Name:d.find("h3").text()});var f=null;if(desknets.sp.mail.isShareAccountId(c.msAccId)){f=desknets.sp.mail.getRawShareAccountId(c.msAccId)}desknets.sp.mobjPages["foldermod-page"].setPage(e,c.msTrashId,c.mboTrash,f);desknets.sp.changePage("foldermod")}else{var b=d.data("ftype");desknets.sp.mobjPages["maillist-page"].setAccFld(c.msAccId,c.msAccName,e,b,false);desknets.sp.changePage("maillist")}}});desknets.page(desknets.sp.mail,"FolderAdd",desknets.sp.EntryPage,{msShareAccId:null,showing:function(){var b=this;b.callBase("showing");b.$mRootElement.find('input[name="Name"]').val(b.mobjEntries.Name)},setPage:function(c,d){var b=this;b.msShareAccId=d;b.callBase("setPage",c)},replaceItems:function(){var b=this;b.pageViewEnd()},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sp.mail.CMD_MAILCMDFOLDERENTRY;c.Name=b.$mRootElement.find('input[name="Name"]').val();c.pfid=b.msId;if(b.msShareAccId){c.said=b.msShareAccId}return c},completeToSendEntries:function(){var b=this;desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["maillist-page"].invalidate();desknets.sp.mobjPages["mailsrch-page"].invalidate();b.$mRootElement.dialog("close")}});desknets.page(desknets.sp.mail,"FolderMod",desknets.sp.EntryPage,{msTrashId:null,mboTrash:null,msShareAccId:null,init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jmail-folderdel").bind("vclick",function(d){d.preventDefault();desknets.sp.mobjPages["d-folderdel-page"].setPage(b.msId,b.msTrashId,b.mboTrash,b.msShareAccId);desknets.sp.changePage("d-folderdel",{changeHash:false})})},setPage:function(e,d,c,f){var b=this;b.msTrashId=d;b.mboTrash=c;b.msShareAccId=f;b.callBase("setPage",e)},replaceItems:function(){var b=this;b.setUpReferItemFromEntries();b.pageViewEnd()},setUpReferItemFromEntries:function(){var b=this;b.$mRootElement.find('input[name="Name"]').val(b.mobjEntries.Name)},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sp.mail.CMD_MAILCMDFOLDERENTRY;c.Name=b.$mRootElement.find('input[name="Name"]').val();c.id=b.msId;if(b.msShareAccId){c.said=b.msShareAccId}return c},completeToSendEntries:function(){var b=this;desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["d-folderadd-page"].invalidate();b.callBase("completeToSendEntries")},});desknets.page(desknets.sp.mail,"FolderDel",desknets.sp.DelPage,{msTrashId:null,mboTrash:null,msShareAccId:null,showing:function(){var d=this;d.callBase("showing");var b=d.$mRootElement.find(".jmail-folderdel-msg");var c=d.$mRootElement.find(".jmail-foldermove-msg");if(d.mboTrash===true){b.show();c.hide()}else{b.hide();c.show()}},setPage:function(e,d,c,f){var b=this;b.msTrashId=d;b.mboTrash=c;b.msShareAccId=f;b.callBase("setPage",e)},delCloseId:function(){return"foldermod"},setInvalidate:function(){desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["maillist-page"].invalidate();desknets.sp.mobjPages["mailsrch-page"].invalidate()},getEntriesFromReferItem:function(){var b=this;var c={};c.id=b.msId;if(b.mboTrash===true){c.cmd=desknets.sp.mail.CMD_MAILFOLDERDEL}else{c.cmd=desknets.sp.mail.CMD_MAILFOLDERMOVE;c.tofid=b.msTrashId}if(b.msShareAccId){c.said=b.msShareAccId}return c},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c}});desknets.page(desknets.sp.mail,"FolderSelect",desknets.sp.FolderPage,{msAccId:null,marMsgId:[],init:function(c){var b=this;b.mboJson=false;b.mboChk=false;b.callBase("init",c)},setIds:function(d,b,e){var c=this;c.msAccId=d;c.marMsgId=b;c.mobjParent=null;c.marFolderList=[];c.invalidate()},getListRequestURL:function(){return desknets.sp.mail.getRequestURL()},getAjaxId:function(){return"dnsp-mailfolder"},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.dataType="xml";c.success=function(e,d,f){var g=[];e=a(e);g=e.find("item");b.executeOnItemsGot(e,g,"append");b.pageViewEnd()};return c},getListRequestData:function(d,e){var b=this;var f="";if(b.mobjParent!=null){f=b.mobjParent.id}var c={cmd:desknets.sp.mail.CMD_MAILFOLDERLISTEXP,aid:b.msAccId,pfid:f,row:"0",num:"0"};return c},replaceItems:function(){var b=this;b.callBase("replaceItems");if(b.mobjParent==null||b.mboSet){b.$mRootElement.find(".jmail-back").removeClass("ui-btn-right").show()}else{b.$mRootElement.find(".jmail-back").hide()}},setUpListItem:function(f,d){var c=this;c.callBase("setUpListItem",f,d);var b=f.attr("ftype");if(b===desknets.sp.mail.VAL_FOLDERTYPE_DRAFT||b===desknets.sp.mail.VAL_FOLDERTYPE_TEMPL){var e=a('<li class="co-li-folder"><h3></h3></li>');d.after(e).remove();d=e;c.$listElement.listview("refresh")}d.find("h3").html(desknets.tmpl.escapeWord(f.children("Name").text()));if(f.attr("child")!="1"){d.removeClass("ui-li-has-alt").find(".jco-listsub").hide()}},openListItem:function(c,d){var b=this;var e=null;if(desknets.sp.mail.isShareAccountId(b.msAccId)){e=desknets.sp.mail.getRawShareAccountId(b.msAccId)}desknets.sp.mobjPages["d-mailmove-page"].setPage(d,b.marMsgId,e);desknets.sp.changePage("d-mailmove")}});desknets.page(desknets.sp.mail,"AddrSelect",desknets.sp.SearchPage,{mboIndexKana:true,mboSrchModeKey:true,msInputKind:"",initPage:function(){var b=this;b.mboJson=false;b.getDefSrch(true);if(b.$mRootElement.find(".jmail-index").length>0){b.$mRootElement.addClass("co-bgaddr")}b.$mRootElement.find(".jco-srch").bind("vclick",function(c){c.preventDefault();a(this).focus();if(b.chkSearch()){b.clearItems();b.getDefSrch(false);b.mbItemRetrieved=true;b.mboSrchModeKey=true;b.$noItemsContainerElement.find(".addr-noitems-searchkey").show();b.$noItemsContainerElement.find(".addr-noitems-key").hide();b.$mRootElement.find(".jmail-index>li").removeClass("selected");b.mobjSrch.srch_key=b.$mRootElement.find('input[name="srch_key"]').val();b.reload()}});b.$mRootElement.find(".jmail-srch a").bind("vclick",function(d){d.preventDefault();a(this).focus();b.clearItems();b.getDefSrch(false);b.mbItemRetrieved=true;b.mboSrchModeKey=false;b.$noItemsContainerElement.find(".addr-noitems-searchkey").hide();b.$noItemsContainerElement.find(".addr-noitems-key").show();b.$mRootElement.find('input[name="srch_key"]').val("").searchkeychg();b.$mRootElement.find(".jmail-index>li").removeClass("selected");var c=a(d.target).closest("li");c.addClass("selected");b.mobjSrch.indexname=c.attr("data-indexname");b.mobjSrch.wide=c.hasClass("jmail-wide");b.reload()});b.$mRootElement.find(".jmail-change a").bind("vclick",function(c){c.preventDefault();b.mboIndexKana=!a(c.target).closest("li").hasClass("jmail-kana");b._changeIndex(b.mboIndexKana)})},setKind:function(b){var c=this;c.msInputKind=b},pageViewEnd:function(){var b=this;b._changeIndex(b.mboIndexKana);b.callBase("pageViewEnd")},_changeIndex:function(c){var b=this;if(c===false){b.$mRootElement.find(".jmail-kana").hide();b.$mRootElement.find(".jmail-alp").show()}else{b.$mRootElement.find(".jmail-kana").show();b.$mRootElement.find(".jmail-alp").hide()}b.callBase("pageViewEnd")},chkSearch:function(){var d=this;if(d.$mRootElement.find('input[name="srch_key"]').val()==""){var b=desknets.Resource.searchcond;var c="";var e=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",b);desknets.sp.msg.view(c,"W:"+e,false);return false}return true},getListRequestURL:function(){return desknets.sp.mail.getRequestURL()},getAjaxId:function(){return"dnsp-mailaddrselect"},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.dataType="xml";return c},getListRequestData:function(c,d){var b=this;var e={};if(b.mboSrchModeKey){e={cmd:desknets.sp.mail.CMD_ADDRSEARCHLIST,key:b.mobjSrch.srch_key||"",share:"1",personal:"1",name:"1","const":"1",mail:"1",domain:"1",kana:"1",row:c,num:d}}else{e={cmd:desknets.sp.mail.CMD_ADDRINDEX,area:"3",kind:"1",no:b.mobjSrch.indexname||"",row:c,num:d};if(b.mobjSrch.wide==true){e.noall="all"}}return e},setUpListItem:function(e,c){var b=this;b.callBase("setUpListItem",e,c);var d=c.data("id");if(parseInt(d)>0){c.find(".row-in").addClass("share")}c.find("h3").html(desknets.tmpl.escapeWord(e.children("Name").text()));var f="";f+=b._makeHtmlTextMailAddress(e,"Mail","company");f+=b._makeHtmlTextMailAddress(e,"mailprivate","home");f+=b._makeHtmlTextMailAddress(e,"mailmobile","phone");c.find("h3").after(f);c.find(".jmail-address").bind("vclick",function(g){g.preventDefault();var h={};h.name=a(g.target).closest("li").find("h3").text();h.addr=a(g.target).text();desknets.sp.mobjPages["mailentry-page"].addMailAddr(h,b.msInputKind);history.back()})},_makeHtmlTextMailAddress:function(e,b,g){var d=this;var f="";var c=e.children(b).text();if(!!c){f+='<a href="#" data-role="button" class="jmail-address">';if(!!g){f+='<img src="'+desknets.sp.msImgPath+"mail/ic_"+g+'_mini.png" width="15" height="13" border="0" align="absmiddle">';f+='<span class="mail-addr-iconon">'}else{f+='<span class="mail-addr-iconoff">'}f+=desknets.tmpl.escapeWord(c)+"</span></a>"}return f},openListItem:function(b,c){}});desknets.page(desknets.sp.mail,"UserSelect",desknets.sp.UsetList,{msInputKind:"",setKind:function(b){var c=this;c.msInputKind=b},replaceItems:function(){var b=this;b.callBase("replaceItems");if(b.$mRootElement.find(".jco-parent").css("display")=="block"){b.$mRootElement.find(".jco-back").hide()}else{b.$mRootElement.find(".jco-back").show()}},setUpListItem:function(e,d){var c=this;c.callBase("setUpListItem",e,d);if(neo.isSet(e.children,{blank:false})){d.addClass("co-li-folder");d.find("h3").html(desknets.tmpl.escapeWord(e.Name))}else{d.find("h3").html(desknets.tmpl.escapeWord(e.Name));var b={};if(neo.isSet(e.assigngrp)){b=desknets.user.getListAssignGroups(e.assigngrp.Name)}d.find("p").html(!!b.assign?b.assign:"&nbsp;");var f="";f+=c._makeHtmlTextMailAddress(e,"Mail","company");f+=c._makeHtmlTextMailAddress(e,"mailmobile","phone");f+=c._makeHtmlTextMailAddress(e,"mailprivate","home");f+=c._makeHtmlTextMailAddress(e,"mailother",null);d.find("p").after(f);d.find(".jmail-address").bind("vclick",function(g){g.preventDefault();var h={};h.name=a(g.target).closest("li").find("h3").text();h.addr=a(g.target).text();desknets.sp.mobjPages["mailentry-page"].addMailAddr(h,c.msInputKind);history.back()})}},_makeHtmlTextMailAddress:function(e,b,g){var d=this;var f="";var c=e[b];if(!!c){f+='<a href="#" data-role="button" class="jmail-address">';if(!!g){f+='<img src="'+desknets.sp.msImgPath+"mail/ic_"+g+'_mini.png" width="15" height="13" border="0" align="absmiddle">';f+='<span class="mail-addr-iconon">'}else{f+='<span class="mail-addr-iconoff">'}f+=desknets.tmpl.escapeWord(c)+"</span></a>"}return f},openListItem:function(c,d){var b=this;if(c.hasClass("co-li-folder")){b.grpChangeId(c,d)}}});desknets.page(desknets.sp.mail,"MailList",desknets.sp.ListSetPage,{msAccId:null,msAccName:null,msFolderId:null,msFolderType:null,mboAllInbox:false,miAllCnt:0,init:function(c){var b=this;b.mboJson=false;b.callBase("init",c);b.$mRootElement.find(".jmail-recv").bind("vclick",function(d){d.preventDefault();desknets.sp.mail.receive.startReceiveMail(b.msAccId)});b.$mRootElement.find(".jmail-srch").bind("vclick",function(d){d.preventDefault();desknets.sp.mobjPages["mailsrch-page"].setAccount(b.msAccId,b.msAccName);desknets.sp.mobjPages["mailsrch-page"].getDefSrch(true);desknets.sp.changePage("mailsrch")});b.$mRootElement.find(".jmail-account").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("account")});b.$mRootElement.find(".jmail-mailentry").bind("vclick",function(d){d.preventDefault();desknets.sp.mobjPages["mailentry-page"].setEntries({accid:b.msAccId});desknets.sp.changePage("mailentry")});b.$mRootElement.find(".jmail-del").bind("vclick",function(f){f.preventDefault();var e=b._getChkIdForDel(true);if(e!==false){var g=null;if(desknets.sp.mail.isShareAccountId(b.msAccId)){g=desknets.sp.mail.getRawShareAccountId(b.msAccId)}var d=false;if(b.msFolderType==desknets.sp.mail.VAL_FOLDERTYPE_TRASH){d=true}desknets.sp.mobjPages["d-maildel-page"].setPage(e,true,g,d);desknets.sp.changePage("d-maildel")}});b.$mRootElement.find(".jmail-close").bind("vclick",function(e){e.preventDefault();var d=b.getChkId();if(d!==false){var f=null;if(desknets.sp.mail.isShareAccountId(b.msAccId)){f=desknets.sp.mail.getRawShareAccountId(b.msAccId)}desknets.sp.mobjPages["d-mailclose-page"].setPage(d,f);desknets.sp.changePage("d-mailclose")}else{b._listChgClick()}});b.$mRootElement.find(".jmail-move").bind("vclick",function(e){e.preventDefault();var d=b.getChkId(false);if(d!==false){desknets.sp.mobjPages["folderselect-page"].setIds(b.msAccId,d);desknets.sp.changePage("folderselect")}else{var f=desknets.Resource.Message.com_move_nochecked;desknets.sp.msg.view("","W:"+f)}})},setChgView:function(){var b=this;b.callBase("setChgView");if(b.mboAllInbox===true){b.$mRootElement.find(".co-subtitle").show()}else{b.$mRootElement.find(".co-subtitle").hide()}if(b.mboSet){if(b.mboAllInbox===true){b.$mRootElement.find(".jmail-moveok").hide();b.$mRootElement.find(".jmail-moveng").show()}else{b.$mRootElement.find(".jmail-moveok").show();b.$mRootElement.find(".jmail-moveng").hide()}}},_getChkIdForDel:function(c){var b=this;var d=0;var f=[];if(b.mboAllInbox!==true){var e=b.getChkId(c);if(e===false){return e}f.push({aid:"dmy",ids:e});return f}b.$listElement.find("input[type=checkbox]:checked").each(function(){var h=a(this).closest("li").data("aid");var g=a(this).closest("li").data("id");for(d=0;d<f.length;d++){if(f[d]["aid"]==h){break}}if(d==f.length){f[d]={aid:h,ids:[]}}f[d]["ids"].push(g)});if(f.length===0){if(c){desknets.sp.msg.view("","W:"+b.getNoChkMsg())}return false}return f},setAccFld:function(d,g,b,e,f){var c=this;c.msAccId=d;c.msAccName=g;c.msFolderId=b;c.msFolderType=e;c.mboAllInbox=f;c.invalidate()},setMailOpen:function(c,d){var b=this;if(!b.$listElement){return}if(!neo.isSet(c,{blank:false})){return}b.$listElement.children("li").each(function(){var f=a(this);var e=f.data("id");if(e==c){if(d===true){f.removeClass("new")}else{f.addClass("new")}return false}})},setMailReplyForward:function(e,d){var c=this;var b="";if(!c.$listElement||!neo.isSet(e,{blank:false})){return}if(d==desknets.sp.mail.VAL_SENDMODERE){b="replied"}else{if(d==desknets.sp.mail.VAL_SENDMODEFW){b="forwarded"}else{return}}c.$listElement.children("li").each(function(){var g=a(this);var f=g.data("id");if(f==e){g.removeClass();g.addClass(b);return false}})},invalidateMailSend:function(d,e,c){var b=this;if(d==b.msAccId&&(b.msFolderType==desknets.sp.mail.VAL_FOLDERTYPE_SENT||b.msFolderType==desknets.sp.mail.VAL_FOLDERTYPE_DRAFT)){b.invalidate()}else{b.setMailReplyForward(e,c)}},invalidateMailSave:function(c){var b=this;if(c!=b.msAccId){return}if(b.msFolderType==desknets.sp.mail.VAL_FOLDERTYPE_DRAFT){b.invalidate()}},replaceItems:function(){var b=this;b.callBase("replaceItems");b.replaceMailAccIdItems()},replaceMailAccIdItems:function(){neo.storage.local(desknets.sp.COOKIENAME_MAILACCOUNTID,self.msAccId)},clearItems:function(){var b=this;b.$mRootElement.find(".co-bar-msg").html("");b.callBase("clearItems")},getListRequestURL:function(){return desknets.sp.mail.getRequestURL()},getAjaxId:function(){return"dnsp-maillist"},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.dataType="xml";return c},getListRequestData:function(c,d){var b=this;var e={};if(b.mboAllInbox===true){e={cmd:desknets.sp.mail.CMD_MAILLISTALLINBOX,sp:"1",row:c,num:d,}}else{e={cmd:desknets.sp.mail.CMD_MAILLIST,fid:b.msFolderId,sp:"1",row:c,num:d,};if(desknets.sp.mail.isShareAccountId(b.msAccId)){e.said=desknets.sp.mail.getRawShareAccountId(b.msAccId)}}return e},executeOnItemsGot:function(d,f,c){var b=this;var e=d.find("foldername").text()||"";b.$mRootElement.find(".co-bar-msg").html(desknets.tmpl.escapeWord(e));b.miAllCnt=parseInt(d.find("allcnt").text());b.callBase("executeOnItemsGot",d,f,c)},setUpListItem:function(g,c){var b=this;b.callBase("setUpListItem",g,c);if(b.mboAllInbox===true){c.data("aid",g.children("aid").text());var d=neo.mailaddress.createMailbox(g.children("account").text(),g.children("Mail").text());c.find("p.mail").html(desknets.tmpl.escapeWord(d))}else{c.find("p.mail").hide();c.data("ftype",g.attr("ftype"))}if(g.attr("open")!=="1"){c.addClass("new")}var f=g.attr("sflg");if(f==desknets.sp.mail.VAL_SENDFLGRE){c.addClass("replied")}else{if(f==desknets.sp.mail.VAL_SENDFLGFW){c.addClass("forwarded")}}if(g.attr("attcount")>0){c.addClass("hasfile")}var e=g.attr("priority");if(e=="1"){c.find(".co-importance.low").remove()}else{if(e=="5"){c.find(".co-importance.high").remove()}else{c.find(".co-importance").remove()}}c.find(".mail-list-date").html(desknets.dateTime.dispDateTime(g.children("date").text(),{type:"list"}));c.find(".mail-subject").append(desknets.tmpl.escapeWord(g.children("subject").text()));c.find("h3").append(desknets.tmpl.escapeWord(g.children("from").text()));c.find(".jmail-preview").html(desknets.tmpl.escapeWord(g.children("preview").text()));c.find("input[type=checkbox]").attr("id","mail-chk-list-"+g.attr("id"));c.find("label").attr("for","mail-chk-list-"+g.attr("id"))},openListItem:function(d,g){var c=this;if(!c.mboSet){var b=d.data("ftype");d.removeClass("new");var f=null;if(c.mboAllInbox===true){f=d.data("aid")}else{f=c.msAccId}if(b===desknets.sp.mail.VAL_FOLDERTYPE_DRAFT||b===desknets.sp.mail.VAL_FOLDERTYPE_TEMPL){desknets.sp.mobjPages["mailentry-page"].setPage(g,desknets.sp.mail.VAL_SENDMODEDF,f);desknets.sp.changePage("mailentry")}else{desknets.sp.mobjPages["mailref-page"].setPage(g,f);var e=c._getListDataForView();desknets.sp.mobjPages["mailref-page"].setPageListObj(e);desknets.sp.changePage("mailref")}}},_getListDataForView:function(){var c=this;var d={};var b=[];if(!c.$listElement){return d}c.$listElement.children("li").each(function(){var f=a(this).data("id");if(neo.isSet(f,{blank:false})){var g={};var e;if(c.mboAllInbox===true){e=a(this).data("aid")}else{e=c.msAccId}g.id=a(this).data("id");g.aid=e;b.push(g)}});d.idList=b;if(c.mboAllInbox===true){d.kind=desknets.sp.mail.VAL_LISTKIND_ALLINBOX}else{d.kind=desknets.sp.mail.VAL_LISTKIND_LIST}d.row=c.miStartIndex;d.range=c.miPerPage;d.allcnt=c.miAllCnt;d.cond=c.getListRequestData(c.miStartIndex,c.miPerPage);return d}});desknets.page(desknets.sp.mail,"MailSrch",desknets.sp.SearchPage,{mobjSrch:{},msAccId:null,msAccName:null,marAccInfo:null,miAllCnt:0,initPage:function(){var b=this;b.mboJson=false;b.callBase("initPage");b.$mRootElement.find(".jmail-setsrch").bind("vclick",function(c){c.preventDefault();b._handleListClickSrch()})},showFirstPage:function(){var b=this;b.callBase("showFirstPage");b.getMailAccountList()},getMailAccountList:function(){var b=this;desknets.sp.mail.getAccountList(b.saveAccountList)},saveAccountList:function(f){var b=desknets.sp.mail.MailSrch;b.marAccInfo=f;if(b.marAccInfo!=null&&b.marAccInfo.item!=null){var c=b.marAccInfo.item.length;for(var e=0;e<c;e++){var d=b.marAccInfo.item[e];if(d.share=="1"){d.id=desknets.sp.mail.getEditShareAccountId(d.id)}}}if(!b.msAccId&&!!b.marAccInfo){b.mobjSrch.accid=b.marAccInfo.defacc||"0";b.mobjSrch.accname=b.marAccInfo.defaccname||""}b.setSrchView()},setAccount:function(c,d){var b=this;b.msAccId=c;b.msAccName=d;if(b.$mRootElement!==null){b.$mRootElement.find('input[name="srch_key"]').val("").searchkeychg();b.$mRootElement.find(".jmail-srch-target").html("");b.$mRootElement.find(".jmail-srch-acc").html("")}b.invalidate()},setMailOpen:function(c,d){var b=this;if(!b.$listElement){return}if(!neo.isSet(c,{blank:false})){return}b.$listElement.children("li").each(function(){var f=a(this);var e=f.data("id");if(e==c){if(d===true){f.removeClass("new")}else{f.addClass("new")}return false}})},chkSearch:function(){var d=this;if(d.$mRootElement.find('input[name="srch_key"]').val()==""){var b=desknets.Resource.searchcond;var c="";var e=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",b);desknets.sp.msg.view(c,"W:"+e,false);return false}return true},getListRequestURL:function(){return desknets.sp.mail.getRequestURL()},getAjaxId:function(){return"dnsp-mailsrch"},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.dataType="xml";return c},getListRequestData:function(d,e){var b=this;var c={cmd:desknets.sp.mail.CMD_MAILSEARCHLIST,target:b.mobjSrch.target,accid:b.mobjSrch.accid,fid:"-"+b.mobjSrch.accid,key:b.mobjSrch.srch_key,sfolder:"1",getpreview:"1",row:d,num:e,sp:"1"};if(desknets.sp.mail.isShareAccountId(b.mobjSrch.accid)){var f=desknets.sp.mail.getRawShareAccountId(b.mobjSrch.accid);c.accid=f;c.fid="-"+f;c.said=f}return c},replaceItems:function(){var b=this;b.callBase("replaceItems");b.setSrchView()},setSrchView:function(){var b=this;b.$mRootElement.find('input[name="srch_key"]').val(b.mobjSrch.srch_key).searchkeychg();b.$mRootElement.find(".jmail-srch-target").html(desknets.tmpl.escapeWord(b.mobjSrch.targetname));b.$mRootElement.find(".jmail-srch-acc").html(desknets.tmpl.escapeWord(b.mobjSrch.accname))},executeOnItemsGot:function(d,e,c){var b=this;b.miAllCnt=parseInt(d.find("allcnt").text());b.callBase("executeOnItemsGot",d,e,c)},setUpListItem:function(f,c){var b=this;b.callBase("setUpListItem",f,c);c.data("ftype",f.attr("ftype"));if(f.attr("open")!=="1"){c.addClass("new")}var e=f.attr("sflg");if(e==desknets.sp.mail.VAL_SENDFLGRE){c.addClass("replied")}else{if(e==desknets.sp.mail.VAL_SENDFLGFW){c.addClass("forwarded")}}if(f.attr("attcount")>0){c.addClass("hasfile")}var d=f.attr("priority");if(d=="1"){c.find(".co-importance.low").remove()}else{if(d=="5"){c.find(".co-importance.high").remove()}else{c.find(".co-importance").remove()}}c.find(".mail-list-date").html(desknets.dateTime.dispDateTime(f.children("date").text(),{type:"list"}));c.find(".mail-subject").append(desknets.tmpl.escapeWord(f.children("subject").text()));c.find("h3").append(desknets.tmpl.escapeWord(f.children("from").text()));c.find(".jmail-preview").html(desknets.tmpl.escapeWord(f.children("preview").text()))},openListItem:function(d,f){var c=this;var b=d.data("ftype");d.removeClass("new");if(b===desknets.sp.mail.VAL_FOLDERTYPE_DRAFT||b===desknets.sp.mail.VAL_FOLDERTYPE_TEMPL){desknets.sp.mobjPages["mailentry-page"].setPage(f,desknets.sp.mail.VAL_SENDMODEDF,c.mobjSrch.accid);desknets.sp.changePage("mailentry")}else{desknets.sp.mobjPages["mailref-page"].setPage(f,c.mobjSrch.accid);var e=c._getListDataForView();desknets.sp.mobjPages["mailref-page"].setPageListObj(e);desknets.sp.changePage("mailref")}},_handleListClickSrch:function(){var b=this;desknets.sp.mobjPages["mailsetsrch-page"].setPage(b.mobjSrch);desknets.sp.mobjPages["mailsetsrch-page"].setAccount(b.msAccId,b.msAccName,b.marAccInfo);desknets.sp.changePage("mailsetsrch")},getDefSrch:function(e){var c=this;c.callBase("getDefSrch",e);var d=c.msAccId;var b=c.msAccName;if(!d&&c.marAccInfo!=null){d=c.marAccInfo.defacc||"0";b=c.marAccInfo.defaccname||""}c.mobjSrch={accid:d,accname:b,target:"0",targetname:a("#mailsrch-page").find(".jmail-deftarget").html(),srch_key:""}},_getListDataForView:function(){var c=this;var d={};var b=[];if(!c.$listElement){return d}c.$listElement.children("li").each(function(){var e=a(this).data("id");if(neo.isSet(e,{blank:false})){var f={};f.id=a(this).data("id");f.aid=c.mobjSrch.accid;b.push(f)}});d.idList=b;d.kind=desknets.sp.mail.VAL_LISTKIND_SEARCH;d.row=c.miStartIndex;d.range=c.miPerPage;d.allcnt=c.miAllCnt;d.cond=c.getListRequestData(c.miStartIndex,c.miPerPage);return d}});desknets.page(desknets.sp.mail,"MailSetSrch",desknets.sp.RefPage,{mobjSrch:{},msAccId:null,msAccName:null,marAccInfo:null,initPage:function(){var b=this;b.$mRootElement.find(".jmail-srch").bind("vclick",function(h){h.preventDefault();if(b.$mRootElement.find('input[name="srch_key"]').val()==""){var d=desknets.Resource.searchcond;var e="";var g=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",d);desknets.sp.msg.view(e,"W:"+g,false);return}b.mobjSrch.srch_key=b.$mRootElement.find('input[name="srch_key"]').val();var c=b.$mRootElement.find('input[name="target"]:checked');b.mobjSrch.target=c.val();b.mobjSrch.targetname=b.$mRootElement.find('label[for="'+c.attr("id")+'"]').text();if(b.msAccId==null){var f=b.$mRootElement.find('select[name="accid"] option:selected');b.mobjSrch.accid=f.val();b.mobjSrch.accname=f.text()}desknets.sp.mobjPages["mailsrch-page"].setSrch(b.mobjSrch);history.back()});b.$mRootElement.find(".jmail-clear").bind("vclick",function(c){c.preventDefault();b.$mRootElement.find('input[name="srch_key"]').val("").searchkeychg();b._setTarget("0");if(b.msAccId==null){b.$mRootElement.find('select[name="accid"]').val(b.marAccInfo.defacc).selectmenu("refresh")}})},setPage:function(b){var c=this;c.callBase("setPage","");c.mobjSrch=b},setAccount:function(c,e,d){var b=this;b.msAccId=c;b.msAccName=e;b.marAccInfo=d;b.invalidate()},replaceItems:function(){var b=this;b.setUpReferItem();b.pageViewEnd()},setUpReferItem:function(c){var j=this;var g=j.$mRootElement.find(".jmail-acclist-disp");var f=j.$mRootElement.find(".jmail-acclist-edit");var d=f.find('select[name="accid"]');if(j.msAccId){var e=j.msAccName||"";g.find(".mail-acc-dispname").html(desknets.tmpl.escapeWord(e));g.show();f.hide()}else{d.html("");if(j.marAccInfo!=null&&j.marAccInfo.item!=null){var b=j.marAccInfo.item.length;for(var h=0;h<b;h++){var i=j.marAccInfo.item[h];d.append('<option value="'+i.id+'">'+desknets.tmpl.escapeWord(i.account)+"</option>")}}g.hide();f.show()}j.$mRootElement.find('input[name="srch_key"]').val(j.mobjSrch.srch_key).searchkeychg();d.val(j.mobjSrch.accid).selectmenu("refresh");j._setTarget(j.mobjSrch.target)},_setTarget:function(d){var c=this;var b=c.$mRootElement.find('input[name="target"]');b.each(function(e){if(a(this).val()==d){a(this).prop("checked",true).checkboxradio("refresh")}else{a(this).prop("checked",false).checkboxradio("refresh")}})}});desknets.page(desknets.sp.mail,"MailRef",desknets.sp.RefPage,{mobjMailInfo:{},$_Tmpl:null,msNoSubject:"",msShareAccId:null,mobjNotifySettingList:null,msAccId:null,mobjListDataForView:null,_funcNext:null,_icount:0,_iMAX:1,initPage:function(){var c=this;c.mboJson=false;c.callBase("initPage");var d=function(){c._icount++;if(c._icount<c._iMAX){return}c.getRefData()};c._funcNext=d;c.$_Tmpl=c.$mRootElement.find(".jmail-addrlink-tmpl").removeClass("jmail-addrlink-tmpl").remove();var b=c.$mRootElement.find(".jmail-subject");c.msNoSubject=b.text();b.empty();c.$mRootElement.find(".jamil-mark").bind("vclick",function(e){e.preventDefault();desknets.sp.mobjPages["d-mailmark-page"].setPage(c.msId,c.mobjMailInfo.flag,c.msShareAccId);desknets.sp.changePage("d-mailmark")});c.$mRootElement.find(".jmail-move").bind("vclick",function(f){f.preventDefault();var e=c.mobjMailInfo.aid;if(c.msShareAccId){e=desknets.sp.mail.getEditShareAccountId(c.msShareAccId)}desknets.sp.mobjPages["folderselect-page"].setIds(e,c.msId);desknets.sp.changePage("folderselect")});c.$mRootElement.find(".jmail-del").bind("vclick",function(h){h.preventDefault();var i=[];var f=false;var e=c.msId;var g=c._parseMsgId(c.msId);if(g.fid!=c.mobjMailInfo.fid){e=c.mobjMailInfo.fid+"_"+g.mailid}i.push({aid:"dmy",ids:e});if(c.mobjMailInfo.ftype==desknets.sp.mail.VAL_FOLDERTYPE_TRASH){f=true}desknets.sp.mobjPages["d-maildel-page"].setPage(i,false,c.msShareAccId,f);desknets.sp.changePage("d-maildel",{changeHash:false})});c.$mRootElement.find(".jmail-reply").bind("vclick",function(e){e.preventDefault();desknets.sp.mail.MailReply.setPage(c.msId,c.msAccId);desknets.sp.changePage("d-mailreply",{changeHash:false})});c.$mRootElement.find(".jmail-mailentry").bind("vclick",function(e){e.preventDefault();desknets.sp.mobjPages["mailentry-page"].setEntries({accid:c.msAccId});desknets.sp.changePage("mailentry")});c.$mRootElement.find(".mail-prev").bind("vclick",function(e){e.preventDefault();if(!a(this).hasClass("ui-state-disabled")){a(this).removeClass("co-hover-clear");c._disabledPrevNextBtn();setTimeout(function(){c._prevMailView(true)},10)}});c.$mRootElement.find(".mail-next").bind("vclick",function(e){e.preventDefault();if(!a(this).hasClass("ui-state-disabled")){a(this).removeClass("co-hover-clear");c._disabledPrevNextBtn();setTimeout(function(){c._nextMailView(true)},10)}});c.$mRootElement.on("swiperight",function(e){if(!c.$mRootElement.find(".mail-prev").hasClass("ui-state-disabled")){c._disabledPrevNextBtn();c._prevMailView(true)}});c.$mRootElement.on("swipeleft",function(e){if(!c.$mRootElement.find(".mail-next").hasClass("ui-state-disabled")){c._disabledPrevNextBtn();c._nextMailView(true)}})},setPage:function(d,c){var b=this;neo.ajax.abort(b.getAjaxIdDispHead(),true);neo.ajax.abort(b.getAjaxIdDispBody(),true);neo.ajax.abort(b.getAjaxIdDispAttach(),true);b.msAccId=c;var e=null;if(desknets.sp.mail.isShareAccountId(c)){e=desknets.sp.mail.getRawShareAccountId(c)}b.msShareAccId=e;b.callBase("setPage",d)},setPageListObj:function(b){var c=this;if(b){var d=a.extend(true,{},b);c.mobjListDataForView=d}else{c.mobjListDataForView=null}},changeFolder:function(c){var e=this;var f=e._parseMsgId(e.msId);var d=c+"_"+f.mailid;if(e.mobjListDataForView){var b=e._getIndexOwnId(e.mobjListDataForView.idList);if(b>=0){e.mobjListDataForView.idList[b]["id"]=d}}e.msId=d;e.invalidate()},setMailFlag:function(c){var b=this;b.mobjMailInfo.flag=(c===true)?"1":"0";if(b.$mRootElement!==null){var d=b.$mRootElement.find(".mail-icon-f");if(c===true){d.show()}else{b.mobjMailInfo.flag="0";d.hide()}}},setMailOpen:function(d){var b=this;if(b.$mRootElement!==null){var c=b.$mRootElement.find(".mail-icon-r");if(d===false){c.show()}else{c.hide()}}},showing:function(){var b=this;b.callBase("showing");b._resetPrevNextBtn()},clearItemsPage:function(){var b=this;b.callBase("clearItemsPage");b.$mRootElement.find(".mail-icon-f").hide();b.$mRootElement.find(".mail-icon-r").hide();b.$mRootElement.find(".jmail-senduser").closest("li").hide();b.$mRootElement.find(".co-importance").hide();b.$mRootElement.find(".jmail-listattach").hide();b.$mRootElement.find(".jmail-subject").text("");b.$mRootElement.find(".jmail-from").empty();b.$mRootElement.find(".jmail-to").empty();b.$mRootElement.find(".jmail-cc").empty();b.$mRootElement.find(".jmail-bcc").empty();b.$mRootElement.find(".jmail-date").text("");b.$mRootElement.find(".jmail-senduser").text("");b.$mRootElement.find(".jmail-body").empty();b.$mRootElement.find(".jmail-attach").empty()},replaceItems:function(){var b=this;b.clearItems();b._getInitData()},getRefData:function(){var b=this;b.callBase("replaceItems");b._getMailBody()},openMailRefPage:function(b,d,c){desknets.sp.mail.util.openMail(b,d,c)},getReferRequestURL:function(){return desknets.sp.mail.getRequestURL()},getReferRequestMailURL:function(){return desknets.sp.mail.getRequestURL()},getReferRequestMailSetURL:function(){return desknets.sp.getUrl(desknets.sp.mail.MODULE_API_ZRWRICH)},getMailDownloadAttachCmd:function(){return desknets.sp.mail.CMD_MAILDOWNLOADATTACH},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.dataType="xml";c.id=b.getAjaxIdDispHead();c.error=function(f,e,d){if(e!="abort"){desknets.sp.ajax.onError(f.status,d)}};return c},getReferRequestData:function(d,e){var b=this;var c={cmd:desknets.sp.mail.CMD_MAILDISPHEAD,sp:"1",proc:"disp",msgid:b.msId};if(b.msShareAccId){c.said=b.msShareAccId}return c},getAjaxIdDispHead:function(){return"dnsp-maildisphead"},getAjaxIdDispBody:function(){return"dnsp-maildispbody"},getAjaxIdDispAttach:function(){return"dnsp-maildispattach"},_getInitData:function(){var b=this;b._icount=0;b._getNotifySetting()},_getNotifySetting:function(){var b=this;if(b.mobjNotifySettingList!==null){b._funcNext();return}var c={dataType:"xml",url:b.getReferRequestURL(),data:{cmd:desknets.sp.mail.CMD_MAILNOTIFICATION},success:function(e,d,f){b._saveNotifySettingList(a(e));b._funcNext()},dialogback:true};desknets.sp.ajax.rest(c)},_saveNotifySettingList:function(b){var d=this;d.mobjNotifySettingList={};d.mobjNotifySettingList.item=[];var c=b.find(":first > list > item");c.each(function(g,e){var f=a(e);var h={share:f.attr("share"),aid:f.attr("aid"),recv:f.children("recv").text()};d.mobjNotifySettingList.item.push(h)})},_getFlgConfirmBeforeSendNotification:function(h){var c=this;var b;if(c.mobjNotifySettingList&&c.mobjNotifySettingList.item){var f=c.mobjNotifySettingList.item;var e=f.length;for(var d=0;d<e;d++){var g=f[d];if(!h){if(g.share=="0"){b=g.recv;break}}else{if(g.share=="1"&&g.aid==h){b=g.recv;break}}}}return(b=="2")},_getMailListAdd:function(){var c=this;if(!c.mobjListDataForView){return}var b=c.mobjListDataForView.cond;var d={dataType:"xml",url:c.getReferRequestURL(),data:b,success:function(f,e,g){c._saveMailListAdd(a(f))},dialogback:true};desknets.sp.ajax.rest(d)},_saveMailListAdd:function(c){var f=this;var b=[];var e;var h;e=parseInt(c.find("row").text());h=f.mobjListDataForView;h.allcnt=parseInt(c.find("allcnt").text());var d=c.find(":first > list > item");d.each(function(n,k){var l=a(k);var o={};var m;if(h.kind===desknets.sp.mail.VAL_LISTKIND_ALLINBOX){m=l.children("aid").text()}else{m=f.msAccId}var j=f._getIndexOwnId(h.idList,l.attr("id"));if(j>=0){return true}o.id=l.attr("id");o.aid=m;b.push(o)});if(e<h.row){h.row=e;var g=b.concat(h.idList);h.idList=g;f._prevMailView(false)}else{var g=h.idList.concat(b);h.idList=g;f._nextMailView(false)}},setUpReferItem:function(g){var c=this;var f=0;g=a(g);var b="";g.find("list > item").each(function(l,m){var k=a(m);var j=k.attr("id");if(!!j){if(typeof(j)=="string"&&j.toLowerCase()=="subject"){b=k.text();return false}}});c.mobjMailInfo={priority:g.find("priority").text(),attcount:g.find("attcount").text()||"0",flag:g.find("flag").text(),notify:g.find("notify").text(),date:g.find("date").text(),aid:g.find("aid").text(),subject:b||"",from:neo.mailaddress.parseMailGroup(g.find("from").text()||""),to:neo.mailaddress.parseMailGroup(g.find("to").text()||""),cc:neo.mailaddress.parseMailGroup(g.find("cc").text()||""),bcc:neo.mailaddress.parseMailGroup(g.find("bcc").text()||""),senduser:g.find("senduser").text(),fid:g.find("fid").text()||"0",ftype:g.find("ftype").text()||"0"};if(c.mobjMailInfo.notify==="1"&&c._getFlgConfirmBeforeSendNotification(c.msShareAccId)){if(a(".ui-page-active").attr("id")!="mailref-page"){return}c.openMailRefPage(c.msId,null,c.msShareAccId);desknets.sp.mobjPages["maillist-page"].setMailOpen(c.msId,true);desknets.sp.mobjPages["mailsrch-page"].setMailOpen(c.msId,true);desknets.sp.mobjPages["d-mailnotify-page"].setPage(c.msId,c.msShareAccId);desknets.sp.changePage("d-mailnotify");return}c.openMailRefPage(c.msId,null,c.msShareAccId);desknets.sp.mobjPages["maillist-page"].setMailOpen(c.msId,true);desknets.sp.mobjPages["mailsrch-page"].setMailOpen(c.msId,true);if(a(".ui-page-active").attr("id")!="mailref-page"){return}var d=parseInt(c.mobjMailInfo.attcount);if(d>0){c._getAttachList()}else{c.$mRootElement.find(".jmail-listattach").hide()}c.setUpText(".jmail-subject",c.mobjMailInfo.subject,c.msNoSubject);c._setUpMailLink(".jmail-from",c.mobjMailInfo.from,"");c._setUpMailLink(".jmail-to",c.mobjMailInfo.to,"");c._setUpMailLink(".jmail-cc",c.mobjMailInfo.cc);c._setUpMailLink(".jmail-bcc",c.mobjMailInfo.bcc);c.setUpDate(".jmail-date",c.mobjMailInfo.date,"");var e=c.$mRootElement.find(".mail-icon-f");if(c.mobjMailInfo.flag=="1"){e.show()}else{e.hide()}c.$mRootElement.find(".co-importance").hide();if(c.mobjMailInfo.priority=="1"){c.$mRootElement.find(".co-importance.high").show()}else{if(c.mobjMailInfo.priority=="5"){c.$mRootElement.find(".co-importance.low").show()}}var h=c.$mRootElement.find(".jmail-senduser").closest("li");if(neo.isSet(c.mobjMailInfo.senduser,{blank:false})){c.setUpText(".jmail-senduser",c.mobjMailInfo.senduser,"");h.show()}else{c.$mRootElement.find(".jmail-senduser").text("");h.hide()}c.$mRootElement.find(".mail-btn-address").bind("vclick",function(l){l.preventDefault();var k="";var m="";var j=a(l.target).text();var i=neo.mailaddress.parseMailGroup(j);if(i.length>0){k=i[0]["name"];m=i[0]["addr"]}c._checkDuplicateAddress(k,m)});c.$mRootElement.find(".jmail-body").on("vclick","a",function(j){var l=a(j.target);if(!l.is("a")){l=l.closest("a")}var i=l.attr("href");if(!!i&&i.length>0){if(i.match(/^mailto:/i)===null){var k={href:i};desknets.sp.mail.MailExternalLinkConf.setPage(k);desknets.sp.changePage("d-externallinkconf");return false}}return true})},_setUpMailLink:function(c,i,b){var k=this;var h=0;var d=k.$mRootElement.find(c).empty();var f=d.closest("li");if(i instanceof Array&&i.length>0){for(h=0;h<i.length;h++){var e=i[h];var j=neo.mailaddress.createMailbox(e.name,e.addr);if(desknets.sp.menu.boView("addr")){var g=k.$_Tmpl.clone();g.html(desknets.tmpl.escapeWord(j)).appendTo(d).buttonMarkup()}else{if(h>0){j=", "+j}d.append(desknets.tmpl.escapeWord(j))}}f.show()}else{if(typeof(b)=="string"){d.html(b);f.show()}else{f.hide()}}},_getMailBody:function(){var b=this;var c={id:b.getAjaxIdDispBody(),error:function(f,e,d){if(e!="abort"){desknets.sp.ajax.onError(f.status,d)}},dataType:"xml",url:b.getReferRequestURL(),data:{cmd:desknets.sp.mail.CMD_MAILDISPBODY,msgid:b.msId},success:function(e,d,f){b._setUpMailBody(e)},dialogback:true};if(b.msShareAccId){c.data["said"]=b.msShareAccId}desknets.sp.ajax.rest(c)},_setUpMailBody:function(d){var c=this;d=a(d);c.mobjMailInfo.body=d.find("body").text();var b=desknets.sp.getLoginMailLink();var f=c.$mRootElement.find(".jmail-body").empty();var i=d.find("edithtml").text();if(!!i){var e={deniedTags:["SCRIPT","STYLE","TITLE"],allowedSchemas:["http","https","file","mailto","ftp","data"]};i=desknets.convertToSafeHtml(i,e);f.html(i);if(b=="2"||b=="3"){f.find('a[href^="mailto:"]').bind("vclick",function(j){j.preventDefault();var l=String(this.href).substring(7);var k=c._getObjForMailEntry(l);desknets.sp.mobjPages["mailentry-page"].setEntries(k);desknets.sp.changePage("mailentry")})}}else{this.setUpBody(".jmail-body",c.mobjMailInfo.body,"&nbsp;");var h={convertMail:true,convertPhone:true,convertURL:true,urlTarget:"_blank",urlSchemas:["http","https"]};if(b!="1"&&b!="2"&&b!="3"){h.convertMail=false}f.detectHref(h);if(b=="2"||b=="3"){f.find('a[href^="mailto:"]').bind("vclick",function(j){j.preventDefault();var l=String(this.href).substring(7);var k=c._getObjForMailEntry(l);desknets.sp.mobjPages["mailentry-page"].setEntries(k);desknets.sp.changePage("mailentry")})}}var g=c.$mRootElement.find(".mail-bodycut-msg");if(d.find("bodycut").text()=="1"){g.show()}else{g.hide()}},_getObjForMailEntry:function(f){var b=this;var e={};if(typeof(f)=="string"&&f.length>0){f=desknets.unescape(f);var c={};var d=f.indexOf("?");if(f.indexOf("?")>=0){c=desknets.splitParam(f);f=f.substring(0,d)}f=desknets.decodeURIComponentNeo(f);e={to:f,cc:c.cc,bcc:c.bcc,subject:c.subject,body:c.body,accid:b.msAccId}}return e},_getAttachList:function(){var b=this;var c={id:b.getAjaxIdDispAttach(),error:function(f,e,d){if(e!="abort"){desknets.sp.ajax.onError(f.status,d)}},dataType:"xml",url:b.getReferRequestURL(),data:{cmd:desknets.sp.mail.CMD_MAILDISPATTACH,msgid:b.msId},success:function(e,d,f){b._setUpAttachList(e)},dialogback:true};if(b.msShareAccId){c.data["said"]=b.msShareAccId}desknets.sp.ajax.rest(c)},_setUpAttachList:function(c){var l=this;c=a(c);var g=c.find("item");var e=l.$mRootElement.find(".jmail-attach").empty();var f=e.closest("li");if(g.length>0){var k={item:[]};for(var h=0;h<g.length;h++){var j=a(g[h]);var d=l.getAttObj(j);k.item.push(d)}var d=l._parseMsgId(l.msId);var i={cmd:l.getMailDownloadAttachCmd(),fid:d.fid,msgid:d.mailid};if(l.msShareAccId){i.said=l.msShareAccId}var b=l._getAttDisp(k,desknets.sp.MODULE_MAIN,i);if(typeof(b)=="string"&&b.length>0&&b!="&nbsp;"){e.html(b);f.show();return}}f.hide()},_getAttDisp:function(h,c,e){var n=this;if(!h||!h.item){return"&nbsp;"}var g="";var f,l;if(c!=null){c=desknets.getUrl(c)}var i=desknets.ajax.getItems(h.item);var j=desknets.getNeoParam(e);f=i.length;if(f==0){return"&nbsp;"}for(l=0;l<f;l++){var m="",b,o="";var k=i[l];var d=desknets.tmpl.escapeWord(k.attachdisp);if(k.size){o=" ("+desknets.attachDisp.getSize(k.size)+")"}if(l!=0){m=desknets.sp.attachDisp.dispDelimited()}if(c==null||!desknets.sp.isAttachDownload(j)){m=m+d+o}else{b=n.getAttDispUrl(c,j,k);m=m+'<a target="attach" href="'+b+'">'+d+"</a>"+o}g=g+m}if(l>0){g='<div class="jco-attach-area">'+g+"</div>"}return g},getAttObj:function(b){var c={id:b.attr("id"),attachdisp:b.children("attachdisp").text(),mimetype:b.children("mimetype").text(),size:b.children("size").text()};return c},getAttDispUrl:function(e,d,b){var c=e+"?"+d+"&file="+b.id+"&mimetype="+desknets.encodeURIComponentNeo(b.mimetype)+"&Name="+encodeURIComponent(b.attachdisp).replace(/'/g,"%27");return c},_checkDuplicateAddress:function(f,e){var b=this;var c={};c.Name=f;c.Mail=e;if(!neo.isSet(e,{blank:false})){desknets.sp.addr.AddrEntry.setEntries(c);desknets.sp.changePage("addrentry");return}var d={dataType:"xml",url:b.getReferRequestMailURL(),data:{cmd:desknets.sp.mail.CMD_ADDRCHKDUPLICATE,Mail:e},success:function(h,g,j){var i=a(h).find("exist").text();if(i==="1"){desknets.sp.mail.MailAddAddrConf.setPage(b.msId,c);desknets.sp.changePage("d-mailaddaddrconf",{changeHash:false})}else{desknets.sp.addr.AddrEntry.setEntries(c);desknets.sp.changePage("addrentry")}}};desknets.sp.ajax.rest(d)},_parseMsgId:function(c){var b=c.toString().split("_");if(b.length>=2){return{fid:b[0],mailid:b[1]}}else{return{fid:"",mailid:b[0]}}},_prevMailView:function(e){var c=this;if(!c.mobjListDataForView){return}var d=c._getPrevDataId();if(d){c._openMailView(d,false);return}if(!c._hasFirstPageData()&&e===true){var f=c.mobjListDataForView;var b=(f.row||0)-f.range;if(b<0){b=0}f.cond["row"]=b;c._getMailListAdd();return}},_nextMailView:function(e){var c=this;if(!c.mobjListDataForView){return}var d=c._getNextDataId();if(d){c._openMailView(d,true);return}if(!c._hasLastPageData()&&e===true){var f=c.mobjListDataForView;var b=(f.row||0)+f.idList.length;f.cond["row"]=b;c._getMailListAdd();return}},_openMailView:function(e,b){var c=this;var d={};c.setPage(e.id,e.aid);if(b!==true){d.reverse=true}d.allowSamePageTransition=true;desknets.sp.changePage("mailref",d)},_getPrevDataId:function(){var c=this;var d;var e=c.mobjListDataForView;if(e&&e.idList){var b=c._getIndexOwnId(e.idList);if(b>0){d=e.idList[b-1]}}return d},_getNextDataId:function(){var c=this;var e;var f=c.mobjListDataForView;if(f&&f.idList){var b=c._getIndexOwnId(f.idList);var d=f.idList.length;if(b>=0&&b<d-1){e=f.idList[b+1]}}return e},_getIndexOwnId:function(h,g){var c=this;if(h){var f;var b=g;if(!b){b=c.msId}var d=h.length;for(f=0;f<d;f++){var e=h[f];if(e&&e.id==b){return f}}}return -1},_hasFirstPageData:function(){var c=this;var d=c.mobjListDataForView;if(d.hasFirst===true){return true}var b=d.row||0;if(b==0){d.hasFirst=true;return true}return false},_hasLastPageData:function(){var e=this;var h=e.mobjListDataForView;if(h.hasLast===true){return true}if(h){var d=h.allcnt;var c=h.range;var f=h.row;var b=Math.max(Math.ceil(d/c),1);var g=(b-1)*c;if((f+h.idList.length)>g){h.hasLast=true;return true}}return false},_resetPrevNextBtn:function(){var b=this;var f=b.$mRootElement.find(".mail-prev");var e=b.$mRootElement.find(".mail-next");b._disabledPrevNextBtn();f.removeClass("ui-btn-active").addClass("co-hover-clear").hide();e.removeClass("ui-btn-active").addClass("co-hover-clear").hide();if(b.mobjListDataForView){var d;var c;f.show();e.show();d=b._getPrevDataId();if(d||!b._hasFirstPageData()){f.removeClass("ui-state-disabled")}c=b._getNextDataId();if(c||!b._hasLastPageData()){e.removeClass("ui-state-disabled")}}},_disabledPrevNextBtn:function(){var b=this;b.$mRootElement.find(".mail-prev, .mail-next").addClass("ui-state-disabled")}});desknets.page(desknets.sp.mail,"MailMove",desknets.sp.EntryPage,{marMsgId:[],msShareAccId:null,setPage:function(d,b,e){var c=this;c.marMsgId=b;c.msShareAccId=e;c.callBase("setPage",d)},replaceItems:function(){var b=this;b.pageViewEnd()},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sp.mail.CMD_MAILMOVE;c.msgid=b.marMsgId;c.tofid=b.msId;if(b.msShareAccId){c.said=b.msShareAccId}return c},completeToSendEntries:function(){var b=this;desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["maillist-page"].invalidate();desknets.sp.mobjPages["mailsrch-page"].invalidate();desknets.sp.mobjPages["mailref-page"].changeFolder(b.msId);b.$mRootElement.dialog("close");setTimeout(function(){history.back()},100)}});desknets.page(desknets.sp.mail,"MailDel",desknets.sp.DelPage,{arDelIds:[],msShareAccId:null,mboTrash:false,showing:function(){var b=this;b.callBase("showing");var d=b.$mRootElement.find(".jmail-maildel-list-msg");var f=b.$mRootElement.find(".jmail-mailmove-list-msg");var c=b.$mRootElement.find(".jmail-maildel-ref-msg");var e=b.$mRootElement.find(".jmail-mailmove-ref-msg");if(b.mboList===true){c.hide();e.hide();if(b.mboTrash===true){d.show();f.hide()}else{f.show();d.hide()}}else{d.hide();f.hide();if(b.mboTrash===true){c.show();e.hide()}else{e.show();c.hide()}}},setPage:function(h,b,g,d){var c=this;c.arDelIds=h;var f=c.arDelIds.shift();var e=f.ids;c.msShareAccId=g;c.mboTrash=d;c.callBase("setPage",e,b)},completeToSendEntries:function(){var b=this;if(b.arDelIds.length>0){var d=b.arDelIds.shift();var c=d.ids;b.callBase("setPage",c,b.mboList);b.sendEntries();return}b.execAfterajaxStop();b.setInvalidate();b.$mRootElement.dialog("close")},delCloseId:function(){return"mailref"},setInvalidate:function(){desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["maillist-page"].invalidate();desknets.sp.mobjPages["mailsrch-page"].invalidate()},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sp.mail.CMD_MAILDEL;c.msgid=b.msId;if(b.msShareAccId){c.said=b.msShareAccId}return c},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";c.success=function(e,d,f){b.completeToSendEntries()};return c}});desknets.page(desknets.sp.mail,"MailMark",desknets.sp.EntryPage,{msFlag:"0",miSubmitFlag:0,msShareAccId:null,init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jmail-flag-off").bind("vclick",function(d){d.preventDefault();b.miSubmitFlag=0;b.sendEntries()});b.$mRootElement.find(".jmail-flag-on").bind("vclick",function(d){d.preventDefault();b.miSubmitFlag=1;b.sendEntries()});b.$mRootElement.find(".jmail-close").bind("vclick",function(d){d.preventDefault();b.miSubmitFlag=2;b.sendEntries()})},showing:function(){var b=this;b.callBase("showing");var d=b.$mRootElement.find(".jmail-flag-on");var c=b.$mRootElement.find(".jmail-flag-off");if(b.msFlag=="1"){d.hide();c.show()}else{d.show();c.hide()}},setPage:function(c,d,e){var b=this;b.msFlag=d;b.msShareAccId=e;b.callBase("setPage",c)},replaceItems:function(){var b=this;b.pageViewEnd()},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;var c={};c.msgid=b.msId;if(b.miSubmitFlag==0){c.cmd=desknets.sp.mail.CMD_MAILFLAG;c.proc="off"}else{if(b.miSubmitFlag==1){c.cmd=desknets.sp.mail.CMD_MAILFLAG;c.proc="on"}else{c.cmd=desknets.sp.mail.CMD_MAILOPEN;c.proc="close"}}if(b.msShareAccId){c.said=b.msShareAccId}return c},completeToSendEntries:function(){var b=this;if(b.miSubmitFlag==0||b.miSubmitFlag==1){var c=(b.miSubmitFlag==1);desknets.sp.mobjPages["mailref-page"].setMailFlag(c)}else{desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["maillist-page"].setMailOpen(b.msId,false);desknets.sp.mobjPages["mailsrch-page"].setMailOpen(b.msId,false);desknets.sp.mobjPages["mailref-page"].setMailOpen(false)}b.$mRootElement.dialog("close")}});desknets.page(desknets.sp.mail,"MailClose",desknets.sp.EntryPage,{msShareAccId:null,setPage:function(c,d){var b=this;b.msShareAccId=d;b.callBase("setPage",c)},replaceItems:function(){var b=this;b.pageViewEnd()},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sp.mail.CMD_MAILOPEN;c.msgid=b.msId;c.proc="close";if(b.msShareAccId){c.said=b.msShareAccId}return c},completeToSendEntries:function(){var b=this;desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["maillist-page"].invalidate();desknets.sp.mobjPages["mailsrch-page"].invalidate();b.$mRootElement.dialog("close")}});desknets.page(desknets.sp.mail,"MailReply",desknets.sp.ComPage,{msId:"",msAccId:null,init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jmail-reply").bind("vclick",function(d){d.preventDefault();desknets.sp.mobjPages["mailentry-page"].setPage(b.msId,desknets.sp.mail.VAL_SENDMODERE,b.msAccId);desknets.sp.changePage("mailentry")});b.$mRootElement.find(".jmail-reply_all").bind("vclick",function(d){d.preventDefault();desknets.sp.mobjPages["mailentry-page"].setPage(b.msId,desknets.sp.mail.VAL_SENDMODEREALL,b.msAccId);desknets.sp.changePage("mailentry")});b.$mRootElement.find(".jmail-forward").bind("vclick",function(d){d.preventDefault();desknets.sp.mobjPages["mailentry-page"].setPage(b.msId,desknets.sp.mail.VAL_SENDMODEFW,b.msAccId);desknets.sp.changePage("mailentry")});b.$mRootElement.find(".jmail-back").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("mailref",{changeHash:false,transition:"pop",reverse:true})});b.$mRootElement.find('div:jqmData(role="header")').find("a").unbind();b.$mRootElement.find('div:jqmData(role="header")').find("a").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("mailref",{changeHash:false,transition:"pop",reverse:true})})},setPage:function(d,c){var b=this;b.msId=d;b.msAccId=c}});desknets.page(desknets.sp.mail,"MailEntry",desknets.sp.EntryPage,{msSendConf:null,msSendConfPri:null,msSendConfGen:null,msSendConfSetting:null,moSettingPriSendMistake:{},moSettingGenSendMistake:{},moWhiteListAddr:null,msSignMethod:null,msMode:"",msShareAccId:null,mobjSignList:{},_funcNext:null,_icount:0,_iMAX:5,init:function(c){var b=this;b.mboJson=false;b.callBase("init",c);var d=function(){b._icount++;if(b._icount<b._iMAX){return}if(b.msSendConfSetting=="1"){b.msSendConf=b.msSendConfPri}else{b.msSendConf=b.msSendConfGen}b.getRefData()};b._funcNext=d;b.$mRootElement.find(".jmail-send").bind("vclick",function(e){e.preventDefault();if(b.msSendConf==="1"){if(!b._validateSend()){return}var f=b.getEntriesFromReferItem();desknets.sp.mobjPages["d-mailsendconf-page"].setEntries(f);desknets.sp.changePage("d-mailsendconf")}else{if(b.msSendConf==="2"||b.msSendConf==="3"){if(!b._validateSend()){return}var h=b.$mRootElement.find('select[name="accid"] option:selected').text();var g=b.mobjEntries.attach;var f=b.getEntriesFromReferItem();b.setMailSendConfValuePage(f,b.msSendConf,h,g);desknets.sp.changePage("d-mailsendconfvalue")}else{b.sendEntries()}}});b.$mRootElement.find(".jmail-back").bind("vclick",function(e){e.preventDefault();var f=b.getEntriesFromReferItem();desknets.sp.mobjPages["d-mailsave-page"].setEntries(f);desknets.sp.changePage("d-mailsave")});b.$mRootElement.find(".jmail-addrselect").bind("vclick",function(f){f.preventDefault();var e=a(f.target).attr("data-inputkind");if(desknets.sp.menu.boView("addr")&&desknets.sp.menu.boView("uset")){desknets.sp.mail.MailAddrSelect.setKind(e);desknets.sp.changePage("d-mailaddrselect")}else{if(desknets.sp.menu.boView("addr")){desknets.sp.mail.AddrSelect.setKind(e);desknets.sp.changePage("addrselect")}else{if(desknets.sp.menu.boView("uset")){desknets.sp.mail.UserSelect.setKind(e);desknets.sp.changePage("userselect")}}}});b.$mRootElement.find('select[name="accid"]').on("change",function(f){f.preventDefault();var e=a(f.target).val();var g=null;if(desknets.sp.mail.isShareAccountId(e)){g=desknets.sp.mail.getRawShareAccountId(e)}setTimeout(function(){b._getSignList(g)},1)});b.$mRootElement.find('select[name="sign"]').on("change",function(g){g.preventDefault();var f=a(g.target).val();if(!f||f=="0"){return}var e=b.$mRootElement.find('select[name="accid"] option:selected').val();var h=null;if(desknets.sp.mail.isShareAccountId(e)){h=desknets.sp.mail.getRawShareAccountId(e)}setTimeout(function(){b._getSignBody(f,h,function(j,i,k){b._insertSignBody(j,i,k)})},1)});b.$mRootElement.find(".mail-li-file").delegate("a.file-del-btn","vclick",function(e){e.preventDefault();var g=b.mobjEntries.tmpnm;var f=a(e.target).closest("li").attr("data-fno");desknets.sp.mobjPages["d-maildelattconf-page"].setPage(g,f);desknets.sp.changePage("d-maildelattconf")})},setMailSendConfValuePage:function(c,b,e,d){desknets.sp.mobjPages["d-mailsendconfvalue-page"].setEntries(c);desknets.sp.mobjPages["d-mailsendconfvalue-page"].setPage(b,e,d)},setPage:function(e,d,c){var b=this;if(!!d){b.msMode=d}else{b.msMode=""}b.callBase("setEntries",{accid:c});var f=null;if(desknets.sp.mail.isShareAccountId(c)){f=desknets.sp.mail.getRawShareAccountId(c)}b.msShareAccId=f;b._initAttList();b.callBase("setPage",e)},setEntries:function(b){var c=this;c.callBase("setEntries",b);c.msMode="";c.msShareAccId=null;c._initAttList()},delAttach:function(e){var c=this;var f=[];c.$mRootElement.find(".mail-file-list-wrap>li[data-fno="+e+"]").remove();var b=c.mobjEntries.attach;if(b&&b.item){f=desknets.ajax.getItems(b.item);for(var d=0;d<f.length;d++){if(f[d].id==e){f.splice(d,1);break}}}if(f.length==0){delete c.mobjEntries.attach;c._initAttList()}},addMailAddr:function(b,c){var k=this;var h=0;if(k.$mRootElement!==null){var g=k.$mRootElement.find('input[name="'+c+'"]');if(g.length>0&&!!b&&!!b.addr){var i=neo.mailaddress.parseMailGroup(g.val());for(h=0;h<i.length;h++){var d=i[h];if(d.addr==b.addr){return}}var f=neo.mailaddress.createMailbox(b.name,b.addr);var j=g.val();var e=(j=="")?"":", ";j+=e+f;g.val(j)}}},_validateSend:function(){var c=this;if(!neo.isSet(c.$mRootElement.find('input[name="to"]').val(),{blank:false})&&!neo.isSet(c.$mRootElement.find('input[name="cc"]').val(),{blank:false})&&!neo.isSet(c.$mRootElement.find('input[name="bcc"]').val(),{blank:false})){var b="";var d=desknets.Resource.Message.sp_mail_send_required;desknets.sp.msg.view(b,"W:"+d,false);return false}return true},openMailEntryPage:function(b,c){desknets.sp.mail.util.openMail(b,null,c)},isSettingSendConfItem:function(d){var c=this;var b;if(c.msSendConfSetting=="1"){b=c.moSettingPriSendMistake[d]}else{b=c.moSettingGenSendMistake[d]}return(b=="1")},isManySend:function(c){var b=this;var d;if(b.msSendConfSetting=="1"){d=b.moSettingPriSendMistake.manysendcount}else{d=b.moSettingGenSendMistake.manysendcount}return(d<=c)},isWhiteListAddr:function(j){var b=this;var g=b.moWhiteListAddr;if(!neo.isSet(g)){return false}var f=g.list;if(!neo.isSet(f)){return false}for(var d=0;d<f.length;d++){var e=f[d];var h=e.name;var c=j.indexOf(h);if(c>=0){return true}}return false},replaceItems:function(){var b=this;b.clearItems();var c=desknets.sp.getPrm();if(!!c.to){b.mobjEntries.to=c.to;b.mobjEntries.cc=c.cc;b.mobjEntries.bcc=c.bcc;b.mobjEntries.subject=c.subject;b.mobjEntries.body=c.body}b._getInitData()},getRefData:function(){var b=this;b.callBase("replaceItems");if(!!b.msId){b.openMailEntryPage(b.msId,b.msShareAccId);desknets.sp.mobjPages["maillist-page"].setMailOpen(b.msId,true);desknets.sp.mobjPages["mailsrch-page"].setMailOpen(b.msId,true);desknets.sp.mobjPages["mailref-page"].setMailOpen(true)}},getReferRequestURL:function(){return desknets.sp.mail.getRequestURL()},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.dataType="xml";return c},getMailDownloadAttachCmd:function(){return desknets.sp.mail.CMD_MAILDISPATTACHE},getReferRequestData:function(){var b=this;var c={cmd:desknets.sp.mail.CMD_MAILSENDDRAFT,msgid:b.msId,mode:b.msMode,sp:"1"};if(b.msShareAccId){c.said=b.msShareAccId}return c},getEntriesFrom:function(d){var j=this;var k=a(d);var i={};i.fid=k.find("fid").text();i.msgid=k.find("msgid").text();i.size=k.find("size").text();i.mode=k.find("mode").text();i.accid=k.find("accid").text();i.to=k.find("to").text();i.cc=k.find("cc").text();i.bcc=k.find("bcc").text();i.priority=k.find("priority").text();i.send=k.find("send").text();i.subject=k.find("subject").text();i.body=k.find("body").text();i.htmlmail=k.find("htmlmail").text();i.charset=k.find("charset").text();i.tmpnm=k.find("tmpnm").text();var b=k.find("attach");if(b){var f=b.find("item");if(f.length>0){var e={item:[]};for(var g=0;g<f.length;g++){var h=a(f[g]);var c={id:h.attr("id"),attachdisp:h.children("attachdisp").text(),mimetype:h.children("mimetype").text(),size:h.children("size").text()};e.item.push(c)}i.attach=e}}return i},_getInitData:function(){var b=this;b._icount=0;b._getMailSet();b._getMailPSet();b._getWhiteListAddr();b._getAccountList(function(c){var d=b.$mRootElement.find('select[name="accid"] option:selected').val();var e=null;if(desknets.sp.mail.isShareAccountId(d)){e=desknets.sp.mail.getRawShareAccountId(d)}b._getSignList(e,b._funcNext)})},_getMailSet:function(){var b=this;if(b.msSendConfGen!==null){b._funcNext();return}var c={dataType:"xml",url:b.getReferRequestURL(),data:{cmd:desknets.sp.mail.CMD_MAILSETGEN},success:function(e,d,f){b.msSendConfGen=a(e).find("send").text();b.msSendConfSetting=a(e).find("sendcnfsetting").text();b.moSettingGenSendMistake.sendconffrom=a(e).find("sendconffrom").text();b.moSettingGenSendMistake.sendconfto=a(e).find("sendconfto").text();b.moSettingGenSendMistake.sendconfcc=a(e).find("sendconfcc").text();b.moSettingGenSendMistake.sendconfbcc=a(e).find("sendconfbcc").text();b.moSettingGenSendMistake.sendconfpriority=a(e).find("sendconfpriority").text();b.moSettingGenSendMistake.sendconfnotify=a(e).find("sendconfnotify").text();b.moSettingGenSendMistake.sendconfcharset=a(e).find("sendconfcharset").text();b.moSettingGenSendMistake.sendconfsubject=a(e).find("sendconfsubject").text();b.moSettingGenSendMistake.sendconfbody=a(e).find("sendconfbody").text();b.moSettingGenSendMistake.sendconfatt=a(e).find("sendconfatt").text();b.moSettingGenSendMistake.exceptwhitelist=a(e).find("exceptwhitelist").text();b.moSettingGenSendMistake.manysend=a(e).find("manysend").text();b.moSettingGenSendMistake.manysendcount=a(e).find("manysendcount").text();b._funcNext()},dialogback:true};desknets.sp.ajax.rest(c)},_getMailPSet:function(){var b=this;if(b.msSendConfPri!==null){b._funcNext();return}var c={dataType:"xml",url:b.getReferRequestURL(),data:{cmd:desknets.sp.mail.CMD_MAILGENPRIVATE},success:function(e,d,f){b.msSendConfPri=a(e).find("send").text();b.msSignMethod=a(e).find("signmethod").text();b.moSettingPriSendMistake.sendconffrom=a(e).find("sendconffrom").text();b.moSettingPriSendMistake.sendconfto=a(e).find("sendconfto").text();b.moSettingPriSendMistake.sendconfcc=a(e).find("sendconfcc").text();b.moSettingPriSendMistake.sendconfbcc=a(e).find("sendconfbcc").text();b.moSettingPriSendMistake.sendconfpriority=a(e).find("sendconfpriority").text();b.moSettingPriSendMistake.sendconfnotify=a(e).find("sendconfnotify").text();b.moSettingPriSendMistake.sendconfcharset=a(e).find("sendconfcharset").text();b.moSettingPriSendMistake.sendconfsubject=a(e).find("sendconfsubject").text();b.moSettingPriSendMistake.sendconfbody=a(e).find("sendconfbody").text();b.moSettingPriSendMistake.sendconfatt=a(e).find("sendconfatt").text();b.moSettingPriSendMistake.exceptwhitelist=a(e).find("exceptwhitelist").text();b.moSettingPriSendMistake.manysend=a(e).find("manysend").text();b.moSettingPriSendMistake.manysendcount=a(e).find("manysendcount").text();b._funcNext()},dialogback:true};desknets.sp.ajax.rest(c)},_getWhiteListAddr:function(){var b=this;if(b.moWhiteListAddr!==null){b._funcNext();return}var c={dataType:"xml",url:b.getReferRequestURL(),data:{cmd:desknets.sp.mail.CMD_MAILSETWLISTADDR},success:function(e,d,f){b.moWhiteListAddr=b._parseWListAddrList(e);b._funcNext()},dialogback:true};desknets.sp.ajax.rest(c)},_parseWListAddrList:function(d){var b=a(d);var c=b.find(":first > list > item");var f=[];c.each(function(j,g){var h=a(g);var k={id:h.attr("id"),name:h.children("Name").text()};f.push(k)});var e={list:f};return e},_getAccountList:function(d){var b=this;var c={dataType:"xml",url:b.getReferRequestURL(),data:b._getAccountListRequestData(),success:function(f,e,g){b._saveAccountList(f);if(d){d()}b._funcNext()},dialogback:true};desknets.sp.ajax.rest(c)},_getAccountListRequestData:function(){var b=this;var c={cmd:desknets.sp.mail.CMD_MAILACCOUNTS,proc:"3"};return c},_saveAccountList:function(e){var d=this;var b=a(e);var g=d.$mRootElement.find('select[name="accid"]').empty();var c=b.find(":first > list > item");if(neo.isSet(d.msMode,{blank:false})){if(d.msShareAccId){c=c.filter('[id="'+d.msShareAccId+'"]').filter('[share="1"]')}else{c=c.filter('[share="0"]')}}c.each(function(k,h){var j=a(h);var n=j.attr("id");var m="";var l="";if(j.attr("share")=="1"){n=desknets.sp.mail.getEditShareAccountId(n)}l=j.children("name").text();if(neo.isSet(l,{blank:false})){m='"'+l+'"'}m+="<"+j.children("mail").text()+">";g.append('<option value="'+n+'">'+desknets.tmpl.escapeWord(m)+"</option>")});var f=b.find("defacc").text();if(!!d.mobjEntries&&!!d.mobjEntries.accid){f=d.mobjEntries.accid}if(g.children('[value="'+f+'"]').length==0){f=g.children("option:first").val()}g.val(f).selectmenu("refresh")},_getSignList:function(f,e){var b=this;var c;var d="private";if(neo.isSet(f,{blank:false})){d=f}c=b.mobjSignList[d];if(!!c){b._editSignListElement(c);if(e){e()}}else{b._getSignListData(f,e)}},_saveSignList:function(b){var h=this;var j=a(b);var g="private";var f=j.find("said").text();if(!!f){g=desknets.sp.mail.getEditShareAccountId(f)}var e=j.find("signdefault").text();var i=[];var d=j.find(":first > list > item");d.each(function(m,k){var l=a(k);var n={id:l.attr("id"),name:l.children("name").text()};i.push(n)});var c={signdefault:e,item:i};h.mobjSignList[g]=c;return c},_getSignListData:function(e,d){var b=this;var c={dataType:"xml",url:b.getReferRequestURL(),success:function(g,f,i){var h=b._saveSignList(g);b._editSignListElement(h);if(d){d()}},dialogback:true};if(e){c.data={cmd:desknets.sp.mail.CMD_MAILSIGNLISTSHARE,said:e}}else{c.data={cmd:desknets.sp.mail.CMD_MAILSIGNLIST}}desknets.sp.ajax.rest(c)},_editSignListElement:function(g){var k=this;var e=k.$mRootElement.find('select[name="sign"]');var h=e.find(".jmail-nosign");e.empty().append(h);if(g){var f;var d=g.item.length;for(f=0;f<d;f++){var j=g.item[f];var c=j.id;var b=j.name;e.append('<option value="'+c+'">'+desknets.tmpl.escapeWord(b)+"</option>")}e.val("0").selectmenu("refresh")}},_getSignBody:function(d,f,e){var b=this;var c={dataType:"xml",url:b.getReferRequestURL(),success:function(h,g,i){if(e){e(h,g,i)}},dialogback:true};if(f){c.data={cmd:desknets.sp.mail.CMD_MAILSHAREACCSIGN,id:d,said:f}}else{c.data={cmd:desknets.sp.mail.CMD_MAILSIGNENTRY,id:d}}desknets.sp.ajax.rest(c)},_insertSignBody:function(d,e,i,h){var j=this;var c=a(d).find("sign").text();var f=this.$mRootElement.find('textarea[name="body"]');if(!neo.isSet(c,{blank:false})){return}if(!!h){var b="";var g="\n\n"+c;if(h=="1"){b+=g+"\n\n"}b+=f.val();if(h=="2"){b+=g}f.val(b).keyup();return}j._insertAtCaret("\n"+c+"\n");f.keyup()},setUpReferItemFromEntries:function(){var b=this;b.$mRootElement.find('input[name="to"]').val(b.mobjEntries.to);b.$mRootElement.find('input[name="cc"]').val(b.mobjEntries.cc);b.$mRootElement.find('input[name="bcc"]').val(b.mobjEntries.bcc);b.$mRootElement.find('input[name="subject"]').val(b.mobjEntries.subject);b.$mRootElement.find('textarea[name="body"]').val(b.mobjEntries.body).keyup();if(!!b.mobjEntries.accid){var h=b.mobjEntries.accid;if(b.msShareAccId){h=desknets.sp.mail.getEditShareAccountId(h)}var d=b.$mRootElement.find('select[name="accid"]');if(d.children('[value="'+h+'"]').length==0){h=d.children("option:first").val()}d.val(h).selectmenu("refresh")}if(!b.msMode&&!!b.msSignMethod&&b.msSignMethod!="0"){var c=b.$mRootElement.find('select[name="accid"] option:selected').val();var e=null;if(desknets.sp.mail.isShareAccountId(c)){e=desknets.sp.mail.getRawShareAccountId(c)}var f=b.mobjSignList[!!e?c:"private"];if(!!f&&!!f.signdefault){var g=f.signdefault;b._getSignBody(g,e,function(j,i,k){b._insertSignBody(j,i,k,b.msSignMethod)})}}if(!desknets.sp.menu.boView("addr")&&!desknets.sp.menu.boView("uset")){b.$mRootElement.find(".jmail-addrselect").remove()}b._makeHtmlAttList()},_insertAtCaret:function(e){var b=this.$mRootElement.find('textarea[name="body"]').get(0);b.focus();var d=b.value;var f=b.selectionStart;var c=f+e.length;b.value=d.substr(0,f)+e+d.substr(f);b.setSelectionRange(c,c)},_makeHtmlAttList:function(){var n=this;var d,k;var i="";var f=n.mobjEntries.attach;if(!f||!f.item){return}var g=desknets.ajax.getItems(f.item);d=g.length;if(d==0){return}var e={cmd:n.getMailDownloadAttachCmd(),tmpnm:n.mobjEntries.tmpnm};var h=desknets.getNeoParam(e);var l=desknets.sp.isAttachDownload(h);for(k=0;k<d;k++){var j=g[k];var c=desknets.tmpl.escapeWord(j.attachdisp);var m='<li data-fno="'+j.id+'">';m=m+'<a data-role="button" data-mini="true" class="file-del-btn" data-icon="delete" data-iconpos="notext" href="#">&nbsp;</a>';m=m+'<div class="file-name-wrap">';if(!l){m=m+'<span class="file-name">'+c+"</span>"}else{var b=desknets.getUrl(desknets.sp.MODULE_MAIN)+"?"+h+"&fno="+j.id+"&filename="+encodeURIComponent(j.attachdisp).replace(/'/g,"%27");m=m+'<a target="attach" class="file-name" href="'+b+'">'+c+"</a>"}m=m+"</li>";i=i+m}n.$mRootElement.find(".mail-file-list-wrap").html(i).enhanceWithin();n.$mRootElement.find(".mail-li-file").show()},_initAttList:function(){var b=this;if(b.$mRootElement){b.$mRootElement.find(".mail-file-list-wrap").empty();b.$mRootElement.find(".mail-li-file").hide()}},validate:function(){var b=this;return b._validateSend()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sp.mail.CMD_MAILSEND;c.priority="3";c.tmpnm=b.mobjEntries.tmpnm;c.mode=b.mobjEntries.mode;c.proc=b.mobjEntries.proc;c.accid=b.$mRootElement.find('select[name="accid"] option:selected').val();c.to=b.$mRootElement.find('input[name="to"]').val();c.cc=b.$mRootElement.find('input[name="cc"]').val();c.bcc=b.$mRootElement.find('input[name="bcc"]').val();c.subject=b.$mRootElement.find('input[name="subject"]').val();c.body=b.$mRootElement.find('textarea[name="body"]').val();c.msgid="dmy_dmy";if(!!b.msId){c.msgid=b.msId}return c},completeToSendEntries:function(){var c=this;desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["mailsrch-page"].invalidate();var b;if(!!c.mobjEntries&&!!c.mobjEntries.accid){b=c.mobjEntries.accid}desknets.sp.mobjPages["maillist-page"].invalidateMailSend(b,c.mobjEntries.msgid,c.mobjEntries.mode);c.callBase("completeToSendEntries")},});desknets.page(desknets.sp.mail,"MailSave",desknets.sp.EntryPage,{init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jmail-back").bind("vclick",function(d){d.preventDefault();b._closeSaveDialog()});b.$mRootElement.find('div:jqmData(role="header")').find("a").unbind();b.$mRootElement.find('div:jqmData(role="header")').find("a").bind("vclick",function(d){d.preventDefault();b._closeSaveDialog()})},replaceItems:function(){var b=this;b.pageViewEnd()},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;return b.mobjEntries},getSubmitRequestData:function(){var b=this;b.mobjEntries.proc="save";return b.mobjEntries},completeToSendEntries:function(){var c=this;desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["mailsrch-page"].invalidate();var b;if(!!c.mobjEntries&&!!c.mobjEntries.accid){b=c.mobjEntries.accid}desknets.sp.mobjPages["maillist-page"].invalidateMailSave(b);c._closeSaveDialog()},_closeSaveDialog:function(){var b=this;b.$mRootElement.dialog("close");setTimeout(function(){history.back()},100)}});desknets.page(desknets.sp.mail,"MailSendConf",desknets.sp.EntryPage,{init:function(c){var b=this;b.callBase("init",c)},replaceItems:function(){var b=this;b.pageViewEnd()},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;return b.mobjEntries},completeToSendEntries:function(){var c=this;desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["mailsrch-page"].invalidate();var b;if(!!c.mobjEntries&&!!c.mobjEntries.accid){b=c.mobjEntries.accid}desknets.sp.mobjPages["maillist-page"].invalidateMailSend(b,c.mobjEntries.msgid,c.mobjEntries.mode);c.$mRootElement.dialog("close");setTimeout(function(){history.back()},100)}});desknets.page(desknets.sp.mail,"MailAddAddrConf",desknets.sp.ComPage,{msId:"",mobjEntries:{},init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jco-ok").bind("vclick",function(d){d.preventDefault();desknets.sp.addr.AddrEntry.setEntries(b.mobjEntries);desknets.sp.changePage("addrentry")});b.$mRootElement.find(".jmail-back").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("mailref",{changeHash:false,transition:"pop",reverse:true})});b.$mRootElement.find('div:jqmData(role="header")').find("a").unbind();b.$mRootElement.find('div:jqmData(role="header")').find("a").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("mailref",{changeHash:false,transition:"pop",reverse:true})})},setPage:function(d,c){var b=this;b.msId=d;b.mobjEntries=c}});desknets.page(desknets.sp.mail,"MailNotify",desknets.sp.EntryPage,{mboSend:false,msShareAccId:null,init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jmail-send").bind("vclick",function(d){d.preventDefault();b.mboSend=true;b.sendEntries()});b.$mRootElement.find(".jmail-nosend").bind("vclick",function(d){d.preventDefault();b.mboSend=false;b.sendEntries()});b.$mRootElement.find('div:jqmData(role="header")').find("a").unbind();b.$mRootElement.find('div:jqmData(role="header")').find("a").bind("vclick",function(d){d.preventDefault();b.mboSend=false;b.sendEntries()})},setPage:function(c,d){var b=this;b.msShareAccId=d;b.callBase("setPage",c)},replaceItems:function(){var b=this;b.pageViewEnd()},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sp.mail.CMD_MAILNOTIFYSEND;c.msgid=b.msId;if(!b.mboSend){c.proc="no"}if(b.msShareAccId){c.said=b.msShareAccId}return c},completeToSendEntries:function(){var b=this;desknets.sp.mobjPages["mailref-page"].invalidate();b.$mRootElement.dialog("close")}});desknets.page(desknets.sp.mail,"MailRecvErr",desknets.sp.ComPage,{marRecvErr:[],marFilterErr:[],init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jmail-back").bind("vclick",function(d){d.preventDefault();history.back()});b.$mRootElement.find('div:jqmData(role="header")').find("a").unbind();b.$mRootElement.find('div:jqmData(role="header")').find("a").bind("vclick",function(d){d.preventDefault();history.back()})},showing:function(){var j=this;j.callBase("showing");var i=0;var h=j.$mRootElement.find(".mail-recv-err");var e=h.find(".mail-recv-err-items").empty();var g=j.$mRootElement.find(".mail-filter-err");var c=g.find(".mail-filter-err-items").empty();h.hide();g.hide();if(j.marRecvErr.length>0){for(i=0;i<j.marRecvErr.length;i++){var d=j.marRecvErr[i];var f=desknets.tmpl.escapeWord(d.accname);var b="<div>["+f+"] "+desknets.tmpl.escapeWord(d.msg)+"</div>";e.append(b)}h.show()}else{h.hide()}if(j.marFilterErr.length>0){for(i=0;i<j.marFilterErr.length;i++){var d=j.marFilterErr[i];var f=desknets.tmpl.escapeWord(d.accname);var b="[{{filtername}}] ";b+=desknets.tmpl.escapeWord(desknets.Resource.Message.sp_mail_filter_error);b+="(";b+=desknets.tmpl.escapeWord(desknets.Resource.Message.sp_mail_filter_errcnt);b+=")";b=desknets.tmpl.replaceWordChk(b,"filtername",d.filtername||"???");b=desknets.tmpl.replaceWordChk(b,"proc",d.proc||"???");b=desknets.tmpl.replaceWordChk(b,"count",d.count||"???");b='<div class="mail-filter-err">['+f+"] "+b+"</div>";c.append(b)}g.show()}else{g.hide()}setTimeout(function(){j.$mRootElement.find(".co-dialog-err").scrollTop(0)},200)},setPage:function(c,d){var b=this;b.marRecvErr=c;b.marFilterErr=d}});desknets.page(desknets.sp.mail,"MailAddrSelect",desknets.sp.ComPage,{msInputKind:"",init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jmail-select-address").bind("vclick",function(d){d.preventDefault();desknets.sp.mail.AddrSelect.setKind(b.msInputKind);desknets.sp.changePage("addrselect")});b.$mRootElement.find(".jmail-select-user").bind("vclick",function(d){d.preventDefault();desknets.sp.mail.UserSelect.setKind(b.msInputKind);desknets.sp.changePage("userselect")})},setKind:function(b){var c=this;c.msInputKind=b}});desknets.page(desknets.sp.mail,"MailRecvConf",desknets.sp.ComPage,{init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jmail-recv").bind("vclick",function(e){e.preventDefault();var d=b.$mRootElement.find('input[name="recvall"]').prop("checked");desknets.sp.mail.receive.startReceiveMail(null,d)});b.$mRootElement.find(".jmail-back").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("account",{changeHash:false,transition:"pop",reverse:true})});b.$mRootElement.find('div:jqmData(role="header")').find("a").unbind();b.$mRootElement.find('div:jqmData(role="header")').find("a").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("account",{changeHash:false,transition:"pop",reverse:true})})},showing:function(){var b=this;b.callBase("showing");b.$mRootElement.find('input[name="recvall"]').prop("checked",false).checkboxradio("refresh")}});desknets.page(desknets.sp.mail,"MailSendConfValue",desknets.sp.EntryPage,{$mContentElement:null,mboCheck:false,msFromAddr:null,mobjAttach:null,init:function(c){var b=this;b.$mContentElement=c.find(".mail-dialog-send-conf");b.callBase("init",c)},setPage:function(c,e,d){var b=this;b.mboCheck=(c==="3");b.msFromAddr=e;b.mobjAttach=d;b.invalidate()},initPage:function(){var b=this;if(b.mboCheck){b.$mContentElement.delegate("input[type=checkbox]","change",function(c){b._changeCheckBox(a(c.target))})}},_changeCheckBox:function(b){var c=this;var d=c.$mRootElement.find(".jco-ok");var f=b.prop("checked");if(f){if(d.is(":disabled")){var e=c.$mContentElement.find("input[type=checkbox]:not(:checked)").length;if(e==0){d.button("enable").button("refresh")}}}else{if(!d.is(":disabled")){d.button("disable").button("refresh")}}},pageViewEnd:function(){var b=this;var d;d=b.$mContentElement.find("li:visible").length;if(d==0){b.$mRootElement.find(".jmail-sendconfvalue-chk").hide();b.$mRootElement.find(".jmail-sendconfvalue-nochk").hide()}var c=b.$mRootElement.find(".jco-ok");if(b.mboCheck){d=b.$mContentElement.find("input[type=checkbox]:not(:checked)").length;if(d==0){if(c.is(":disabled")){c.button("enable").button("refresh")}}else{if(!c.is(":disabled")){c.button("disable").button("refresh")}}}b.callBase("pageViewEnd")},showingPage:function(){var b=this;if(!b.mbItemRetrieved){b.clearItems()}},clearItems:function(){var b=this;if(b.mboCheck){b.$mRootElement.find(".jmail-sendconfvalue-chk").show();b.$mRootElement.find(".jmail-sendconfvalue-nochk").hide();b.$mRootElement.find(".jco-ok").button("disable").button("refresh")}else{b.$mRootElement.find(".jmail-sendconfvalue-chk").hide();b.$mRootElement.find(".jmail-sendconfvalue-nochk").show();b.$mRootElement.find(".jco-ok").button("enable").button("refresh")}b.$mContentElement.find("li").hide();b.$mContentElement.find(".jmail-from").empty();b.$mContentElement.find(".jmail-to").empty();b.$mContentElement.find(".jmail-cc").empty();b.$mContentElement.find(".jmail-bcc").empty();b.$mContentElement.find(".jmail-subject").empty();b.$mContentElement.find(".jmail-body").empty();b.$mContentElement.find(".jmail-attach").empty();b.$mContentElement.find(".jmail-attach-list").hide()},replaceItems:function(){var b=this;b._setUpSendConfData();b.pageViewEnd();return},getReferRequestURL:function(){return desknets.sp.mail.getRequestURL()},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.dataType="xml";return c},_setUpSendConfData:function(){var j=this;var e;var i;var b;var f;var c;var h;var g;var d="("+a(".mail-sendconfvalue-novalue").text()+")";if(desknets.sp.mobjPages["mailentry-page"].isSettingSendConfItem("sendconffrom")){e="from";i=j.msFromAddr;b=j.$mContentElement.find(".jmail-from");j._setUpSendConfDataOne(i,e,b,j.mboCheck);j.$mContentElement.find(".jmail-sendconfitem-from").show()}f=neo.mailaddress.parseMailGroup(j.mobjEntries.to||"",false,true);if(desknets.sp.mobjPages["mailentry-page"].isSettingSendConfItem("sendconfto")){e="to";b=j.$mContentElement.find(".jmail-to");j._setUpSendConfDataMails(f,e,b,j.mboCheck,d);j.$mContentElement.find(".jmail-sendconfitem-to").show()}c=neo.mailaddress.parseMailGroup(j.mobjEntries.cc||"",false,true);if(desknets.sp.mobjPages["mailentry-page"].isSettingSendConfItem("sendconfcc")){e="cc";b=j.$mContentElement.find(".jmail-cc");j._setUpSendConfDataMails(c,e,b,j.mboCheck,d);j.$mContentElement.find(".jmail-sendconfitem-cc").show()}h=neo.mailaddress.parseMailGroup(j.mobjEntries.bcc||"",false,true);if(desknets.sp.mobjPages["mailentry-page"].isSettingSendConfItem("sendconfbcc")){e="bcc";b=j.$mContentElement.find(".jmail-bcc");j._setUpSendConfDataMails(h,e,b,j.mboCheck,d);j.$mContentElement.find(".jmail-sendconfitem-bcc").show()}if(desknets.sp.mobjPages["mailentry-page"].isSettingSendConfItem("sendconfsubject")){e="subject";i=j.mobjEntries.subject;b=j.$mContentElement.find(".jmail-subject");if(!neo.isSet(i,{blank:false})){i=d}j._setUpSendConfDataOne(i,e,b,j.mboCheck);j.$mContentElement.find(".jmail-sendconfitem-subject").show()}if(desknets.sp.mobjPages["mailentry-page"].isSettingSendConfItem("sendconfbody")){e="body";i=j.mobjEntries.body;b=j.$mContentElement.find(".jmail-body");j._setUpSendConfDataBody(i,e,b,j.mboCheck);j.$mContentElement.find(".jmail-sendconfitem-body").show()}if(desknets.sp.mobjPages["mailentry-page"].isSettingSendConfItem("sendconfatt")){e="attach";g=j.mobjAttach;b=j.$mContentElement.find(".jmail-attach");j._setUpSendConfDataAttach(g,e,b,j.mboCheck)}if(desknets.sp.mobjPages["mailentry-page"].isSettingSendConfItem("manysend")){if(desknets.sp.mobjPages["mailentry-page"].isManySend(f.length+c.length)){e="warning";i=desknets.Resource.Message.sp_mail_warning_manysend;b=j.$mContentElement.find(".jmail-warning");j._setUpSendConfDataOne(i,e,b,j.mboCheck);j.$mContentElement.find(".jmail-sendconfitem-warning").show()}}j.$mContentElement.enhanceWithin();j.$mContentElement.listview("refresh");a(".ui-checkbox a").bind("tap click",function(k,l){k.stopPropagation()})},_setUpSendConfDataOne:function(g,f,e,b){var c=this;var h="";var d=f+"_0";var i=desknets.tmpl.escapeWord(g);if(!neo.isSet(i,{blank:false})){i="&nbsp;"}if(b){h='<input type="checkbox" id="'+d+'" data-mini="true" />';h=h+'<label for="'+d+'">'+i+"</label>"}else{h=i}e.html(h)},_setUpSendConfDataMails:function(m,c,d,f,g){var p=this;var k="";var l=0;if(m instanceof Array&&m.length>0){for(l=0;l<m.length;l++){var i=m[l];var e=c+"_"+l;var b=neo.mailaddress.createMailbox(i.name,i.addr);var n=desknets.tmpl.escapeWord(b);if(!neo.isSet(n,{blank:false})){n="&nbsp;"}var o=a("<p />");if(f){o.append('<div><input type="checkbox" id="'+e+'" data-mini="true" /><label for="'+e+'">'+n+"</label></div>")}else{o.append("<div>"+n+"</div>")}var j=desknets.sp.mobjPages["mailentry-page"].isWhiteListAddr(b);if(j&&desknets.sp.mobjPages["mailentry-page"].isSettingSendConfItem("exceptwhitelist")){var h=o.find("input:checkbox");h.attr("checked",true);h.attr("disabled",true)}else{if(!j){var h=o.find("div");h.addClass("caution")}}k=k+o.html()}}else{var e=c+"_0";var n=g;if(f){k='<input type="checkbox" id="'+e+'" data-mini="true" />';k=k+'<label for="'+e+'">'+n+"</label>"}else{k=n}}d.html(k)},_setUpSendConfDataBody:function(h,b,c,e){var j=this;var g="";var d=b+"_0";var i=desknets.tmpl.escapeWordLF(h);if(e){var f="("+a(".mail-sendconfvalue-bodyconf").text()+")";g='<input type="checkbox" id="'+d+'" data-mini="true" />';g=g+'<label for="'+d+'">'+f+"</label>"}g=g+'<div class="mail-dialog-text">'+i+"</div>";c.html(g)},_setUpSendConfDataAttach:function(j,c,d,f){var r=this;var m="";var n=0;var g=0;if(!j||!j.item){return}var k=desknets.ajax.getItems(j.item);g=k.length;if(g==0){return}var h={cmd:r._getCmdDownLoadAttache(),tmpnm:r.mobjEntries.tmpnm};var l=desknets.getNeoParam(h);var q=desknets.sp.isAttachDownload(l);for(n=0;n<g;n++){var p=k[n];var e=c+"_"+n;var i="";var o=desknets.tmpl.escapeWord(p.attachdisp);if(!neo.isSet(o,{blank:false})){o="&nbsp;"}if(!q){i=o}else{var b=desknets.getUrl(desknets.sp.MODULE_MAIN)+"?"+l+"&fno="+p.id+"&filename="+encodeURIComponent(p.attachdisp).replace(/'/g,"%27");i='<a target="attach" href="'+b+'">'+o+"</a>"}if(f){m=m+'<input type="checkbox" id="'+e+'" data-mini="true" />';m=m+'<label for="'+e+'">'+i+"</label>"}else{if(n==0){m=m+'<div class="mail-file-conf-list-wrap"><ul>'}m=m+"<li>"+i+"</li>";if(n==g){m=m+"</ul></div>"}}}d.html(m);d.closest("li.jmail-attach-list").show()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;return b.mobjEntries},completeToSendEntries:function(){var c=this;desknets.sp.mobjPages["account-page"].invalidate();desknets.sp.mobjPages["folder-page"].invalidate();desknets.sp.mobjPages["folderselect-page"].invalidate();desknets.sp.mobjPages["mailsrch-page"].invalidate();var b;if(!!c.mobjEntries&&!!c.mobjEntries.accid){b=c.mobjEntries.accid}desknets.sp.mobjPages["maillist-page"].invalidateMailSend(b,c.mobjEntries.msgid,c.mobjEntries.mode);c.$mRootElement.dialog("close");setTimeout(function(){history.back()},100)},_getCmdDownLoadAttache:function(){return desknets.sp.mail.CMD_MAILDISPATTACHE}});desknets.page(desknets.sp.mail,"MailExternalLinkConf",desknets.sp.ComPage,{mobjSetting:{},init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jco-ok").bind("vclick",function(d){d.preventDefault();window.open(b.mobjSetting.href,"_blank");b.$mRootElement.dialog("close")})},setPage:function(c){var b=this;b.mobjSetting=c;b.clearItems();b.invalidate()},clearItems:function(){var b=this;b.callBase("clearItems");if(!!b.$mRootElement){b.$mRootElement.find(".mail-external-url").text("")}},replaceItems:function(){var b=this;b.$mRootElement.find(".mail-external-url").text(b.mobjSetting.href);b.callBase("replaceItems")}});desknets.page(desknets.sp.mail,"MailDelAttConf",desknets.sp.EntryPage,{init:function(c){var b=this;b.callBase("init",c)},setPage:function(d,c){var b=this;b.msTmpno=d;b.msFno=c;b.invalidate()},replaceItems:function(){var b=this;b.pageViewEnd()},getSubmitRequestURL:function(){return desknets.sp.mail.getRequestURL()},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.dataType="xml";return c},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sp.mail.CMD_MAILATTACHDEL;c.tmpnm=b.msTmpno;c.fno=b.msFno;return c},completeToSendEntries:function(){var b=this;desknets.sp.mobjPages["mailentry-page"].delAttach(b.msFno);b.$mRootElement.dialog("close")}});desknets.sp.mail.init()})(jQuery);