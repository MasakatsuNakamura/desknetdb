/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.plant={CMD_RPLANTPRIVATE:"plantprivate",CMD_RPLANTHOLDONENTRY:"plantschholdonentry",CMD_PLANTHOLIDAY:"plantholidaylist",PAGE_PLANTYEARCAL:"plantyearcalhtml"};desknets.sp.plant={CMD_PLANTPSETGEN:"plantpsetgen",CMD_PLANTEVENT:"plantevent",VAL_PLANTID:"plant",settingKeys:["disptotime","holiday","sunday","openperm","unit","rokuyou"],init:function(){desknets.sp.mobjPages["grp-page"]=desknets.sp.plant.GroupList;desknets.sp.mobjPages["plant-page"]=desknets.sp.plant.PlantList;desknets.sp.mobjPages["day-page"]=desknets.sp.plant.DayPage;desknets.sp.mobjPages["week-page"]=desknets.sp.plant.WeekPage;desknets.sp.mobjPages["month-page"]=desknets.sp.plant.MonthPage;desknets.sp.mobjPages["year-page"]=desknets.sp.plant.YearPage;desknets.sp.mobjPages["plantref-page"]=desknets.sp.plant.PlantRef;desknets.sp.mobjPages["plantentry-page"]=desknets.sp.plant.PlantEntry;desknets.sp.mobjPages["d-plantevent-page"]=desknets.sp.plant.PlantEvent;desknets.sp.mobjPages["d-plantcolor-page"]=desknets.sp.plant.PlantColor;desknets.sp.mobjPages["d-plantmodconf-page"]=desknets.sp.sch.SchModConf;desknets.sp.mobjPages["d-plantmodrep-page"]=desknets.sp.sch.SchModRep;desknets.sp.mobjPages["d-plantdel-page"]=desknets.sp.sch.SchDel;desknets.sp.mobjPages["d-plantrepdel-page"]=desknets.sp.sch.SchDelRep;desknets.sp.mobjPages["d-plantalldel-page"]=desknets.sp.sch.SchDelAll;desknets.sp.mobjPages["d-planttag-page"]=desknets.sp.sch.SchTag;desknets.sp.mobjPages["d-plantapprove-page"]=desknets.sp.sch.SchApprove;desknets.sp.mobjPages["setotherto-page"]=desknets.sp.sch.OthertoSelPage;desknets.sp.mobjPages["d-schrankflg-page"]=desknets.sp.sch.SchOptions;desknets.sp.mobjPages["d-schreserve-page"]=desknets.sp.sch.SchOptions;desknets.sp.mobjPages["profile-page"]=desknets.sp.UserProfile;desknets.sp.mobjPages["d-userdeselect-page"]=desknets.sp.UserDeselect;desknets.sp.mobjPages["neotwi-page"]=desknets.sp.Neotwi;var b=["listcmd","moduleId","moduleLen","psetcmd","settingKeys"];var c={listcmd:desknets.plant.CMD_RPLANTPRIVATE,moduleId:this.VAL_PLANTID,moduleLen:5,psetcmd:this.CMD_PLANTPSETGEN,settingKeys:this.settingKeys};desknets.sp.sch.util.savePageParams(b,c);desknets.sp.initSetEvents()},getRequestURL:function(){return desknets.sp.getUrl(desknets.MODULE_API_MAIN)}};desknets.sp.plant.util={boAdd:false,setPlantTitle:function(b){b.find("div.jplant-title-pname").html(desknets.sp.sch.util.getTargetName())},getPlantItems:function(c){var b=desknets.cal.tmplList.getJsonItems(c);var d=desknets.cal.item.getItemsFromPlant(b);return d},setPlantAccess:function(b){if(neo.isSet(b)&&b=="1"){this.boAdd=true}else{this.boAdd=false}},setUpPlantMenu:function(d){var b=this;var c=d.$mainMenu.find(".jsch-menu-entry");if(!!b.boAdd){c.show()}else{c.hide()}}};desknets.sp.plant.util.plantCal={settingsKey:"plant",_initSchHead:function(b){this.callBase("_initSchHead",b);desknets.sp.plant.util.setPlantTitle(this.$mRootElement)},_getHolidayDataParams:function(b){var c=this.callBase("_getHolidayDataParams",b);c.cmd=desknets.plant.CMD_PLANTHOLIDAY;return c},_onSchSuccess:function(b){this.callBase("_onSchSuccess",b);desknets.sp.plant.util.setUpPlantMenu(this.menu)},_getEventItemsFromJson:function(b){desknets.sp.plant.util.setPlantAccess(b.accessadd);return desknets.sp.plant.util.getPlantItems(b)}};desknets.page(desknets.sp.plant,"DayPage",desknets.sp.sch.DayPage,a.extend({},desknets.sp.plant.util.plantCal));desknets.page(desknets.sp.plant,"WeekPage",desknets.sp.sch.WeekPage,a.extend({},desknets.sp.plant.util.plantCal));desknets.page(desknets.sp.plant,"MonthPage",desknets.sp.sch.MonthPage,a.extend({},desknets.sp.plant.util.plantCal,{_getSchSubject:function(c,f,d){var h=this.callBase("_getSchSubject",c,f,d);var e=!!f.entry?f.entry:"";var g=a(h).find(".jplant-month-title").text();if(g!=""&&g!="--"&&e!=""){e="("+e+")"}else{if(g=="--"&&e!=""){var b=a("<span />").append(h);b.find(".jplant-month-title").text(e);h=b.html();e=""}}h=desknets.tmpl.replaceWord(h,"entry",e);return h}}));desknets.page(desknets.sp.plant,"YearPage",desknets.sp.sch.YearPage,{_getYearCalCmd:function(){return desknets.plant.PAGE_PLANTYEARCAL}});desknets.page(desknets.sp.plant,"PlantRef",desknets.sp.sch.SchRef,{isHoldOnItem_Place:function(b){return true},isHoldOnItem_Otherto:function(b){return true},isHoldOnItem_Pids:function(b){var c=[];if(!!b){c=desknets.ajax.getItems(b.item)}if(c.length==1&&c[0].id==desknets.sp.sch.util.getTargetID()){return false}return true},isHoldOnItem_Option:function(b){if(!b){return false}if(neo.isSet(b.level,{blank:false})||neo.isSet(b.outflg,{blank:false})||neo.isSet(b.rankflg,{blank:false})||neo.isSet(b.reserve,{blank:false})){return true}return false},getSchReferCmd:function(){return desknets.cal.CMD_PLANT_REF},});desknets.page(desknets.sp.plant,"PlantEntry",desknets.sp.sch.SchEntry,{_selPids:[],mreservschlimit:0,init:function(c){var b=this;b.callBase("init",c);b.mThisObj=desknets.sp.plant.PlantEntry;b.$mRootElement.find(".jplant-entry-sel").on("vclick",function(d){d.preventDefault();var e="d-plant"+a(this).data("page");desknets.sp.changePage(e)});b.$mRootElement.find(".jsch-entry-color").off("vclick");b.$mRootElement.find(".jsch-entry-color").on("vclick",function(d){d.preventDefault();desknets.sp.changePage("d-plantcolor")})},show:function(){var b=this;desknets.sp.plant.util.setPlantTitle(b.$mRootElement);b.callBase("show")},setUpReferItemFromEntries:function(){var b=this;var d=[];b.setUpReferItem_Common();var c=b.isGetReservLimitPlant();b.setUpReferItem_CommonOption(c);if(!!b.mobjEntries.pids){d=desknets.ajax.getItems(b.mobjEntries.pids.item)}else{d=[{id:desknets.sp.sch.util.getTargetID()}]}b._selPids=d;b.setColor(b.mobjEntries.schcolor)},getInitialEntries:function(){var b=this;var c=desknets.sp.sch.getDefColor();c.reservschlimit=b.mreservschlimit;return c},getSubmitRequestURL:function(){return desknets.sp.plant.getRequestURL()},getEntriesFromReferItem:function(){var b=this;var c={};c=a.extend({},b.getEntriesFromItem_Common());for(var d=0;d<b._selPids.length;d++){c.pids=b._selPids[d].id}if(!c.sid){c.cmd=b.$mRootElement.find('input[name="entrycmd"]').val()}else{c.cmd=desknets.plant.CMD_RPLANTHOLDONENTRY}return c},setColor:function(c){var b=this;desknets.sp.sch.setColor(b.$mRootElement,c)},setColorString:function(c){var b=this;desknets.sp.sch.setColorString(b.$mRootElement,c)}});desknets.page(desknets.sp.plant,"PlantEvent",desknets.sp.sch.SchSelCom,{initPage:function(){var b=this;b.callBase("initPage");b.msName="event"},initPageSetUpOk:function(){var b=this;b.$mRootElement.find(".jco-ok").on("vclick",function(c){c.preventDefault();var e=b.$mRootElement.find('select[name="'+b.msName+'"] option:selected');var d=e.val();if(d=="--"){d=""}b.getEntryClass().setStringItem(b.msName,d);b.getEntryClass().setColorString(e.data("color"));history.back()})},getReferRequestData:function(){var b={cmd:desknets.sp.plant.CMD_PLANTEVENT};return b},getEntryClass:function(){return desknets.sp.plant.PlantEntry},setUpReferItem:function(d){var j=this;var c=[];var h=0;var i=null;var g="";var b=0;var e=desknets.ajax.getJsonItems(d);var f=j.$mRootElement.find('select[name="'+j.msName+'"]');f.on("change",function(n,o){var l=j.$mRootElement.find('select[name="'+j.msName+'"] option:selected');var p=l.data("color");if(!!p){var m=a("#plantevent-button").find("span");var k=m.html();m.html('<div class="sch-edit-color '+p+'"></div>'+k)}});b=e.length;if(b>0){for(h=0;h<b;h++){i=e[h];g='<option value="'+desknets.tmpl.escapeWord(i.Name)+'" + data-color="'+desknets.tmpl.escapeWord(i.schcolorname)+'">'+desknets.tmpl.escapeWord(i.schcolorname)+":"+desknets.tmpl.escapeWord(i.Name)+"</option>";c[c.length]=g}f.append(a(c.join(""))).enhanceWithin();f.selectmenu("refresh");a("#plantevent-menu").find("a.ui-btn").each(function(n,o){var p=a(this);var k=p.html();var m=k.indexOf(":");if(m>0){var q=k.substring(0,m);var l=k.substring(m+1,k.length);p.html('<div class="sch-edit-color '+q+'"></div> &nbsp;&nbsp;'+l)}});a("#plantevent").find("option").each(function(n,o){var p=a(this);var k=p.html();var m=k.indexOf(":");if(m>0){var q=k.substring(0,m);var l=k.substring(m+1,k.length);p.html('<div class="sch-edit-color '+q+'"></div> &nbsp;&nbsp;'+l)}})}}});desknets.page(desknets.sp.plant,"PlantColor",desknets.sp.ComPage,{init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".sch-color-select-btn").bind("vclick",function(d){d.preventDefault();desknets.sp.plant.PlantEntry.setColor(a(this).data("colorval"));history.back()})}});desknets.page(desknets.sp.plant,"GroupList",desknets.sp.ListPage,{date:desknets.dateTime.current,boall:true,$_TmplAll:null,init:function(c){var b=this;b.callBase("init",c);if(!!b.boall){b.$_TmplAll=b.$mRootElement.find(".jplant-grpall").remove()}},setSchDate:function(b){this.date=b},getListRequestURL:function(){return desknets.sp.plant.getRequestURL()},getListRequestData:function(c,d){var b=this;return{cmd:desknets.sch.CMD_PLANTSELPGROUP,row:c,num:d}},getAjaxId:function(){return"dnsp-plantgrp"},delMore:function(){var b=this;b.callBase("delMore");b.$listElement.find(".jplant-grpall").remove()},updateContainerElement:function(c){var b=this;b.callBase("updateContainerElement",c);if(b.$_TmplAll&&b.miStartIndex==0){b.$listElement.show();b.$noItemsContainerElement.hide();var d=b.$listElement.children(":first-child");if(d.length==0){b.$listElement.append(b.$_TmplAll.clone())}else{b.$_TmplAll.clone().insertBefore(d)}}},setUpListItem:function(d,c){var b=this;b.callBase("setUpListItem",d,c);c.find("h3").html(desknets.tmpl.escapeWord(d.Name))},openListItem:function(b,c){desknets.sp.plant.PlantList.setSchDate(this.date);desknets.sp.plant.PlantList.setPlantId(c);desknets.sp.plant.PlantList.invalidate();desknets.sp.changePage("plant")}});desknets.page(desknets.sp.plant,"PlantList",desknets.sp.plant.GroupList,{plantId:"",boall:false,setPlantId:function(b){this.plantId=b},getListRequestData:function(c,d){var b=this;return{cmd:desknets.sch.CMD_PLANTSELPLANT,gid:b.plantId,row:c,num:d}},getAjaxId:function(){return"dnsp-plant"},setUpListItem:function(d,c){var b=this;b.callBase("setUpListItem",d,c);c.find("h3").data("reservschlimit",d.reservschlimit)},openListItem:function(c,e){var b=c.find("h3").html();desknets.sp.sch.util.setTargetName(b);desknets.sp.plant.PlantEntry.mreservschlimit=c.find("h3").data("reservschlimit");var d=neo.storage.local(desknets.sp.COOKIENAME_SETTING);if(!!d&&!!d.schToppage){pageID=d.schToppage.substring(3)}else{pageID="month"}var f=desknets.sp.mobjPages[pageID+"-page"];f.setSchDate(this.date);desknets.sp.sch.util.setTargetId(e);desknets.sp.mobjPages["day-page"].invalidate();desknets.sp.mobjPages["week-page"].invalidate();desknets.sp.mobjPages["month-page"].invalidate();desknets.sp.mobjPages["year-page"].invalidate();desknets.sp.changePage(pageID)}});desknets.sp.plant.init()})(jQuery);