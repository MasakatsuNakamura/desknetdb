/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.info={newIcon:"New",MODULE_API_INFO:"zrinfo",CMD_INFOINDEX:"infocmdindex",CMD_INFOCATELISTC:"infocatelistchild",CMD_INFOUNREAD:"infocmdunread",CMD_INFOREFER:"infocmdrefer",CMD_INFOREFATTACH:"infodispattach",CMD_INFOSEARCHINDEX:"infocmdsrchindex",CMD_INFOSEARCHSTOP:"infocmdsrchstop",CMD_INFOREFSETTAG:"infocmdsettag",CMD_INFOIMAGE:"infoimage"};desknets.sp.info={init:function(){desknets.sp.mobjPages["cate-page"]=desknets.sp.info.CateList;desknets.sp.mobjPages["info-page"]=desknets.sp.info.InfoList;desknets.sp.mobjPages["inforef-page"]=desknets.sp.info.InfoRef;desknets.sp.mobjPages["d-infotag-page"]=desknets.sp.info.InfoTag;desknets.sp.mobjPages["d-inforead-page"]=desknets.sp.info.InfoRead;desknets.sp.mobjPages["infosrch-page"]=desknets.sp.info.InfoSrch;desknets.sp.mobjPages["infosetsrch-page"]=desknets.sp.info.InfoSetSrch;desknets.sp.mobjPages["neotwi-page"]=desknets.sp.Neotwi;var c=[];var b=desknets.sp.getPrm();if(neo.isSet(b.id)){c=["inforef-page"]}desknets.sp.initSetEvents(c)},getRequestURL:function(){return desknets.sp.getUrl(desknets.info.MODULE_API_INFO)},};desknets.page(desknets.sp.info,"CateList",desknets.sp.FolderPage,{$_TmplAllCate:null,init:function(c){var b=this;b.mboChk=false;b.callBase("init",c);b.$_TmplAllCate=b.$mRootElement.find(".jinfo-allcate").remove();b.$mRootElement.find(".jinfo-srch").bind("vclick",function(d){d.preventDefault();desknets.sp.info.InfoSrch.getDefSrchCate(desknets.sp.info.InfoList.msFolderId,desknets.sp.info.InfoList.msFolderName);desknets.sp.info.InfoSrch.getDefSrch(true);desknets.sp.changePage("infosrch")})},getListRequestURL:function(){return desknets.sp.info.getRequestURL()},getListRequestData:function(d,e){var b=this;var f="";if(b.mobjParent!=null){f=b.mobjParent.id}var c={cmd:desknets.info.CMD_INFOCATELISTC,pfolder:f};return c},getAjaxId:function(){return"dnsp-infocate"},updateContainerElement:function(c){var b=this;if(b.mobjParent==null){var d=b.$listElement.children(":first-child");if(d.length==0){b.$listElement.append(b.$_TmplAllCate.clone())}else{b.$_TmplAllCate.clone().insertBefore(d)}b.$listElement.find(".jinfo-allcate").removeClass("ui-li-has-alt").find(".jco-listsub").remove()}b.callBase("updateContainerElement",c)},setUpListItem:function(d,c){var b=this;b.callBase("setUpListItem",d,c);c.find("h3").html(desknets.tmpl.escapeWord(d.Name));if(!neo.isSet(d.list)){c.removeClass("ui-li-has-alt").find(".jco-listsub").remove()}},openListItem:function(d,f){var c=this;var e=[];var b=c.marFolderList.length;for(var g=0;g<b;g++){e[g]=c.marFolderList[g]}if(c.mobjParent!=null){e[b]=c.mobjParent}e[e.length]={id:f,Name:d.find("h3").text()};desknets.sp.info.InfoList.setFolder(f,d.find("h3").text(),e);desknets.sp.changePage("info")},});desknets.page(desknets.sp.info,"InfoList",desknets.sp.ListSetPage,{msFolderId:"0",msFolderName:desknets.Resource.allLabel,marFolderList:[],init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jinfo-cate").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("cate",{reverse:true})});b.$mRootElement.find(".jinfo-srch").bind("vclick",function(d){d.preventDefault();desknets.sp.info.InfoSrch.getDefSrchCate(b.msFolderId,b.msFolderName);desknets.sp.info.InfoSrch.getDefSrch(true,b.msFolderId);desknets.sp.changePage("infosrch")});b.$mRootElement.find(".jinfo-read").bind("vclick",function(e){e.preventDefault();var d=b.getChkId();if(d!==false){desknets.sp.info.InfoRead.setPage(d);desknets.sp.changePage("d-inforead")}else{b._listChgClick()}});b.marFolderList[0]={id:"0",Name:b.msFolderName}},showing:function(){var b=this;b.callBase("showing");b.showingInfoPage()},showingInfoPage:function(){var b=this;b.setCateView()},setCateView:function(){var c=this;var b=c.marFolderList.length;var e="";for(var d=0;d<b;d++){if(e!=""){e=e+" &gt; "}e=e+desknets.tmpl.escapeWord(c.marFolderList[d].Name)}c.$mRootElement.find(".co-subtitle").find("span").html(e)},setFolder:function(b,d,e){var c=this;c.msFolderId=b;c.msFolderName=d;c.marFolderList=e;c.invalidate()},getListRequestURL:function(){return desknets.sp.info.getRequestURL()},getListRequestData:function(d,e){var c=this;var b=c.msFolderId;if(b==""||b==null){b="0"}return{cmd:desknets.info.CMD_INFOINDEX,fid:b,row:d,num:e,}},getAjaxId:function(){return"dnsp-info"},setUpListItem:function(e,d){var c=this;c.callBase("setUpListItem",e,d);if(e.read=="1"){d.addClass("new")}var b="";if(e.priority=="1"){d.find(".co-importance.high").remove();d.find(".co-importance.low").remove()}else{if(e.priority=="2"){d.find(".co-importance.haste").remove();d.find(".co-importance.low").remove()}else{if(e.priority=="4"){d.find(".co-importance.haste").remove();d.find(".co-importance.high").remove()}else{d.find(".co-importance").remove()}}}d.find("h3").append(b+desknets.tmpl.escapeWord(e.subject));d.find("input[type=checkbox]").attr("id","info-chk-list-"+e.id);d.find("label").attr("for","info-chk-list-"+e.id)},openListItem:function(c,d){var b=this;if(!b.mboSet){c.removeClass("new")}desknets.sp.info.InfoRef.setPage(d);desknets.sp.changePage("inforef")},});desknets.page(desknets.sp.info,"InfoRef",desknets.sp.RefPage,{msTag:"0",initPage:function(){var b=this;b.callBase("initPage");b.$mRootElement.find(".jinfo-tag").bind("vclick",function(d){d.preventDefault();desknets.sp.info.InfoTag.setPage(b.msId,b.msTag);desknets.sp.changePage("d-infotag")});if(!neo.isSet(b.msId,{blank:false})){var c=desknets.sp.getPrm();if(neo.isSet(c.id)){desknets.sp.info.InfoRef.setPage(c.id)}else{desknets.sp.resetPage()}}},getReferRequestURL:function(){return desknets.sp.info.getRequestURL()},getReferRequestData:function(){var b=this;var c={cmd:desknets.info.CMD_INFOREFER,id:b.msId,};return c},setUpReferItem:function(g){var c=this;c.msTag=g.tagcolor;c.setUpText(".jinfo-makename",g.makename);var f=g.entry;if(neo.isSet(g.defgroup,{blank:false})){f=f+" "+g.defgroup}c.setUpText(".jinfo-entryuser",f);var e=g.updateuser;if(neo.isSet(g.updusergroup,{blank:false})){e=e+" "+g.updusergroup}c.setUpText(".jinfo-upduser",e);c.setUpDate(".jinfo-cretime",g.cretime);c.setUpDate(".jinfo-updtime",g.updtime);c.setUpDate(".jinfo-sdate",g.sdate);c.setUpDate(".jinfo-edate",g.edate);var d={cmd:desknets.info.CMD_INFOREFATTACH,id:c.msId};c.setUpFile(".jinfo-attach",g.attach,d);var b=desknets.tmpl.dispItems(g.category,null,null,null,"<br />\n");if(neo.isSet(b,{blank:false})&&b!="&nbsp;"){c.$mRootElement.find(".jinfo-cate").html(b).closest("li").removeClass("none")}else{c.$mRootElement.find(".jinfo-cate").closest("li").addClass("none")}var h=desknets.tmpl.dispItems(g.viewers,null,null,null,"<br />\n");if(neo.isSet(h,{blank:false})&&h!="&nbsp;"){c.$mRootElement.find(".jinfo-viewers").html(h).closest("li").removeClass("none")}else{c.$mRootElement.find(".jinfo-viewers").closest("li").addClass("none")}c.$mRootElement.find(".co-importance").hide();if(g.important=="1"){c.$mRootElement.find(".co-importance.haste").show()}else{if(g.important=="2"){c.$mRootElement.find(".co-importance.high").show()}else{if(g.important=="4"){c.$mRootElement.find(".co-importance.low").show()}}}c.setUpText(".jinfo-subject",g.subject);c.setUpInfoBody(g.edithtml)},setUpInfoBody:function(c){var b=this;var f=b.$mRootElement.find(".co-content");var d="";if(neo.isSet(c,{blank:false})){d=desknets.tmpl.replaceWordHtml(c,"cmd",desknets.info.CMD_INFOIMAGE);var h=new RegExp('src="zinfo.',"ig");d=d.replace(h,'src="'+desknets.sp.MODULE_MAIN+".");h=new RegExp('href="zinfo.',"ig");d=d.replace(h,'href="'+desknets.sp.MODULE_MAIN+".");var g="cmd="+desknets.info.CMD_INFOIMAGE;d=desknets.sp.getAttachUrlDel(g,d);d=desknets.rte.convertForShow(d)}f.html(d);var e={convertMail:false,convertPhone:true,convertURL:false};f.detectHref(e);desknets.sp.setUpMailLink(f)},dispItemsCate:function(j,o,e,f,d){var h="";var k=[];var i=[];if(!j||!j.item){return"&nbsp;"}k=desknets.ajax.getItems(j.item);if(k.length==0){return"&nbsp;"}if(o!=undefined){if(!(!o||!o.item)){i=desknets.ajax.getItems(o.item)}}for(var n=0;n<k.length;n++){var p="";var m="";var c=k[n];if(n!=0){if(d==undefined){p=",\n"}else{p=d}}if(c.val!=undefined){m=desknets.tmpl.escapeWord(c.val)}p=p+m;if(i.length>n){var g="";var b=i[n];if(b.val){g=desknets.tmpl.escapeWord(b.val)}if(g.length>0){if(e){var l=desknets.tmpl.replaceWordChkHtml(e,f,g);p=p+l}else{p=p+"("+g+")"}}}h=h+p}return h},});desknets.page(desknets.sp.info,"InfoTag",desknets.sp.TagPage,{setInvalidate:function(){var b=this;desknets.sp.info.InfoList.invalidate();desknets.sp.info.InfoSrch.invalidate()},getEntriesFromReferItem:function(){var b=this;var c=b.callBase("getEntriesFromReferItem");c.cmd=desknets.info.CMD_INFOREFSETTAG;return c},getSubmitRequestURL:function(){return desknets.sp.info.getRequestURL()},completeTag:function(c){var b=this;desknets.sp.info.InfoRef.msTag=c},});desknets.page(desknets.sp.info,"InfoRead",desknets.sp.EntryPage,{replaceItems:function(){var b=this;b.pageViewEnd()},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.info.CMD_INFOUNREAD;c.id=b.msId;return c},getSubmitRequestURL:function(){return desknets.sp.info.getRequestURL()},completeToSendEntries:function(){var b=this;desknets.sp.info.InfoList.invalidate();b.$mRootElement.dialog("close")}});desknets.page(desknets.sp.info,"InfoSrch",desknets.sp.SearchBatPage,{mobjSrch:{},msCateId:"",msCateName:"",initPage:function(){var b=this;b.callBase("initPage");b.$mRootElement.find(".jinfo-setsrch").bind("vclick",function(c){c.preventDefault();b._handleListClickSrch()});b.$mRootElement.find(".jinfo-cate").bind("vclick",function(c){c.preventDefault();desknets.sp.changePage("cate",{reverse:true})})},showFirstPage:function(){var b=this;b.callBase("showFirstPage");b.setSrchView()},clearItems:function(){var b=this;b.callBase("clearItems");b.mboInit=true},chkSearch:function(){var d=this;if(d.$mRootElement.find('input[name="srch_key"]').val()==""&&(d.mobjSrch.srch_catekind=="0"||d.mobjSrch.fid=="0"||d.mobjSrch.fid=="")&&d.mobjSrch.srch_attach==""&&d.mobjSrch.srch_important=="0"&&d.mobjSrch.sdate==""&&d.mobjSrch.edate==""){var b=desknets.Resource.searchcond;var c="";var e=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",b);desknets.sp.msg.view(c,"W:"+e,false);return false}return true},replaceItems:function(){var b=this;b.callBase("replaceItems");b.setSrchView()},setSrchView:function(){var b=this;b.$mRootElement.find('input[name="srch_key"]').val(b.mobjSrch.srch_key).searchkeychg();if(b.mobjSrch.srch_catekind=="1"&&b.mobjSrch.fid!="0"&&b.mobjSrch.fid!=""){b.$mRootElement.find(".jinfo-catekind").show();b.$mRootElement.find(".jinfo-srchcatekind").html(desknets.tmpl.escapeWord(b.msCateName))}else{b.$mRootElement.find(".jinfo-catekind").hide()}if(b.mobjSrch.srch_attach=="1"){b.$mRootElement.find(".jinfo-attach").show()}else{b.$mRootElement.find(".jinfo-attach").hide()}if(b.mobjSrch.srch_important!="0"){b.$mRootElement.find(".jinfo-important").show();b.$mRootElement.find(".jinfo-im").hide();b.$mRootElement.find(".jinfo-im-"+b.mobjSrch.srch_important).show()}else{b.$mRootElement.find(".jinfo-important").hide()}if(b.mobjSrch.sdate==""&&b.mobjSrch.edate==""){b.$mRootElement.find(".jinfo-date").hide()}else{b.$mRootElement.find(".jinfo-sdate").html(b.mobjSrch.sdate);b.$mRootElement.find(".jinfo-edate").html(b.mobjSrch.edate);b.$mRootElement.find(".jinfo-date").show()}},getListRequestURL:function(){return desknets.sp.info.getRequestURL()},getAjaxId:function(){return"dnsp-infosrch"},getListRequestData:function(f,e){var j=this;var i=j.callBase("getListRequestData",f,e);var c=j.mobjSrch.fid;var g=j.mobjSrch.srch_catekind;if(c=="0"){c="";g="0"}var h=desknets.Resource.dateFormat;var b=desknets.sp.changeDateFormat_JP(h,j.mobjSrch.sdate);var d=desknets.sp.changeDateFormat_JP(h,j.mobjSrch.edate);a.extend(i,{cmd:desknets.info.CMD_INFOSEARCHINDEX,srch_key:j.mobjSrch.srch_key,fid:c,srch_catekind:g,srch_attach:j.mobjSrch.srch_attach,srch_important:j.mobjSrch.srch_important,sdate:b,edate:d,});return i},_getStopBatSearchCmd:function(){return desknets.info.CMD_INFOSEARCHSTOP},setUpListItem:function(e,d){var c=this;this.callBase("setUpListItem",e,d);var b="";if(e.priority=="1"){d.find(".co-importance.high").remove();d.find(".co-importance.low").remove()}else{if(e.priority=="2"){d.find(".co-importance.haste").remove();d.find(".co-importance.low").remove()}else{if(e.priority=="4"){d.find(".co-importance.haste").remove();d.find(".co-importance.high").remove()}else{d.find(".co-importance").remove()}}}d.find("h3").append(b+desknets.tmpl.escapeWord(e.subject))},openListItem:function(c,d){var b=this;desknets.sp.info.InfoRef.setPage(d);desknets.sp.changePage("inforef")},_handleListClickSrch:function(){var b=this;desknets.sp.info.InfoSetSrch.setPage(b.mobjSrch);desknets.sp.changePage("infosetsrch")},getDefSrchCate:function(c,d){var b=this;b.msCateId=c;b.msCateName=d},getDefSrch:function(d,c){var b=this;b.callBase("getDefSrch",d);b.mobjSrch={srch_key:"",fid:b.msCateId,fname:b.msCateName,srch_catekind:"1",srch_attach:"",srch_important:"0",sdate:"",edate:"",}},});desknets.page(desknets.sp.info,"InfoSetSrch",desknets.sp.ComPage,{mobjSrch:{},init:function(c){var b=this;b.callBase("init",c);desknets.sp.seldate.setUpDate(b.$mRootElement);b.$mRootElement.find(".jinfo-srch").bind("vclick",function(g){g.preventDefault();b.mobjSrch.srch_key=b.$mRootElement.find('input[name="srch_key"]').val();b.mobjSrch.srch_catekind=b.$mRootElement.find('select[name="srch_catekind"] option:selected').val();b.mobjSrch.srch_attach=b.$mRootElement.find('input[name="srch_attach"]:checked').val();b.mobjSrch.srch_important=b.$mRootElement.find('select[name="srch_important"] option:selected').val();b.mobjSrch.sdate=b.$mRootElement.find('input[name="sdate"]').val();b.mobjSrch.edate=b.$mRootElement.find('input[name="edate"]').val();if(b.mobjSrch.srch_key==""&&(b.mobjSrch.srch_catekind=="0"||b.mobjSrch.fid=="0"||b.mobjSrch.fid=="")&&b.mobjSrch.srch_attach==""&&b.mobjSrch.srch_important=="0"&&b.mobjSrch.sdate==""&&b.mobjSrch.edate==""){var d=desknets.Resource.searchcond;var e="";var f=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",d);desknets.sp.msg.view(e,"W:"+f,false)}else{desknets.sp.info.InfoSrch.setSrch(a.extend({},b.mobjSrch));history.back()}});b.$mRootElement.find(".jinfo-clear").bind("vclick",function(d){d.preventDefault();b.$mRootElement.find('input[name="srch_key"]').val("").searchkeychg();b.$mRootElement.find('select[name="srch_catekind"]').val("1").selectmenu("refresh");b.$mRootElement.find('input[name="srch_attach"]').val([""]).checkboxradio("refresh");b.$mRootElement.find('select[name="srch_important"]').val("0").selectmenu("refresh");b.$mRootElement.find('input[name="sdate"]').val("");b.$mRootElement.find('input[name="edate"]').val("")})},show:function(){var b=this;b.callBase("show");b.$mRootElement.find('input[name="srch_key"]').val(b.mobjSrch.srch_key).searchkeychg();b.$mRootElement.find(".jinfo-cate").html(desknets.tmpl.escapeWord(b.mobjSrch.fname));b.$mRootElement.find('select[name="srch_catekind"]').val(b.mobjSrch.srch_catekind).selectmenu("refresh");b.$mRootElement.find('input[name="srch_attach"]').val([b.mobjSrch.srch_attach]).checkboxradio("refresh");b.$mRootElement.find('select[name="srch_important"]').val(b.mobjSrch.srch_important).selectmenu("refresh");b.$mRootElement.find('input[name="sdate"]').val(b.mobjSrch.sdate);b.$mRootElement.find('input[name="edate"]').val(b.mobjSrch.edate)},setPage:function(b){var c=this;c.mobjSrch=a.extend({},b)}});desknets.sp.info.init()})(jQuery);