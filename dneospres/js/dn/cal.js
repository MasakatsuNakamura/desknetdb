/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.cal={SEL_DAY:".cal-day",SEL_WEEK_BTN:".cal-weeklink",CLASS_SUNDAY:"co-sunday",CLASS_SATURDAY:"co-saturday",CLASS_OTHER_MONTH:"cal-other-month",CGI_SCH:"",CGI_SCH_REST:"",CGI_TODO:"",CGI_TODO_REST:"",CGI_AGENDA:"zagenda",PAGE_SCH_INDEX:"schindex",PAGE_SCH_REF:"schreferdtl",PAGE_SCH_ADD:"schadd",CMD_SCH_REF:"schref",CMD_SCH_DEL:"schdel",PAGE_PLANT_INDEX:"plantweekgrp",PAGE_PLANT_REF:"plantreferdtl",PAGE_PLANT_ADD:"plantadd",CMD_PLANT_REF:"schref",CMD_PLANT_DEL:"schdel",PAGE_TODO_INDEX:"todolist",PAGE_TODO_REF:"todotaskref",CMD_TODO_REF:"todocmdtaskref",CMD_TODO_COMPLETE:"todocmdtaskcomplete",PAGE_AGNEDA_REF:"agendarefer",PAGE_AGNEDA_ENTRY:"agendaentry",PAGE_AGENDA_INDEX:"agendaindex",MAX_POP_MEMOCOL:"44",MAX_POP_MEMOROW:"5",REPEAT_RANDOM:"r",PUBLIC_LEVEL_OPEN:"open",PUBLIC_LEVEL_SECRET:"secret",PUBLIC_LEVEL_PERMIT:"permission",init:function(){this.CGI_SCH=desknets.getUrl(desknets.MODULE_MAIN);this.CGI_SCH_REST=desknets.getUrl(desknets.MODULE_API_MAIN);this.CGI_TODO=this.CGI_SCH;this.CGI_TODO_REST=this.CGI_SCH_REST;desknets.cal.tmpl.init();desknets.cal.refPopUp.init()},updateCmds:function(b){for(var c in b){if(typeof desknets.cal[c]=="string"){desknets.cal[c]=b[c]}}},getSubject:function(b,c){if(!neo.isSet(b)||b=="--"){b=""}if(!neo.isSet(c)){c=""}return[b,c].join((b!=""&&c!="")?" : ":"")},setToDraggableScrollView:function(c,b){var d=a.extend({start:function(e){a(this).data("dragging",true)},stop:function(e){var f=a(this);setTimeout(function(){f.data("dragging",false)},0)}},b);c.bind("beforeSelect.cal",function(e){if(a(this).data("dragging")){e.preventDefault()}});c.bind(desknets.EVENT_SCROLL,function(){desknets.cal.refPopUp.close()});c.dndscroll(d)}};desknets.cal.Settings=function(){return this};desknets.cal._settingsInst={start:7,holiday:"0",othercolor:"",disptotime:"0"};desknets.cal.Settings.prototype=desknets.cal._settingsInst;desknets.cal.settings={_settings:{},of:function(b){if(!this._settings[b]){this._settings[b]=new desknets.cal.Settings()}return this._settings[b]}};desknets.cal.Item=function(b){if(typeof b=="object"){a.extend(this,b)}return this};desknets.cal._itemInst={module:"sch",id:"",startdate:"",starttime:"",enddate:"",endtime:"",allday:"",outflg:"",reserve:"",rankflg:"",flag:"",level:"",approvsts:"",visit:"",repeat:"",entry:"",accessopen:"",accessmod:"",accessdel:"",iconno:{},event:"",detail:"",schcolor:"",agnids:"",agnasts:"",todo:"",isAllDay:function(){return(!this.starttime&&!this.endtime)||!!this.allday},isFullTime:function(){return this.isAllDay()},getID:function(){return this.id},getAccesibility:function(){var b=[];if(!!this.accessopen){b.push("r")}if(!!this.accessmod){b.push("u");if(!this.repeat){b.push("em")}}if(!!this.accessdel){b.push("d")}return b.join("")},getDateText:function(){return this.startdate},getStartTimeAsMinute:function(c){var d=this._getTimeAsMinute(this.starttime,this.endtime,-1,0);d=Math.max(d,0);if(a.type(c)=="date"){var b=neo.dateTime.parse(this.startdate);d+=neo.dateTime.getDaysGap(c,b)*1440}return d},getEndTimeAsMinute:function(b){minute=this._getTimeAsMinute(this.endtime,this.starttime,1,1440);if(a.type(b)=="date"){var c=neo.dateTime.parse(this.enddate);minute+=neo.dateTime.getDaysGap(b,c)*1440}return minute},getDateTimeText:function(e){var g=desknets.cal.settings.of(this.module);var d=!this.isAllDay()||(!!e&&e.showTimeIfAllDay);var f=d?this.starttime:"";var c=d&&(Number(g.disptotime)>0)?this.endtime:"";var h=this._formatDateTime(this.startdate,f);var b=this._formatDateTime(this.enddate,c);return[h,b].join(" - ")},getTimeText:function(c){var d=desknets.cal.settings.of(this.module);var e="",b="";if(this.isAllDay()&&(!c||!c.showTimeIfAllDay)){return""}if(!!this.starttime){e=desknets.cal.tmplRef.dispTimeShort(this.starttime)}if(!!this.endtime&&Number(d.disptotime)>0){b=desknets.cal.tmplRef.dispTimeShort(this.endtime)}return !!b?[e,b].join(" - "):e},getSubject:function(){return desknets.cal.getSubject(this.event,this.detail)},getUrl:function(){return"#"},getTheme:function(){var c,d=[];var f=Number(this.schcolor)-1;var b=["blue","green","yellow","pink","red","gray"];var e=["bordered","filled"];c=f%10;if(c<0||b.length<=c){c=0}d.push(b[c]);c=Math.floor(f/10);if(c<0||e.length<=c){c=0}d.push(e[c]);return d.join(" ")},_formatDateTime:function(c,b){if(!b){return desknets.dateTime.formatDate("s",c)}var d=desknets.dateTime.dispDateTime(c,"shortDateFormat");d=d+" "+desknets.cal.tmplRef.dispTimeLong(b);return d},_getTimeAsMinute:function(c,d,g,f){var e,b;if(!!c){e=Number(c.substring(0,2));b=Number(c.substring(2,4));return e*60+b}else{if(!!d){e=Number(d.substring(0,2));b=Number(d.substring(2,4));return e*60+b+g}}return f},_fixDateTime:function(){if(this.startdate==this.enddate&&this.starttime>this.endtime&&!!this.endtime){this.enddate=desknets.dateTime.moveDate(this.enddate,1)}}};desknets.cal.Item.prototype=desknets.cal._itemInst;desknets.cal.SchItem=function(b){if(typeof b=="object"){a.extend(this,b);this.id=b.sid;this.module="sch";if(!!this.allday&&this.starttime!="0000"){this.allday="";this.enddate=desknets.dateTime.moveDate(this.enddate,1)}this._fixDateTime()}return this};desknets.cal._schItemInst=a.extend({},desknets.cal._itemInst,{event:"",place:"",getUrl:function(){var c=desknets.getNeoParam({cmd:desknets.cal.PAGE_SCH_INDEX});var b=desknets.getNeoParam({cmd:desknets.cal.PAGE_SCH_REF,sid:this.getID(),seldate:this.getDateText()});return desknets.cal.CGI_SCH+"?"+c+"#"+b}});desknets.cal.SchItem.prototype=desknets.cal._schItemInst;desknets.cal.PlantItem=function(b){if(typeof b=="object"){a.extend(this,b);this.id=b.sid;this.module="plant";if(!!this.allday&&this.starttime!="0000"){this.allday="";this.enddate=desknets.dateTime.moveDate(this.enddate,1)}this._fixDateTime()}return this};desknets.cal._plantItemInst=a.extend({},desknets.cal._itemInst,{entry:"",getSubject:function(){var b=desknets.cal.getSubject(this.event,this.detail);if(!neo.isSet(b,{blank:false})){b=this.entry}else{if(this.entry){b=b+"("+this.entry+")"}}return b},getUrl:function(){var c=desknets.getNeoParam({cmd:desknets.cal.PAGE_PLANT_INDEX});var b=desknets.getNeoParam({cmd:desknets.cal.PAGE_PLANT_REF,sid:this.getID(),seldate:this.getDateText()});return desknets.cal.CGI_SCH+"?"+c+"#"+b}});desknets.cal.PlantItem.prototype=desknets.cal._plantItemInst;desknets.cal.HolidayItem=function(c){var b=String(c.year)+desknets.zeroPadding(c.id,4);this.startdate=b;this.enddate=b;this.event=c.Name;this.module="holiday";return this};desknets.cal._holidayItemInst=a.extend({},desknets.cal._itemInst,{getTheme:function(){return"holiday"}});desknets.cal.HolidayItem.prototype=desknets.cal._holidayItemInst;desknets.cal.ToDoItem=function(c){var d={"1":"haste","2":"high","4":"low"};if(typeof c=="object"){this.id=c.id;this.startdate=c.limdate;this.enddate=c.limdate;this.endtime=c.limtime||"";this.event=c.memo;this.accessopen="1";this.accessmod="1";this.accessdel="1";this.module="todo";if(c.complete=="1"){this.todo="complete"}else{var b=d[String(c.important)];this.todo=!!b?b:"normal"}}return this};desknets.cal._toDoItemInst=a.extend({},desknets.cal._itemInst,{getAccesibility:function(){return"rud"},getStartTimeAsMinute:function(){var b=this._getTimeAsMinute(this.starttime,this.endtime,-31,0);return Math.max(b,0)},getDateTimeText:function(){return this.getTimeText()},getTimeText:function(){if(!!this.endtime){var b=desknets.Resource.timeFormat;return desknets.dateTime.formatHour(b,this.endtime)}else{return""}},getUrl:function(){var c=desknets.getNeoParam({cmd:desknets.cal.PAGE_TODO_INDEX});var b=desknets.getNeoParam({cmd:desknets.cal.PAGE_TODO_REF,id:this.getID()});return desknets.cal.CGI_TODO+"?"+c+"#"+b},getTheme:function(){return"todo"}});desknets.cal.ToDoItem.prototype=desknets.cal._toDoItemInst;desknets.cal.item={getItemFromSch:function(b){return new desknets.cal.SchItem(b)},getItemsFromSch:function(b){var d=[];for(var c=0;c<b.length;c++){d.push(this.getItemFromSch(b[c]))}return d},getItemFromPlant:function(b){return new desknets.cal.PlantItem(b)},getItemsFromPlant:function(b){var d=[];for(var c=0;c<b.length;c++){d.push(this.getItemFromPlant(b[c]))}return d},getItemFromHoliday:function(b){return new desknets.cal.HolidayItem(b)},getItemsFromHoliday:function(b){var d=[];for(var c=0;c<b.length;c++){d.push(this.getItemFromHoliday(b[c]))}return d},getItemFromToDo:function(b){return new desknets.cal.ToDoItem(b)},getItemsFromToDo:function(b){var d=[];for(var c=0;c<b.length;c++){d.push(this.getItemFromToDo(b[c]))}return d},getColorById:function(e){var d=Number(e)-1;var b=["blue","green","yellow","pink","red","gray"];var c=d%10;if(0<=c&&c<b.length){return b[c]}return b[0]}};desknets.cal.Range=function(c,b){this.start=c;this.end=b;this.length=b-c;return this};desknets.cal._rangeInst={start:0,end:0,length:0,sourceStart:0,sourceEnd:0,sourceLength:0,setSourceValue:function(c,b){this.sourceStart=c;this.sourceEnd=b;this.sourceLength=b-c},isIntersect:function(b){return b.start<this.end&&this.start<b.end}};desknets.cal.Range.prototype=desknets.cal._rangeInst;desknets.cal.Lines=function(b){var c=a.extend({maxLines:2147483647},b);this.clear();this.maxLines=c.maxLines;return this};desknets.cal._linesInst={min:0,max:2147483647,maxLines:2147483647,_$buffer:a(),_lines:[],getLineCount:function(){return this._lines.length},getElement:function(){return this._$buffer},clear:function(){this._lines=[];this._$buffer=a("<div />")},isFree:function(c,b){return !this._isIntersectToLine(b,this._lines[c])},addItem:function(c,b){b=this._coerceRange(b);if(!b){return false}for(var d=0;d<this._lines.length;d++){if(!this._isIntersectToLine(b,this._lines[d])){c.appendTo(this._lines[d].element);this._lines[d].ranges.push({range:b,target:c});return true}}this._addToNewLine(c,b);return true},fillLineSpan:function(d){for(var c=0;c<this._lines.length;c++){var b=this._lines[c].ranges;for(var e=0;e<b.length;e++){var f=this._getLineSpan(c,b[e].range);if(f>1){d(b[e].target,f)}}}},_getLineSpan:function(e,b){var d=1;for(var c=e+1;c<this._lines.length;c++){if(this._isIntersectToLine(b,this._lines[c])){break}d++}return d},_isIntersectToLine:function(c,b){for(var d=0;d<b.ranges.length;d++){if(c.isIntersect(b.ranges[d].range)){return true}}return false},_addToNewLine:function(d,c){if(this._lines.length<this.maxLines){var b={element:a("<div />").appendTo(this._$buffer),ranges:[{range:c,target:d}]};d.appendTo(b.element);this._lines.push(b)}},_coerceRange:function(c){if(this.max<=c.start||c.end<=this.min){return null}var d=Math.max(this.min,c.start);var b=Math.min(this.max,c.end);return new desknets.cal.Range(d,b)}};desknets.cal.Lines.prototype=desknets.cal._linesInst;desknets.cal.tmpl={_itemTmpl:'<a class="cal-item {{classes}}" title="{{termTip}}{{iconText}}{{subject}}" {{attrs}}>{{term}}{{iconHtml}}{{subject}}</a>',_otherIconTmpl:'<img width="16" height="16" alt="{{name}}" title="{{name}}" src="{{cgi}}?cmd='+desknets.CMD_DOWNLOAD+'&item1=schedule%2Ficon%2F{{no}}&filename=attach00001.gif&mimetype=image%2Fgif&realname={{nameEnc}}.gif" />',icons:[{id:"todohaste",prop:"todo",value:"haste"},{id:"todohigh",prop:"todo",value:"high"},{id:"todonormal",prop:"todo",value:"normal"},{id:"todolow",prop:"todo",value:"low"},{id:"todocomplete",prop:"todo",value:"complete"},{id:"allday",prop:"allday",value:"1"},{id:"agenda",prop:"agnasts",value:"1"},{id:"agendaend",prop:"agnasts",value:"2"},{id:"out",prop:"outflg",value:"1"},{id:"tmp",prop:"reserve",value:"1"},{id:"imp",prop:"rankflg",value:"1"},{id:"flg",prop:"flag",value:"1"},{id:"scr",prop:"level",value:"1"},{id:"appfinish",prop:"approvsts",value:"1"},{id:"appreq",prop:"approvsts",value:"2"},{id:"approve",prop:"approvsts",value:"3"},{id:"visit",prop:"visit",value:"1"},{id:"rep",prop:"repeat",value:"dwmy"}],init:function(){var c=desknets.Resource.cal;for(var b=0;b<this.icons.length;b++){var d=this.icons[b].id;this.icons[b].name=c["iconName_"+d];this.icons[b].title=c["iconAsText_"+d];this.icons[b].tmpl=this._getIconHtml(this.icons[b])}},getItemHtml:function(j,k){var b=a.extend({term:"",attrs:"",link:true},k);var e=this._itemTmpl;var c=!!b.term?b.term+" ":"";var d=!!b.termTip?b.termTip+" ":"";var h=!!b.link?this._getAttrs(j):"";var f=this.getIconsAsText(j);var g=j.getSubject();if(!f&&!g){g=j.event}e=desknets.tmpl.replaceWordHtml(e,"term",c);e=desknets.tmpl.replaceWordHtml(e,"termTip",d);e=desknets.tmpl.replaceWordHtml(e,"attrs",h);e=desknets.tmpl.replaceWordHtml(e,"classes",this.getItemClasses(j));e=desknets.tmpl.replaceWord(e,"iconText",f);e=desknets.tmpl.replaceWord(e,"subject",g);e=desknets.tmpl.replaceWordHtml(e,"iconHtml",this.getIconsAsHtml(j));return e},getItemClasses:function(c){var b=c.getTheme();var d=desknets.cal.settings.of(c.module).othercolor;if(c.entry=="1"&&!!d){b+=" "+d}b+=" cal-item-"+c.module+"-"+c.getID();return b},getIconsAsHtml:function(c){var b=this._getIcons(c,"tmpl");if(!!c.iconno&&!!c.iconno.no&&!!c.iconno.val){b.push(this.getOtherIconHtml(c.iconno.no,c.iconno.val))}return b.join("")},getIconsAsText:function(b){var c=this._getIcons(b,"title");if(!!b.iconno&&!!b.iconno.no){c.push("["+b.iconno.val+"]")}return c.join("")},getIconsAsName:function(b){var c=this._getIcons(b,"name");if(!!b.iconno&&!!b.iconno.no){c.push("["+b.iconno.val+"]")}return c.join(",")},getOtherIconHtml:function(e,b){var c=this._otherIconTmpl;var d=desknets.getUrl(desknets.MODULE_REFER);c=desknets.tmpl.replaceWordHtml(c,"cgi",d);c=desknets.tmpl.replaceWordHtml(c,"no",e);c=desknets.tmpl.replaceWord(c,"name",b);c=desknets.tmpl.replaceWordHtml(c,"nameEnc",encodeURIComponent(b));return c},_getAttrs:function(c){var b=[];var d=c.getAccesibility();if(d.indexOf("r")>=0){b.push('href="'+desknets.escape(c.getUrl())+'"')}b.push('data-type="'+c.module+'"');b.push('data-id="'+c.getID()+'"');b.push('data-accesibility="'+d+'"');b.push('data-date="'+c.getDateText()+'"');if(!!c.repeat){b.push('data-repeat="'+c.repeat+'"')}return b.join(" ")},_getIcons:function(e,f){var g=[];for(var d=0;d<this.icons.length;d++){var b=this.icons[d].value;var c=this.icons[d].prop;if(!!e[c]&&b.indexOf(e[c])>=0){g.push(this.icons[d][f])}}return g},_getIconHtml:function(b){var c='<span class="sch-ictype1-{{id}}" title="{{name}}">{{name}}</span>';c=desknets.tmpl.replaceWordHtml(c,"id",b.id);c=desknets.tmpl.replaceWordHtml(c,"name",b.name);return c}};desknets.cal.tmplList={getRowHtml:function(e,h,b){var k;var j=desknets.cal.item.getItemFromSch(h);var l={intervalSepa:"\n",sameDateDisp:true,dateTimeDisp:false,addSameDate:false,moveRepDate:true};a.extend(l,b);var g=h.enddate;if(!!h.repeat&&!!l.moveRepDate){if((!!h.allday&&h.starttime==h.endtime)||(!!h.endtime&&h.starttime>h.endtime)){g=desknets.dateTime.moveDate(g,1)}}var f={sdate:j._formatDateTime(h.startdate),edate:j._formatDateTime(g)};k="";if(neo.isSet(h.starttime,{blank:false})){k=desknets.cal.tmplRef.dispTimeShort(h.starttime)}f.stime=k;k="";if(neo.isSet(h.endtime,{blank:false})){k=desknets.cal.tmplRef.dispTimeShort(h.endtime)}f.etime=k;if(h.sid){e=desknets.tmpl.replaceWord(e,"sid",h.sid)}k=f.sdate;if(h.startdate!=g){if(l.dateTimeDisp==true){if(neo.isSet(f.stime,{blank:false})){k=k+" "+f.stime}k=k+" - "+f.edate;if(neo.isSet(f.etime,{blank:false})){k=k+" "+f.etime}}else{if(k.length>5||f.edate.length>5){k=k+" -\n"+f.edate}else{k=k+" - "+f.edate}}}else{if(l.dateTimeDisp==true&&(neo.isSet(f.stime,{blank:false})||neo.isSet(f.etime,{blank:false}))){if(l.addSameDate==true){k=k+" "+f.stime+" - "+f.etime}else{k=f.stime+" - "+f.etime}}}if(neo.isSet(h.interval,{blank:false})){k=k+l.intervalSepa+h.interval}else{if(k==f.sdate&&l.sameDateDisp==false){k=""}}e=desknets.tmpl.replaceWordLF(e,"date",k);if(l.dateTimeDisp==false){e=desknets.tmpl.replaceWord(e,"starttime",f.stime);e=desknets.tmpl.replaceWord(e,"endtime",f.etime)}var c=desknets.cal.tmpl.getIconsAsText(j);var d=j.getSubject();if(!c&&!d){d=j.event}e=desknets.tmpl.replaceWord(e,"iconText",c);e=desknets.tmpl.replaceWord(e,"subject",d);e=desknets.tmpl.replaceWordHtml(e,"iconHtml",desknets.cal.tmpl.getIconsAsHtml(j));k=desknets.cal.getSubject(h.place,h.other);e=desknets.tmpl.replaceWord(e,"place",k);return e},getId:function(c){var b=c.split("_");return b[0]},getSelDate:function(d,c){var b=d.split("_");if(b.length>2){if(c===false&&b[1]!="r"){return""}return b[2]}else{return""}},getReferHtml:function(b){var d=desknets.cal.item.getItemFromSch(b);var c=this._getReferDateTimeText(d,b,true);return desknets.cal.tmpl.getItemHtml(d,{term:this._getReferDateTimeText(d,b),attrs:this._getAttrs(d),termTip:c})},_getReferDateTimeText:function(j,c,f){var e="";var d="";e=this._formatDateTime(c.startdate);var h=c.starttime=="0000"&&c.endtime=="2400";var g=c.enddate;if(c.repeat){if((c.allday&&c.starttime==c.endtime)||(c.endtime&&c.starttime>c.endtime)){g=desknets.dateTime.moveDate(c.startdate,1)}else{g=c.startdate}}if(c.startdate!=g){d=this._formatDateTime(g)}if(h&&!f){e=e+(neo.isSet(d,{blank:false})?" - "+d:d);return e}b="";if(neo.isSet(c.starttime,{blank:false})){b=desknets.cal.tmplRef.dispTimeShort(c.starttime)}e=e+(neo.isSet(b,{blank:false})?" "+b:"");var b="";if(neo.isSet(c.endtime,{blank:false})){b=desknets.cal.tmplRef.dispTimeShort(c.endtime)}if(neo.isSet(d,{blank:false})){d=d+(neo.isSet(b,{blank:false})?" "+b:"")}else{d=d+(neo.isSet(b,{blank:false})?b:"")}e=e+(neo.isSet(d,{blank:false})?" - "+d:d);return e},_getAttrs:function(c){var d="{{sid}}";if(c.accessopen>0){var b=desknets.tmpl.replaceWord(d,"sid",c.sid);return['href="',desknets.escape(b),'"'].join("")}return""},getSubject:function(b){var d=desknets.cal.item.getItemFromSch(b);var c=d.getSubject();return c},_formatDateTime:function(c){var b=neo.dateTime.parse(c);return neo.dateTime.format(desknets.Resource.dateFormat,b)},getJsonItems:function(b){if(!b||!b.slist){return[]}else{return desknets.ajax.getItems(b.slist.item)}}};desknets.cal.tmplRef={ALARM_USE:"1",ALARM_NONUSE:"0",APPRVSTS_COMPLETE:"1",APPRVSTS_REQ:"2",APPRVSTS_APPROV:"3",dispSchColor:function(c){var d=(Number(c)-1)%10+1;var b=desknets.Resource.cal["color_"+d];if(!b){b=desknets.Resource.cal.color_1}return b},dispIcon:function(d){var b;var c={};c.iconno=d.iconno;c.agnasts=d.agnasts;c.approvsts=d.approvsts;var e=desknets.cal.item.getItemFromSch(c);b=desknets.cal.tmpl.getIconsAsHtml(e);return b},_getOptionIcon:function(c){var b={};b.outflg=c.outflg;b.reserve=c.reserve;b.rankflg=c.rankflg;b.flag=c.flag;b.level=c.level;return b},dispOptionIcon:function(d){var b;var c;var e;c=this._getOptionIcon(d);e=desknets.cal.item.getItemFromSch(c);b=desknets.cal.tmpl.getIconsAsHtml(e);return b},dispOptionName:function(d){var b;var c;var e;c=this._getOptionIcon(d);e=desknets.cal.item.getItemFromSch(c);b=desknets.cal.tmpl.getIconsAsName(e);return b},dispAlarm:function(d,c){var b;if(d!=desknets.cal.tmplRef.ALARM_USE){return desknets.Resource.cal.alarmNothign}else{if(c<60){b=desknets.Resource.cal.alarmMin}else{if(c<24*60){c=c/60;b=desknets.Resource.cal.alarmHour}else{c=c/60/24;b=desknets.Resource.cal.alarmDay}}}b=desknets.tmpl.replaceWordHtml(b,"time",c);return b},dispEvent:function(d,c){var b=desknets.cal.getSubject(d,c);return desknets.tmpl.dispStr(b)},dispOtherTo:function(g,c,f){var d=desknets.tmpl.dispItems(g,f);var b=desknets.tmpl.dispItems(c);var e="&nbsp;";if(d==e&&b==e){return e}else{if(d==e){return b}else{if(b==e){return d}else{return d+",\n"+b}}}},_dispTime:function(d,b){var c;b=desknets.Resource[b];if(d.substr(0,2)=="24"){if(b.indexOf("k")>=0){d="23"+d.substr(2,2)}}c=neo.dateTime.parse("20101231"+d);return neo.dateTime.format(b,c)},dispTimeShort:function(c){var b;if(!neo.isSet(c,{blank:false})){return"&nbsp;"}if(c.substr(0,2)=="24"){b="shortSchTimeFormat24"}else{b="shortTimeFormat"}return this._dispTime(c,b)},dispTimeLong:function(c){var b;if(!neo.isSet(c,{blank:false})){return"&nbsp;"}if(c.substr(0,2)=="24"){b="longSchTimeFormat24"}else{b="timeFormat"}return this._dispTime(c,b)},dispRepDate:function(f,c,b){var d="";f=desknets.ajax.getItems(f.item);for(var e=0;e<f.length;e++){d+=desknets.dateTime.dispDateTime(f[e].val,b);if(e!=f.length-1){if(e!=0&&(e+1)%c==0){d+="\r\n"}else{d+=", "}}}return desknets.tmpl.dispStr(d)},isApprovOrNormal:function(c,b){if(!neo.isSet(c,{blank:false})&&!neo.isSet(b,{blank:false})){return true}if(c==desknets.cal.tmplRef.APPRVSTS_COMPLETE||c==desknets.cal.tmplRef.APPRVSTS_REQ){return true}return false}};desknets.cal.selection={index:-1,endIndex:-1,calendar:null,_$selection:a(),_$additionalSelection:a(),setUp:function(e,c){var b=this,d=a.extend({},c);if(desknets.browser.tablet){e.click(function(h){var f=a(h.target);if(b._canSelect(f,d)&&!!d.select){d.select(f,h.pageX,h.pageY,"start");if(b.calendar!=null&&b.index>=0){var j=b.calendar,g=Math.floor((j.selectSize-j.selectStep)/j.pixelPerUnit*2)/2;b.expand(b.calendar,b.index+g)}}})}else{e.mousedown(function(f){f.preventDefault();if(b._canSelect(a(f.target),d)){b._startToSelect(f,e,d)}})}},shiftSelection:function(b,c){if(this.index>=0&&this.calendar==b){this.index+=c;this.expand(b,this.endIndex+c)}},select:function(c,b){if(b!=this.index||c!=this.calendar){this.unselect();if(0<=b&&b<=c.maxIndex){this.index=b;this.endIndex=b;this.calendar=c;c.putSelectionElement(this._getElement(),b,b);c.triggerWithPosition("select",b,b)}}},expand:function(d,c){if(d==this.calendar&&0<=c&&c<=d.maxIndex&&c!=this.endIndex){this._deleteAdditionalSelection();var e=Math.min(this.index,c),b=Math.max(this.index,c);this.endIndex=c;d.putSelectionElement(this._getElement(),e,b);d.triggerWithPosition("select",e,b)}},unselect:function(b){if(!b||b==this.calendar){this.index=-1;this.endIndex=-1;this.calendar=null;this._$selection.remove();this._deleteAdditionalSelection()}},createAdditionalSelection:function(){var b=a('<div class="cal-selection" />');this._setUpSelection(b);this._$additionalSelection=this._$additionalSelection.add(b);return b},_canSelect:function(b,d){if(!!d&&!!d.canSelect&&!d.canSelect(b)){return false}var c=".ui-resizable-handle"+(desknets.browser.tablet?",.cal-selection":"");if(b.is(c)){return false}var e=a.Event("beforeSelect.cal");if(b.closest(".cal-item:not(.holiday)").length>0){return false}b.trigger(e);return !e.isDefaultPrevented()},_startToSelect:function(e,d,c){var b=this;if(!!c.select){c.select(a(e.target),e.pageX,e.pageY,"start");d.on("mousemove.cal",function(f){f.preventDefault();if(!b._$selection.is(f.target)){b._$selection.data("dragged",true)}c.select(a(f.target),f.pageX,f.pageY,"expand")})}a(document).on("mouseup.cal",function(g){a(document).off("mouseup.cal");d.off("mousemove.cal");if(!!b._$selection.data("dragged")){var h=Math.min(b.index,b.endIndex);var f=Math.max(b.index,b.endIndex);b._$selection.data("dragged",false);b.calendar.triggerWithPosition("add",h,f)}})},_getElement:function(){if(this._$selection.length<=0){this._$selection=a('<div class="cal-selection" />')}this._setUpSelection(this._$selection);return this._$selection},_setUpSelection:function(c){var b=this,d="click.calSelection";if(desknets.browser.msie8){d+=" dblclick.calSelection"}c.removeAttr("style").css({left:0,top:0});c.off(d).on(d,function(e){b._onClickSelection(e.clientX,e.clientY)})},_deleteAdditionalSelection:function(){this._$additionalSelection.remove();this._$additionalSelection=a()},_onClickSelection:function(b,g){var d=this,e=this.calendar;var f=Math.min(this.index,this.endIndex),c=Math.max(this.index,this.endIndex);setTimeout(function(){d.unselect();var h=a(document.elementFromPoint(b,g));if(h.closest("a").length>0){h.click()}else{if(!!e&&f>=0&&c>=0){e.triggerWithPosition("add",f,c)}}},0)}};desknets.cal._timeLine={arrowUpdateInterval:5,maxHour:24,_date:new Date(),_$arrow:a(),_timer:null,_executeOnChangeDate:null,getDate:function(){return this._date},setDate:function(b){var d=this._date;this._date=b;for(var c=0;c<this._executeOnChangeDate.length;c++){this._executeOnChangeDate[c].apply(this,[d])}},setArrowPosition:function(b){},_initRange:function(b){this._$arrow=b.find(".cal-curtime");this._updateArrowVisibility();this._executeOnChangeDate=[this._updateArrowVisibility];this.$root.bind(desknets.EVENT_SCROLL,function(){desknets.cal.refPopUp.close()})},_isInRange:function(b){var c=neo.dateTime.format("yyyyMMdd",this._date);return b.startdate==c&&b.enddate==c&&!b.isAllDay()},_getRange:function(d){var h=0,b=24,g,e,c;var f=neo.dateTime.format("yyyyMMdd",this._date);if(f<d.startdate||d.enddate<f){return null}if(f==d.startdate){h=d.getStartTimeAsMinute()/60;h=Math.floor(h*2)/2;h=Math.min(h,this.maxHour)}if(d.enddate==f){b=d.getEndTimeAsMinute()/60;b=Math.ceil(b*2)/2;b=Math.max(b,h+0.5);b=Math.min(b,this.maxHour)}c=new desknets.cal.Range(h,b);g=Math.floor(d.getStartTimeAsMinute(this._date)/30)/2;e=Math.ceil(d.getEndTimeAsMinute(this._date)/30)/2;c.setSourceValue(g,e);return c},_getDateByPosition:function(c){var b=c>=0?"floor":"ceil";return new Date(this._date.getFullYear(),this._date.getMonth(),this._date.getDate(),Math[b](c),Math[b](c*60)%60,0,0)},_getDateTimeText:function(b,c){if(c=="tip"){if(b.startdate==b.enddate){return b.getTimeText({showTimeIfAllDay:true})}else{return b.getDateTimeText({showTimeIfAllDay:true})}}return""},_updateArrowVisibility:function(){var c=this;var b=desknets.dateTime.current;if(c._$arrow.length<=0){return}if(neo.dateTime.compareOn(c._date,b,"day")==0){c._timer=setInterval(function(){c._updateArrowPosition()},c.arrowUpdateInterval*60000);c._$arrow.show();c._updateArrowPosition()}else{if(!!c._timer){clearInterval(c._timer);c._timer=null}c._$arrow.hide()}},_updateArrowPosition:function(){var b=desknets.dateTime.current;var c=b.getHours()+(b.getMinutes()/60);this.setArrowPosition(c)}};desknets.cal._dateCells={_date:new Date(),_numDays:7,_dayFormat:"d",_showHolidayName:false,_halfRange:false,_executeOnChangeDate:null,_$dateCells:a(),getDate:function(){return this._date},getEndDate:function(){return neo.dateTime.moveDate(this._date,this._numDays-1)},setDate:function(b){var d=this._date;this._date=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0,0);for(var c=0;c<this._executeOnChangeDate.length;c++){this._executeOnChangeDate[c].apply(this,[d])}},_initRange:function(f,d,c){var e=desknets.cal.settings.of(!!d?d:"sch");var b=c.date||new Date();if(c.numDays){this._numDays=c.numDays}this._showHolidayName=!!c.showHolidayName;this._executeOnChangeDate=[];this._$dateCells=f.find(".cal-day");this._$dateCells.delegate(".jcal-navigate","click",function(h){h.preventDefault();var g=a(this).closest(".cal-day").data("date");f.trigger("navigate.cal",{date:!!g?g:this._date,type:"day"})});this.setDate(b)},_isInRange:function(d){var e=this.getEndDate();var b=neo.dateTime.format("yyyyMMdd",this._date);var c=neo.dateTime.format("yyyyMMdd",e);return d.startdate<=c&&b<=d.enddate},_getRange:function(e){var g=this._date.getTime();var b=neo.dateTime.parse(e.startdate);var f=neo.dateTime.parse(e.enddate);var h=neo.dateTime.getDaysGap(this._date,b);var c=neo.dateTime.getDaysGap(this._date,f)+1;if(this._halfRange){h=(e.getStartTimeAsMinute()>=720)?(h+0.5):h;c=(e.getEndTimeAsMinute()<=720)?(c-0.5):c}if(this._numDays<=h||c<=0){return null}var d=new desknets.cal.Range(Math.max(h,0),Math.min(c,this._numDays));d.setSourceValue(h,c);return d},_getDateByPosition:function(b){return neo.dateTime.moveDate(this._date,b)},_getDateTimeText:function(c,d){var b={showTimeIfAllDay:d=="tip"};if(c.startdate==c.enddate){return c.getTimeText(b)}else{return c.getDateTimeText(b)}},_clearDateCells:function(){this._$dateCells.removeClass("co-sunday co-saturday co-today co-holiday cal-absence")},_updateDateCells:function(){var b=this;var d=this._date.getTime();var c=neo.dateTime.format("yyyyMMdd",desknets.dateTime.current);this._$dateCells.each(function(e){b._updateDateCell(a(this),e,c)})},_updateDateCell:function(h,d,g){var c=neo.dateTime.moveDate(this._date,d);var b=neo.dateTime.format("yyyyMMdd",c);var f=h.find(".cal-day-text");var e=this._getDateCellClasses(c,b,g);h.data("date",c);h.addClass(e);if(f.length>0){f.text(neo.dateTime.format(this._dayFormat,c))}},_getDateCellClasses:function(c,b,e){var d=[];if(c.getDay()==0){d.push("co-sunday")}if(c.getDay()==6){d.push("co-saturday")}if(b==e){d.push("co-today")}return d.join(" ")},_updateHoliday:function(c){for(i=0;i<c.length;i++){if(c[i].module!="holiday"){continue}var b=this._getRange(c[i]);if(!!b){if(!this._showHolidayName){c.splice(i,1);i--}this._$dateCells.eq(Math.floor(b.start)).addClass("co-holiday")}}}};desknets.cal._horizontal={pixelPerUnit:42,selectStep:42,selectSize:42,_$body:a(),_isMovable:false,_isResizable:false,_draggableOptions:{},putSelectionElement:function(f,h,b){var e=h*this.pixelPerUnit;var d=typeof b=="undefined"?e+this.selectSize:b*this.pixelPerUnit+this.selectStep;var c=this._$body.width();d=Math.min(d,c);if(e<d){var g={left:e+"px",width:(d-e)+"px"};f.css(g).appendTo(this._$body)}},_initDirection:function(c,b){this._$body=c.find(".cal-h-meter-body");this._isMovable=!!b.movable;this._isResizable=!!b.resizable},_setPosition:function(e,d){var c=Math.floor(d.start*this.pixelPerUnit);var b=Math.floor(d.length*this.pixelPerUnit);e.css({left:c+"px",width:b+"px"});e.data("start",d.sourceStart);e.data("span",d.sourceLength);e.data("end",d.sourceEnd)},_setItemsToHtml:function(d,b){var c=b.getElement();c.attr("class",d.attr("class"));d.replaceWith(c);b.clear();this._setUpItemElements()},_getIndexWithPosition:function(b,d){var c=Math.floor(b/this.selectStep)*this.selectStep;return c/this.pixelPerUnit},_setUpItemElements:function(){var b=this;var d={grid:[b.selectStep,1],minWidth:b.selectStep,stop:function(e,f){b._onResizeItemElements(a(this),f.position.left-f.originalPosition.left,f.size.width-f.originalSize.width)}};var c=a.extend({axis:"x",grid:[b.selectStep,1],distance:b.selectStep,appendTo:this._$body,helper:function(e){return b._createDragHelper(a(this),e)},start:function(e,f){desknets.cal.refPopUp.close()},drag:function(e,f){b._onDragHelper(f.helper,f.position)},stop:function(e,f){b._onDropHelper(a(this),f.position)}},this._draggableOptions);this._$body.find(".cal-item").each(function(){var f=a(this),h=f.parent(".cal-item-box");var e=f.data("accesibility")||"",g=f.find(".sch-ictype1-allday").length>0;if(e.indexOf("e")>=0&&h.length>0&&b._isResizable&&!g){h.resizable(a.extend({handles:b._getResizeHandles(h)},d))}if(e.indexOf("m")>=0&&b._isMovable&&!g){h.draggable(c);f.on("dragstart",function(j){j.preventDefault()})}})},_getResizeHandles:function(c){var b=[];if(Number(c.data("start"))>=0){b.push("w")}if(Number(c.data("end"))<=24){b.push("e")}return b.join(",")},_onResizeItemElements:function(f,h,e){var b=Math.round(h/this.selectStep)*this.selectStep/this.pixelPerUnit;var c=Math.round((h+e)/this.selectStep)*this.selectStep/this.pixelPerUnit;if(b!=0||c!=0){var d=f.data("start")+b;var g=f.data("end")+c-this.selectStep/this.pixelPerUnit;this._triggerTermChanged(f,d,g)}},_createDragHelper:function(e,d){var g=e.parent().prevAll().length;var h=e.data("start"),c=e.data("span");var b=d.offsetX||d.originalEvent.layerX;var f=e.clone();if(h<0&&typeof b=="number"){e.draggable("option","cursorAt",{left:b-h*this.pixelPerUnit})}f.width(c*this.pixelPerUnit).height(e.height()).css({top:(g*21)+"px","z-index":2});return f},_onDragHelper:function(c,b){if(b.left%this.selectStep!=0){b.left=Math.round(b.left/this.selectStep)*this.selectStep}},_onDropHelper:function(d,b){var c=Math.round(b.left/this.selectStep)*this.selectStep/this.pixelPerUnit;var e=c+d.data("span")-this.selectStep/this.pixelPerUnit;if(0<=e&&c<24&&c!=d.data("start")){this._triggerTermChanged(d,c,e)}}};desknets.cal._vertical={pixelPerUnit:42,selectStep:42,selectSize:42,_$body:a(),_isMovable:false,_isResizable:false,_draggableOptions:{},putSelectionElement:function(f,h,b){var e=h*this.pixelPerUnit;var d=typeof b=="undefined"?e+this.selectSize:b*this.pixelPerUnit+this.selectStep;var c=this._$body.height();d=Math.min(d,c);if(e<d){var g={top:e+"px",height:(d-e)+"px"};f.css(g).appendTo(this._$body)}},_initDirection:function(c,b){this._$body=c.find(".cal-v-meter-body");this._isMovable=!!b.movable;this._isResizable=!!b.resizable},_setPosition:function(c,b){var d=Math.floor(b.start*this.pixelPerUnit);var e=Math.floor(b.length*this.pixelPerUnit);c.css({top:d+"px",height:e+"px"});c.data("start",b.sourceStart);c.data("span",b.sourceLength);c.data("end",b.sourceEnd)},_setItemsToHtml:function(f,c){var d=c.getElement();var e=d.children();d.attr("class",f.attr("class"));if(e.length>0){var b=100/e.length;e.each(function(g){a(this).css({left:(b*g)+"%",width:b+"%"})})}c.fillLineSpan(function(g,h){g.css("width",(h*100)+"%")});f.replaceWith(d);c.clear();this._setUpItemElements()},_getIndexWithPosition:function(b,d){var c=Math.floor(d/this.selectStep)*this.selectStep;return c/this.pixelPerUnit},_setUpItemElements:function(){var b=this;var d={handles:"n, s",grid:[1,b.selectStep],minHeight:b.selectStep,stop:function(e,f){b._onResizeItemElements(a(this),f.position.top-f.originalPosition.top,f.size.height-f.originalSize.height)}};var c=a.extend({axis:"y",grid:[1,b.selectStep],distance:b.selectStep,appendTo:this._$body,helper:function(e,f){return b._createDragHelper(a(this),e)},start:function(e,f){desknets.cal.refPopUp.close()},drag:function(e,f){b._onDragHelper(f.helper,f.position)},stop:function(e,f){b._onDropHelper(a(this),f.position)}},this._draggableOptions);this._$body.find(".cal-item").each(function(){var f=a(this),g=f.parent(".cal-item-box");var e=f.data("accesibility")||"";if(e.indexOf("e")>=0&&b._isResizable){g.resizable(d)}if(e.indexOf("m")>=0&&b._isMovable){g.draggable(c);f.on("dragstart",function(h){h.preventDefault()})}})},_onResizeItemElements:function(f,h,e){var b=Math.round(h/this.selectStep)*this.selectStep/this.pixelPerUnit;var c=Math.round((h+e)/this.selectStep)*this.selectStep/this.pixelPerUnit;if(b!=0||c!=0){var d=f.data("start")+b;var g=f.data("end")+c-this.selectStep/this.pixelPerUnit;this._triggerTermChanged(f,d,g)}},_createDragHelper:function(d,c){var e=d.clone(),b=d.closest(".cal-v-box-data").width()-6;e.css({"z-index":2,left:"2px"}).width(b).height(d.height());return e},_onDragHelper:function(c,b){if(b.top%this.selectStep!=0){b.top=Math.round(b.top/this.selectStep)*this.selectStep}},_onDropHelper:function(d,b){var c=Math.round(b.top/this.selectStep)*this.selectStep/this.pixelPerUnit;var e=c+d.data("span")-this.selectStep/this.pixelPerUnit;if(0<=e&&c<24&&c!=d.data("start")){this._triggerTermChanged(d,c,e)}}};desknets.cal._calBase={$root:a(),itemUrl:"#{{sid}}",maxIndex:2147483647,_$selectable:a(),_isSelectable:true,_isSettingUp:false,_callbacksOnReady:null,addItems:function(b){},canAdd:function(b){return false},getItemHtml:function(c,b){return a()},selectWithPosition:function(b,d,c){},triggerWithPosition:function(c,d,b){},destroy:function(){},setSelectable:function(b){this._isSelectable=b;if(!b&&desknets.cal.selection.calendar==this){desknets.cal.selection.unselect()}},extractItems:function(b){var c=this._sliceItemsToAdd(b);this.addItems(c)},replaceItems:function(b){this.addItems(b)},_initSelection:function(c,d){var b=this;var e=a.extend({selectable:true},d);b._$selectable=c;b._isSelectable=e.selectable;desknets.cal.selection.setUp(c,{canSelect:function(f){return b._canSelect(f)},select:function(g,f,k,j){var h=b._$selectable.offset();b.selectWithPosition(f-h.left,k-h.top,j)}});c.dnclick(".cal-item[href]",function(f){b._openForRefer(a(this),f)},function(f){b._openForModify(a(this),f)},{ignoreOnModifierKey:true});c.on("selectstart",function(f){f.preventDefault()})},_beginToSetUp:function(){this._isSettingUp=true},_completeToSetUp:function(){this._isSettingUp=false;if(!!this._callbacksOnReady){for(var b=0;b<this._callbacksOnReady.length;b++){this._callbacksOnReady[b].apply(this)}}this._callbacksOnReady=[]},_executeOnReady:function(b){if(this._isSettingUp){if(!this._callbacksOnReady){this._callbacksOnReady=[]}this._callbacksOnReady.push(b)}else{setTimeout(function(){b.apply(this)},0)}},_sliceItemsToAdd:function(b){var d=[];for(var c=b.length-1;c>=0;c--){if(this.canAdd(b[c])){d.unshift(b[c]);b.splice(c,1)}}return d},_canSelect:function(b){return this._isSelectable},_openForRefer:function(b,c,e){var d=a.Event("refer.cal");d.originalEvent=c;e=(e=="page")?"page":"popup";b.trigger(d,{mode:e})},_openForModify:function(b,c){var e=b.data("accesibility");if(!!e&&e.indexOf("u")>=0){var d=a.Event("modify.cal");d.originalEvent=c;b.trigger(d)}else{this._openForRefer(b,c,"page")}},_triggerTermChanged:function(d,b,e){var c=a.Event("termChanged.cal");c.target=d.children(".cal-item")[0];this.triggerWithPosition(c,b,e)}};desknets.cal._hCellLayout={headerHeight:24,_numCols:7,_barHeight:22,_percentPerUnit:1,_$body:a(),_$dayCells:a(),_lists:[],_isMovable:false,_draggableOptions:{},putSelectionElement:function(c,e,b){var d=100/this._numCols;if(0<=e&&e<=b&&b<this._numCols){c.css({left:(e*d)+"%",width:((b-e+1)*d)+"%",top:this.headerHeight+"px"}).appendTo(this._$body)}},_initDirection:function(d,c){var b=this;this._percentPerUnit=100/b._numCols;this._$body=d;this._$dayCells=d.find(".cal-day");this._isMovable=!!c&&!!c.movable;this._resetLists();this._$body.bind("beforeSelect.cal",function(f,e){if(!b._isSelectableElement(a(f.target))){f.preventDefault()}})},_setPosition:function(e,d){var c=d.start*this._percentPerUnit;var b=d.length*this._percentPerUnit;e.css({left:c+"%",width:b+"%"})},_addItem:function(d,c,b){var e=d.children(".todo, .holiday").length>0;if(c.length>1||e){this._setPosition(d,c);b.addItem(d,c)}else{if(c.start<this._numCols){this._lists[c.start]=this._lists[c.start].add(d)}}d.data("start",c.sourceStart);d.data("span",c.sourceLength)},_setItemsToHtml:function(c,b){c.find(".cal-h-bars-data-inner").remove();c.find(".cal-item-box").remove();this._setBarsParts(c,b);this._setListParts(c,b);this._resetLists();b.clear();this._setUpItemElements()},_setBarsParts:function(d,b){var c=b.getElement();if(c.length>0&&c.children().length>0){c.attr("class","cal-h-bars-data-inner");d.find(".cal-h-bars-data").append(c)}},_setListParts:function(d,b){var c=this;d.find(".cal-h-list-data").each(function(e){var h=a(this);var f=c._getTopPadding(e,b);var j=c._lists[e];if(f>0){var g=a('<div class="cal-item-box cal-padding-box" />');g.css("height",f+"px").appendTo(h)}if(j&&j.length>0){h.append(j)}})},_getTopPadding:function(b,c){for(var d=c.getLineCount()-1;d>=0;d--){if(!c.isFree(d,new desknets.cal.Range(b,b+1))){return(d+1)*this._barHeight}}return 0},_isSelectableElement:function(c){var b="#cal-selection,.cal-day-header,.cal-day-text";return c.closest(b).length<=0},_getIndexWithPosition:function(b,e){var d=this._$body.find("td.cal-day").eq(0);var c=(d.width()+1)*this._numCols;return this._coerceStart(Math.floor((b/c)*this._numCols))},_setUpItemElements:function(){var b=this,c=this._$body.width();var d=a.extend({appendTo:this._$body,distance:10,cursorAt:{left:c/14,top:this._barHeight/2},helper:function(e){return b._createDragHelper(a(e.target).closest(".cal-item-box"))},start:function(e,f){desknets.cal.refPopUp.close()},drag:function(e,f){b._onDragHelper(a(e.target).closest(".cal-item-box"),f.position)},stop:function(e,f){b._onDropHelper(a(e.target).closest(".cal-item-box"),f.position)}},this._draggableOptions);this._$body.find(".cal-item").each(function(){var f=a(this),g=f.parent(".cal-item-box");var e=f.data("accesibility")||"";if(e.indexOf("m")>=0&&b._isMovable){g.draggable(d);f.on("dragstart",function(h){h.preventDefault()})}})},_createDragHelper:function(c){var d=c.clone(),b=c.draggable("option","cursorAt");d.width(b.left*2).height(b.top*2);return d},_onDragHelper:function(g,c){var d=this._$body.position(),b=d.top+this._$body.height();this._$dayCells.removeClass("cal-drop-target");if(d.top<=c.top&&c.top<=b){var e=Math.round(c.left*7/this._$body.width());var f=Math.max(g.data("span"),1);if(0<=e&&e<7){this._$dayCells.slice(e,e+f).addClass("cal-drop-target")}}},_onDropHelper:function(d,b){var e=this._$dayCells.filter(".cal-drop-target");if(e.length>0){var c=e.eq(0).prevAll(".cal-day").length;if(c!=d.data("start")){this._triggerTermChanged(d,c,c+Math.max(d.data("span"),1)-1)}}e.removeClass("cal-drop-target")},_resetLists:function(){this._lists=[];for(var b=0;b<this._numCols;b++){this._lists.push(a())}},_coerceStart:function(b){if(b<0){b=0}if(b>=this._numCols){b=this._numCols-1}return b}};desknets.cal.FullTimeList=function(d,c,b){this.init(d,b);return this};desknets.cal._fullTimeListInst={$root:a(),maxIndex:0,_$body:a(),init:function(c,b){this.$root=c;this._$body=c.find(".cal-timebar-allday-body");this._initSelection(this._$body,b);this._initRange(c);this._executeOnChangeDate.push(function(){desknets.cal.selection.unselect(this)})},addItems:function(b){var e=[];for(var d=0;d<b.length;d++){if(this.canAdd(b[d])){var c=desknets.cal.tmpl.getItemHtml(b[d],{term:this._getDateTimeText(b[d],"text"),termTip:this._getDateTimeText(b[d],"tip")});e.push(c)}}this._$body.children(".cal-allday-box-data").html(e.join(""))},canAdd:function(b){var c=neo.dateTime.format("yyyyMMdd",this._date);if(b.startdate>c||c>b.enddate){return false}return !this._isInRange(b)},selectWithPosition:function(b,c){desknets.cal.selection.select(this,0)},triggerWithPosition:function(d,f,b){var c=this.getDate();var e={date:c,index:0,endDate:c,endIndex:0};this.$root.trigger(d+".cal",e)},putSelectionElement:function(c,d,b){c.appendTo(this._$body)},_getDateTimeText:function(b,d){var c=neo.dateTime.format("yyyyMMdd",this._date);if(b.startdate<c||c<b.enddate){return b.getDateTimeText({showTimeIfAllDay:d=="tip"})}else{if(b.isAllDay()&&d=="tip"){return b.getTimeText({showTimeIfAllDay:true})}}return""}};desknets.cal.FullTimeList.prototype=a.extend({},desknets.cal._calBase,desknets.cal._timeLine,desknets.cal._fullTimeListInst);desknets.cal.TimeHorizontal=function(d,c,b){this.init(d,b);return this};desknets.cal._timeHorizontalInst={pixelPerUnit:72,selectStep:36,selectSize:72,maxIndex:23.5,_lines:desknets.cal.Lines.prototype,init:function(d,b){var c=a.extend({},b);this.$root=d;this._lines=new desknets.cal.Lines(c);this._initSelection(this.$root.find(".cal-h-meter-body"),c);this._initRange(d);this._initDirection(d,c);this._executeOnChangeDate.push(function(){desknets.cal.selection.unselect(this)})},canAdd:function(b){return this._isInRange(b)},addItems:function(d){for(var e=0;e<d.length;e++){var c=this._getRange(d[e]);if(!!c){var b=this.getItemHtml(d[e],c);this._setPosition(b,c);this._lines.addItem(b,c)}}this._setItemsToHtml(this.$root.find(".cal-h-box-data"),this._lines)},getItemHtml:function(d,b){var c=desknets.cal.tmpl.getItemHtml(d,{term:this._getDateTimeText(d,"text"),termTip:this._getDateTimeText(d,"tip")});return a('<div class="cal-item-box" />').html(c)},setArrowPosition:function(b){this._$arrow.css("left",Math.floor(b*this.pixelPerUnit)+"px")},selectWithPosition:function(b,e,d){var c=this._getIndexWithPosition(b,e);if(d=="expand"){desknets.cal.selection.expand(this,c)}else{desknets.cal.selection.select(this,c)}},triggerWithPosition:function(d,g,c){var b=this._getDateByPosition(g);var f=this._getDateByPosition(c+(this.selectStep/this.pixelPerUnit));var e=typeof d=="string"?d+".cal":d;this.$root.trigger(e,{date:b,index:g,endDate:f,endIndex:c})}};desknets.cal.TimeHorizontal.prototype=a.extend({},desknets.cal._calBase,desknets.cal._timeLine,desknets.cal._horizontal,desknets.cal._timeHorizontalInst);desknets.cal.TimeVertical=function(d,c,b){this.init(d,b);return this};desknets.cal._timeVerticalInst={selectStep:21,maxIndex:23.5,_lines:desknets.cal.Lines.prototype,init:function(d,b){var c=a.extend({},b);this.$root=d;this._lines=new desknets.cal.Lines(c);this._initSelection(this.$root.find(".cal-v-meter-body"),c);this._initRange(d);this._initDirection(d,c);this._executeOnChangeDate.push(function(){desknets.cal.selection.unselect(this)})},canAdd:function(b){return this._isInRange(b)},addItems:function(d){for(var e=0;e<d.length;e++){var c=this._getRange(d[e]);if(!!c){var b=this.getItemHtml(d[e],c);this._setPosition(b,c);this._lines.addItem(b,c)}}this._setItemsToHtml(this.$root.find(".cal-v-box-data"),this._lines)},getItemHtml:function(d,b){var c=desknets.cal.tmpl.getItemHtml(d,{term:this._getDateTimeText(d,"text"),termTip:this._getDateTimeText(d,"tip")});return a('<div class="cal-item-box" />').html(c)},setArrowPosition:function(b){this._$arrow.css("top",Math.floor(b*this.pixelPerUnit)+"px")},selectWithPosition:function(b,e,d){var c=this._getIndexWithPosition(b,e);if(d=="expand"){desknets.cal.selection.expand(this,c)}else{desknets.cal.selection.select(this,c)}},triggerWithPosition:function(d,g,c){var b=this._getDateByPosition(g);var f=this._getDateByPosition(c+(this.selectStep/this.pixelPerUnit));var e=typeof d=="string"?d+".cal":d;this.$root.trigger(e,{date:b,index:g,endDate:f,endIndex:c})},setMaxIndex:function(b){this.maxIndex=b},};desknets.cal.TimeVertical.prototype=a.extend({},desknets.cal._calBase,desknets.cal._timeLine,desknets.cal._vertical,desknets.cal._timeVerticalInst);desknets.cal.DateHorizontal=function(d,c,b){this.init(d,c,b);return this};desknets.cal._dateHorizontalInst={maxIndex:6,_dayFormat:desknets.Resource.longDayFormat,_lines:desknets.cal.Lines.prototype,_showHoliday:false,init:function(f,c,b){var d=desknets.cal.settings.of(!!c?c:"sch");var e=a.extend({showHoliday:true,showHolidayName:true},b);this.$root=f;this._lines=new desknets.cal.Lines();if(e.numCols){this._numCols=e.numCols}this._lines.max=this._numCols;if(e.maxIndex){this.maxIndex=e.maxIndex}this._initSelection(f,e);this._initRange(f,c,e);this._initDirection(f,e);this._executeOnChangeDate.push(this._beginToUpdateDateCells);this._executeOnChangeDate.push(this._reselectCell);this._beginToUpdateDateCells()},canAdd:function(b){return this._isInRange(b)},addItems:function(b){this._updateHoliday(b);this._addCalendarItems(b)},getItemHtml:function(d,b){var e=this._getDateTimeText(d,"text");if(e.length>0){e='<span class="cal-term-text">'+e+"</span>"}var c=desknets.cal.tmpl.getItemHtml(d,{term:e,termTip:this._getDateTimeText(d,"tip")});return a('<div class="cal-item-box" />').html(c)},selectWithPosition:function(b,e,d){var c=this._getIndexWithPosition(b,e);if(d=="expand"){desknets.cal.selection.expand(this,c)}else{desknets.cal.selection.select(this,c)}},triggerWithPosition:function(d,g,c){var b=this._getDateByPosition(g);var f=this._getDateByPosition(c);var e=typeof d=="string"?d+".cal":d;this.$root.trigger(e,{date:b,index:g,endDate:f,endIndex:c})},_beginToUpdateDateCells:function(){this._clearDateCells();this._updateDateCells()},_addCalendarItems:function(d){for(var e=0;e<d.length;e++){var c=this._getRange(d[e]);if(!!c){var b=this.getItemHtml(d[e],c);this._addItem(b,c,this._lines)}}this._setItemsToHtml(this.$root,this._lines)},_reselectCell:function(b){if(!!b){var c=neo.dateTime.getDaysGap(this._date,b);desknets.cal.selection.shiftSelection(this,c)}}};desknets.cal.DateHorizontal.prototype=a.extend({},desknets.cal._calBase,desknets.cal._dateCells,desknets.cal._hCellLayout,desknets.cal._dateHorizontalInst);desknets.cal.DateVertical=function(d,c,b){this.init(d,c,b);return this};desknets.cal._dateVerticalInst={maxIndex:6,_lines:desknets.cal.Lines.prototype,_dayFormat:desknets.Resource.longDayFormat,_halfRange:true,init:function(f,c,b){var d=desknets.cal.settings.of(!!c?c:"sch");var e=a.extend({showHoliday:true,showHolidayName:true},b);this.$root=f;this._lines=new desknets.cal.Lines(e);this._initSelection(this.$root.find(".cal-v-meter-body"));this._initRange(f,c,e);this._initDirection(f,e);this._executeOnChangeDate.push(this._beginToUpdateDateCells);this._executeOnChangeDate.push(this._reselectCell)},canAdd:function(b){return this._isInRange(b)},addItems:function(b){this._updateHoliday(b);this._addCalendarItems(b);this._fixHolidayItems()},getItemHtml:function(d,b){var c=desknets.cal.tmpl.getItemHtml(d,{term:this._getDateTimeText(d,"text"),termTip:this._getDateTimeText(d,"tip")});return a('<div class="cal-item-box" />').html(c)},selectWithPosition:function(b,e,d){var c=this._getIndexWithPosition(b,e);if(d=="expand"){desknets.cal.selection.expand(this,c)}else{desknets.cal.selection.select(this,c)}},triggerWithPosition:function(d,f,c){var b=this._getDateByPosition(f);var e=this._getDateByPosition(c);this.$root.trigger(d+".cal",{date:b,index:f,endDate:e,endIndex:c})},_beginToUpdateDateCells:function(){this._clearDateCells();this._updateDateCells()},_addCalendarItems:function(d){for(var e=0;e<d.length;e++){var c=this._getRange(d[e]);if(!!c){var b=this.getItemHtml(d[e],c);this._setPosition(b,c);this._lines.addItem(b,c)}}this._setItemsToHtml(this.$root.find(".cal-v-box-data"),this._lines)},_addHolidayItems:function(){for(var d in this._holidays){var e=new desknets.cal.HolidayItem(this._holidays[d],d);var c=this._getRange(e);if(!!c){var b=this.getItemHtml(e,c);this._setPosition(b,c);this._lines.addItem(b,c)}}},_fixHolidayItems:function(){this.$root.find(".holiday.cal-item").each(function(){var c=this.parentNode;var b=c.style.width||"100%";c.style.width="auto";c.style.height="auto";c.style.maxWidth=b})},_reselectCell:function(b){if(!!b){var c=neo.dateTime.getDaysGap(this._date,b);desknets.cal.selection.shiftSelection(this,c)}}};desknets.cal.DateVertical.prototype=a.extend({},desknets.cal._calBase,desknets.cal._dateCells,desknets.cal._vertical,desknets.cal._dateVerticalInst);desknets.cal.MonthCalendarWeek=function(e,c,b){this.init(e,c,b);this.setState(!!b.state);var d=e.closest(".cal-month-body");this._draggableOptions={appendTo:d};this._$weekRowsOfMonth=d.find(".cal-h-week");this._$dayCellsOfMonth=d.find(".cal-day");return this};desknets.cal._monthCalendarWeekInst={headerHeight:0,_dayFormat:"d",_state:true,_$weekRowsOfMonth:a(),_$dayCellsOfMonth:a(),getState:function(){return this._state},setState:function(b){this._state=b;if(b){this.$root.closest(".cal-month-week").show()}else{this.$root.closest(".cal-month-week").hide()}},setStateAndDate:function(c,b){this.setState(c);if(c){this.setDate(b)}},_onDragHelper:function(f,b){var g=this._getTargetRowByPosition(b);var d=this._getTargetColByPosition(b);this._$dayCellsOfMonth.removeClass("cal-drop-target");if(0<=g&&0<=d&&d<7){var c=g*7+d;var e=Math.max(f.data("span"),1);this._$dayCellsOfMonth.slice(c,c+e).addClass("cal-drop-target")}},_onDropHelper:function(f,c){var h=this._$dayCellsOfMonth.filter(".cal-drop-target");if(h.length>0){var e=h.eq(0).prevAll(".cal-day").length;var g=h.eq(0).closest(".cal-month-week").prevAll().length;var b=this.$root.closest(".cal-month-week").prevAll().length;var d=(g-b)*7+e;if(d!=f.data("start")){this._triggerTermChanged(f,d,d+Math.max(f.data("span"),1)-1)}}h.removeClass("cal-drop-target")},_getTargetRowByPosition:function(d){for(var e=0;e<this._$weekRowsOfMonth.length;e++){var c=this._$weekRowsOfMonth.eq(e).parent();var f=c.position();var b=c.height();if(f.top<=d.top&&d.top<f.top+b){return e}}return -1},_getTargetColByPosition:function(b){var d=this._$weekRowsOfMonth.eq(0).parent().position();var c=this._$weekRowsOfMonth.eq(0).width();return Math.round((b.left-d.left)*7/c)}};desknets.cal.MonthCalendarWeek.prototype=a.extend({},desknets.cal.DateHorizontal.prototype,desknets.cal._monthCalendarWeekInst);desknets.cal.MonthCalendar=function(d,c,b){this.init(d,c,b);return this};desknets.cal.MonthCalendar.getLeftTopDate=function(d,c){var b=new Date(d.getFullYear(),d.getMonth(),1);var e=(b.getDay()-c+7)%7;return neo.dateTime.moveDate(b,-e)};desknets.cal.MonthCalendar.getRightBottomDate=function(d,b){var c=new Date(d.getFullYear(),d.getMonth()+1,0);var e=(b-c.getDay()+6)%7;return neo.dateTime.moveDate(c,e)};desknets.cal._monthCalendarInst={maxIndex:42,_weeks:[],_month:new Date(),_startTime:0,_module:"",_firstWeek:0,_isSelectable:0,_$days:a(),init:function(g,d,c){var e=desknets.cal.settings.of(!!d?d:"sch");var f=a.extend({selectable:true},c);var b=f.date||new Date();this._month=new Date(b.getFullYear(),b.getMonth(),1);this.$root=g;this._weeks=[];this._module=d;this._firstWeek=Number(e.sunday);this._$days=g.find("tbody").find(desknets.cal.SEL_DAY);this._isSelectable=f.selectable;this._initDateHeader(g);this._initDateCells(g,f)},destroy:function(){for(var b=0;b<this._weeks.length;b++){this._weeks[b].destroy()}this.$root.undelegate(desknets.cal.SEL_WEEK_BTN,"click")},getDate:function(){return this._month},getLeftTopDate:function(){return desknets.cal.MonthCalendar.getLeftTopDate(this._month,this._firstWeek)},getRightBottomDate:function(){return desknets.cal.MonthCalendar.getRightBottomDate(this._month,this._firstWeek)},setDate:function(b){this._month=new Date(b.getFullYear(),b.getMonth(),1,0,0,0,0);this.clearContentForDay();this._updateDateRows();desknets.cal.selection.unselect(this)},setSelectable:function(b){this._isSelectable=b;desknets.cal.selection.unselect(this)},replaceItems:function(b){for(var c=0;c<this._weeks.length;c++){if(this._weeks[c].getState()){this._weeks[c].replaceItems(b)}}},set6WeekContents:function(b){for(var d=0;d<b.length;d++){var c=neo.dateTime.parse(b[d].id);var e=b[d].Name;if(!!b[d].Url){e='<a href="{{Url}}" target="_blank">{{Name}}</a>';e=desknets.tmpl.replaceWordHtml(e,"Name",b[d].Name);e=desknets.tmpl.replaceWord(e,"Url",b[d].Url)}this._setContentForDay(c,"6-week",e)}},clearContentForDay:function(){this.$root.find(".cal-day-content").empty()},putSelectionElement:function(e,d,f){var b=Math.floor(d/7);var g=Math.min(Math.floor(f/7),this._weeks.length-1);for(var h=b;h<=g;h++){var k=desknets.cal.selection.createAdditionalSelection();var j=(h==b)?d%7:0;var c=(h==g)?f%7:6;this._weeks[h].putSelectionElement(k,j,c)}},triggerWithPosition:function(e,g,c){var d=this.getLeftTopDate();var b=neo.dateTime.moveDate(d,g);var f=neo.dateTime.moveDate(d,c);this.$root.trigger(e+".cal",{date:b,index:g,endDate:f,endIndex:c})},_initDateHeader:function(d){var b=this;var c=neo.Resource.dateTime.shortWeeks;d.find("thead th").each(function(f){var g=a(this);var e=(f+b._firstWeek)%7;g.text(c[e]);if(e==0){g.attr("class",desknets.cal.CLASS_SUNDAY)}else{if(e==6){g.attr("class",desknets.cal.CLASS_SATURDAY)}}})},_initDateCells:function(f,d){var c=this;var e=this.getLeftTopDate();var b=neo.dateTime.moveMonth(this._month,1).getTime();f.find(".cal-h-week").each(function(h){var g=neo.dateTime.moveDate(e,h*7);var j=a.extend({},d,{date:g,state:g<b,selectable:false});var k=new desknets.cal.MonthCalendarWeek(a(this),c._module,j);c._weeks.push(k)});this._updateDateCells(e,b);f.delegate(desknets.cal.SEL_WEEK_BTN,"click",function(h){h.preventDefault();var g=a(this).closest(".cal-month-week").prevAll().length;c._triggerWeekNavigate(g)});desknets.cal.selection.setUp(f,{canSelect:function(g){return c._canSelect(g)},select:function(h,g,k,j){c._selectWithPosition(h,g,j)}})},_setContentForDay:function(e,f,g){var d=neo.dateTime.getDaysGap(this.getLeftTopDate(),e);if(d<0||this._$days.length<=d){return}var c=this._$days.eq(d).find(".cal-day-content");if(c.length<=0){return}var b=c.children(".cal-day-"+f);if(b.length<=0){b=a("<span />").addClass("cal-day-"+f).appendTo(c)}b.html(g)},_updateDateRows:function(){var e=this.getLeftTopDate();var b=neo.dateTime.moveMonth(this._month,1).getTime();for(var d=0;d<this._weeks.length;d++){var c=neo.dateTime.moveDate(e,d*7);this._weeks[d].setStateAndDate(c<b,c)}this._updateDateCells(e,b)},_updateDateCells:function(d,b){var c=this;c._$days.each(function(g){if(g<6||28<g){var f=neo.dateTime.moveDate(d,g);var e=(f<c._month||b<=f);var h=e?"addClass":"removeClass";a(this)[h](desknets.cal.CLASS_OTHER_MONTH)}})},_triggerWeekNavigate:function(b){if(!!this._weeks[b]&&this._weeks[b].getState()){this.$root.trigger("navigate.cal",{date:this._weeks[b].getDate(),type:"week"})}},_canSelect:function(b){return this._isSelectable&&b.closest(".cal-h-week").length>0},_selectWithPosition:function(d,c,j){var b=d.closest(".cal-h-week");if(b.length>0){var g=d.closest(".cal-month-week").prevAll(".cal-month-week").length;var h=c-b.offset().left;var f=b.width();if(0<=h&&h<f){var e=Math.floor(h*7/f);if(j=="expand"){desknets.cal.selection.expand(this,g*7+e)}else{desknets.cal.selection.select(this,g*7+e)}}}}};desknets.cal.MonthCalendar.prototype=desknets.cal._monthCalendarInst;desknets.cal.WeekTimeLineDay=function(f,d,c){this.init(f,c);var e=f.closest(".cal-week-timelines-days");var b=Math.max(e.find(".cal-v-meter").eq(-1).width(),1)+1;this._draggableOptions={axis:false,grid:[b,this.selectStep],appendTo:e};return this};desknets.cal._weekTimeLineDayInst={_createDragHelper:function(h,f){var e=h.closest(".cal-v-box-data"),d=e.width()-4;var c=f.offsetX||f.originalEvent.layerX;var g=h.offset().left,b=e.offset().left;var j=h.clone();j.css({"z-index":2}).width(d).height(h.height());h.draggable("option","cursorAt",{left:c+(g-b)+2});return j},_onDropHelper:function(c,g){var b=c.draggable("option","grid");var h=this.$root.prevAll(".cal-v-meter").length,e=Math.round(g.left/b[0]);var k=Math.round(g.top/this.selectStep)*this.selectStep/this.pixelPerUnit;var d=Math.round(c.height()/this.selectStep)*this.selectStep/this.pixelPerUnit;if(0<=e&&e<7&&0<k+d&&k<24){var j=(e-h)*24+k;if(j!=c.data("start")){var f=j+d-this.selectStep/this.pixelPerUnit;this._triggerTermChanged(c,j,f)}}}};desknets.cal.WeekTimeLineDay.prototype=a.extend({},desknets.cal.TimeVertical.prototype,desknets.cal._weekTimeLineDayInst);desknets.cal.WeekTimeLines=function(d,c,b){this.init(d,c,b);return this};desknets.cal._weekTimeLinesInst={_weekCalendar:desknets.cal.DateHorizontal.prototype,_timeMeter:null,_dayTimeLines:[],_selectedTLIndex:-1,_selectedHourIndex:-1,init:function(d,c,b){this.$root=d;this._dayTimeLines=[];this._initCalendar(d,c,b);this._initTimeLines(d,c,b);this.$root.find(".cal-week-timelines").bind(desknets.EVENT_SCROLL,function(){desknets.cal.refPopUp.close()})},destroy:function(){},getDate:function(){return this._weekCalendar.getDate()},setDate:function(b){var d=this._weekCalendar.getDate();this._saveSelectedTimeLineIndex();this._weekCalendar.setDate(b);for(var c=0;c<this._dayTimeLines.length;c++){this._dayTimeLines[c].setDate(neo.dateTime.moveDate(b,c))}this._selectTimeLine(d)},setSelectable:function(c){this._weekCalendar.setSelectable(c);for(var b=0;b<this._dayTimeLines.length;b++){this._dayTimeLines[b].setSelectable(c)}},replaceItems:function(c){var b=this;var d=this._getEmptyTimeLineItems();var e=[];a.each(c,function(g,h){var f=false;a.each(b._dayTimeLines,function(j,k){if(k.canAdd(h)){d[j].push(h);f=true}});if(!f){e.push(h)}});this._weekCalendar.replaceItems(e);a.each(this._dayTimeLines,function(g,f){f.replaceItems(d[g])})},setMaxIndex:function(b){for(var c=0;c<this._dayTimeLines.length;c++){this._dayTimeLines[c].maxIndex=b}},getDayTimeLine:function(b){if(this._dayTimeLines.length>b){return this._dayTimeLines[b]}else{return null}},_initCalendar:function(e,d,c){var b=e.find(".cal-h-week");this._weekCalendar=new desknets.cal.DateHorizontal(b,d,c)},_initTimeLines:function(g,d,c){var b=this,f=g.find(".cal-week-timelines-days");var e=this.getDate();this._timeMeter=new desknets.cal.WeekTimeLineDay(g.find(".cal-week-time-meter"),d,c);f.find(".cal-v-meter").each(function(j){var h=new desknets.cal.WeekTimeLineDay(a(this),d,c);h.setDate(neo.dateTime.moveDate(e,j));b._dayTimeLines.push(h)})},_getEmptyTimeLineItems:function(){var c=[];for(var b=0;b<this._dayTimeLines.length;b++){c.push([])}return c},_saveSelectedTimeLineIndex:function(){for(var b=0;b<this._dayTimeLines.length;b++){if(desknets.cal.selection.calendar==this._dayTimeLines[b]){this._selectedTLIndex=b;this._selectedHourIndex=desknets.cal.selection.index;return}}this._selectedTLIndex=-1;this._selectedHourIndex=-1},_selectTimeLine:function(d){var c=this._selectedHourIndex;if(0<=c&&c<24){var e=neo.dateTime.getDaysGap(this._weekCalendar.getDate(),d);var b=this._selectedTLIndex+e;if(0<=b&&b<this._dayTimeLines.length){desknets.cal.selection.select(this._dayTimeLines[b],c)}}}};desknets.cal.WeekTimeLines.prototype=desknets.cal._weekTimeLinesInst;desknets.cal.refPopUp={TMPL_DATETIME:'{{if repeat}}<th><span class="co-colon">{{L_DateTime}}</span></th><td>{{if repeat==desknets.cal.REPEAT_RANDOM}}<div class="co-selmulti-items-scroll">{{html desknets.cal.tmplRef.dispRepDate(dates, 6, "shortDateFormat")}}</div>{{if typeof allday != "undefined" && starttime == "0000"}}{{L_AllDay}}{{else !!starttime || !!endtime}}{{html desknets.cal.tmplRef.dispTimeShort(starttime)}}{{if endtime}} {{L_DateFromTo}} {{html desknets.cal.tmplRef.dispTimeShort(endtime)}}{{/if}}{{/if}}{{else}}{{html desknets.tmpl.dispStr(datedisp)}}{{/if}}</td>{{else}}{{if allday}}<th><span class="co-colon">{{L_DateTime}}</span></th><td>{{html desknets.dateTime.dispDateTime(startdate)}}{{if startdate != enddate}} {{L_DateFromTo}} {{html desknets.dateTime.dispDateTime(enddate)}}<br />{{/if}} {{L_AllDay}}</td>{{else}}<th><span class="co-colon">{{L_StartDateTime}}</span></th><td>{{html desknets.dateTime.dispDateTime(startdate)}} {{html desknets.cal.tmplRef.dispTimeShort(starttime)}}</td></tr><tr><th><span class="co-colon">{{L_EndDateTime}}</span></th><td>{{html desknets.dateTime.dispDateTime(enddate)}} {{html desknets.cal.tmplRef.dispTimeShort(endtime)}}</td>{{/if}}{{/if}}',TMPL_SCH:'<div class="cal-ref-pop-up-titlebar">{{html desknets.cal.refPopUp.getSchIcons($item.data)}}{{html desknets.tmpl.dispStr(desknets.cal.getSubject(event, detail))}}</div><table class="cal-ref-pop-up-body"><tbody><tr>{{DateTimeEntry}}</tr><tr><th class="sch-row-place"><span class="co-colon">{{L_Place}}</span></th><td class="sch-row-place cal-ref-s-line">{{html desknets.tmpl.dispStr(desknets.cal.getSubject(place, other))}}</td></tr>{{if typeof(pids) != "undefined" && !!pids }}<tr><th class="sch-row-memo"><span class="co-colon">{{L_Plant}}</span></th><td class="sch-row-memo"><div class="cal-ref-memo">{{html desknets.tmpl.dispItems(pids)}}</div></td></tr>{{/if}}<tr><th class="sch-row-memo"><span class="co-colon">{{L_Memo}}</span></th><td class="sch-row-memo"><div class="cal-ref-memo">{{html desknets.tmpl.dispStr(memo)}}</div></td></tr></tbody></table><div class="cal-ref-pop-up-footer"><a class="jco-pagemod" href="{{html refUrl}}" data-hashcmd="schindex">{{L_SchRefer}}</a> <span class="line">|</span> <a href="{{html dupUrl}}" data-hashcmd="schindex">{{L_Duplicate}}</a>{{if agendaUrl}} <span class="line">|</span> <a class="jcal-btn-agenda" href="{{html agendaUrl}}" data-hashcmd="agendaindex">{{if agnids == 0}}{{L_AgendaEntry}}{{else}}{{L_AgendaRefer}}{{/if}}</a>{{/if}}{{if accessdel}}<a class="cal-btn-delete" href="#" data-cmd="${cmddel}" data-confirm="${delconfirm}">{{L_Delete}}</a>{{/if}}</div>',TMPL_PLANT:'<div class="cal-ref-pop-up-titlebar">{{html desknets.cal.refPopUp.getSchIcons($item.data)}}{{html desknets.tmpl.dispStr(desknets.cal.getSubject(event, detail))}}</div><table class="cal-ref-pop-up-body"><tbody><tr>{{DateTimeEntry}}</tr><tr><th class="sch-row-memo"><span class="co-colon">{{L_Memo}}</span></th><td class="sch-row-memo"><div class="cal-ref-memo">{{html desknets.tmpl.dispStr(memo)}}</div></td></tr></tbody></table><div class="cal-ref-pop-up-footer"><a class="jco-pagemod" href="{{html refUrl}}" data-hashcmd="plantweekgrp">{{L_PlantRefer}}</a> <span class="line">|</span> <a href="{{html dupUrl}}" data-hashcmd="plantweekgrp">{{L_Duplicate}}</a>{{if agendaUrl}} <span class="line">|</span> <a class="jcal-btn-agenda" href="{{html agendaUrl}}" data-hashcmd="agendaindex">{{if agnids == 0}}{{L_AgendaEntry}}{{else}}{{L_AgendaRefer}}{{/if}}</a>{{/if}}{{if accessdel}}<a class="cal-btn-delete" href="#" data-cmd="${cmddel}" data-confirm="${delconfirm}">{{L_Delete}}</a>{{/if}}</div>',TMPL_TODO:'<div class="cal-ref-pop-up-titlebar"><span class="${iconClass}">[ToDo]</span>{{L_ToDoTitile}}</div><table class="cal-ref-pop-up-body"><tbody><tr><th><span class="co-colon">{{L_Label}}</span></th><td class="cal-ref-s-line">{{html desknets.tmpl.dispStr(labelname)}}</td></tr><tr><th><span class="co-colon">{{L_Due}}</span></th><td>${desknets.dateTime.dispDateTime(limdate + limtime)}</td></tr><tr><th><span class="co-colon">{{L_Memo}}</span></th><td><div class="cal-ref-memo">{{html desknets.tmpl.dispStr(memo)}}</div></td></tr></tbody></table><div class="cal-ref-pop-up-footer"><a class="jco-pagemod" href="${refUrl}" data-hashcmd="todolist">{{L_ToDoRefer}}</a>{{if complete}}{{else}} <span class="line">|</span> <a class="cal-btn-complete" href="#">{{L_Complete}}</a>{{/if}}</div>',init:function(){var c=desknets.Resource.cal,b;b=this.TMPL_DATETIME;b=desknets.tmpl.replaceWordHtml(b,"L_DateTime",c.DateTimeLabel);b=desknets.tmpl.replaceWordHtml(b,"L_DateFromTo",c.DateFromTo);b=desknets.tmpl.replaceWordHtml(b,"L_StartDateTime",c.startDateTimeLabel);b=desknets.tmpl.replaceWordHtml(b,"L_EndDateTime",c.endDateTimeLabel);b=desknets.tmpl.replaceWordHtml(b,"L_AllDay",c.allDayLabel);this.TMPL_DATETIME=b;b=this.TMPL_SCH;b=desknets.tmpl.replaceWordHtml(b,"DateTimeEntry",this.TMPL_DATETIME);b=desknets.tmpl.replaceWordHtml(b,"L_Place",c.placeLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Plant",c.plantLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Memo",c.memoLabel);b=desknets.tmpl.replaceWordHtml(b,"L_SchRefer",c.schReferLabel);b=desknets.tmpl.replaceWordHtml(b,"L_AgendaRefer",c.agendaReferLabel);b=desknets.tmpl.replaceWordHtml(b,"L_AgendaEntry",c.agendaEntryLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Duplicate",c.duplicateLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Delete",desknets.Resource.delLabel);this.TMPL_SCH=b;b=this.TMPL_PLANT;b=desknets.tmpl.replaceWordHtml(b,"DateTimeEntry",this.TMPL_DATETIME);b=desknets.tmpl.replaceWordHtml(b,"L_Memo",c.memoLabel);b=desknets.tmpl.replaceWordHtml(b,"L_PlantRefer",c.schReferLabel);b=desknets.tmpl.replaceWordHtml(b,"L_AgendaRefer",c.agendaReferLabel);b=desknets.tmpl.replaceWordHtml(b,"L_AgendaEntry",c.agendaEntryLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Duplicate",c.duplicateLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Delete",desknets.Resource.delLabel);this.TMPL_PLANT=b;b=this.TMPL_TODO;b=desknets.tmpl.replaceWordHtml(b,"L_ToDoTitile",c.toDoReferTitle);b=desknets.tmpl.replaceWordHtml(b,"L_Label",c.labelLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Complete",c.completeLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Due",c.dueDateTimeLabel);b=desknets.tmpl.replaceWordHtml(b,"L_ToDoRefer",c.toDoReferLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Memo",c.memoLabel);this.TMPL_TODO=b},open:function(b,c){var d=b.closest(".cal-item").data("type");if(d=="sch"){this.openSchedule(b,c)}else{if(d=="plant"){this.openPlant(b,c)}else{if(d=="todo"){this.openToDo(b,c)}}}},openSchedule:function(b,c){var d=a.extend({cmdindex:desknets.cal.PAGE_SCH_INDEX,cmdref:desknets.cal.CMD_SCH_REF,cmddel:desknets.cal.CMD_SCH_DEL,pageref:desknets.cal.PAGE_SCH_REF,pageadd:desknets.cal.PAGE_SCH_ADD,tmpl:this.TMPL_SCH},c);this.openEventItem(b,d)},openPlant:function(b,c){var d=a.extend({cmdindex:desknets.cal.PAGE_PLANT_INDEX,cmdref:desknets.cal.CMD_PLANT_REF,cmddel:desknets.cal.CMD_SCH_DEL,pageref:desknets.cal.PAGE_PLANT_REF,pageadd:desknets.cal.PAGE_PLANT_ADD,tmpl:this.TMPL_PLANT},c);this.openEventItem(b,d)},openEventItem:function(b,d){var c=this;var g=this._getIdByElement(b);var e=a.extend({cgi:desknets.getUrl(desknets.MODULE_MAIN),cgirest:desknets.getUrl(desknets.MODULE_API_MAIN)},d);var f=this._getEventItemUrls(b,g,e);desknets.ajax.rest({url:e.cgirest,data:{cmd:e.cmdref,sid:g,seldate:b.data("date")},success:function(j){var l=j.agnids;var h={sid:g,seldate:b.data("date"),agnids:l};var m;if(j.public_level=="open"){m=""}else{m="1"}var k=a.extend({},j,f,{agendaUrl:c.GetAgendaUrl(h,true),cmddel:e.cmddel,level:m});var n=c._createPopUpBody(b,e.tmpl,k);n.addClass(desknets.cal.item.getColorById(j.schcolor));if(!desknets.cal.tmplRef.isApprovOrNormal(j.approvsts,j.approvreq)){n.addClass("approval")}}})},openToDo:function(e,k){var j=this;var d=this._getIdByElement(e);var b=a.extend({},k);var g=e.closest(".cal-item");var h={cmd:desknets.cal.PAGE_TODO_REF,id:d};var f=desknets.cal.CGI_TODO+"?cmd="+desknets.cal.PAGE_TODO_INDEX;var c=j._getRefUrl(f,h,b.bproc);desknets.ajax.rest({url:desknets.cal.CGI_TODO_REST,data:{cmd:desknets.cal.CMD_TODO_REF,id:d},success:function(l){var m=a.extend({},l,{refUrl:c});var n=!!l.compsts?desknets.ajax.getItems(l.compsts.item):[];m.complete=n.length>0&&n[0].id=="1";m.iconClass=g.children('[class^="sch-ictype1-todo"]').attr("class");j._createToDoPopUpBody(e,m)}})},close:function(){desknets.popUp.hide("#cal-ref-pop-up")},getSchIcons:function(b){if(b.visitor){b.visit="1"}var c=desknets.cal.item.getItemFromSch(b);return desknets.cal.tmpl.getIconsAsHtml(c)},_createToDoPopUpBody:function(b,d){var c=this;var e=this._createPopUpBody(b,this.TMPL_TODO,d);e.find(".cal-btn-complete").click(function(f){f.preventDefault();c._completeToDo(b.closest(".cal-item"))});e.addClass("todo")},_createPopUpBody:function(b,e,g){var c=this;var h=this._getBlankPopUp();var f=a('<script type="text/x-jquery-tmpl" />').prop("text",e).tmpl(g);var d={target:b};h.find(".jcal-ref-pop-up-frame").html(f);h.find(".cal-btn-delete").click(function(j){j.preventDefault();var k=a(this);c._deleteTargetData(b,{cmd:k.data("cmd"),approval:a("#cal-ref-pop-up").hasClass("approval"),confirm:k.data("confirm")})});h.find(".jcal-btn-agenda").click(function(k){if(g.agnids&&g.agnids==0){k.preventDefault();var l;var m=desknets.Resource.Message.com_open_agendaadd;var j=a(this).attr("href");l=desknets.dialog.confirm(m,function(){desknets.submitform.setDialogDisabled(l);desknets.execLocation(j)})}});desknets.popUp.open(h,d);desknets.htmlparts.convertHrefInText(h.find(".cal-ref-memo"));setTimeout(function(){c._fixPopUpPosition(h,b)},2);return h},_getBlankPopUp:function(){var b=this;var c=a("#cal-ref-pop-up");if(c.length<=0){c=a(desknets.popUp.TMPL_POP_UP).attr("id","cal-ref-pop-up");c.children(".co-baloon-body").addClass("jcal-ref-pop-up-frame");c.appendTo("body");c.on("click","a",function(){b._onClickAnchor(a(this))})}else{c.attr("class","co-baloon co-pop-up-box");c.find(".jcal-ref-pop-up-frame").empty()}return c},_fixPopUpPosition:function(f,e){var j=e.closest(".jcal-v-scroller");var d=e.closest(".jcal-h-scroller");var c=f.children(".co-baloon-connecter");var h=j.offset(),b=d.offset();var g=f.offset();if(j.length>0&&!!h){h.bottom=h.top+j.height();g.bottom=g.top+f.height();if(g.bottom<h.top){f.css("top",(h.top-g.bottom+g.top+1)+"px")}else{if(g.top>h.bottom){f.css("top",(h.bottom-1)+"px")}}}if(d.length>0&&!!b){b.right=b.left+d.width();g.right=g.left+f.width();c.removeAttr("style");if(g.left<b.left){f.css("left",b.left+"px");if(String(f.attr("class")).indexOf("left")>=0){c.css("right",(b.left-g.left)+"px")}}else{if(g.right>b.right){f.css("left",(b.right-g.right+g.left)+"px");if(String(f.attr("class")).indexOf("right")>=0){c.css("left",(g.right-b.right)+"px")}}}}},_onClickAnchor:function(b){var c=b.data("hashcmd");if(!!c){desknets.saveHashCmdCookie(c)}},_getEventItemUrls:function(b,h,d){var c=d.cgi+"?cmd="+d.cmdindex;var g={seldate:b.data("date")};var e=a.extend({cmd:d.pageref,sid:h},g);if(!b.data("mydata")||b.data("mydata")=="1"){e.mydata="1"}else{e.mydata="0"}var f=a.extend({cmd:d.pageadd,copyid:h},g);return{refUrl:this._getRefUrl(c,e,d.bproc),dupUrl:this._getRefUrl(c,f,d.bproc)}},GetAgendaUrl:function(c,f){if(!c.agnids){return""}var e={};var b=desknets.getUrl(desknets.cal.CGI_AGENDA)+"?cmd="+desknets.cal.PAGE_AGENDA_INDEX;if(c.agnids==0){e={cmd:desknets.cal.PAGE_AGNEDA_ENTRY,sid:c.sid,seldate:c.seldate}}else{e={cmd:desknets.cal.PAGE_AGNEDA_REF,id:c.agnids}}if(f){return this._getRefUrl(b,e,desknets.getProcUrl(true))}else{var d=a.param(e);return b+"#"+d}},_getRefUrl:function(b,e,c){var d=a.param(e);if(!!c){return b+"#"+d+"&bproc="+encodeURIComponent(c)}else{return"#"+d}},_getIdByElement:function(b){return desknets.getDataAttr(b.closest(".cal-item"),"id")},_getSameDataItemElement:function(b){var c=b.closest(".cal-item");return a(".cal-item-"+c.data("type")+"-"+desknets.getDataAttr(c,"id"))},_deleteTargetData:function(b,d){var c=b.closest(".cal-item");var e=a.extend({date:neo.dateTime.parse(c.data("date")),repeat:c.data("repeat"),success:function(){desknets.popUp.hideAll();b.trigger("refresh.cal",{action:"delete"})}},d);desknets.cal.deleteItem(desknets.getDataAttr(c,"id"),e)},_completeToDo:function(b){var c=this._getSameDataItemElement(b);desknets.ajax.rest({url:desknets.cal.CGI_TODO_REST,data:{cmd:desknets.cal.CMD_TODO_COMPLETE,id:this._getIdByElement(b)},success:function(){desknets.popUp.hideAll();c.children('[class^="sch-ictype1-todo"]').attr("class","sch-ictype1-todocomplete")}})}}})(jQuery);