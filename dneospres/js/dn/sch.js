/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2017 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.sch={CMD_RSCHPRIVATE:"schprivate",CMD_RSCHDEL:"schdel",CMD_RSCHMODTAG:"schmodtag",CMD_RSCHMODAPPROV:"schmodapprov",CMD_SCHHOLIDAY:"schholidaylist",CMD_SCHFILTARGET:"schfiltarget",CMD_SCHMODDISPATTACH:"schmoddispattach",CMD_SCHHOLDONENTRY:"schcmdholdonentry",CMD_SCHSEARCH:"schcmdsearch",CMD_PLANTSELPLANT:"plantselplant",CMD_PLANTSELPGROUP:"plantselpgroup",PAGE_SCHYEARCAL:"schyearcalhtml",VAL_SCHDELSELF:"1",VAL_SCHDELALL:"2",VAL_SCHACCESSENABLE:"1",REPEAT_WEEK:"w",REPEAT_MONTH:"m",banpei:null};desknets.sch.util={};desknets.sch.util.dateTime={getRecurrenceMessage:function(b){return[this._getRecurrenceRangeMessage(b),this._getRecurrenceIntervalMessage(b)].join(" ")},_getRecurrenceRangeMessage:function(e){var d,c,b;if(e.rependtimes>0){d=desknets.Resource.sch.recurrenceDescFormat_repeat;d=desknets.tmpl.replaceWordHtml(d,"rependtimes",e.rependtimes)}else{d=desknets.Resource.sch.recurrenceDescFormat_enddate;b=this._getRecurrenceDateMessage(e.enddate);d=desknets.tmpl.replaceWordHtml(d,"enddate",b)}c=this._getRecurrenceDateMessage(e.startdate);d=desknets.tmpl.replaceWordHtml(d,"startdate",c);return d},_getRecurrenceDateMessage:function(b){if(a.type(b)!="date"){b=neo.dateTime.parse(b)||new Date()}return neo.dateTime.format(desknets.Resource.dateFormat,b)},_getRecurrenceIntervalMessage:function(e){var b,d;b=desknets.Resource.sch["recurrenceDescFormat_"+e.repeat];b=desknets.tmpl.replaceWordHtml(b,"interval",e.interval);if(e.repeat==desknets.sch.REPEAT_WEEK&&!!e.everyweekday){var c=this._getRecurrenceDayOfWeekMessage(e.everyweekday,"short");d=desknets.Resource.sch.recurrenceDescFormat_dayOfWeek;d=desknets.tmpl.replaceWordHtml(d,"recurrence",b);d=desknets.tmpl.replaceWordHtml(d,"daysOfWeek",c)}else{if(e.repeat==desknets.sch.REPEAT_MONTH){d=this._getRecurrenceMonthMessage(e);d=desknets.tmpl.replaceWordHtml(d,"recurrence",b)}else{d=b}}return d},_getRecurrenceDayOfWeekMessage:function(d,c){var f=[];var e=neo.Resource.dateTime[c+"Weeks"];for(var b=0;b<d.length;b++){if(d.charAt(b)=="1"){f.push(e[(b+1)%7])}}return f.join(", ")},_getRecurrenceMonthMessage:function(h){var g,e=h.everyweek;if(!!e&&!!h.everyweekday){var f=desknets.Resource.sch.recurrenceDescFormat_weekOfMonth;var b=(0<e&&e<=f.length)?f[e]:f[0];var c=this._getRecurrenceDayOfWeekMessage(h.everyweekday,"long");g=desknets.Resource.sch.recurrenceDescFormat_weekAndDayOfMonth;g=desknets.tmpl.replaceWordHtml(g,"weekOfMonth",b);g=desknets.tmpl.replaceWordHtml(g,"dayOfWeek",c)}else{var d=h.startdate;if(a.type(d)!="date"){d=neo.dateTime.parse(d)}g=desknets.Resource.sch.recurrenceDescFormat_dayOfMonth;g=desknets.tmpl.replaceWordHtml(g,"day",d.getDate())}return g}};desknets.sp.sch={CMD_SCHPSETGEN:"schpsetgen",CMD_SCHEVENT:"schevent",CMD_SCHPLACE:"schplace",CMD_PLANTENTRYFREELIST:"plantentryfreelist",VAL_SCHID:"sch",COOKIENAME_SCHMONTH:"dnzSpSchMonth",settingKeys:["disptotime","holiday","othercolor","sunday","openperm","unit","rokuyou"],init:function(){if(!a("body").hasClass("func_"+this.VAL_SCHID)){return}desknets.sp.mobjPages["day-page"]=desknets.sp.sch.DayPage;desknets.sp.mobjPages["week-page"]=desknets.sp.sch.WeekPage;desknets.sp.mobjPages["month-page"]=desknets.sp.sch.MonthPage;desknets.sp.mobjPages["year-page"]=desknets.sp.sch.YearPage;desknets.sp.mobjPages["schref-page"]=desknets.sp.sch.SchRef;desknets.sp.mobjPages["d-schmodconf-page"]=desknets.sp.sch.SchModConf;desknets.sp.mobjPages["schentry-page"]=desknets.sp.sch.SchEntry;desknets.sp.mobjPages["d-schmodrep-page"]=desknets.sp.sch.SchModRep;desknets.sp.mobjPages["d-schevent-page"]=desknets.sp.sch.SchEvent;desknets.sp.mobjPages["d-schplace-page"]=desknets.sp.sch.SchPlace;desknets.sp.mobjPages["setotherto-page"]=desknets.sp.sch.OthertoSelPage;desknets.sp.mobjPages["d-schoutflg-page"]=desknets.sp.sch.SchOptions;desknets.sp.mobjPages["d-schrankflg-page"]=desknets.sp.sch.SchOptions;desknets.sp.mobjPages["d-schreserve-page"]=desknets.sp.sch.SchOptions;desknets.sp.mobjPages["d-schrepdel-page"]=desknets.sp.sch.SchDelRep;desknets.sp.mobjPages["d-schalldel-page"]=desknets.sp.sch.SchDelAll;desknets.sp.mobjPages["d-schdel-page"]=desknets.sp.sch.SchDel;desknets.sp.mobjPages["d-schtag-page"]=desknets.sp.sch.SchTag;desknets.sp.mobjPages["d-schapprove-page"]=desknets.sp.sch.SchApprove;desknets.sp.mobjPages["usersel-page"]=desknets.sp.sch.UserSelPage;desknets.sp.mobjPages["srch-page"]=desknets.sp.sch.SrchListPage;desknets.sp.mobjPages["srchset-page"]=desknets.sp.sch.SetSrch;desknets.sp.mobjPages["profile-page"]=desknets.sp.UserProfile;desknets.sp.mobjPages["d-userdeselect-page"]=desknets.sp.UserDeselect;desknets.sp.mobjPages["d-schcolor-page"]=desknets.sp.sch.SchColor;desknets.sp.mobjPages["schplantselect-page"]=desknets.sp.sch.SchPlantSelect;desknets.sp.mobjPages["d-schplantdeselect-page"]=desknets.sp.sch.SchPlantDeselect;desknets.sp.mobjPages["neotwi-page"]=desknets.sp.Neotwi;var c=["listcmd","moduleId","moduleLen","psetcmd","settingKeys"];var d={listcmd:desknets.sch.CMD_RSCHPRIVATE,moduleId:this.VAL_SCHID,moduleLen:3,psetcmd:this.CMD_SCHPSETGEN,settingKeys:this.settingKeys};desknets.sp.sch.util.savePageParams(c,d);var e=["day-page","week-page","month-page","year-page"];var b=desknets.sp.getPrm();if(neo.isSet(b.id)){e.push("schref-page")}desknets.sp.initSetEvents(e)},getRequestURL:function(){return desknets.sp.getUrl(desknets.MODULE_API_MAIN)},execNoticeErrorDialog:function(d,b,e){if(!!d.noticeerror){var c="M:"+d.noticeerror;if(!!d.msgadd){c=c+"<br /><br />"+d.msgadd}desknets.sp.msg.view(0,c,true);return true}return false},setColor:function(b,d){var e=b.find(".sch-edit-color");var c=b.find('input[name="schcolor"]');e.removeClass();e.addClass("sch-edit-color");if(d=="1"){e.addClass("blue")}else{if(d=="2"){e.addClass("green")}else{if(d=="3"){e.addClass("yellow")}else{if(d=="4"){e.addClass("pink")}else{if(d=="5"){e.addClass("red")}else{if(d=="6"){e.addClass("gray")}else{if(d=="11"){e.addClass("fblue")}else{if(d=="12"){e.addClass("fgreen")}else{if(d=="13"){e.addClass("fyellow")}else{if(d=="14"){e.addClass("fpink")}else{if(d=="15"){e.addClass("fred")}else{if(d=="16"){e.addClass("fgray")}}}}}}}}}}}}c.val(d)},setColorString:function(c,d){var b=this;var e="";if(d=="blue"){e="1"}else{if(d=="green"){e="2"}else{if(d=="yellow"){e="3"}else{if(d=="pink"){e="4"}else{if(d=="red"){e="5"}else{if(d=="gray"){e="6"}else{if(d=="fblue"){e="11"}else{if(d=="fgreen"){e="12"}else{if(d=="fyellow"){e="13"}else{if(d=="fpink"){e="14"}else{if(d=="fred"){e="15"}else{if(d=="fgray"){e="16"}}}}}}}}}}}}if(e!=""){b.setColor(c,e)}},getDefColor:function(){return{schcolor:"1"}}};desknets.sp.sch.Menu=function(){return this};desknets.sp.sch.menu={schClass:null,$root:null,$mainMenu:null,$subMenu:null,$linkSub:null,subHeight:0,hiding:false,hidingsub:false,VAL_MENUHIDE_TOP:-330,VAL_MANUANIME:200,setUp:function(d,c){var b=this;b.$root=c;b._createMenu();b.schClass=d;b.$mainMenu=b.$root.find(".sch-menu-list");b.$subMenu=b.$root.find(".sch-switch");b.$linkSub=b.$root.find(".jsch-menu-sublink");b.subHeight=b.$subMenu.outerHeight();if(!neo.isSet(b.$mainMenu)||b.$mainMenu.length==0){return}b._createEvent();b._createEventPage();b.cleanMenu()},cleanMenu:function(){var b=this;if(!b.hidingsub){b.hidingsub=true;b._toggleMenu(b.$subMenu,(b.subHeight*-1),false)}if(!b.hiding){b.hiding=true;b._toggleMenu(b.$mainMenu,b.VAL_MENUHIDE_TOP,false)}},_createMenu:function(){var b=this;var c=a(".sch-menu-tmpl");b.$root.prepend(c.html())},_createEvent:function(){var b=this;if(!neo.isSet(b.$mainMenu)||b.$mainMenu.length==0){return}b.$root.find(".sch-btn-menu").bind("vclick",function(c){c.preventDefault();var d=b.$mainMenu.css("top");if(d==b.VAL_MENUHIDE_TOP+"px"){b._toggleMenu(b.$mainMenu,b.VAL_MENUHIDE_TOP,true)}else{b.cleanMenu()}});b.$linkSub.bind("vclick",function(c){c.preventDefault();var d=b.$subMenu.css("top");if(d==(b.subHeight*-1)+"px"){a(this).closest("li").addClass("on");b._toggleMenu(b.$subMenu,(b.subHeight*-1),true)}else{if(!b.hidingsub){a(this).closest("li").removeClass("on");b.hidingsub=true;b._toggleMenu(b.$subMenu,(b.subHeight*-1),false)}}})},_createEventPage:function(){var b=this;b.$mainMenu.delegate(".jsch-menu","vclick",function(d){d.preventDefault();var c=a(this).data("page");var f=desknets.sp.mobjPages[c+"-page"];var e={};a(this).closest("li").addClass("on");if(b.$root.attr("id")===c+"-page"){b.$mainMenu.find(".jsch-reload").trigger("vclick");return}b.cleanMenu();if(a(this).hasClass("cal")){f.setSchDate(b.schClass.getSchDate());e.transition="fade";if(c=="day"){desknets.sp.mobjPages["day-page"].setSchDayTime(new Date().getHours()+"00")}}else{if(a(this).hasClass("calreverse")){e.reverse=true}}if(c=="srch"){f.getDefSrch(true)}f.invalidate();desknets.sp.changePage(c,e)});b.$mainMenu.delegate(".jsch-reload","vclick",function(c){c.preventDefault();a(this).closest("li").addClass("on");b.cleanMenu();b.schClass.execBeforAjaxStart();b.schClass.reload()});b.$subMenu.delegate(".jsch-menu-today","vclick",function(c){c.preventDefault();a(this).closest("li").addClass("on");b.cleanMenu();b.schClass.setSchDate(desknets.dateTime.current);b.schClass.initSchDate();b.schClass.replaceItems()});b.$mainMenu.delegate(".jsch-menu-entry","vclick",function(d){d.preventDefault();var c=desknets.sp.sch.util.getPageParams("moduleId")+"entry";a(this).closest("li").addClass("on");b.cleanMenu();desknets.sp.mobjPages[c+"-page"].setPage("",neo.dateTime.format("yyyyMMdd",b.schClass.getSchDate()));desknets.sp.changePage(c)})},_toggleMenu:function(e,c,f){var b=this;if(f){var d=b.$root.find(".ui-header").height();e.show();e.css("top",c);var g=d;g=g+"px";e.animate({top:g},b.VAL_MANUANIME)}else{e.animate({top:c+"px"},b.VAL_MANUANIME);setTimeout(function(){e.hide();e.find("li").removeClass("on");b.hiding=false;b.hidingsub=false},b.VAL_MANUANIME*2)}}};desknets.sp.sch.Menu.prototype=desknets.sp.sch.menu;desknets.sp.sch.util={pageParams:{},targetId:"",targetName:"",savePageParams:function(c,d){var b=this;a.each(c,function(f,e){if(typeof d[e]!="undefined"){b.pageParams[e]=d[e]}})},getPageParams:function(b){if(neo.isSet(this.pageParams[b])){return this.pageParams[b]}return""},setTargetId:function(b){if(neo.isSet(b)){this.targetId=b}else{this.targetId=""}},getTargetID:function(){if(neo.isSet(this.targetId,{blank:false})){return this.targetId}else{return desknets.sp.getLoginUid()}},setTargetName:function(b){if(neo.isSet(b)){this.targetName=b}else{this.targetName=""}},getTargetName:function(){if(neo.isSet(this.targetName,{blank:false})){return this.targetName}else{return desknets.sp.getLoginName()}},getSchSetting:function(){return desknets.cal.settings.of(this.getPageParams("moduleId"))},isAddSeacret:function(){var b=this.getSchSetting();return b.openperm=="1"},getIntervalUnit:function(){var b=this.getSchSetting();return b.unit},isShow6Week:function(){var b=this.getSchSetting();return b.rokuyou=="1"}};desknets.page(desknets.sp.sch,"CalPage",desknets.sp.ComPage,{$dateNav:a(),initSch:true,syncRequestWithGen:true,initCal:false,initCallBack:{},menu:desknets.sp.sch.Menu.prototype,date:desknets.dateTime.current,targetId:"",settingsKey:"sch",VAL_HEADFORMAT:"MM",VAL_SCHPROC:"",init:function(c){var b=this;b.callBase("init",c);desknets.sp.cal.settings.initSetting(function(){b._initCals()})},showing:function(){var b=this;b.callBase("showing");b.initSchDate();if(!b.initSch){b.menu.cleanMenu()}},show:function(){var b=this;b.callBase("show");if(b.initSch){b.menu=new desknets.sp.sch.Menu;b.menu.setUp(this,b.$mRootElement);b._initDateNav();b._initSchEvent()}b.initSch=false},replaceItems:function(){var b=this;b._getSchData(b.date)},getListRequestURL:function(){return desknets.sp.sch.getRequestURL()},setSchDate:function(b){this.date=b},initSchDate:function(){var b=this;b._initSchDate(b.date);b._initSchHead(b.date)},getSchDate:function(){return this.date},isHolidayShown:function(){return false},_initDateNav:function(){var b=this;b.$dateNav=b.$mRootElement.find(".jsch-cal-date-header");b.$dateNav.neoDateNav({date:b.date,change:function(d,c){b._changeDate(c.date)}})},_initSchHead:function(c){var b=this;var d=c.getDay();b.$mRootElement.find(".jsch-title-day").html(neo.dateTime.format(b.VAL_HEADFORMAT,b.date));b.$mRootElement.find(".jsch-title-year").html(neo.dateTime.format("yyyy",b.date));b.$mRootElement.find(".jsch-title-month").html(desknets.sp.cal.getMonthText(b.date))},_initSchDate:function(b){this.$dateNav.neoDateNav({date:b})},_initCals:function(){var b=this;b.initCal=true;if(!a.isEmptyObject(b.initCallBack)){b.initCallBack.callFunc(b.initCallBack.callItem);b.initCallBack={}}},_initSchEvent:function(){},_changeDate:function(c){var b=this;b.execBeforAjaxStart();b.date=c;b._initSchHead(c);b.menu.cleanMenu();b._getSchData(c)},_getSchData:function(c){var b=this;function d(){var e=b._getSchDataParamArray(c);desknets.sp.ajax.rest({url:b.getListRequestURL(),data:desknets.sp.ajax.arrayToMultiCmdData(e),detectMultiError:true,success:function(g,f,h){b._onSchSuccess(g)}})}if(this.initCal||!this.syncRequestWithGen){d()}else{this.initCallBack={callFunc:d,callItem:null}}},_getSchDataParamArray:function(b){var c=[];if(this.isHolidayShown()){c.push(this._getHolidayDataParams(b))}c.push(this._getSchDataParams(b));return c},_getSchDataParams:function(c){var b=this;var d=neo.dateTime.format("yyyyMMdd",c);var e={cmd:desknets.sp.sch.util.getPageParams("listcmd"),id:desknets.sp.sch.util.getTargetID(),date:d,proc:b.VAL_SCHPROC};return e},_getHolidayDataParams:function(b){return{cmd:"schholidaylist",id:desknets.sp.sch.util.getTargetID()}},_onSchSuccess:function(b){var c=this._getRestSch(b,{index:0});this._replaceSchItem(c);this.pageViewEnd();this._pageViewEndSchAdd()},_getRestSch:function(d,c){var e=[],b;if(this.isHolidayShown()){a.merge(e,this._getHolidayItemsFromJson(d[c.index.toString()]));c.index++}a.merge(e,this._getEventItemsFromJson(d[c.index.toString()]));c.index++;return e},_getEventItemsFromJson:function(c){var b=desknets.cal.tmplList.getJsonItems(c);return desknets.cal.item.getItemsFromSch(b)},_getHolidayItemsFromJson:function(c){var b=desknets.ajax.getJsonItems(c);return desknets.cal.item.getItemsFromHoliday(b)},_replaceSchItem:function(b){},_pageViewEndSchAdd:function(){},_getSchId:function(b){return b.data("id")},_goSchRefer:function(c,e){var b=this;var d=desknets.sp.sch.util.getPageParams("moduleId");b.menu.cleanMenu();desknets.sp.mobjPages[d+"ref-page"].setPage(c,e);desknets.sp.changePage(d+"ref")}});desknets.page(desknets.sp.sch,"DayPage",desknets.sp.sch.CalPage,{VAL_HEADFORMAT:"MM/dd",VAL_SCHPROC:"d",fullTimeList:desknets.sp.cal.FullTimeList.prototype,timeLine:desknets.sp.cal.TimeDaycal.prototype,targetTime:null,setSchDayTime:function(b){if(neo.isSet(b,{blank:false})){this.targetTime=b}else{this.targetTime=null}},_initCals:function(){var c=this;var b=c.$mRootElement.find(".cal-timebar-allday");var d=c.$mRootElement.find(".cal-v-meter");c.fullTimeList=new desknets.sp.cal.FullTimeList(b);c.timeLine=new desknets.sp.cal.TimeDaycal(d);c.fullTimeList.setDate(c.date);c.timeLine.setDate(c.date);c.targetTime=new Date().getHours()+"00";c.callBase("_initCals")},_initSchHead:function(c){var b=this;b.callBase("_initSchHead",c);b.$mRootElement.find(".jsch-title-week").html(desknets.sp.cal.getWeekText(c,true))},_initSchEvent:function(){var b=this;b.$mRootElement.find(".co-area").delegate(".cal-item[href]","vclick",function(c){c.preventDefault();b._goSchRefer(b._getSchId(a(this)),a(this).data("date"))})},_replaceSchItem:function(c){var b=this;b.fullTimeList.setDate(this.date);b.fullTimeList.extractItems(c);b.timeLine.setDate(this.date);b.timeLine.extractItems(c)},_pageViewEndSchAdd:function(){var b=this;if(neo.isSet(b.targetTime)){b._setScrollSchTime();this.targetTime=null}},_setScrollSchTime:function(){var e=this;var d=0;if(this.targetTime!="0000"){var h=Number(this.targetTime);var g=e.$mRootElement.find(".sch-pday");var c=Math.floor(h/100);if(c>0){var f=g.offset().top;var b=g.height()/24;d=f+(b*(c-1))}}setTimeout(function(){a.mobile.silentScroll(d);if(desknets.browser.ipad||neo.mobile.os.iphone){var i=e.$mRootElement.find(".ui-header-fixed");i.hide();i.css("position","static");i.show();setTimeout(function(){i.css("position","fixed")},1)}},300)}});desknets.page(desknets.sp.sch,"WeekPage",desknets.sp.sch.CalPage,{targetDate:null,weekCal:desknets.sp.cal.WeekCalender.prototype,VAL_SCHPROC:"w",getSchDate:function(){var c=this;var d;var b=c.targetDate.getDay();if(b==0){b=7}return neo.dateTime.moveDate(c.date,(b-1))},isHolidayShown:function(){return desknets.cal.settings.of(this.settingsKey).holiday=="1"},_initCals:function(){var c=this;var b=c.$mRootElement.find(".sch-pweek");var d=desknets.sp.sch.util.getPageParams("moduleId");c.weekCal=new desknets.sp.cal.WeekCalender(b,d,desknets.dateTime.current);c.callBase("_initCals")},_initSchHead:function(d){var c=this;var e=c.$mRootElement.find(".sch-bar-date2");var b=neo.dateTime.moveDate(d,6);if(d.getMonth()!=b.getMonth()){if(d.getYear()!=b.getYear()){e.children(".jsch-title-year").html(neo.dateTime.format("yyyy",c.date)+"/"+neo.dateTime.format("yyyy",b));e.addClass("over")}else{c.$mRootElement.find(".jsch-title-year").html(neo.dateTime.format("yyyy",c.date));e.removeClass("over")}c.$mRootElement.find(".jsch-title-day").html(neo.dateTime.format(c.VAL_HEADFORMAT,c.date)+"/"+neo.dateTime.format(c.VAL_HEADFORMAT,b));e.children(".jsch-title-month").html(desknets.sp.cal.getMonthText(c.date)+"/"+desknets.sp.cal.getMonthText(b))}else{e.removeClass("over");c.callBase("_initSchHead",d)}},_initSchDate:function(d){var c=this,b=desknets.sp.cal.getWeekStart(d);this.targetDate=d;if(!this.date||neo.dateTime.compareOn(this.date,b,"day")!=0){this.date=b;this.weekCal.setDate(b)}c.callBase("_initSchDate",c.date)},_initSchEvent:function(){var c=this;var b=c.$mRootElement.find(".sch-pweek");b.delegate("a.sch-pweek-date, div.sch-more>a","vclick",function(e){e.preventDefault();c.execBeforAjaxStart();c.menu.cleanMenu();var d=a(this).closest(".cal-day").find('input[name="caldate"]').val();desknets.sp.mobjPages["day-page"].setSchDate(neo.dateTime.parse(d));desknets.sp.mobjPages["day-page"].invalidate();desknets.sp.changePage("day",{transition:"fade"})});b.delegate(".cal-item[href]","vclick",function(d){d.preventDefault();c._goSchRefer(c._getSchId(a(this)),a(this).data("date"))})},_getHolidayDataParams:function(b){var d=this.callBase("_getHolidayDataParams",b);var c=neo.dateTime.moveDate(b,6);a.extend(d,{startdate:neo.dateTime.format("yyyyMMdd",b),enddate:neo.dateTime.format("yyyyMMdd",c)});return d},_replaceSchItem:function(c){var b=this;b.weekCal.setDate(this.date);b.weekCal.replaceItems(c)}});desknets.page(desknets.sp.sch,"MonthPage",desknets.sp.sch.CalPage,{monthcal:desknets.sp.cal.DateMonthcal.prototype,targetDate:null,dLefts:[],initSchMonth:true,init6Week:false,$listElement:null,$_Tmpl:null,VAL_SCHPROC:"m",VAL_SCHNOOPEN:"jsch-noopen",getSchDate:function(){var b=this;if(!!b.targetDate){return b.targetDate}return b.date},isHolidayShown:function(){return desknets.cal.settings.of(this.settingsKey).holiday=="1"},_initCals:function(){var b=this;var d=b.$mRootElement.find(".sch-cal-month");var c=desknets.sp.sch.util.getPageParams("moduleId");b.monthcal=new desknets.sp.cal.DateMonthcal(d,c);b.$_Tmpl=a("<ul/>").append(d.find("li.jsch-month-tmp").remove());b.$listElement=d.find("ul.sch-pmonth-detail");b.callBase("_initCals")},_initSchEvent:function(){var b=this;var c=a(a.support.checkOn?"body":"html");b.$mRootElement.find(".sch-pmonth").delegate("div.cal-h-week","click",function(h){h.preventDefault();var d=a(this);var i=0;if(h.pageY-c.scrollTop()<b.$mRootElement.find(".ui-header").height()){return}var g=h.pageX;b.dLefts=[];d.find(".cal-day").each(function(k,j){b.dLefts.push(a(this).offset().left)});a.each(b.dLefts,function(j,k){if(k>g){i=j-1;return false}else{if(j==6){i=j}}});var f=d.find("div.cal-day").eq(i);var e=f.find('input[name="caldate"]').val();b._clearSchList();f.addClass("selected");d.find(".cal-item.holiday").each(function(j,k){if(a(this).data("date")==e){var l="selholiday";if(f.hasClass("co-today")){l="selholitoday"}a(this).addClass(l)}});b._setMonthList(e)});b.$mRootElement.find(".sch-pmonth-detail").delegate(".jsch-month-tmp:not(."+b.VAL_SCHNOOPEN+")","vclick",function(d){d.preventDefault();b._goSchRefer(a(this).find('input[name="sId"]').val(),a(this).find(".sch-month-info").data("date"))})},_getSchDataParamArray:function(b){var c=this.callBase("_getSchDataParamArray",b);if(!!desknets.sp.sch.util.isShow6Week()){c.push(this._getRokuyouParams())}return c},_getHolidayDataParams:function(b){var c=this.callBase("_getHolidayDataParams",b);this._extendDateRange(c,"startdate","enddate");return c},_getRokuyouParams:function(){var b={cmd:"schrokuyoulist"};this._extendDateRange(b,"smonth","emonth");return b},_getRestSch:function(d,c){var b=this;var f=this.callBase("_getRestSch",d,c);if(!!desknets.sp.sch.util.isShow6Week()){var e=d[c.index.toString()];setTimeout(function(){b._set6WeekCal(e)},1);c.index++}return f},_replaceSchItem:function(c){var b=this;b.targetDate=null;b._clearSchList();if(!!b.init6Week){var d={url:b.getListRequestURL(),data:b._getRokuyouParams(),success:function(f,e,g){b._set6WeekCal(f)}};desknets.sp.ajax.rest(d);b.init6Week=false}if(!!b.initSchMonth){b.pageViewEnd();b.monthcal.setCalPerUnit()}b.monthcal.setDate(b.date);b.monthcal.replaceItems(c);neo.storage.session(desknets.sp.sch.COOKIENAME_SCHMONTH,c)},_set6WeekCal:function(c){if(!desknets.sp.sch.util.isShow6Week()){return}var b=desknets.ajax.getJsonItems(c);this.monthcal.set6WeekContents(b)},_clearSchList:function(){var b=this;a("div.cal-day").removeClass("selected");a("div.cal-h-bars-data-inner").find(".cal-item.holiday").removeClass("selholiday");b.$mRootElement.find(".jsch-month-list").empty();b.$mRootElement.find("ul.sch-pmonth-detail").children().filter(function(){return !a(this).hasClass("jsch-month-head")}).remove()},_setMonthList:function(d){var c=this;var e=neo.dateTime.parse(d);c.targetDate=e;var b=desknets.dateTime.dispDateTime(d,"dateFormat")+"&nbsp;"+desknets.sp.cal.getWeekText(e,false);c.$mRootElement.find(".jsch-month-list").html(b);c._getSchMonthList(d)},_getSchMonthList:function(d){var c=this;var b=neo.storage.session(desknets.sp.sch.COOKIENAME_SCHMONTH);if(neo.isSet(b)){c._onSchItems(c._getSchDayLists(d,b),d)}else{c.execBeforAjaxStart();var f=desknets.sp.sch.DayPage._getSchDataParams(neo.dateTime.parse(d));var e={url:c.getListRequestURL(),data:f,success:function(h,g,i){c._onSchItems(desknets.sp.sch.DayPage._getRestSch(h),d);c.pageViewEnd()}};desknets.sp.ajax.rest(e)}},_getSchDayLists:function(b,c){var d=[];a.each(c,function(e,f){if(f.startdate<=b&&b<=f.enddate&&f.module!="holiday"){d.push(f)}});return d},_onSchItems:function(j,f){var k=this;var c={dateTimeDisp:true,moveRepDate:false};a.each(j,function(n,o){var m=k.$_Tmpl.html();var l="";var q=a.extend({},c);m=desknets.tmpl.replaceWordChkHtml(m,"id",o.sid);m=desknets.tmpl.replaceWordChkHtml(m,"sdate",f);m=desknets.tmpl.replaceWordHtml(m,"iconHtml",desknets.cal.tmpl.getIconsAsHtml(o));if(o.accessopen!="1"){l=k.VAL_SCHNOOPEN}m=desknets.tmpl.replaceWordHtml(m,"addClass",l);if(!!o.allday&&o.allday=="1"){q.dateTimeDisp=false}var p=k._getSchSubject(m,o,q);k.$listElement.append(p)});k.$listElement.find(".sch-month-info>p").filter(function(){return a(this).text()==""}).html("&nbsp;");if(j.length>0){var e=k.$mRootElement.find(".ui-footer").offset().top;var i=a(".jsch-month-tmp").eq(0);var g=i.height()+i.offset().top;var h=a(a.support.checkOn?"body":"html");var d=h.scrollTop();if(e<g-d){h.animate({scrollTop:d+g-e},300);if(desknets.browser.ipad||neo.mobile.os.iphone){var b=k.$mRootElement.find(".ui-header-fixed");setTimeout(function(){b.hide();b.css("position","static");b.show();setTimeout(function(){b.css("position","fixed")},1)},300)}}k.$listElement.listview("refresh")}},_getSchSubject:function(b,d,c){return desknets.cal.tmplList.getRowHtml(b,d,c)},_extendDateRange:function(h,e,d){var c=this;var f=desknets.sp.sch.util.getSchSetting();var b=desknets.cal.MonthCalendar.getLeftTopDate(c.date,f.sunday);var g=desknets.cal.MonthCalendar.getRightBottomDate(c.date,f.sunday);h[e]=neo.dateTime.format("yyyyMMdd",b);h[d]=neo.dateTime.format("yyyyMMdd",g)}});desknets.page(desknets.sp.sch,"YearPage",desknets.sp.sch.CalPage,{syncRequestWithGen:false,_initCals:function(){var c=this;var b=c.$mRootElement.find(".jsch-year-cal");b.delegate(".sch-anual>li","vclick",function(e){e.preventDefault();c.execBeforAjaxStart();var d=a(this);var f=desknets.sp.mobjPages["month-page"];var g=neo.dateTime.parse(d.find('input[name="calmdate"]').val());f.setSchDate(g);f.invalidate();desknets.sp.changePage("month",{transition:"fade"})})},_initSchHead:function(b){return},_initDateNav:function(){var b=this;b.$dateNav=b.$mRootElement.find(".jsch-cal-date-header");b.$dateNav.delegate("a","click",function(e){var d=b.date;var c=a(this).data("date");var f=neo.dateTime.moveMonth(d,Number(c));b._changeDate(f)})},_getSchDataParamArray:function(b){var c=[];c.push({cmd:this._getYearCalCmd(),caldate:neo.dateTime.format("yyyyMMdd",b)});return c},_onSchSuccess:function(d){var c=this;var e;c.$mRootElement.find(".jsch-year-cal").empty().append(d[0].html);var b=c.$mRootElement.find(".sch-anual-nav");e=b.children(".cur").text();b.remove();c.$mRootElement.find(".jsch-title-year").text(e);c.pageViewEnd()},_getYearCalCmd:function(){return desknets.sch.PAGE_SCHYEARCAL}});desknets.page(desknets.sp.sch,"SchRef",desknets.sp.RefPage,{msTargetDate:"",mbdelAccess:false,mbApproval:false,_mrefrep:"",_mrefdelconfirm:"",msTag:"",moduleId:"",_mborefholdon:false,_tmplAllday:null,$_mVistTemplate:null,arrayBtnClass:["none","single","dual","triple","quad"],initPage:function(){var b=this;b.callBase("initPage");b.moduleId=desknets.sp.sch.util.getPageParams("moduleId");if(!neo.isSet(b.msId,{blank:false})){var c=desknets.sp.getPrm();if(neo.isSet(c.id)){var e=neo.dateTime.format("yyyyMMdd");b.setPage(c.id,e)}else{desknets.sp.resetPage()}}b.$_mVistTemplate=b.$mRootElement.find(".jsch-info-vistmpl").remove();b.$mRootElement.find(".co-footer").delegate(".jsch-del","vclick",function(f){f.preventDefault();b.schRefDel()});b.$mRootElement.find(".co-footer").delegate(".jsch-tag","vclick",function(f){f.preventDefault();desknets.sp.sch.SchTag.setPage(b.msId,b.msTag,b.msTargetDate);desknets.sp.changePage("d-"+b.moduleId+"tag")});b.$mRootElement.find(".co-footer").delegate(".jsch-admit","vclick",function(f){f.preventDefault();desknets.sp.sch.SchApprove.setPage(b.msId,"admit");desknets.sp.changePage("d-"+b.moduleId+"approve",{changeHash:false})});b.$mRootElement.find(".co-footer").delegate(".jsch-denial","vclick",function(f){f.preventDefault();desknets.sp.sch.SchApprove.setPage(b.msId,"denial");desknets.sp.changePage("d-"+b.moduleId+"approve",{changeHash:false})});b.$mRootElement.find(".jsch-header").delegate(".jsch-mod","vclick",function(f){f.preventDefault();if(!b._mborefholdon){desknets.sp.mobjPages[b.moduleId+"entry-page"].setPage(b.msId,b.msTargetDate);desknets.sp.changePage(b.moduleId+"entry")}else{desknets.sp.sch.SchModConf.setPage(b.msId,b.msTargetDate);desknets.sp.changePage("d-"+b.moduleId+"modconf")}});b._tmplAllday=b.$mRootElement.find(".jsch-info-allday").html();var d=a("#d-"+b.moduleId+"modconf-page");if(a("#jsch-openperm").val()=="2"){b.$mRootElement.find(".jsch-info-openperm").hide();d.find("#jsch-modconf-openperm").hide()}else{d.find("#jsch-modconf-openperm").show()}if(!desknets.sp.menu.boView("plant")){d.find("#jsch-modconf-plant").hide()}else{d.find("#jsch-modconf-plant").show()}},getReferRequestURL:function(){return desknets.sp.sch.getRequestURL()},getReferRequestData:function(){var b=this;var c={cmd:b.getSchReferCmd(),sid:b.msId,id:desknets.sp.sch.util.getTargetID(),seldate:b.msTargetDate};return c},getSchReferCmd:function(){return desknets.cal.CMD_SCH_REF},showingPage:function(){var b=this;b.callBase("showingPage");if(!b.mbItemRetrieved){b.$mRootElement.find(".jsch-ref-bsingle").hide();b.$mRootElement.find(".jsch-ref-bdual").hide();b.$mRootElement.find(".jsch-ref-btriple").hide();b.$mRootElement.find(".jsch-ref-bquad").hide();b.$mRootElement.find(".jsch-ref-bnone").show();b.$mRootElement.find(".jsch-mod").hide();b.$mRootElement.find(".jsch-info-allday").hide()}},setUpReferItem:function(k){var u=this;var i="";var d="&nbsp;";var y=0;var m=false;var t=false;var e="";u._mrefrep=k.repeat;u._mrefdelconfirm=k.delconfirm;if(neo.isSet(k.tagcolor)){u.msTag=k.tagcolor;y++}else{u.msTag=""}if(k.accessmod=="1"){u.$mRootElement.find(".jsch-mod").show()}else{u.$mRootElement.find(".jsch-mod").hide()}if(k.accessdel=="1"){u.mbdelAccess=true;y++}if(k.approvsts=="3"&&!!k.accessapprov){u.mbApproval=true;y+=2;m=true}if(!!k.allday&&k.allday=="1"){t=true}var j=desknets.cal.tmplRef.dispEvent(k.event,k.detail);u.$mRootElement.find(".jsch-info-title").html(j);var x=desknets.cal.tmplRef.dispEvent(k.place,k.other);if(x=="&nbsp;"){u.$mRootElement.find(".jsch-info-place").closest("li").hide()}else{u.$mRootElement.find(".jsch-info-place").closest("li").show();u.$mRootElement.find(".jsch-info-place").html(x);if(u.isHoldOnItem_Place(k.place)){m=true}}if(k.repeat){if(k.repeat==desknets.cal.REPEAT_RANDOM){i=desknets.cal.tmplRef.dispRepDate(k.dates,8,"dateFormat");if(!t&&(k.starttime||k.endtime)){var l=desknets.cal.tmplRef.dispTimeLong(k.starttime);if(k.endtime){i=i+"&nbsp;"+l+"&nbsp;-&nbsp;"+desknets.cal.tmplRef.dispTimeLong(k.endtime)}}else{if(t){e="<br />"+u._tmplAllday}}}else{i=desknets.tmpl.dispStr(k.datedisp)}m=true}else{if(t){e="&nbsp;"+u._tmplAllday;i=desknets.dateTime.dispDateTime(k.startdate,"longDateFormat");if(k.startdate!==k.enddate){i=i+"&nbsp;-&nbsp;"+desknets.dateTime.dispDateTime(k.enddate,"longDateFormat")}}else{i=desknets.dateTime.dispDateTime(k.startdate,"longDateFormat");i=i+"&nbsp;"+desknets.cal.tmplRef.dispTimeLong(k.starttime);var h=neo.isSet(k.endtime,{blank:false});if(k.startdate!==k.enddate){i=i+"&nbsp;-&nbsp;";i=i+desknets.dateTime.dispDateTime(k.enddate,"longDateFormat")}else{if(h){i=i+"&nbsp;-&nbsp;"}}if(h){i=i+desknets.cal.tmplRef.dispTimeLong(k.endtime)}}}i=i+e;u.$mRootElement.find(".jsch-info-date").html(i);u.setUpBody(".jsch-info-memo",k.memo);if(k.otherto){if(k.approvstsothertostr){d=desknets.cal.tmplRef.dispOtherTo(k.otherto,k.gids,k.approvstsothertostr);m=true}else{d=desknets.cal.tmplRef.dispOtherTo(k.otherto,k.gids);if(u.isHoldOnItem_Otherto(k.otherto)){m=true}}}else{if(k.gids){d=desknets.cal.tmplRef.dispOtherTo(null,k.gids);m=true}}if(d=="&nbsp;"){u.$mRootElement.find(".jsch-info-otherto").closest("li").hide()}else{u.$mRootElement.find(".jsch-info-otherto").closest("li").show()}u.$mRootElement.find(".jsch-info-otherto").html(d);u.$mRootElement.find(".jsch-info-permit-permission").html(" ");u.$mRootElement.find(".jsch-info-permit").hide();u.$mRootElement.find(".jsch-info-permit-"+k.public_level).show();if(k.public_level=="permission"){u.$mRootElement.find(".jsch-info-permit-permission").html(desknets.tmpl.dispItems(k.permit_user,null,null,null,", "))}var w=desknets.tmpl.dispItems(k.pids);if(w=="&nbsp;"){u.$mRootElement.find(".jsch-info-plant").closest("li").hide()}else{if(desknets.sp.menu.boView("plant")){u.$mRootElement.find(".jsch-info-plant").closest("li").show()}else{u.$mRootElement.find(".jsch-info-plant").closest("li").hide()}if(u.isHoldOnItem_Pids(k.pids)){m=true}}u.$mRootElement.find(".jsch-info-plant").html(w);var v={cmd:desknets.sch.CMD_SCHMODDISPATTACH,sid:u.msId};u.setUpFile(".jsch-info-attach",k.attach,v);u.$mRootElement.find(".jsch-info-attach").enhanceWithin();if(k.approvreq){if(k.approvreq==desknets.cal.tmplRef.APPRVSTS_COMPLETE||k.approvreq==desknets.cal.tmplRef.APPRVSTS_REQ){if(k.mailuse){if(k.aprvmailnotice=="1"){u.$mRootElement.find(".jsch-info-approve.mailuse").show();u.$mRootElement.find(".jsch-info-approve.mailnouse").hide()}else{u.$mRootElement.find(".jsch-info-approve.mailuse").hide();u.$mRootElement.find(".jsch-info-approve.mailnouse").show()}}else{u.$mRootElement.find(".jsch-info-approve.mailuse").hide();u.$mRootElement.find(".jsch-info-approve.mailnouse").show()}}u.$mRootElement.find("div.jsch-info-approve").closest("li").show();m=true}else{u.$mRootElement.find("div.jsch-info-approve").closest("li").hide()}if(k.visitor){u.$mRootElement.find(".jsch-info-vist").closest("li").show();var q=desknets.sp.ajax.getItems(k.visitor.item);var r=q.length;var c=u.$mRootElement.find(".sch-listdsp");c.find(".jsch-info-vistmpl").remove();for(var p=0;p<r;p++){var n=null;n=u.$_mVistTemplate.clone();c.append(n);u.setUpVisitorItem(q[p],n)}c.enhanceWithin();m=true}else{u.$mRootElement.find(".jsch-info-vist").closest("li").hide()}var f=desknets.tmpl.dispStr(k.entry.val)+"&nbsp;("+desknets.dateTime.dispDateTime(k.updtime,"dateTimeFormat")+")";u.$mRootElement.find(".jsch-info-owner").html(f);var b=desknets.tmpl.dispStr(k.creuser)+"&nbsp;("+desknets.dateTime.dispDateTime(k.cretime,"dateTimeFormat")+")";u.$mRootElement.find(".jsch-info-entry").html(b);if(desknets.sp.menu.boView("agent")&&neo.isSet(k.alarm)){if(k.alarm=="1"&&k.alarmtime>0){u.$mRootElement.find(".jsch-info-alarm.nosend").hide();u.$mRootElement.find(".jsch-info-alarm.send").show();var s="",z=desknets.Resource;if(k.alarmtime%1440==0){s=desknets.tmpl.replaceWordHtml(z.alarmDayLabel,"num",k.alarmtime/1440)}else{if(k.alarmtime%60==0){s=desknets.tmpl.replaceWordHtml(z.alarmHourLabel,"num",k.alarmtime/60)}else{s=desknets.tmpl.replaceWordHtml(z.alarmMinuteLabel,"num",k.alarmtime)}}u.$mRootElement.find(".jsch-alarm-time").text(s);m=true}else{u.$mRootElement.find(".jsch-info-alarm.nosend").show();u.$mRootElement.find(".jsch-info-alarm.send").hide()}u.$mRootElement.find("div.jsch-info-alarm").closest("li").show()}else{u.$mRootElement.find("div.jsch-info-alarm").closest("li").hide()}if(y>0){var o=0;u.$mRootElement.find(".jsch-ref-bnone").hide();var g=u.$mRootElement.find(".jsch-ref-b"+u.arrayBtnClass[y]);g.find("a").removeClass("jsch-tag");g.find("a").removeClass("jsch-del");g.find("a").removeClass("jsch-admit");g.find("a").removeClass("jsch-denial");if(neo.isSet(u.msTag,{blank:false})){g.find("a").eq(o).addClass("jsch-tag").text(desknets.Resource.sch.refbtntag);o++;if(u.msTag!="0"){m=true}}if(!!u.mbdelAccess){g.find("a").eq(o).addClass("jsch-del").text(desknets.Resource.delLabel);o++}if(!!u.mbApproval){g.find("a").eq(o).addClass("jsch-admit").text(desknets.Resource.sch.refbtnadmit);o++;g.find("a").eq(o).addClass("jsch-denial").text(desknets.Resource.sch.refbtndenial);o++;m=true}g.show()}if(!m&&(neo.isSet(k.flag,{blank:false})||neo.isSet(k.iconno,{blank:false})||neo.isSet(k.attach,{blank:false})||u.isHoldOnItem_Option(k))){m=true}u._mborefholdon=m},isHoldOnItem_Place:function(b){return false},isHoldOnItem_Otherto:function(b){return false},isHoldOnItem_Pids:function(b){if(desknets.sp.menu.boView("plant")){return false}else{return true}},isHoldOnItem_Option:function(b){return false},setUpVisitorItem:function(b,c){c.find(".jsch-info-vist-company").html(desknets.tmpl.dispStr(b.officename));c.find(".jsch-info-vist-name").html(desknets.tmpl.dispStr(b.Name));c.find(".jsch-info-vist-cnt").html(desknets.tmpl.dispMember(b.members))},setPage:function(c,d){var b=this;b.callBase("setPage",c);b.msTargetDate=d;b.mbdelAccess=false;b.mbApproval=false;b._mborefholdon=false},schRefDel:function(){var c=this;var e=false;if(neo.isSet(c._mrefrep,{blank:false})){if(neo.isSet(c.msTargetDate,{blank:false})){e=true}}var d="";if(c._mrefrep==desknets.cal.REPEAT_RANDOM){d="dates"}else{d="recurrence"}if(c._mrefdelconfirm==desknets.sch.VAL_SCHDELSELF){if(e){desknets.sp.sch.SchDelAll.setPage(c.msId,c.msTargetDate,true,d);desknets.sp.changePage("d-"+c.moduleId+"alldel",{changeHash:false})}else{desknets.sp.sch.SchDelAll.setPage(c.msId,c.msTargetDate,false);desknets.sp.changePage("d-"+c.moduleId+"alldel",{changeHash:false})}}else{if(e){desknets.sp.sch.SchDelRep.setPage(c.msId,c.msTargetDate,false,d);desknets.sp.changePage("d-"+c.moduleId+"repdel",{changeHash:false})}else{var f="";if(c._mrefdelconfirm==desknets.sch.VAL_SCHDELALL){f=desknets.Resource.Message.cal_deltargets_all}var b=desknets.sp.mobjPages["d-"+c.moduleId+"del-page"];b.setPage(c.msId,"",false);b.setMessage(f);setTimeout(function(){desknets.sp.changePage("d-"+c.moduleId+"del",{changeHash:false})},100)}}}});desknets.page(desknets.sp.sch,"SchModConf",desknets.sp.RefPage,{msTargetDate:"",setPage:function(c,d){var b=this;b.callBase("setPage",c);b.msTargetDate=d},initPage:function(){var b=this;var c=desknets.sp.sch.util.getPageParams("moduleId");b.callBase("initPage");b.$mRootElement.find(".jco-ok").on("vclick",function(d){d.preventDefault();desknets.sp.mobjPages[c+"entry-page"].setPage(b.msId,b.msTargetDate);desknets.sp.changePage(c+"entry")})},replaceItems:function(){var b=this;b.pageViewEnd()}});desknets.page(desknets.sp.sch,"SchEntry",desknets.sp.EntryPage,{msTargetDate:"",beforeSDate:null,entryDate:null,entryTime:null,repKind:"",alldayStime:"",alldayEtime:"",mThisObj:null,init:function(c){var b=this;b.callBase("init",c);b.mThisObj=desknets.sp.sch.SchEntry;desknets.sp.UserSelPage.invalidate();if(desknets.sp.mobjPages["schplantselect-page"]){desknets.sp.mobjPages["schplantselect-page"].invalidate()}desknets.sp.cal.settings.initSetting(function(){var d=desknets.sp.sch.util.getIntervalUnit();desknets.sp.seldate.setUpDate(b.$mRootElement);desknets.sp.seldate.setUpTime(b.$mRootElement,{stepMinute:Number(d)})});b.alldayStime=desknets.dateTime.formatHour(desknets.sp.seldate.formatTime,"0000");b.alldayEtime=desknets.dateTime.formatHour(desknets.sp.seldate.formatTime,"2200").replace("22","24");b.$mRootElement.find(".jsch-entry-user").on("vclick",function(d){d.preventDefault();desknets.sp.sch.OthertoSelPage.marea=".jco-input-userlist";desknets.sp.sch.OthertoSelPage.mExecObj=b.mThisObj;desknets.sp.changePage("setotherto")});b.$mRootElement.find(".jsch-entry-permituser").on("vclick",function(d){d.preventDefault();desknets.sp.sch.OthertoSelPage.marea=".jsch-input-userlist";desknets.sp.sch.OthertoSelPage.mExecObj=b.mThisObj;desknets.sp.changePage("setotherto")});if(desknets.sp.mobjPages["schplantselect-page"]){b.$mRootElement.find(".jsch-entry-plant").on("vclick",function(e){e.preventDefault();var d=b.getPlantSrchData();desknets.sp.mobjPages["schplantselect-page"].setPage(d);desknets.sp.changePage("schplantselect")})}b.$mRootElement.find(".jsch-entry-sel").on("vclick",function(d){d.preventDefault();var e="d-sch"+a(this).data("page");desknets.sp.sch.SchOptions.mExecObj=b.mThisObj;desknets.sp.changePage(e)});b.$mRootElement.find(".jsch-entry-color").on("vclick",function(d){d.preventDefault();desknets.sp.changePage("d-schcolor")});b.$mRootElement.on("change.schentry",'input[name="sdate"]',function(){b.entryDate=a(this).data("rval")});b.$mRootElement.on("change.schentry",'input[name="stime"]',function(){var f=b.$mRootElement.find('input[name="etime"]').val();var d=b.$mRootElement.find('input[name="edate"]').val();var e={blank:false};if(b.$mRootElement.find('input[name="all-day"]').prop("checked")){return}if(neo.isSet(f,e)&&neo.isSet(d,e)&&neo.isSet(a(this).val(),e)&&b.beforeSDate){b.setAutoEDateTime(a(this))}b.entryTime=a(this).data("rval");b.beforeSDate=b.entryDate});b.$mRootElement.find('input[name="stime"]').next(".mbscroll-clear").bind("click.schentry",function(d){d.preventDefault();b.beforeSDate=null;b.entryTime="0000"});b.$mRootElement.find('input[name="all-day"]').change(function(){var g=a(this).prop("checked");var d=b.$mRootElement.find(".sch-input-date>.ui-block-b");var f=b.$mRootElement.find('input[name="stime"]');var e=b.$mRootElement.find('input[name="etime"]');if(!!g){f.val(b.alldayStime).change();e.val(b.alldayEtime).change()}a.each(d,function(j,k){var h=a(this);if(!!g){h.find(".mbscroll-clear").hide();h.find(".mbscroll-time").attr("disabled",true)}else{h.find(".mbscroll-clear").show();h.find(".mbscroll-time").attr("disabled",false)}});if(!g&&f.val()==b.alldayStime&&e.val()==b.alldayEtime){d.find(".mbscroll-clear").trigger("click")}});b.$mRootElement.find(".jsch-input-userlist").on("vclick",".jco-entry-usel",function(d){d.preventDefault();var e=a(this).find('input[type="hidden"]').val();desknets.sp.UserProfile.setPage(e);desknets.sp.UserProfile.setEntryObj(b,".jsch-input-userlist");desknets.sp.changePage("profile")});b.$mRootElement.find('select[name="public_level"]').change(function(){if(a(this).val()=="permission"){b.$mRootElement.find(".jsch-input-userlist").show()}else{b.$mRootElement.find(".jsch-input-userlist").hide()}});if(a("#jsch-openperm").val()=="2"){b.$mRootElement.find(".jsch-input-openperm").hide()}if(desknets.sp.mobjPages["d-schplantdeselect-page"]){b.$mRootElement.find(".jsch-input-plantlist").on("vclick",".jsch-entry-psel",function(d){d.preventDefault();desknets.sp.mobjPages["d-schplantdeselect-page"].setPage(a(this));desknets.sp.changePage("d-schplantdeselect")})}},setAutoEDateTime:function(h){var k=this;var e=neo.dateTime.parse(k.beforeSDate+k.entryTime).getTime();var f=k.$mRootElement.find('input[name="edate"]').data("rval");var c=k.$mRootElement.find('input[name="etime"]').data("rval");var b=neo.dateTime.parse(f+c).getTime();if(b<e){return}var i=k.$mRootElement.find('input[name="sdate"]').data("rval");var j=k.$mRootElement.find('input[name="stime"]').data("rval");var d=neo.dateTime.parse(i+j).getTime();var g=new Date(b+(d-e));k.$mRootElement.find('input[name="edate"]').val(neo.dateTime.format(desknets.sp.seldate.formatDate,g)).change();k.$mRootElement.find('input[name="etime"]').val(neo.dateTime.format(desknets.sp.seldate.formatTime,g)).change()},setPage:function(c,d){var b=this;b.setEntries({});b.callBase("setPage",c);b.msTargetDate=d;b.entryDate=d;b.entryTime="0000";b.repKind="";desknets.sp.sch.OthertoSelPage.invalidate();if(desknets.sp.mobjPages["schplantselect-page"]){desknets.sp.mobjPages["schplantselect-page"].invalidate()}},getReferRequestURL:function(){return desknets.sp.sch.getRequestURL()},getReferRequestData:function(){var b=this;var c={cmd:"schcmdentryrefer",sid:b.msId,id:desknets.sp.sch.util.getTargetID(),seldate:b.msTargetDate};return c},setUpReferItemFromEntries:function(){var d=this;var g="";var h="";var e="";var b="";var c="";d.setUpReferItem_Common();var f=d.isGetReservLimitPlant();d.setUpReferItem_CommonOption(f);c="";if(d.mobjEntries.place&&d.mobjEntries.place!="--"){c=d.mobjEntries.place+" : "}if(neo.isSet(d.mobjEntries.other,{blank:false})){c=c+d.mobjEntries.other}d.$mRootElement.find('input[name="place"]').val(c);if(!!d.mobjEntries.otherto&&!!d.mobjEntries.otherto.item){d.setSelUsers(desknets.ajax.getItems(d.mobjEntries.otherto.item))}else{d.setSelUsers([{id:desknets.sp.sch.util.getTargetID(),val:desknets.sp.sch.util.getTargetName()}])}d.$mRootElement.find(".jco-entry-accdel").remove();if(!!d.mobjEntries.pids&&!!d.mobjEntries.pids.item){d.editTargetPlants(desknets.ajax.getItems(d.mobjEntries.pids.item))}},setUpReferItem_Common:function(){var e=this;var f="";var c="";var b="";e.beforeSDate=null;if(neo.isSet(e.mobjEntries.startdate,{blank:false})){f=desknets.sp.seldate.changeFormatDate(e.mobjEntries.startdate);c=desknets.sp.seldate.changeFormatDate(e.mobjEntries.enddate)}else{if(neo.isSet(e.msTargetDate,{blank:false})){f=desknets.sp.seldate.changeFormatDate(e.msTargetDate);c=f}else{f=neo.dateTime.format(desknets.sp.seldate.formatDate);c=f}}e.$mRootElement.find('input[name="sdate"]').val(f).change();e.$mRootElement.find('input[name="edate"]').val(c).change();if(neo.isSet(e.mobjEntries.starttime,{blank:false})){var d=desknets.dateTime.formatHour(desknets.sp.seldate.formatTime,e.mobjEntries.starttime);e.$mRootElement.find('input[name="stime"]').val(d).trigger("change")}else{e.$mRootElement.find('input[name="stime"]').val("")}if(neo.isSet(e.mobjEntries.endtime,{blank:false})){var d=desknets.dateTime.formatHour(desknets.sp.seldate.formatTime,e.mobjEntries.endtime);e.$mRootElement.find('input[name="etime"]').val(d).trigger("change")}else{e.$mRootElement.find('input[name="etime"]').val("")}var g=false;if(e.mobjEntries.starttime=="0000"&&e.mobjEntries.endtime=="2400"){g=true}e.$mRootElement.find('input[name="all-day"]').prop("checked",g).checkboxradio("refresh").trigger("change");b="";if(e.mobjEntries.event&&e.mobjEntries.event!="--"){b=e.mobjEntries.event+" : "}if(neo.isSet(e.mobjEntries.detail,{blank:false})){b=b+e.mobjEntries.detail}e.$mRootElement.find('input[name="event"]').val(b);b="";if(neo.isSet(e.mobjEntries.memo,{blank:false})){b=e.mobjEntries.memo}e.$mRootElement.find('textarea[name="memo"]').val(b).keyup();if(neo.isSet(e.mobjEntries.repeat,{blank:false})){e.repKind=e.mobjEntries.repeat}e.setColor(e.mobjEntries.schcolor)},setUpReferItem_CommonOption:function(d){var c=this;var b="";var e="";if(d){c.mobjEntries.reserve="1"}if(d){e=desknets.Resource.sch.internalTitle;b="1"}else{if(c.mobjEntries.outflg=="1"){e=desknets.Resource.sch.externalTitle;b="2"}else{e=desknets.Resource.sch.internalTitle;b="1"}}c.$mRootElement.find(".jsch-entry-sel-outflg").text(e);c.$mRootElement.find(".jsch-entry-sel.outflg").text(e);c.$mRootElement.find('input[name="outflg"]').val(b);if(d){sRank=desknets.Resource.sch.normalTitle;b="0"}else{if(c.mobjEntries.rankflg=="1"){sRank=desknets.Resource.sch.importantTitle;b="2"}else{sRank=desknets.Resource.sch.normalTitle;b="0"}}c.$mRootElement.find(".jsch-entry-sel-rankflg").text(sRank);c.$mRootElement.find(".jsch-entry-sel.rankflg").text(sRank);c.$mRootElement.find('input[name="rankflg"]').val(b);if(d){sReserve=desknets.Resource.sch.notFirmDateTitle;b="2"}else{if(c.mobjEntries.reserve=="1"){sReserve=desknets.Resource.sch.notFirmDateTitle;b="2"}else{sReserve=desknets.Resource.sch.firmDateTitle;b="0"}}c.$mRootElement.find(".jsch-entry-sel-reserve").text(sReserve);c.$mRootElement.find(".jsch-entry-sel.reserve").text(sReserve);c.$mRootElement.find('input[name="reserve"]').val(b);if(d){c.$mRootElement.find('select[name="public_level"]').val("0").selectmenu("refresh")}else{if(!!c.mobjEntries.public_level&&c.mobjEntries.public_level!="open"){c.$mRootElement.find('select[name="public_level"]').val(c.mobjEntries.public_level).selectmenu("refresh")}else{c.$mRootElement.find('select[name="public_level"]').val("0").selectmenu("refresh")}}if(c.$mRootElement.find('select[name="public_level"]').val()=="permission"){c.$mRootElement.find(".jsch-input-userlist").show()}else{c.$mRootElement.find(".jsch-input-userlist").hide()}if(d){}else{if(!!c.mobjEntries.permit_user&&!!c.mobjEntries.permit_user.item){c.setSelUsers(desknets.ajax.getItems(c.mobjEntries.permit_user.item),"otherto",".jsch-input-userlist")}}if(d){c.$mRootElement.find(".jsch-entry-reservschlimit-on").show();c.$mRootElement.find(".jsch-entry-reservschlimit-off").hide()}else{c.$mRootElement.find(".jsch-entry-reservschlimit-on").hide();c.$mRootElement.find(".jsch-entry-reservschlimit-off").show()}},isGetReservLimitPlant:function(){var b=this;if(!!b.mobjEntries.reservschlimit&&b.mobjEntries.reservschlimit=="1"){return true}return false},showingPage:function(){var b=this;b.callBase("showingPage");if(desknets.sp.mobjPages["schplantselect-page"]){if(desknets.sp.menu.boView("plant")){b.$mRootElement.find(".jsch-input-plantlist").show()}else{b.$mRootElement.find(".jsch-input-plantlist").hide()}}},getInitialEntries:function(){var b=this;var c=desknets.sp.sch.getDefColor();return c},getSubmitRequestURL:function(){return desknets.sp.sch.getRequestURL()},getEntriesFromReferItem:function(){var d=this;var e={};var c=[];e=a.extend({},d.getEntriesFromItem_Common());if(!e.sid){e.cmd=d.$mRootElement.find('input[name="entrycmd"]').val()}else{e.cmd=desknets.sch.CMD_SCHHOLDONENTRY}e.event="--";e.Other=d.$mRootElement.find('input[name="place"]').val();var b=d.$mRootElement.find(".jco-input-userlist").find('input[name="otherto"]');b.each(function(){c[c.length]=a(this).val()});e.otherto=c;e.pids=d.getSelPlantIDs();return e},getEntriesFromItem_Common:function(){var b=this;var c={};var g=[];if(neo.isSet(b.msId,{blank:false})){c.sid=b.msId}c.startdate=b.$mRootElement.find('input[name="sdate"]').data("rval");c.starttime=b.$mRootElement.find('input[name="stime"]').data("rval");c.enddate=b.$mRootElement.find('input[name="edate"]').data("rval");c.endtime=b.$mRootElement.find('input[name="etime"]').data("rval");c.event="--";c.detail=b.$mRootElement.find('input[name="event"]').val();c.memo=b.$mRootElement.find('textarea[name="memo"]').val();c.schcolor=b.$mRootElement.find('input[name="schcolor"]').val();var e=["outflg","rankflg","reserve"];a.each(e,function(j,h){c[h]=b.$mRootElement.find('input[name="'+h+'"]').val()});var d=b.$mRootElement.find('select[name="public_level"]').val();if(d=="0"){d=""}c.public_level=d;var f=b.$mRootElement.find(".jsch-input-userlist").find('input[name="otherto"]');f.each(function(){g[g.length]=a(this).val()});c.permit_user=g;return c},confirmToSendEntries:function(c){var b=this;if(neo.isSet(b.repKind,{blank:false})){desknets.sp.sch.SchModRep.setPage(b.msId,b.msTargetDate,b.getSubmitRequestData(),b.repKind);desknets.sp.changePage("d-"+desknets.sp.sch.util.getPageParams("moduleId")+"modrep")}else{c()}},completeToSendEntries:function(){var b=this;b.completeToSendEntriesClean();b.callBase("completeToSendEntries")},completeToSendEntriesClean:function(){var b=this;desknets.sp.mobjPages["day-page"].invalidate();desknets.sp.mobjPages["week-page"].invalidate();desknets.sp.mobjPages["month-page"].invalidate();desknets.sp.mobjPages["year-page"].invalidate();desknets.sp.mobjPages[desknets.sp.sch.util.getPageParams("moduleId")+"ref-page"].invalidate();var c=neo.dateTime.parse(b.entryDate);desknets.sp.mobjPages["day-page"].setSchDate(c);desknets.sp.mobjPages["week-page"].setSchDate(c);desknets.sp.mobjPages["month-page"].setSchDate(c);desknets.sp.mobjPages["year-page"].setSchDate(c);desknets.sp.mobjPages["day-page"].setSchDayTime(b.entryTime)},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.success=function(e,d,f){b.completeToSendEntriesClean();if(!desknets.sp.sch.execNoticeErrorDialog(e,d,f)){b.completeToSendEntries()}};return c},setColor:function(c){var b=this;desknets.sp.sch.setColor(b.$mRootElement,c)},setColorString:function(c){var b=this;desknets.sp.sch.setColorString(b.$mRootElement,c)},setSelUsers:function(c,f,e,g){var b=this;b.callBase("setSelUsers",c,f,e);if(neo.isSet(g,{blank:false})){if(b.$mRootElement.find(".jco-entry-accdel").length<=0){var d=a('<div class="jco-entry-accdel"> '+g+"</div>");d.appendTo(b.$mRootElement.find(".co-input-selected").closest("li"))}}},setSelPlants:function(b){var c=this;c.editTargetPlants(b);var d=c.isSelReservLimitPlant();c.setUpReferItem_CommonOption(d)},editTargetPlants:function(d){var e=this;var c=e.$mRootElement.find(".jsch-input-plantlist");var b=[];b=e.getSelPlantIDs();var g="";a.each(d,function(k,m){var i=desknets.tmpl.escapeWord(m.val);var j=m.id;var l="";if(neo.isSet(m.reservschlimit,{blank:false})){l=m.reservschlimit}if(a.inArray(j,b)<0){var h='<a href="#" class="jsch-entry-psel" data-reservschlimit="'+l+'">'+i+'<input type="hidden" value="'+j+'" name="pids"></a>';g=g+h}});var f;f=c.find(".co-input-selected");if(!c.is(":has('.co-input-selected')")){f=a('<div class="co-input-selected" />').insertBefore(c.find(".ui-input-text"))}f.append(a(g))},setDeselPlant:function(e){var b=this;if(neo.isSet(e)){e.remove()}var c=b.getSelPlantIDs();if(c.length<=0){b.$mRootElement.find(".jsch-input-plantlist").find(".co-input-selected").remove()}var d=b.isSelReservLimitPlant();b.setUpReferItem_CommonOption(d)},getSelPlantIDs:function(){var c=this;var b=[];var d=c.$mRootElement.find('input[name="pids"]');d.each(function(e){b[e]=a(this).val()});return b},isSelReservLimitPlant:function(){var c=this;var b=c.$mRootElement.find('.jsch-input-plantlist a[data-reservschlimit="1"]').length;if(b>0){return true}return false},getPlantSrchData:function(){var d=this;var b=[];b.startdate=d.$mRootElement.find('input[name="sdate"]').data("rval");b.starttime=d.$mRootElement.find('input[name="stime"]').data("rval");b.enddate=d.$mRootElement.find('input[name="edate"]').data("rval");b.endtime=d.$mRootElement.find('input[name="etime"]').data("rval");b.repeat=d.repKind;if(neo.isSet(d.repKind,{blank:false})){if(d.repKind==desknets.cal.REPEAT_RANDOM&&!!d.mobjEntries.dates.item){var c=desknets.ajax.getItems(d.mobjEntries.dates.item);var e=c.length;var g=[];var f;for(f=0;f<e;f++){g[f]=c[f].val}b.dates=g}else{b.rependtimes=d.mobjEntries.rependtimes;b.interval=d.mobjEntries.interval;b.everyweek=d.mobjEntries.everyweek;b.everyweekday=d.mobjEntries.everyweekday}}return b},setStringItem:function(e,b){var c=this;var d=c.$mRootElement.find('input[name="'+e+'"]');c.$mRootElement.find('input[name="'+e+'"]').val(b);d.val(b)},setEntryOptions:function(b,d,e){var c=this;c.$mRootElement.find(".jsch-entry-sel."+e).text(d);c.$mRootElement.find('input[name="'+e+'"]').val(b)}});desknets.page(desknets.sp.sch,"SchModRep",desknets.sp.EntryPage,{msTargetDate:"",msObjMod:null,msRepKind:"",setPage:function(c,e,f,d){var b=this;b.callBase("setPage",c);b.msObjMod=null;if(!a.isEmptyObject(f)){b.msObjMod=f}b.msTargetDate=e;b.msRepKind=d},replaceItems:function(){var d=this;if(d.msObjMod==null){return}var b=desknets.Resource.Message,c,g={};var f=desknets.dateTime.dispDateTime(String(d.msTargetDate));if(d.msRepKind==desknets.cal.REPEAT_RANDOM){refkind="dates"}else{refkind="recurrence"}var h=b["cal_targetdate_"+refkind]+"<br />"+b.cal_targetdate_message_mod;d.$mRootElement.find(".co-dialog-msg").html(h);for(var e=1;e<=3;e++){c=b["cal_targetdate_choice_"+e];c=desknets.tmpl.replaceWordHtml(c,"date",f);d.$mRootElement.find("#sch-modkind-"+e).closest(".ui-radio").find(".ui-btn").text(c)}d.$mRootElement.page("destroy").page();d.pageViewEnd();d.$mRootElement.find(".jco-ok").off("vclick").on("vclick",function(i){i.preventDefault();d.sendEntries()})},getSubmitRequestURL:function(){var b=desknets.sp.sch.util.getPageParams("moduleId");return desknets.sp.mobjPages[b+"entry-page"].getSubmitRequestURL()},getEntriesFromReferItem:function(){var b=this;var c=a.extend({},b.msObjMod);c.modkind=b.$mRootElement.find('input[name="modkind"]:checked').val();c.seldate=b.msTargetDate;return c},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.success=function(e,d,f){b.$mRootElement.dialog("close");b.completeToSendEntriesClean();setTimeout(function(){if(!desknets.sp.sch.execNoticeErrorDialog(e,d,f)){b.completeToSendEntries()}},100)};return c},completeToSendEntriesClean:function(){var b=this;var c=desknets.sp.sch.util.getPageParams("moduleId");desknets.sp.mobjPages[c+"entry-page"].completeToSendEntriesClean()},completeToSendEntries:function(){var b=this;var c=desknets.sp.sch.util.getPageParams("moduleId");b.$mRootElement.dialog("close");setTimeout(function(){desknets.sp.mobjPages[c+"entry-page"].completeToSendEntries()},100)}});desknets.page(desknets.sp.sch,"OthertoSelPage",desknets.sp.UserSelPage,{marea:".jco-input-userlist",mExecObj:"",show:function(){var b=this;b.$mRootElement.find(".co-header-title").hide();b.$mRootElement.find(b.marea).show();b.callBase("show")},openMultiItems:function(c){var b=this;if(b.marea==".jco-input-userlist"){b.othertoFilter(c)}else{if(c.length>0){b.mExecObj.setSelUsers(c,"otherto",".jsch-input-userlist")}history.back()}},othertoFilter:function(d){var c=this;var e={};var b=[];c.execBeforAjaxStart();if(d.length<=0){history.back()}else{e.cmd=desknets.sch.CMD_SCHFILTARGET;a.each(d,function(f,g){b[b.length]=g.id});e.id=b;e.accesskind="2";desknets.sp.ajax.rest({url:c.getSubmitRequestURL(),data:e,success:function(g,f,h){c.execAfterajaxStop();c.completeToFilter(d,g)},errorconvmsg:function(f,g){var h=desknets.getErrField(f,g);return desknets.getErrConvMsg(h)}})}},getSubmitRequestURL:function(){return desknets.sp.sch.getRequestURL()},completeToFilter:function(d,e){var c=this;var f=desknets.ajax.getJsonItems(e);var b=c._filterWithIDs(d,f);var g="";if(d.length>b.length){g=desknets.Resource.Message.com_accs_otherto_add}c.mExecObj.setSelUsers(b,"otherto",".jco-input-userlist",g);history.back()},_filterWithIDs:function(e,c){var d={},b=[];a.each(c,function(f,g){d[g.id]=true});a.each(e,function(f,g){if(!!d[g.id]){b.push(g)}});return b},});desknets.page(desknets.sp.sch,"SchSelCom",desknets.sp.RefPage,{msName:"",initPage:function(){var b=this;b.callBase("initPage");b.initPageSetUpOk()},initPageSetUpOk:function(){var b=this;b.$mRootElement.find(".jco-ok").on("vclick",function(c){c.preventDefault();var d=b.$mRootElement.find('select[name="'+b.msName+'"] option:selected').val();if(d=="--"){d=""}b.getEntryClass().setStringItem(b.msName,d);history.back()})},getReferRequestURL:function(){return desknets.sp.sch.getRequestURL()},setUpReferItem:function(f){var c=this;var b=[];var e=0;var d=null;var h="";var i=desknets.ajax.getJsonItems(f);var g=c.$mRootElement.find('select[name="'+c.msName+'"]');if(i.length>0){for(e=0;e<i.length;e++){d=i[e];h='<option value="'+desknets.tmpl.escapeWord(d.Name)+'">'+desknets.tmpl.escapeWord(d.Name)+"</option>";b[b.length]=h}g.append(a(b.join(""))).enhanceWithin();g.selectmenu("refresh")}},showing:function(){var b=this;b.$mRootElement.find(".co-area").hide();b.$mRootElement.find('div:jqmData(role="header")').hide()},pageViewEnd:function(){var b=this;b.$mRootElement.find('div:jqmData(role="header")').show();b.callBase("pageViewEnd")},getEntryClass:function(){return desknets.sp.sch.SchEntry}});desknets.page(desknets.sp.sch,"SchEvent",desknets.sp.sch.SchSelCom,{initPage:function(){var b=this;b.callBase("initPage");b.msName="event"},initPageSetUpOk:function(){var b=this;b.$mRootElement.find(".jco-ok").on("vclick",function(c){c.preventDefault();var e=b.$mRootElement.find('select[name="'+b.msName+'"] option:selected');var d=e.val();if(d=="--"){d=""}b.getEntryClass().setStringItem(b.msName,d);b.getEntryClass().setColorString(e.data("color"));history.back()})},getReferRequestData:function(){var b=this;var c={cmd:desknets.sp.sch.CMD_SCHEVENT};return c},setUpReferItem:function(d){var j=this;var c=[];var h=0;var i=null;var g="";var b=0;var e=desknets.ajax.getJsonItems(d);var f=j.$mRootElement.find('select[name="'+j.msName+'"]');f.on("change",function(n,o){var l=j.$mRootElement.find('select[name="'+j.msName+'"] option:selected');var p=l.data("color");if(!!p){var m=a("#jsch-event-button").find("span");var k=m.html();m.html('<div class="sch-edit-color '+p+'"></div>'+k)}});b=e.length;if(b>0){for(h=0;h<b;h++){i=e[h];g='<option value="'+desknets.tmpl.escapeWord(i.Name)+'" + data-color="'+desknets.tmpl.escapeWord(i.schcolorname)+'">'+desknets.tmpl.escapeWord(i.schcolorname)+":"+desknets.tmpl.escapeWord(i.Name)+"</option>";c[c.length]=g}f.append(a(c.join(""))).enhanceWithin();f.selectmenu("refresh");a("#jsch-event-menu").find("a.ui-btn").each(function(n,o){var p=a(this);var k=p.html();var m=k.indexOf(":");if(m>0){var q=k.substring(0,m);var l=k.substring(m+1,k.length);p.html('<div class="sch-edit-color '+q+'"></div> &nbsp;&nbsp;'+l)}});a("#jsch-event").find("option").each(function(n,o){var p=a(this);var k=p.html();var m=k.indexOf(":");if(m>0){var q=k.substring(0,m);var l=k.substring(m+1,k.length);p.html('<div class="sch-edit-color '+q+'"></div> &nbsp;&nbsp;'+l)}})}}});desknets.page(desknets.sp.sch,"SchPlace",desknets.sp.sch.SchSelCom,{initPage:function(){var b=this;b.callBase("initPage");b.msName="place"},getReferRequestData:function(){var b=this;var c={cmd:desknets.sp.sch.CMD_SCHPLACE};return c}});desknets.page(desknets.sp.sch,"SchOptions",desknets.sp.RefPage,{mExecObj:"",initPage:function(){var b=this;b.callBase("initPage");b.$mRootElement.find(".jco-ok").bind("vclick",function(c){c.preventDefault();b.setSchOptions(a(this).data("val"),a(this).text(),a(this).closest(".jco-page").data("target"))})},replaceItems:function(){var b=this;b.pageViewEnd()},setSchOptions:function(c,e,b){var d=this;d.mExecObj.setEntryOptions(c,e,b);history.back()}});desknets.page(desknets.sp.sch,"SchDel",desknets.sp.DelPage,{msSelDate:"",mbdelRep:false,msMsg:"",$_Tmpl:null,init:function(c){var b=this;b.callBase("init",c);b.$_Tmpl=b.$mRootElement.find(".jsch-delmsg").remove()},replaceItems:function(){var b=this;var c=b.$_Tmpl.clone();if(neo.isSet(b.msMsg,{blank:false})){c.html(b.msMsg)}b.$mRootElement.find(".co-dialog-msg").empty().append(c);b.pageViewEnd()},setPage:function(d,e,c){var b=this;b.callBase("setPage",d);b.msSelDate=e;b.mbdelRep=c},setMessage:function(b){var c=this;c.msMsg=b},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sch.CMD_RSCHDEL;c.sid=b.msId;c.seldate=b.msSelDate;c.sendhowto="";return c},getSubmitRequestURL:function(){return desknets.sp.sch.getRequestURL()},delCloseId:function(){return desknets.sp.sch.util.getPageParams("moduleId")+"ref"},setInvalidate:function(){var b=this;desknets.sp.mobjPages["day-page"].invalidate();desknets.sp.mobjPages["week-page"].invalidate();desknets.sp.mobjPages["month-page"].invalidate();desknets.sp.mobjPages["year-page"].invalidate();if(neo.isSet(desknets.sp.mobjPages["srch-page"])){desknets.sp.mobjPages["srch-page"].invalidate()}},showing:function(){var b=this;b.$mRootElement.find(".co-area").hide();b.$mRootElement.find('div:jqmData(role="header")').hide()},pageViewEnd:function(){var b=this;b.$mRootElement.find('div:jqmData(role="header")').show();b.callBase("pageViewEnd")}});desknets.page(desknets.sp.sch,"SchDelAll",desknets.sp.sch.SchDel,{mbdelRep:false,msRefKind:"",replaceItems:function(){var b=this;var c=b.$mRootElement.find('input[name="delkind"]');c.eq(0).prop("checked",true);c.checkboxradio("refresh");b.pageViewEnd()},setPage:function(d,e,c,f){var b=this;b.callBase("setPage",d,e);b.mbdelRep=c;b.msRefKind=f},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.sch.CMD_RSCHDEL;c.sid=b.msId;c.seldate=b.msSelData;c.delkind=b.$mRootElement.find('input[name="delkind"]:checked').val();c.sendhowto="";return c},getSubmitRequestURL:function(){return desknets.sp.sch.getRequestURL()},sendEntries:function(){var c=this;if(c.mbdelRep){var b=c.$mRootElement.find('input[name="delkind"]:checked').val();desknets.sp.sch.SchDelRep.setPage(c.msId,c.msSelDate,false,c.msRefKind);desknets.sp.sch.SchDelRep.setDelKind(b);var d=desknets.sp.sch.util.getPageParams("moduleId");desknets.sp.changePage("d-"+d+"repdel",{changeHash:false})}else{c.callBase("sendEntries")}}});desknets.page(desknets.sp.sch,"SchDelRep",desknets.sp.sch.SchDel,{msRepKind:"",msDelKind:"",setPage:function(d,f,c,e){var b=this;b.callBase("setPage",d,f,c);b.msRepKind=e},setDelKind:function(c){var b=this;b.msDelKind=c},replaceItems:function(){var n=this;var c=desknets.Resource.Message,d,j={};var o=c.cal_targetdate_message_del;var k=desknets.dateTime.dispDateTime(String(n.msSelDate));var f=desknets.Resource.delLabel;o=desknets.tmpl.replaceWordHtml(o,"verb",f);o=c["cal_targetdate_"+n.msRepKind]+"<br />\n"+o;n.$mRootElement.find(".jsch-conf-select").empty();n.$mRootElement.find(".co-dialog-msg").html(o);var g=a('<fieldset data-role="controlgroup">');for(var e=1;e<=3;e++){d=c["cal_targetdate_choice_"+e];d=desknets.tmpl.replaceWordHtml(d,"verb",f);d=desknets.tmpl.replaceWordHtml(d,"date",k);j[e.toString()]=d;var h="jco-dialog-answer-"+e;var b=a('<input type="radio" name="answer" />').attr("id",h).val(e).appendTo(g);var l=a("<label/>").attr("for",h).html(j[e]).appendTo(g)}n.$mRootElement.find(":jqmData(role='controlgroup')").controlgroup();n.$mRootElement.find(".jsch-conf-select").append(g);g.find("input").eq(2).prop("checked",true);g.find("input").checkboxradio().checkboxradio("refresh");n.$mRootElement.page("destroy").page();n.pageViewEnd();n.$mRootElement.find(".jco-ok").off("vclick").on("vclick",function(i){i.preventDefault();n.sendEntries()})},getEntriesFromReferItem:function(){var b=this;var d="";var c={};c.cmd=desknets.sch.CMD_RSCHDEL;c.sid=b.msId;c.seldate=b.msSelDate;c.modkind=b.$mRootElement.find('input[name="answer"]:checked').val();if(neo.isSet(b.msDelKind,{blank:false})){c.delkind=b.msDelKind}c.sendhowto="";return c}});desknets.page(desknets.sp.sch,"SchTag",desknets.sp.TagPage,{msTargetDate:"",setPage:function(d,c,e){var b=this;b.callBase("setPage",d,c);b.msTargetDate=e},getEntriesFromReferItem:function(){var b=this;var d=b.$mRootElement.find('select[name="tagcolor"]');var c={};c.cmd=desknets.sch.CMD_RSCHMODTAG;c.sid=b.msId;c.tagcolor=d[0].selectedIndex;c.seldate=b.msTargetDate;return c},getSubmitRequestURL:function(){return desknets.sp.sch.getRequestURL()},setInvalidate:function(){var b=this;desknets.sp.mobjPages["day-page"].invalidate();desknets.sp.mobjPages["week-page"].invalidate();desknets.sp.mobjPages["month-page"].invalidate();desknets.sp.mobjPages["year-page"].invalidate()},completeTag:function(c){var b=this;desknets.sp.sch.SchRef.msTag=c}});desknets.page(desknets.sp.sch,"SchApprove",desknets.sp.DelPage,{apprProc:"admit",setPage:function(d,c){var b=this;b.apprProc=c;b.callBase("setPage",d,false)},showing:function(){var b=this;b.$mRootElement.find(".jsch-approve-msg").html(desknets.Resource.Message["sch_confirm_"+b.apprProc]);b.callBase("showing")},getEntriesFromReferItem:function(){var b=this;var c={};c.sid=b.msId;c.cmd=b._getSchRefApprovCmd();c.proc=b.apprProc;return c},completeToSendEntries:function(){var b=this;b.setInvalidate();b.$mRootElement.dialog("close")},getSendRequestOption:function(){var b=this;var c=b.callBase("getSendRequestOption");c.success=function(e,d,f){b.setInvalidate();if(!desknets.sp.sch.execNoticeErrorDialog(e,d,f)){b.completeToSendEntries()}};return c},setInvalidate:function(){var b=this;desknets.sp.mobjPages["day-page"].invalidate();desknets.sp.mobjPages["week-page"].invalidate();desknets.sp.mobjPages["month-page"].invalidate();desknets.sp.mobjPages["year-page"].invalidate()},_getSchRefApprovCmd:function(){return desknets.sch.CMD_RSCHMODAPPROV},delCloseId:function(){return desknets.sp.sch.util.getPageParams("moduleId")+"ref"},getSubmitRequestURL:function(){return desknets.sp.sch.getRequestURL()}});desknets.page(desknets.sp.sch,"SchColor",desknets.sp.ComPage,{init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".sch-color-select-btn").bind("vclick",function(d){d.preventDefault();desknets.sp.sch.SchEntry.setColor(a(this).data("colorval"));history.back()})}});desknets.page(desknets.sp.sch,"SchPlantSelect",desknets.sp.ListSetPage,{msPlantGroupID:"",moPlantSrch:[],setPage:function(b){var c=this;c.moPlantSrch=b},init:function(c){var b=this;b.mboChk=true;b.mboSet=true;b.callBase("init",c);b.$mRootElement.find('select[name="sch-plantgrp"]').on("change",function(d){d.preventDefault();var e=a(d.target);b.msPlantGroupID=e.val()});b.$mRootElement.find(".sch-plant-search").on("vclick",function(d){d.preventDefault();b.reload()});b.$mRootElement.find(".jsch-plant-ok").on("vclick",function(f){f.preventDefault();var d=[];var e=b.$listElement.find("input[type=checkbox]:checked");e.each(function(h){var g={};g.id=a(this).closest("li").data("id");g.val=a(this).closest("li").find("h3").text();g.reservschlimit=desknets.getDataAttr(a(this).closest("li").find("h3"),"reservschlimit");d[h]=g});b.openMultiItems(d)})},replaceItems:function(){var b=this;b.getPlantGroups()},callSchReplaceItems:function(){var b=this;b.callBase("replaceItems")},getPlantGroups:function(){var b=this;var c={url:b.getListRequestURL(),data:{cmd:desknets.sch.CMD_PLANTSELPGROUP,access:desknets.sch.ACCESS_OPEN},error:function(f,e,d){desknets.sp.ajax.onError(f.status,d,true)},success:function(e,d,f){b.editPlantGroups(e)},dialogback:true};desknets.sp.ajax.rest(c)},editPlantGroups:function(h){var l=this;var g;var f="0";if(!neo.isSet(l.msPlantGroupID,{blank:false})){g=a("#jsch-plantgrp").val()}else{g=l.msPlantGroupID}var i='<option value="0">('+desknets.Resource.sch.allSelectablesLabel+")</option>";var d=desknets.sp.ajax.getJsonItems(h);var c=d.length;for(var j=0;j<c;j++){var k=d[j];var b=k.id;i=i+'<option value="'+b+'">'+desknets.tmpl.escapeWord(k.Name)+"</option>";if(b==g){f=g}}l.msPlantGroupID=f;var e=l.$mRootElement.find('select[name="sch-plantgrp"]');e.html(i);e.val(l.msPlantGroupID).selectmenu("refresh");l.callSchReplaceItems()},showing:function(){var b=this;b.callBase("showing");if(!!b.mbItemRetrieved){b.$listElement.find("input[type=checkbox]:checked").each(function(d){a(this).prop("checked",false).checkboxradio("refresh")})}var c=b._getDateMessage();b.$mRootElement.find(".co-subtitle").html(c)},_getDateMessage:function(){var b=this;var d="";var c=desknets.cal.tmplRef.dispTimeLong(b.moPlantSrch.starttime);var e=desknets.cal.tmplRef.dispTimeLong(b.moPlantSrch.endtime);if(neo.isSet(b.moPlantSrch.repeat,{blank:false})){if(b.moPlantSrch.repeat==desknets.cal.REPEAT_RANDOM){d=desknets.Resource.sch.selPantsSubTitle}else{d=desknets.sch.util.dateTime.getRecurrenceMessage(b.moPlantSrch)}if(c!="&nbsp;"){d+=" "+c}if(e!="&nbsp;"){d+=" - "+e}}else{d=desknets.dateTime.formatDate("m",b.moPlantSrch.startdate);if(c!="&nbsp;"){d+=" "+c}d+=" - "+desknets.dateTime.formatDate("m",b.moPlantSrch.enddate);if(e!="&nbsp;"){d+=" "+e}}return d},openMultiItems:function(c){var b=this;if(c.length>0){desknets.sp.mobjPages["schentry-page"].setSelPlants(c)}history.back()},getListRequestURL:function(){return desknets.sp.sch.getRequestURL()},getListRequestData:function(d,e){var b=this;var c={};c={cmd:desknets.sp.sch.CMD_PLANTENTRYFREELIST,gid:b.msPlantGroupID,startdate:b.moPlantSrch.startdate,starttime:b.moPlantSrch.starttime,enddate:b.moPlantSrch.enddate,endtime:b.moPlantSrch.endtime,repeat:b.moPlantSrch.repeat,row:d,num:e};if(neo.isSet(b.moPlantSrch.repeat,{blank:false})){if(b.moPlantSrch.repeat==desknets.cal.REPEAT_RANDOM){c.dates=b.moPlantSrch.dates}else{c.rependtimes=b.moPlantSrch.rependtimes;c.interval=b.moPlantSrch.interval;c.everyweek=b.moPlantSrch.everyweek;c.everyweekday=b.moPlantSrch.everyweekday}}return c},invalidate:function(){var b=this;b.callBase("invalidate");b.mboSet=true;b.msPlantGroupID=""},updateContainerElement:function(c){var b=this;b.miStartIndex=0;b.callBase("updateContainerElement",c)},removeListElements:function(c){var b=this},setUpListItem:function(d,c){var b=this;b.callBase("setUpListItem",d,c);c.find("h3").append(desknets.tmpl.escapeWord(d.Name));desknets.setDataAttr(c.find("h3"),"reservschlimit",d.reservschlimit);c.find("input[type=checkbox]").attr("id","jco-chk-plantlist-"+d.id);c.find("label").attr("for","jco-chk-plantlist-"+d.id)},});desknets.page(desknets.sp.sch,"SchPlantDeselect",desknets.sp.ComPage,{mPlantObj:null,setPage:function(c){var b=this;b.mPlantObj=c},init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".jco-ok").on("vclick",function(d){d.preventDefault();desknets.sp.mobjPages["schentry-page"].setDeselPlant(b.mPlantObj);b.$mRootElement.dialog("close")})},});desknets.page(desknets.sp.sch,"UserSelPage",desknets.sp.UserSelPage,{openListItem:function(d,f){var c=this;var b;var g=desknets.sp.sch.util.getPageParams("moduleId");if(!c.boSingle){return}var e=neo.storage.local(desknets.sp.COOKIENAME_SETTING);if(!!e&&!!e[g+"Toppage"]){b=e[g+"Toppage"].substring(desknets.sp.sch.util.getPageParams("moduleLen"))}else{b="month"}var h=desknets.sp.mobjPages[b+"-page"];var i=d.find("h3").text();desknets.sp.sch.util.setTargetId(f);desknets.sp.sch.util.setTargetName(i);h.setSchDate(desknets.dateTime.current);desknets.sp.mobjPages["day-page"].invalidate();desknets.sp.mobjPages["week-page"].invalidate();desknets.sp.mobjPages["month-page"].invalidate();desknets.sp.mobjPages["year-page"].invalidate();desknets.sp.changePage(b)}});desknets.page(desknets.sp.sch,"SrchListPage",desknets.sp.SearchPage,{mobjVals:{},_sMode:"append",initPage:function(){var b=this;b.callBase("initPage");b.$mRootElement.find(".jsch-setsrch").bind("vclick",function(c){c.preventDefault();b._handleListClickSrch()})},showFirstPage:function(){var b=this;b.callBase("showFirstPage");b.setSrchView()},replaceItems:function(){var b=this;b.callBase("replaceItems");b.setSrchView()},setSrchView:function(){var d=this;var f=["rankflg","reserve","flag","visitflg"];var h=["outflg_in","outflg_out"];var c="";var g="";d.$mRootElement.find('input[name="srch_key"]').val(d.mobjSrch.srch_key).searchkeychg();a.each(f,function(j,k){if(neo.isSet(d.mobjSrch[k],{blank:false})){if(c!=""){c=c+","}c=c+d.mobjVals[k]}});a.each(h,function(k,j){if(neo.isSet(d.mobjSrch[j],{blank:false})){if(g!=""){g=g+","}g=g+d.mobjVals[j]}});if(c==""){d.$mRootElement.find(".jsch-srch-icon").hide()}else{d.$mRootElement.find(".jsch-srch-icon").children("span").eq(1).html(c);d.$mRootElement.find(".jsch-srch-icon").show()}if(g==""){d.$mRootElement.find(".jsch-srch-where").hide()}else{d.$mRootElement.find(".jsch-srch-where").children("span").eq(1).html(g);d.$mRootElement.find(".jsch-srch-where").show()}var e=d.mobjVals.sterm;var b="";if(d.mobjSrch.sfuture!=""){b="/"+d.mobjVals.sfuture}if(neo.isSet(e,{blank:false})){d.$mRootElement.find(".jsch-srch-range").html(b+" "+e)}},getListRequestURL:function(){return desknets.sp.sch.getRequestURL()},getAjaxId:function(){return"dnsp-schsrch"},getListRequestData:function(d,e){var b=this;var c=0;var f="";if(b.mobjSrch.outflg_in){c=1}if(b.mobjSrch.outflg_out){c+=2}if(c!=0){f=c.toString()}return{cmd:desknets.sch.CMD_SCHSEARCH,key:b.mobjSrch.srch_key,outflg:f,rankflg:b.mobjSrch.rankflg,reserve:b.mobjSrch.reserve,flag:b.mobjSrch.flag,visitflg:b.mobjSrch.visitflg,sterm:b.mobjSrch.sterm,sfuture:b.mobjSrch.sfuture,row:d,num:e}},addItems:function(c){var b=this;b._sMode=c;b.callBase("addItems",c)},getRequestOption:function(){var b=this;var c=b.callBase("getRequestOption");c.success=function(e,d,f){var g=!!e.slist?desknets.cal.tmplList.getJsonItems(e):[];b.executeOnItemsGot(e,g,b._sMode);b.pageViewEnd()};return c},setUpListItem:function(f,d){var c=this;var b=d.html();var e={intervalSepa:" ",dateTimeDisp:true,addSameDate:true};d.data("id",desknets.cal.tmplList.getId(f.sid));d.data("date",desknets.cal.tmplList.getSelDate(f.sid));d.html(desknets.cal.tmplList.getRowHtml(b,f,e))},openListItem:function(b,c){var d=b.data("date");desknets.sp.sch.SchRef.setPage(c,d);desknets.sp.changePage("schref")},_handleListClickSrch:function(){var b=this;desknets.sp.sch.SetSrch.setPage(b.mobjSrch);desknets.sp.changePage("srchset")},getDefSrch:function(c){var b=this;b.callBase("getDefSrch",c);b.mobjSrch={key:"",outflg_in:"",outflg_out:"",rankflg:"",reserve:"",flag:"",visitflg:"",sterm:"3",sfuture:""}},setSchSrchVal:function(b){var c=this;c.mobjVals=b}});desknets.page(desknets.sp.sch,"SetSrch",desknets.sp.RefPage,{mobjSrch:{},chkArr:["outflg_in","outflg_out","rankflg","reserve","flag","visitflg","sfuture"],initPage:function(){var b=this;b.$mRootElement.find(".jsch-srch").bind("vclick",function(d){var c={};d.preventDefault();b.mobjSrch.srch_key=b.$mRootElement.find('input[name="srch_key"]').val();a.each(b.chkArr,function(f,g){var e=b.$mRootElement.find('input[name="'+g+'"]');if(e.prop("checked")){b.mobjSrch[g]=e.val();c[g]=e.parent().find(".ui-btn").text()}else{b.mobjSrch[g]="";c[g]=""}});b.mobjSrch.sterm=b.$mRootElement.find('select[name="sterm"]').val();c.sterm=b.$mRootElement.find('select[name="sterm"]').children("option").filter(function(){return a(this).attr("value")==b.mobjSrch.sterm}).text();desknets.sp.sch.SrchListPage.setSrch(b.mobjSrch);desknets.sp.sch.SrchListPage.setSchSrchVal(c);history.back()});b.$mRootElement.find(".jsch-srch-clear").bind("vclick",function(c){c.preventDefault();a.each(b.chkArr,function(e,f){var d=b.$mRootElement.find('input[name="'+f+'"]');d.prop("checked",false).checkboxradio("refresh")});b.$mRootElement.find('input[name="srch_key"]').val("").searchkeychg();b.$mRootElement.find('select[name="sterm"]').val("3").selectmenu("refresh")})},showingPage:function(){var b=this},setPage:function(b){var c=this;c.callBase("setPage","");c.mobjSrch=b},replaceItems:function(){var b=this;b.setUpReferItem();b.pageViewEnd()},setUpReferItem:function(){var b=this;a.each(b.chkArr,function(d,e){var c=b.$mRootElement.find('input[name="'+e+'"]');if(b.mobjSrch[e]!=""){c.prop("checked",true)}else{c.prop("checked",false)}c.checkboxradio("refresh")});b.$mRootElement.find('input[name="srch_key"]').val(b.mobjSrch.srch_key).searchkeychg();b.$mRootElement.find('select[name="sterm"]').val(b.mobjSrch.sterm).selectmenu("refresh");b.mobjVals={}}});desknets.sp.sch.init()})(jQuery);