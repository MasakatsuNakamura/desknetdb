/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.sp.ntwi={init:function(){desknets.sp.mobjPages["neomsg-page"]=desknets.sp.ntwi.NeoMsg;desknets.sp.mobjPages["d-neomsgdel-page"]=desknets.sp.ntwi.NeoMsgDel;desknets.sp.mobjPages["ntwi-page"]=desknets.sp.ntwi.Ntwi;desknets.sp.mobjPages["ntwientry-page"]=desknets.sp.ntwi.NtwiEntry;desknets.sp.mobjPages["ntwisrch-page"]=desknets.sp.ntwi.NtwiSrch;desknets.sp.mobjPages["d-ntwidel-page"]=desknets.sp.ntwi.NtwiDel;desknets.sp.mobjPages["direct-page"]=desknets.sp.ntwi.Direct;desknets.sp.mobjPages["directlist-page"]=desknets.sp.ntwi.DirectList;desknets.sp.mobjPages["directentry-page"]=desknets.sp.ntwi.DirectEntry;desknets.sp.mobjPages["usersel-page"]=desknets.sp.ntwi.DirectUser;desknets.sp.mobjPages["d-directdel-page"]=desknets.sp.ntwi.DirectDel;desknets.sp.mobjPages["neotwi-page"]=desknets.sp.Neotwi;if(desknets.sp.Neotwi.boNtwi==false){a(".ntwi-nav-home").closest("li").hide()}if(desknets.sp.Neotwi.boDirect==false){a(".ntwi-nav-mail").closest("li").hide()}desknets.sp.initSetEvents(["neomsg-page","ntwi-page","direct-page","directlist-page","ntwientry-page","directentry-page"])},getRequestURL:function(){return desknets.sp.getUrl(desknets.ntwi.MODULE_API_MAIN)},};desknets.page(desknets.sp.ntwi,"NeoMsg",desknets.sp.ListPage,{$_TmplInfo:null,init:function(c){var b=this;b.callBase("init",c);b.$_TmplInfo=b.$listElement.children(".jntwi-list-tmpl-info").removeClass("jntwi-list-tmpl-info").remove();b.$mRootElement.find(".ntwi-nav-home").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("ntwi",{transition:"fade"})});b.$mRootElement.find(".ntwi-nav-mail").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("direct",{transition:"fade"})});b.$mRootElement.find(".co-nav-search").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("ntwisrch")});b.$mRootElement.find(".ntwi-listview").delegate(".jneomsg-del","vclick",function(d){d.preventDefault();desknets.sp.ntwi.NeoMsgDel.setPage(a(this).closest("li").data("id"));desknets.sp.changePage("d-neomsgdel")})},showing:function(){var b=this;b.callBase("showing");b.$mRootElement.find(":jqmData(role=header)").find(".ui-btn-active").removeClass("ui-btn-active");b.$mRootElement.find(":jqmData(role=header)").find(".ntwi-nav-msg").addClass("ui-btn-active")},getListRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},getListRequestData:function(c,d){var b=this;return{cmd:desknets.sp.CMD_NTWIMOBILENOTICE}},getAjaxId:function(){return"dnsp-neomsg"},_attachListPageEvent:function(){var b=this;b.$listElement.bind("vclick",function(f){var c=a(f.target);var d=c.closest("li");var e=d.data("mid");if(e!="-1"&&!c.hasClass("ui-icon")){f.preventDefault();b._handleListClicked(c)}})},executeOnItemsGot:function(e,f,c){var b=this;var d=b.addListElements(f,c);if(d>0){b.$listElement.show();b.$noItemsContainerElement.hide()}else{b.$listElement.hide();b.$noItemsContainerElement.show()}b.updateListEnd(e)},addListElements:function(e,i){var k=this;var g=(i=="prepend")?k.$listElement.children(":first-child"):k.$listElement;var f=(i=="prepend")?"insertBefore":"appendTo";var c=e.length;var b=0;for(var h=0;h<c;h++){var j=null;j=e[h];if(desknets.sp.Neotwi.chkNeoInfoViewSp(j)){var d=null;if(j.mid=="-1"){d=k.$_TmplInfo.clone()}else{d=k.addListElementsTmpl()}d[f](g);k.setUpListItem(j,d)}else{b++}}c=c-b;return c},setUpListItem:function(f,c){var b=this;b.callBase("setUpListItem",f,c);if(f.mid=="safety"){c.data("id",f.cretime)}c.addClass("ntwi-neomsg-row-"+f.mid);c.data("mid",f.mid);var e="neo-menu_icon_s.png";var h="";if(f.mid=="todo"||f.mid=="mail"||f.mid=="memo"||f.mid=="flow"||f.mid=="safety"||f.mid=="info"){e=f.mid+"-menu_icon_s.png"}else{if(f.mid=="creport"){e="circle-menu_icon_s.png"}}c.find("img").attr("src",desknets.sp.msImgPath+"topmenu/menu_s/"+e);c.find("h3").html(desknets.tmpl.escapeWord(f.title));var g=desknets.sp.Neotwi.getDnMsgBody(f);if(f.mid!="-1"){g=desknets.tmpl.escapeWordLF(g)}c.find(".ntwi-detail").html(g);h="";if(Number(f.count)>1){h="("+desknets.Resource.ntwi.andNItemsLabel+")";h=desknets.tmpl.replaceWordHtml(h,"count",f.count-1);c.find(".morecnt").text(h)}var d="";if(f.mid=="safety"){d=c.find(".date").html()}c.find(".date").html(desknets.dateTime.dispDateTime(f.cretime,{type:"list"})+d)},openListItem:function(c,d){var b=this;var e=c.data("mid");if(e=="-1"){}else{if(e=="todo"||e=="mail"||e=="memo"||e=="flow"||e=="creport"||e=="safety"||e=="info"){desknets.sp.changePageOther(e)}}},});desknets.page(desknets.sp.ntwi,"NeoMsgDel",desknets.sp.EntryPage,{replaceItems:function(){var b=this;b.pageViewEnd()},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.ntwi.CMD_SAFETYNEWS_DEL;c.cretime=b.msId;return c},getSubmitRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},completeToSendEntries:function(){var b=this;desknets.sp.ntwi.NeoMsg.invalidate();b.$mRootElement.dialog("close")}});desknets.page(desknets.sp.ntwi,"Ntwi",desknets.sp.ListPage,{boFirstGet:false,init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".ntwi-nav-msg").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("neomsg",{transition:"fade"})});b.$mRootElement.find(".ntwi-nav-mail").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("direct",{transition:"fade"})});b.$mRootElement.find(".co-nav-search").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("ntwisrch")});b.$mRootElement.find(".ntwi-btn-post").bind("vclick",function(d){d.preventDefault();desknets.sp.ntwi.NtwiEntry.setReply({});desknets.sp.changePage("ntwientry")});b.$mRootElement.find(".ntwi-listview").delegate(".jntwi-reply","vclick",function(e){e.preventDefault();var d={};var f=a(this).closest("li");d.id=f.data("id");d.name=f.find("h3").text();desknets.sp.ntwi.NtwiEntry.setReply(d);desknets.sp.changePage("ntwientry")});b.$mRootElement.find(".ntwi-listview").delegate(".jntwi-del","vclick",function(d){d.preventDefault();desknets.sp.ntwi.NtwiDel.setPage(a(this).closest("li").data("id"));desknets.sp.changePage("d-ntwidel")});b.$mRootElement.find(".ntwi-listview").delegate(".jntwi-viewreply","vclick",function(d){d.preventDefault();b.getReply(a(this))})},showing:function(){var b=this;b.callBase("showing");b.$mRootElement.find(":jqmData(role=header)").find(".ui-btn-active").removeClass("ui-btn-active");b.$mRootElement.find(":jqmData(role=header)").find(".ntwi-nav-home").addClass("ui-btn-active")},getListRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},getListRequestData:function(h,i){var c=this;var e={};var b={cmd:desknets.ntwi.CMD_TALK_LIST,row:h,num:i};if(h==0){c.boFirstGet=true;var g={};var f=0;e[f]=b;f++;var d={cmd:desknets.ntwi.CMD_NOTIFY,kind:"1"};e[f]=d;f++;g=desknets.ajax.arrayToMultiCmdData(e);return g}c.boFirstGet=false;return b},getAjaxId:function(){return"dnsp-ntwi"},getItemCount:function(){var b=this;return b.$listElement.children().not(".sub").length},getAjaxSuccessList:function(e,b,d){var c=this;if(c.boFirstGet){desknets.sp.Neotwi.clearNtwiCnt();return desknets.sp.ajax.getJsonItems(e[0])}return c.callBase("getAjaxSuccessList",e,b,d)},updateContainerElement:function(c){var b=this;if(b.boFirstGet){b.callBase("updateContainerElement",c[0])}else{b.callBase("updateContainerElement",c)}},setUpListItem:function(f,c){var b=this;b.callBase("setUpListItem",f,c);c.find("h3").html(desknets.tmpl.escapeWord(f.uname));c.find(".detail").html(desknets.tmpl.escapeWordLF(f.detail));c.find(".detail").each(function(){a(this).detectHref(desknets.sp.Neotwi.optHref)});var e={cmd:"ntwidispattach",id:f.id};c.find(".detail").append(desknets.sp.attachDisp.disp(f.attach,desknets.sp.MODULE_MAIN,e));c.find(".date").html(desknets.dateTime.dispDateTime(f.cretime,{type:"list"}));if(neo.isSet(f.uimgurl)){var d=desknets.sp.changePath(f.uimgurl);c.find("img").attr("src",d)}else{c.find("img").remove()}if(f.uid!=desknets.sp.getLoginUid()){c.find(".jntwi-del").remove()}if(!neo.isSet(f.replyid)){c.find(".jntwi-viewreply").remove()}else{c.find(".jntwi-viewreply").data("id",f.replyid)}},getReply:function(e){var c=this;var g=e.not(".ui-icon-trash").toggleClass("ui-icon-carat-d ui-icon-carat-u").hasClass("ui-icon-carat-u");var h=e.closest("li");var b=null;if(g){b=h.next();if(b.length!=0&&b.hasClass("sub")){b.show()}else{var d={cmd:desknets.ntwi.CMD_TALK_REF,id:e.data("id")};var f={url:c.getListRequestURL(),data:d,success:function(k,i,l){var j=c.addListElementsTmpl();j.insertAfter(h);j.addClass("sub").show();j.find("img").attr({"max-width":"24","max-height":"24"});j.find(".jntwi-reply").remove();c.setUpListItem(k,j)}};desknets.sp.ajax.rest(f)}}else{b=h;while(1){b=b.next();if(b.length==0||!b.hasClass("sub")){break}b.find(".ui-icon").not(".ui-icon-trash").addClass("ui-icon-carat-d").removeClass("ui-icon-carat-u");b.hide()}}},_attachListPageEvent:function(){var b=this;b.$listElement.on("vclick",".jco-list-more-top",function(){b.addItems("prepend")});b.$listElement.on("vclick",".jco-list-more-bottom",function(){b.addItems("append")})},});desknets.page(desknets.sp.ntwi,"NtwiEntry",desknets.sp.EntryPage,{boDefSet:true,mobjReply:{},init:function(c){var b=this;b.callBase("init",c);if(typeof a.fn.charCount==="function"){b.$mRootElement.find(".ntwi-textarea._count").charCount({css:"ntwi-counter"})}},showing:function(){var b=this;b.callBase("showing");if(b.boDefSet){b.boDefSet=false;if(neo.isSet(b.mobjReply.id)){b.$mRootElement.find(".ntwi-subtitle").show();b.$mRootElement.find(".jntwi-user").html(desknets.tmpl.escapeWord(b.mobjReply.name))}else{b.$mRootElement.find(".ntwi-subtitle").hide()}b.$mRootElement.find(".ntwi-textarea").val("");b.$mRootElement.find(".ntwi-counter").text("140")}},setReply:function(c){var b=this;b.mobjReply=c;b.boDefSet=true},setUpReferItemFromEntries:function(){var b=this;b.$mRootElement.find("textarea").html("")},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.ntwi.CMD_TALK_ADD;c.detail=b.$mRootElement.find("textarea").val();if(neo.isSet(b.mobjReply.id)){c.replyid=b.mobjReply.id}return c},getSubmitRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},completeToSendEntries:function(){var b=this;desknets.sp.ntwi.Ntwi.invalidate();desknets.sp.changePage("ntwi",{reverse:true})},});desknets.page(desknets.sp.ntwi,"NtwiSrch",desknets.sp.SearchPage,{mobjSrch:{},showFirstPage:function(){var b=this;b.callBase("showFirstPage");b.setSrchView()},replaceItems:function(){var b=this;b.callBase("replaceItems");b.setSrchView()},setSrchView:function(){var b=this;b.$mRootElement.find('input[name="srch_key"]').val(b.mobjSrch.srch_key).searchkeychg()},getListRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},getAjaxId:function(){return"dnsp-ntwisrch"},getListRequestData:function(c,d){var b=this;return{cmd:desknets.ntwi.CMD_TALK_LIST,srch_key:b.mobjSrch.srch_key,srch_target:"entry",row:c,num:d,}},setUpListItem:function(f,c){var b=this;this.callBase("setUpListItem",f,c);c.find("h3").html(desknets.tmpl.escapeWord(f.uname));c.find(".detail").html(desknets.tmpl.escapeWord(f.detail));c.find(".detail").each(function(){a(this).detectHref(desknets.sp.Neotwi.optHref)});var e={cmd:"ntwidispattach",id:f.id};c.find(".detail").append(desknets.sp.attachDisp.disp(f.attach,desknets.sp.MODULE_MAIN,e));c.find(".date").html(desknets.dateTime.dispDateTime(f.cretime,{type:"list"}));if(neo.isSet(f.uimgurl)){var d=desknets.sp.changePath(f.uimgurl);c.find("img").attr("src",d)}else{c.find("img").remove()}},getDefSrch:function(c){var b=this;b.callBase("getDefSrch",c);b.mobjSrch={srch_key:"",}},_attachListPageEvent:function(){var b=this;b.$listElement.on("vclick",".jco-list-more-top",function(){b.addItems("prepend")});b.$listElement.on("vclick",".jco-list-more-bottom",function(){b.addItems("append")})},});desknets.page(desknets.sp.ntwi,"NtwiDel",desknets.sp.EntryPage,{setPage:function(d,b){var c=this;c.callBase("setPage",d)},replaceItems:function(){var b=this;b.pageViewEnd()},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.ntwi.CMD_TALK_DEL;c.id=b.msId;return c},getSubmitRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},completeToSendEntries:function(){var b=this;desknets.sp.ntwi.Ntwi.invalidate();b.$mRootElement.dialog("close")}});desknets.page(desknets.sp.ntwi,"Direct",desknets.sp.ListPage,{boFirstGet:false,init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".ntwi-nav-msg").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("neomsg",{transition:"fade"})});b.$mRootElement.find(".ntwi-nav-home").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("ntwi",{transition:"fade"})});b.$mRootElement.find(".ntwi-btn-post").bind("vclick",function(d){d.preventDefault();desknets.sp.ntwi.DirectEntry.setReply({});desknets.sp.changePage("directentry")})},showing:function(){var b=this;b.callBase("showing");b.$mRootElement.find(":jqmData(role=header)").find(".ui-btn-active").removeClass("ui-btn-active");b.$mRootElement.find(":jqmData(role=header)").find(".ntwi-nav-mail").addClass("ui-btn-active")},getListRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},getListRequestData:function(h,i){var d=this;var e={};var b={cmd:desknets.ntwi.CMD_MESSAGE_USER_LIST,row:h,num:i};if(h==0){d.boFirstGet=true;var g={};var f=0;e[f]=b;f++;if(!desknets.ntwi.pictogram.isSet()){var c={cmd:desknets.ntwi.CMD_PICTOGRAM_LIST};e[f]=c;f++}g=desknets.ajax.arrayToMultiCmdData(e);return g}d.boFirstGet=false;return b},getAjaxId:function(){return"dnsp-direct"},getItemCount:function(){var b=this;return b.$listElement.children().not(".sub").length},getAjaxSuccessList:function(e,b,d){var c=this;if(c.boFirstGet){if(!desknets.ntwi.pictogram.isSet()){desknets.ntwi.pictogram.setValuesFromJson(e["1"])}return desknets.sp.ajax.getJsonItems(e[0])}return c.callBase("getAjaxSuccessList",e,b,d)},updateContainerElement:function(c){var b=this;if(b.boFirstGet){b.callBase("updateContainerElement",c[0])}else{b.callBase("updateContainerElement",c)}},setUpListItem:function(g,c){var b=this;c.data("id",g.uid);c.find("h3").html("<span>"+desknets.tmpl.escapeWord(g.uname)+"</span>");if(!!g.deluflg){c.data("deluflg",g.deluflg)}c.data("suspension",g.user_state);c.find(".date").html(desknets.dateTime.dispDateTime(g.cretime,{type:"list"}));if(neo.isSet(g.uimgurl)){var e=desknets.sp.changePath(g.uimgurl);c.find("img").attr("src",e)}else{c.find("img").remove()}if(!!g.sname){if(!!g.referurl&&g.referurl!=""){c.find(".detail").html('<div class="ntwi-list-img-size"><img border="0" src="'+g.referurl+'"></div>')}else{c.find(".detail").html("("+g.sname+")")}}else{if(!!g.detail){c.find(".detail").html(desknets.ntwi.pictogram.encodeForDisplay(g.detail))}else{var d="";var f={cmd:"ntwidmsgdispattach",id:g.id};if(!!g.attach.item.thumbnail){var h=desknets.getUrl(desknets.sp.MODULE_MAIN)+"?"+desknets.getNeoParam(f)+"&fno=1&thumbnail=1&filename="+encodeURIComponent(g.attach.item.attachdisp).replace(/'/g,"%27");if(desknets.sp.isAttachDownload(h)){d='<div class="ntwi-list-img-size"><img src="'+h+'"></div>'}else{d=desknets.sp.attachDisp.disp(g.attach,desknets.sp.MODULE_MAIN,f)}}else{d=desknets.sp.attachDisp.disp(g.attach,desknets.sp.MODULE_MAIN,f)}c.find(".detail").html(d)}}if(g.read=="0"){c.addClass("unread")}},openListItem:function(c,d){var b=this;desknets.sp.ntwi.DirectList.setPage(d,c.find("h3").find("span").text(),c.find(".userprof").attr("src"),desknets.sp.Neotwi.IsReplyUser(c));c.removeClass("unread");desknets.sp.changePage("directlist")},});desknets.page(desknets.sp.ntwi,"DirectEntry",desknets.sp.EntryPage,{boDefSet:true,mobjData:{},miinput:500,mboGetStamp:false,$mStampTmpl:null,$mStampCateTmpl:null,mboGetEmoji:false,$mEmojiTmpl:null,mobjSetEntry:{},boStampNot:false,init:function(h){var c=this;c.callBase("init",h);if(typeof a.fn.charCount==="function"){c.$mRootElement.find(".ntwi-textarea._count").charCount({css:"ntwi-counter",allowed:c.miinput})}c.$mRootElement.find(".co-input-plus").bind("vclick",function(j){j.preventDefault();desknets.sp.changePage("usersel")});c.$mRootElement.find(".jntwi-msg-ok").bind("vclick",function(j){j.preventDefault();c.mobjSetEntry={set:""};c.sendEntries()});if(!desknets.sp.menu.boView("ntwistamp")){c.$mRootElement.find(".ntwi-footer-direct-sel").hide()}c.$mStampTmpl=c.$mRootElement.find(".ntwi-footer-ic-list.stamp").find("a").remove();c.$mStampCateTmpl=c.$mRootElement.find(".ntwi-footer-category-list").find("a").remove();c.$mEmojiTmpl=c.$mRootElement.find(".ntwi-footer-ic-list.emoji").find("a").remove();c.$mRootElement.find(".jntwi-direct-stamp").bind("vclick",function(j){j.preventDefault();c.$mRootElement.find(".ntwi-footer-menu.emoji").hide();if(!c.boStampNot){c.$mRootElement.find(".ntwi-footer-menu.stamp").toggle();if(c.mboGetStamp===false){c.getStampInit();c.mboGetStamp=true}}});c.$mRootElement.find(".ntwi-footer-category-list").on("vclick","a",function(j){j.preventDefault();var k=a(this);if(!!k.data("id")){c.getStamp(k.data("id"))}else{c.getStampHist()}});c.$mRootElement.find(".ntwi-footer-ic-list.stamp").on("vclick","a",function(j){j.preventDefault();var k=a(this);c.mobjSetEntry={set:"stamp",scid:k.data("scid"),sid:k.data("id")};c.sendEntries()});c.$mRootElement.find(".ntwi-footer-category").find(".page-prev").bind("vclick",function(j){j.preventDefault();c.stampCategoryMove(true)});c.$mRootElement.find(".ntwi-footer-category").find(".page-next").bind("vclick",function(j){j.preventDefault();c.stampCategoryMove(false)});c.$mRootElement.find(".jntwi-direct-emoji").bind("vclick",function(j){j.preventDefault();c.$mRootElement.find(".ntwi-footer-menu.stamp").hide();c.$mRootElement.find(".ntwi-footer-menu.emoji").toggle();if(c.mboGetEmoji===false){c.getEmojiInit();c.mboGetEmoji=true}});c.$mRootElement.find(".ntwi-footer-ic-list.emoji").on("vclick","a",function(j){j.preventDefault();var k=a(this);c.mobjSetEntry={set:"emoji",id:k.data("id")};c.sendEntries()});if(desknets.browser.android){var f=0;var i;var e=c.$mRootElement.find(".ntwi-footer-menu.emoji").find(".ntwi-footer-list");var g=e[0];g.addEventListener("touchstart",function(j){j.preventDefault();var k=j.touches;f=k[0].pageY},false);g.addEventListener("touchmove",function(j){j.preventDefault();var k=j.touches;itouchscrolly=k[0].pageY;clearTimeout(i);i=setTimeout(function(){e.animate({scrollTop:e.scrollTop()-(itouchscrolly-f)},"slow")},100)});var b=c.$mRootElement.find(".ntwi-footer-menu.stamp").find(".ntwi-footer-list");var d=b[0];d.addEventListener("touchstart",function(j){j.preventDefault();var k=j.touches;f=k[0].pageY},false);d.addEventListener("touchmove",function(j){j.preventDefault();var k=j.touches;itouchscrolly=k[0].pageY;clearTimeout(i);i=setTimeout(function(){b.animate({scrollTop:b.scrollTop()-(itouchscrolly-f)},"slow")},100)})}},showing:function(){var b=this;b.callBase("showing");if(!neo.isSet(b.mobjReply)){b.mobjReply={}}b.$mRootElement.find(".ntwi-footer-menu").hide();if(b.boDefSet){b.boDefSet=false;if(neo.isSet(b.mobjReply.name)){b.$mRootElement.find(".jntwi-user").html(desknets.tmpl.escapeWord(b.mobjReply.name));b.$mRootElement.find(".co-input-plus").hide()}else{b.$mRootElement.find(".jntwi-user").html("");b.$mRootElement.find(".co-input-plus").show()}b.$mRootElement.find(".ntwi-textarea").val("");b.$mRootElement.find(".ntwi-counter").text(b.miinput)}},getStampInit:function(){var b=this;var d={};var f={};var g={};var e=0;f={cmd:desknets.ntwi.CMD_STAMP_CATEGORY_LIST};d[e]=f;e++;var g={cmd:desknets.ntwi.CMD_STAMP_HISTORY_LIST};d[e]=g;e++;var c=desknets.ajax.arrayToMultiCmdData(d);desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:desknets.sp.ntwi.getRequestURL(),data:c,success:function(i,h,j){if(i[0]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.sp.msg.view(i[0]["errormessage"],{errorNo:i[0]["errorno"]})}else{if(i[1]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.sp.msg.view(i[1]["errormessage"],{errorNo:i[1]["errorno"]})}}var k=desknets.sp.ajax.getJsonItems(i[0]);if(k.length>0){b.setStampCate(i[0]);if(!i[1]||!i[1].attach){b.getStamp(k[0]["id"])}else{b.setStampData(i[1])}}else{b.boStampNot=true;b.$mRootElement.find(".ntwi-footer-menu.stamp").hide();desknets.sp.msg.view("",desknets.Resource.Message.ntwi_no_stamps)}}})},getStamp:function(d){var b=this;var c={};c={cmd:desknets.ntwi.CMD_STAMP_LIST,id:d};desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:desknets.sp.ntwi.getRequestURL(),data:c,success:function(f,e,g){b.setStampData(f)}})},getStampHist:function(){var b=this;var c={};c={cmd:desknets.ntwi.CMD_STAMP_HISTORY_LIST};desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:desknets.sp.ntwi.getRequestURL(),data:c,success:function(e,d,f){b.setStampData(e)}})},setStampCate:function(c){var j=this;var g=desknets.sp.ajax.getJsonItems(c);var b=g.length;var d=j.$mRootElement.find(".ntwi-footer-category-list");var e=j.$mStampCateTmpl.clone();e.find("img").attr("src","/dneospres/images/ntwi/ntwi-ic_tab_history.png");d.append(e);for(var h=0;h<b;h++){var i=g[h];var f=j.$mStampCateTmpl.clone();f.find("img").attr("src",i.referurl);f.data("id",i.id);d.append(f)}},setStampData:function(h){var d=this;var i=[];if(!h||!h.attach){i=[]}else{i=desknets.sp.ajax.getItems(h.attach.item)}var f=i.length;var e=d.$mRootElement.find(".ntwi-footer-ic-list.stamp");e.html("");for(var g=0;g<f;g++){var c=i[g];var b=d.$mStampTmpl.clone();b.find("img").attr("src",c.referurl);if(!!c.scid){b.data("id",c.id);b.data("scid",c.scid)}else{b.data("id",c.id);b.data("scid",h.id)}e.append(b)}},stampCategoryMove:function(d){var b=this;var e=b.$mRootElement.find(".ntwi-footer-category-list");if(e.not(":animated").length>0){var c=240;if(d){c=-240}var f=e.scrollLeft()+c;e.animate({scrollLeft:f},"slow")}},getEmojiInit:function(){var c=this;var d={};if(!desknets.ntwi.pictogram.isSet()){var b={cmd:desknets.ntwi.CMD_PICTOGRAM_LIST};desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:desknets.sp.ntwi.getRequestURL(),data:b,success:function(f,e,g){desknets.ntwi.pictogram.setValuesFromJson(f);c.setEmojiData()}})}else{c.setEmojiData()}},setEmojiData:function(){var b=this;var d=desknets.ntwi.pictogram.getPictograms();var c=b.$mRootElement.find(".ntwi-footer-ic-list.emoji");c.html("");a.each(d,function(g,h){if(!!h){var f=desknets.ntwi.pictogram._getImageUrl(g);var e=b.$mEmojiTmpl.clone();e.find("img").attr("src",f);e.data("id",g);c.append(e)}})},setReply:function(c){var b=this;b.mobjReply=c;b.boDefSet=true},setUser:function(c,d){var b=this;if(!neo.isSet(b.mobjReply)){b.mobjReply={}}b.mobjReply.to_uid=c;b.mobjReply.name=d;if(neo.isSet(b.mobjReply.name)){b.$mRootElement.find(".jntwi-user").html(desknets.tmpl.escapeWord(b.mobjReply.name))}else{b.$mRootElement.find(".jntwi-user").html("")}},setUpReferItemFromEntries:function(){var b=this;b.$mRootElement.find("textarea").html("")},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.ntwi.CMD_MESSAGE_ADD;c.to_uid=b.mobjReply.to_uid;if(b.mobjSetEntry.set==="stamp"){c.scid=b.mobjSetEntry.scid;c.sid=b.mobjSetEntry.sid}else{if(b.mobjSetEntry.set==="emoji"){c.detail=desknets.ntwi.pictogram.getCode(b.mobjSetEntry.id)}else{c.detail=b.$mRootElement.find("textarea").val()}}return c},getSubmitRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},completeToSendEntries:function(){var b=this;var c=true;if(b.mobjSetEntry.set==="stamp"||b.mobjSetEntry.set==="emoji"){if(b.$mRootElement.find("textarea").val()!=""){if(b.mobjSetEntry.set==="stamp"){desknets.sp.msg.view("",desknets.Resource.Message.ntwi_sp_send_stamp)}else{desknets.sp.msg.view("",desknets.Resource.Message.ntwi_sp_send_emoji)}c=false}}if(c){desknets.sp.ntwi.Direct.invalidate();desknets.sp.changePage("direct",{reverse:true})}},});desknets.page(desknets.sp.ntwi,"DirectDel",desknets.sp.DelPage,{msUid:"",delCloseId:function(){return"directlist"},setInvalidate:function(){var b=this;desknets.sp.ntwi.Direct.invalidate()},setPage:function(c,d){var b=this;b.msUid=d;b.callBase("setPage",c)},getEntriesFromReferItem:function(){var b=this;var c={};c.cmd=desknets.ntwi.CMD_MESSAGE_DEL;c.id=b.msId;c.uid=b.msUid;return c},getSubmitRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},});desknets.page(desknets.sp.ntwi,"DirectUser",desknets.sp.UserSelPage,{openListItem:function(b,c){desknets.sp.ntwi.DirectEntry.setUser(c,b.find("h3").text());history.back()},});desknets.page(desknets.sp.ntwi,"DirectList",desknets.sp.RefPage,{msName:"",msImg:"",msDirect:"",msReply:true,$_Tmpl:null,$_Tmplstamp:null,$_Tmpldate:null,init:function(c){var b=this;b.callBase("init",c);b.$mRootElement.find(".ntwi-nav-msg").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("neomsg",{transition:"fade"})});b.$mRootElement.find(".ntwi-nav-home").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("ntwi",{transition:"fade"})});b.$mRootElement.find(".ntwi-nav-mail").bind("vclick",function(d){d.preventDefault();desknets.sp.changePage("direct",{transition:"fade"})});b.$mRootElement.find(".jntwi-direct-del").bind("vclick",function(d){d.preventDefault();desknets.sp.ntwi.DirectDel.setPage(b.msDirect,b.msId);desknets.sp.changePage("d-directdel",{changeHash:false})});b.$mRootElement.find(".ntwi-btn-post").bind("vclick",function(e){e.preventDefault();var d={};if(!!b.msReply){var d={to_uid:b.msId,name:b.msName}}desknets.sp.ntwi.DirectEntry.setReply(d);desknets.sp.changePage("directentry")});b.$_Tmpl=b.$mRootElement.find(".jntwi-list-tmpl").removeClass("jntwi-list-tmpl").remove();b.$_Tmplstamp=b.$mRootElement.find(".jntwi-list-tmpl-stamp").removeClass("jntwi-list-tmpl-stamp").remove();b.$_Tmpldate=b.$mRootElement.find(".ntwi-dm-ymdseparator").remove()},showing:function(){var b=this;b.callBase("showing");b.$mRootElement.find(":jqmData(role=header)").find(".ui-btn-active").removeClass("ui-btn-active");b.$mRootElement.find(":jqmData(role=header)").find(".ntwi-nav-mail").addClass("ui-btn-active");if(!b.msId){var c=neo.storage.local(desknets.sp.COOKIENAME_NTWIDMSG);b.msId=c.id;b.msName=c.name;b.msImg=c.img;b.msReply=c.boreply;neo.storage.local(desknets.sp.COOKIENAME_NTWIDMSG,{})}if(!b.msId){desknets.sp.changePage("direct")}b.$mRootElement.find(".ntwi-dm-header").text(b.msName)},clearItemsPage:function(){var b=this;b.msDirect="";b.$mRootElement.find(".jntwi-commentlist").empty()},setPage:function(c,f,e,d){var b=this;b.msId=c;b.msName=f;b.msImg=e;b.msReply=d;b.invalidate()},getReferRequestURL:function(){return desknets.sp.ntwi.getRequestURL()},getReferRequestData:function(){var d=this;var g={};var e={};var f=0;var h={cmd:desknets.ntwi.CMD_MESSAGE_READ,uid:d.msId};e[f]=h;f++;var b={cmd:desknets.ntwi.CMD_MESSAGE_LIST,id:d.msId,row:0,num:100};e[f]=b;f++;if(!desknets.ntwi.pictogram.isSet()){var c={cmd:desknets.ntwi.CMD_PICTOGRAM_LIST};e[f]=c;f++}g=desknets.ajax.arrayToMultiCmdData(e);return g},setUpReferItem:function(f){var r=this;if(!desknets.ntwi.pictogram.isSet()){desknets.ntwi.pictogram.setValuesFromJson(f["2"])}var h=r.$mRootElement.find(".jntwi-commentlist");var l=desknets.sp.ajax.getJsonItems(f["1"]);var c=l.length;var q=desknets.Resource.ntwi.readByMeLabel;var d=desknets.Resource.ntwi.readByYouLabel;var e=f.servertime.substr(0,8);var m="";for(var n=0;n<c;n++){var j=null;var p=l[n];if(r.msDirect==""){r.msDirect=p.id}m=p.cretime.substr(0,8);if(e!=m){var o=r.$_Tmpldate.clone();o.find("span").html(desknets.dateTime.dispDateTime(m));e=m;h.append(o)}if(!!p.scid&&!!p.sid){j=r.$_Tmplstamp.clone();if(!!p.referurl){j.find(".ntwi-dm-bl-stamp-img").attr("src",p.referurl)}else{j.find(".ntwi-dm-bl-stamp-img").remove();j.find(".ntwi-dm-c-date").before("("+p.sname+")")}}else{j=r.$_Tmpl.clone();if(!!p.detail){j.find(".ntwi-dm-bl.detail").find("span").html(desknets.ntwi.pictogram.encodeForDisplay(p.detail));j.find(".ntwi-dm-bl-c.attach").find(".ntwi-dm-c-date").remove()}else{j.find(".ntwi-dm-bl.detail").remove()}if(!!p.attach){var g;var i={cmd:"ntwidmsgdispattach",id:p.id};if(!!p.attach.item.thumbnail){var b=desknets.getUrl(desknets.sp.MODULE_MAIN)+"?"+desknets.getNeoParam(i)+"&fno=1&thumbnail=1&filename="+encodeURIComponent(p.attach.item.attachdisp).replace(/'/g,"%27");if(desknets.sp.isAttachDownload(b)){g='<img src="'+b+'">'}else{g=desknets.sp.attachDisp.disp(p.attach,desknets.sp.MODULE_MAIN,i)}}else{g=desknets.sp.attachDisp.disp(p.attach,desknets.sp.MODULE_MAIN,i)}j.find(".ntwi-dm-bl-c.attach").find("span").html(g)}else{j.find(".ntwi-dm-bl.attach").remove()}}j.addClass("ntwi-row-"+p.from);var k="";if(p.from=="you"){j.find(".ntwi-dm-ic-u").find("img").attr("src",r.msImg);if(p.read=="1"){k=d;d=""}}else{if(p.read=="1"){k=q;q=""}}if(k!=""){k='<span class="ntwi-dm-chked"></span>'+k+"<br />"}j.find(".ntwi-dm-c-date").html(k+neo.dateTime.format(desknets.Resource.timeFormat,neo.dateTime.parse(p.cretime)));h.append(j)}},});desknets.sp.ntwi.init()})(jQuery);