/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
CKEDITOR.dialog.add("mediaDialog",function(l){var m={},k=null;var c=l.lang.common,n=l.lang.media;var i=CKEDITOR.dialog.validate.notEmpty(n.urlMissing);var h=CKEDITOR.plugins.get("media");var j='<div><div class="co-cke-media-dialog-preview-title">'+n.preview+'</div><div class="co-cke-media-dialog-preview-container"><iframe class="co-cke-media-dialog-preview-body" src="'+h.path+'dialogs/preview.html"></iframe></div></div>';function p(q){return function(r){this.setValue(m[q])}}function f(t,s,q){var r={type:"text",id:t,label:c[t],validate:CKEDITOR.dialog.validate.number(s),setup:p(t)};if(!!q){CKEDITOR.tools.extend(r,q)}return r}function e(s,q,r){return{type:"html",id:s,html:'<a class="co-cke-media-dialog-button '+s+" "+q[0]+'" title="'+r[0]+'"></a>',onLoad:function(u){var t=CKEDITOR.document.getById(this.domId);t.on("mouseover",function(){this.addClass("cke_btn_over")});t.on("mouseout",function(){this.removeClass("cke_btn_over")});t.on("click",function(){var w=this.hasClass(q[1]),v=w?1:0;this.removeClass(q[v]);this.addClass(q[(v+1)%2]);this.setAttribute("title",r[(v+1)%2]);m[s]=w})}}}function g(q){a(q);d(q);b(q)}function a(r){var q=r.getValueOf("tab-basic","type")=="iframe";var s=r.getElement().findOne(".co-cke-media-type-guide");s.setStyle("visibility",q?"visible":"hidden")}function d(r){var s=Number(r.getValueOf("tab-basic","width"));var q=Number(r.getValueOf("tab-basic","height"));if(s>0&&q>0&&m.width>0&&!!m.height>0&&m.ratioLock){if(m.width!=s&&m.height==q){q=Math.floor(s/m.width*m.height);r.setValueOf("tab-basic","height",String(q))}else{if(m.width==s&&m.height!=q){s=Math.floor(q/m.height*m.width);r.setValueOf("tab-basic","width",String(s))}}}m.width=s;m.height=q}function o(q){if(!!k.$.contentDocument&&!!k.$.contentDocument.body){q(new CKEDITOR.dom.element(k.$.contentDocument.body))}else{k.once("load",function(){q(new CKEDITOR.dom.element(k.$.contentDocument.body))})}}function b(q){o(function(v){var s=v.getChild(0);var u=q.getValueOf("tab-basic","type"),r=q.getValueOf("tab-basic","url");var t=h.types[u||""];var w="";if(r.indexOf("http://")==0||r.indexOf("https://")==0||r.indexOf("/")==0||r.indexOf("\\")==0||r.indexOf("file://")==0){w=r}else{w=h.baseurl+r}if(m.type!=u||m.url!=w||!s){m.type=u;m.url=w;m.inputurl=r;if(!!s){s.remove();s=null}if(!!u&&!!r){s=h.createMediaElement(l,m,false);v.append(s)}}if(!!s&&!t.noSize){s[m.width>0?"setAttribute":"removeAttribute"]("width",String(m.width));s[m.height>0?"setAttribute":"removeAttribute"]("height",String(m.height))}})}return{title:n.title,minWidth:480,minHeight:360,contents:[{id:"tab-basic",label:n.basicSettings,elements:[{type:"select",id:"type",label:n.type,items:h.getTypeSelection(),"default":"video",className:"jco-cke-media-cascade-input",setup:p("type")},{type:"text",id:"url",label:"URL",className:"jco-cke-media-cascade-input",validate:i,setup:p("url")},{id:"type_guide",type:"html",className:"co-cke-media-type-guide",html:n.IframeMessage},{type:"hbox",widths:["","360px"],children:[{type:"hbox",widths:["","24px"],children:[{type:"vbox",children:[f("width",n.validateWidth,{"default":"320",className:"jco-cke-media-cascade-input"}),f("height",n.validateHeight,{"default":"240",className:"jco-cke-media-cascade-input"})]},e("ratioLock",["cke_btn_locked","cke_btn_unlocked"],[n.unlockRatio,n.lockRatio])]},{id:"preview",type:"html",html:j}]}]}],onLoad:function(){var u=this,r=null,v=0,q=null,t="";k=u.getElement().findOne(".co-cke-media-dialog-preview-body");m={ratioLock:true};r=u.getElement().find(".jco-cke-media-cascade-input select");v=r.count();for(var s=0;s<v;s++){r.getItem(s).on("change",function(w){g(u)})}r=u.getElement().find(".jco-cke-media-cascade-input input");v=r.count();for(var s=0;s<v;s++){r.getItem(s).on("blur",function(w){g(u)})}},onShow:function(){var s=this,r=l.getSelection().getStartElement();var q=s.getElement().findOne("input");if(!!r&&String(r.getAttribute("data-cke-real-element-type")).indexOf("media")==0){var t=l.restoreRealElement(r);CKEDITOR.tools.extend(m,h.getPropertiesFromElement(t),true);this.setupContent(t)}else{CKEDITOR.tools.extend(m,{type:"",url:"",width:0,height:0},true)}q.focus();setTimeout(function(){q.focus()},1);o(function(u){u.setHtml("");a(s);d(s);b(s)})},onOk:function(){setTimeout(function(){var q=h.createMediaElement(l,m,true);l.insertElement(q)},10)}}});