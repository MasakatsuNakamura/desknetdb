/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
CKEDITOR.plugins.add("media",{icons:"media",lang:CKEDITOR.lang.medialanguages,types:{},baseurl:"",init:function(d){var a=this,f=d.lang.media;this.types.video={label:f.typeVideo,tagName:"video",attrs:{controls:"controls"}};this.types.audio={label:f.typeAudio,tagName:"audio",attrs:{controls:"controls"},noSize:true};this.types.wmedia={label:f.typeWMedia,tagName:"embed",attrs:{type:"application/x-mplayer2"}};this.types.rplayer={label:f.typeReal,tagName:"embed",attrs:{type:"audio/x-pn-realaudio-plugin"}};this.types.qt={label:f.typeQt,tagName:"embed",attrs:{type:"video/quicktime"}};this.types.flash={label:f.typeFlash,tagName:"embed",attrs:{type:"application/x-shockwave-flash"}};this.types.iframe={label:f.typeIframe,tagName:"iframe"};d.addCommand("media",new CKEDITOR.dialogCommand("mediaDialog",{allowedContent:"video[src,width,height];audio[src];iframe[src,width,height];object[data,type,width,height];embed[src,type,width,height]"}));d.ui.addButton("Media",{label:f.menu,command:"media",toolbar:"insert"});d.addContentsCss(this.path+"styles/media.css");CKEDITOR.dialog.add("mediaDialog",this.path+"dialogs/media.js");if(d.contextMenu){d.addMenuGroup("mediaGroup");d.addMenuItem("mediaItem",{label:f.menuItemTitle,icon:this.path+"icons/media.png",command:"media",group:"mediaGroup"});d.contextMenu.addListener(function(g){if(String(g.getAttribute("data-cke-real-element-type")).indexOf("media")==0){return{mediaItem:CKEDITOR.TRISTATE_OFF}}})}var e=document.URL;var c=0;var b="";c=e.indexOf("?");if(c>0){e=e.substring(0,c)}c=e.lastIndexOf("/");if(c>=0){b=e.substring(0,c+1)}else{b=e}this.baseurl=b;d.on("mode",function(g){if(d.mode=="wysiwyg"){a.convertMediaElements(d)}})},convertMediaElements:function(g){var l=["video","audio","iframe","embed","object"],h=[null,null,null,"cke","cke"];for(var j=0;j<l.length;j++){var a=g.document.getElementsByTag(l[j],h[j]);var c=a.count();for(var d=c-1;d>=0;d--){var f=a.getItem(d);var i=this.getPropertiesFromElement(f);var k=this.createMediaElement(g,i,true);var e=f.getParent(),b=e.getName();k.replace(CKEDITOR.tools.indexOf(l,b)>=0?e:f)}}},getPropertiesFromElement:function(c){var d={type:"iframe"};var a=c.getName(),e=c.getAttribute("type");if(a=="video"||a=="audio"||a=="iframe"){d={type:a}}else{for(var b in this.types){if((!!this.types[b].attrs&&this.types[b].attrs.type==e)||this.types[b].embedType==e){d={type:b};break}}}d.url=c.getAttribute(a=="object"?"data":"src");d.width=c.getAttribute("width")||"";d.height=c.getAttribute("height")||"";return d},createMediaElement:function(g,e,b){var d=null,f=this.types[e.type||""];if(!!f&&!!e.url){d=g.document.createElement(f.tagName);if(b&&!!e.inputurl){d.setAttribute("src",e.inputurl)}else{d.setAttribute("src",e.url)}if(!f.noSize){if(e.width>0){d.setAttribute("width",e.width)}if(e.height>0){d.setAttribute("height",e.height)}}if(!!f.attrs){for(var c in f.attrs){d.setAttribute(c,f.attrs[c])}}if(b){if(desknets.browser.msie8&&(e.type=="wmedia"||e.type=="rplayer"||e.type=="qt"||e.type=="flash")){var a="<embed";if(!!f.attrs){for(var c in f.attrs){a=a+" "+c+'="'+f.attrs[c]+'"'}}if(e.width>0){a=a+' width="'+e.width+'"'}if(e.height>0){a=a+' height="'+e.height+'"'}if(!!e.inputurl){a=a+' src="'+e.inputurl+'" />'}else{a=a+' src="'+e.url+'" />'}d=this.createFakeElementMediaIe8(d,"co-cke-media-placeholder "+e.type,"media_"+e.type,!f.noSize,g,a)}else{d=g.createFakeElement(d,"co-cke-media-placeholder "+e.type,"media_"+e.type,!f.noSize)}}}return d},createFakeElementMediaIe8:function(d,i,l,b,g,f){var c=g.lang.fakeobjects,j=c[l]||c.unknown;var e={"class":i,"data-cke-realelement":encodeURIComponent(f),"data-cke-real-node-type":d.type,alt:j,title:j,align:d.getAttribute("align")||""};if(!CKEDITOR.env.hc){e.src=CKEDITOR.tools.transparentImageData}if(l){e["data-cke-real-element-type"]=l}if(b){e["data-cke-resizable"]=b;var h=new CKEDITOR.htmlParser.cssStyle();var a=d.getAttribute("width"),k=d.getAttribute("height");a&&(h.rules.width=CKEDITOR.tools.cssLength(a));k&&(h.rules.height=CKEDITOR.tools.cssLength(k));h.populate(e)}return g.document.createElement("img",{attributes:e})},getTypeSelection:function(){var a=[];for(var b in this.types){a.push([this.types[b].label,b])}return a}});