/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2017 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){(function(b){desknets.flow={MODULE_MAIN_FLOW:"zflow",MODULE_API_FLOW:"zrflow",CMD_FORMPART_ADD:"flowcmdaddformpart",CMD_FORMPART_REMOVE:"flowcmddelformpart",CMD_FLOWEDITFORMATDISPTMPATTACH:"flowcmdeditformatdisptmpattach",CMD_FLOWEDITFORMATADDATTACH:"flowcmdformataddattach",CMD_FLOWEDITFORMATDELATTACH:"flowcmdformatdelattach",CMD_FLOWEDITFORMATSETSORT:"flowcmdeditformatsetsort",CMD_FLOWAPPLICATEPREVIEW:"flowcmdpreviewapplicate",CMD_ROUTENODE_ADD:"flowcmdaddroutepart",CMD_ROUTENODE_REMOVE:"flowcmddelroutepart",CMD_ROUTENODE_MODTITLE:"flowcmdmodrouteparttitle",CMD_ROUTENODE_MODCOND:"flowcmdmodroutepartcond",CMD_ROUTENODE_MODUSER:"flowcmdmodrouteparttarget",CMD_ROUTENODE_MODGROUP:"flowcmdmodrouteparttarget",CMD_ROUTENODE_MODROLE:"flowcmdmodrouteparttarget",CMD_ROUTENODE_ANAME:"flowcmdmodroutepartgname",CMD_ROUTENODE_MODAUSERS:"flowcmdmodrouteparttarget",CMD_ROUTENODE_REMOVEAUSERS:"flowcmddelrouteparttarget",CMD_ROUTENODE_MODBRANCH:"flowcmdmodroutepartbranch",CMD_ROUTENODE_MODHIERARCHY:"flowcmdmodrouteparthierarchy",CMD_ROUTENODE_MODEXCEPTAPPLICANT:"flowcmdmodroutepartexapplicant",CMD_FLOWEDITROUTESETSORT:"flowcmdeditroutesetsort",CMD_FLOWEDITROUTE:"flowcmdeditroute",CMD_FLOWROUTELIST:"flowcmdroutelist",PAGE_FLOWLIST:"flowindex",PAGE_FLOWENTRY:"flowentry",PAGE_FLOWDISP:"flowdisp",PAGE_FLOWSEARCH:"flowsearch",CMD_FLOWLIST:"flowcmdindex",CMD_FLOWENTRY:"flowcmdentry",CMD_FLOWENTRYDRAFT:"flowcmdentrydraft",CMD_FLOWCONFIRM:"flowcmdconfirm",CMD_FLOWCMDDEL:"flowcmddel",CMD_FLOWCMDDELCONF:"flowcmddelconf",CMD_FLOWCMDDRAFTDEL:"flowcmddraftdel",CMD_FLOWCMDNOTICEDEL:"flowcmdnoticedel",CMD_FLOWCMDNOTICEDELCONF:"flowcmdnoticedelconf",CMD_FLOWUNREAD:"flowcmdunread",CMD_FLOWCOMPLETE:"flowcmdcomplete",CMD_FLOWCANCEL:"flowcmdcomplete",CMD_FLOWCANCELCONF:"flowcmdcompleteconf",CMD_FLOWSEARCH:"flowcmdsearch",CMD_FLOWSEARCHINDEX:"flowcmdsearchindex",CMD_FLOWSTOPSEARCH:"flowcmdsearchstop",CMD_FLOWDISP:"flowcmddisp",CMD_FLOWCABATTACHCOPY:"flowcmdcabattachcopy",CMD_FLOWCONNECTAPP:"flowcmdconnectapp",CMD_FLOWAPPROVAL:"flowcmdapproval",CMD_FLOWDENIAL:"flowcmddenial",CMD_FLOWPRINT:"flowcmdprint",CMD_FLOWREFATTACH:"flowcmddispattach",CMD_FLOWADDATTACH:"flowcmdaddattach",CMD_FLOWDELATTACH:"flowcmddelattach",CMD_FLOWDISPFORMATATTACH:"flowcmddispformatattach",CMS_FLOWMSETREFATTACH:"flowmsetcmddispattach",CMD_FLOWTMPFILEADDATTACH:"flowcmdtmpfileaddattach",CMD_FLOWTMPFILEDELATTACH:"flowcmdtmpfiledelattach",CMD_FLOWTMPFILEDISPATTACH:"flowcmdtmpfiledispattach",CMD_FLOWENTRYFROMRESAVE:"flowcmdentryformresave",CMD_FLOWEDITFORMATCOPYTEMP:"flowcmdeditformatcopytemp",CMD_FLOWEDITFORMAT:"flowcmdeditformat",CMD_FLOWEDITROUTECOPYTEMP:"flowcmdeditroutecopytemp",CMD_FLOWEDITFORMATSAVE:"flowcmdeditformatsave",CMD_FLOWEDITROUTESAVE:"flowcmdeditroutesave",CMD_FLOWEDITROUTECOPY:"flowcmdeditroutecopy",CMD_FLOWSELECTROUTE:"flowcmdselectroute",CMD_FLOWSELECTFORMAT:"flowcmdselectformat",CMD_FLOWUSERFORMATPREVIEW:"flowcmduserformatpreview",CMD_FLOWFORMATPREVIEW:"flowcmdformatpreview",TEMPFILE_FLOWENTRY:"fent",TEMPFILE_FLOWENTRYFORMUPDATE:"fupdent",TEMPFILE_FLOWFORMENTRY:"ffentry",PRM_VAL_ALLUNREAD:"all",PRM_VAL_ALLCOMPLETE:"all",FID_RECV:"0",FID_SEND:"2",FID_DRAFT:"3",init:function(){var d=this;var c=b("#jco-pv-funcid").val();if(d.isFlowCmd(c)){desknets.pageframe.setFuncSel(c)}if(c==desknets.flow.PAGE_FLOWLIST){desknets.hashobserver.init(desknets.flow);desknets.flow.flowindex.init()}if(d.isFlowCmd(c)&&c.indexOf("flowpset")!=0&&c.indexOf("flowmset")!=0){desknets.flow.subwin.init()}},isFlowCmd:function(d){var c=this;if(d.indexOf("flow">=0)){return true}return false},ajaxFormatGet:function(e,f){var c=desknets.getUrl(desknets.flow.MODULE_API_FLOW);var d={cmd:desknets.flow.CMD_FLOWFORMATPREVIEW,id:e};desknets.ajax.rest({url:c,data:d,type:"POST",success:f})},ajaxUserFormatGet:function(e,f){var c=desknets.getUrl(desknets.flow.MODULE_API_FLOW);var d={cmd:desknets.flow.CMD_FLOWUSERFORMATPREVIEW,id:e};desknets.ajax.rest({url:c,data:d,type:"POST",success:f})},getAttExtListCmd:function(c){return"flow"+c},preparedCmdDispRest:function(e){var g;var f=e;g=f.history_list;if(!!g){if(!g.item){g.item=[]}if(!b.isArray(g.item)){g.item=[g.item]}}g=f.route_list;if(!!g){if(!g.item){g.item=[]}if(!b.isArray(g.item)){g.item=[g.item]}b.each(f.route_list["item"],function(h,i){if(!!i.list){g=i.list;if(!g.item){g.item=[]}if(!b.isArray(g.item)){g.item=[g.item]}}})}g=f.signs;if(!!g){if(!g.item){g.item=[]}if(!b.isArray(g.item)){g.item=[g.item]}var c=f.signs["item"].length%5;if(c!=0){c=5-c}for(var d=0;d<c;d++){f.signs["item"].push({})}}return f},getRouteStatusByValue:function(c){var d="";switch(c.sts){case"0":d="";break;case"1":d=desknets.Resource.flow.route_sts_application;break;case"2":switch(c.ROUTE_CLASS_KIND){case"1":d=desknets.Resource.flow.route_sts_approval1;break;case"2":d=desknets.Resource.flow.route_sts_approval2;break;case"3":d=desknets.Resource.flow.route_sts_approval3;break;default:d="unknown";break}break;case"3":case"9":d=desknets.Resource.flow.route_sts_denial;break;case"4":d=desknets.Resource.flow.route_sts_reapproval;break;case"5":d="";break;case"6":d=desknets.Resource.flow.revocation;break;case"7":d=desknets.Resource.flow.forcedend;break}return d},getRouteConditionByValue:function(d){var c="";switch(d){case"0":c=desknets.Resource.flow.approval_all;break;case"1":c=desknets.Resource.flow.approval_harf;break;case"2":c=desknets.Resource.flow.approval_majority;break;case"3":c=desknets.Resource.flow.approval_one;break}return c},getStatusByValue:function(d){var c="";switch(d){case"2":c=desknets.Resource.flow.wait_approval;break;case"3":case"9":c=desknets.Resource.flow.rejected;break;case"4":c=desknets.Resource.flow.approval;break;case"6":c=desknets.Resource.flow.revocation;break;case"7":c=desknets.Resource.flow.revocation;break;case"8":c=desknets.Resource.flow.revocation;break;case"10":c=desknets.Resource.flow.forcedend;break;default:break}return c},"":{}};desknets.flow.input={};desknets.flow.input.format={};desknets.flow.route={}})(jQuery);(function(b){desknets.page(desknets.flow,"subwin",desknets.PageSubwinSearch,{init:function(){var d=b(".jco-subwindow-search");this._buildSubjectList(d);var e=desknets.paramanalyzer.getHashParams();if(e.sw_attach=="1"){d.find("input[name=sw_attach]").attr("checked","checked")}d.find('input[name="srch_key"]').val(e.srch_key);if(!!e.sw_formatid){d.find('select[name="sw_formatid"]').val(e.sw_formatid)}if(!!e.sw_status){d.find('select[name="sw_status"]').val(e.sw_status)}d.find('input[name="sw_entry"]').val(e.sw_entry);if(!!e.sw_important){d.find('select[name="sw_important"]').val(e.sw_important)}d.find('input[name="sdate"]').val(e.sdate);d.find('input[name="edate"]').val(e.edate);var c=this;c.callBase("init");desknets.htmlparts.setUpForm(c.$_inputArea)},_buildSubjectList:function(e){var d=this;var g="";var f=desknets.Resource.flow;var c=e.find('select[name="sw_formatid"]').children();b.each(c,function(h,j){if(b(j).data("type")=="usr"){g=f["private"]+" "+b(j).html();b(j).html(g)}})},_getSearchPrm:function(e){var c=this;var d=c.$_inputArea;e.fldsort="entrydate";e.order="-1";e.row="0";e.sw_attach=d.find("input[name=sw_attach]").is(":checked")?"1":"";e.sw_formatid=d.find('select[name="sw_formatid"]').val();e.sw_status=d.find('select[name="sw_status"]').val();e.srch_key=d.find('input[name="srch_key"]').val();e.sw_entry=d.find('input[name="sw_entry"]').val();e.sw_important=d.find('select[name="sw_important"]').val();e.sdate=d.find('input[name="sdate"]').val();e.edate=d.find('input[name="edate"]').val();return e},_execClear:function(){var c=this;c.callBase("_execClear");c.$_inputArea.find("input[name=sw_attach]").attr("checked",false);c.$_inputArea.find('select[name="sw_formatid"]').val("");c.$_inputArea.find('select[name="sw_status"]').val("-1");c.$_inputArea.find('select[name="sw_important"]').val("0")},_chkInputSearchRequired:function(){var d=this.$_inputArea;var e="";var c=["[name=sw_attach]:checked","[name=srch_key][value!=]","[name=sw_formatid][value!=]","[name=sw_status][value!=-1]","[name=sw_entry][value!=]","[name=sw_important][value!=0]","[name=sdate][value!=]","[name=edate][value!=]"];if(d.find(c.join(",")).length==0){e=desknets.Resource.Message.com_search_nokey;desknets.dialog.alert(e,{type:"warn"});return false}return this.callBase("_chkInputSearchRequired")},_getMainCmd:function(){return desknets.flow.PAGE_FLOWLIST},_getSearchCmd:function(){return desknets.flow.PAGE_FLOWSEARCH}})})(jQuery);desknets.page(desknets.flow,"attach",desknets.attachSetUp,{funcToggleTarget:null,_getToggleTarget:function(){return this.funcToggleTarget},_getUploadURL:function(){return desknets.flow.MODULE_API_FLOW},_getDownLoadURL:function(){return desknets.flow.MODULE_MAIN_FLOW},_getUploadCmd:function(){return desknets.flow.CMD_FLOWADDATTACH},_getDelCmd:function(){return desknets.flow.CMD_FLOWDELATTACH},_getDownLoadCmd:function(){return desknets.flow.CMD_FLOWREFATTACH},_initSetDefPrm:function(){this._objDefPrm={}}});desknets.page(desknets.flow,"ForcedEndDialog",null,{_dialogId:"jflow-forcedend-dialog",$dialog:null,_TMPL_DIALOG:"flow/flow.forcedEndDialog.html",_title:"",_message:"",_funcok:null,init:function(){var b=this;b.destroy()},destroy:function(){var b=this;if(b.$dialog){desknets.dialog.deleteById(this._dialogId);this.$dialog=null}},setDlgTtile:function(b){self._title=b},_getDlgTtile:function(){return self._title},setDlgMessage:function(b){self._message=b},_getDlgMessage:function(){return self._message},setDlgCallback:function(b){self._funcok=b},_getDlgCallback:function(){return self._funcok},open:function(){var b=this;if(b.$dialog==null){b.$dialog=desknets.dialog.make(b._dialogId,b._getDialogOptions());desknets.tmpl.load(b.$dialog,b._TMPL_DIALOG,function(){b._openDialog();desknets.dialog.setFirstDialogOpen(b.$dialog)})}else{b._openDialog()}return b.$dialog},_getDialogOptions:function(){var b=this;var c=a.extend(desknets.dialog.getDialogOption(),{title:b._DIALOG_TITLE,dialogClass:"dn-dialog message confirm",buttons:{},width:700});c.buttons[desknets.Resource.OKButtonLabel]=function(){var d=b._getDlgCallback();if(a.isFunction(d)){d(b.$dialog)}};c.buttons[desknets.Resource.CancelButtonLabel]=function(){b.$dialog.dialog("close")};return c},_openDialog:function(){var b=this;b.$dialog.find("textarea").val("");b.$dialog.find(".co-message>span").html(b._getDlgMessage());b.$dialog.parent("div").find(".ui-dialog-title").text(b._getDlgTtile());b.$dialog.dialog("open")}});desknets.flow.route={_routes:{},_tmpls:null,loadRoutesTemplate:function(b,d){var c=this;desknets.tmpl.load(b,"flow/flow.route.html",function(){var e=b.find("script").remove();if(!c._tmpls){c._tmpls={};e.each(function(){var f=this.getAttribute("data-type");c._tmpls["_"+f]=a(this).html()})}d()},{cache:true})},getRouteTemplate:function(b){return this._tmpls["_"+b]||""},getItemByElement:function(b){var c=b.data("params")||{ROUTE_TYPE:""};return desknets.flow.route.getItem(c.ROUTE_TYPE)},getItem:function(b){return this._routes["route"+b]||this._base},getRouteFromJson:function(d){var b=desknets.ajax.getJsonItems(d);for(var c=0;c<b.length;c++){if(b[c].ROUTE_TYPE=="1"){b[c].items=this._convertRouteItems(b[c]);b[c].list=null}if(b[c].ROUTE_TYPE=="4"||b[c].ROUTE_TYPE=="5"||b[c].ROUTE_TYPE=="6"){b[c].items=this._convertRouteItems(b[c]);b[c].list=null}}return b},getRequestParamFromRoute:function(c){var b={},e=[];a.each(c,function(g,h){if(!!h.SID_PROUTE&&!!b["_"+h.SID_PROUTE]){b["_"+h.SID_PROUTE].items.push(h.id)}else{b["_"+h.id]={id:h.id,items:[]}}});for(var d in b){var f=b[d].id;if(b[d].items.length>0){f+=":"+b[d].items.join(",")}e.push(f)}return e},emptyRoute:function(b){b.children().each(function(){var d=a(this);var c=desknets.flow.route.getItemByElement(d);c.removeElementForEdit(d)})},cleanUpChooserDialog:function(){a(".co-sel-dialog").each(function(){var b=a(this).children(".ui-dialog-content");var c=String(b.attr("id"));if(c.indexOf("flow-route-dialog")==0){desknets.chooser.destroyDialog(b)}})},setUpItemListHtml:function(d,c){var e=[],b='<span class="co-selitem" title="{{name}}"><span>{{name}}</span></span>';a.each(c,function(f,g){if(!g.Name&&!g.name){return true}e.push(desknets.tmpl.replaceWord(b,"name",g.Name||g.name))});d.html(e.join(""))},createRouteDialog:function(b){var d;var c={title:desknets.Resource.flow["title_"+b.id],buttons:{},width:b.width};c.buttons[desknets.Resource.OKButtonLabel]=function(){a(this).trigger("saveFlowRoute."+b.id)};c.buttons[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};d=desknets.dialog.make("flow-entry-route-"+b.id,c);desknets.tmpl.load(d,"flow/flow.route."+b.id+".html",function(){b.complete(d)})},getFormValues:function(c){var d={},b=c.find("form");a.each(b.serializeArray(),function(e,f){d[f.name]=f.value});if(c.find('input[name="denial_condition"]').length==1&&!neo.isSet(d.denial_condition,{blank:false})){d.denial_condition="0"}return d},_convertRouteItems:function(c){var d=[],b=desknets.ajax.getJsonItems(c);a.each(b,function(e,f){if(!!f.sid){f.id=f.sid}else{if(!!f.SID_ROLE_ROUTE){f.id=f.SID_ROLE_ROUTE}}if(!!c.decvguser&&c.decvguser=="2"){d.push(desknets.chooser.convertRoleItem(f))}else{d.push(desknets.chooser.convertUserItem(f))}});return d}};desknets.flow.RouteEditor=function(c,b){desknets.flow.route.cleanUpChooserDialog();this.init(c,b);return this};desknets.flow._routeEditorInst={_$root:a(),_$rootList:a(),_options:null,_assignGroupMakeCnt:10,init:function(d,c){var b=this;b._$root=d.addClass("flow-route-editor");b._options=a.extend({branch:false,view:false},c);b._initElement()},destroy:function(){desknets.flow.route.cleanUpChooserDialog()},setRoute:function(b){desknets.flow.route.emptyRoute(this._$rootList);this._createRoute(this._$rootList,b)},getRoute:function(){var b=[];this._$rootList.find(".flow-route-node").each(function(){var c=a(this).data("params");if(!!c){b.push(c)}});return b},_initElement:function(){var b=this;var e=document.createDocumentFragment();var d=document.createElement("DIV"),c;e.appendChild(d);c=a(d).addClass("flow-route-editor-inner");if(!this._options.branch){c.addClass("no-branch")}desknets.flow.route.loadRoutesTemplate(c,function(){b._initSide(c.children(".flow-route-editor-menu"));b._initMain(c.children(".flow-route-editor-main"));b._$root.append(e);b._$rootList=c.find(".jflow-route-list-root")})},_initSide:function(b){var c=b.children();c.neoFollowScroll({offsetTop:24,cacheContainerTop:false,cacheContainerHeight:false});c.children().each(function(){var d=a(this);var e=d.hasClass("branch")?".jflow-route-list-root":".jflow-route-list";d.draggable({handle:".flow-route-node-handle",cursor:"move",helper:"clone",connectToSortable:e})})},_initMain:function(c,d){var b=c.find(".jflow-route-list-root");if(!this._options.view){this._initMainSortable(b);this._initMainNodes(b)}else{b.on("click","a",function(e,f){e.preventDefault()})}if(a.type(this._options.route)=="array"){this._createRoute(b,this._options.route)}},_initMainSortable:function(c){var b=this;this._$root.on("sortactivate",function(d,e){a(d.target).parent().addClass("active")});this._$root.on("sortdeactivate",function(d,e){a(d.target).parent().removeClass("active")});this._$root.on("sortupdate",function(d,e){if(e.item.hasClass("flow-route-box-node")){b._onDropNodeFromMenu(e.item)}});c.sortable({handle:".flow-route-node-handle",placeholder:"flow-route-row-placeholder"})},_initMainNodes:function(c){var b=this;c.on("click",".flow-route-node-modify-button",function(d){d.preventDefault();var e=a(this);b._onClickModifyButton(e.closest(".flow-route-node"),e.data("target"))});c.on("click",".flow-route-node-remove-button",function(d){d.preventDefault();b._onClickRemoveButton(a(this).closest(".flow-route-node"))})},_createRoute:function(f,e){var d=this,g,c,b={};a.each(e,function(h,j){if(!!j.SID_PROUTE&&!!b[j.SID_PROUTE]){g=b[j.SID_PROUTE].item;g.addSubNode(b[j.SID_PROUTE].element,j)}else{d._filterSetParams(j);g=desknets.flow.route.getItem(j.ROUTE_TYPE);c=g.createElementForEdit(j);f.append(c);b[j.id]={item:g,element:c}}});if(this._options.view){f.find("a").removeAttr("href")}this._onUpdateRoute(f)},_filterSetParams:function(c){if(c.ROUTE_TYPE=="3"&&typeof this._options.getFormParts=="function"){var b=this._options.getFormParts();a.each(b,function(e,d){if(c.partskey==d.partskey){c.ptype=d.ptype;c.title=d.Name}})}},_onDropNodeFromMenu:function(c){var b=this,d=c.next(),g=c.parent();if(!g.parent().hasClass("sort-inner")){var e={url:this._options.restUrl,params:a.extend({},this._options.paramsForAdd),parent:g.closest(".flow-route-row-node").data("params"),complete:function(h){b._insertRouteNode(g,h,d);setTimeout(function(){h.find(".jflow-init-action").click()},0)}};if(c.data("type")=="5"&&!g.parent().hasClass("flow-route-node-branch-in")){if(g.children(".assigned").length<=1){e.params.makecnt=b._assignGroupMakeCnt;e.complete=function(h){b._insertRouteNode(g,h,d)}}}var f=desknets.flow.route.getItem(c.data("type"));f.createNode(e)}c.remove()},_onClickModifyButton:function(b,d){var c=desknets.flow.route.getItemByElement(b);var e="paramsFor"+d.replace(/\..*/,"");c.modifyNode(b,d,{url:this._options.restUrl,params:this._options[e],getFormParts:this._options.getFormParts})},_onClickRemoveButton:function(c){var b=this;var e=desknets.flow.route.getItemByElement(c);var d=c.closest(".jflow-route-list");e.removeNode(c,{url:this._options.restUrl,params:this._options.paramsForRemove,complete:function(){b._onUpdateRoute(d)}})},_insertRouteNode:function(d,b,c){if(!!c&&c.length>0){b.insertBefore(c)}else{b.appendTo(d)}this._onUpdateRoute(d)},_onUpdateRoute:function(b){if(b.children().length<=0){b.parent().addClass("empty")}else{b.parent().removeClass("empty")}}};desknets.flow.RouteEditor.prototype=desknets.flow._routeEditorInst;desknets.flow.route.title={$dialog:a(),getName:function(e){var b=desknets.Resource.flow;var d=[b.sanction,b.approver,b.confirmer,e.ROUTE_CLASS_NAME];var c=Number(e.route_class)-1;return 0<=c&&c<d.length?d[c]:null},openChooser:function(d,c){var b=this;if(this.$dialog.length<=0){this._createChooser(function(){b._showChooser(d,c)})}else{this._showChooser(d,c)}},_createChooser:function(c){var b=this;desknets.flow.route.createRouteDialog({id:"title",width:480,complete:function(d){b.$dialog=d;c()}})},_showChooser:function(f,e){var d=this,b="saveFlowRoute.title";var c=this.$dialog.find("form");this.$dialog.off(b).on(b,function(){d._onChoose(f.id,e)});c.resetForm();neo.form.setFormValues(c,f);this.$dialog.dialog("open")},_onChoose:function(g,d){var c=this,f=desknets.flow.route.getFormValues(this.$dialog);var b=a.extend({id:g},f,d.params);var e=function(){if(typeof d.choose=="function"){d.choose(f)}c.$dialog.dialog("close")};desknets.ajax.rest({url:d.url,data:b,success:e})}};desknets.flow.route.condition={$conditionDialog:a(),$approverDialog:a(),usersEntry:null,roleEntry:null,_sid_group:"",getConditionLabel:function(e){var c=desknets.Resource.flow;var d=[c.approval_all,c.approval_harf,c.approval_majority,c.approval_one];var b=Number(e.decvkind);return 0<=b&&b<d.length?d[b]:null},getApproverLabel:function(e){var c=desknets.Resource.flow;var d=[c.group_approver_user,c.group_approver_all,c.group_approver_role,c.group_approver_manager,c.group_approver_approver,c.group_approver_alluser];var b=Number(e.decvguser);return 0<=b&&b<d.length?d[b]:null},openDialog:function(d,c){var b=this;if(!!c.showApprover){if(neo.isSet(d.SID_GROUP_ROUTE)){b._sid_group=d.SID_GROUP_ROUTE}if(this.$approverDialog.length>0){this.$approverDialog.dialog("destroy").remove();this.$approverDialog=a()}this._createApproverChooser(function(){b._showApproverChooser(d,c)})}else{if(this.$conditionDialog.length<=0){this._createConditionChooser(function(){b._showConditionChooser(d,c)})}else{this._showConditionChooser(d,c)}}},_createConditionChooser:function(c){var b=this;desknets.flow.route.createRouteDialog({id:"condition",width:450,complete:function(d){b.$conditionDialog=d;b._setEventDecvAll(b.$conditionDialog);c()}})},_setEventDecvAll:function(c){var b=this;c.find('input[name="decvkind"]').click(function(d){var e=a(this).val();b._toggleDenialCondition(c,e)})},_toggleDenialCondition:function(c,d){var b=this;if(d=="0"){c.find(".flow-route-denial-condition").hide()}else{c.find(".flow-route-denial-condition").show()}},_checkDenialCondition:function(c,d){var b=this;c.find('input[name="denial_condition"]').attr("checked",false);if(d=="1"){c.find('input[name="denial_condition"]').attr("checked",true)}else{c.find('input[name="denial_condition"]').attr("checked",false)}},_showConditionChooser:function(e,d){var c=this,b="saveFlowRoute.condition";this.$conditionDialog.off(b).on(b,function(){c._onChooseConditionDialog(e.id,c.$conditionDialog,d)});this._setUpDialogValues(this.$conditionDialog,e);var g=e.decvkind;var f=e.denial_condition;c._toggleDenialCondition(c.$conditionDialog,g);c._checkDenialCondition(c.$conditionDialog,f);this.$conditionDialog.dialog("open")},_onChooseConditionDialog:function(f,e,c){var d=desknets.flow.route.getFormValues(e);var b=a.extend({id:f},d,c.params);this._onChoose(e,d,b,c)},_createApproverChooser:function(c){var b=this;desknets.flow.route.createRouteDialog({id:"conditionGroup",width:600,complete:function(d){b._setUpApproverChooser(d);b.$approverDialog=d;b.$approverDialog.find('input[name="_alluser"]').click(function(f){var e=(a(this).attr("checked"))?true:false;if(e){b._showSelectTarget(e)}else{b._showSelectTarget(e)}});b._setEventDecvAll(b.$approverDialog);c()}})},_setUpApproverChooser:function(b){this.usersEntry=desknets.chooser.setUpEntry(b.find(".jflow-approver-users"),[],{dialogID:"flow-route-dialog-cond-users",extraVars:{user:{keyName:""}},dialogOptions:{chooseTarget:["user"],gid:this._sid_group,chooseGrpUsers:true}});this.roleEntry=desknets.chooser.setUpEntry(b.find(".jflow-approver-role"),[],{dialogID:"flow-route-dialog-cond-role",extraVars:{role:{keyName:""}},dialogOptions:{mode:"single",chooseTarget:["role"],search:false,chooseGroup:false,noEveryone:true}})},_showApproverChooser:function(e,d){var c=this,b="saveFlowRoute.conditionGroup";this.$approverDialog.off(b).on(b,function(){c._onChooseApproverDialog(e.id,c.$approverDialog,d)});this._setUpApproverDialogValues(e);this.$approverDialog.dialog("open")},_setUpApproverDialogValues:function(e){var c=[];var b=this;var d={};d=b._getSetUpDialogValues(e);if(!!d._alluser&&d._alluser=="1"){b.$approverDialog.find('input[name="_alluser"]').attr("checked",true);b._showSelectTarget(true)}else{b.$approverDialog.find('input[name="_alluser"]').attr("checked",false);b._showSelectTarget(false)}var g=d.decvkind;var f=d.denial_condition;b._toggleDenialCondition(b.$approverDialog,g);b._checkDenialCondition(b.$approverDialog,f);if(!!d.items){a.each(d.items,function(h,j){if(!!j.name){c.push(j)}})}this.usersEntry.replaceItems([]);this.roleEntry.replaceItems([]);this._setUpDialogValues(this.$approverDialog,d);if(typeof d.decvguser!="undefined"){if(d.decvguser=="1"){this.usersEntry.replaceItems(c)}else{if(d.decvguser=="2"){this.roleEntry.replaceItems(c)}}}},_getSetUpDialogValues:function(d){var b=this;var c={};a.extend(c,d);if(!!c.ROUTE_TYPE&&c.ROUTE_TYPE=="5"){b.$approverDialog.find("#jflow-cond-grp-all").show();b.$approverDialog.find("#jflow-cond-grp-user").hide();if(!!c.decvguser&&c.decvguser=="1"){c.decvguser="5"}}else{b.$approverDialog.find("#jflow-cond-grp-all").hide();b.$approverDialog.find("#jflow-cond-grp-user").show();if(!!c.decvguser&&c.decvguser=="0"){c.decvguser="1";c._alluser=""}else{if(!!c.decvguser&&c.decvguser=="1"){c._alluser="1"}else{if(!neo.isSet(c.decvguser,{blank:false})){c.decvguser="1";c._alluser=""}}}}return c},_onChooseApproverDialog:function(f,e,c){var d=desknets.flow.route.getFormValues(e);if(d.decvguser=="5"){d.decvguser="1"}else{if(d.decvguser=="1"&&!d._alluser){d.decvguser="0"}}var b=a.extend({id:f},d,c.params);if(d.decvguser=="0"){this._addIdToApproverParams(d,b,"SID_USER_ROUTE",this.usersEntry)}else{if(d.decvguser=="2"){this._addIdToApproverParams(d,b,"SID_ROLE_ROUTE",this.roleEntry)}}if(!neo.isSet(d._alluser,{blank:false})){d._alluser=""}if(this._validateApproverParams(d)){this._onChoose(e,d,b,c)}},_addIdToApproverParams:function(b,c,e,g){var d=g.getItems(),f=[];a.each(d,function(h,j){f.push(j.id)});b.items=d;c[e]=f},_validateApproverParams:function(c){var b=desknets.Resource.Message;if(!c.items||c.items.length<=0){if(c.decvguser=="0"){desknets.dialog.alert(b.flow_route_no_approver_users);return false}else{if(c.decvguser=="2"){desknets.dialog.alert(b.flow_route_no_approver_role);return false}}}return true},_showSelectTarget:function(d){var b=this;var c=a(".jflow-approver-users").find(".jco-sel-btn");if(d){c.attr("disabled",d);a("input[name=_alluser]").attr("checked",d);a(".jflow-approver-users").find(".co-selmulti-items-scroll").hide()}else{c.attr("disabled",d);a("input[name=_alluser]").attr("checked",d);a(".jflow-approver-users").find(".co-selmulti-items-scroll").show()}},_setUpDialogValues:function(c,d){var b=c.find("form");c.resetForm();neo.form.setFormValues(c,d)},_onChoose:function(e,b,c,d){var f=function(){if(typeof d.choose=="function"){d.choose(b)}e.dialog("close")};desknets.ajax.rest({url:d.url,data:c,success:f})}};desknets.flow.route.routeList={$dialog:a(),openChooser:function(c){var b=this,e,d;e=function(){if(b.$dialog.length<=0){b._createChooser(c,function(){d()})}else{d()}};d=function(){if(b.$dialog.find(".jflow-route-list-item").length>0){b._loadList(c,function(){b._showChooser(c)})}else{b._showChooser(c)}};e()},_createChooser:function(c,d){var b=this;desknets.flow.route.createRouteDialog({id:"routeList",width:400,complete:function(e){b.$dialog=e;d()}})},_loadList:function(c,d){var b=this;desknets.ajax.rest({url:c.url,data:c.params,success:function(e){b._createList(desknets.ajax.getJsonItems(e));d()}})},_createList:function(c){var e=this.$dialog.find(".jflow-route-list-item");var d=[],b=e.html();var f=c.length>0?"removeClass":"addClass";a.each(c,function(j,l){var h=b;h=desknets.tmpl.replaceWordHtml(h,"id",l.id);var g=desknets.Resource.flow;if(!!l.routetype&&l.routetype=="usr"){h=desknets.tmpl.replaceWord(h,"Name",g["private"]+" "+l.Name)}else{h=desknets.tmpl.replaceWord(h,"Name",l.Name)}var k=!!l.routetype?l.routetype:"";h=desknets.tmpl.replaceWord(h,"type",k);d.push(h)});this.$dialog[f]("flow-route-no-items");this.$dialog.find(".jflow-route-list").html(d.join(""));e.remove()},_showChooser:function(e){var d=this,b="saveFlowRoute.routeList";var c=this.$dialog.find("form");this.$dialog.off(b).on(b,function(){d._onChoose(e)});c.resetForm();this.$dialog.dialog("open")},_onChoose:function(c){var b=this.$dialog.find("input:checked");if(typeof c.choose=="function"&&b.length>0){c.choose(b.val(),b.data("type"))}this.$dialog.dialog("close")}};desknets.flow.route.exceptapplicant={$dialog:a(),getDispVal:function(e){var d=desknets.Resource.flow;var c=[d.except,d.not_except,d.auto];var b=Number(e.except_for_applicant);if(b==2){return c[2]}return b==1?c[0]:c[1]},openChooser:function(d,c){var b=this;if(this.$dialog.length<=0){this._createChooser(function(){b._showChooser(d,c)})}else{this._showChooser(d,c)}},_createChooser:function(c){var b=this;desknets.flow.route.createRouteDialog({id:"exceptapplicant",width:480,complete:function(d){b.$dialog=d;c()}})},_showChooser:function(f,e){var d=this,b="saveFlowRoute.exceptapplicant";var c=this.$dialog.find("form");this.$dialog.off(b).on(b,function(){d._onChoose(f.id,e)});c.resetForm();if(!f.except_for_applicant){f.except_for_applicant=0}neo.form.setFormValues(c,f);this.$dialog.dialog("open")},_onChoose:function(g,d){var c=this,f=desknets.flow.route.getFormValues(this.$dialog);var b=a.extend({id:g},f,d.params);var e=function(){if(typeof d.choose=="function"){d.choose(f)}c.$dialog.dialog("close")};desknets.ajax.rest({url:d.url,data:b,success:e})}};desknets.page(desknets.flow.route,"_base",null,{id:"base",routeNo:0,$root:null,showConditionApprover:false,defaultParams:{route_class:"2"},createNode:function(c){var b=this;this.createRouteOnServer(c,function(e){if(typeof c.complete=="function"){var d=a.extend({id:e,ROUTE_TYPE:b.routeNo},b.defaultParams);if(!!c.parent){d.SID_PROUTE=c.parent.id}c.complete(b.createElementForEdit(d))}})},modifyNode:function(b,d,c){if(d=="Title"){this._openTitleChooser(b,c)}else{if(d=="Condition"){this._openConditionChooser(b,c)}else{if(d=="ExceptApplicant"){this._openExceptApplicantChooser(b,c)}}}},removeNode:function(c,d){var b=this,e=desknets.Resource.Message.flow_route_remove_confirm;desknets.dialog.confirm(e,function(){var f=c.data("params")||{};b.removeRouteOnServer(f.id,d,function(){b.removeElementForEdit(c);if(typeof d.complete=="function"){d.complete()}})})},addSubNode:function(b,c){},createElementForEdit:function(e){var b=a("<div />");var d=desknets.flow.route.getRouteTemplate("-1");var c=desknets.flow.route.getRouteTemplate(this.routeNo);b.addClass("flow-route-node flow-route-row-node "+this.id);b.html(d);b.children(".flow-route-content").html(c);this.setUpElementForEdit(b);this.updateElementForEdit(b,e);return b},updateElementForEdit:function(c,d){var b=c.data("params")||{};this.setElementValueForEdit(c,d);c.data("params",a.extend(b,d))},removeElementForEdit:function(b){b.remove()},setUpElementForEdit:function(b){},setElementValueForEdit:function(d,f){if(!!f.route_class){var e=d.find(".flow-route-node-title>a");this.setValueToNode(e,desknets.flow.route.title.getName(f))}if(!!f.except_for_applicant){var e=d.find(".flow-route-node-except-applicant>a");this.setValueToNode(e,desknets.flow.route.exceptapplicant.getDispVal(f))}var c=false;if(!!f.ROUTE_TYPE){if(f.ROUTE_TYPE=="4"&&!!f.SID_GROUP_ROUTE){if(!f.Name&&f.SID_GROUP_ROUTE!="0"){c=true}}else{if(f.ROUTE_TYPE=="0"&&!!f.SID_USER_ROUTE){if(!f.Name&&f.SID_USER_ROUTE!="0"){c=true}}else{if(f.ROUTE_TYPE=="2"&&!!f.SID_ROLE_ROUTE){if(!f.Name&&f.SID_ROLE_ROUTE!="0"){c=true}}}}if(c){f.Name=desknets.Resource.flow.no_route_data}}if(!!f.Name){var b=d.find(".jflow-target");b.css("display","inline-block");if(c){b.addClass("flow-route-noitem")}else{b.removeClass("flow-route-noitem")}if(f.ROUTE_TYPE=="4"&&!!f.SID_GROUP_ROUTE){this.setValueToNode(b.children(),f.Name,f.tgname)}else{this.setValueToNode(b.children(),f.Name)}}},createRouteOnServer:function(c,d){var b=a.extend({ROUTE_TYPE:this.routeNo},c.params,this.defaultParams);if(!!c.parent){b.SID_PROUTE=c.parent.id}desknets.ajax.rest({url:c.url,data:b,success:function(e){d(e.id||0)}})},removeRouteOnServer:function(e,c,d){var b=a.extend({},c.params);b.id=e;desknets.ajax.rest({url:c.url,data:b,success:d})},setValueToNode:function(b,e,f){var c=String(e).replace(/ /g,"\u00A0");var d="";if(!!f&&f.length>0){d=f}else{d=e}b.attr("title",d).text(c)},_openTitleChooser:function(c,d){var b=this,f=c.data("params");var e=a.extend({},d,{choose:function(g){b.updateElementForEdit(c,g)}});desknets.flow.route.title.openChooser(f,e)},_openConditionChooser:function(c,d){var b=this,f=c.data("params");var e=a.extend({},d);e.showApprover=this.showConditionApprover;e.choose=function(g){b.updateElementForEdit(c,g)};desknets.flow.route.condition.openDialog(f,e)},_openExceptApplicantChooser:function(c,d){var b=this,f=c.data("params");var e=a.extend({},d,{choose:function(g){b.updateElementForEdit(c,g)}});desknets.flow.route.exceptapplicant.openChooser(f,e)}});desknets.page(desknets.flow.route._routes,"route0",desknets.flow.route._base,{id:"user",routeNo:0,_TMPL_USER_NAME:'<span class="co-selitem"><span></span></span>',modifyNode:function(b,d,c){this.callBase("modifyNode",b,d,c);if(d=="User"){this._openTargetChooser(b,c)}},removeElementForEdit:function(b){var d=b.data("params");var c=a("#flow-route-dialog-user-"+d.id);this.callBase("removeElementForEdit",b);if(c.length>0){desknets.chooser.destroyDialog(c)}},_openTargetChooser:function(c,d){var b=this,e=c.data("params");this._openChooserDialog(e.id,function(f){b._saveTargetOnServer(e.id,f,d,function(){b.updateElementForEdit(c,{SID_USER_ROUTE:f.id,Name:f.name})})})},_openChooserDialog:function(c,b){desknets.chooser.open("flow-route-dialog-user-"+c,{mode:"single",choosePrivateGroup:"readonly",unassignGroup:"readonly",choose:function(d){if(d.length==1){b(d[0])}}})},_saveTargetOnServer:function(f,d,c,e){if(!!c.url){var b=a.extend({id:f,SID_USER_ROUTE:d.id},c.params);desknets.ajax.rest({url:c.url,data:b,success:e})}else{e()}}});desknets.page(desknets.flow.route._routes,"route1",desknets.flow.route._base,{id:"approvals",routeNo:1,defaultParams:{route_class:"2",decvkind:"0"},_$nameEditor:a(),modifyNode:function(b,d,c){this.callBase("modifyNode",b,d,c);if(d=="ApprovalName"){this._openNameChooser(b,c)}else{if(d=="ApprovalUsers"){this._openUsersChooser(b,c)}else{if(d.indexOf("RemoveApprovalUser.")==0){var e=d.replace("RemoveApprovalUser.","");this._removeUser(b,e,c)}}}},setElementValueForEdit:function(c,e){var f=desknets.flow.route.condition.getConditionLabel(e);this.callBase("setElementValueForEdit",c,e);if(!!e.decvgname){this.setValueToNode(c.find(".jflow-approval-name"),e.decvgname)}if(!!e.items){var d=this._createItemsHtml(e.items);var b=c.find(".jflow-targets");b.html(d)}if(!!f){this.setValueToNode(c.find(".jflow-condition"),f)}},removeElementForEdit:function(b){var c=b.data("params");var d=a("#flow-route-dialog-users-"+c.id);this.callBase("removeElementForEdit",b);if(d.length>0){desknets.chooser.destroyDialog(d)}},_createItemsHtml:function(b){var c=[];a.each(b,function(e,f){if(f.name.length==0){return true}var d=desknets.flow.route.getRouteTemplate("1.1");d=desknets.tmpl.replaceWordHtml(d,"id",f.id);d=desknets.tmpl.replaceWord(d,"name",f.name);c.push(d)});return c.join("")},_openNameChooser:function(c,d){var b=this;if(this._$nameEditor.length<=0){this._createNameChooser(function(){b._showNameChooser(c,d)})}else{this._showNameChooser(c,d)}},_createNameChooser:function(c){var b=this;desknets.flow.route.createRouteDialog({id:"approvalName",width:460,complete:function(d){b._$nameEditor=d;c()}})},_showNameChooser:function(d,e){var c=this,b="saveFlowRoute.approvalName";var f=d.data("params");this._$nameEditor.off(b).on(b,function(){c._onSaveName(f.id,d,e)});this._$nameEditor.find(".jflow-route-name").val(f.decvgname||"");this._$nameEditor.dialog("open")},_onSaveName:function(h,d,e){var c=this;var g={id:h,decvgname:this._$nameEditor.find(".jflow-route-name").val()};if(this._validateName(g)){var b=a.extend(g,e.params);var f=function(){c.updateElementForEdit(d,g);c._$nameEditor.dialog("close")};desknets.ajax.rest({url:e.url,data:b,success:f,error:function(l,j,n){var i="";var k="";var m=desknets.parseErrorInfo(n,l.status);if(m.level!="error"){k=a.parseJSON(l.responseText);i=desknets.getErrFieName(c._$nameEditor,k.errmsgadd)}var n=i+m.message;desknets.dialog.alert(n,{type:m.level})}})}},_validateName:function(c){var b=desknets.Resource.Message;if(!c.decvgname){desknets.dialog.alert(b.flow_route_no_approval_group_name);return false}return true},_openUsersChooser:function(c,d){var b=this,e=c.data("params");this._openUsersChooserDialog(e,function(f){b._saveUsersOnServer(e.id,f,d,function(){b.updateElementForEdit(c,{items:f})})})},_openUsersChooserDialog:function(d,c){var b=[];if(!!d.items){a.each(d.items,function(e,f){if(!!f.name){b.push(f)}});d.items=b}desknets.chooser.open("flow-route-dialog-users-"+d.id,{items:d.items||[],choosePrivateGroup:"readonly",unassignGroup:"readonly",choose:c})},_saveUsersOnServer:function(g,c,d,f){var b,e=[];a.each(c,function(h,j){e.push(j.id)});b=a.extend({id:g,SID_USER_ROUTE:e},d.params);desknets.ajax.rest({url:d.url,data:b,success:f})},_removeUser:function(d,h,e){var c=this,g=d.data("params");var b=a.extend({id:g.id,SID_USER_ROUTE:h},e.params);var f=d.find('.co-selitem[data-id="'+h+'"]');if(f.length>0){desknets.ajax.rest({url:e.url,data:b,success:function(){c._removeUserOfParams(d,h);f.remove()}})}},_removeUserOfParams:function(b,d){var c=b.data("params");c.items=neo.array.remove(c.items,d,function(f,e){return f.id==e});b.data("params",c)}});desknets.page(desknets.flow.route._routes,"route2",desknets.flow.route._base,{id:"role",routeNo:2,defaultParams:{route_class:"2",decvkind:"0"},modifyNode:function(b,d,c){this.callBase("modifyNode",b,d,c);if(d=="Role"){this._openRoleChooser(b,c)}},setElementValueForEdit:function(b,c){var d=desknets.flow.route.condition.getConditionLabel(c);this.callBase("setElementValueForEdit",b,c);if(!!d){this.setValueToNode(b.find(".jflow-condition"),d)}if(!!c.SID_ROLE_ROUTE){this._loadUsersInRole(b,c.SID_ROLE_ROUTE)}},removeElementForEdit:function(b){var c=b.data("params");var d=a("#flow-route-dialog-role-"+c.id);this.callBase("removeElementForEdit",b);if(d.length>0){desknets.chooser.destroyDialog(d)}},_openRoleChooser:function(c,d){var b=this,e=c.data("params");this._openChooserDialog(e.id,function(f){b._saveRoleOnServer(e.id,f,d,function(){e.SID_ROLE_ROUTE=f.id;e.Name=f.name;b.updateElementForEdit(c,e)})})},_openChooserDialog:function(c,b){desknets.chooser.open("flow-route-dialog-role-"+c,{mode:"single",chooseTarget:["role"],search:false,chooseGroup:false,noEveryone:true,choose:function(d){if(d.length==1){b(d[0])}}})},_saveRoleOnServer:function(f,d,c,e){var b=a.extend({id:f,SID_ROLE_ROUTE:d.id},c.params);desknets.ajax.rest({url:c.url,data:b,success:e})},_loadUsersInRole:function(d,f){var c=this,e=d.find(".co-selmulti-items");var b=d.find(".jflow-item-app-role");desknets.ajax.rest({url:desknets.getUrl(desknets.flow.MODULE_API_FLOW),data:{cmd:"flowcmdeditrouterolelist",id:f},success:function(h){var g=desknets.ajax.getJsonItems(h);desknets.flow.route.setUpItemListHtml(e,g);if(g.length>0){b.show()}else{b.hide()}}})}});desknets.page(desknets.flow.route._routes,"route3",desknets.flow.route._base,{id:"branch",routeNo:3,_$branchEditor:a(),_$branchVariables:a(),modifyNode:function(b,d,c){this.callBase("modifyNode",b,d,c);if(d=="Branch"){this._openBranchChooser(b,c)}},addSubNode:function(e,f){var c=desknets.flow.route.getItem(f.ROUTE_TYPE);var d=e.find(".flow-route-node-branch-in");var b=c.createElementForEdit(f);d.removeClass("empty");d.children(".jflow-route-list").append(b)},removeElementForEdit:function(b){var c=b.find(".jflow-route-list");desknets.flow.route.emptyRoute(c);c.sortable("destroy");b.remove()},setUpElementForEdit:function(c){var b=this;c.find(".jflow-route-list").sortable({handle:".flow-route-node-handle",placeholder:"flow-route-row-placeholder",tolerance:"pointer",over:function(d,e){b._startSortCapture(a(this))},out:function(d,e){b._endSortCapture(a(this))},stop:function(d,e){var f=a(this);setTimeout(function(){b._endSortCapture(f)},0)}})},setElementValueForEdit:function(b,d){var c=this._createExpressionText(d);this.callBase("setElementValueForEdit",b,d);if(typeof d.ptype!="undefined"){this.setValueToNode(b.find(".jflow-branch-expression"),c)}},_startSortCapture:function(b){b.closest(".flow-route-editor-main").addClass("sort-inner")},_endSortCapture:function(b){b.closest(".flow-route-editor-main").removeClass("sort-inner")},_createExpressionText:function(f){var d=["eq","ne","gt","lt","ge","le","in","ni"];var b=desknets.Resource.flow;var g=d[Number(f.eval_method)-1]||"";var c=this._getTypeByPartNo(f.ptype);var e=b["branchsummary_"+c+"_"+g];if(!e){return b.branchsummary_unset}e=desknets.tmpl.replaceWordHtml(e,"item",f.title);e=desknets.tmpl.replaceWordHtml(e,"val",f.eval_val);return e},_getTypeByPartNo:function(b){if(b==3||b==4){return"text"}else{if(b==8||b==9){return"select"}else{if(b==7){return"checkbox"}else{if(b==5||b==11){return"number"}}}}return"null"},_openBranchChooser:function(c,d){var b=this;if(this._$branchEditor.length<=0){this._createBranchChooser(function(){b._showBranchChooser(c,d)})}else{this._showBranchChooser(c,d)}},_createBranchChooser:function(c){var b=this;desknets.flow.route.createRouteDialog({id:"branch",width:500,complete:function(d){b._$branchEditor=d;b._$branchVariables=d.find('select[name="partskey"]');b._$branchVariables.change(function(){b._updateBranchExpression()});c()}})},_showBranchChooser:function(d,e){var c=this,b="saveFlowRoute.branch";var f=d.data("params");this._$branchEditor.off(b).on(b,function(){c._onSaveBranch(f.id,d,e)});this._setBranchDialogValues(f,e);this._$branchEditor.dialog("open")},_setBranchDialogValues:function(d,c){var b=this._$branchEditor.find("form");b.resetForm();if(typeof c.getFormParts=="function"){this._setBranchVariables(c.getFormParts())}this._$branchVariables.val(d.partskey);this._updateBranchExpression();neo.form.setFormValues(b,d)},_setBranchVariables:function(d){var b=this,c=desknets.Resource.flow;this._$branchVariables.children(":not(.jform-default)").remove();a.each(d,function(f,e){if(a.inArray(Number(e.ptype),[3,4,5,7,8,9,11])>=0){var g=a("<option />").attr("value",e.partskey);g.text(e.Name||c.untitled);g.appendTo(b._$branchVariables);g.data("type",e.ptype);if(!!e.selval){g.data("items",desknets.ajax.getJsonItems(e.selval))}}})},_updateBranchExpression:function(){var c=this._$branchVariables.children().filter(function(){return this.selected});var b=this._getTypeByPartNo(c.data("type"));this._setBranchExpressionDisplay(b);if(b=="select"){this._updateBranchEnums(c.data("items"))}},_updateBranchEnums:function(b){var c=this._$branchEditor.find(".jflow-route-editor-enum-value");c.empty();if(!!b){a.each(b,function(d,e){var f=a("<option />").attr("value",e.value).text(e.value).appendTo(c)})}},_setBranchExpressionDisplay:function(b){this._$branchEditor.find(".jflow-route-editor-expression").each(function(){var e=a(this),d=e.find("input,select");var c=e.data("type")==b;e[c?"show":"hide"]();d.each(function(){this.disabled=!c});neo.form.resetInputValue(d)})},_onSaveBranch:function(c,g,j){var i=this,f=desknets.flow.route.getFormValues(this._$branchEditor);if(this._validateBranch(f)){var b=this._$branchVariables.children().filter(function(){return this.selected});var h=a.extend({id:c},f,j.params);var e=a.extend({},f,{ptype:b.data("type"),title:b.text()});var d=function(){i.updateElementForEdit(g,e);i._$branchEditor.dialog("close")};desknets.ajax.rest({url:j.url,data:h,success:d})}},_validateBranch:function(c){var b=desknets.Resource.Message;if(!c.partskey){desknets.dialog.alert(b.flow_route_no_branch);return false}return true}});desknets.page(desknets.flow.route,"_groupBase",desknets.flow.route._base,{showConditionApprover:true,defaultParams:{route_class:"2",decvkind:"0",decvguser:"1",_alluser:"",denial_condition:"0",except_for_applicant:"0"},setElementValueForEdit:function(b,d){var e=desknets.flow.route.condition.getConditionLabel(d);var c=desknets.flow.route.condition.getApproverLabel(d);this.callBase("setElementValueForEdit",b,d);if(!!e){this.setValueToNode(b.find(".jflow-condition"),e)}if(!!c){this.setValueToNode(b.find(".jflow-approver"),c)}this._setRoleElementValueForEdit(b,d);this._setUsersElementValueForEdit(b,d)},_setRoleElementValueForEdit:function(c,d){var b=c.find(".jflow-item-app-role");if(!neo.isSet(d.decvguser)){return}if(d.decvguser=="2"&&!!d.items){desknets.flow.route.setUpItemListHtml(b,d.items);b.show()}else{b.hide()}},_setUsersElementValueForEdit:function(c,e){var b=c.find(".jflow-item-app-users");if(!neo.isSet(e.decvguser)){return}if(e.decvguser=="0"&&!!e.items){var d=b.find(".co-selmulti-items");desknets.flow.route.setUpItemListHtml(d,e.items);b.show()}else{b.hide()}}});desknets.page(desknets.flow.route._routes,"route4",desknets.flow.route._groupBase,{id:"group",routeNo:4,setElementValueForEdit:function(c,e){this.callBase("setElementValueForEdit",c,e);var d="";if(Number(e.decvguser)==0){var b={decvguser:"1"};d=desknets.flow.route.condition.getApproverLabel(b)}else{if(e.decvguser=="1"){d=desknets.flow.route.condition.getApproverLabel(e);if(!!d){d=d+" "+desknets.Resource.flow.group_approver_user_all}}}if(!!d){this.setValueToNode(c.find(".jflow-approver"),d)}},modifyNode:function(b,d,c){this.callBase("modifyNode",b,d,c);if(d=="Group"){this._openGroupChooser(b,c)}},removeElementForEdit:function(b){var d=b.data("params");var c=a("#flow-route-dialog-group-"+d.id);this.callBase("removeElementForEdit",b);if(c.length>0){desknets.chooser.destroyDialog(c)}},_openGroupChooser:function(c,d){var b=this,e=c.data("params");this._openChooserDialog(e.id,function(f){b._saveGroupOnServer(e.id,f,d,function(){if(!!e.SID_GROUP_ROUTE&&e.SID_GROUP_ROUT!=f.id){e.items={};if(!!e.decvguser&&e.decvguser=="0"){var g={id:e.id,decvguser:e.decvguser,decvkind:e.decvkind,cmd:desknets.flow.CMD_ROUTENODE_MODCOND,rtnpoint:e.rtnpoint,tmpno:d.params.tmpno};desknets.ajax.rest({url:d.url,data:g})}}e.SID_GROUP_ROUTE=f.id;e.Name=f.name;e.tgname=desknets.chooser.getLongName(f);b.updateElementForEdit(c,e)})})},_openChooserDialog:function(c,b){desknets.chooser.open("flow-route-dialog-group-"+c,{mode:"single",chooseTarget:["group"],choose:function(d){if(d.length==1){b(d[0])}}})},_saveGroupOnServer:function(f,d,c,e){var b=a.extend({id:f,SID_GROUP_ROUTE:d.id},c.params);desknets.ajax.rest({url:c.url,data:b,success:e})},_openConditionChooser:function(c,d){var b=this,e=c.data("params");if(!!e&&!neo.isSet(e.SID_GROUP_ROUTE,{blank:false})){desknets.dialog.alert(desknets.Resource.flow.select_route_group,{type:"warn"})}else{b.callBase("_openConditionChooser",c,d)}}});desknets.page(desknets.flow.route._routes,"route5",desknets.flow.route._groupBase,{id:"assigned",routeNo:5,maxAncestor:24,_$hierarchyEditor:a(),defaultParams:{route_class:"2",decvkind:"0",decvguser:"4"},createNode:function(c){var b=this;this.createRouteOnServer(c,function(j){if(typeof c.complete=="function"){var f=1;var d=[];if(a.type(j)=="array"){d=j}else{d=[j]}f=d.length;var g=parseInt(j,10);for(var e=0;e<f;e++){var h=a.extend({id:d[e],ROUTE_TYPE:b.routeNo},b.defaultParams);if(!!c.parent){h.SID_PROUTE=c.parent.id}h.hierarchy=f-e;c.complete(b.createElementForEdit(h))}}})},modifyNode:function(b,d,c){this.callBase("modifyNode",b,d,c);if(d=="Hierarchy"){this._openHierarchyChooser(b,c)}else{if(d=="Remove"){this._removeParentGroup(b,c)}}},setElementValueForEdit:function(e,i){var d=e,c=d.hasClass("flow-route-row-node");if(c){d=d.children(".flow-route-content")}this.callBase("setElementValueForEdit",d,i);if(!!i.hierarchy){var b=e.find(".flow-route-node-label-grp");var g=desknets.tmpl.replaceWord(desknets.Resource.flow.hierarchy,"no",i.hierarchy);b.text(g);b.attr("title",g)}if(i.decvguser=="1"){var h={decvguser:"5"};var f=desknets.flow.route.condition.getApproverLabel(h);this.setValueToNode(d.find(".jflow-approver"),f)}},_openHierarchyChooser:function(c,d){var b=this;if(this._$hierarchyEditor.length<=0){this._createHierarchyChooser(function(){b._showHierarchyChooser(c,d)})}else{this._showHierarchyChooser(c,d)}},_createHierarchyChooser:function(c){var b=this;desknets.flow.route.createRouteDialog({id:"grphierarchy",width:325,complete:function(d){b._$hierarchyEditor=d;c()}})},_showHierarchyChooser:function(d,e){var c=this;var b="saveFlowRoute.grphierarchy";var f=d.data("params");this._$hierarchyEditor.off(b).on(b,function(){c._onSaveHierarchy(f.id,d,e)});this._$hierarchyEditor.find(".jflow-route-hierarchy").val(f.hierarchy||"1");this._$hierarchyEditor.dialog("open")},_onSaveHierarchy:function(h,d,e){var c=this;var g={id:h,hierarchy:this._$hierarchyEditor.find(".jflow-route-hierarchy").val()};var b=a.extend(g,e.params);var f=function(){c.updateElementForEdit(d,g);c._$hierarchyEditor.dialog("close")};desknets.ajax.rest({url:e.url,data:b,success:f})},_createSubElementForEdit:function(e){var b=a("<div />");var c=desknets.flow.route.getRouteTemplate(this.routeNo);var d=desknets.flow.route.getRouteTemplate(this.routeNo+0.2);b.data("type",this.routeNo).addClass("flow-route-node flow-route-sub-node assigned");b.html(d+c);this.updateElementForEdit(b,e);return b},_insertSubNode:function(g,e,c){var f=this._createSubElementForEdit(g),d=desknets.Resource.flow;var b=e==1?d.ancestor_groups1:d.ancestor_groups;b=desknets.tmpl.replaceWordHtml(b,"count",e);b=desknets.tmpl.replaceWordHtml(b,"count-1",e-1);f.find(".flow-route-node-label").text(b);f.insertBefore(c)},_removeParentGroup:function(b,c){var e=[],d=b.closest(".flow-route-row-node");var f=b.nextAll(".flow-route-sub-node").add(b);f.each(function(){var g=a(this).data("params");e.push(g.id)});this.removeRouteOnServer(e,c,function(){f.remove();d.children(".flow-route-parent-group").show()})}});desknets.page(desknets.flow,"flowprint",desknets.print,{mflg:"0",init:function(d,b,e){var c=this;c.$area=d;if(a.isFunction(b)){desknets.print.setPrintHtmlFunc=b}else{desknets.print.setPrintHtmlFunc=c.setPrintHtmlFuncDef}d.find(".jflow-msg-printer").click(function(f){f.preventDefault();c.mflg="0";desknets.popUp.hide(a(this));c.initPrintOpen(e)});d.find(".jflow-msg-printer-on").click(function(f){f.preventDefault();c.mflg="1";desknets.popUp.hide(a(this));c.initPrintOpen(e)})},buildPrintPageHtml:function(b,d,h,i){var j=this;var c=b;var f={},e={};f.cmd=desknets.flow.CMD_FLOWPRINT;e.cmd=desknets.flow.CMD_FLOWDISP;e.id=c;e.flg=j.mflg;e.formType="-3";if(!!d){e.mode="history";e.hisid=d}e.print="1";if(!!i){e.cmd=desknets.flowset.CMD_FLOWMSETDISP}params=desknets.ajax.arrayToMultiCmdData({"0":f,"1":e});var g=function(l){var k;desknets.flow.preparedCmdDispRest(l[1]);if(!!d){l[1]["history_list"]=null}k=j._buildBody(l);h(k)};this._ajaxGetData(params,g)},_ajaxGetData:function(d,c){var b=!!desknets.browser.ipad;desknets.ajax.rest({async:!b,detectMultiError:true,dataType:desknets.ajax.RESTYPE_JSON,url:desknets.getUrl(desknets.flow.MODULE_API_FLOW),data:d,success:function(f,e,g){c(f)}})},_buildBody:function(i){var c=this;var g=null;var h;var b,f;b=i[0].html;f=i[1];f.bodyonly=c.mflg;g=a("<div>").append(b);a.each(g.children("script[type=text/x-jquery-tmpl]"),function(k,l){var j=a(l);j.template(j.attr("id"))});var e=a.tmpl("jflow-print-tmpl",f);var d=e.wrapAll("<div>").parent().html();a.each(g.children("script[type=text/x-jquery-tmpl]"),function(j,k){delete a.template[a(k).attr("id")]});return d},banpei:null});desknets.page(desknets.flow,"FlowInputBase",desknets.PageInputBase,{format:desknets.form.FormEditor.prototype,route:desknets.flow.RouteEditor.prototype,_restUrl:"",getMultiRequest:function(){var e={};var b=desknets.paramanalyzer.getHashParams();var d=b.id;if(!neo.isSet(d)){d=b.copyid}if(!neo.isSet(d)){d=""}e["0"]=b;e["1"]={cmd:this.getFormPartListCmd(),tmpno:this.getTempName(),id:d};e["2"]={cmd:this.getRouteNodeListCmd(),tmpno:this.getTempName(),id:d,type:this.getCmdType()};if(!!b.copyid){e["2"]["rcopy"]="1"}var c=desknets.attach.ext.getListParam();if(!!c){c.cmd=desknets.flow.getAttExtListCmd(c.cmd);e["3"]=c}return e},_initHtml:function(c){var b=this;if(c[1]["status"]!=desknets.RES_STATUS_SUCCESS){b.onError(c[1]["errorno"],c[1]["errormessage"]);return}if(c[2]["status"]!=desknets.RES_STATUS_SUCCESS){b.onError(c[2]["errorno"],c[2]["errormessage"]);return}b.callBase("_initHtml",c)},_initSet:function(d){var c=this;var b=[];var e={};if(!!d&&d["1"]){b=desknets.ajax.getJsonItems(d["1"])}if(!!d&&d["2"]){e={route:desknets.flow.route.getRouteFromJson(d["2"])}}a.extend(e,c.getRouteOptionsForParams());c._setUpEditorTabs(b,e);if(!!d&&d["3"]){desknets.attach.ext.saveList(d["3"])}c._setTmpNm();c.callBase("_initSet")},_setTmpNm:function(){var b=this;b.$mjPage.find('input[name="tmpno"]').val(b.getTempName())},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.beforeSerialize=function(d,e){var f={format:b._getFormRequestParams(),route:b._getRouteRequestParams()};e.data=a.extend(f,e.data)};return c},_inputButton:function(){this.callBase("_inputButton");var b=this;this.$mjPage.find(".jflow-preview").hide();this.$mjPage.find(".jform-input-preview").click(function(){b._startPreview()});this.$mjPage.find(".jform-input-preview-end").click(function(c){c.preventDefault();b._endPreview()})},_getRestModule:function(){return desknets.flow.MODULE_API_FLOW},getFormPartListCmd:function(){return""},getRouteNodeListCmd:function(){return""},getCopyRouteListCmd:function(){return desknets.flow.CMD_FLOWROUTELIST},getCopyRouteNodeCmd:function(){return""},getTempName:function(){return""},getFormatOptionsForParams:function(){var j=this;var h=desknets.paramanalyzer.getHashParams();var g=this.getTempName();var d=desknets.getUrl(desknets.flow.MODULE_MAIN_FLOW);var e=d+"?cmd="+desknets.flow.CMD_FLOWTMPFILEDISPATTACH;var c=d+"?cmd="+desknets.flow.CMD_FLOWEDITFORMATDISPTMPATTACH;var i=desknets.getUrl(desknets.flow.MODULE_MAIN_FLOW)+"?cmd="+desknets.flow.CMD_FLOWEDITFORMATDISPTMPATTACH+"&fno={{id}}&filename={{name}}";var b={uploadURL:this._getRestUrl(),uploadParams:{cmd:desknets.flow.CMD_FLOWEDITFORMATADDATTACH},delURL:this._getRestUrl(),delParams:{cmd:desknets.flow.CMD_FLOWEDITFORMATDELATTACH},downloadURL:c+"&tmpnm={{tmpnm}}&fno={{id}}&filename={{name}}",};var f=j.getAttachSizeLimit();if(!!f){b.totalSizeLimit=Number(f)}return{attachOptions:b,paramsForSave:{tmpno:g,cmd:desknets.flow.CMD_FORMPART_ADD},paramsForRemove:{tmpno:g,cmd:desknets.flow.CMD_FORMPART_REMOVE},paramsForOpen:{tmpno:g,cmd:"flowcmdeditformatpart"},attachDownloadURL:e+"&tmpno="+g+"&id={{id}}&fno={{fno}}&filename={{name}}"}},getRouteOptionsForParams:function(){var b=this;var c=b.getTempName();return{restUrl:b._getRestUrl(),getFormParts:function(){return b.format.getParts()},paramsForAdd:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_ADD},paramsForRemove:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_REMOVE},paramsForTitle:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_MODTITLE},paramsForCondition:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_MODCOND},paramsForUser:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_MODUSER},paramsForGroup:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_MODGROUP},paramsForRole:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_MODROLE},paramsForApprovalName:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_ANAME},paramsForApprovalUsers:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_MODAUSERS},paramsForRemoveApprovalUser:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_REMOVEAUSERS},paramsForBranch:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_MODBRANCH},paramsForHierarchy:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_MODHIERARCHY},paramsForExceptApplicant:{tmpno:c,cmd:desknets.flow.CMD_ROUTENODE_MODEXCEPTAPPLICANT}}},getCmdType:function(){return""},getAttachSizeLimit:function(){var b=this;return b.$mjPage.find('input[name="attach-totalSizeLimit"]').val()},getPreviewGid:function(){return""},_setUpEditorTabs:function(d,f){var c=this,b=this.$mjPage.find(".flow-editor-tabs");var g=a(".jflow-entry-main-area").find(".flow-editor-tabs").find(".ui-tabs-nav").children();var e=0;g.each(function(){var h=a(this);if(h.hasClass("ui-tabs-selected")){return false}e++});b.tabs({selected:e});this._setUpFormatEditor(d,function(){c._setUpRouteEditor(f)});a(".jflow-entry-main-area").hide();a(".jflow-entry-form-area").show()},_setUpFormatEditor:function(d,f){var c=this;var b=a(c._setUpFormatEditorArea());var e=a.extend({restUrl:this._getRestUrl(),parts:d,load:f},this.getFormatOptionsForParams());this.format=new desknets.form.FormEditor(b,e)},_setUpFormatEditorArea:function(){return"#flow-edit-format"},_getFormRequestParams:function(){var b=[],c=this.format.getParts();a.each(c,function(f,d){if(!!d.id){var e=d.br||"0";b.push(d.id+":"+e)}});return b},_setUpRouteEditor:function(c){var b=this;var d=this.$mjPage.find(".jflow-editor-route");b.route=new desknets.flow.RouteEditor(d,c);this.$mjPage.find(".jflow-route-copy-button").click(function(){b._openRouteChooser()})},_openRouteChooser:function(){var b=this;desknets.flow.route.routeList.openChooser({url:b._getRestUrl(),params:{cmd:b.getCopyRouteListCmd()},choose:function(d,c){b._loadCopySourceRoute(d,c)}})},_loadCopySourceRoute:function(d,c){var b=this;desknets.ajax.rest({url:this._getRestUrl(),data:{cmd:this.getCopyRouteNodeCmd(),id:d,tmpno:b.getTempName(),type:c,mode:"copy"},success:function(f){var e=desknets.flow.route.getRouteFromJson(f);b.route.setRoute(e)}})},_getRouteRequestParams:function(){var b=this.route.getRoute();return desknets.flow.route.getRequestParamFromRoute(b)},_startPreview:function(){var b=this,c=[];c.push({cmd:desknets.flow.CMD_FLOWEDITFORMATSETSORT,tmpno:this.getTempName(),values:this._getFormRequestParams()});c.push({cmd:desknets.flow.CMD_FLOWAPPLICATEPREVIEW,formType:"1",tmpno:this.getTempName()});c.push({cmd:desknets.flow.CMD_FLOWEDITROUTESETSORT,tmpno:this.getTempName(),values:this._getRouteRequestParams()});c.push({cmd:desknets.flow.CMD_FLOWEDITROUTE,tmpno:this.getTempName(),preview:"1",gid:this.getPreviewGid()});desknets.ajax.rest({url:this._getRestUrl(),detectMultiError:true,data:desknets.ajax.arrayToMultiCmdData(c),success:function(d){b._showPreview(d)}})},_showPreview:function(d){var e=this.$mjPage.find(".jco-disp-disparea");e.empty();var c={};c.memo=d["1"].html;this.$mjPage.find(".jflow-tmpl-preview").tmpl(c).appendTo(e);var f=d["3"];f.entry=desknets.pageframe.getLoginName();desknets.flow.preparedCmdDispRest(f);this.$mjPage.find(".jflow-disp-tmplset-notices-list").tmpl(f).appendTo(e);this.$mjPage.find(".jflow-editor").hide();this.$mjPage.find(".jflow-preview").show();var b=a("#flow-m-title").text()+a("#jco-m-sub-title").text()+" > "+this.$mjPage.find(".jflow-title-edit").val()+" > "+desknets.Resource.preview;a("#jco-m-sub-title").text(b);desknets.moveScroll()},_endPreview:function(){this.$mjPage.find(".jflow-preview").hide();this.$mjPage.find(".jflow-editor").show();this._setTitle(this._getAreaTitle(this.$mjPage));desknets.moveScroll()},_getRestUrl:function(){if(!this._restUrl){this._restUrl=desknets.getUrl(this._getRestModule())}return this._restUrl}});desknets.page(desknets.flow,"flowindex",desknets.PageListBase,{_mFlowListTemplate:{},$_mFlowTableList:{},_approvableids:[],_mDelFlg:"",$mForcedEndDialog:null,_mboOverErrView:true,_mboOverErr:false,_hashUpdatePageView:function(c){var b=this;if(c==desknets.flow.PAGE_FLOWSEARCH){desknets.flow.flowsearch.initPage(desknets.flow.PAGE_FLOWLIST,"jco-m-list-container");b.mhashBackErrCmd=b.mhashBackCmd;b.mhashIdErrBack=b.mhashIdBack;b.mhashBackCmd=desknets.flow.PAGE_FLOWSEARCH;b.mhashIdBack="jco-m-search-container"}},_hashUpdateDispPage:function(){var d=this;var b;var c=desknets.paramanalyzer.getHashParams();var f=d.mhashBackCmd;var e=d.mhashIdBack;if(c.mode=="history"){f=desknets.flow.PAGE_FLOWDISP;e="jco-m-disp-page"}b=d._getListDispClass();b.initPage(f,e)},_listPage:function(c){var b=this;if(c=="0"){desknets.pageframe.closeTopMsg()}b.callBase("_listPage",c)},_initListStartTemplate:function(){var b=this;b.$_mFlowTableList["flow-recv"]=b.$mjListPage.find(".flow-recv").find(".co-tbody-list");b.$_mFlowTableList["flow-end"]=b.$mjListPage.find(".flow-end").find(".co-tbody-list");b.$_mFlowTableList["flow-send"]=b.$mjListPage.find(".flow-send").find(".co-tbody-list");b.$_mFlowTableList["flow-draf"]=b.$mjListPage.find(".flow-draf").find(".co-tbody-list");b._mFlowListTemplate["flow-recv"]=b.$_mFlowTableList["flow-recv"].html();b._mFlowListTemplate["flow-end"]=b.$_mFlowTableList["flow-end"].html();b._mFlowListTemplate["flow-send"]=b.$_mFlowTableList["flow-send"].html();b._mFlowListTemplate["flow-draf"]=b.$_mFlowTableList["flow-draf"].html();b.$mjTableList.empty()},_getListAjaxSuccess:function(d){var c=this;var b=desknets.paramanalyzer.getHashParams();if(neo.isSet(d.approvables)){c._approvableids=d.approvables.split(",")}else{c.approvableClean()}if(neo.isSet(b,{blank:false})&&neo.isSet(b.fid,{blank:false})&&neo.isSet(b.stsid,{blank:false})){if(b.fid=="0"&&b.stsid=="0"){c._mcListTemplate=c._mFlowListTemplate["flow-recv"];c.$mjTableList=c.$_mFlowTableList["flow-recv"]}else{if(b.fid=="0"&&b.stsid=="1"){c._mcListTemplate=c._mFlowListTemplate["flow-end"];c.$mjTableList=c.$_mFlowTableList["flow-end"]}else{if(b.fid=="0"&&b.stsid=="4"){c._mcListTemplate=c._mFlowListTemplate["flow-end"];c.$mjTableList=c.$_mFlowTableList["flow-end"]}else{if(b.fid=="0"&&b.stsid=="2"){c._mcListTemplate=c._mFlowListTemplate["flow-end"];c.$mjTableList=c.$_mFlowTableList["flow-end"]}else{if(b.fid=="2"&&b.stsid=="0"){c._mcListTemplate=c._mFlowListTemplate["flow-send"];c.$mjTableList=c.$_mFlowTableList["flow-send"]}else{if(b.fid=="2"&&b.stsid=="1"){c._mcListTemplate=c._mFlowListTemplate["flow-send"];c.$mjTableList=c.$_mFlowTableList["flow-send"]}else{if(b.fid=="3"){c._mcListTemplate=c._mFlowListTemplate["flow-draf"];c.$mjTableList=c.$_mFlowTableList["flow-draf"]}else{c._mcListTemplate=c._mFlowListTemplate["flow-recv"];c.$mjTableList=c.$_mFlowTableList["flow-recv"]}}}}}}}}else{c._mcListTemplate=c._mFlowListTemplate["flow-recv"];c.$mjTableList=c.$_mFlowTableList["flow-recv"]}c.$_mFlowTableList["flow-recv"].empty();c.$_mFlowTableList["flow-end"].empty();c.$_mFlowTableList["flow-send"].empty();c.$_mFlowTableList["flow-draf"].empty();c.callBase("_getListAjaxSuccess",d)},_listSortLink:function(){var c=this;var d={};var b=null;d=a.extend({},c._mobjParams,desknets.paramanalyzer.getHashParams());var e=c.$mjListPage.find(".co-list-sort-item").find(".co-list-sort-data");e.removeClass("asc");e.removeClass("desc");e.each(function(){b=a(this);if(b.data("sort")==d.fldsort){if(d.order=="1"){b.addClass("asc")}else{b.addClass("desc")}return false}});if(d.fid=="0"&&d.stsid=="0"){e=c.$mjListPage.find(".flow-recv").find(".co-table-list").find(".co-list-sort-data")}else{if(d.fid=="0"&&d.stsid=="1"){e=c.$mjListPage.find(".flow-end").find(".co-table-list").find(".co-list-sort-data")}else{if(d.fid=="0"&&d.stsid=="4"){e=c.$mjListPage.find(".flow-end").find(".co-table-list").find(".co-list-sort-data")}else{if(d.fid=="0"&&d.stsid=="2"){e=c.$mjListPage.find(".flow-end").find(".co-table-list").find(".co-list-sort-data")}else{if(d.fid=="2"&&d.stsid=="0"){e=c.$mjListPage.find(".flow-send").find(".co-table-list").find(".co-list-sort-data")}else{if(d.fid=="2"&&d.stsid=="1"){e=c.$mjListPage.find(".flow-send").find(".co-table-list").find(".co-list-sort-data")}else{if(d.fid=="3"){e=c.$mjListPage.find(".flow-draf").find(".co-table-list").find(".co-list-sort-data")}else{e=c.$mjListPage.find(".flow-recv").find(".co-table-list").find(".co-list-sort-data")}}}}}}}e.removeClass("asc");e.removeClass("desc");e.each(function(){b=a(this);if(b.data("sort")==d.fldsort){if(d.order=="1"){b.addClass("asc")}else{b.addClass("desc")}return false}})},_getListAjaxSuccessOtherSet:function(c){var b=this;b.callBase("_getListAjaxSuccessOtherSet",c);b._mboOverErr=false;if(neo.isSet(c[desknets.RES_TAG_MSGGETLIMIT])){b._mboOverErr=true;if(this._mboOverErrView){this._mboOverErrView=false;desknets.pageframe.viewTopMsg(c[desknets.RES_TAG_MSGGETLIMIT],"info")}}},_getListAjaxSuccessEnd:function(){var e=this;e.callBase("_getListAjaxSuccessEnd");var f="";var d=e.$mjListPage.find("form");var c=desknets.paramanalyzer.getHashParams();if(neo.isSet(c,{blank:false})&&neo.isSet(c.fid,{blank:false})&&neo.isSet(c.stsid,{blank:false})){if(c.fid=="0"&&c.stsid=="0"){f="1";d.removeClass().addClass("flow-area-recv");e.$mjListPage.find(".co-actionarea").find(".jflow-list-cancel").show();e.$mjListPage.find(".co-actionarea").find(".jflow-list-cancel").prev("span").show()}else{if(c.fid=="0"&&c.stsid=="1"){f="2";d.removeClass().addClass("flow-area-end");a(".flow-end").removeClass("flow-recv-scheduled")}else{if(c.fid=="0"&&c.stsid=="4"){f="3";d.removeClass().addClass("flow-area-end");a(".flow-end").addClass("flow-recv-scheduled")}else{if(c.fid=="0"&&c.stsid=="2"){f="4";d.removeClass().addClass("flow-area-end");a(".flow-end").removeClass("flow-recv-scheduled")}else{if(c.fid=="2"&&c.stsid=="0"){f="5";d.removeClass().addClass("flow-area-send");e.$mjListPage.find(".co-actionarea").find(".jflow-list-cancel").show();e.$mjListPage.find(".co-actionarea").find(".jflow-list-cancel").prev("span").show()}else{if(c.fid=="2"&&c.stsid=="1"){f="6";d.removeClass().addClass("flow-area-send");e.$mjListPage.find(".co-actionarea").find(".jflow-list-cancel").hide();e.$mjListPage.find(".co-actionarea").find(".jflow-list-cancel").prev("span").hide()}else{if(c.fid=="3"){f="7";d.removeClass().addClass("flow-area-draf")}}}}}}}e.$mjListPage.find("#flow-list-type-sel").val(f)}else{f="1";d.removeClass().addClass("flow-area-recv");e.$mjListPage.find(".co-actionarea").find(".jflow-list-cancel").show();e.$mjListPage.find(".co-actionarea").find(".jflow-list-cancel").prev("span").show();e.$mjListPage.find("#flow-list-type-sel").val(f)}var b=a("#jco-m-sub-title").text()+" > "+e.$mjListPage.find("#flow-list-type-sel").find("option:selected").text();a("#jco-m-sub-title").text(b)},_initListStartModLink:function(){var b=this},_updateListCheckState:function(b){var c=this;c.callBase("_updateListCheckState",b);var d=this.$mjListPage.find(".co-chk-cnt-some");if(c._mboOverErr){d.find("a").hide()}else{d.find("a").show()}},_initListStart:function(){var b=this;b.callBase("_initListStart");desknets.flow.ForcedEndDialog.init()},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b._initListEndButtonFlow()},_initListEndButtonFlow:function(){var b=this;b.$mjListPage.find("#flow-list-type-sel").change(function(e){var f=a(this).val();var d=b.$mjListPage.find(".jco-back-page-data");var c=b.$mjListPage.find("form");a(e.target).blur();if(f=="1"){d.find('input[name="fid"]').val("0");d.find('input[name="stsid"]').val("0")}else{if(f=="2"){d.find('input[name="fid"]').val("0");d.find('input[name="stsid"]').val("1")}else{if(f=="3"){d.find('input[name="fid"]').val("0");d.find('input[name="stsid"]').val("4")}else{if(f=="4"){d.find('input[name="fid"]').val("0");d.find('input[name="stsid"]').val("2")}else{if(f=="5"){d.find('input[name="fid"]').val("2");d.find('input[name="stsid"]').val("0")}else{if(f=="6"){d.find('input[name="fid"]').val("2");d.find('input[name="stsid"]').val("1")}else{if(f=="7"){d.find('input[name="fid"]').val("3");d.find('input[name="stsid"]').val("-1")}}}}}}}if(f=="1"){d.find('input[name="fldsort"]').val("days_elapsed");d.find('input[name="order"]').val("-1")}else{d.find('input[name="fldsort"]').val("entrydate");d.find('input[name="order"]').val("-1")}b._mboOverErrView=true;b._listPage("0")});b.$mjListPage.find(".jflow-list-del").click(function(c){c.preventDefault();b._mDelFlg="0";b._listDelSubmit(c)});b.$mjListPage.find(".jflow-list-unread").click(function(c){c.preventDefault();b._mDelFlg="1";b._listDelSubmit(c)});b.$mjListPage.find(".jflow-list-cancel").click(function(c){c.preventDefault();b._mDelFlg="2";b._listDelSubmit(c)})},_listLineCmd:function(c){var b=desknets.paramanalyzer.getHashParams();if(b.fid==="3"){return desknets.tmpl.replaceWord(c,"cmd",this._getListModCmd())}return desknets.tmpl.replaceWord(c,"cmd",this._getListDispCmd())},_replaceListLine:function(c,f,d){var b=this;var e=b.replaceFlowListLine(c,f,d);if(e!=null){return e}return b.callBase("_replaceListLine",c,f,d)},replaceFlowListLine:function(c,e,d){var b=this;if(e=="important"){c=b.replaceFlowListLineImportant(c,e,d)}else{if(e=="attachcnt"){c=b.replaceFlowListLineAttach(c,e,d)}else{if(e=="days_elapsed"){c=b.replaceFlowListLineDaysElapsed(c,e,d)}else{if(e=="elapsed_warn_flg"){c=b.replaceFlowListLineElapsedWarnFlg(c,e,d)}else{if(e=="status"){c=b.replaceFlowListLineStatus(c,e,d)}else{if(e=="applicantgroup"){c=b.replaceFlowListLineApplicantGroup(c,e,d)}else{if(e=="createdatetime"){c=b.replaceFlowListLineCreTime(c,e,d)}else{if(e=="unreadflg"){c=b.replaceFlowListLineUnreadflg(c,e,d)}else{return null}}}}}}}}return c},replaceFlowListLineImportant:function(d,g,e){var c=this;var f="";var b="";if(e[g]=="1"){f="haste";b=desknets.Resource.importance_highest}else{if(e[g]=="2"){f="high";b=desknets.Resource.importance_high}else{if(e[g]=="3"){f="";b=""}else{if(e[g]=="4"){f="low";b=desknets.Resource.importance_low}}}}d=desknets.tmpl.replaceWord(d,"importantclass",f);d=desknets.tmpl.replaceWord(d,g,b);return d},replaceFlowListLineAttach:function(d,g,e){var c=this;var f="";var b="";if(parseInt(e[g],10)>0){f="on";b=desknets.Resource.attachLabel}d=desknets.tmpl.replaceWord(d,"attachcntclass",f);d=desknets.tmpl.replaceWord(d,g,b);return d},replaceFlowListLineDaysElapsed:function(d,f,e){var c=this;var b=desknets.Resource.flow.elapsedday;b=desknets.tmpl.replaceWord(b,"day",e[f]);d=desknets.tmpl.replaceWord(d,f,b);return d},replaceFlowListLineElapsedWarnFlg:function(d,f,e){var c=this;var b="";if(e[f]=="1"){b="warn"}return desknets.tmpl.replaceWord(d,f,b)},replaceFlowListLineStatus:function(d,g,e){var c=this;var f="";var b="";if(e[g]=="2"){f="";b=desknets.Resource.flow.wait_approval}else{if(e[g]=="3"||e[g]=="9"){f="rejected";b=desknets.Resource.flow.rejected}else{if(e[g]=="4"){f="";b=desknets.Resource.flow.approval}else{if(e[g]=="6"){f="";b=desknets.Resource.flow.revocation}else{if(e[g]=="7"){f="";b=desknets.Resource.flow.revocation}else{if(e[g]=="8"){f="";b=desknets.Resource.flow.revocation}else{if(e[g]=="10"){f="";b=desknets.Resource.flow.forcedend}}}}}}}d=desknets.tmpl.replaceWord(d,"statusclass",f);d=desknets.tmpl.replaceWord(d,g,b);return d},replaceFlowListLineApplicantGroup:function(d,f,e){var c=this;var b="";if(neo.isSet(e[f],{blank:false})){b=" ["+e[f]+"]"}return desknets.tmpl.replaceWord(d,f,b)},replaceFlowListLineCreTime:function(c,e,d){var b=this;return desknets.tmpl.replaceWord(c,e,desknets.dateTime.dispDateTime(d[e],{type:"list"}))},replaceFlowListLineUnreadflg:function(c,f,d){var b=this;var e="";if(d[f]=="1"){e="unread"}c=desknets.tmpl.replaceWord(c,"unreadflg",e);return c},_delNoChkMessage:function(){var b=this;if(b._mDelFlg=="1"){return desknets.Resource.Message.flow_unread_nochecked}else{if(b._mDelFlg=="2"){return desknets.Resource.Message.flow_cancel_nochecked}else{return this.callBase("_delNoChkMessage")}}},_delConfMessage:function(){var c=this;var b="";if(c._mDelFlg=="2"){if(c.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.flow_cancel_all}else{if(c.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.flow_cancel_some}else{b=desknets.Resource.Message.flow_cancel_list}}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())}else{if(c._mDelFlg=="1"){return null}}return this.callBase("_delConfMessage")},_setDelConfirm:function(c){var b=this;if(b._mDelFlg=="1"){b._listDel(true,null)}else{if(b._mDelFlg=="2"){b._openForcedEndDialog(c)}else{b.callBase("_setDelConfirm",c)}}},_openForcedEndDialog:function(c){var b=this;desknets.flow.ForcedEndDialog.setDlgTtile(b._getForcedEndDlgTitle());desknets.flow.ForcedEndDialog.setDlgMessage(c);desknets.flow.ForcedEndDialog.setDlgCallback(a.proxy(b.execForcedEnd,b));desknets.flow.ForcedEndDialog.open()},_getForcedEndDlgTitle:function(){var b=this;if(b._mDelFlg=="2"){return desknets.Resource.flow.revocation}return""},execForcedEnd:function(c){var b=this;b.$mForcedEndDialog=c;b._listDel(true,c)},_getDispPageParam:function(){var b=this;var d=b._getFid();var c={};if(d==desknets.flow.FID_SEND){c.mode="send"}return c},_boDelSingle:function(){return true},_getDelAddPrm:function(){var c=this;var d={};var e={};var b=desknets.paramanalyzer.getHashParams();if(this.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){var f=this.getListParamToObj();e.lcmd=desknets.flow.CMD_FLOWLIST;e.fid=f.fid;e.stsid=f.stsid;if(!neo.isSet(e.fid,{blank:false})){e.fid="0"}if(!neo.isSet(e.stsid,{blank:false})){e.stsid="0"}}if(c._mDelFlg=="0"){if(b.fid=="3"){delete e.lcmd}a.extend(d,e)}else{if(c._mDelFlg=="1"){a.extend(d,e)}else{if(c._mDelFlg=="2"){a.extend(d,e);if(c.$mForcedEndDialog){d.memo=c.$mForcedEndDialog.find("textarea").val()}}}}return d},_getRestModule:function(){return desknets.flow.MODULE_API_FLOW},_getListCmd:function(){return desknets.flow.PAGE_FLOWLIST},_getListExecCmd:function(){return desknets.flow.CMD_FLOWLIST},_getListDispCmd:function(){return desknets.flow.PAGE_FLOWDISP},_getListAddCmd:function(){return desknets.flow.PAGE_FLOWENTRY},_getListModCmd:function(){return desknets.flow.PAGE_FLOWENTRY},_getDelCmd:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();if(c._mDelFlg=="0"){if(b.fid=="3"){return""}else{if(b.fid=="2"){return desknets.flow.CMD_FLOWCMDDELCONF}}return desknets.flow.CMD_FLOWCMDNOTICEDELCONF}else{if(c._mDelFlg=="2"){return desknets.flow.CMD_FLOWCANCELCONF}}return""},_getDelExecCmd:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();if(c._mDelFlg=="0"){if(b.fid=="3"){return desknets.flow.CMD_FLOWCMDDRAFTDEL}else{if(b.fid=="2"){return desknets.flow.CMD_FLOWCMDDEL}}return desknets.flow.CMD_FLOWCMDNOTICEDEL}else{if(c._mDelFlg=="1"){return desknets.flow.CMD_FLOWUNREAD}else{if(c._mDelFlg=="2"){return desknets.flow.CMD_FLOWCANCEL}}}return""},_getListDispClass:function(){return desknets.flow.flowdisp},_getListEntryClass:function(){return desknets.flow.flowentry},_getListModClass:function(){return desknets.flow.flowentry},approvableClean:function(){var b=this;b._approvableids=[]},approvableNext:function(e){var b=this;var c=b._approvableids.length;for(var d=0;d<c;d++){if(e==b._approvableids[d]){if(d+1<c){return b._approvableids[d+1]}return""}}return""},approvableBack:function(e){var b=this;var c=b._approvableids.length;for(var d=0;d<c;d++){if(e==b._approvableids[d]){if(d-1>=0){return b._approvableids[d-1]}return""}}return""},approvableDel:function(e){var b=this;var c=b._approvableids.length;for(var d=0;d<c;d++){if(e==b._approvableids[d]){break}}if(d<c&&d>=0){b._approvableids.splice(d,1)}},});desknets.page(desknets.flow,"flowentry",desknets.PageInputBase,{_mmode:"",_mboRouteDef:false,tmpfileChanged:null,parts:{},getMultiRequest:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();var d=c.callBase("getMultiRequest");var e=desknets.attach.ext.getListParam();if(neo.isSet(b.id,{blank:false})){d["1"]=c.getFormatPrm();d["2"]=c.getRoutetPrm()}if(!!e){e.cmd=desknets.flow.getAttExtListCmd(e.cmd);if(neo.isSet(b.id,{blank:false})){d["3"]=e}else{d["1"]=e}}return d},getFormatPrm:function(){var b=this;var c={};c.cmd=desknets.flow.CMD_FLOWAPPLICATEPREVIEW;c.tmpno=b.getTempName();c.formType="2";return c},getRoutetPrm:function(){var b=this;var c={};c.cmd=desknets.flow.CMD_FLOWEDITROUTE;c.tmpno=b.getTempName();return c},_initGetHtml:function(){var b=this;var c={};c.success=function(d){if(d[0]["status"]!=desknets.RES_STATUS_SUCCESS){b.onErrorEntry(d[0]["errorno"],d[0]["errormessage"])}else{b._initHtml(d)}};c.complete=function(f,d,e){b.CompleteExec()};b._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,null,c)},_initHtml:function(d){var c=this;var b=desknets.paramanalyzer.getHashParams();if(neo.isSet(b.id,{blank:false})){if(d[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[1]["errorno"],d[1]["errormessage"]);return}if(d[2]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[2]["errorno"],d[2]["errormessage"]);return}}c.callBase("_initHtml",d)},onErrorEntry:function(c,e){var b=this;b.resetFuncBeforeHashChange();var f=desknets.dialog.alert(e,{errorNo:c});var g=desknets.parseErrorInfo(e,c);var d={close:function(h){desknets.dialog.deleteById(g.level);b.dispBackEntry()}};f.dialog(d)},dispBackEntry:function(){var b=this;var d=desknets.paramanalyzer.getHashParams();if(!!d.mode&&d.mode=="reapply"){var c={};c.cmd="flowdisp";c.id=d.id;b._setLocationHash(c)}else{b.dispBackListPage()}},_initSet:function(e){var k=this;var j=desknets.paramanalyzer.getHashParams();var b="";var d=null;k.$mjPage.find(".jflow-entry-main-area").show();k.$mjPage.find(".jflow-entry-form-area").hide();k.tmpfileChanged=false;if(neo.isSet(j.id,{blank:false})){if(!!e["3"]){desknets.attach.ext.saveList(e["3"])}}else{if(!!e["1"]){desknets.attach.ext.saveList(e["1"])}}k._mmode=k.$mjPage.find('input[name="mode"]').val();if(k._mmode==""){k._mmode="add"}if(k._mmode=="reapply"){k._mboRouteDef=true}else{k._mboRouteDef=false}desknets.flow.flowentryform.mboInit=false;desknets.flow.flowentryform.mboFormNotChg=false;desknets.flow.flowentryform.mboRouteNotChg=k._mboRouteDef;k.$mjPage.find(".jflow-input-action-tmplset").tmpl({mode:k._mmode}).appendTo("#"+k._getIdPage()+" .jflow-input-action");k.$mjPage.find(".jflow-input-body-tmplset").tmpl({mode:k._mmode}).appendTo("#"+k._getIdPage()+" .jflow-input-body");k._setUpAttach();if(neo.isSet(j.fid,{blank:false})){b=j.fid;var c=k.$mjPage.find(".jflow-combox-subject");var h=c.find(".co-combox-item");h.each(function(){if(a(this).data("id")==j.fid&&a(this).data("type")=="pub"){d=a(this);return false}});if(!!d){k._setFormatInfo(d.data("id"),"","pub")}}if(k._mmode!="reapply"){k._setUpApplicate();if(!!d){var g=k.$mjPage.find(".co-combox-item.on").text();k.$mjPage.find(".jco-input-subject").val(g)}k._setUpNo()}k._setUpGrp();k._setUpSetMail();k._setUpEditorTabs();k._setTmpNm();if(!!d){k._execSetFormatCmd(d.data("id"),"","pub")}else{var i="";if(neo.isSet(j.id,{blank:false})){i=e["1"].html;k.parts=desknets.ajax.getJsonItems(e["1"])}k.setUpFormat(i);var f={};if(neo.isSet(j.id,{blank:false})){f=e["2"]}k.setUpRoute(f);if(k.$mjPage.find("[name=formattype]").val()=="pub"){k.getFormatType()}else{k.setUpEntry({},true)}}k.callBase("_initSet")},getFormatType:function(){var b=this;var c={};c.cmd="flowcmdentryselectform";c.id=b.$mjPage.find("[name=formatid]").val();c.type=b.$mjPage.find("[name=formattype]").val();c.mode=b._mmode;desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),data:c,detectMultiError:true,success:function(e,d,f){b.setUpEntry(e,true)},complete:function(f,d,e){},traditional:true})},_inputButton:function(){var b=this;b.callBase("_inputButton");b.$mjPage.find(".jflow-preview").hide();b.$mjPage.find(".jflow-entry-main-area").find(".jform-input-preview").click(function(c){c.preventDefault();b._startPreview()});b.$mjPage.find(".jflow-entry-main-area").find(".jform-input-preview-end").click(function(c){c.preventDefault();b._endPreview()});b.$mjPage.find(".jflow-entry-form").click(function(){var c={autosave:false};if(b.boautosave){c.autosave=true}desknets.flow.flowentryform.init(c)});b.$mjPage.find(".jflow-input-confirm").click(function(c){c.preventDefault();b._pageConfirm()})},setUpFormat:function(d,b){var c=this;if(b!==true&&c.boautosave){desknets.autosave.formatsave()}var e=c.$mjPage.find("#flow-view-detail-in");e.html(!!d?d:"");if(e.children().length<=0&&!e.text().match(/[^\x20]+/m)){e.html("<p>"+desknets.Resource.Message.flow_selectformat+"</p>")}else{c._initDnForm()}},_initDnForm:function(){var c=this;var e=c.$mjPage.find("#flow-view-detail-in");var b=c.$mjPage.find("#jfow-entry-totalSizeLimit").val();var d=function(l){var h=l.attr("data-id");var f={cmd:desknets.flow.CMD_FLOWTMPFILEADDATTACH,id:h};var k={cmd:desknets.flow.CMD_FLOWTMPFILEDELATTACH,id:h};var g={cmd:desknets.flow.CMD_FLOWTMPFILEDISPATTACH};var j=desknets.getUrl(desknets.flow.MODULE_MAIN_FLOW)+"?"+a.param(g)+"&fno={{id}}&filename={{name}}&tmpno="+desknets.flow.TEMPFILE_FLOWENTRY+"&id="+h;var i={uploadURL:desknets.getUrl(desknets.flow.MODULE_API_FLOW),uploadParams:f,delURL:desknets.getUrl(desknets.flow.MODULE_API_FLOW),delParams:k,downloadURL:j};return i};desknets.form.initForm(e,d,b)},setUpRoute:function(d){var c=this;c.$mjPage.find("#flow-entry-route").empty();var e={};if(!!d){e={route:desknets.flow.route.getRouteFromJson(d),}}e.view=true;e.branch=true;e.getFormParts=function(){return c.parts};var b=new desknets.flow.RouteEditor(c.$mjPage.find("#flow-entry-route"),e);c.$mjPage.find("#flow-entry-route").find(".flow-route-node-modify-button").removeClass("flow-route-node-modify-button")},_setUpApplicate:function(){var c=this;var h=c.$mjPage.find(".jflow-combox-subject");var d=desknets.Resource.flow.subject_def_name;var b='<li class="co-combox-item flow-subject-def" data-name="" data-type="def" data-id="">'+d+"</li>";c.$mjPage.find("#jco-combox-list-subject").prepend(b);var g=h.find(".co-combox-item");if(g.length==1){h.find(".co-combox-list").hide()}var i=h.find("input");g.click(function(){var k=a(this);if(c._formObserveisChanged()){var j="";if(k.data("type")=="def"){j=desknets.Resource.flow.sel_default_app}else{j=desknets.Resource.flow.sel_app}desknets.dialog.confirm(j,function(){c._setUpApplicateSel(k)})}else{c._setUpApplicateSel(k)}});var f=c.$mjPage.find('input[name="formatid"]').val();var e=c.$mjPage.find('input[name="formattype"]').val();g.each(function(){var j=a(this);if(j.data("type")==e&&j.data("id")==f){j.addClass("on")}if(j.data("type")=="usr"){a(this).html(desknets.Resource.shortprivate+" "+a(this).html())}})},_setUpApplicateSel:function(c){var b=this;var e=b.$mjPage.find(".jflow-combox-subject");var d=e.find(".co-combox-item");var f=e.find("input");f.val(c.attr("title"));d.removeClass("on");if(c.data("type")!="def"){c.addClass("on")}b._setFormatInfo(c.data("id"),c.data("name"),c.data("type"));desknets.popUp.hide(c);b._execSetFormatCmd(c.data("id"),c.data("name"),c.data("type"))},_setFormatInfo:function(e,c,d){var b=this;b.$mjPage.find("[name=formatid]").val(e);b.$mjPage.find("[name=formatname]").val(c);b.$mjPage.find("[name=formattype]").val(d)},_execSetFormatCmd:function(b,h,g){var j=this;var d={};d.cmd="flowcmdentryselectform";d.id=b;d.type=g;var f={};f.cmd=desknets.flow.CMD_FLOWSELECTFORMAT;f.id=b;f.tmpno=j.getTempName();f.type=g;var e={};e.cmd=desknets.flow.CMD_FLOWAPPLICATEPREVIEW;e.tmpno=j.getTempName();e.formType="2";var c={};c.cmd=desknets.flow.CMD_FLOWSELECTROUTE;c.id=b;c.tmpno=j.getTempName();c.type=g;c.rcopy="1";var i={};i["0"]=d;i["1"]=f;i["2"]=e;i["3"]=c;desknets.ajax.rest({url:desknets.getUrl(j._getRestModule()),detectMultiError:true,data:desknets.ajax.arrayToMultiCmdData(i),success:function(l,k,m){j.setUpEntry(l["0"]);j.setUpFormat(l["2"].html);j.parts=desknets.ajax.getJsonItems(l["2"]);j.setUpRoute(l["3"])},complete:function(m,k,l){},traditional:true})},setUpEntry:function(e,d){var c=this;var b=c.$mjPage.find("[name=formattype]").val();if(b=="pub"){if(neo.isSet(e.no,{blank:false})&&e.no!="0"){c.$mjPage.find(".jflow-no-chg").hide();c.$mjPage.find(".jflow-no-chg").find("select").val("").attr("disabled","disabled");c.$mjPage.find(".jflow-no-nochg").find("span").text(e.Name).show();c.$mjPage.find(".jflow-no-nochg").find('input[name="no"]').removeAttr("disabled").val(e.no);c.$mjPage.find(".jflow-no-nochg-noset").hide()}else{c.$mjPage.find(".jflow-no-chg").hide();c.$mjPage.find(".jflow-no-chg").find("select").val("").removeAttr("disabled");c.$mjPage.find(".jflow-no-nochg").find("span").text("").hide();c.$mjPage.find(".jflow-no-nochg").find('input[name="no"]').val("").attr("disabled","disabled");c.$mjPage.find(".jflow-no-nochg-noset").show()}if(d!==true){if(neo.isSet(e.endmail,{blank:false})){c.$mjPage.find('[name="endmail"]').val(e.endmail)}}if(e.form_chg_flg==="0"&&(e.route_chg_flg==="0"||c._mboRouteDef)){c.$mjPage.find(".jflow-entry-form").hide()}else{c.$mjPage.find(".jflow-entry-form").show()}if(e.form_chg_flg==="0"){desknets.flow.flowentryform.mboFormNotChg=true}else{desknets.flow.flowentryform.mboFormNotChg=false}if(e.route_chg_flg==="0"){desknets.flow.flowentryform.mboRouteNotChg=true}else{desknets.flow.flowentryform.mboRouteNotChg=c._mboRouteDef}}else{c.$mjPage.find(".jflow-entry-form").show();c.$mjPage.find(".jflow-no-chg").show();if(d===true){c.$mjPage.find(".jflow-no-chg").find("select").removeAttr("disabled")}else{c.$mjPage.find(".jflow-no-chg").find("select").val("").removeAttr("disabled")}c.$mjPage.find(".jflow-no-nochg").find("span").text("").hide();c.$mjPage.find(".jflow-no-nochg").find('input[name="no"]').val("").attr("disabled","disabled");c.$mjPage.find(".jflow-no-nochg-noset").hide();desknets.flow.flowentryform.mboFormNotChg=false;desknets.flow.flowentryform.mboRouteNotChg=c._mboRouteDef}if(b=="def"){c.$mjPage.find('[name="endmail"]').val("1");c.$mjPage.find("[name=formattype]").val("")}},_startPreview:function(){var c=this,g=[];var f={};var b=c.$mjPage.find("#inputfrm");f=b.formToArrayEx();f.cmd=desknets.flow.CMD_FLOWENTRYFROMRESAVE;f.tmpno=c.getTempName();g.push(f);var e={};e.cmd=desknets.flow.CMD_FLOWAPPLICATEPREVIEW;e.tmpno=c.getTempName();e.formType="3";g.push(e);var d={};d.cmd=desknets.flow.CMD_FLOWEDITROUTE;d.tmpno=c.getTempName();d.preview="1";if(c._mmode=="reapply"){d.gid=c.$mjPage.find("#flow-reapply-gid").val()}else{d.gid=c.$mjPage.find('select[name="gid"]').val()}g.push(d);desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),detectMultiError:true,data:desknets.ajax.arrayToMultiCmdData(g),success:function(h){if(c.boautosave){desknets.autosave.formatsave()}c._showPreview(h)}})},_showPreview:function(i){var j=this;var c=this.$mjPage.find(".jflow-entry-main-area").find(".jflow-entry-main-preview");c.empty();desknets.flow.preparedCmdDispRest(i["2"]);var g={};g.memo=i["1"].html;g.signs={};g.signs["item"]=[];g.route_list={};g.route_list["item"]=[];if(!!i["2"]["route_list"]["item"]){a.each(i["2"]["route_list"]["item"],function(m,l){var k={};k.id=m+1;k.type="0";g.signs["item"][m]=k})}else{i["2"]["route_list"]={};i["2"]["route_list"]["item"]=[]}desknets.flow.preparedCmdDispRest(g);var e=j.$mjPage.find('select[name="no"]');if(e.val()==""){g.no="";var h=j.$mjPage.find('input[name="no"]').val();if(neo.isSet(h)){g.no=j.$mjPage.find(".jflow-no-nochg").find("span").html()}}else{g.no=j.$mjPage.find('select[name="no"] option:selected').text()}if(j._mmode=="reapply"){g.entrygroup=j.$mjPage.find(".jflow-preview-grp-name").text()}else{g.entrygroup=j.$mjPage.find('[name="gid"] option:selected').text()}g.entry=desknets.pageframe.getLoginName();g.important=j.$mjPage.find('select[name="important"]').val();g.subject=j.$mjPage.find(".jco-input-subject").val();this.$mjPage.find(".jflow-tmpl-preview-input").tmpl(g).appendTo(c);var d={};var b=j.$mjPage.find(".jflow-attach-list").find(".co-selfile-scroll");if(b.find("tr").length>0){d.attach=b.html();j.$mjPage.find(".jflow-input-attach").tmpl(d).appendTo(c);j.$mjPage.find(".jflow-inputpreview-attach").find(".co-btn-close").hide()}i["2"]["entry"]=desknets.pageframe.getLoginName();this.$mjPage.find(".jflow-disp-tmplset-notices-list").tmpl(i["2"]).appendTo(c);this.$mjPage.find(".jflow-editor").hide();this.$mjPage.find(".jflow-preview").show();var f=a("#jco-m-sub-title").text()+" > "+desknets.Resource.preview;a("#jco-m-sub-title").text(f);desknets.moveScroll()},_endPreview:function(){this.$mjPage.find(".jflow-preview").hide();this.$mjPage.find(".jflow-editor").show();this._setTitle(this._getAreaTitle(this.$mjPage));desknets.moveScroll()},_getAreaTitle:function(b){return b.find(".jflow-title-edit").val()},active:function(){var c=this;desknets.submitform.clearDisabled(c.$mjPage.find("form"));c._setTitle(c._getAreaTitle(c.$mjPage));c.$mjPage.show();desknets.moveScroll();c._initBeforeUnload();var d=function(){return c.funcBeforeHashChange()};var b=a(window).data("hashobserver");if(b){b.beforeHashChangeFunc=d}},_pageConfirm:function(){var b=this;b._ajaxConfirmTmpGet()},_ajaxConfirmTmpGet:function(){var c=this;var b=c.$mjPage.find("#inputfrm");b.formSetUp("validate");if(b.find(".ui-invalid").length>0){return}var d=b.formToArrayEx();d.cmd=desknets.flow.CMD_FLOWCONFIRM;var e=this._inputAjaxFormOption();a.extend(e,{dataType:desknets.ajax.RESTYPE_JSON,url:desknets.getUrl(this._getRestModule()),data:d,success:function(h,f,j){var g=h.html;var i=h;c._buildConfirmPage(g,i)},complete:function(h,f,g){}});desknets.ajax.rest(e)},_buildConfirmPage:function(c,d){var b=this;var e=desknets.paramanalyzer.getHashParams();var f=e.mode;d.mode=f;if(d.attach){d.attach["item"]=b._getArrayFromObject(d.attach["item"])}if(d.routes){d.routes["item"]=b._getArrayFromObject(d.routes["item"])}b.$mjPage.hide();desknets.flow.flowconfirm.init({tmpl:c,data:d,ok:function(h){var g=b.$mjPage.find("#inputfrm");g.find(":hidden[name=confirm]").remove();g.find(":hidden[name=cmd]").val(desknets.flow.CMD_FLOWENTRY);g.submit()},cancel:function(g){desknets.flow.flowconfirm.destroy();b.active()}})},_getArrayFromObject:function(c){var b=[];if(c){if(a.isArray(c)){a.each(c,function(d,e){b.push(e)})}else{b.push(c)}}else{b=[]}return b},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.success=function(f,d,g){if(b.mBackCmd==desknets.flow.PAGE_FLOWSEARCH){desknets.flow.flowsearch._onSrchExec=true}if(!!f.noticeerror){var h={extraMessage:f.noticeerror,extraClass:"co-msg-r",type:"warn"};var e=desknets.dialog.alert(f.msg,h);e.bind("dialogclose",function(i){desknets.dialog.deleteById("warn");b._setLocationHashForm()})}else{b._setLocationHashForm()}};return c},_setUpAttach:function(){var b=this;desknets.flow.attach.funcToggleTarget=function(){if(b.boautosave){desknets.autosave.attachsave()}};if(b.boautosave){b.$mjPage.find(".jco-setup-attach-list").on("click",".jco-selfile-button",function(c){desknets.autosave.save();desknets.autosave.restart()})}desknets.flow.attach.init(b.$mjPage,true);b.$mjPage.find(".jflow-attach-button").click(function(c){c.preventDefault();desknets.flow.attach.open();if(b.boautosave){desknets.autosave.save();desknets.autosave.restart()}})},_setUpSetMail:function(){var b=this;if(b.$mjPage.find("#jfow-entry-mailuse").val()!="1"){b.$mjPage.find('select[name="endmail"]').val("1");b.$mjPage.find(".jflow-endmail-noset").hide()}},_setUpNo:function(){var b=this;if(b.$mjPage.find('select[name="no"]').find("option").length<=0){}},_setUpGrp:function(){var b=this;if(b._mmode!="reapply"){if(b.$mjPage.find('select[name="gid"]').find("option").length<=1){b.$mjPage.find(".jflow-grp-noset").hide()}}else{if(b.$mjPage.find("#flow-reapply-gid").val()==""){b.$mjPage.find(".jflow-grp-noset").hide()}}},_setUpEditorTabs:function(d,e){var c=this;var b=c.$mjPage.find(".flow-editor-tabs");b.tabs({})},getTempName:function(){return"fent"},_setTmpNm:function(){var b=this;b.$mjPage.find('input[name="tmpnm"]').val(b.getTempName())},_getRestModule:function(){return desknets.flow.MODULE_API_FLOW},_getAddExecCmd:function(){return desknets.flow.CMD_FLOWENTRYDRAFT},_getModExecCmd:function(){return this._getAddExecCmd()},_getDelExecCmd:function(){var b=this;if(b._mmode=="draft"){return desknets.flow.CMD_FLOWCMDDRAFTDEL}return desknets.flow.CMD_FLOWCMDDEL},_formObserveisChanged:function(){if(!!this.tmpfileChanged){return true}return this.callBase("_formObserveisChanged")},AutoSaveOpt:function(c){var b=this;var e=desknets.paramanalyzer.getHashParams();var d=b.callBase("AutoSaveOpt",c);d.module="flow";d.attachname="flowattach";d.format="fent";if(e.mode=="reapply"){d.mod=true}else{d.mod=false}return d},AutoSaveChkConfirm:function(e,c){var b=this;var d=desknets.paramanalyzer.getHashParams();if(d.mode=="copy"){desknets.autosave.del();desknets.autosave.start()}else{if(d.mode=="reapply"){if(e.id==d.id){b.AutoSaveChkConfirmMod(e,c)}else{desknets.autosave.del();desknets.autosave.start()}}else{if(!d.id){if(e.id=="0"){b.AutoSaveChkConfirmAdd(e,c)}else{desknets.autosave.del();desknets.autosave.start()}}else{if(e.id==d.id){b.AutoSaveChkConfirmAdd(e,c)}else{desknets.autosave.del();desknets.autosave.start()}}}}},AutoSaveEntry:function(c){var b=this;c=b.callBase("AutoSaveEntry",c);return c},AutoSaveGetData:function(c){var b=this;b.$mjPage.find('input[name="mode"]').val(c.mode);b.$mjPage.find('input[name="subject"]').val(c.subject);b._setFormatInfo(c.formatid,c.subject,c.formattype);if(c.formattype=="pub"){b.getFormatType()}b.$mjPage.find('select[name="important"]').val(c.important);b.$mjPage.find('select[name="no"]').val(c.no);b.$mjPage.find('select[name="endmail"]').val(c.endmail);b.$mjPage.find('select[name="gid"]').val(c.gid)},AutoSaveGetAttData:function(c){var b=this;desknets.flow.attach.update(c)},AutoSaveGet:function(e,f){var b=this;b.callBase("AutoSaveGet",e,f);var c={};c["0"]=b.getFormatPrm();c["1"]=b.getRoutetPrm();var d=desknets.ajax.arrayToMultiCmdData(c);desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),data:d,success:function(h,g,i){if(h["0"]["status"]==desknets.RES_STATUS_SUCCESS){b.parts=desknets.ajax.getJsonItems(h["0"]);b.setUpFormat(h["0"].html,true)}if(h["1"]["status"]==desknets.RES_STATUS_SUCCESS){b.setUpRoute(h["1"])}},})},});desknets.page(desknets.flow,"flowconfirm",null,{_$page:null,_options:{tmpl:null,data:null,ok:function(b){},cancel:function(b){}},options:{},init:function(b){this.destroy();this.options=a.extend({},this._options,b);this._$page=a("#flow-m-confirm-page");this._buildPage(this.options.tmpl,this.options.data)},destroy:function(){if(this._$page){this._$page.empty().unbind()}this._$page=null;this.options={}},_buildPage:function(c,e){var b=this;var d=this._$page;d.html(c);a("#jco-m-sub-title").text(d.find(".jco-title").val());desknets.flow.preparedCmdDispRest(e);e.username=desknets.pageframe.getLoginName();d.find(".jco-confirm-tmplset").tmpl(e).appendTo(".jflow-entryconf-data");d.find(".jflow-entryconf-tmplset-notices-list").tmpl(e).appendTo(".jflow-entryconf-notices-list");d.find(".jco-confirm-tmplset-set").tmpl(e).appendTo(".jflow-entryconf-set");d.find(":button.jflow-ok").click(function(f){if(b.options.ok){b.options.ok(f)}});d.find(":button.jflow-cancel").click(function(f){if(b.options.cancel){b.options.cancel(f)}});d.show();desknets.moveScroll()},getFlowAttachDownloadParams:function(){var b={};b={cmd:desknets.flow.CMD_FLOWREFATTACH};return b},"":{}});desknets.page(desknets.flow,"flowentryform",desknets.flow.FlowInputBase,{mboFormNotChg:false,mboRouteNotChg:false,mboInit:false,mboInit:false,$mjMain:null,init:function(f){var j=this;j.boautosave=f.autosave;if(j.mboInit==false){j.mboInit=true;j.initGetPageId();j._initSet()}var i={};var b={};var h={};var k=j.$mjMain.find("#inputfrm");h=k.formToArrayEx();h.cmd=desknets.flow.CMD_FLOWENTRYFROMRESAVE;h.tmpno=j.getTempNameEntry();var g={};g.cmd=desknets.flow.CMD_FLOWEDITFORMATCOPYTEMP;g.tmpfrom=j.getTempNameEntry();g.tmpto=j.getTempName();var e={};e.cmd=desknets.flow.CMD_FLOWEDITFORMAT;e.tmpno=j.getTempName();var d={};d.cmd=desknets.flow.CMD_FLOWEDITROUTECOPYTEMP;d.tmpfrom=j.getTempNameEntry();d.tmpto=j.getTempName();var c={};c.cmd=desknets.flow.CMD_FLOWEDITROUTE;c.tmpno=j.getTempName();b["0"]=h;b["1"]=g;b["2"]=e;b["3"]=d;b["4"]=c;i.success=function(l){if(l[0]["status"]!=desknets.RES_STATUS_SUCCESS){j.onError(l[0]["errorno"],l[0]["errormessage"])}else{if(l[1]["status"]!=desknets.RES_STATUS_SUCCESS){j.onError(l[1]["errorno"],l[1]["errormessage"])}else{if(l[2]["status"]!=desknets.RES_STATUS_SUCCESS){j.onError(l[2]["errorno"],l[2]["errormessage"])}else{if(l[3]["status"]!=desknets.RES_STATUS_SUCCESS){j.onError(l[3]["errorno"],l[3]["errormessage"])}else{if(l[4]["status"]!=desknets.RES_STATUS_SUCCESS){j.onError(l[4]["errorno"],l[4]["errormessage"])}else{if(j.boautosave){desknets.autosave.formatsave()}j._initSetFlow(l)}}}}}};j._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,b,i)},initGetPageId:function(){var b=this;b.$mjPage=a(".jflow-entry-form-area");b.$mjMain=a(".jflow-entry-main-area")},_initSet:function(){var b=this;desknets.moveScroll();b._initPageEnterKeysSubmitFormCancel();b._inputButton()},_initSetFlow:function(e){var d=this;var c=d.$mjPage.find(".co-setarea");c.empty();d.$mjPage.find(".jflow-tmpl-preview-format").tmpl({}).appendTo(c);var b=[];var f={};if(!!e&&e["2"]){b=desknets.ajax.getJsonItems(e["2"])}if(!!e&&e["4"]){f={route:desknets.flow.route.getRouteFromJson(e["4"]),}}a.extend(f,d.getRouteOptionsForParams());d._setUpEditorTabs(b,f);if(d.mboFormNotChg){d.$mjPage.find(".jflow-tab-format").hide();d.$mjPage.find(".jflow-tab-route").find("a").click()}else{d.$mjPage.find(".jflow-tab-format").show()}if(d.mboRouteNotChg){d.$mjPage.find(".jflow-tab-route").hide();d.$mjPage.find(".jflow-tab-format").find("a").click()}else{d.$mjPage.find(".jflow-tab-route").show()}},_inputButton:function(){var b=this;b.callBase("_inputButton");b.$mjPage.find(".jflow-input-edit-ok").click(function(){desknets.flow.flowentry.tmpfileChanged=true;b.setUpEntryPage()});b.$mjPage.find(".jflow-input-edit-cal").click(function(){b.$mjMain.show();b.$mjPage.hide()})},setUpEntryPage:function(j){var k=this;var i={};var d={};var e={};e.cmd=desknets.flow.CMD_FLOWEDITFORMATSETSORT;e.tmpno=k.getTempName();e.values=k._getFormRequestParams();var c={};c.cmd=desknets.flow.CMD_FLOWEDITFORMATSAVE;c.tmpno=k.getTempName();c.tmpfrom=k.getTempName();c.tmpto=k.getTempNameEntry();var h={};h.cmd=desknets.flow.CMD_FLOWAPPLICATEPREVIEW;h.tmpno=k.getTempNameEntry();h.formType="2";var f={};f.cmd=desknets.flow.CMD_FLOWEDITROUTESETSORT;f.tmpno=k.getTempName();f.values=k._getRouteRequestParams();var b={};b.cmd=desknets.flow.CMD_FLOWEDITROUTESAVE;b.tmpno=k.getTempName();b.tmpfrom=k.getTempName();b.tmpto=k.getTempNameEntry();var g={};g.cmd=desknets.flow.CMD_FLOWEDITROUTE;g.tmpno=k.getTempNameEntry();d["0"]=e;d["1"]=c;d["2"]=h;d["3"]=f;d["4"]=b;d["5"]=g;i.success=function(m){if(m[0]["status"]!=desknets.RES_STATUS_SUCCESS){k.onError(m[0]["errorno"],m[0]["errormessage"])}else{if(m[1]["status"]!=desknets.RES_STATUS_SUCCESS){k.onError(m[1]["errorno"],m[1]["errormessage"])}else{if(m[2]["status"]!=desknets.RES_STATUS_SUCCESS){k.onError(m[2]["errorno"],m[2]["errormessage"])}else{if(m[3]["status"]!=desknets.RES_STATUS_SUCCESS){k.onError(m[3]["errorno"],m[3]["errormessage"])}else{if(m[4]["status"]!=desknets.RES_STATUS_SUCCESS){k.onError(m[4]["errorno"],m[4]["errormessage"])}else{desknets.flow.flowentry.setUpFormat(m[2]["html"]);desknets.flow.flowentry.parts=desknets.ajax.getJsonItems(m["2"]);desknets.flow.flowentry.setUpRoute(m[5]);$tabs=k.$mjMain.find(".flow-editor-tabs");var n=a(".jflow-entry-form-area").find(".flow-editor-tabs").find(".ui-tabs-nav").children();var l=0;n.each(function(){var o=a(this);if(o.hasClass("ui-tabs-selected")){return false}l++});$tabs.tabs({selected:l});k.$mjMain.show();k.$mjPage.hide();desknets.moveScroll()}}}}}};k._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,d,i)},getRouteOptionsForParams:function(){var b=this;var c=b.callBase("getRouteOptionsForParams");c.branch=true;return c},_setUpRouteEditor:function(c){var b=this;b.callBase("_setUpRouteEditor",c);b.$mjPage.find(".flow-route-node.flow-route-box-node.branch").hide();b.$mjPage.find(".flow-route-item-guide-legend > .co-legend-item.branch").hide()},getTempName:function(){return"fupdent"},getTempNameEntry:function(){return desknets.flow.flowentry.getTempName()},getCopyRouteNodeCmd:function(){return desknets.flow.CMD_FLOWEDITROUTECOPY},getAttachSizeLimit:function(){return a("#jfow-entry-totalSizeLimit").val()},getPreviewGid:function(){var b=a(".jflow-entry-main-area").find('select[name="gid"]');if(b.length>0){return b.val()}else{return a(".jflow-entry-main-area").find("#flow-reapply-gid").val()}},});desknets.page(desknets.flow,"flowdisp",desknets.PageDispBase,{_mDelFlg:"0",mboApproval:false,msClass:"0",msBackRouteId:"0",mboPrev:false,mboStart:false,$mForcedEndDialog:null,_initHtml:function(c){var b=this;b.mboApproval=b.chkApproval(c[0]);b.callBase("_initHtml",c)},chkApproval:function(d){var l=this;var h=desknets.ajax.getItems(d.route_list.item);l.mboPrev=false;var c="0";l.mboStart=true;var b=h.length;for(var i=0;i<b;i++){var j=h[i];if(j.is_input==="1"){if(i>0){l.mboPrev=true}l.msClass=j.ROUTE_CLASS_KIND;l.msBackRouteId=c;return true}else{if(neo.isSet(j.list)){var g=desknets.ajax.getItems(j.list.item);var k=g.length;for(var e=0;e<k;e++){var f=g[e];if(f.is_input==="1"){if(j.rtnpoint=="0"){l.mboStart=true;l.mboPrev=false}else{l.mboStart=false;l.mboPrev=true}l.msClass=j.ROUTE_CLASS_KIND;l.msBackRouteId=c;return true}}}}c=j.id}return false},_initHtmlTmplSet:function(e){var d=this;var b=desknets.paramanalyzer.getHashParams();desknets.flow.preparedCmdDispRest(e[0]);if(b.mode=="history"){e[0]["history_list"]=null}var c={};c.creportuse="1";if(neo.isSet(e[0]["creportuse"])){c.creportuse=e[0]["creportuse"];if(d.isManageMode()){c.creportuse="0"}}if(neo.isSet(e[0]["cabuse"])){c.cabuse=e[0]["cabuse"]}c.flowbackid=desknets.flow.flowindex.approvableBack(b.id);c.flownextid=desknets.flow.flowindex.approvableNext(b.id);d.$mjPage.find(".jflow-disp-tmplset-vbtnarea").tmpl(c).appendTo("#"+d._getIdPage()+" .co-vbtnarea");c={};c.btncopy="1";c.btnreapply=e[0]["is_disp_reapply"];c.btnend="1";c.btndel="1";c.btndelline="1";c.btnremand="0";c.btnforcedend="0";if(d.isManageMode()){c.btncopy="0";c.btnreapply="0";c.btndelline="0";if(e[0]["sts"]=="2"){c.btnremand="1"}if(e[0]["sts"]=="2"||e[0]["sts"]=="3"||e[0]["sts"]=="9"){c.btnforcedend="1";c.btndelline="1"}}if(!e[0]["capability"]||e[0]["capability"].indexOf("cancel")==-1){c.btnend="0"}if(!e[0]["capability"]||e[0]["capability"].indexOf("delete")==-1){c.btndel="0";c.btndelline="0"}if(neo.isSet(b.mode)&&b.mode=="history"){c.btncopy="0";c.btnreapply="0";c.btnend="0";c.btndel="0";c.manage="0";c.btndelline="0";c.btnforcedend="0"}d.$mjPage.find(".jflow-disp-tmplset-button").tmpl(c).appendTo("#"+d._getIdPage()+" .co-actionarea");d.$mjPage.find(".jco-disp-tmplset").tmpl(e[0]).appendTo("#"+d._getIdPage()+" .jflow-disp-disparea");c=e[0];if(d.isManageMode()){c.attachcmd=desknets.flow.CMS_FLOWMSETREFATTACH}else{c.attachcmd=desknets.flow.CMD_FLOWREFATTACH}d.$mjPage.find(".jflow-disp-tmplset-attach").tmpl(c).appendTo("#"+d._getIdPage()+" .jflow-disp-attach");d.$mjPage.find(".jflow-disp-tmplset-hist").tmpl(e[0]).appendTo("#"+d._getIdPage()+" .jflow-disp-hist");if(d.mboApproval){d.$mjPage.find(".jflow-disp-tmplset-notices").tmpl(e[0]).appendTo("#"+d._getIdPage()+" .jflow-disp-notices")}d.$mjPage.find(".jflow-disp-tmplset-notices-list").tmpl(e[0]).appendTo("#"+d._getIdPage()+" .jflow-disp-notices-list");d.$mjPage.find('input[name="id"]').val(b.id)},_initSet:function(c){var b=this;b.callBase("_initSet",c);b._initSetCab(c);b._initSetPrint(c);this._initSetCreport();if(b.mboApproval){b._initSetApproval(c)}b.$mjPage.find(".jflow-view-history").delegate("a","click",function(d){d.preventDefault();b._onClickHistoryItemLink(d)});desknets.flow.ForcedEndDialog.init()},_onClickHistoryItemLink:function(c){var b=this;var e=a(c.target);var f=e.attr("data-id");var d=desknets.paramanalyzer.getHashParams();d.hisid=f;d.mode="history";desknets.paramanalyzer.setLocationHash(d)},_initSetCreport:function(){var c=this;var f={};var b=desknets.paramanalyzer.getHashParams();var d=b[c._getIDName()];var e=b.hisid;if(!!e){d+="_"+e}f.connectid=d;f.restmodule=c._getRestModule();f.restcmd=c._getConnectAppCmd();c.$mjPage.find(".flow-msg-creport").click(function(g){g.preventDefault();desknets.connectapp.connectCreport(f)})},_initSetCab:function(d){var c=this;var b=false;var e={copymodule:this._getRestModule(),copycmd:desknets.flow.CMD_FLOWCABATTACHCOPY,cabmaketemplate:a.proxy(function(i,g,f,h){h.viewdata="";desknets.cabinetregist.sendCabinetAjax(h,"detail");return false},this)};desknets.cabinetregist.init(this.$mjPage,e,b)},_initSetPrint:function(c){var b=this;var d=function(f,j){var g=function(q){j.$("#jco-print-body").html(q);var m=j.$("#jco-print-body").find("img");var k=m.length;var p=0;m.each(function(){a("<img>").load(function(){p++}).attr("src",a(this).attr("src"))});var o=0;var n=0;var l=setInterval(function(){o++;if(k<=p||o>10){clearInterval(l);j.print()}},500)};var e=desknets.paramanalyzer.getHashParams();var i=e.id;var h=e.hisid;desknets.flow.flowprint.buildPrintPageHtml(i,h,g,b.isManageMode());return false};desknets.flow.flowprint.init(b.$mjPage,d)},_initSetApproval:function(e){var c=this;var b=desknets.paramanalyzer.getHashParams();var d=desknets.flow.flowindex.approvableNext(b.id);var h=c.$mjPage.find(".jflow-disp-approval-sel");var g=c.$mjPage.find("#flow-denyto1");var f=c.$mjPage.find("#flow-denyto2");if(d==""){h.val("2");h.attr("disabled",true)}else{h.attr("disabled",false)}g.attr("checked",true);if(!c.mboStart){g.attr("disabled",true);f.attr("checked",true)}else{if(!c.mboPrev){f.attr("disabled",true);g.attr("checked",true)}}c.$mjPage.find(".jflow-disp-approval").click(function(i){i.preventDefault();c.onClickApprovalButton(true)});c.$mjPage.find(".jflow-disp-approval-ng").click(function(i){i.preventDefault();c.onClickApprovalButton(false)})},onClickApprovalButton:function(e){var b=this;var d;var c;if(e){c=desknets.Resource.Message["flow_approve_confirm"+b.msClass]}else{c=desknets.Resource.Message.flow_approve_confirmng}d=desknets.dialog.confirm(c,function(){desknets.submitform.setDialogDisabled(d);b._ajaxApproval(e,d);return false})},_ajaxApproval:function(e,d){var c=this;var f={};var b=desknets.paramanalyzer.getHashParams();f.id=b.id;f.memo=c.$mjPage.find(".jflow-disp-approval-msg").val();if(e){f.cmd=desknets.flow.CMD_FLOWAPPROVAL}else{f.cmd=desknets.flow.CMD_FLOWDENIAL;if(c.mboStart&&c.mboPrev){if(c.$mjPage.find('input[name="denyto"]:checked').val()=="2"){f.rtnpoint=c.msBackRouteId}else{f.rtnpoint="0"}}else{if(c.mboStart){f.rtnpoint="0"}else{if(c.mboPrev){f.rtnpoint=c.msBackRouteId}}}}desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:f,success:function(h,g,i){c.onSuccessApproval(h,g,i)},complete:function(i,g,h){if(!!d){desknets.submitform.clearDialogDisabled(d);d.dialog("close")}}})},onSuccessApproval:function(d,b,f){var c=this;c._noticeUpdateData();c.resetFuncBeforeHashChange();if(!!d.noticeerror){var g={extraMessage:d.noticeerror,extraClass:"co-msg-r",type:"warn"};var e=desknets.dialog.alert(d.msg,g);e.bind("dialogclose",function(h){desknets.dialog.deleteById("warn");c._goNextPage()})}else{c._goNextPage()}},_goNextPage:function(){var d=this;var b=false;if(d.$mjPage.find(".jflow-disp-approval-sel").val()=="1"){var c=desknets.paramanalyzer.getHashParams();var e=desknets.flow.flowindex.approvableNext(c.id);if(e!=""){c.id=e;desknets.paramanalyzer.setLocationHash(c);b=true}}if(!b){d.dispBackListPage()}},_inputButton:function(){var b=this;b.callBase("_inputButton");b.$mjPage.find(".jflow-input-copy").click(function(c){c.preventDefault();b._onClickButtonCopy()});b.$mjPage.find(".jflow-input-reapply").click(function(c){c.preventDefault();b._onClickButtonReapply()});b.$mjPage.find(".jflow-input-del-submit-conf").click(function(c){c.preventDefault();b._mDelFlg="0";b._inputDelConfSubmit()});b.$mjPage.find(".jflow-input-end").click(function(c){c.preventDefault();b._mDelFlg="1";b._openForcedEndDialog()})},_onClickButtonCopy:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();b.cmd=desknets.flow.PAGE_FLOWENTRY;b.mode="copy";desknets.paramanalyzer.setLocationHash(b)},_onClickButtonReapply:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();var d={};d.cmd=desknets.flow.PAGE_FLOWENTRY;d.id=b.id;d.mode="reapply";desknets.paramanalyzer.setLocationHash(d)},_delConfMessage:function(){var b=this;if(b._mDelFlg=="1"){return desknets.Resource.Message.flow_cancel_confirm}return b.callBase("_delConfMessage")},_inputDelSubmit:function(e){var c=this;var d={};var b=desknets.paramanalyzer.getHashParams();c.resetFuncBeforeHashChange();if(e!=null){desknets.submitform.setDialogDisabled(e)}d=c._getDelPrm();d.cmd=c._getDelExecCmd();d[c._getIDName()]=b[c._getIDName()];desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,success:function(g,f,h){c._noticeUpdateData();c.dispBackListPage()},complete:function(h,f,g){if(e!=null){desknets.submitform.clearDialogDisabled(e);e.dialog("close")}}})},_getDelPrm:function(){var b=this;var c={};if(b._mDelFlg=="1"){c.memo=b.$mForcedEndDialog.find("textarea").val()}return c},_openForcedEndDialog:function(){var b=this;desknets.flow.ForcedEndDialog.setDlgTtile(b._getForcedEndDlgTitle());desknets.flow.ForcedEndDialog.setDlgMessage(b._delConfMessage());desknets.flow.ForcedEndDialog.setDlgCallback(a.proxy(b.execForcedEnd,b));desknets.flow.ForcedEndDialog.open()},_getForcedEndDlgTitle:function(){var b=this;if(b._mDelFlg=="1"){return desknets.Resource.flow.revocation}return""},execForcedEnd:function(c){var b=this;b.$mForcedEndDialog=c;b._inputDelSubmit(c)},_noticeUpdateData:function(){desknets.flow.flowsearch._onSrchExec=true},isManageMode:function(){return false},_getRestModule:function(){return desknets.flow.MODULE_API_FLOW},_getDispExecCmd:function(){return desknets.flow.CMD_FLOWDISP},_getDelExecCmd:function(){var b=this;if(b._mDelFlg=="1"){return desknets.flow.CMD_FLOWCOMPLETE}return desknets.flow.CMD_FLOWCMDDEL},_getConnectAppCmd:function(){return desknets.flow.CMD_FLOWCONNECTAPP},});desknets.page(desknets.flow,"flowsearch",desknets.PageListBatSearchBase,{_mDelFlg:"",$mForcedEndDialog:null,_mboSearchInit:true,_initListStart:function(){var b=this;b.callBase("_initListStart");desknets.flow.ForcedEndDialog.init()},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()});b.$mjListPage.find(".jflow-list-cancel-submit").click(function(c){c.preventDefault();b._mDelFlg="1";b._listDelSubmit(c)});b.$mjListPage.find(".jflow-list-del-submit").click(function(c){c.preventDefault();b._mDelFlg="0";b._listDelSubmit(c)});b._initFlowViewButton()},_initFlowViewButton:function(){var b=this;b.$mjListPage.find(".jflow-list-download-submit").hide();b.$mjListPage.find(".jflow-list-back-submit").hide();b.$mjListPage.find(".jflow-list-forcedend-submit").hide()},_initListStartModLink:function(){var b=this},_replaceListLine:function(c,f,d){var b=this;var e=desknets.flow.flowindex.replaceFlowListLine(c,f,d);if(e!=null){return e}return b.callBase("_replaceListLine",c,f,d)},_delNoChkMessage:function(){var b=this;if(b._mDelFlg=="1"){return desknets.Resource.Message.flow_cancel_nochecked}else{return this.callBase("_delNoChkMessage")}},_delConfMessage:function(){var c=this;var b="";if(c._mDelFlg=="1"){if(c.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.flow_cancel_all}else{if(c.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.flow_cancel_some}else{b=desknets.Resource.Message.flow_cancel_list}}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())}return this.callBase("_delConfMessage")},_setDelConfirm:function(c){var b=this;if(b._mDelFlg=="1"){b._openForcedEndDialog(c)}else{b.callBase("_setDelConfirm",c)}},_openForcedEndDialog:function(c){var b=this;desknets.flow.ForcedEndDialog.setDlgTtile(b._getForcedEndDlgTitle());desknets.flow.ForcedEndDialog.setDlgMessage(c);desknets.flow.ForcedEndDialog.setDlgCallback(a.proxy(b.execForcedEnd,b));desknets.flow.ForcedEndDialog.open()},_getForcedEndDlgTitle:function(){var b=this;if(b._mDelFlg=="1"){return desknets.Resource.flow.revocation}return""},execForcedEnd:function(c){var b=this;b.$mForcedEndDialog=c;b._listDel(true,c)},_getSearchConditionParams:function(){var b=[];b.push("sw_formatid");b.push("sw_status");b.push("srch_key");b.push("sw_entry");b.push("sw_attach");b.push("sw_important");b.push("sdate");b.push("edate");return b},_openSearchMessageDialog:function(){var b=this;if(!neo.isSet(b.$dialogexec)){b._mboSearchInit=true}b.callBase("_openSearchMessageDialog")},_getListAjaxSuccessOtherSet:function(c){var b=this;b.callBase("_getListAjaxSuccessOtherSet",c);if(b._mboSearchInit&&neo.isSet(c[desknets.RES_TAG_MSGGETLIMIT])){b._mboSearchInit=false;desknets.pageframe.viewTopMsg(c[desknets.RES_TAG_MSGGETLIMIT],"info")}},_getDelAddPrm:function(){var b=this;var c={};var d={};if(this.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){var e=desknets.getInputDataToObj(this.$mjListPage.find(".jco-back-page-data"));d.lcmd=this._getListExecCmd();d.fldsort=e.fldsort;d.order=e.order}a.extend(c,d);if(b._mDelFlg=="1"){if(b.$mForcedEndDialog){c.memo=b.$mForcedEndDialog.find("textarea").val()}}return c},_getRestModule:function(){return desknets.flow.MODULE_API_FLOW},_getListCmd:function(){return desknets.flow.PAGE_FLOWSEARCH},_getListExecCmd:function(){return desknets.flow.CMD_FLOWSEARCHINDEX},_getStopBatSearchCmd:function(){return desknets.flow.CMD_FLOWSTOPSEARCH},_getListDispCmd:function(){return desknets.flow.PAGE_FLOWDISP},_getDelCmd:function(){var b=this;if(b._mDelFlg=="0"){return desknets.flow.CMD_FLOWCMDDELCONF}else{if(b._mDelFlg=="1"){return desknets.flow.CMD_FLOWCANCELCONF}}return""},_getDelExecCmd:function(){var b=this;if(b._mDelFlg=="0"){return desknets.flow.CMD_FLOWCMDDEL}else{if(b._mDelFlg=="1"){return desknets.flow.CMD_FLOWCANCEL}}return""}});app.addInitialAction(function(){desknets.flow.init()})})(jQuery);