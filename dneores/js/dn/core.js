/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){a.extend(desknets,{MODULE_MAIN:"dneo",MODULE_API_MAIN:"dneor",MODULE_REFER:"zrefer",MODULE_API_OPT:"zropt",MODULE_HTML_MAIN:"zhtml",DIR_RESHOME:"dneores",CMD_DOWNLOAD:"referdownload",CMD_TMPLHTML:"tmplhtml",COOKIENAME_SESSION_ID:"dnzSid",COOKIENAME_STOKEN:"dnzToken",COOKIENAME_ATTACH_IE_FLASH:"dnzAttFlash",COOKIENAME_LOGIN_INFO:"dnzInfo",ERRORNO_MAILSELTRANSMIT:-40007,PRM_VAL_ALLDEL:"all",CACHE_VERSION:"3.5.0.0",CACHE_RTE_VERSION:"3.5.0.0",msUrl:"",msSubDirectory:"",msModuleName:"",RES_STATUS_SUCCESS:"ok",merrMsgConnect:'<span class="co-colon-span">:</span>',_msExtension:"",_initSetUp:function(){var c=this;var g=document.URL;var e=0;var d="";var i="";var h="";var f="";var b="";e=g.indexOf("?");if(e>0){g=g.substring(0,e)}e=g.lastIndexOf("/");if(e>=0){d=g.substring(0,e+1);c.msUrl=d;i=g.substring(e+1,g.length);e=i.lastIndexOf(".");if(e>=0){h=i.substring(0,e);c.msModuleName=h;f=i.substring(e+1,i.length);c._msExtension=f}e=d.indexOf("//");if(e>=0){b=d.substring(e+2,d.length);e=b.indexOf("/");if(e>=0){b=b.substring(e,b.length);c.msSubDirectory=b}}}},getUrl:function(b){var c=this;var d=0;var e="";if(typeof(b)==="string"){e=b}if(e!==""&&c._msExtension){e=e+"."+c._msExtension}return c.msUrl+e},getExtension:function(){return this._msExtension},createRandomId:function(){var b=""+(new Date()).getTime()+parseInt(Math.random()*10000);return b},formatFileSize:function(d,b){var c=Number(d);if(isNaN(d)||d<0){return desknets.Resource.attachInvSize}c=Math.ceil(c/1024);return desknets.numberFormat(c)+" KB"},numberFormat:function(c){var b=[];var d="";if((c.toString()).indexOf(".")!=-1){b=(c.toString()).split(".")}else{b[0]=c;b[1]=""}d=new String(b[0]).replace(/,/g,"");while(d!=(d=d.replace(/^(-?\d+)(\d{3})/,"$1,$2"))){}if(b[1].length>0){d=d+"."+b[1]}return d},getDataAttr:function(b,c){return b.attr("data-"+c)},setDataAttr:function(b,c,d){return b.attr("data-"+c,d)},zeroPadding:function(c,b){var d=c.toString();while(d.length<b){d="0"+d}return d},escape:function(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescape:function(b){return b.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},escapeValue:function(b){return b.replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},escapeSpace:function(d,c){var b;if(c){b="\u00A0"}else{b="&nbsp;"}d=d.replace(/^ /gm,b);return d.replace(/  /g," "+b)},encodeURIComponentNeo:function(b){if(typeof(b)==="string"){return encodeURIComponent(b).replace(/'/g,"%27")}else{return encodeURIComponent(b)}},decodeURIComponentNeo:function(b){b=b.replace(/\+/g," ");try{return decodeURIComponent(b)}catch(c){return b}},getNeoParam:function(f){var h="";var b=[];for(var d in f){var c=f[d];if(!(c instanceof Array)){c=[c]}for(var e=0;e<c.length;e++){var g=c[e];if(g!=null){var j=desknets.encodeURIComponentNeo(g);b.push(d+"="+j)}}}h=b.join("&");return h},splitParam:function(f){var g={};f=f.substr(f.indexOf("?")+1,f.length);if(f==""){return{}}var b=f.split("&");for(var d=0;d<b.length;d++){b[d]=b[d].split("=");if(!neo.isSet(b[d][0],{blank:false})||!neo.isSet(b[d][1])){continue}var c=b[d][0];var e=desknets.decodeURIComponentNeo(b[d][1]);if(neo.isSet(g[c])){if(g[c] instanceof Array){g[c].push(e)}else{g[c]=[g[c],e]}}else{g[c]=e}}return g},parseErrorInfo:function(d,c){var b={level:"error",message:d};var e={E:"error",W:"warn",M:"message"};if(d.charAt(1)==":"){b.level=e[d.charAt(0)];b.message=d.substring(2)}if(!!c&&b.level=="error"){var f="";if(typeof c==="number"&&c>=500){f="HTTP"}b.message+="\n["+f+String(c)+"]"}else{if(!!c&&c===this.ERRORNO_MAILSELTRANSMIT){b.message+=this.getErrMailTransmitMsg()}}return b},getErrMailTransmitMsg:function(){return""},getErrField:function(d,f){var e={};var b="";var c="";if(d==neo.ajax.NEOAJAX_OBJXML){c=f.find("errormessage").text();b=f.find("errmsgadd").text()}else{c=f.errormessage;b=f.errmsgadd}e.fieldid=b;e.msg=c;return e},getErrFieName:function(c,b){var d="";d=c.find(".jco-input-"+b).closest("td").prev().find(".co-colon").eq(0).text();if(neo.isSet(d)&&d.length>0){d=d+desknets.merrMsgConnect}return d},getErrConvMsg:function(f){var b=f.msg;var d=f.fieldid;var e=f.fieldname;var c="";if(neo.isSet(d)){if(neo.isSet(e)&&e.length>0){if(b.charAt(1)==":"){c=b.substring(0,2);b=b.substring(2)}return c+e+b}}return b},saveHashCmdCookie:function(c){var b=this;a.cookie(desknets.COOKIENAME_HASHCMD_FLG,c)},saveCookie:function(d,f,c){var b=this;var e={};if(typeof(c)=="object"){a.extend(e,c)}if(!e.path&&!!b.msSubDirectory){e.path=b.msSubDirectory}a.cookie(d,f,e)},saveCookieToDisk:function(c,e){var d=new Date(2050,11,31,23,59,59);var b=this;b.saveCookie(c,e,{expires:d})},convertToSafeHtml:function(c,b){var d=a.extend({allowedFrameUri:["http://www.youtube.com/","http://libura.com/","https://www.youtube.com/","https://libura.com/"],allowedSchemas:["http","https","file","mailto","ftp"]},b);return neo.html.convertToSafeHtml(c,d)}});(function(c){var b=c(document.documentElement);desknets.browser={};desknets.browser.msie=b.hasClass("co-browser-IE");desknets.browser.msie8=b.hasClass("co-browser-IE-8");desknets.browser.msie9=b.hasClass("co-browser-IE-9");desknets.browser.msie11=b.hasClass("co-browser-IE-11");desknets.browser.firefox=b.hasClass("co-browser-Firefox");desknets.browser.chrome=b.hasClass("co-browser-Chrome");desknets.browser.safari=b.hasClass("co-browser-Safari");desknets.browser.ipad=b.hasClass("co-device-iPad");desknets.browser.android=b.hasClass("co-device-Android");desknets.browser.tablet=desknets.browser.ipad||desknets.browser.android;desknets.browser.edge=b.hasClass("co-browser-Edge");desknets.support={};desknets.support.cssTransform=neo.supportStyle("transform");desknets.support.cssTransition=neo.supportStyle("transition");desknets.support.cssPositionFixed=neo.supportStyle("position","fixed")})(jQuery);a.extend(desknets,{ERRORNO_LOGIN_LICENSE1:-9002,ERRORNO_LOGIN_LICENSE2:-9056,ERRORNO_GRPERR_ITEMNOTHING:-110,DBVAL_ADMINISTRATORS_ROLE_ID:1,DBVAL_EVERYONE_ROLE_ID:2,DBVAL_ROLE_LOCK_MAX:999,DBVAL_STARTTAB_SHARE:"0",DBVAL_MID_KOUBAI:"16",DBVAL_MID_PAY:"18",CMD_CHOOSERMSETUSERSEL:"constructmsetcmdusersearch",CMD_PSETINDEX:"psetindex",COOKIENAME_LOGIN_SAVE:"dnzSv",COOKIENAME_LEFT_MENU:"dnzLeftmenu",COOKIENAME_HASHCMD_FLG:"dnzHashcmd",COOKIENAME_PORTAL_TAB:"dnzPtab",COOKIENAME_ATTACHDISP_LIST:"dnzAttlist",COOKIENAME_IMEX_CCODE:"dnzImExCcode",COOKIENAME_IMEX_CSEP:"dnzImExCsep",COOKIEVALUE_HASHCMD_FIN:"fin",COOKIEVALUE_STARTTAB_SHARE:"S",CMD_FILAGROUPUSER:"filagrpuser",RES_TAG_MSGDISPLIMIT:"msgdisplimit",RES_TAG_MSGGETLIMIT:"msggetlimit",TIME_GETLIST_LAG:900,TIME_LIMIT_WAIT:5000,EVENT_SCROLL:desknets.browser.android?"touchmove":"scroll",_CLSNAME_MODFILES:"jco-files-modify",_isCallExecLocation:false,SRCHKEY_MAXLENGTH:127,init:function(){var b=this;desknets.pagetitle.init();b._initSetUp();b._initSetDatepicker();desknets.ajax.init();desknets.logout.init();desknets.pageframe.init()},_initSetDatepicker:function(){a.datepicker.setDefaults({changeMonth:true,changeYear:true,showButtonPanel:true,shortYearCutoff:38,selectOtherMonths:true,showOtherMonths:true,minDate:new Date(1970,0,3),maxDate:new Date(2038,0,16)});return},getProcUrl:function(f){var b=this;var e=document.URL;var c="";var d=0;d=e.indexOf("?");if(d>0){c=e.substring(d,e.length);e=e.substring(0,d)}d=e.lastIndexOf("/");if(d>=0){c=e.substring(d+1,e.length)+c}if(f){c=desknets.encodeURIComponentNeo(c)}return c},parseNumber:function(d,c){var b=typeof(d);var e=Number.NaN;if(b=="string"){d=d.replace(/[\uFF10-\uFF19]/g,function(f){return(f.charCodeAt(0)-65296).toString()});e=Number(d)}else{if(b=="number"){e=d}}if(isNaN(e)&&typeof(c)!="undefined"){return c}return e},numberFormatByte:function(g,c,f,b){var e,h;var d=["B","KB","MB","GB"];var j=d.length;g=Number(g);if(isNaN(g)||g<0){return desknets.Resource.attachInvSize}c=0<c?Number(c):0;f=(0<f&&f<j)?Number(f):0;b=(neo.isSet(b)&&0<=b&&b<j)?Number(b):j-1;for(e=f;e<b&&g>1023;e++){f++;g/=1024}h=Math.pow(10,c);g=Math.ceil(g*h)/h;return desknets.numberFormat(g)+" "+d[f]},stripTags:function(b){return this.escape(a("<div />").html(b).text())},chkInArray:function(e,d,b){var c=0;for(c=d.length;c>=0;c--){if(b===true){if(d[c]===e){break}}else{if(d[c]==e){break}}}return c},getInputDataToUrl:function(c){var b=this;var e={};var d="";e=b.getInputDataToObj(c);d=desknets.getNeoParam(e);return d},getInputDataToObj:function(e){var d=this;var b={};var f="";var c="";var g;if(typeof(e)==="string"){g=a(e)}else{g=e}g.each(function(){a(this).find("input").each(function(){f=a(this).attr("name");if(f!==undefined&&f!==""){c=desknets.unescape(a(this).val());b[f]=c}})});return b},execLocation:function(c,f){var b=this;this._isCallExecLocation=true;if(neo.isSet(f)){window.open(c,f).focus()}else{try{location.href=c}catch(d){}}},isCallExecLocation:function(){return this._isCallExecLocation},clickAlink:function(b){var c=b.attr("href");var d=b.attr("target");desknets.execLocation(c,d)},clickAlinkExecEvent:function(b,c){if(desknets.browser.tablet){b.on("touchstart mousedown",function(d){c(a(this),d)})}else{b.click(function(d){if(d.which!=2&&d.which!=3){c(a(this),d)}});b.mousedown(function(d){if(d.which==2||d.which==3){c(a(this),d)}})}},moveScroll:function(){a("html, body").scrollTop(0)},getErrMailTransmitMsg:function(){var c=this;var b=desknets.Resource.Message.com_notice_settransmit;b=desknets.tmpl.replaceWordHtml(b,"module",c.getUrl(c.MODULE_MAIN));b=desknets.tmpl.replaceWordHtml(b,"cmd",c.CMD_PSETINDEX);return b}});(function(b){desknets.submitform={setButton:function(c,e){var d=c.find(":image, :submit, :button");d.attr("disabled",e)},setDisabled:function(d){var c=this;c.setButton(d,true)},clearDisabled:function(d){var c=this;c.setButton(d,false)},setDialogDisabled:function(d){var c=this;var e=d.parent();c.setButton(e,true);e.find(".ui-icon-closethick").bind("click",function(){return false})},clearDialogDisabled:function(d){var c=this;var e=d.parent();c.setButton(e,false);e.find(".ui-icon-closethick").unbind("click")},setEnterSubmit:function(c){c.keypress(function(e){var f=13;var g=e.keyCode;var d=e.target.type;if(g==f&&d!="button"&&d!="submit"&&d!="textarea"){e.preventDefault()}})},setBackSpaseEvent:function(c){var d=function(g){var e=8;var h=(g.keyCode!=0)?g.keyCode:g.charCode;var f=g.target.type;if(h==e&&f!="text"&&f!="textarea"&&f!="password"){g.preventDefault()}};c.keydown(d)},}})(jQuery);desknets.ajax={RESTYPE_JSON:"json",RESTYPE_HTML:"html",REQTYPE_MULTI:"multi",REQTYPE_SINGLE:"single",_showErrorDialog:true,numberForStatus:{parsererror:1000,abort:1001},onError:function(b,c){if(this._showErrorDialog&&b!=this.numberForStatus.abort){desknets.dialog.alert(c,{errorNo:b})}},rest:function(b){if(typeof b.data=="object"&&b.processData!==false){if(b.allowCsrfTempl!==false){this._addParamForCsrf(b.data)}delete b.allowCsrfTempl;if(b.allowCacheTempl!==false){this._addParamForNoCache(b.data)}delete b.allowCacheTempl}this._setUpOptions(b);neo.ajax.rest(b)},getJsonItems:function(b){if(!b||!b.list){return[]}else{return this.getItems(b.list.item)}},getItems:function(b){if(!b){return[]}else{if(!a.isArray(b)){return[b]}else{return b}}},arrayToMultiCmdData:function(c){var b={};a.each(c,function(d,e){b[d.toString()]=e});return{multicmd:JSON.stringify(b)}},addParamForCsrf:function(b){this._addParamForCsrf(b)},addParamForNoCache:function(b){this._addParamForNoCache(b)},getErrorNumber:function(c,b){if(c.status!=0){return c.status}else{return this.numberForStatus[b]||0}},_setUpOptions:function(c){var b=this;if(typeof(c.dataType)!=="string"){c.dataType="json"}if(!a.isFunction(c.error)){c.error=function(e,d,f){b.onError(b.getErrorNumber(e,d),f)}}},_addParamForCsrf:function(c){var b=a.cookie(desknets.COOKIENAME_STOKEN);if(!!b&&!c[b]){c[b]="1"}},_addParamForNoCache:function(c){var b=desknets.createRandomId();if(!!b&&!c[b]){c[b]=""}},initSetUp:function(){var b=this;neo.ajax.defaultOptions.beforeSend=function(d,c){b.extendRequestUrl(c)}},extendRequestUrl:function(d){var c=this;if(typeof d.url=="string"&&typeof d.data=="string"){var g="",b=250,f=d.data.match(/^(.*&)?multicmd=([^&]+)/);var h=!!f?JSON.parse(neo.decodeURIComponent(f[2])):null;if(!!h){for(var e=0;!!h[e.toString()];e++){g+=e+"/"+c.getPath(h[e.toString()])}}else{g=c.getPath(neo.parseQueryString(d.data))}if(g.length>0){g=d.url+"/"+g;f=g.match(/^((\w+:\/\/[^/]+)?\/)?([^/]*\/){0,10}/);if(!!f){g=f[0]}if(g.length>b){g=g.substring(0,b).replace(/\/[^/]*$/,"/")}d.url=g}}},getPath:function(f){var b=this;var e="",d;if(!!f.cmd){e+=f.cmd+"/";for(var c in f){if(!!c.match(/^(\w+_)?id$/)){d=typeof f[c]=="object"?"%5B...%5D":f[c];if(!!d){e+=c+"/"+d+"/"}}}}return e},};a.extend(desknets.ajax,{_$loading:a(),init:function(){var b=this;b._$loading=a("#dn-loading");a.ajaxSetup({traditional:true});a(document).bind("ajaxStart",function(){b._showLoadingTip()});a(document).bind("ajaxStop",function(){b._hideLoadingTip()});a(window).bind("beforeunload.ajax",function(){b._showErrorDialog=false});a(document).bind("ajaxSend",function(){b._showErrorDialog=true});desknets.ajax.initSetUp()},submitForm:function(b,c){if(!c.data){c.data={}}if(typeof c.data=="object"&&c.processData!==false){this._addParamForCsrf(c.data)}this._setUpFormOptions(c);neo.ajax.submitForm(b,c)},chkAjaxHtmlError:function(f){var e={status:"ok"};var b=a("<div>"+f+"</div>");var d=b.find(".co-message-box");if(d.hasClass("alert")||d.hasClass("error")){var c=d.find(".co-message").find("span").html();if(d.hasClass("alert")){c="W:"+c}e.status="ng";e.no="";e.message=c}return e},_showLoadingTip:function(){var b=this;this._$loading.show();if(desknets.browser.tablet){this._updateLoadingTipPosition();a(window).on("resize scroll",function(){b._updateLoadingTipPosition()})}},_hideLoadingTip:function(){var b=this;if(desknets.browser.tablet){a(window).off("resize scroll",function(){b._updateLoadingTipPosition()})}this._$loading.hide()},_updateLoadingTipPosition:function(){if(this._$loading.length>0){desknets.pageframe.updateFixedPosition(this._$loading)}},_setUpFormOptions:function(d){var c=this;var b=d.beforeSerialize;d.beforeSerialize=function(e,f){c._addParamForNoCache(f.data);if(typeof b=="function"){return b.apply(e,[e,f])}};this._setUpOptions(d)}});desknets.pageframe={ID_SUBWIN_OPEN_TOGGLE:"#dn-s-toggle",DATA_HELPCMD:"helpcmd",_TMPL_PROCESSING:'<div id="dn-processing" class="co-position-fixed co-bottom-tip" data-position="center bottom"><div class="dn-loading-message">{{L_Processing}}</div></div>',_layers:[],_availableModules:null,_$topMsgPwd:null,_$processing:a(),init:function(){var b=this;this._initPsetMenu();this._initSideMenu();desknets.ntwi.init();desknets.tags.init();desknets.hsearch.init();this._viewTopMsgPwd();b._initPageFrameRegistryEvent();b._initLayerManager();desknets.dateTime.init();desknets.dialog.init();desknets.popUp.init();desknets.chooser.init();desknets.refDialog.init();a("#co-m-h-setting-link").data("position","bottom");this.setUpSetmenu(a("#co-m-h-setting-menus"))},getLoginUid:function(){return a("#jco-loginuid").val()},getLoginName:function(){return a("#dn-h-username").text()},getLoginDefGroup:function(){return a("#jco-logindefgroup").val()},getLoginImageUrl:function(){return a("#jco-loginimg").val()},getLoginMailLink:function(){return a("#jco-loginmaillink").val()},getLoginConnectMail:function(){return a("#jco-loginconnectmail").val()},getCommonLang:function(){return a("#jco-commonlang").val()},getMailUse:function(){return a("#jco-mailuse").val()},getServerDate:function(){return desknets.dateTime.current},isShownMenu:function(b){if(a.type(this._availableModules)!="array"){var c=String(a(document.body).data("available-modules"));this._availableModules=c.split(",")}return a.inArray(b,this._availableModules)>=0},isCost:function(){return desknets.pageframe.isShownMenu("cost")},isUserInfoDisp:function(){return a("#jco-userinfodisp").val()=="1"?true:false},getUserNoDispItems:function(){return a("#jco-usernodispitems").val()},getUserDispItems:function(){return a("#jco-user-dispitems").val()},getHelpHomeUrl:function(){return String(a("#dn-h-usermenu>ul>li:last-child>a").attr("href"))},isSubWinOpen:function(){var b=a("body");return b.hasClass("dn-side-open")||b.hasClass("dn-side-fit")},closeSubWin:function(){if(a("body").hasClass("dn-side-open")){desknets.menu.close()}},setFuncSel:function(b){a("#"+b).addClass("on")},setUpSetmenu:function(c){var b=c.find(":not(.hplink)>a.co-m-h-setting-list-label");var d=a("#jco-pv-funcid").val();b.click(function(f){b.not(a(this)).removeClass("on").next().hide().removeClass("on");a(this).toggleClass("on").next().toggle(0,function(){a(this).toggleClass("on",!!a(this).filter(":visible").length)});f.preventDefault()});c.find("li.co-setting-toggle").children("a").click(function(f){f.preventDefault();var g=a(this).parent();g.siblings().removeClass("open");g.toggleClass("open")});b.filter(":first").addClass("on").next().show().addClass("on");var e=b.eq(1);if(!a.isEmptyObject(e)&&e.parent().hasClass("mglink")){e.addClass("on").next().show().addClass("on")}if(d){a("li.co-setting-toggle").find("#"+d).parents("li.co-setting-toggle",a("li.co-setting-toggle")).addClass("open")}},executeDefaultClickAction:function(){a(document.body).click()},viewTopMsg:function(c,g,b){var f=this.getTopMsg();if(this._$topMsgPwd&&this._$topMsgPwd.length>0){this._$topMsgPwd.hide()}if(f.length<=0){var e='<div class="co-topmsg"><span class="co-topmsg-text"><a class="co-btn co-btn-close" href="#" title="'+desknets.Resource.closeLabel+'">x</a><span id="co-topmsg-text-set"></span></span></div>';a(e).appendTo(document.body);f=this.getTopMsg()}if(c!==""){f.find("#co-topmsg-text-set").html(c)}if(g!==""){f.removeClass();f.addClass("co-topmsg-text");if(g!=""){f.addClass(g)}}var d=true;if(f.hasClass("error")||f.hasClass("alert")||b===false){d=false}this._viewTopMsg(f,d)},_viewTopMsg:function(e,b){var f=true;var c=null;var d=10000;e.closest(".co-topmsg").appendTo(document.body);if(e.css("display")=="none"){if(b===true){c=setInterval(function(){if(f){e.fadeOut("slow");clearInterval(c)}},d)}}if(e.length>0){e.css({top:-1*e.height(),display:"inline-block"}).animate({top:0},{duration:"slow"}).hover(function(){f=false},function(){f=true}).find(".co-btn-close").click(function(g){g.preventDefault();a(this).parent().hide();if(c!==null){clearInterval(c)}})}},closeTopMsg:function(){this.getTopMsg().hide()},viewTopMsgFromID:function(d){var c={error:"error",warn:"alert",message:"info"};d=d.split(",");var e="";var h;for(var f=0;f<d.length;f++){var g=desknets.Resource.Message[d[f]];var b=desknets.parseErrorInfo(g);if(e!=""){e+="<br />"}else{h=b.level}e=e+b.message}if(e!=""){this.viewTopMsg(e,c[h])}},getTopMsg:function(){return a(".co-topmsg-text").filter(":not(.jco-topmsg-pwdlimit-text)")},_viewTopMsgPwd:function(){this._$topMsgPwd=a(".jco-topmsg-pwdlimit-text");this._viewTopMsg(this._$topMsgPwd,false)},executeOnTipShown:function(c){var d=this._getProcessingTip();var b=function(){if(d.length>0){desknets.pageframe.updateFixedPosition(d)}};d.show();if(desknets.browser.tablet){b();a(window).on("resize scroll",b)}setTimeout(function(){c();if(desknets.browser.tablet){a(window).off("resize scroll",b)}d.hide()},1)},updateFixedPosition:function(b){var c=b.data("position");b.css("left",this._getFixedX(b,c)+"px");b.css("top",this._getFixedY(b,c)+"px")},notifyToShowLayer:function(b){var c=this;b.each(function(){if(a.inArray(this,c._layers)<0){if(c._layers.length<=0){a("html").addClass("co-has-layers")}c._layers.push(this)}})},notifyToHideLayer:function(b){var c=this;b.each(function(){var d=a.inArray(this,c._layers);if(d>=0){c._layers.splice(d,1);if(c._layers.length<=0){a("html").removeClass("co-has-layers")}}})},_initSideMenu:function(){var b=a(document.body);if(b.is(".dn-palette-menu")){desknets.menu.bar.initSideMenu()}else{if(b.is(".dn-slide-menu")){desknets.menu.frame.initSideMenu()}}},_initPsetMenu:function(){a("#dn-h-usermenu .co-setting-toggle").children("a").click(function(b){b.preventDefault();var c=a(this);c.closest(".co-setting-toggle").toggleClass("open")});if(desknets.pageframe.isCost()){a("#co-cost-list-open").click(function(b){b.preventDefault();desknets.popUp.hide(a(this));desknets.cost.list.open()})}else{a("#jco-cost-setting-link").hide()}},_initPageFrameRegistryEvent:function(){var b=this;a(".co-guide-toggle").click(function(c){c.preventDefault();a(this).closest(".co-guide-item").toggleClass("on")});a(".jco-helplink").click(function(d){d.preventDefault();a("body").click();var e=a(this).data(b.DATA_HELPCMD);var c=a(this).attr("href");var f=a(this).attr("target");if(neo.isSet(e)){c=c+e+".html"}desknets.execLocation(c,f)})},_initLayerManager:function(){var b=this;var c=a(document);c.bind("dialogopen",function(d){b.notifyToShowLayer(a(d.target))});c.bind("dialogclose",function(d){b.notifyToHideLayer(a(d.target))});c.bind("open.popup",function(d){b.notifyToShowLayer(a(d.target))});c.bind("close.popup",function(d){b.notifyToHideLayer(a(d.target))})},_getProcessingTip:function(){if(this._$processing.length<=0){var c=desknets.Resource,b=this._TMPL_PROCESSING;b=desknets.tmpl.replaceWordHtml(b,"L_Processing",c.processingLabel);this._$processing=a(b).appendTo(document.body)}return this._$processing},_getFixedX:function(c,b){var e=["left","center","right"];for(var d=0;d<e.length;d++){if(b.indexOf(e[d])>=0){return window.scrollX+(window.innerWidth-c.outerWidth())*(d/2)}}return 0},_getFixedY:function(c,b){var e=["top","middle","bottom"];for(var d=0;d<e.length;d++){if(b.indexOf(e[d])>=0){return window.scrollY+(window.innerHeight-c.outerHeight())*(d/2)}}return 0}};desknets.logout={init:function(){var b=this;var d="";var c={};a("#jco-logout").click(function(e){e.preventDefault();d=desknets.getUrl(desknets.MODULE_API_MAIN);c={cmd:"logout"};desknets.ajax.rest({url:d,data:c,success:function(g,f,h){b._logout(g)}})})},_logout:function(e){var b=this;var d="";var c=e.logouturl;desknets.saveCookie(desknets.COOKIENAME_SESSION_ID,"");desknets.saveCookie(desknets.COOKIENAME_STOKEN,"");d=desknets.getUrl(desknets.MODULE_MAIN);a(window).off("beforeunload.pageBase");d=d+"?cmd=login";if(c){if(c=="close"){window.open("about:blank","_self").close()}else{d=c}}desknets.execLocation(d)}};desknets.dialog={_idPrefix:"neodialog-",_dialogOptions:{modal:true,closeOnEscape:false,dialogClass:"dn-dialog",width:400,minHeight:63,closeText:desknets.Resource.closeLabel,draggable:true,resizable:false},init:function(){var b=this;a(window).bind("hashchange",function(c){b.closeAll()});a(document).bind("dialogopen",function(c){var d=a(c.target);if(desknets.browser.msie8){b._reflectBeforeStyle(d)}b.moveToDefaultPosition(d)})},alert:function(e,c){var b=this;var d=a.extend({extraMessage:null,extraClass:"",btnLabel:desknets.Resource.closeLabel},c);var g={buttons:{},beforeclose:function(h){if(typeof(d.close)=="function"){return d.close.apply(this)}},close:function(h){b.deleteById(d.type)}};var f=this._createMessage(e,d);g.title=desknets.Resource[d.type+"DefaultTitle"],g.buttons[d.btnLabel]=function(){a(this).dialog("close")};return this._openMessageDialog(f,d,g)},confirm:function(f,c,d){var b=this;var e=a.extend({extraMessage:null,extraClass:"",btnLabelOk:desknets.Resource.ConfOKButtonLabel,btnLabelCancel:desknets.Resource.ConfCancelButtonLabel},d);var g={title:desknets.Resource.confirmDefaultTitle,beforeclose:function(h){return b._onBeforeCloseConfirm(h,a(this),c,e.cancel)},close:function(h){b.deleteById("confirm")},buttons:{},open:function(){a(this).parent().find(".ui-dialog-buttonpane button:eq(1)").focus()}};g.buttons[e.btnLabelOk]=function(){a(this).data("result","ok").dialog("close")};g.buttons[e.btnLabelCancel]=function(){a(this).data("result","cancel").dialog("close")};return this._openMessageDialog(f,e,g)},ask:function(b,d,c){return this.confirm(b,c,{answers:d,btnLabelOk:desknets.Resource.OKButtonLabel,btnLabelCancel:desknets.Resource.CancelButtonLabel})},make:function(e,b){var d={error:"error",warn:"alert",message:"info",confirm:"confirm"};var c=this._getById(e);if(!c){if(!!d[e]){b.dialogClass=b.dialogClass||this._dialogOptions.dialogClass;b.dialogClass+=" message "+d[e]}c=a("<div />").addClass(e).appendTo(a(document.body));this.setUp(c,b);c.closest(".ui-dialog").attr("id",this._idPrefix+e)}return c},setUp:function(b,c){if(b.closest(".ui-dialog").length<=0){var e=this._getActualOptions(c);b.dialog(e)}var d=b.closest(".ui-dialog").find(".ui-dialog-titlebar-close");d.attr("title",d.text());return b},moveToDefaultPosition:function(c){var b=a(window).innerWidth();var g=a(window).innerHeight();var e=c.width();var j=c.height();var f,i;var d=Math.floor((b-e)/2);var h=Math.min(Math.floor((g-j)/2),100);if(desknets.browser.tablet){f=window.top.scrollY;i=window.top.scrollX;d=d-i;h=h-f}c.dialog("option","position",[d,h]);if(desknets.browser.tablet){a(window).scrollTop(h+f);a(window).scrollLeft(d+i)}},closeAll:function(){a(".ui-dialog-content:visible").each(function(){var b=a(this);if(b.dialog("isOpen")){b.dialog("close")}})},deleteById:function(c){var b=this._getById(c);if(b){b.dialog("destroy").remove()}},deleteAll:function(b){a(".ui-dialog-content").each(function(){var c=a(this);if(!b||!c.dialog("isOpen")){c.dialog("destroy").remove()}})},getDialogOption:function(){var b=a.extend({},this._dialogOptions);return b},setFirstDialogOpen:function(b){this.moveToDefaultPosition(b)},isCloseButtonEvent:function(d){var c=".ui-dialog-titlebar-close";while(!!d){var b=a(d.target);if(d.type=="click"&&b.closest(c).length>0){return true}d=d.originalEvent}return false},_onBeforeCloseConfirm:function(d,e,c,f){var b=e.data("result");e.data("result","");if(this.isCloseButtonEvent(d)){b="cancel"}if(b=="ok"&&typeof(c)=="function"){return c.apply(e[0],[this._getCheckedOptions(e)])}if(b=="cancel"&&typeof(f)=="function"){return f.apply(e[0])}},_openMessageDialog:function(d,f,b){var g=f.type||"confirm";var c=this._getById(g);var e=this.make(g,b);this._setMessage(e,d);this._setCheckableOptions(e,g,f.checkableOptions);this._setAnswers(e,f.answers);this._setAddMessage(e,f.extraMessage,f.extraClass);e.dialog("open");if(!c){this.setFirstDialogOpen(e)}return e},_getCheckedOptions:function(c){var b={};c.find("input:checked").each(function(){b[this.name]=this.value});return b},_createMessage:function(d,c){var b=desknets.parseErrorInfo(d,c.errorNo);if(!c.type){c.type=b.level}d=b.message.replace(/\r?\n/g,"<br />");return d},_setMessage:function(d,c){var b=d.find(">.co-message>span");if(b.length<=0){b=a("<span />");a('<h3 class="co-message" />').append(b).appendTo(d)}b.html(c)},_setAddMessage:function(d,c,e){var b=d.find(">.co-submessage>span");if(!!c){if(b.length<=0){b=a("<span />");a('<div class="co-submessage" />').append(b).appendTo(d)}b.attr("class",e).html(c)}else{if(b.length>0){b.parent().remove()}}},_setCheckableOptions:function(f,h,c){if(!!c){var b=a("<ul />");for(var d in c){var g=a("<li />").appendTo(b);var e="co-option-"+h+"-"+d;a('<input type="checkbox" value="on" />').attr("id",e).attr("name",d).appendTo(g);a("<label/>").attr("for",e).html(c[d]).appendTo(g)}a('<div class="co-dialog-answers co-checkboxes" />').append(b).appendTo(f)}},_setAnswers:function(e,f){if(!!f){var b=a("<ul />");for(var c in f){var g=a("<li />").appendTo(b);var d="jco-dialog-answer-"+c;a('<input type="radio" name="answer" />').attr("id",d).val(c).appendTo(g);a("<label/>").attr("for",d).html(f[c]).appendTo(g)}a('<div class="co-dialog-answers co-radios" />').append(b).appendTo(e);b.find("input").eq(0).attr("checked",true)}},_getById:function(c){var b=a("#"+this._idPrefix+c);if(b.length>0){return b.children(".ui-dialog-content")}return null},_getActualOptions:function(b){var c={autoOpen:false};a.extend(c,this._dialogOptions,b);if(a.type(c.zIndex)=="undefined"){c.zIndex=c.modal?4000:1000}return c},_reflectBeforeStyle:function(d){var b=d.find(".co-colon");var c=d.find(".co-required");b.attr("class","");c.attr("class","");setTimeout(function(){b.attr("class","co-colon");c.attr("class","co-required")},1)}};desknets.dateTime={current:new Date(2000,0,1),_dtTimer:null,init:function(){var b=this;var c=neo.dateTime.parse(a("#jco-servertime").val());if(!!c){b.setDateTime(c);a(document).bind("ajaxComplete",function(e,f,d){b._updateWithServerTime(f)})}},setDateTime:function(b){var c=this.current;this.current=b;this._updateDateTimeAtNextMinute(b);if(neo.dateTime.compareOn(c,b,"minute")!=0){a(document).trigger("minuteChanged.desknets")}},moveDate:function(c,d){var b=neo.dateTime.parse(c);if(b==null){return null}b=neo.dateTime.moveDate(b,Number(d));return neo.dateTime.format("yyyyMMdd",b)},moveMonth:function(c,b){c=String(c).substr(0,6);return this.computeMonth(c,b)},computeMonth:function(d,b){var c=neo.dateTime.parse(String(d));if(c==null){return null}c=neo.dateTime.moveMonth(c,Number(b));return neo.dateTime.format("yyyyMMdd",c)},formatDate:function(d,c){var e=desknets.Resource.dateFormat;var b=desknets.dateTime.current;if(a.type(c)!="date"){c=neo.dateTime.parse(c)}if(d=="s"&&b.getFullYear()==c.getFullYear()){e=desknets.Resource.shortDateFormat}return neo.dateTime.format(e,c)},formatDateTime:function(d,c){var e=desknets.Resource.dateTimeFormat;var b=desknets.dateTime.current;if(a.type(c)!="date"){c=neo.dateTime.parse(c)}if(d=="s"&&b.getFullYear()==c.getFullYear()){e=desknets.Resource.shortDateTimeFormat}return neo.dateTime.format(e,c)},formatHour:function(e,d){var c="20120101"+d;var b=neo.dateTime.parse(c);return neo.dateTime.format(e,b)},dispDateTime:function(f,c){var e;if(!neo.isSet(f,{blank:false})){return"&nbsp;"}e=neo.dateTime.parse(f);if(jQuery.type(c)==="string"){return neo.dateTime.format(desknets.Resource[c],e)}else{var d=false;if(f.length>=12){d=true}else{if(f.length>=8){d=false}else{return"&nbsp;"}}var b={type:""};if(neo.isSet(c)){a.extend(b,c)}if(b.type=="list"){if(d){return desknets.dateTime.dispListDateTime("datetime",e)}else{return desknets.dateTime.dispListDateTime("date",e)}}else{if(d){c="longDateTimeFormat"}else{c="longDateFormat"}return neo.dateTime.format(desknets.Resource[c],e)}}},dispListDateTime:function(d,c){var e=desknets.Resource.dateFormat;var b=desknets.dateTime.current;if(a.type(c)!="date"){c=neo.dateTime.parse(c)}if(b.getFullYear()==c.getFullYear()){if(d=="datetime"){e=desknets.Resource.shortDateTimeFormat}else{e=desknets.Resource.shortDateFormat}}else{if(d=="datetime"){e=desknets.Resource.dateTimeFormat}else{e=desknets.Resource.dateFormat}}return neo.dateTime.format(e,c)},_updateDateTimeAtNextMinute:function(d){var c=this;var b=(60-d.getSeconds())*1000-d.getMilliseconds();var e=new Date(d.getTime()+b);if(!!c._dtTimer){clearTimeout(c._dtTimer)}c._dtTimer=setTimeout(function(){c._dtTimer=null;c.setDateTime(e)},Math.max(b,100))},_updateWithServerTime:function(d){var c=neo.ajax.getDataValue(d,"servertime");var b=neo.dateTime.parse(String(c));if(!!b){this.setDateTime(b)}},};a.fn.dnclick=function(d,e,h,l){var f=[e,h];var b=a.extend({delay:300,stopInterval:800,ignoreOnModifierKey:false},l);function c(m,o){o.status="suspend";o.timer=setTimeout(function n(){m.removeData("dn-click")},b.stopInterval);m.data("dn-click",o)}function j(o,m){var p=m.data("dn-click");if(!!p){var n=Math.min(p.count-1,f.length-1);if(typeof f[n]=="function"){f[n].apply(m[0],[o])}c(m,p)}}function g(n,m){var p={count:0,timer:null,status:"ready"};var o=a.extend(p,m.data("dn-click"));if(!!o.timer){clearTimeout(o.timer)}if(o.status=="ready"){o.count++;if(o.count>=f.length){m.data("dn-click",o);j(n,m)}else{o.timer=setTimeout(function(){j(n,m)},b.delay);m.data("dn-click",o)}}if(o.status=="suspend"){c(m,o)}}function k(m){if(!!m.originalEvent&&!!m.originalEvent.detail){return m.originalEvent.detail}return m.type=="dblclick"?2:1}function i(m){if(!!b.ignoreOnModifierKey){if(m.altKey||m.ctrlKey||m.metaKey||m.shiftKey){return false}}return true}return this.each(function(){a(this).delegate(d,"click",function(n){if(i(n)){n.preventDefault();var m=k(n);if(m!=2){if(m%2==0){n.type="dblclick"}g(n,a(this))}}});a(this).delegate(d,"dblclick",function(m){if(i(m)){m.preventDefault();if(k(m)==2){g(m,a(this))}}})})};a.widget("desknets.dndscroll",a.ui.mouse,{_x:0,_y:0,_timers:null,_$pressedButton:a(),options:{moveToDrag:true,leftButton:null,rightButton:null,moveInterval:100,movePixel:10},destroy:function(){this.element.find(".jco-dndscroll-btn").unbind("."+this.widgetName);this._mouseDestroy();this.element.removeClass("co-scrollable co-drag-scrollable")},_create:function(){this._timers={};this.element.addClass("co-scrollable");if(!!this.options.moveToDrag){this.element.addClass("co-drag-scrollable")}this._initMoveButton("leftButton");this._initMoveButton("rightButton");this._mouseInit()},_mouseStart:function(c,b){this._x=c.pageX+this.element.scrollLeft();this._y=c.pageY+this.element.scrollTop();if(!b){return false}if(!!c.eventPhase&&c.eventPhase<=2){this.element.trigger("mouseup");return false}this._trigger("start",c);return this.options.moveToDrag},_mouseDrag:function(b){this.element.scrollLeft(this._x-b.pageX);this.element.scrollTop(this._y-b.pageY);this._trigger("drag",b)},_mouseStop:function(b){this._trigger("stop",b)},_initMoveButton:function(c){var b=this;var d=a(this.options[c]);if(d.length>0){d.addClass("jco-dndscroll-btn").data("dndscroll-key",c);d.bind("click."+this.widgetName,function(e){e.preventDefault()});d.bind("mousedown."+this.widgetName,function(e){b._startToMove(d)});d.bind("mouseup."+this.widgetName,function(e){b._stopToMove(d)});d.bind("mouseleave."+this.widgetName,function(e){b._stopToMove(d)})}},_startToMove:function(d){var b=this;var c=d.data("dndscroll-key");if(!!c){b._$pressedButton=d;b._timers[c]=setInterval(function(){b._executeToMove()},b.options.moveInterval);b._executeToMove()}},_executeToMove:function(){var b=this._$pressedButton.data("dndscroll-key");var c=this.element.scrollLeft();if(b=="leftButton"){this.element.scrollLeft(c-this.options.movePixel)}else{if(b=="rightButton"){this.element.scrollLeft(c+this.options.movePixel)}}},_stopToMove:function(c){var b=c.data("dndscroll-key");if(!!b&&!!this._timers[b]){clearInterval(this._timers[b]);this._timers[b]=null;this._$pressedButton=a()}}});desknets.tmpl={replaceWordChk:function(d,c,b){if(neo.isSet(b)){return this.replaceWord(d,c,b)}else{return this.replaceWord(d,c,"")}},replaceWordChkHtml:function(d,c,b){if(neo.isSet(b)){return this.replaceWordHtml(d,c,b)}else{return this.replaceWordHtml(d,c,"")}},replaceWordLF:function(b,c,d){d=this.escapeWordLF(d);return this.replaceWordHtml(b,c,d)},replaceWord:function(b,c,d){d=this.escapeWord(d);return this.replaceWordHtml(b,c,d)},replaceWordHtml:function(b,d,f){var c=new RegExp("{{"+d+"}}","ig");try{return b.replace(c,function(e,h,i){return f})}catch(g){alert(g)}},escapeWord:function(b){if(typeof b=="string"){b=desknets.escape(b);b=desknets.escapeValue(b);b=desknets.escapeSpace(b)}return b},escapeWordLF:function(b){b=this.escapeWord(b);b=b.replace(/\r\n/g,"<br />");b=b.replace(/(\n|\r)/g,"<br />");return b},dispStr:function(b){var c;if(neo.isSet(b,{blank:false})){c=desknets.tmpl.escapeWordLF(b)}else{c="&nbsp;"}return c},dispItems:function(j,o,e,f,d){var h="";var k=[];var i=[];if(!j||!j.item){return"&nbsp;"}k=desknets.ajax.getItems(j.item);if(k.length==0){return"&nbsp;"}if(o!=undefined){if(!(!o||!o.item)){i=desknets.ajax.getItems(o.item)}}for(var n=0;n<k.length;n++){var p="";var m="";var c=k[n];if(n!=0){if(d==undefined){p=",&#x0A;"}else{p=d}}if(c.val!=undefined){m=desknets.tmpl.escapeWord(c.val)}p=p+m;if(i.length>n){var g="";var b=i[n];if(b.val){g=desknets.tmpl.escapeWord(b.val)}if(g.length>0){if(e){var l=desknets.tmpl.replaceWordChkHtml(e,f,g);p=p+l}else{p=p+"("+g+")"}}}h=h+p}return h},dispMember:function(b){if(neo.isSet(b,{blank:false})){return desknets.tmpl.replaceWord(desknets.Resource.members,"members",b)}else{return"&nbsp;"}},CreateNameDelimValueHtml:function(b,c){if(desknets.Resource.code!="ja_JP"){return(b+": "+c)}return(b+" : "+c)},CreateNameDelimValue:function(b,c){if(desknets.Resource.code!="ja_JP"){return this.escapeWordLF(b+":&nbsp;"+c)}return this.escapeWordLF(b+"&nbsp;:&nbsp;"+c)}};a.extend(desknets.tmpl,{_templates:{},load:function(b,d,f,e){var c=this;var h;function g(i){b.html(i);if(typeof(f)=="function"){f()}}if(!!c._templates[d]){g(c._templates[d]);return}h={dataType:desknets.ajax.RESTYPE_HTML,type:"GET",url:desknets.getUrl(desknets.MODULE_HTML_MAIN),data:{cmd:desknets.CMD_TMPLHTML,html:d,fldlang:desknets.Resource.code,v:desknets.CACHE_VERSION},allowCacheTempl:false,allowCsrfTempl:false,success:function(k){var i=desknets.ajax.chkAjaxHtmlError(k);if(i.status=="ok"){if(!!e&&!!e.cache){c._templates[d]=k}g(k)}else{var j=desknets.dialog.alert(i.message,{errorNo:i.no})}}};if(!!e&&typeof e.error=="function"){h.error=function(k,i,j){e.error(k,i,j)}}desknets.ajax.rest(h)}});desknets.htmlparts={setSelectOption:function(c,h,d,j,k){var l=[];var e=0;var i;var g=null;var b=a.extend({tval:null,tstr:null,bval:null,bstr:null},k);if(!c.is("select")){return}if(neo.isSet(h)){e=h.length}if(neo.isSet(b.selected)){for(i=0;i<e;i++){var f=h[i];if(f[d]==b.selected){g=f[d];break}}}if(g==null&&neo.isSet(b.selected)&&neo.isSet(b.bstr,{blank:false})){if(b.bval==b.selected){g=b.bval}}if(neo.isSet(b.tstr,{blank:false})){if(g==null){g=b.tval}l[l.length]=this._getSelectTag(b.tval,b.tstr,g)}for(i=0;i<e;i++){var f=h[i];if(g==null){g=f[d]}l[l.length]=this._getSelectTag(f[d],f[j],g)}if(neo.isSet(b.bstr,{blank:false})){if(g==null){g=b.bval}l[l.length]=this._getSelectTag(b.bval,b.bstr,g)}c.html(l.join(""))},addStripeClass:function(c,d){if(desknets.browser.msie8){var b=c.children();b.removeClass(d);b.filter(":nth-child(even)").addClass(d)}},addLastClass:function(b,c){if(desknets.browser.msie8){b.children(":last").addClass(c)}},removeLastClass:function(b,c){if(desknets.browser.msie8){b.children(":last").removeClass(c)}},convertHrefInText:function(b){var c=Number(desknets.pageframe.getLoginMailLink());b.detectHref({convertMail:c>0,urlSchemas:["http","https","ftp"]});if(c>0){desknets.htmlparts.setUpMailLink(b)}},setUpForm:function(b,c){var d={required:false};if(desknets.browser.tablet){b.find("input[type=date]").prop("readOnly",true)}if(!!c){a.extend(d,c)}b.formSetUp(d);b.find(".hasDatepicker").blur(function(f){if(this.value==""){var e=a(this).datepicker("option","altField");a(e).val("")}})},setUpDateNav:function(b,c){var e=b.find(".co-ymd-cur");var d=e.data("date");e.removeData("date").removeAttr("data-date");e.click(function(g){g.preventDefault();var f=desknets.dateTime.current;if(d=="thisMonth"){f=new Date(f.getFullYear(),f.getMonth(),1)}b.neoDateNav("date",f)});b.neoDateNav(a.extend({date:desknets.dateTime.current},c))},setUpMailLink:function(c){function b(h){var f=desknets.pageframe.getLoginMailLink();if(f=="2"||f=="3"){var i=String(this.href).substring(7);var e=i;var d=e.indexOf("?");if(d>=0){e=e.substring(0,d)}if(i.indexOf("?")==-1){i+="?"}if(i[i.length-1]!="?"&&i[i.length-1]!="&"){i+="&"}i=i+"to="+e;var g=desknets.splitParam(desknets.unescape(i));desknets.webmail.openMailEditByMailLink(g,null,f);h.preventDefault()}}if(c.is('a[href^="mailto:"]')){c.click(b)}else{c.find('a[href^="mailto:"]').click(b)}},_getSelectTag:function(e,b,d){var c;if(d==e){c='<option value="'+e+'" selected="selected">'}else{c='<option value="'+e+'">'}b=desknets.tmpl.escapeWord(b);c=c+b+"</option>";return c}};desknets.attach={options:{},optionsdef:{dropFilesLimit:10,totalSizeLimit:0,existSize:0,previewFileTypes:/^image\/(gif|jpeg|png)$/,previewFileExtension:/(.gif|.jpg|.png|.jpeg|.bmp)$/i,previewMaxWidth:41,previewMaxHeight:50,previewAsCanvas:true,uploadURL:"http://192.168.210.104/cgi-bin/newdd/upload.cgi",uploadParams:{cmd:"cmd",id:"id",folder:"folder"},icon:{none:"/dneores/images/com/ext/co_ext_unknown.png"},file:{tmpnm:"",files:{}},flashObjectURL:"/dneores/objects/uploader.swf",fileSelMsgColorNormal:"#0000FF",fileSelMsgColorEnter:"#FF0000",dragColorNormal:"#E6E6E6",dragColorEnter:"#6495ed",templ:{dialog:'<div class="co-pop-body" id="jco-attachdlg">  <div class="co-pop-tp-meta">    <input class="co-pop-tp-clear-btn" type="button" value="{{deleteAll}}" disabled="disabled">    <input type="button" disabled="disabled" value="{{cancelAllUpload}}" class="co-pop-tp-stop-btn">  </div>  <div class="co-pop-tp-file">    <div class="co-pop-tp-drop">    </div>    <div class="co-pop-tp-drop-bottom">      <div class="co-pop-tp-drop-bottom-msg">            <span class="co-pop-tp-drop-msg" style="display: none;">              {{dropHere}}            </span>            <span class="co-pop-tp-choose-link" style="display: none;">              <label for="ifiles">{{clickFileSelect}}</label><br>            </span>      </div>    </div>  </div>  <div class="co-pop-tp-console">    <div class="co-pop-tp-console-msg">      {{uploadMsg}}    </div>  </div><!-- #co-pop-tp-console --></div>',area:'<div class="co-pop-tp-file-drop edit">  <div class="co-pop-tp-meta">    <input class="co-pop-tp-clear-btn" type="button" value="{{deleteAll}}" disabled="disabled">    <input class="co-pop-tp-stop-btn" type="button" value="{{cancelAllUpload}}"  disabled="disabled">  </div><!-- #co-pop-tp-meta -->  <div class="co-pop-tp-file">    <div class="co-pop-tp-drop">      <div class="co-pop-tp-def-msg demo-start">        <div class="co-pop-tp-drop-msg">        {{dropHere}}<br />        </div>        <span class="co-pop-tp-choose-link">          <label for="ifiles">{{clickFileSelect}}</label>          <input type="file" id="ifiles" size="299" multiple />        </span>      </div>    </div><!-- .co-pop-tp-drop -->    <div class="co-pop-tp-drop-bottom">      <div class="co-pop-tp-drop-bottom-msg">            <span class="co-pop-tp-drop-msg">              {{dropHere}}            </span>            <span class="co-pop-tp-choose-link">              <label for="ifiles">{{clickFileSelect}}</label><br>            </span>      </div>    </div>  </div><!-- .co-pop-tp-file -->  <div class="co-pop-tp-console">    <div class="co-pop-tp-console-msg">      {{uploadMsg}}    </div>  </div><!-- #co-pop-tp-console --></div>',detail:'<div class="co-pop-tp-file-dtl">  <div title="{{filename}}" class="co-pop-tp-file-name">{{filename}}</div>  <div class="co-pop-tp-file-size">    <div class="co-pop-tp-file-size-in">      {{filesize}}    </div>  </div>  <a href="#" class="co-pop-tp-file-del" title="{{release}}">{{delete}}</a></div>',btmMsg:'<div class="co-pop-tp-drop-bottom">  <div class="co-pop-tp-drop-bottom-msg">        <span class="co-pop-tp-drop-msg">          {{dropHere}}        </span>        <span class="co-pop-tp-choose-link">          <label for="ifiles">{{clickFileSelect}}</label><br>        </span>  </div></div>',topMsg:'<div class="co-pop-tp-console-msg">{{uploadMsg}}</div>',dropMsg:'<div class="co-pop-tp-def-msg demo-start">  <div class="co-pop-tp-drop-msg">  {{dropHere}}<br>  </div>  <span class="co-pop-tp-choose-link">    <label for="ifiles">{{clickFileSelect}}</label>  </span></div>',flashInput:'<INPUT name="s_attach" type="submit" value="{{attach}}">',flashDropMsg:'<div class="co-pop-tp-drop-msg">{{selectFromButton}}</div>',flashDropMsgOrg:'<div class="co-pop-tp-drop-msg">{{dropHere}}<br /></div>',flashBtmMsg:'<div class="co-pop-tp-drop-bottom">  <div class="co-pop-tp-drop-bottom-msg">        <span class="co-pop-tp-drop-msg">          {{selectFromButton}}        </span>  </div></div>',uploadMsg:"{{filenum}}/{{totalfilenum}} {{fileUpload}} ({{totalfilesize}})"}},debug:0,dialog:a(document),dropArea:a(document),autoUpload:true,tmpnm:"",totalSize:0,totalUploadSize:0,totalFileNum:0,totalUploadNum:0,jqXHR:"",abort:false,fileInput:{},dragEnter:false,inputDisabled:"",flashAttachElement:null,confirmDialog:null,normalElements:{},closeFunction:function(){},uploadNowDialog:a(document),ipadFileName:"ipadimg",ipadFileNo:0,uploadDialog:function(j){var h=this;this.totalSize=0;this.totalUploadSize=0;this.totalFileNum=0;this.totalUploadNum=0;var c;if(j.file!=undefined&&j.file.files!=undefined){this._ipadInitFileName(j.file.files)}this.options=a.extend({},this.optionsdef,j);var g={title:desknets.Resource.attachTitle,width:600,close:function(k){a("#jco-attachdlg").remove()},buttons:{}};var i=this._makeDialog();var e={tmpnm:"",files:new Array()};this.autoUpload=false;g.buttons[desknets.Resource.OKButtonLabel]=function(){var k=this;h._setDialogDisabled(h.dialog);h._disableFileAppend();var m=h._getUploadFile();if(m!=undefined){var l=a(m).data("file");a(m).data("sending",true);h._send(m,a(m).data("attachdisp"),l)}else{if(h.flashAttachElement!=null){if(!h._getExistFile()){c=desknets.Resource.Message.att_file_select;desknets.dialog.alert(c);h._clearDialogDisabled(h.dialog);a(".co-pop-tp-stop-btn").attr("disabled","disabled");if(a(".co-pop-tp-file-thumbs>li").size()==0){a(".co-pop-tp-clear-btn").attr("disabled","disabled")}h._enableFileAppend()}else{h._doneUploadDialog()}}else{if(!h._getExistFile()){c=desknets.Resource.Message.att_file_select;desknets.dialog.alert(c);h._clearDialogDisabled(h.dialog);a(".co-pop-tp-stop-btn").attr("disabled","disabled");if(a(".co-pop-tp-file-thumbs>li").size()==0){a(".co-pop-tp-clear-btn").attr("disabled","disabled")}h._enableFileAppend()}else{h._doneUploadDialog()}}}return};this.closeFunction=function(n){var l=this;var k=a(".co-pop-tp-flash-mode-change-btn");if(k.data("progress")!=undefined){desknets.attach._console("uploadDialog closeFunction modeBtn != undefined");return false}h._setDialogDisabled(h.dialog);h._disableFileAppend();if(a(".co-pop-tp-file-thumbs>li").size()!=0){c=desknets.Resource.Message.att_close_dialog;h._dispFlashBtn(false);var m=desknets.dialog.confirm(c,function(){h._dispFlashBtn(true);h.confirmDialog=l;a(".co-pop-tp-file").data("close",true);a(m).on("dialogclose",function(o){a(this).off("dialogclose");h._someDeleteAttachFile()});a(m).dialog("close")},{cancel:function(){h._dispFlashBtn(true);h._clearDialogDisabled(h.dialog);a(".co-pop-tp-stop-btn").attr("disabled","disabled");if(a(".co-pop-tp-file-thumbs>li").size()==0){a(".co-pop-tp-clear-btn").attr("disabled","disabled")}h._enableFileAppend()}})}else{if(h.flashAttachElement!=null){if(a(".co-pop-tp-file-thumbs>li").size()!=0){h._setDialogDisabled(h.dialog);c=desknets.Resource.Message.att_close_clear;var m=desknets.dialog.confirm(c,function(){h.confirmDialog=l;a(".co-pop-tp-file").data("close",true);a(m).on("dialogclose",function(o){a(this).off("dialogclose");h._someDeleteAttachFile()});a(m).dialog("close")},{cancel:function(){h._dispFlashBtn(true);h._clearDialogDisabled(h.dialog);a(".co-pop-tp-stop-btn").attr("disabled","disabled");if(a(".co-pop-tp-file-thumbs>li").size()==0){a(".co-pop-tp-clear-btn").attr("disabled","disabled")}h._enableFileAppend()}})}else{h._destroy();a(this).dialog("close");return true}}else{h._destroy();a(this).dialog("close");return true}}return false};g.buttons[desknets.Resource.CancelButtonLabel]=this.closeFunction;var d=desknets.dialog.getDialogOption();a.extend(d,g);this.dialog=desknets.dialog.setUp(a(i),d);this.dialog.dialog("open");var f=this.dialog.parent();f.find(".ui-icon-closethick").bind("click",g.buttons[desknets.Resource.CancelButtonLabel]);this._appendDropMessage();h._changeTopMessage(0);this._hoverDropMessage();if(!window.File){a(".co-pop-tp-drop-msg").hide()}this.dropArea=a(".co-pop-tp-file");this._initEventHandlers();if(!window.File){h._flashAddModeChangeButton();var b=a.cookie(desknets.COOKIENAME_ATTACH_IE_FLASH);if(b==null||b=="flash"){this._flashModeChange()}else{h._flashSetModeChangeButton("flash")}}if(j.file!=undefined){h.options.existSize=0;a.each(j.file.files,function(k){h.options.existSize+=this.size})}if(j.file!=undefined&&j.file.tmpnm!=undefined){if(j.file.tmpnm==""){this.tmpnm==""}else{this.tmpnm=j.file.tmpnm}}a(".co-pop-tp-stop-btn").attr("disabled","disabled");this._hoverDropMessage()},_doneUploadDialog:function(){var b={tmpnm:this.tmpnm,files:new Array()};var c=a(".co-pop-tp-file-thumbs>li");a.each(c,function(d){var e=a(this).data("response");if(e!=undefined){b.files[d]=e;b.files[d]["overwrite"]=a(this).data("overwrite")}else{b.files[d]={attachdisp:a(this).data("attachdisp"),size:a(this).data("size"),fno:a(this).data("fno"),overwrite:a(this).data("overwrite")}}});this.options.done(b);this._destroy();a(this.dialog).dialog("close")},_console:function(b){if(desknets.attach.debug){if(window.console){console.log(b)}}},upload:function(c){var f=this;this.totalSize=0;this.totalUploadSize=0;this.totalFileNum=0;this.totalUploadNum=0;if(c.file!=undefined&&c.file.files!=undefined){this._ipadInitFileName(c.file.files)}this.options=a.extend({},this.optionsdef,c);var b=this._makeDropArea();a(c.fileDrop).append(b);if(!window.File){a(".co-pop-tp-drop-msg").hide()}this.dropArea=a(".co-pop-tp-file");this._initEventHandlers();a(".co-pop-tp-stop-btn").hide();this._removeButtomMessage();this.attachInput();if(this.options.file.tmpnm!=undefined){if(this.options.file.tmpnm==""){this.tmpnm==""}else{this.tmpnm=this.options.file.tmpnm}}var e;if(c.file!=undefined){a.each(c.file.files,function(h){if(this.updtime==undefined){this.updtime=desknets.createRandomId()}var g=f._getDownloadUrl(c.downloadURL,this.fno,this.attachdisp,this.updtime);var i=f._getDownloadUrl(c.imgSrcURL?c.imgSrcURL:c.downloadURL,this.fno,this.attachdisp,this.updtime);e={name:this.attachdisp,fname:this.attachdisp,size:this.size,fno:this.fno,updtime:this.updtime,srcUrl:g,imgSrc:i};f._addFile(e,true);f._changeTopMessage(this.size)})}if(this.fileInput===undefined){this.fileInput=a("#ifiles")}else{if(!this.fileInput){this.fileInput=a()}}this.autoUpload=true;a(".co-pop-tp-stop-btn").attr("disabled","disabled");this._hoverDropMessage();this._setDropMessage();this._changeTopMessage(0);if(!window.File){f._flashAddModeChangeButton();var d=a.cookie(desknets.COOKIENAME_ATTACH_IE_FLASH);if(d==null||d=="flash"){this._flashModeChange()}else{f._flashSetModeChangeButton("flash")}}},getAttachFileInfo:function(){var b={tmpnm:"",files:new Array()};b.tmpnm=this.tmpnm;var c=a(".co-pop-tp-file-thumbs>li");a.each(c,function(d){var e=a(this).data("response");if(e!=undefined){b.files[d]=e}else{b.files[d]={attachdisp:a(this).data("attachdisp"),size:a(this).data("size"),fno:a(this).data("fno")}}});return b},deleteAttachFile:function(c){var b=c.delURL;var d=c.delParams;if(d.tmpnm==undefined){if(this.tmpnm!=""){d.tmpnm=this.tmpnm}}else{if(d.tmpnm==""){delete d.tmpnm;this.tmpnm==""}}d.resformat="xml";desknets.ajax.rest({dataType:"xml",url:b,data:d,type:"POST",headers:{"cache-control":"no-cache"},success:function(g,e,h){var f=a(g.documentElement);var e=f.find("status").text();c.done(e)}})},getDownloadUrl:function(b){if(b.updtime==undefined){b.updtime=desknets.createRandomId()}return(this._getDownloadUrl(b.imgSrcURL?b.imgSrcURL:b.downloadURL,b.fno,b.attachdisp,b.updtime))},getThumbnailImage:function(d,c){var f=this,g;var b=a('<img alt="img">').hide().on("load",function(){f._scaleImage(this,c)});if(c!=undefined){f.options=a.extend({},this.optionsdef,c)}else{f.options=a.extend({},this.optionsdef)}if(d.updtime==undefined){d.updtime=desknets.createRandomId()}if(d.fname==undefined){d.fname=d.name}if(!this.options.previewFileExtension||this.options.previewFileExtension.test(this._getFileExtension(d.fname))){g=this._getDownloadUrl(d.url,d.fno,d.fname,d.updtime);a(b).attr({src:g})}else{var e=f._getFileExtension(d.fname);a.each(f.options.icon,function(h){reg=new RegExp(h+"$","i");if(reg.test(e)){g=this;return false}});if(g){a(b).attr("src",g)}else{a(b).attr({src:this.options.icon.none})}}return b},detachInput:function(){a("#ifiles").detach()},attachInput:function(){a(".co-pop-tp-choose-link:visible").append('<input type="file" id="ifiles" size="299" tabindex="-1" multiple>');if(a(".co-pop-tp-file").data("disableFileAppend")==true){a("#ifiles").attr("disabled","disbled")}a("#ifiles").on("change",{attach:this},this._onChange)},_destroy:function(){this.totalSize=0;this.totalUploadSize=0;this.totalFileNum=0;this.totalUploadNum=0;this.flashAttachElement=null;this._destroyEventHandlers();a(".co-pop-tp-file-thumbs").remove();a(".co-pop-tp-drop-bottom").remove()},_makeDialog:function(){var b;b=this.options.templ.dialog;b=desknets.tmpl.replaceWord(b,"deleteAll",desknets.Resource.attach.deleteAllLabel);b=desknets.tmpl.replaceWord(b,"cancelAllUpload",desknets.Resource.attach.cancelAllUploadLabel);b=desknets.tmpl.replaceWord(b,"dropHere",desknets.Resource.attach.dropHereLabel);b=desknets.tmpl.replaceWord(b,"clickFileSelect",desknets.Resource.attach.clickFileSelectLabel);b=desknets.tmpl.replaceWord(b,"uploadMsg",this.options.templ.uploadMsg);b=desknets.tmpl.replaceWord(b,"fileUpload",desknets.Resource.attach.fileUploadLabel);b=desknets.tmpl.replaceWord(b,"filenum","0");b=desknets.tmpl.replaceWord(b,"totalfilenum","0");b=desknets.tmpl.replaceWord(b,"totalfilesize","0 B/0 B");return b},_makeDropArea:function(){var b;b=this.options.templ.area;b=desknets.tmpl.replaceWord(b,"deleteAll",desknets.Resource.attach.deleteAllLabel);b=desknets.tmpl.replaceWord(b,"cancelAllUpload",desknets.Resource.attach.cancelAllUploadLabel);b=desknets.tmpl.replaceWord(b,"dropHere",desknets.Resource.attach.dropHereLabel);b=desknets.tmpl.replaceWord(b,"clickFileSelect",desknets.Resource.attach.clickFileSelectLabel);b=desknets.tmpl.replaceWord(b,"uploadMsg",this.options.templ.uploadMsg);b=desknets.tmpl.replaceWord(b,"fileUpload",desknets.Resource.attach.fileUploadLabel);b=desknets.tmpl.replaceWord(b,"filenum","0");b=desknets.tmpl.replaceWord(b,"totalfilenum","0");b=desknets.tmpl.replaceWord(b,"totalfilesize","0 B/0 B");return b},_appendThumbnailArea:function(){var b;b='<ul class="co-pop-tp-file-thumbs"></ul><!-- #cab-add-filelist -->';if(a(".co-pop-tp-file-thumbs").size()==0){a(".co-pop-tp-drop").append(b)}},_formatFileSize:function(b,d){if(typeof b!=="number"||b==undefined){return desknets.Resource.attachInvSize}var c=desknets.attachDisp.getSize(b);if(c=="NaN GB"){return desknets.Resource.attachInvSize}if(d!=undefined){c=c.replace(/\s/g,"")}return c},_appendThumbnail:function(d,j,f,e){var g=this;var i=g.options.templ.detail;var l=desknets.Resource.attach.uploadMsg;var c;desknets.attach._console("_appendThumbnail file.name="+d.name);desknets.attach._console("_appendThumbnail exist="+j);if(d.fname==undefined){d.fname=d.name}if(d.fname==undefined){c=d.name}else{c=d.fname}var k=a('<li class="load"></li>');a(k).css("display","inline-block").data("attachdisp",c).data("size",d.size).data("updtime",d.updtime).data("file",d).data("fileInput",f);if(d.overlap!=undefined){a(k).data("overwrite",true)}if(e!=undefined){a(k).data("overwriteFile",e)}i=desknets.tmpl.replaceWord(i,"filename",c);if(d.size==undefined){i=desknets.tmpl.replaceWord(i,"filesize",l)}else{i=desknets.tmpl.replaceWord(i,"filesize",this._formatFileSize(d.size))}i=desknets.tmpl.replaceWord(i,"release",desknets.Resource.attach.releaseLabel);i=desknets.tmpl.replaceWord(i,"delete",desknets.Resource.attach.deleteLabel);var h=j;if(j!=undefined){a(k).data("exist",true);a(k).data("fno",d.fno)}var b=a('<div class="co-pop-tp-file-thumbnail"></div>');g._loadImage(d,function(m){a(m).css("line-height","0");a(m).css("vertical-align","middle");a(b).append(m);a(k).append(b);a(k).append(i);if(h!=undefined){a(".co-pop-tp-file-size-in",k).css("width","100%")}else{a(".co-pop-tp-file-size-in",k).css("width","0%")}a(k).hide().appendTo(".co-pop-tp-file-thumbs:last").css("display","inline-block").fadeIn();a(k).find(".co-pop-tp-file-del").css("cursor","not-allowed");a(".co-pop-tp-file-del",k).on("click",{attach:g},g._deleteAttachFile);if(g.autoUpload&&h==undefined){g._uploadFile()}else{if(g.autoUpload&&h!=undefined){a("img",k).wrap('<a target="attach" href="'+d.srcUrl+'"></a>');a(k).addClass("end");a(k).removeClass("load");g._enableFileAppend()}else{g._enableFileAppend()}}},{maxWidth:g.options.previewMaxWidth,maxHeight:g.options.previewMaxHeight,fileTypes:g.options.previewFileTypes,fileExtension:g.options.previewFileExtension,canvas:g.options.previewAsCanvas,icon:g.options.icon},j)},_removeButtomMessage:function(){var b=a(".co-pop-tp-drop-bottom-msg");a(".co-pop-tp-drop-msg",b).fadeOut().hide();a(".co-pop-tp-choose-link",b).fadeOut().hide();this.detachInput()},_appendBottomMessage:function(){var c;var b=this;var d=a(".co-pop-tp-drop-bottom-msg");if(b.flashAttachElement==null){c=b.options.templ.btmMsg;c=desknets.tmpl.replaceWord(c,"dropHere",desknets.Resource.attach.dropHereLabel);c=desknets.tmpl.replaceWord(c,"clickFileSelect",desknets.Resource.attach.clickFileSelectLabel);if(a(".co-pop-tp-drop-msg",d).length&&a(".co-pop-tp-choose-link",d).length){if(a(".co-pop-tp-drop-msg",d)[0].style.display=="none"&&a(".co-pop-tp-choose-link",d)[0].style.display=="none"){a(".co-pop-tp-drop-msg",d).fadeIn().show();a(".co-pop-tp-choose-link",d).fadeIn().show();if(!window.File){a(".co-pop-tp-drop-msg").hide()}this.attachInput();this._hoverDropMessage()}}}else{c=b.options.templ.flashDropMsg;c=desknets.tmpl.replaceWord(c,"selectFromButton",desknets.Resource.attach.selectFromButtonLabel);a(".co-pop-tp-drop-msg",d).remove();d.append(c)}},_changeTopMessage:function(b){var c=this;if(c.flashAttachElement!=null){return}this.totalSize+=b;if(this.totalSize<0){this.totalSize=0}if(b<0){if(this.totalFileNum>0){this.totalFileNum-=1}}else{if(b>0){this.totalFileNum+=1}}var e=c.options.templ.topMsg;e=desknets.tmpl.replaceWord(e,"uploadMsg",c.options.templ.uploadMsg);e=desknets.tmpl.replaceWord(e,"fileUpload",desknets.Resource.attach.fileUploadLabel);e=desknets.tmpl.replaceWord(e,"filenum",String(this.totalFileNum));e=desknets.tmpl.replaceWord(e,"totalfilenum",String(this.totalUploadNum));if(!window.File){var d=this._formatFileSize(this.totalSize)}else{var d=this._formatFileSize(this.totalSize)+"/"+this._formatFileSize(this.totalUploadSize)}e=desknets.tmpl.replaceWord(e,"totalfilesize",d);a(".co-pop-tp-console-msg").fadeOut().remove();a(e).prependTo(".co-pop-tp-console");desknets.attach._console("_changeTopMessage  totalFileNum="+this.totalFileNum+" totalUploadNum="+this.totalUploadNum);desknets.attach._console("_changeTopMessage  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize)},_updateTopMessage:function(){var b=0;var d=this.options.templ.topMsg;var c=a(".co-pop-tp-file-thumbs>li");a.each(c,function(e){b+=parseInt(a(this).data("size"),10)});d=desknets.tmpl.replaceWord(d,"uploadMsg",this.options.templ.uploadMsg);d=desknets.tmpl.replaceWord(d,"fileUpload",desknets.Resource.attach.fileUploadLabel);d=desknets.tmpl.replaceWord(d,"filenum",String(c.size()));d=desknets.tmpl.replaceWord(d,"totalfilesize",this._formatFileSize(b));a(".co-pop-tp-console-msg").fadeOut().remove();a(d).appendTo(".co-pop-tp-console")},_removeDropMessage:function(){a(".co-pop-tp-def-msg").fadeOut().remove()},_appendDropMessage:function(){var c=this;a(".co-pop-tp-def-msg").fadeOut().remove();var b;if(c.flashAttachElement==null){b=c.options.templ.dropMsg;b=desknets.tmpl.replaceWord(b,"dropHere",desknets.Resource.attach.dropHereLabel);b=desknets.tmpl.replaceWord(b,"clickFileSelect",desknets.Resource.attach.clickFileSelectLabel)}else{b=c.options.templ.flashDropMsg;b=desknets.tmpl.replaceWord(b,"selectFromButton",desknets.Resource.attach.selectFromButtonLabel)}if(a(".co-pop-tp-def-msg").size()==0){if(c.flashAttachElement!=null){a(".co-pop-tp-drop").append('<div class="co-pop-tp-def-msg demo-start"></div>');a(".co-pop-tp-def-msg").append(b)}else{a(".co-pop-tp-drop").append(b)}if(!window.File){if(c.flashAttachElement==null){a(".co-pop-tp-drop-msg").hide()}}if(c.flashAttachElement==null){this.attachInput();this._hoverDropMessage()}}c._setDropMessage()},_hoverDropMessage:function(){var b=this;a(".co-pop-tp-choose-link").hover(function(){if(a(".co-pop-tp-file").data("disableFileAppend")!=true){b._changeDropMessageColorEnter()}},function(){b._changeDropMessageColorNormal()})},_changeDropMessageColorEnter:function(){a(".co-pop-tp-choose-link").css("color",this.options.fileSelMsgColorEnter).css("text-decoration","none")},_changeDropMessageColorNormal:function(){a(".co-pop-tp-choose-link").css("color",this.options.fileSelMsgColorNormal).css("text-decoration","underline")},_getTargetByFileName:function(d){var b=a(".co-pop-tp-file-thumbs>li");var c;a.each(b,function(e){if(a(this).data("attachdisp")==d){c=this;return false}});return c},_flashAppendThumbnail:function(g){var j=this,c;var d;var n;var k=j.options.templ.detail;if(g.fname==undefined){g.fname=g.name}var m=j._getTargetByFileName(g.fname);if(m){return}var l=a('<li class="load"></li>');a(l).css("display","inline-block").data("attachdisp",g.fname).data("size",g.size).data("updtime",g.updtime).data("file",g);a.each(j.options.file.files,function(o){d=this.attachdisp;n=j._getTargetByFileName(d);if(n==undefined){if(d==g.fname){a(l).data("overwrite",true);return false}}});k=desknets.tmpl.replaceWord(k,"filename",g.fname);k=desknets.tmpl.replaceWord(k,"filesize",this._formatFileSize(g.size));k=desknets.tmpl.replaceWord(k,"release",desknets.Resource.attach.releaseLabel);a(l).data("fno",g.fno);a(l).data("exist",true);var b=a('<div class="co-pop-tp-file-thumbnail"></div>');var h=desknets.createRandomId();a(l).data("updtime",h);g.srcUrl=this._getDownloadUrl(this.options.downloadURL,g.fno,g.fname,h);g.imgSrc=this._getDownloadUrl(this.options.imgSrcURL?this.options.imgSrcURL:this.options.downloadURL,g.fno,g.fname,h);var i=a('<img alt="img">').hide().on("load",function(){j._scaleImage(this,j.options)});var i=a('<img alt="img">').hide().on("load",function(){j._scaleImage(this,j.options)}).on("error",function(p){a(this).off("error");var o=j._getFileExtension(g.fname);a.each(j.options.icon,function(q){f=new RegExp(q+"$","i");if(f.test(o)){c=this;return false}});if(c){a(i).attr("src",c)}else{a(i).attr({src:j.options.icon.none})}});if(!this.options.previewFileExtension||this.options.previewFileExtension.test(this._getFileExtension(g.fname))){a(i).hide().attr("src",g.imgSrc).on("load",function(){j._scaleImage(this,j.options)})}else{var f;var e=j._getFileExtension(g.fname);a.each(j.options.icon,function(o){f=new RegExp(o+"$","i");if(f.test(e)){c=this;return false}});if(c){a(i).attr("src",c)}else{a(i).attr({src:j.options.icon.none})}}a(i).css("line-height","0");a(i).css("vertical-align","middle");a(b).append(i);a(i).wrap('<a target="attach" href="'+g.srcUrl+'"></a>');a(l).append(b);a(l).append(k);a(".co-pop-tp-file-size-in",l).css("width","100%");a(l).hide().appendTo(".co-pop-tp-file-thumbs:last").css("display","inline-block").fadeIn();a(l).addClass("end");a(l).removeClass("load");a(".co-pop-tp-file-del",l).on("click",{attach:j},j._deleteAttachFile);j._enableFileAppend()},flashAddFile:function(b){this._removeDropMessage();this._appendBottomMessage();this._appendThumbnailArea();this._flashAppendThumbnail(b);modeChangeMsg=a(".co-pop-tp-console>.co-msg");if(modeChangeMsg.length>0){modeChangeMsg.remove();a(document).off("click",".co-pop-tp-flash-mode-change-btn")}},_addFile:function(c,d,f){desknets.attach._console("_addFile  filename="+c.name+" overlap="+c.overlap);var e=this;var h;var b;if(c.fname==undefined){b=c.name}else{b=c.fname}if(c.overlap==true){h=this._getTargetByFileName(b);if(h==undefined){if(this.autoUpload==false){this._removeDropMessage();this._appendBottomMessage();this._appendThumbnailArea();this._appendThumbnail(c,d,f);this.totalUploadNum+=1;this.totalUploadSize+=c.size;desknets.attach._console("4  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize);this._changeTopMessage(0)}}else{this.totalUploadNum-=1;this.totalUploadSize-=a(h).data("size");desknets.attach._console("3  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize);if(this.autoUpload!=false){e.totalSize-=a(h).data("size");e.totalFileNum-=1}var g=a(h).data("file");this._removeFile(h);this._removeDropMessage();this._appendBottomMessage();this._appendThumbnailArea();this._appendThumbnail(c,d,f,g);this.totalUploadNum+=1;this.totalUploadSize+=c.size;desknets.attach._console("1  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize);this._changeTopMessage(0)}}else{this._removeDropMessage();this._appendBottomMessage();this._appendThumbnailArea();this._appendThumbnail(c,d,f);this.totalUploadNum+=1;this.totalUploadSize+=c.size;desknets.attach._console("2  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize);if(this.autoUpload==false){this._changeTopMessage(0)}}},_normalizeFile:function(b,c){if(c.name===undefined&&c.size===undefined){c.name=c.fileName;c.size=c.fileSize}else{if(c.fileName===undefined&&c.fileSize===undefined){c.fileName=c.name;c.fileSize=c.size}}},_removeZeroFile:function(e,d){var c=this;var g,b=0,f;var h=a.map(e,function(i,j){if(i.size==0){if(!b){if(i.fname==undefined){f=i.name}else{f=i.fname}}b+=1;return null}else{return i}});if(b){g=desknets.Resource.Message.att_filesize_zero;if(b>1){f=f+desknets.Resource.Message.att_other_files;f=desknets.tmpl.replaceWord(f,"num",String(b-1))}g=desknets.tmpl.replaceWord(g,"filenames",f);desknets.dialog.alert(g);if(c.options.afterUpload!=undefined&&typeof c.options.afterUpload=="function"){c.options.afterUpload()}c._enableFileAppend()}else{c._checkOverlapFile(h,d)}},_checkOverlapFile:function(e,j){var l=this;var g,k=0,m;var f,h,n,i,d;var c;a.each(e,function(o){if(this.fname==undefined){c=this.name}else{c=this.fname}n=l._getTargetByFileName(c);if(n!=undefined){f=a(n).data("attachdisp");if(f==c){this.overlap=true;if(!k){m=c}k+=1}else{if(this.overlap==undefined){this.overlap=false}}}});if(l.autoUpload==false){a.each(l.options.file.files,function(o){f=this.attachdisp;d=this.fno;n=l._getTargetByFileName(f);if(n!=undefined){return false}else{a.each(e,function(p){if(this.fname==undefined){c=this.name}else{c=this.fname}if(f==c){this.overlap=true;this.overlapfno=d;if(!k){m=c}k+=1}})}})}if(!k){l._totalSizeCheck(e,j);return}if(k>1){g=desknets.Resource.Message.att_overlap_file_multi;g=desknets.tmpl.replaceWord(g,"num",String(k));m=m+desknets.Resource.Message.att_other_files;m=desknets.tmpl.replaceWord(m,"num",String(k-1))}else{g=desknets.Resource.Message.att_overlap_file_single;m=m}g=desknets.tmpl.replaceWord(g,"filenames",m);var b=desknets.dialog.confirm(g,function(){l._totalSizeCheck(e,j)},{cancel:function(){if(l.options.afterUpload!=undefined&&typeof l.options.afterUpload=="function"){l.options.afterUpload()}l._enableFileAppend()}})},_getEntryTotalSize:function(e){var h=this;var k=a(".co-pop-tp-file-thumbs>li");var i=0;var c=0;var j,f;var g=e;var b;var d;a.each(k,function(l){f=a(this).data("attachdisp");j=0;a.each(g,function(m){if(this.fname==undefined){b=this.name}else{b=this.fname}if(b==f){c+=this.size;return false}});i+=a(this).data("size")});if(h.autoUpload==false){a.each(h.options.file.files,function(l){f=this.attachdisp;d=this.fno;k=h._getTargetByFileName(f);if(k==undefined){a.each(g,function(m){if(f==this.fname){c+=this.size;return false}});i+=this.size}})}i-=c;return i},_totalSizeCheck:function(f,e){var d=this;var g;var c=0;a.each(f,function(h){c+=this.size});var b=this._getEntryTotalSize(f);if(b+c>d.options.totalSizeLimit){g=desknets.Resource.Message.att_total_size_over;g=desknets.tmpl.replaceWord(g,"total",d._formatFileSize(b+c,true));g=desknets.tmpl.replaceWord(g,"limit",d._formatFileSize(d.options.totalSizeLimit,true));desknets.dialog.alert(g);if(d.options.afterUpload!=undefined&&typeof d.options.afterUpload=="function"){d.options.afterUpload()}d._enableFileAppend();return}if(this.autoUpload==true){d._showUploadNowDialog()}setTimeout(function(){d._launchAddFile(f,e)},0)},_launchAddFile:function(d,c){var b=this;var e;a.each(d,function(f){if(this.add==undefined){this.add=true;e=this;return false}});if(e){if(c==undefined){b._addFile(e)}else{b._addFile(e,undefined,c)}setTimeout(function(){b._launchAddFile(d,c)},0)}},_onDrop:function(h){var i;h.preventDefault();if(a(".co-pop-tp-file").data("disableFileAppend")!=undefined){return}var d=h.data.attach,g=h.dataTransfer=h.originalEvent.dataTransfer;if(g.files==undefined){desknets.attach._console("_onDrop no drop files");return}var c=g.files.length;d._changeDragColorNormal();desknets.attach._console("_onDrop dataTransfer.files.length="+c);a.each(g.files,function(e){desknets.attach._console("_onDrop filename["+e+"]="+this.name)});a.each(g.files,function(e){if(desknets.browser.ipad){this.fname=d._ipadCreateFileName(this.name)}else{this.fname=d._unicodeNormalizationFormC(this.name)}});if(c==0){return}d._disableFileAppend();if(d.options.beforUpload!=undefined&&typeof d.options.beforUpload=="function"){d.options.beforUpload()}if(c>d.options.dropFilesLimit){i=desknets.Resource.Message.att_drop_max_over;i=desknets.tmpl.replaceWord(i,"num",String(c));i=desknets.tmpl.replaceWord(i,"max",String(d.options.dropFilesLimit));desknets.dialog.alert(i);d._enableFileAppend();if(d.options.afterUpload!=undefined&&typeof d.options.afterUpload=="function"){d.options.afterUpload()}}else{var f={files:a.each(a.makeArray(g&&g.files),d._normalizeFile)};a.each(f.files,function(e){this.name=d._unicodeNormalizationFormC(this.name);this.fname=d._unicodeNormalizationFormC(this.name)});d._removeZeroFile(f.files)}var b=d._getUploadStatus()},_onDragOver:function(d){if(!window.File){d.preventDefault();return}var b=d.data.attach,c=d.dataTransfer=d.originalEvent.dataTransfer;if(c){if(a(".co-pop-tp-file").data("disableFileAppend")!=undefined){if(c.dropEffect.effectAllowed!=undefined){c.dropEffect=c.effectAllowed="none"}else{c.dropEffect="none"}}else{if(c.dropEffect.effectAllowed!=undefined){c.dropEffect=c.effectAllowed="copy"}else{c.dropEffect="copy"}b._changeDragColorEnter()}}d.preventDefault()},_parentContains:function(c,b){if(b.parentElement==c){return true}else{if(b.parent==undefined){return false}else{this._parentContains(b.parentElement,b)}}},_onDragEnter:function(c){if(!window.File){return}var b=c.data.attach;c.stopPropagation();if(a(".co-pop-tp-file").data("disableFileAppend")!=undefined){return}b._changeDragColorEnter()},_onDragLeave:function(g){if(!window.File){return}var f=g.data.attach,b;g.stopPropagation();if(g.originalEvent.clientX==0&&g.originalEvent.clientY==0){f._changeDragColorNormal()}var d=a(".co-pop-tp-file")[0];var c=a(".co-pop-tp-file").offset();if(g.originalEvent.clientX<(c.left-window.scrollX)||g.originalEvent.clientY<(c.top-window.scrollY)||g.originalEvent.clientX>(c.left+d.clientWidth-window.scrollX)||g.originalEvent.clientY>(c.top+d.clientHeight-window.scrollY)){f._changeDragColorNormal()}if(g.clientX>=document.documentElement.clientWidth||g.clientY>=document.documentElement.clientHeight){f._changeDragColorNormal()}},_changeDragColorEnter:function(){a(".co-pop-tp-file").css("background","none repeat scroll 0 0 "+this.options.dragColorEnter)},_changeDragColorNormal:function(){a(".co-pop-tp-file").css("background","none repeat scroll 0 0 "+this.options.dragColorNormal)},_onBeforUnload:function(b){this.abort=true;return},_initEventHandlers:function(){a(document);this.dropArea.on("dragover",{attach:this},this._onDragOver);this.dropArea.on("drop",{attach:this},this._onDrop);a(".co-pop-tp-file").on("dragenter",{attach:this},this._onDragEnter);a(".co-pop-tp-file").on("dragleave",{attach:this},this._onDragLeave);a(".co-pop-tp-stop-btn").on("click",{attach:this},this._onCancel);if(this.autoUpload==false){a(".co-pop-tp-clear-btn").on("click",{attach:this},this._clickAllDeleteAttachFile)}else{a(".co-pop-tp-clear-btn").on("click",{attach:this},this._allDeleteAttachFile)}},_destroyEventHandlers:function(){this.dropArea.off("dragover");this.dropArea.off("drop");a(".co-pop-tp-file").off("dragenter");a(".co-pop-tp-file").off("dragleave");a(".co-pop-tp-file-del").off("click");a("#ifiles").off("change");a(".co-pop-tp-stop-btn").off("click");a(".co-pop-tp-clear-btn").off("click")},_scaleCanvas:function(b,d){d=d||{};var c=document.createElement("canvas"),e=Math.min((d.maxWidth||b.width)/b.width,(d.maxHeight||b.height)/b.height);if(e>=1){e=Math.max((d.minWidth||b.width)/b.width,(d.minHeight||b.height)/b.height)}b.width=parseInt(b.width*e,10);b.height=parseInt(b.height*e,10);if(!d.canvas||!c.getContext){return b}c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(b,0,0,b.width,b.height);return c},_scaleImage:function(d,e){a.extend(this.options,e);a(d).off("load");if(!d.width&&!d.height){a(d).show()}var f=Math.min((this.options.previewMaxWidth||d.width)/d.width,(this.options.previewMaxHeight||d.height)/d.height);if(f>=1){f=Math.max((this.options.previewMinWidth||d.width)/d.width,(this.options.previewMinHeight||d.height)/d.height)}var c=parseInt(d.width*f,10);var b=parseInt(d.height*f,10);if(!c&&!b){c=this.options.previewMaxWidth;b=this.options.previewMaxHeight}d.width=c;d.height=b;a(d).fadeIn()},_createObjectURL:function(b){var d="undefined",c=(typeof window.createObjectURL!==d&&window)||(typeof URL!==d&&URL)||(typeof webkitURL!==d&&webkitURL);return c?c.createObjectURL(b):false},_revokeObjectURL:function(b){var d="undefined",c=(typeof window.revokeObjectURL!==d&&window)||(typeof URL!==d&&URL)||(typeof webkitURL!==d&&webkitURL);return c?c.revokeObjectURL(b):false},_loadFile:function(c,d){if(typeof FileReader!=="undefined"&&FileReader.prototype.readAsDataURL){var b=new FileReader();b.onload=function(f){d(f.target.result)};b.readAsDataURL(c);return true}return false},_getFileExtension:function(b){if(b.match(/\.([a-z\d]+$)/i)){return(b.match(/\.([a-z\d]+$)/i)[0])}},_supportCanvas:function(){return !!document.createElement("canvas").getContext},_loadImage:function(g,k,l,j){var i=this,d,c,h;var b;if(g.fname==undefined){b=g.name}else{b=g.fname}if(j!=undefined){h=a('<img alt="img">').hide().on("load",function(){i._scaleImage(this,i.options)});if(!l||!l.fileExtension||l.fileExtension.test(i._getFileExtension(b))){c=g.imgSrc?g.imgSrc:g.srcUrl}else{var f;var e=i._getFileExtension(b);a.each(l.icon,function(m){f=new RegExp(m+"$","i");if(f.test(e)){c=this;return false}});if(!c){c=l.icon.none}}a(h).attr({src:c});k(h)}else{if(g.type!=undefined&&i._supportCanvas()&&(!l||!l.fileExtension||l.fileExtension.test(i._getFileExtension(b)))&&this._createObjectURL(g)!=false){d=this._createObjectURL(g);h=a("<img>").on("load",function(){a(this).off("load");a(this).off("error");i._revokeObjectURL(d);k(i._scaleCanvas(h[0],l))}).on("error",function(n){a(this).off("load");a(this).off("error");i._revokeObjectURL(d);h=a('<img alt="img">').hide().on("load",function(){a(this).fadeIn()}).show();var m=i._getFileExtension(b);a.each(l.icon,function(o){f=new RegExp(o+"$","i");if(f.test(m)){c=this;return false}});if(c){a(h).attr("src",c)}else{a(h).attr({src:l.icon.none})}k(h)});if(d){h.prop("src",d)}else{this._loadFile(g,function(m){h.prop("src",m)})}if(desknets.browser.msie){i._loadFile(g,function(m){h.prop("src",m)})}else{if(d){h.prop("src",d)}else{this._loadFile(g,function(m){h.prop("src",m)})}}}else{h=a('<img alt="img">').hide().on("load",function(){a(this).fadeIn()});var e=i._getFileExtension(b);a.each(l.icon,function(m){f=new RegExp(m+"$","i");if(f.test(e)){c=this;return false}});if(c){a(h).attr("src",c)}else{a(h).attr({src:l.icon.none})}k(h)}}},_deleteAttachFile:function(g,i){if(g!=undefined){var d=g.data.attach;g.preventDefault();var f=a(this).closest("li");if(a(".co-pop-tp-file").data("disableFileAppend")==true){return}}else{var d=this;var f=i}if(d.autoUpload==false){if(d.flashAttachElement!=null){if(a(f).data("overwrite")==true){var c=desknets.Resource.Message.att_flash_reject_delete;c=desknets.tmpl.replaceWordHtml(c,"filenames",a(f).data("attachdisp"));desknets.dialog.alert(c);return}}}delFunc=function(){d._disableFileAppend();if(a(f).data("exist")==true){d._deleteFile(f);d._dispFlashBtn(true)}else{var e=a(f).data("sending");if(e!=undefined){if(e==true){d.abort=true;if(d.jqXHR!=""){d.jqXHR.abort()}else{d._abort_iframe()}}}d.totalUploadNum-=1;d.totalUploadSize-=a(f).data("size");d._changeTopMessage(0);d._removeFile(f);d._enableFileAppend()}};if(a(".co-pop-tp-file").data("close")==true||a(".co-pop-tp-clear-btn").data("allDelete")==true){delFunc()}else{var h=desknets.Resource.Message.att_del_confirm;h=desknets.tmpl.replaceWord(h,"filenames",a(f).data("attachdisp"));d._dispFlashBtn(false);var b=desknets.dialog.confirm(h,delFunc,{cancel:function(){d._dispFlashBtn(true)}})}},_deleteFile:function(m,f,j,o,k,e){desknets.attach._console("_deleteFile() fname="+e);var l=this;var d=l.options.delURL;if(l.options.beforUpload!=undefined&&typeof l.options.beforUpload=="function"){l.options.beforUpload()}var i=l.options.delParams;if(o==undefined){if(k!=undefined&&e!=undefined){a.each(l.options.file.files,function(q){if(e==this.attachdisp){i.fno=this.fno;return null}})}else{if(m==undefined){a.each(l.options.file.files,function(q){if(f.fname==this.attachdisp){i.fno=this.fno;return null}})}else{var c=a(m).data("fno");if(c!=undefined){i.fno=c}else{var g=a(m).data("file");i.fno=g.overlapfno}}}}else{delete i.fno}if(l.tmpnm!=""){i.tmpnm=l.tmpnm}i.resformat="xml";var h=m;var n=f;var b=j;var p=a(".co-pop-tp-clear-btn");desknets.ajax.rest({dataType:"xml",url:d,data:i,type:"POST",headers:{"cache-control":"no-cache"},success:function(s,q,t){desknets.attach._console("delete ajax success");if(o!=undefined&&o==true){l.totalSize=0;l.totalUploadSize=0;l.totalFileNum=0;l.totalUploadNum=0;l._changeTopMessage(0);var r=a(".co-pop-tp-file-thumbs>li");a.each(r,function(u){l._removeFile(this)});l._enableFileAppend();if(l.options.afterUpload!=undefined&&typeof l.options.afterUpload=="function"){l.options.afterUpload()}}else{if(n!=undefined&&l.autoUpload==false){a(m).data("sending",true);l._send(m,a(m).data("attachdisp"),a(m).data("file"))}else{if(k!=undefined){l.totalUploadNum-=1;l.totalUploadSize-=a(h).data("size");l._changeTopMessage(-1*a(h).data("size"));l._removeFile(h);k.resolveCurrentFile(true)}else{if(h!=undefined){l.totalUploadNum-=1;l.totalUploadSize-=a(h).data("size");l._changeTopMessage(-1*a(h).data("size"));l._removeFile(h);l._enableFileAppend();if(l.options.afterUpload!=undefined&&typeof l.options.afterUpload=="function"){l.options.afterUpload()}}}if(n!=undefined){n.overlap=false;n.overlapdel=true;if(b!=undefined){l._addFile(n,undefined,b)}else{l._addFile(n)}}}}},error:function(s,q,r){desknets.attach._console("delete ajax error xhr.status="+s.status);if(a(".co-pop-tp-file-thumbs>li").size()!=0){p.removeAttr("disabled")}if(p.data("allDelete")!=undefined){p.removeData("allDelete")}l._enableFileAppend();if(l.options.afterUpload!=undefined&&typeof l.options.afterUpload=="function"){l.options.afterUpload()}if(k!=undefined){k.resolveCurrentFile(false)}if(l.abort!=true){desknets.ajax.onError(s.status,r)}}})},_flashUpdateFiles:function(f){var d=this;if(d.flashAttachElement==null){return}var c=[];var e=a(".co-pop-tp-file-thumbs>li");a.each(e,function(h){c[h]={id:a(this).data("fno"),name:a(this).data("attachdisp"),size:a(this).data("size")}});var g=a(f).data("fno");var b=a(f).data("attachdisp");d.flashAttachElement.dnUploader("deleteFile",d.flashAttachElement,g,b)},_removeFile:function(e){var d=this;d._flashUpdateFiles(e);a(e).fadeOut().remove();var c=a(".co-pop-tp-clear-btn");if(a(".co-pop-tp-file-thumbs>li").size()==0){this._removeButtomMessage();this._appendDropMessage();c.attr("disabled","disabled");if(c.data("allDelete")!=undefined){c.removeData("allDelete")}var b=a(".co-pop-tp-flash-mode-change-btn");if(b.data("progress")!=undefined){d._enableFileAppend();if(b.data("progress")=="flash"){d._flashModeChange()}else{d._flashModeChangeNormal()}b.removeData("progress");d._clearDialogDisabled(d.dialog)}if(a(".co-pop-tp-file").data("close")==true){a(".co-pop-tp-file").removeData("close");d._destroy();a(d.confirmDialog).dialog("close");a("#jco-attachdlg").remove()}}else{if(c.data("allDelete")!=undefined){if(this.autoUpload==false){this._someDeleteAttachFile()}}}},_allDeleteAttachFile:function(f){desknets.attach._console("_allDeleteAttachFile() ");if(f!=undefined){var c=f.data.attach}else{var c=this}var d=a(".co-pop-tp-file-thumbs>li");if(d.size()==0){return}if(c.flashAttachElement!=null){c.flashAttachElement.dnUploader("disable",c.flashAttachElement)}var g=desknets.Resource.Message.att_detach_all;var b=desknets.dialog.confirm(g,function(){c._ExecuteAllDeleteAttachFile(d)},{cancel:function(){if(c.flashAttachElement!=null){c.flashAttachElement.dnUploader("enable",c.flashAttachElement)}}})},_clickAllDeleteAttachFile:function(f){if(f!=undefined){var c=f.data.attach}else{var c=this}var d=a(".co-pop-tp-file-thumbs>li");if(d.size()==0){return}if(c.flashAttachElement!=null){c.flashAttachElement.dnUploader("disable",c.flashAttachElement)}var g=desknets.Resource.Message.att_detach_all;c._dispFlashBtn(false);var b=desknets.dialog.confirm(g,function(){c._dispFlashBtn(true);c._someDeleteAttachFile()},{cancel:function(){c._dispFlashBtn(true);if(c.flashAttachElement!=null){c.flashAttachElement.dnUploader("enable",c.flashAttachElement)}}})},_ExecuteAllDeleteAttachFile:function(d,b){var c=this;var e=false;a.each(d,function(f){var g=a(this).data("exist");if(g!=undefined){if(g==true){e=true}}});a(".co-pop-tp-clear-btn").attr("disabled","disabled").data("allDelete",true);c._disableFileAppend();if(e==true){c._deleteFile(null,null,null,true)}else{c.totalSize=0;c.totalUploadSize=0;c.totalFileNum=0;c.totalUploadNum=0;c._changeTopMessage(0);a.each(d,function(f){c._removeFile(this)});if(b==undefined){c._enableFileAppend()}}},_someDeleteAttachFile:function(h){if(h!=undefined){var f=h.data.attach}else{var f=this}var c=a(".co-pop-tp-clear-btn");c.attr("disabled","disabled").data("allDelete",true);var g=f._getSomeDeleteTarget();if(g!=undefined){desknets.attach._console("_someDeleteAttachFile() target filename="+a(g).data("attachdisp"));if(h==undefined){desknets.attach._console("_someDeleteAttachFile() _deleteAttachFile filename="+a(g).data("attachdisp"));f._deleteAttachFile(undefined,g)}else{if(f.flashAttachElement!=null){f.flashAttachElement.dnUploader("disable",f.flashAttachElement)}var i=desknets.Resource.Message.att_detach_all;var d=desknets.dialog.confirm(i,function(){desknets.attach._console("_someDeleteAttachFile() _deleteAttachFile filename="+a(g).data("attachdisp"));f._deleteAttachFile(undefined,g)},{cancel:function(){c.removeData("allDelete").removeAttr("disabled");if(f.flashAttachElement!=null){f.flashAttachElement.dnUploader("enable",f.flashAttachElement)}}})}}else{c.removeData("allDelete").removeAttr("disabled");var b=a(".co-pop-tp-flash-mode-change-btn");if(b.data("progress")!=undefined){f._enableFileAppend();if(b.data("progress")=="flash"){f._flashModeChange()}else{f._flashModeChangeNormal()}b.removeData("progress");f._clearDialogDisabled(f.dialog)}if(a(".co-pop-tp-file").data("close")==true){a(".co-pop-tp-file").removeData("close");f._doneUploadDialog();a("#jco-attachdlg").remove()}else{if(f.flashAttachElement!=null){f.flashAttachElement.dnUploader("enable",f.flashAttachElement)}}}},_getSomeDeleteTarget:function(){var c=this;var f=undefined;var e=undefined;var b=0;var g;var d=a(".co-pop-tp-file-del");a.each(d,function(i){var h=this.parentNode.parentElement;if(a(this).data("overlap")==undefined){a.each(c.options.file.files,function(j){desknets.attach._console("_getSomeDeleteTarget() exist  filename="+this.attachdisp);desknets.attach._console("_getSomeDeleteTarget() check filename="+a(h).data("attachdisp"));if(a(h).data("attachdisp")==this.attachdisp&&a(h).data("exist")==true){desknets.attach._console("_getSomeDeleteTarget() overlap !! "+this.attachdisp);if(e==undefined){e=this.attachdisp}b++;a(h).data("overlap",true)}});if(a(h).data("overlap")==undefined){if(f==undefined){f=h}}}});desknets.attach._console("_getSomeDeleteTarget() num="+b);if(b>0){if(b==1){g=desknets.Resource.Message.att_flash_reject_cancel_single;g=desknets.tmpl.replaceWordHtml(g,"filenames",e)}else{g=desknets.Resource.Message.att_flash_reject_cancel_multi;g=desknets.tmpl.replaceWordHtml(g,"filenames",e);g=desknets.tmpl.replaceWordHtml(g,"num",b-1)}desknets.dialog.alert(g)}desknets.attach._console("_getSomeDeleteTarget() target="+f);if(f!=undefined){return f}else{return undefined}},_uploadFile:function(){var b=this;var c=this._getUploadFile();if(c!=undefined){a(c).data("sending",true);desknets.attach._console("_uploadFile _send="+a(c).data("attachdisp"));this._send(c,a(c).data("attachdisp"),a(c).data("file"))}return},_getUploadStatus:function(){var c=this;var b=false;var d=a(".co-pop-tp-file-thumbs>li");a.each(d,function(f){var e=a(this).data("sending");if(e!=undefined){if(e==true){b=true}}});return b},_getUploadFile:function(){var c=this;var b=false;var d=a(".co-pop-tp-file-thumbs>li");a.each(d,function(g){var f=a(this).data("sending");if(f!=undefined){if(f==true){b=true;return false}}});if(b==true){return}var e;a.each(d,function(h){var i=a(this).data("exist");if(i==undefined){var g=a(this).data("sending");var f=a(this).data("attachdisp");if(g==undefined){e=this;return false}}});return e},_getExistFile:function(){var c=this;var b=false;var d=a(".co-pop-tp-file-thumbs>li");a.each(d,function(e){var f=a(this).data("exist");if(f!=undefined){if(f==true){b=true;return false}}});return b},_send:function(e,b,c){desknets.attach._console("_send file="+b);var d="undefined";if(typeof XMLHttpRequest!==d&&typeof File!==d&&typeof FormData!==d){this._submit_ajax(e,b,c)}else{this._submit_iframe(e,b,c)}},_submit_ajax:function(i,b,e){var h=this;var c=this.options.uploadURL;desknets.attach._console("_submit_ajax file.name="+e.name);var d=new FormData();for(var l in this.options.uploadParams){d.append(l,this.options.uploadParams[l])}d.append(String(a.cookie(desknets.COOKIENAME_STOKEN)),1);d.append("resformat","xml");d.append("Filename",b);if(this.tmpnm!=""){d.append("tmpnm",this.tmpnm)}d.append("attach",e);var f=i;var k=jQuery.ajaxSettings.xhr();if(k.upload){k.upload.addEventListener("progress",function(m){h._onProgress(m,h.options,f)},false)}var j=function(){return k};this.jqXHR=k;var g=a(".co-pop-tp-stop-btn");desknets.ajax.rest({xhr:j,dataType:"xml",url:c,data:d,type:"POST",headers:{"cache-control":"no-cache"},processData:false,contentType:false,success:function(n,m,o){desknets.attach._console("success");h._onSuccess(n,m,o,f)},error:function(o,m,n){desknets.attach._console("error xhr.status="+o.status);if(h.abort!=true){if(o.status=="404"){n=desknets.Resource.Message.att_404_errorMessage}desknets.ajax.onError(o.status,n);g.trigger("click")}h.abort=false;h._enableFileAppend();g.attr("disabled","disabled");if(h.autoUpload==true){h.uploadNowDialog.dialog("close")}}});g.removeAttr("disabled")},_onProgress:function(g,c,f){var d=this;var i;if(g.loaded!=g.total){i=Math.round(g.loaded/g.total*100)+"%"}else{i="100%"}var b=a(".co-pop-tp-file-size-in",f);b.css("width",i);if(Math.round(g.loaded/g.total*100)>=100){if(a(f).hasClass("load")){var h=desknets.Resource.attach.saveMsg;a(f).addClass("end").removeClass("load").data("fileSizeDisp",a(".co-pop-tp-file-size-in",f));b.detach();a(".co-pop-tp-file-size",f).append(h);desknets.attach._console("_onProgress over 100% sameMsg")}}},_getDownloadUrl:function(d,f,b,c){var e=d;e=desknets.tmpl.replaceWord(e,"id",f);e=desknets.tmpl.replaceWord(e,"name",encodeURIComponent(b).replace(/'/g,"%27"));e=desknets.tmpl.replaceWord(e,"updtime",c);if(this.tmpnm!=""){e=desknets.tmpl.replaceWord(e,"tmpnm",this.tmpnm)}return e},_onSuccess:function(l,k,q,n){var m=this;if(a(n).hasClass("load")){a(".co-pop-tp-file-size-in",n).css("width","100%");a(n).addClass("end").removeClass("load")}a(".co-pop-tp-file-save",n).remove();a(".co-pop-tp-file-size",n).append(a(n).data("fileSizeDisp"));var b=a(n).data("attachdisp");desknets.attach._console("_onSuccess filename="+a(n).data("attachdisp"));var e=a(l.documentElement);var d=e.find("fno").text();var r=e.find("size").text();var h=desknets.createRandomId();a(n).data("exist",true).removeData("sending").data("fno",d).data("size",parseInt(r,10)).data("updtime",h);var g=a(n).data("file");if(g.overlap==true){a(n).data("overwrite",true)}if(e.find("tmpnm").size()!=0){this.tmpnm=e.find("tmpnm").text()}var c=this._getDownloadUrl(this.options.downloadURL,d,b,h);g.srcUrl=c;g.imgSrc=this._getDownloadUrl(this.options.imgSrcURL?this.options.imgSrcURL:this.options.downloadURL,d,b,h);if(a("img",n).length){if(!this.options.previewFileExtension||this.options.previewFileExtension.test(this._getFileExtension(b))){var o=a("img",n).parent();a("img",n).remove();a(o).append('<img alt="img">');a("img",n).hide().attr("src",g.imgSrc).on("load",function(){m._scaleImage(this,m.options)}).on("error",function(t){a(this).off("load").on("load",function(){a(this).fadeIn()});a(this).off("error");var s=m._getFileExtension(b);a.each(m.options.icon,function(u){reg=new RegExp(u+"$","i");if(reg.test(s)){src=this;return false}});if(src){a("img",n).attr("src",src)}else{a("img",n).attr({src:m.options.icon.none})}})}a("img",n).wrap('<a target="attach" href="'+c+'"></a>')}else{a("canvas",n).wrap('<a target="attach" href="'+c+'"></a>')}desknets.attach._console("_onSuccess fno  ="+e.find("fno").text());desknets.attach._console("_onSuccess size ="+e.find("size").text());desknets.attach._console("_onSuccess tmpnm="+e.find("tmpnm").text());var j={};a.each(e.children(),function(t){var s="";if(this.textContent==undefined){var s=this.text}else{var s=this.textContent}if(this.tagName!="status"){if(this.tagName=="size"){j[this.tagName]=parseInt(s,10)}else{if(this.tagName=="attachdisp"){j[this.tagName]=b}else{j[this.tagName]=s}}}});a(n).data("response",j);var f=this._formatFileSize(a(n).data("size"));var p=a(".co-pop-tp-file-size-in",n);if(p.length==0){p.parent().append('<div class="co-pop-tp-file-size-in" style="width: 100%;">'+f+"</div>")}else{if(p[0].textContent==undefined){p.text(this._formatFileSize(a(n).data("size")))}else{p[0].textContent=this._formatFileSize(a(n).data("size"))}}this._changeTopMessage(a(n).data("size"));var i=this._getUploadFile();if(i!=undefined){a(i).data("sending",true);this._send(i,a(i).data("attachdisp"),a(i).data("file"))}else{desknets.attach._console("_onSuccess upload Complete");if(this.autoUpload==false){this._doneUploadDialog()}else{if(m.sendFileNum!=undefined){m.sendFileNum--;desknets.attach._console("_onSuccess sendFileNum="+m.sendFileNum);m.sendFileNum=undefined}}if(this.options.afterUpload!=undefined&&typeof this.options.afterUpload=="function"){this.options.afterUpload()}a(".co-pop-tp-stop-btn").attr("disabled","disabled");this._enableFileAppend();if(m.autoUpload==true){desknets.attach._console("_onSuccess uploadNowDialog close");m.uploadNowDialog.dialog("close");m.abort=false}}},_ipadCreateFileName:function(b){desknets.attach._console("_ipadCreateFileName name="+b);desknets.attach._console("_ipadCreateFileName _getFileExtension="+this._getFileExtension(b));var d=++this.ipadFileNo;if(d>9999){this.ipadFileNo=0;d=++this.ipadFileNo}var c="";if(d<10){var c="000"}else{if(d<100){var c="00"}else{if(d<1000){var c="0"}}}return(this.ipadFileName+c+d+this._getFileExtension(b))},_ipadInitFileName:function(e){var b=0;var d;var f;var c;a.each(e,function(g){var h=this.attachdisp;d=new RegExp("^ipadimg([0-9]{4})","i");if(d.test(h)){f=RegExp.$1;c=parseInt(RegExp.$1,10);desknets.attach._console("_ipadInitFileName no="+f+" cnt="+c);if(b<c){b=c}}});this.ipadFileNo=b;desknets.attach._console("_ipadInitFileName max="+b)},_onChange:function(f){var b=f.data.attach;var g;var c={files:a.each(a.makeArray(f.target.files),b._normalizeFile),fileInput:a(f.target),form:a(f.target.form)};a.each(c.files,function(e){if(desknets.browser.ipad){this.fname=b._ipadCreateFileName(this.name)}else{this.fname=b._unicodeNormalizationFormC(this.name)}desknets.attach._console("_onChange fname="+this.fname)});if(!c.files.length){c.files=[{name:f.target.value.replace(/^.*\\/,"")}];c.files[0].fname=c.files[0].name}if(c.files[0].name.length==0){g=desknets.Resource.Message.att_illegal_filename;desknets.dialog.alert(g);return}if(c.files[0].size==undefined){}if(b.options.beforUpload!=undefined&&typeof b.options.beforUpload=="function"){b.options.beforUpload()}c.fileInput.attr("name","attach");var d=c.fileInput.parent();c.fileInput.detach();d.append('<input type="file" id="ifiles" size="299" tabindex="-1" multiple>');a("#ifiles").on("change",{attach:b},b._onChange);b._hoverDropMessage();b._disableFileAppend();c.files=b._removeZeroFile(c.files,c.fileInput);b._changeDropMessageColorNormal()},_onCancel:function(g){var c=g.data.attach;desknets.attach._console("_onCancel");c.abort=true;if(c.jqXHR!=""){c.jqXHR.abort()}else{c._abort_iframe()}var f=0;var b=0;var d=a(".co-pop-tp-file-thumbs>li");if(c.autoUpload==true){a.each(d,function(e){if(a(this).data("sending")==true){var h=a(this).data("overwriteFile");c._removeFile(this);if(h!=undefined){h.overlap=false;c._addFile(h,true);f+=1;b+=h.size}}else{if(a(this).data("exist")==undefined){c._removeFile(this)}else{f+=1;b+=a(this).data("size")}}});c.totalFileNum=f;c.totalSize=b}else{a.each(d,function(e){if(a(this).data("sending")==true){a(this).removeClass("end");a(this).addClass("load");a(".co-pop-tp-file-save",this).remove();a(this).removeData("sending");a(".co-pop-tp-file-dtl",this).remove();var h=c.options.templ.detail;h=desknets.tmpl.replaceWord(h,"filename",a(this).data("attachdisp"));h=desknets.tmpl.replaceWord(h,"release",desknets.Resource.attach.releaseLabel);if(a(this).data("size")==undefined){h=desknets.tmpl.replaceWord(h,"filesize","アップロード中")}else{h=desknets.tmpl.replaceWord(h,"filesize",c._formatFileSize(a(this).data("size")))}a(this).append(h);a(".co-pop-tp-file-size-in",this).css("width","0%");a(".co-pop-tp-file-del",this).on("click",{attach:c},c._deleteAttachFile)}else{if(a(this).data("exist")==undefined){a(".co-pop-tp-file-size-in",this).css("width","0%")}}f+=1;b+=a(this).data("size")})}c.totalUploadNum=f;c.totalUploadSize=b;c._changeTopMessage(0);if(c.options.afterUpload!=undefined&&typeof c.options.afterUpload=="function"){c.options.afterUpload()}c._enableFileAppend();if(c.autoUpload==false){c._clearDialogDisabled(c.dialog)}a(".co-pop-tp-stop-btn").attr("disabled","disabled");if(c.autoUpload==true){if(!g.data.close){c.uploadNowDialog.dialog("close")}}},_submit_iframe:function(l,b,g){var k=this;var d;var c=0;d=this.options.uploadURL;var h=l;var f=b;var j=false;var e=a('<form id="iframe-send-form"></form>');var i=a('<iframe id="iframe-send" src="javascript:false;" name="iframe-transport-'+(c+=1)+'"></iframe>').on("load",function(){i.off("load").on("load",function(){var r;try{r=i.contents();if(!r.length||!r[0].firstChild){throw new Error()}}catch(u){r=undefined}if(r==undefined){var v=desknets.Resource.Message.att_network_err;desknets.dialog.alert(v,{errorNo:-1});a(".co-pop-tp-stop-btn").trigger("click");k.abort=false;k._enableFileAppend()}else{var t=k._handleData(this,"xml");var s=a(t.documentElement);var q=s.find("status").text();if(q=="ok"){k._onSuccess(t,200,"success",h)}else{if(q=="ng"){if(k.abort!=true){var v=s.find("errormessage").text();var p=s.find("errorno").text();desknets.dialog.alert(v,{errorNo:p});a(".co-pop-tp-stop-btn").trigger("click")}k.abort=false;k._enableFileAppend()}}}e.remove();if(k.autoUpload==true){k.uploadNowDialog.dialog("close")}}).on("error",function(q){if(k.autoUpload==true){k.uploadNowDialog.dialog("close")}if(k.abort!=true){var r=$this.contentDocument.message;var p=$this.contentDocument.number;desknets.dialog.alert(r,{errorNo:p});a(".co-pop-tp-stop-btn").trigger("click")}k.abort=false;k._enableFileAppend();e.remove()});e.prop("target",i.prop("name")).prop("action",d).prop("method","POST");a('<iframe src="javascript:false;"></iframe>').appendTo(e);if(k.options.uploadParams){a.each(k.options.uploadParams,function(p,q){a('<input type="hidden"/>').prop("name",p).val(q).appendTo(e)})}var o=String(a.cookie(desknets.COOKIENAME_STOKEN));a('<input type="hidden"/>').prop("name",o).val("1").appendTo(e);a('<input type="hidden"/>').prop("name","Filename").val(f).appendTo(e);a('<input type="hidden"/>').prop("name","resformat").val("xml").appendTo(e);if(k.tmpnm!=""){a('<input type="hidden"/>').prop("name","tmpnm").val(k.tmpnm).appendTo(e)}var n=a(h).data("fileInput");if(n&&n.length){n.prop("name","attach");e.append(n).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")}var m=a(".co-pop-tp-file-size-in",l);m.css("width","70%");a(".co-pop-tp-file-size-in",l).css("text-indent","0px");if(m.length!=0){if(m[0].textContent!=undefined){m[0].textContent=desknets.Resource.attach.uploadMsg}}e.submit()});e.append(i).appendTo("body");a(".co-pop-tp-stop-btn").removeAttr("disabled")},_abort_iframe:function(){a("#iframe-send").off("load").prop("src","javascript".concat(":false;"));a("#iframe-send-form").remove()},_handleData:function(d,c){var g,f=a(d).contents().get(0);if(a.isXMLDoc(f)||f.XMLDocument){return f.XMLDocument||f}g=a(f).find("body").html();switch(c){case"xml":try{g=a.parseXML(g)}catch(h){var b='<?xml version="1.0" encoding="utf-8"?><result><status>ng</status><errorno>404</errorno><errormessage>'+desknets.Resource.Message.att_404_errorMessage+"</errormessage></result>";g=a.parseXML(b)}break}return g},_disableFileAppend:function(){var b=this;a(".co-pop-tp-file").data("disableFileAppend",true);a("#ifiles").attr("disabled","disabled");a(".co-pop-tp-clear-btn").attr("disabled","disabled");a(".co-pop-tp-file-del").css("cursor","not-allowed");a(".co-pop-tp-flash-mode-change-btn").css("cursor","not-allowed");if(b.flashAttachElement!=null){b.flashAttachElement.dnUploader("disable",b.flashAttachElement)}},_enableFileAppend:function(){var b=this;a(".co-pop-tp-file").removeData("disableFileAppend");a("#ifiles").removeAttr("disabled");if(a(".co-pop-tp-file-thumbs>li").size()>0){a(".co-pop-tp-clear-btn").removeAttr("disabled")}a(".co-pop-tp-file-del").css("cursor","");a(".co-pop-tp-flash-mode-change-btn").css("cursor","");if(b.flashAttachElement!=null){setTimeout(function(){if(b.flashAttachElement!=null){b.flashAttachElement.dnUploader("enable",b.flashAttachElement)}},0)}},_clickUploadMessage:function(c){var b=c.data.attach;c.preventDefault();a("#ifiles").trigger("click")},_flashAddModeChangeButton:function(){var c=this;var b=desknets.Resource.attach.flashChangeMsg;a(".co-pop-tp-console").append(b)},_flashCheckModeChange:function(g){if(g!=undefined){var d=g.data.attach;g.preventDefault()}else{var d=this}if(a(".co-pop-tp-file").data("disableFileAppend")!=undefined){return}var b=a(".co-pop-tp-flash-mode-change-btn");if(d.autoUpload==false){d._setDialogDisabled(d.dialog);var f=a(".co-pop-tp-file-thumbs>li");if(f.length){if(d.flashAttachElement!=null){d.flashAttachElement.dnUploader("disable",d.flashAttachElement)}var h=desknets.Resource.Message.att_detach_all;var c=desknets.dialog.confirm(h,function(){if(b.hasClass("co-pop-tp-go-flash-mode")){b.data("progress","flash");d._someDeleteAttachFile();d._clearDialogDisabled(d.dialog)}else{b.data("progress","Normal");d._someDeleteAttachFile();d._clearDialogDisabled(d.dialog)}},{cancel:function(){if(d.flashAttachElement!=null){d.flashAttachElement.dnUploader("enable",d.flashAttachElement)}d._clearDialogDisabled(d.dialog)}})}else{if(b.hasClass("co-pop-tp-go-flash-mode")){d._flashModeChange()}else{d._flashModeChangeNormal()}d._clearDialogDisabled(d.dialog);if(a(".co-pop-tp-file-thumbs>li").size()==0){a(".co-pop-tp-clear-btn").attr("disabled","disabled")}if(!b.hasClass("co-pop-tp-go-flash-mode")){a(".co-pop-tp-stop-btn").attr("disabled","disabled")}}}else{if(b.hasClass("co-pop-tp-go-flash-mode")){d._flashModeChange()}else{d._flashModeChangeNormal()}}},_flashSetModeChangeButton:function(d){var c=this;var b;if(d=="flash"){a(".co-pop-tp-console>.co-msg").remove();b=desknets.Resource.attach.flashChangeMsg;a(".co-pop-tp-console").append(b);a(".co-pop-tp-flash-mode-change-btn").removeClass("co-pop-tp-go-normal-mode").addClass("co-pop-tp-go-flash-mode");a(document).off("click",".co-pop-tp-flash-mode-change-btn").on("click",".co-pop-tp-flash-mode-change-btn",{attach:c},c._flashCheckModeChange)}else{a(".co-pop-tp-console>.co-msg").remove();b=desknets.Resource.attach.flashChangeMsgNormal;a(".co-pop-tp-console").append(b);a(".co-pop-tp-flash-mode-change-btn").removeClass("co-pop-tp-go-flash-mode").addClass("co-pop-tp-go-normal-mode");a(document).off("click",".co-pop-tp-flash-mode-change-btn").on("click",".co-pop-tp-flash-mode-change-btn",{attach:c},c._flashCheckModeChange)}},_flashModeChange:function(j){if(j!=undefined){var i=j.data.attach;j.preventDefault()}else{var i=this}if(a(".co-pop-tp-file").data("disableFileAppend")!=undefined){return}i._flashSetModeChangeButton("normal");var d=null;if(!a.plugins||a.plugins.isSupported("flash","10.0.0.0")){a(".co-pop-tp-meta").append('<div class="co-pop-tp-flash" />');var g=i.options.templ.flashInput;g=desknets.tmpl.replaceWord(g,"attach",desknets.Resource.attach.attachLabel);a(".co-pop-tp-flash").append(g);d=a(".co-pop-tp-flash")}else{if(this.autoUpload==false){a(".co-pop-body").append(desknets.Resource.attach.flashDownloadMsg)}else{a(".co-pop-tp-file-drop").append(desknets.Resource.attach.flashDownloadMsg)}a(".co-pop-tp-console>.co-msg").hide()}if(d!=null&&d.length>0){a(".co-pop-tp-choose-link").hide();i.normalElements.topDropMsg=a(".co-pop-tp-def-msg>.co-pop-tp-drop-msg");i.normalElements.bottomDropMsg=a(".co-pop-tp-drop-bottom-msg>.co-pop-tp-drop-msg");a(".co-pop-tp-def-msg>.co-pop-tp-drop-msg").detach();a(".co-pop-tp-drop-bottom-msg>.co-pop-tp-drop-msg").detach();var f=i.options.templ.flashDropMsg;f=desknets.tmpl.replaceWord(f,"selectFromButton",desknets.Resource.attach.selectFromButtonLabel);a(".co-pop-tp-def-msg").prepend(f);a(".co-pop-tp-drop-bottom-msg").prepend(f);i.normalElements.stopBtn=a(".co-pop-tp-stop-btn");a(".co-pop-tp-stop-btn").detach();i.normalElements.console=a(".co-pop-tp-console");a(".co-pop-tp-console-msg").remove();var k={resformat:"xml",rssid:i._getSessionId()};if(i.tmpnm!=""){k.tmpnm=i.tmpnm}k[String(a.cookie(desknets.COOKIENAME_STOKEN))]=1;var h={localeChain:desknets.Resource.code,cancelText:desknets.Resource.abortLabel,uploadText:desknets.Resource.attachLabel,processingText:desknets.Resource.attach.saveLabel,url:i.options.uploadURL,downloadURL:i.options.downloadURL,downloadTarget:"attach",addParams:i.options.uploadParams,deleteParams:i.options.delParams,deleteIDParamName:"fno",maxTotalSize:i.options.totalSizeLimit/1024/1024,objectURL:i.options.flashObjectURL,error:function(n,e){if(i.abort!=true){desknets.dialog.alert(e.message,{})}},nameDuplicated:function(o,e){var n=desknets.Resource.Message.att_overlap_file_single;n=desknets.tmpl.replaceWordHtml(n,"filenames",e.name);desknets.dialog.confirm(n,function(){var p=i._getTargetByFileName(e.name);if(p==undefined){setTimeout(function(){e.resolveCurrentFile(true)},0)}else{if(a(p).data("exist")==true){i._removeFile(p);setTimeout(function(){e.resolveCurrentFile(true)},0)}else{i._removeFile(p);setTimeout(function(){e.resolveCurrentFile(true)},0)}}},{cancel:function(){i._execCurrentFileCancel(e)}})}};a.extend(h.addParams,k);a.extend(h.deleteParams,k);if(i.autoUpload==false){h.start=function(){i._setDialogDisabled(i.dialog);i._disableFileAppend();if(i.options.beforUpload!=undefined&&typeof i.options.beforUpload=="function"){i.options.beforUpload()}};h.stop=function(){i._clearDialogDisabled(i.dialog);i._enableFileAppend();if(a(".co-pop-tp-file-thumbs>li").size()==0){a(".co-pop-tp-clear-btn").attr("disabled","disabled")}if(i.options.afterUpload!=undefined&&typeof i.options.afterUpload=="function"){i.options.afterUpload()}}}else{h.start=function(){i._disableFileAppend();if(i.options.beforUpload!=undefined&&typeof i.options.beforUpload=="function"){i.options.beforUpload()}i._showUploadNowDialog()};h.stop=function(){i._enableFileAppend();i.uploadNowDialog.dialog("close");if(i.options.afterUpload!=undefined&&typeof i.options.afterUpload=="function"){i.options.afterUpload()}}}a(".co-pop-tp-clear-btn").css("float","right");h.files=[];if(i.autoUpload==false){a.each(i.options.file.files,function(e){h.files[e]={id:this.fno,name:this.attachdisp,size:this.size}});var m=a(".co-pop-tp-file-thumbs>li");a.each(m,function(e){h.files[e+i.options.file.files.length]={id:a(this).data("fno"),name:a(this).data("attachdisp"),size:a(this).data("size")}})}else{var m=a(".co-pop-tp-file-thumbs>li");a.each(m,function(e){h.files[e]={id:a(this).data("fno"),name:a(this).data("attachdisp"),size:a(this).data("size")}})}a(".co-pop-tp-meta").find("input[name='s_attach']").remove();i.flashAttachElement=a(".co-pop-tp-flash");i.flashAttachElement.dnUploader(h);a("#ifiles").remove();if(a(".co-pop-tp-file-thumbs>li").size()==0){i._removeButtomMessage()}var l=a(".co-pop-tp-drop-bottom-msg");var b=a(".co-pop-tp-choose-link",l);var c=a(".co-pop-tp-choose-link",l).parent();a(".co-pop-tp-choose-link",l).remove();a(c).append(b)}if(i.autoUpload==false){desknets.attach._console("_flashModeChange() off/on co-pop-tp-clear-btn");a(document).off("click",".co-pop-tp-clear-btn").on("click",".co-pop-tp-clear-btn",{attach:i},i._clickAllDeleteAttachFile)}desknets.saveCookieToDisk(desknets.COOKIENAME_ATTACH_IE_FLASH,"flash")},_execCurrentFileCancel:function(b){setTimeout(function(){b.resolveCurrentFile(false)},0)},_flashModeChangeNormal:function(h){if(h!=undefined){var d=h.data.attach;h.preventDefault()}else{var d=this}if(a(".co-pop-tp-file").data("disableFileAppend")!=undefined){return}d._flashSetModeChangeButton("flash");a(".co-pop-tp-flash").remove();d.flashAttachElement=null;a(".co-pop-tp-drop-msg").remove();a(".co-pop-tp-def-msg").prepend(d.normalElements.topDropMsg);var b=a(".co-pop-tp-drop-bottom-msg");b.prepend(d.normalElements.bottomDropMsg);a(".co-pop-tp-drop-msg",b).hide();if(a(".co-pop-tp-file-thumbs>li").size()==0){d._removeButtomMessage();d._appendDropMessage()}else{d._removeDropMessage();d._appendBottomMessage()}a(".co-pop-tp-meta").append(d.normalElements.stopBtn);if(this.autoUpload==false){a(document).off("click",".co-pop-tp-clear-btn").on("click",".co-pop-tp-clear-btn",{attach:d},d._clickAllDeleteAttachFile)}a(".co-pop-tp-clear-btn").css("float","");d.totalSize=0;d.totalFileNum=0;var g=0;var c=0;var f=a(".co-pop-tp-file-thumbs>li");a.each(f,function(e){g+=1;c+=a(this).data("size");d._changeTopMessage(a(this).data("size"))});d.totalUploadNum=g;d.totalUploadSize=c;d._changeTopMessage(0);d._setDropMessage();desknets.saveCookieToDisk(desknets.COOKIENAME_ATTACH_IE_FLASH,"normal")},_setDropMessage:function(){var b=this;if(!window.File){return}var c=desknets.Resource.attach.dropMaxMsg;c=desknets.tmpl.replaceWord(c,"maxdrop",b.options.dropFilesLimit);var d;d=a(".co-pop-tp-def-msg>.co-pop-tp-drop-msg")[0];if(d!=undefined){d.textContent=c}d=a(".co-pop-tp-def-msg>.co-pop-tp-drop-msg")[0];if(d!=undefined){d.textContent=c}},_setDialogDisabled:function(c){var b=this;var d=c.parent();desknets.submitform.setButton(d,true);d.find(".ui-icon-closethick").unbind("click").bind("click",function(){return false})},_clearDialogDisabled:function(c){var b=this;var d=c.parent();desknets.submitform.setButton(d,false);d.find(".ui-icon-closethick").unbind("click").bind("click",this.closeFunction)},_showUploadNowDialog:function(){var b=this;var c={type:"message",extraMessage:desknets.Resource.Message.com_dialog_execaddmsg,extraClass:"co-loading-dialog",btnLabel:desknets.Resource.abortLabel,close:function(){var f=a(".co-pop-tp-stop-btn");if(f.length){b._onCancel({data:{attach:b,close:true}})}else{a(".co-ie-uploader-cancel").trigger("click")}}};var e=desknets.Resource.Message.com_dialog_execmsg;e=desknets.tmpl.replaceWordHtml(e,"msg",desknets.Resource.Message.att_upload_now);b.uploadNowDialog=desknets.dialog.alert(e,c);var d={};d[desknets.Resource.abortLabel]=function(){b.uploadNowDialog.dialog("close");b._onCancel({data:{attach:b,close:true}})};b.uploadNowDialog.dialog("option","buttons",d)},_unicodeNormalizationFormC:function(f){var d="";var e="";var b=function(k,j){var h="";for(var g=0;g<desknets.attach.unicodeNfdTable.length-1;g++){if(desknets.attach.unicodeNfdTable[g][1]==k&&desknets.attach.unicodeNfdTable[g][2]==j){return(String.fromCharCode(desknets.attach.unicodeNfdTable[g][0]))}}return h};desknets.attach._console("_unicodeNormalizationFormC befor="+this._stringDump(f));for(var c=0;c<f.length;c++){e=b(f.charCodeAt(c),f.charCodeAt(c+1));if(e==""){d+=String.fromCharCode(f.charCodeAt(c))}else{d+=e;c++}}desknets.attach._console("_unicodeNormalizationFormC after="+this._stringDump(d));desknets.attach._console("_unicodeNormalizationFormC after="+this._stringDump(d));return d},unicodeNfdTable:[[12364,12363,12441],[12366,12365,12441],[12368,12367,12441],[12370,12369,12441],[12372,12371,12441],[12374,12373,12441],[12376,12375,12441],[12378,12377,12441],[12380,12379,12441],[12382,12381,12441],[12384,12383,12441],[12386,12385,12441],[12389,12388,12441],[12391,12390,12441],[12393,12392,12441],[12400,12399,12441],[12401,12399,12442],[12403,12402,12441],[12404,12402,12442],[12406,12405,12441],[12407,12405,12442],[12409,12408,12441],[12410,12408,12442],[12412,12411,12441],[12413,12411,12442],[12436,12358,12441],[12446,12445,12441],[12460,12459,12441],[12462,12461,12441],[12464,12463,12441],[12466,12465,12441],[12468,12467,12441],[12470,12469,12441],[12472,12471,12441],[12474,12473,12441],[12476,12475,12441],[12478,12477,12441],[12480,12479,12441],[12482,12481,12441],[12485,12484,12441],[12487,12486,12441],[12489,12488,12441],[12496,12495,12441],[12497,12495,12442],[12499,12498,12441],[12500,12498,12442],[12502,12501,12441],[12503,12501,12442],[12505,12504,12441],[12506,12504,12442],[12508,12507,12441],[12509,12507,12442],[12532,12454,12441],[12535,12527,12441],[12536,12528,12441],[12537,12529,12441],[12538,12530,12441],[12542,12541,12441],[0,0,0]],_stringDump:function(d){var c="";for(var b=0;b<d.length;b++){c+="\\u"+(d.charCodeAt(b)).toString(16)}return c},_dispFlashBtn:function(b){var c=this;if(this.autoUpload==false){if(this.flashAttachElement!=null){if(b){c.flashAttachElement.show()}else{c.flashAttachElement.hide()}}}},_getSessionId:function(){return a.cookie(desknets.COOKIENAME_SESSION_ID)}};desknets.attach.ext={CMD_ATTEXTLIST:"getextlist",_extlist:null,_TMPL_IMAGE:"/"+desknets.DIR_RESHOME+"/images/com/ext/co_ext_{{ext}}.png",IMAGE_NONE:"/"+desknets.DIR_RESHOME+"/images/com/ext/co_ext_unknown.png",getListParam:function(){var b={};if(this._extlist==null){b.cmd=this.CMD_ATTEXTLIST;return b}else{return null}},saveList:function(e){this._extlist={};if(e){var c=desknets.ajax.getJsonItems(e);var b=c.length;for(var d=0;d<b;d++){var f=c[d];this._extlist["."+f.id]=desknets.tmpl.replaceWord(this._TMPL_IMAGE,"ext",f.id)}}this._extlist.none=this.IMAGE_NONE},getIconList:function(){if(this._extlist==null){this.saveList(null)}return this._extlist}};desknets.rte={convertForShow:function(c,b){c=this._convertImageSrcToLoad(c,b);c=desknets.convertToSafeHtml(c);return c},_convertImageSrcToLoad:function(d,c){var b=this;var e=d.replace(/<a\s[^>]*>/ig,function(f){return f.replace(/href="([^"]+)"/i,function(g,h){var i=desknets.tmpl.replaceWordHtml(h,"ext",desknets.getExtension());if(!!c&&typeof c.convertToLoad=="function"){i=c.convertToLoad(i)}return'href="'+i+'"'})});d=e;var e=d.replace(/<video\s[^>]*>/ig,function(f){return b._convertSrcToLoad(f,c)});d=e;var e=d.replace(/<audio\s[^>]*>/ig,function(f){return b._convertSrcToLoad(f,c)});d=e;var e=d.replace(/<embed\s[^>]*>/ig,function(f){return b._convertSrcToLoad(f,c)});d=e;return d.replace(/<img\s[^>]*>/ig,function(f){return b._convertSrcToLoad(f,c)})},_convertSrcToLoad:function(c,b){return c.replace(/src="([^"]+)"/i,function(d,e){var f=desknets.tmpl.replaceWordHtml(e,"ext",desknets.getExtension());if(!!b&&typeof b.convertToLoad=="function"){f=b.convertToLoad(f)}return'src="'+f+'"'})},};a.extend(desknets.rte,{setUpHTML:function(d,b,c){a(b).find("div[align]").each(function(e){this.style.textAlign=this.align;this.removeAttribute("align")})},init:function(d,c){var b=this;if(typeof CKEDITOR!="undefined"){b.setUpRte(d,c)}else{b.loadRte();b.setUpRteTimer(d,c)}},setUpRte:function(e,d){var c=this;var b={submitName:e.attr("name"),idval:"ckeditor",rtfileopt:{},setBeforeSubmit:true};a.extend(b,d);e.val(c._convertImageSrcToLoad(e.val(),d));if(b.setBeforeSubmit){e.closest("form").on("form-submit-validate",function(i,j){c._onBeforeSubmit(j,b)})}var g={};if(!!b.height){g.height=b.height}var h=e.val();if(h.indexOf("</p>")>=0){h=h.replace(/\<p\>/g,"<div>");h=h.replace(/\<p\ /g,"<div ");h=h.replace(/\<\/p\>/g,"</div>");h=h.replace(/<img\s[^>]*>/ig,function(i){return i.replace(/style="([^"]+)"/i,function(j,k){k=k.replace(/border:\s(\d+)px\ssolid\sblack;/g,function(m,l){return"border-style:solid; border-width: "+l+"px;"});return'style="'+k+'"'})});e.val(h)}var f=CKEDITOR.replace(e.attr("id"),g);if(b.imgeditor===true){desknets.rtfile.setUpChooserButton(f,b.rtfileopt)}if(typeof(b.initFunc)=="function"){b.initFunc()}},setUpRteTimer:function(d,c){var b=this;var e=null;timerfunc=function(){if(typeof CKEDITOR!="undefined"){b.setUpRte(d,c);clearInterval(e)}};e=setInterval(timerfunc,500)},loadRte:function(){if(a(".co-rte-js").length<=0){var b=document.createElement("script");b.className="co-rte-js";b.type="text/javascript";b.src="/dneores/js/extlibs/rte/ckeditor/ckeditor.js?"+desknets.CACHE_RTE_VERSION;var c=document.getElementsByTagName("head")[0];c.appendChild(b)}},readyForShow:function(b){desknets.htmlparts.setUpMailLink(b)},setEditorData:function(c,b){c.setData(b);if(!!c.plugins.media){c.plugins.media.convertMediaElements(c)}},setDataForConnectApp:function(d){var c=this;var h=[];var g=0;var f=60;var b={idval:"ckeditor"};a.extend(b,d);var e=setInterval(function(){if(g>=f){clearInterval(e)}g++;if(typeof CKEDITOR=="object"&&!!CKEDITOR.instances&&!!CKEDITOR.instances[b.idval]&&!!CKEDITOR.instances[b.idval].ui&&!!CKEDITOR.instances[b.idval].plugins&&!!CKEDITOR.instances[b.idval].document&&a(".cke_button.cke_button__table.cke_button_disabled").length==0){clearInterval(e);c.setEditorData(CKEDITOR.instances[b.idval],b.content);if(typeof(b.funcSetAtt)=="function"){b.funcSetAtt()}}},500)},_onBeforeSubmit:function(d,c){var b=this;a.each(d,function(e,f){if(f.name==c.submitName){f.value=b._converHtmlToSave(f.value,c)}})},converAlinkHtml:function(c){var b;b=a("<div />").html(c);b.find("a").each(function(){if(!this.target){this.target="_blank"}});c=b.html();return c},_converHtmlToSave:function(c,b){if(!!CKEDITOR.instances[b.idval]){c=CKEDITOR.instances[b.idval].getData()}c=this.converAlinkHtml(c);return this._convertImageSrcToSave(c,b)},_convertImageSrcToSave:function(d,c){var b=this;var e=d.replace(/<a\s[^>]*>/ig,function(f){return f.replace(/href="([^"]+)"/i,function(g,h){var i=new RegExp("^(\\w+)\\."+desknets.getExtension()+"\\?","i");var j=h.replace(i,"$1.{{ext}}?");if(!!c&&typeof c.convertToSave=="function"){j=c.convertToSave(j)}return'href="'+j+'"'})});d=e;e=d.replace(/<video\s[^>]*>/ig,function(f){return b._convertSrcToSave(f,c)});d=e;e=d.replace(/<audio\s[^>]*>/ig,function(f){return b._convertSrcToSave(f,c)});d=e;e=d.replace(/<embed\s[^>]*>/ig,function(f){return b._convertSrcToSaveEmbed(f,c)});d=e;return d.replace(/<img\s[^>]*>/ig,function(f){return b._convertSrcToSave(f,c)})},_convertSrcToSave:function(c,b){return c.replace(/src="([^"]+)"/i,function(d,e){var f=new RegExp("^(\\w+)\\."+desknets.getExtension()+"\\?","i");var g=e.replace(f,"$1.{{ext}}?");if(!!b&&typeof b.convertToSave=="function"){g=b.convertToSave(g)}return'src="'+g+'"'})},_convertSrcToSaveEmbed:function(c,b){return c.replace(/src="?([^"]+)("|\s|>)/i,function(d,e,f){var g=new RegExp("^(\\w+)\\."+desknets.getExtension()+"\\?","i");var i=e.replace(g,"$1.{{ext}}?");if(!!b&&typeof b.convertToSave=="function"){i=b.convertToSave(i)}var h='src="'+i+'"';if(f==">"||f==" "){h=h+f}return h})},setFormEditorValue:function(b){b.find(".cke").each(function(){var c=a(this);var d=c.attr("id").substring(4);b.find("#"+d).val(CKEDITOR.instances[d].getData())})},setEditorSourceOff:function(b){b.find(".cke").each(function(){var c=a(this);if(c.find(".cke_source").length>0){if(desknets.browser.msie){c.find(".cke_button__source.cke_button_on").mouseup()}else{c.find(".cke_button__source.cke_button_on").click()}}})},getEditorData:function(b){return CKEDITOR.instances[b].getData()},execFuncEditorSourceEnd:function(b,c){var f=0;var e=60;var d=setInterval(function(){if(f>=e||b.find(".cke_source").length==0){clearInterval(d);setTimeout(function(){c()},250)}f++},500)},inputSubmitRte:function(e,f,d){var c=this;e.preventDefault();desknets.submitform.setDisabled(f);desknets.rte.setEditorSourceOff(f);var b=function(){f.submit()};if(typeof d=="function"){b=d}desknets.rte.execFuncEditorSourceEnd(f,b)},});desknets.validation={isNumber:function(b){if(b.match(/[^0-9]/g)){return false}return true},isMinus:function(b){var c=a.trim(b);if(c.charAt(0)=="-"){return true}return false},checkNumberInput:function(c){var b=this;var d=c.find(".jco-validation-number:enabled");var e=d.filter(function(){return !b.isNumber(a(this).val())});if(e.length>0){b.showError(e.eq(-1));return false}return true},isInputDateFromTo:function(d,b){var c=this;var h=d.find('input[type="hidden"]');var e=h.eq(0);var g=h.eq(1);if(e.length>0&&g.length>0&&e.val().length>0&&g.val().length>0){if(e.val()>g.val()){if(neo.isSet(b)){var f="";if(b===false){f=desknets.Resource.Message.com_datechk_fromto}else{f=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_datechk_fromto_item,"item",b)}desknets.dialog.alert(f,{type:"warn"})}return false}}return true},isInputDateTimeFromTo:function(l,d){var i=this;var g=l.find('input[type="hidden"]');var c=g.eq(0);var b=g.eq(1);var e=g.eq(2);var f=g.eq(3);var k="";var j="";if(c.length>0&&e.length>0&&c.val().length>0&&e.val().length>0){if(b.val().length>0&&f.val().length>0){k=c.val()+b.val();j=e.val()+f.val()}else{if(b.val().length>0){k=c.val()+b.val()}else{k=c.val()+"000000"}if(f.val().length>0){j=e.val()+f.val()}else{j=e.val()+"235959"}}if(k>j){if(neo.isSet(d)){var h="";if(d===false){h=desknets.Resource.Message.com_datechk_fromto}else{h=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_datechk_fromto_item,"item",d)}desknets.dialog.alert(h,{type:"warn"})}return false}}return true},isRequiredDateFromTo:function(c){var b=this;var f=c.find('input[type="hidden"]');var d=f.eq(0);var e=f.eq(1);if(d.length==0||e.length==0||d.val().length==0||e.val().length==0){return false}return true},showError:function(d,c){var b=this.getErrorMessage(d,c);desknets.dialog.alert(b)},getErrorMessage:function(e,h){var j="",g="",f,d,b;var c=e.attr("name");var i=e.closest("form");if(e.hasClass("jco-validation-number")){j=desknets.Resource.Message.com_invalid_number}else{if(e.data("type")=="date"){f=e.datepicker("option","dateFormat");d=e.datepicker("option","minDate");b=e.datepicker("option","maxDate");if(e.hasClass("ui-invalid-range-underflow")&&!!d){g=a.datepicker.formatDate(f,d);j=desknets.Resource.Message.com_underflow_date}else{if(e.hasClass("ui-invalid-range-overflow")&&!!b){g=a.datepicker.formatDate(f,b);j=desknets.Resource.Message.com_overflow_date}else{j=desknets.Resource.Message.com_invalid_date}}j=desknets.tmpl.replaceWordHtml(j,"value",g);c=e.next("input").attr("name")}}if(i.length>0&&!!j){if(!h){h=desknets.getErrFieName(i,c)}j=desknets.getErrConvMsg({msg:j,fieldid:c,fieldname:h})}return j}};desknets.img={view:function(c,b){if(!neo.isSet(c)){return}if(desknets.browser.msie8){b.empty().html(a("<img/>").attr("src",c).load(function(){var k=a(document),f,i,e=b.children("img"),h,j,d,g;if(e.length>0){h=e.width();j=e.height();a(window).resize(function(){f=k.width();i=k.height();if(i/f<j/h){d=f;g=f/h*j;e.css({width:d,height:g,"margin-top":-g/2,"margin-left":-d/2})}else{d=i/j*h;g=i;e.css({width:d,height:g,"margin-top":-g/2,"margin-left":-d/2})}}).trigger("resize")}}))}else{b.css("background-image","url("+c+")")}},fitSize:function(d,c){var b=this;c=!c?{}:c;c.width=!!c.width?Number(c.width):d.parent().width();c.height=!!c.height?Number(c.height):d.parent().height();if(c.width>0&&c.height>0&&d.length>0){b._doFitSize(d,c);d.bind("load",function(){d.css({width:"auto",height:"auto"});b._doFitSize(d,c)})}},_doFitSize:function(e,c){var f,b;var d=e.width()/c.width;var g=e.height()/c.height;if(d>=g&&d>1){b=Math.floor(c.height*g/d);e.css({width:c.width+"px",height:b+"px"})}else{if(g>d&&g>1){f=Math.floor(c.width*d/g);e.css({width:f+"px",height:c.height+"px"})}}}};desknets.comMemo={VAL_MEMO_TAGON:"1",VAL_MEMO_TAGOFF:"0",CLASS_MEMO_TAGON:"yellow",CLASS_MEMO_TAGOFF:"none",read:function(f,d){var b=this,c={},e=desknets.Resource.Message;if(!!d.peel){this._openReadDialogWithRadio(f,d)}else{this._openReadDialogWithCheck(f,d)}},del:function(e,d){var b=this,c=desknets.Resource.Message;desknets.dialog.confirm(c.com_del_conf,function(f){b._sendToRead(e,{"delete":true,success:d})})},_openReadDialogWithCheck:function(e,c){var b=this,d=desknets.Resource.Message;desknets.dialog.confirm(d.com_memo_confirm_to_read,function(g){var f=a.extend({},c);f["delete"]=!!g["delete"];b._sendToRead(e,f)},{checkableOptions:{"delete":d.com_memo_delete}})},_openReadDialogWithRadio:function(e,c){var b=this,d=desknets.Resource.Message;desknets.dialog.ask(d.com_memo_confirm_to_read,{none:d.com_memo_not_peel,peel:d.com_memo_peel,"delete":d.com_memo_delete},function(g){var f=a.extend({},c);f.peel=g.answer=="peel";f["delete"]=g.answer=="delete";b._sendToRead(e,f)})},_sendToRead:function(d,b){var c={};c.cmd=!!b["delete"]?"memocmddelreceive":"memocmdreaded";c.id=String(d);if(!!b.peel&&!b["delete"]){c.deltag="1"}desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:c,success:function(){if(typeof b.success=="function"){b.success(b)}}})},setTagColorVal:function(b){var d=b.find(".co-select-menu");var f=d.find(".co-tag-select-item");var c="";var g=d.find('input[name="tag"]').val();if(g==desknets.comMemo.VAL_MEMO_TAGON){c=desknets.comMemo.CLASS_MEMO_TAGON}else{c=desknets.comMemo.CLASS_MEMO_TAGOFF}f.addClass(c);var e=b.find("#co-entry-tag-options").find("span.jco-tag-select-item."+c).text();f.text(e);f.attr("title",e)}};desknets.inputUtil={presetFormValues:function(d,b){var c={cmd:d,values:b};desknets.storage.saveData(desknets.storage.FIELD_FORM_VALUES,c)},loadPresetFormValues:function(c,b){var d=this._loadFormValues(c);if(!!d){b.find("input, select, textarea").each(function(){if(!!this.name&&typeof d[this.name]!="undefined"){a(this).val(d[this.name])}})}},_loadFormValues:function(c){var b=desknets.storage.loadData(desknets.storage.FIELD_FORM_VALUES);if(!!b&&!!b.cmd&&b.cmd==c){desknets.storage.clearData(desknets.storage.FIELD_FORM_VALUES);return b.values}return null}};desknets.storage={FIELD_FORM_VALUES:"dnFormValues",FIELD_CHOOSER_TAB:"dnChooserTab",FIELD_CHOOSER_HISTORY:"dnChooserHistory",FIELD_NTWI_NEWS:"dnNtwiNews",FIELD_NTWI_SEARCHES:"dnNtwiHistory",FIELD_ZSEARCH_EXEC:"dnZSsearchExec",FIELD_SCH_SEL:"dnSchsel",FIELD_PLANT_SEL:"dnPlantsel",_fields:null,loadData:function(b){if(!this._fields){this._init()}var e=this._fields[b],d;if(!!e){if(e.store=="session"){try{d=window.sessionStorage[b]}catch(c){}}else{if(e.store=="local"){try{d=window.localStorage[b]}catch(c){}}}if(typeof d=="undefined"){d=e.defValue}else{if(e.type=="object"){d=a.parseJSON(d)}}}return d},saveData:function(b,e){if(!this._fields){this._init()}var f=this._fields[b],c=e;if(!!f){if(f.type=="object"){c=JSON.stringify(e)}if(f.store=="session"){try{window.sessionStorage[b]=c}catch(d){}}else{if(f.store=="local"){try{window.localStorage[b]=c}catch(d){}}}}},clearData:function(b){if(!this._fields){this._init()}var d=this._fields[b];if(!!d){if(d.store=="session"){try{delete window.sessionStorage[b]}catch(c){}}else{if(d.store=="local"){try{delete window.localStorage[b]}catch(c){}}}}},clearPrivateData:function(){var b=this;var c=[this.FIELD_FORM_VALUES,this.FIELD_NTWI_NEWS,this.FIELD_NTWI_SEARCHES,this.FIELD_ZSEARCH_EXEC];a.each(c,function(e,d){b.clearData(d)})},_init:function(){this._fields={};this._fields[this.FIELD_FORM_VALUES]={store:"session",type:"object",defValue:{}};this._fields[this.FIELD_CHOOSER_TAB]={store:"local",type:"string",defValue:"not-found"};this._fields[this.FIELD_CHOOSER_HISTORY]={store:"local",type:"object",defValue:[]};this._fields[this.FIELD_NTWI_NEWS]={store:"session",type:"object",defValue:{}};this._fields[this.FIELD_NTWI_SEARCHES]={store:"local",type:"object",defValue:[]};this._fields[this.FIELD_ZSEARCH_EXEC]={store:"session",type:"string",defValue:""};this._fields[this.FIELD_SCH_SEL]={store:"local",type:"object",defValue:""};this._fields[this.FIELD_PLANT_SEL]={store:"local",type:"object",defValue:""}}};desknets.Pager={objDefOptions:{getCount:0,allCount:0,pageMaxView:100,startRow:0,clickFunc:null,classPageNavi:"co-cnt",classPagePaging:"co-paging",classPageMeta:"co-page-meta",classPageLink:"co-page-link",classPageToggle:"co-drop-down-button",classPageInput:"co-page-input",classPageBtn:"co-page-btn",classPageFirst:"co-page-first",classPagePrev:"co-page-prev",classPageNext:"co-page-next",classPageLast:"co-page-last",classPageOn:"on",idPageDropDown:"co-page-drop-down",msgPageNavi:desknets.Resource.Pager.msgPageNavi,msgPageMove:desknets.Resource.Pager.msgPageMove,msgPageInput:desknets.Resource.Pager.msgPageInput,msgPageInputBtn:desknets.Resource.Pager.msgPageInputBtn,msgPageFirst:desknets.Resource.Pager.msgPageFirst,msgPagePrev:desknets.Resource.Pager.msgPagePrev,msgPageNext:desknets.Resource.Pager.msgPageNext,msgPageLast:desknets.Resource.Pager.msgPageLast},output:function(e,b,f){var c={};var d="";a(e).find(b).each(function(){a(this).empty()});if(f.allCount>0){a.extend(c,this.objDefOptions,f);c=this._setOptionsMath(c);d=this._makeHtml(c)}a(e).find(b).each(function(){a(this).html(d)});if(c.maxPage>1&&typeof c.clickFunc=="function"){this._makeJs(e,b,c)}},_setOptionsMath:function(f){var i=f.getCount;var n=f.allCount;var h=f.pageMaxView;var d=f.startRow;var g=0;var m=0;var l=0;var c=0;i=desknets.parseNumber(i,0);n=desknets.parseNumber(n,0);h=desknets.parseNumber(h,100);d=desknets.parseNumber(d,0);if(h<=0){h=n;if(h<=0){h=100}}g=n/h;g=parseInt(g,10);c=n%h;if(c>0){g+=1}var b=1;b=parseInt(d/h+1,10);if(b>g){b=g}else{if(b<1){b=1}}m=(b-1)*h+1;if(m<0){m=0}l=m+i-1;if(l<0){l=0}var k=false;var j=false;var e=false;var o=false;if(b>1){k=true;j=true}if(b!=g){e=true;o=true}f.pageMaxView=h;f.startRow=d;f.nowPage=b;f.maxPage=g;f.viewStart=m;f.viewEnd=l;f.boFirst=k;f.boBefore=j;f.boAfter=e;f.boEnd=o;return f},_makeHtml:function(e){var c="";var b=[];var d=null;c=e.msgPageNavi;d=new RegExp("{{allcnt}}","ig");c=c.replace(d,e.allCount);d=new RegExp("{{start}}","ig");c=c.replace(d,e.viewStart);d=new RegExp("{{end}}","ig");c=c.replace(d,e.viewEnd);b[b.length]='<div class="co-page-text ';b[b.length]=e.classPageNavi;b[b.length]='">';b[b.length]=c;b[b.length]="</div>";if(e.maxPage>1){if(a("#"+e.idPageDropDown).length<=0){this._createDropDown(e)}b[b.length]='<ul class="';b[b.length]=e.classPagePaging;b[b.length]='">';b[b.length]='<li class="';b[b.length]=e.classPageMeta;b[b.length]='">';b[b.length]='<a class="';b[b.length]=e.classPageLink;b[b.length]=" ";b[b.length]=e.classPageToggle;b[b.length]='" data-for="';b[b.length]=e.idPageDropDown;b[b.length]='" href="#" >';c=e.msgPageMove;d=new RegExp("{{allpage}}","ig");c=c.replace(d,e.maxPage);d=new RegExp("{{nowpage}}","ig");c=c.replace(d,e.nowPage);b[b.length]=c;b[b.length]="</a>";b[b.length]="</li>";b[b.length]='<li class="';b[b.length]=e.classPageFirst;b[b.length]='">';if(e.boFirst){b[b.length]='<a class="';b[b.length]=e.classPageLink;b[b.length]='" href="#" title="';b[b.length]=e.msgPageFirst;b[b.length]='">';b[b.length]=e.msgPageFirst;b[b.length]="</a>"}else{b[b.length]='<span class="';b[b.length]=e.classPageLink;b[b.length]=' nolink" title="';b[b.length]=e.msgPageFirst;b[b.length]='">';b[b.length]=e.msgPageFirst;b[b.length]="</span>"}b[b.length]="</li>";b[b.length]='<li class="';b[b.length]=e.classPagePrev;b[b.length]='">';if(e.boBefore){b[b.length]='<a class="';b[b.length]=e.classPageLink;b[b.length]='" href="#" title="';b[b.length]=e.msgPagePrev;b[b.length]='">';b[b.length]=e.msgPagePrev;b[b.length]="</a>"}else{b[b.length]='<span class="';b[b.length]=e.classPageLink;b[b.length]=' nolink" title="';b[b.length]=e.msgPagePrev;b[b.length]='">';b[b.length]=e.msgPagePrev;b[b.length]="</span>"}b[b.length]="</li>";b[b.length]='<li class="';b[b.length]=e.classPageNext;b[b.length]='">';if(e.boAfter){b[b.length]='<a class="';b[b.length]=e.classPageLink;b[b.length]='" href="#" title="';b[b.length]=e.msgPageNext;b[b.length]='">';b[b.length]=e.msgPageNext;b[b.length]="</a>"}else{b[b.length]='<span class="';b[b.length]=e.classPageLink;b[b.length]=' nolink" title="';b[b.length]=e.msgPageNext;b[b.length]='">';b[b.length]=e.msgPageNext;b[b.length]="</span>"}b[b.length]="</li>";b[b.length]='<li class="';b[b.length]=e.classPageLast;b[b.length]='">';if(e.boEnd){b[b.length]='<a class="';b[b.length]=e.classPageLink;b[b.length]='" href="#" title="';b[b.length]=e.msgPageLast;b[b.length]='">';b[b.length]=e.msgPageLast;b[b.length]="</a>"}else{b[b.length]='<span class="';b[b.length]=e.classPageLink;b[b.length]=' nolink" title="';b[b.length]=e.msgPageLast;b[b.length]='">';b[b.length]=e.msgPageLast;b[b.length]="</span>"}b[b.length]="</li>";b[b.length]="</ul>"}return b.join("")},_createDropDown:function(e){var c=this;var b=[];var d=a('<div class="co-pop-up-box" />');d.attr("id",e.idPageDropDown);b[b.length]=e.msgPageInput;b[b.length]='<input class="';b[b.length]=e.classPageInput;b[b.length]='" maxlength="7" type="text" />';b[b.length]='<input class="';b[b.length]=e.classPageBtn;b[b.length]='" type="button" value="';b[b.length]=e.msgPageInputBtn;b[b.length]='" />';d.html(b.join("")).appendTo(document.body);d.find("input:button").click(function(f){c._triggerDropDownPageChange(a(this).closest(".co-pop-up-box"))});d.find("input:text").bind("keyup",function(f){if(f.keyCode==13){c._triggerDropDownPageChange(a(this).closest(".co-pop-up-box"));this.blur()}})},_triggerDropDownPageChange:function(b){var e=b.find("input:text");var d=b.data("source");var c=Math.floor(desknets.parseNumber(e.val(),0));if(c>0){desknets.popUp.hideAll();e.blur().val("");d.trigger("pageChanged.desknetsPager",{pageNo:c})}},_makeJs:function(d,c,e){var b=c+" ."+e.classPageLink;a(d).find(b).bind("pageChanged.desknetsPager",function(g,h){var f=(h.pageNo-1)*e.pageMaxView;e.clickFunc(f.toString())});if(e.boFirst){a(d).find(c+" ."+e.classPageFirst).click(function(f){f.preventDefault();e.clickFunc("0")})}if(e.boBefore){a(d).find(c+" ."+e.classPagePrev).click(function(h){h.preventDefault();var f=(e.nowPage-2)*e.pageMaxView;var g=""+f;e.clickFunc(g)})}if(e.boAfter){a(d).find(c+" ."+e.classPageNext).click(function(h){h.preventDefault();var f=(e.nowPage)*e.pageMaxView;var g=""+f;e.clickFunc(g)})}if(e.boEnd){a(d).find(c+" ."+e.classPageLast).click(function(h){h.preventDefault();var f=(e.maxPage-1)*e.pageMaxView;var g=""+f;e.clickFunc(g)})}}};desknets.selitem={TMPL_SELECTED_LABEL:'<span class="co-selitem"><span title="{{title}}" data-{{idnm}}="{{id}}">{{title}}</span><a title="{{del}}" href="#" class="co-btn co-btn-close">{{del}}</a><input type="hidden" name="{{idnm}}" value="{{id}}"/></span>',getSelectedLabel:function(){return desknets.tmpl.replaceWordHtml(this.TMPL_SELECTED_LABEL,"del",desknets.Resource.deselectLabel)},registryCloseEvent:function(c,b){c.delegate(".co-btn-close","click",function(d){d.preventDefault();if((typeof b)=="function"){b.call(a(this),d)}a(this).parent().remove()})},setUpDynamicSelect:function(e,c,d){var b=this,g=[];var f=a.extend({selectValue:"select",selectLabel:"("+desknets.Resource.selectLabel+")",selected:(c.length>0?c[0].value:""),chooserId:"chooser-selitem",chooserOptions:{}},d);a.merge(g,c);c.push({value:f.selectValue,label:f.selectLabel});desknets.htmlparts.setSelectOption(e,c,"value","label");e.val(f.selected).data("curr-value",f.selected);e.on("change.selitem",function(h){setTimeout(function(){var i=e.val();if(i==f.selectValue){b._openChooserFromDynamicSelect(e,d)}else{e.data("curr-value",i)}},50)})},_openChooserFromDynamicSelect:function(e,d){var c=this;var b=a.extend({},d.chooserOptions,{mode:"single",choose:function(f){if(f.length>0){c._setOption(e,f[0].id,f[0].name)}}});e.val(e.data("curr-value"));desknets.chooser.open(d.chooserId,b)},_setOption:function(c,d,b){var e=c.children().filter(function(){return this.value==d});if(e.length<=0){e=a("<option />").attr("value",d).insertBefore(c.children(":last"))}e.text(desknets.escapeSpace(b,true));c.data("curr-value",d).val(d)}};desknets.popUp={TMPL_POP_UP:'<div class="co-baloon" ><div class="co-baloon-connecter"><div class="co-baloon-connecter-inner"></div></div><div class="co-baloon-body"></div></div>',init:function(){var b=this;var c="hashchange.dnPopUp ";b._initPopUpBox();b._initDropDown(a(document.body));b._initSelectMenu(a(document.body));c+=desknets.browser.tablet?"orientationchange.dnPopUp":"resize.dnPopUp";a(window).bind(c,function(d){a(document.body).mousedown()})},open:function(c,b){var d=a();if(!!b.target){d=a(b.target);d.data("position",b.position);d.data("align",b.align)}if(d.length>0){c.addClass("co-pop-up-box");this._showPopUp(c,d)}},setToHoverPopup:function(b,d){var c=this;b.each(function(){c._hoverOn(a(this),d,function(){c._showPopUpWithoutClick(a(this))})})},hide:function(c){var b=a(c).closest(".co-pop-up-box.show");if(b.length>0){this._hidePopUp(b)}},hideAll:function(){var b=this;a(".co-pop-up-box.show").each(function(){b._hidePopUp(a(this))})},getSource:function(c){var b=c.closest(".co-pop-up-box").data("source");return !!b?b:a([])},updateConnecter:function(b){var e=this.getSource(b);if(b.hasClass("co-baloon")&&e.length>0){var d=this._getActualPosition(b,e);var c=b.attr("class");c=c.replace(/co-baloon-at-\w+-\w+/g,"");b.attr("class",c+" co-baloon-at-"+d)}},setSelectValue:function(c,d){var b=a("#"+c.data("for"));var e=b.find("a").filter(function(){return a(this).data("value")==d});if(e.length<=0){e=b.find("a").eq(0);d=e.data("value")}c.data("value",d);c.children(".co-select-menu-text").text(e.eq(0).text())},_initPopUpBox:function(){var b=this;a(document.body).mousedown(function(c){b._hidePopUpExceptFor(a(c.target))})},_initDropDown:function(c){var b=this;c.delegate(".co-drop-down-button","click",function(d){d.preventDefault();b._togglePopUpOfType(a(this))})},_initSelectMenu:function(c){var b=this;c.delegate(".co-select-menu","click",function(d){d.preventDefault();var e=a(this);if(!e.hasClass("co-disabled")){b._togglePopUpOfType(a(this),b._setUpSelectMenuPopUp)}})},_togglePopUpOfType:function(d,c){var b=a("#"+d.data("for"));if(b.length<=0){return}if(b.hasClass("show")){this._hidePopUp(b)}else{if(!b.data("source")&&a.isFunction(c)){c.apply(this,[b])}this._showPopUp(b,d)}},_showPopUpWithoutClick:function(c){var b=a("#"+c.data("for"));this._hidePopUpExceptFor(c);if(b.length>0&&!b.hasClass("show")){this._showPopUp(b,c)}},_showPopUp:function(b,e){var c=this;var d=this._getPosition(e);b.data("source",e);b.addClass("show").position(d);if(d.collision=="flip"){setTimeout(function(){c.updateConnecter(b)},0)}e.trigger("open.popup")},_hidePopUpExceptFor:function(c){var b=this;a(".co-pop-up-box.show").each(function(){var d=a(this);var e=b.getSource(d);if(c.closest(d).length>0||c.closest(e).length>0){return}b._hidePopUp(d)})},_hidePopUp:function(b){var c=this.getSource(b);b.removeClass("show");if(!!c&&c.length>0){b.data("source",a([]))}c.trigger("close.popup")},_setUpSelectMenuPopUp:function(b){var c=this;b.delegate("a","click",function(f){f.preventDefault();var e=a(this);var d=e.closest(".co-pop-up-box");var h=c.getSource(d);var g=e.data("value");h.find(".co-select-menu-text").html(e.html());h.find("input").val(g);h.data("value",g);h.trigger("change.selectMenu");c._hidePopUp(d)})},_getPosition:function(e){var d=e.data("position");var c=e.data("align");var b={of:e,collision:e.data("collision")};if(!b.collision){b.collision=!!d?"none":"flip"}if(d=="center"){c=c||"left top";return a.extend(b,{my:c,at:c})}else{if(d=="left"){c=c||"top";return a.extend(b,{my:"right "+c,at:"left "+c})}else{if(d=="right"){c=c||"top";return a.extend(b,{my:"left "+c,at:"right "+c})}else{if(d=="top"){c=c||"left";return a.extend(b,{my:c+" bottom",at:c+" top"})}else{c=c||"left";a.extend(b,{my:c+" top",at:c+" bottom"});return b}}}}},_getActualPosition:function(b,g){var c=b.offset();var d=g.offset();var f=c.top<d.top?"top":"bottom";var e=Math.abs(c.left-d.left)<=2?"right":"left";return f+"-"+e},_hoverOn:function(b,d,e){var g=null;function c(){g=setTimeout(function(){g=null;e.apply(b)},d)}function f(){if(!!g){clearTimeout(g)}}b.hover(c,f)}};desknets.timePicker={_options:{baseHour:0,chooseMinute:true,minHour:0,maxHour:23,minuteStep:1,required:false,hourFormat:"timePickerHourFormat",minuteFormat:"timePickerMinuteFormat"},create:function(e,c){var d=this._getOptions(e,c);var b=this._createElement(e,d);b.data("options",d);this._setFromInput(b);this._setToInput(b)},controlByRange:function(f,e,b,c){var d=this;f.parent(".co-timepicker").bind("timepickerchange",function(){d._setRange(f,e)});e.parent(".co-timepicker").bind("timepickerchange",function(){d._updateTimeOrRange(f,e,b,c)});d._setRange(f,e)},setToInput:function(b){this._setToInput(b)},_getOptions:function(g,c){var f;var e=a.extend({},this._options,c);var b={"base-hour":"baseHour","choose-minute":"chooseMinute","min-hour":"minHour","max-hour":"maxHour","minute-step":"minuteStep",required:"required","hour-format":"hourFormat","minute-format":"minuteFormat"};for(var d in b){var f=g.data(d);if(typeof f!="undefined"){e[b[d]]=f}}return e},_createElement:function(e,d){var c=this;var b=e.wrap('<span class="co-timepicker" />').parent();e.addClass("co-timepicker-value");b.append(this._createHourSelect(d));if(d.chooseMinute){b.append(this._createMinuteSelect(d))}b.children("select").change(function(f){c._setFromSelect(a(this))});return b},_createHourSelect:function(f){var e=a('<select class="co-timepicker-hour" />');var g=desknets.Resource[f.hourFormat];for(var b=f.minHour;b<=f.maxHour;b++){var d=desknets.tmpl.replaceWordHtml(g,"hour",b);d=neo.dateTime.format(d,new Date(1970,0,1,b,0,0));a("<option />").attr("value",b).text(d).appendTo(e)}if(!f.required){var c=e.children().eq(f.baseHour);a('<option value="">--</option>').insertBefore(c)}return e},_createMinuteSelect:function(d){var c=a('<select class="co-timepicker-minute" />');var e=desknets.Resource[d.minuteFormat];if(d.minuteStep==0){d.minuteStep=1}for(var f=0;f<60;f+=d.minuteStep){var b=neo.dateTime.format(e,new Date(1970,0,1,0,f,0));a("<option />").attr("value",f).text(b).appendTo(c)}if(!d.required){a('<option value="">--</option>').prependTo(c)}return c},_setFromSelect:function(c){var b=c.parent();var f=c.siblings("select");var e=c.val();var d=f.val();if(e==""&&d!=""){f.val("")}if(e!=""&&d==""){f.children('[value=""]').next().attr("selected",true)}this._setToInput(b);b.trigger("timepickerchange")},_setFromInput:function(e){var d=e.data("options");var g=e.children(".co-timepicker-hour");var c=e.children(".co-timepicker-minute");var f=e.children(".co-timepicker-value").val();if(f==""){if(d.required){g.val(d.baseHour);c.val(0)}else{g.val("");c.val("")}}else{var b=Number(f.substring(0,2));var h=Number(f.substring(2,4));g.val(b);c.val(Math.floor(h/d.minuteStep)*d.minuteStep)}},_setToInput:function(c){var b=c.children(".co-timepicker-hour").val();var d=c.children(".co-timepicker-minute").val()||0;var f=c.children(".co-timepicker-value");if(b==""){f.val("")}else{var e=10000+Number(b)*100+Number(d);f.val(String(e).substring(1))}},_updateTimeOrRange:function(i,f,b,c){if(!!b&&!!c){var e=b.datepicker("getDate");var g=c.datepicker("getDate");var h=neo.dateTime.getDaysGap(g,e);if(h>0){this._updateTimeByRange(i,f,b)}else{if(h<0){this._setRange(i,f)}}}var d=i.parent(".co-timepicker").data("range");if(typeof d!="undefined"&&d>0){this._updateTimeByRange(i,f,b)}else{this._setRange(i,f)}},_updateTimeByRange:function(i,k,b){var j=k.siblings(".co-timepicker-hour").val();var g=k.siblings(".co-timepicker-minute").val();var f=i.parent(".co-timepicker");var e=f.data("range");if(neo.isSet(j,{blank:false})&&typeof e!="undefined"){var d=Number(j)+Math.floor((Number(g)+e)/60);var c=(Number(g)+e+1440)%60;if(d>=24){this._moveDate(b,1);d-=24}else{if(d<0){this._moveDate(b,-1);d+=24}}i.val(desknets.zeroPadding(d*100+c,4));this._setFromInput(f);i.trigger("timepickerchange")}},_moveDate:function(e,d){if(!!e&&!e.datepicker("isDisabled")){var c=e.datepicker("getDate");var b=neo.dateTime.moveDate(c,d);e.datepicker("setDate",b)}},_setRange:function(i,d){var b=i.siblings(".co-timepicker-hour").val();var h=d.siblings(".co-timepicker-hour").val();var f=i.siblings(".co-timepicker-minute").val();var e=d.siblings(".co-timepicker-minute").val();var g=i.parent(".co-timepicker");if(neo.isSet(b,{blank:false})&&neo.isSet(h,{blank:false})){var c=(Number(b)-Number(h))*60+Number(f)-Number(e);g.data("range",c)}else{g.removeData("range")}}};a.widget("desknets.dnAttachList",{_TMPL_FILENAME:"com/attach.list.html",_$tbody:null,_tmplItem:null,options:{files:[],uploadURL:"/",uploadParams:{},delURL:"/",delParams:{},downloadURL:"/",totalSizeLimit:2147483648,hideElementOnEmpty:null,toggleTargetFunc:null,tmpnm:""},_create:function(){var c=this;var b=desknets.Resource.Message;c._initOptionsWithElement();desknets.tmpl.load(this.element,this._TMPL_FILENAME,function(){c._$tbody=c.element.find("tbody");c._tmplItem=c._$tbody.html().replace("data-href","href");c._$tbody.empty();c._initItems();c.element.find(".jco-selfile-button").click(function(d){c.openChooser()});c.element.find(".jco-remove-all-button").click(function(d){desknets.dialog.confirm(b.com_attachlist_confirm_all,function(){c.removeAll()})});c._$tbody.delegate(".co-btn-close","click",function(e){e.preventDefault();var d=a(this).closest("tr");desknets.dialog.confirm(b.com_attachlist_confirm_one,function(){c._beginToDeleteItem(d)})})},{cache:true})},openChooser:function(){var c=this;var d={uploadURL:this.options.uploadURL,uploadParams:this.options.uploadParams,delURL:this.options.delURL,delParams:a.extend({},this.options.delParams),downloadURL:this.options.downloadURL,totalSizeLimit:this.options.totalSizeLimit,file:{tmpnm:this.options.tmpnm,files:this.options.files},done:function(e){c._addItems(e.files,e.tmpnm)}};var b=desknets.attach.ext.getIconList();if(b){d.icon=b}desknets.attach.uploadDialog(d)},removeAll:function(){var b=this;desknets.attach.deleteAttachFile({delURL:b.options.delURL,delParams:a.extend({},b.options.delParams),done:function(){b._deleteAllItems()}})},updateFile:function(d){var b=this;var c=[];a.each(d,function(e,f){c.push({fno:f.id,attachdisp:f.attachdisp,size:Number(f.size),})});b.options.files=c;b._$tbody.empty();b._initItems()},_initOptionsWithElement:function(){var b=this.element.data("totalsizelimit");if(!!b){this.options.totalSizeLimit=b}this._initFilesWithElement()},_initFilesWithElement:function(){var b=this;var d=[];var c=this.element.find(".jco-attach-file");if(c.length>0){c.each(function(){var e=a(this);d.push({fno:this.value,attachdisp:e.data("name"),size:e.data("size")})});this.options.files=d}},_initItems:function(){this._addItemElements(this.options.files);this._updateTempName(this.options.tmpnm);this._updateToggleTarget(true)},_beginToDeleteItem:function(c){var b=this;var d=c.data("fno");var e=a.extend({},this.options.delParams);e.fno=d;desknets.attach.deleteAttachFile({delURL:this.options.delURL,delParams:e,done:function(){b._deleteItem(c,d)}})},_addItems:function(b,d){for(var c=b.length-1;c>=0;c--){this._deleteWithName(b[c].attachdisp)}this._addItemElements(b);a.merge(this.options.files,b);this._updateTempName(d);this._updateToggleTarget(false)},_deleteWithName:function(b){var d=this.options.files;for(var c=d.length-1;c>=0;c--){if(d[c].attachdisp==b){this._deleteItem(this._$tbody.children().eq(c),d[c].fno);break}}},_deleteItem:function(c,e){var d=this.options.files;var b=function(f,g){return f.fno==g};c.remove();this.options.files=neo.array.remove(d,e,b);this._updateToggleTarget(false)},_deleteAllItems:function(){this._$tbody.empty();this.options.files=[];this._updateToggleTarget(false)},_addItemElements:function(b){for(var e=0;e<b.length;e++){var d=this._tmplItem,c;d=desknets.tmpl.replaceWordHtml(d,"fno",b[e].fno);d=desknets.tmpl.replaceWord(d,"attachdisp",b[e].attachdisp);if(b[e].size==-1){d=desknets.tmpl.replaceWordHtml(d,"displaySize",desknets.Resource.attachInvSize)}else{c=desknets.formatFileSize(b[e].size,{minUnit:"KB",maxUnit:"KB"});d=desknets.tmpl.replaceWordHtml(d,"displaySize",c)}d=desknets.tmpl.replaceWord(d,"downloadURL",this._getDownloadURL(b[e]));a(d).appendTo(this._$tbody)}},_updateTempName:function(c){if(!!c){var d=this.element.find('input[name="tmpnm"]');if(d.length<=0){var b=this.element.find(".jco-selfile-button");d=a('<input type="hidden" name="tmpnm" />').insertAfter(b)}d.val(c);this.options.tmpnm=c}},_updateToggleTarget:function(b){if(!!this.options.hideElementOnEmpty){if(!!this.options.files&&this.options.files.length>0){a(this.options.hideElementOnEmpty).show()}else{a(this.options.hideElementOnEmpty).hide()}}if(!!this.options.toggleTargetFunc){this.options.toggleTargetFunc()}if(!b){this.element.addClass(desknets._CLSNAME_MODFILES)}},_getDownloadURL:function(c){var b=String(this.options.downloadURL);if(!!this.options.tmpnm){b=desknets.tmpl.replaceWordHtml(b,"tmpnm",this.options.tmpnm)}return desknets.attach.getDownloadUrl({downloadURL:b,fno:c.fno,attachdisp:c.attachdisp})},_getTotalSize:function(){var c=0;if(!!this.options.files){for(var b=0;b<this.options.files.length;b++){c+=this.options.files[b].size}}return c}});desknets.attachDisp={_TMP_ATTACHAREA:'<div class="jco-attach-area co-tp-e-file"><table class="co-selfile"><tbody>{{tmpl}}</tbody></table></div>',disp:function(f,b,c){var l=this;if(!f||!f.item){return"&nbsp;"}var e="";var d,j;var h={};if(b!=null){b=desknets.getUrl(b)}var g=desknets.ajax.getItems(f.item);var i=desknets.getNeoParam(c);d=g.length;if(d==0){return"&nbsp;"}h.cgi=b;h.query=i;for(j=0;j<d;j++){var k=l.editDispItem(j,g[j],h);e=e+k}if(j>0){e=desknets.tmpl.replaceWordHtml(l._TMP_ATTACHAREA,"tmpl",e)}return e},editDispItem:function(f,g,e){var i=this;var h="",b,j="";var c=desknets.tmpl.escapeWord(g.attachdisp);var d=desknets.tmpl.escapeWord(encodeURIComponent(g.attachdisp.replace(/'/g,"%27")));if(g.size){j=desknets.attachDisp.getSize(g.size)}else{j=desknets.Resource.attachInvSize}if(e.cgi==null){h="<td>"+c+'</td><td class="co-td-num">'+j+"</td>"}else{b=e.cgi+"?"+e.query+"&fno="+g.id+"&filename="+d;h='<td><a target="attach" href="'+b+'">'+c+'</a></td><td class="co-td-num">'+j+"</td>"}h="<tr>"+h+"</tr>";return h},dispDelimited:function(){return",\n"},getSize:function(b){return desknets.formatFileSize(b,{minUnit:"KB",maxUnit:"KB"})}};a.extend(desknets.attachDisp,{VAL_ATTACHDISP_THUM:"0",VAL_ATTACHDISP_LIST:"1",_listDispAtts:{},_attziping:false,_onStopattziping:false,_attZipPid:"",_appZipFName:"",removeAttachAlink:function(b,e){var d="";var c=neo.isSet(e)?e:true;var f=b.find(".jco-attach-area");a.each(f.find("tr"),function(k,l){var j=a(this);var h="";if(c){h="<td>"+j.find("td").first().text()+"</td>";j.find("td").first().remove();j.prepend(h)}else{var m="",g="";if(k>0){d=d+", "}m=j.find("a").text();g=j.find("td").eq(1).text();h=m+"("+g+")";d=d+h}});if(!c){f.text(d)}return},displist:function(q,m,r){if(!q||!q.item){return""}var l=this;var i="";var p,o;l._listDispAtts={};m=desknets.getUrl(m);var g=desknets.ajax.getItems(q.item);var f=desknets.getNeoParam(r);p=g.length;if(p==0){return""}l._listDispAtts.fCnt=p;for(o=0;o<p;o++){var d="",e,k="",s={};var n;var j=a("<div />");var h=g[o];var t=desknets.tmpl.escapeWord(h.attachdisp);var b=h.id;if(h.size){k=desknets.attachDisp.getSize(h.size)}else{k=desknets.Resource.attachInvSize}e=m+"?"+f+"&fno="+b+"&filename="+encodeURIComponent(h.attachdisp).replace(/'/g,"%27");s={name:t,fno:b,url:e+"&updtime={{updtime}}"};l._listDispAtts[o]=s;d='<li id="co-pop-tp-file-fno'+b+'"><div class="co-pop-tp-file-dtl"><div class="co-pop-tp-file-name"><a title="'+t+'" href="'+e+'" target="attach">'+t+'</a></div><div class="co-pop-tp-file-size"><div class="co-pop-tp-file-size-in">'+k+"</div></div></li>";var c=a('<a href="'+e+'" target="attach" class="co-pop-tp-file-thumbnail"></a>');j.append(a(d).prepend(c));i=i+j.html()}return i},displistThumb:function(b,e,c){var l=this;var i={};var j=0;if(!neo.isSet(b)){return}if(a.isEmptyObject(l._listDispAtts)||l._listDispAtts.fCnt==0){return}a.extend(i,l._listDispAtts);if(neo.isSet(e)&&e.list){desknets.attach.ext.saveList(e)}var g={};var d=desknets.attach.ext.getIconList();if(d){g.icon=d}for(j=0;j<i.fCnt;j++){var f;f=desknets.attach.getThumbnailImage(i[j],g);if(c===true){var k=f.attr("src");var h=k.indexOf("?");if(h>0){k=k+"&thumbnail=1";f.attr("src",k)}}var m=b.find("#co-pop-tp-file-fno"+i[j].fno).eq(0);m.find("a.co-pop-tp-file-thumbnail").append(f)}},initDispList:function(e){var b=this;var c=e.find(".co-pop-tp-meta-switch");var d=a.cookie(desknets.COOKIENAME_ATTACHDISP_LIST);if(d&&d==b.VAL_ATTACHDISP_LIST){c.closest(".co-pop-tp-file-drop").addClass("list")}c.delegate(".thumb","click",function(f){f.preventDefault();a(this).closest(".co-pop-tp-file-drop").removeClass("list");desknets.saveCookieToDisk(desknets.COOKIENAME_ATTACHDISP_LIST,b.VAL_ATTACHDISP_THUM)});c.delegate(".list","click",function(f){f.preventDefault();a(this).closest(".co-pop-tp-file-drop").addClass("list");desknets.saveCookieToDisk(desknets.COOKIENAME_ATTACHDISP_LIST,b.VAL_ATTACHDISP_LIST)})},zipDownLoad:function(c){var b=this;var e=null;b._initAttZipFlg();b._attZipFName="";b._attZipPid="";b._attziping=true;var d=a.extend({},c);e=b._openAttZipDialog(d);desknets.ajax.rest({url:d.url,data:d.execParam,success:function(g,f,h){if(neo.isSet(g.attzippid)&&g.attzippid.length>0){b._attZipPid=g.attzippid;d.execParam.attzippid=b._attZipPid}if(neo.isSet(g.filename)&&g.filename.length>0){b._attZipFName=g.filename}if(!!b._onStopattziping){b._onStopattziping=false}else{d.execParam.execcheck="1";b._checkAttZipExec(e,d)}},error:function(h,g,f){b._initAttZipFlg();e.dialog("close");desknets.ajax.onError(h.status,f)}})},_initAttZipFlg:function(){var b=this;if(!!b._onStopattziping){b._onStopattziping=false}if(!!b._attziping){b._attziping=false}},_openAttZipDialog:function(e){var b=this;var f;var c={type:"message",extraMessage:desknets.Resource.Message.com_dialog_execaddmsg,extraClass:"co-loading-dialog",btnLabel:desknets.Resource.abortLabel,close:function(){var h=b._attZipPid;if(!!b._attziping){b._cancelAttZip(f,e);var i=setInterval(function(){if(!b._onStopattziping){clearInterval(i);f.dialog("close")}},500);return false}else{if(neo.isSet(e.delParam)&&neo.isSet(h)&&h.length>0){e.delParam.attzippid=h;b._delAttZip(e)}}}};var g=desknets.Resource.Message.att_zip_exec;var d=desknets.Resource.Message.att_zip_download;f=desknets.dialog.alert(g,c);f.parent("div").find(".ui-dialog-title").text(d);return f},_checkAttZipExec:function(e,d){var b=this;var c=setInterval(function(){if(!!b._attziping){desknets.ajax.rest({url:d.url,data:d.execParam,success:function(g,f,h){if(!!b._onStopattziping){b._onStopattziping=false;return}if(g.execflg=="0"){clearInterval(c);b._attziping=false;if(neo.isSet(g.mymessage)||neo.isSet(g.message)){e.dialog("close");desknets.dialog.alert(b._makeAttZipErrorMsg(g))}else{b._chgAttZipDialog(e,d)}}},error:function(g,f,h){b._initAttZipFlg();clearInterval(c);e.dialog("close");desknets.ajax.onError(g.status,h)}})}else{b._initAttZipFlg();clearInterval(c)}},5000)},_makeAttZipErrorMsg:function(d){var c=this;var b="";if(neo.isSet(d.mymessage)&&d.mymessage.length>0){b=d.mymessage}if(neo.isSet(d.message)&&d.message.length>0){if(neo.isSet(b)&&b.length>0){b=b+"\n"}b=b+d.message}return b},_delAttZip:function(c){var b=this;desknets.ajax.rest({url:c.url,data:c.delParam})},_cancelAttZip:function(d,c){var b=this;b._attziping=false;b._onStopattziping=true;desknets.submitform.setDialogDisabled(d);desknets.ajax.rest({url:c.url,data:c.cancelParam})},_chgAttZipDialog:function(h,b){var j=this;var c=encodeURIComponent(j._attZipFName).replace(/'/g,"%27");var f=desknets.getNeoParam(b.downParam);var d=b.downLoadUrl+"?"+f+"&attzippid="+j._attZipPid+"&filename="+c;var g=desknets.Resource.Message.att_zip_fin;var e=desknets.Resource.Message.att_zip_downlink;var i='<a target="attach" href="'+d+'">'+e+"</a>";h.find(".co-message").before(g);h.find(".co-message > span").html(i);h.find(".co-message > span").addClass("co-attzip-download");h.find(".co-loading-dialog > span").hide();h.parent("div").find(".ui-dialog-buttonset .ui-button-text").text(desknets.Resource.closeLabel)}});(function(b){desknets.tagDisp={_COLORS:{"1":"blue","2":"green","3":"yellow","4":"pink","5":"red","6":"gray"},color0:"x",getTagColorClass:function(d){var c=this._COLORS[d];if(neo.isSet(c)){return c}else{return"none"}},getTagColorTitle:function(d){var c=desknets.Resource.tags["color"+d];if(neo.isSet(c)){return c}else{return this.color0}},initTagEvent:function(d,e){if(d){var c=desknets.getUrl(d);b(".jco-tag-select-item").click(function(f){e.tagcolor=b(this).parent().data("value");desknets.ajax.rest({url:c,data:e})})}},initEntryPageTag:function(f){var g=f.prev();var d=g.find('input[name="tagcolor"]').val();var c=g.find(".co-tag-select-item");c.addClass(desknets.tagDisp.getTagColorClass(d));var e=desknets.tagDisp.getTagColorTitle(d);c.attr("title",e);c.text(e)}}})(jQuery);desknets.scrollManager={$scrollRoot:desknets.browser.msie8?a(window):a(document),_targets:null,_currCmd:null,_defOptions:{delay:0,active:false},setScrollPosition:function(c,e,b){var d;if(!this._targets){this._init(c)}if(!!this._targets[c]){this._targets[c].element=e;d=this._targets[c]}else{d=a.extend({element:e},this._defOptions,b);this._targets[c]=d}this._setUpScroll(e);this._restoreScroll(e,d)},clearScrollPosition:function(b){var c=!!this._targets&&!!this._targets[b]?this._targets[b]:null;if(!!c){if(typeof c.x!="undefined"){c.x=0}if(typeof c.y!="undefined"){c.y=0}this._restoreScroll(a(c.element),c)}},_init:function(c){var b=this;this._targets={};this._currCmd=c;a(document).on("pageChanged.desknets",function(d,e){b._onPageChange(e.prevCmd,e.currCmd)});a(document).on("paramChanged.desknets",function(d,e){b._onParamChange()})},_onPageChange:function(c,b){this._currCmd=b;if(c&&this._targets[c]){this._onHidePage(c,b,this._targets[c])}if(b&&this._targets[b]){this._onShowPage(c,b,this._targets[b])}},_onShowPage:function(c,b,d){},_onHidePage:function(c,b,d){a(d.element).off("scroll.dnScrollManager");d.active=false},_onParamChange:function(){this.clearScrollPosition(this._currCmd)},_onScrollView:function(b){var c=this._targets[this._currCmd];if(!!c){this._saveScroll(b,c)}},_saveScroll:function(b,c){setTimeout(function(){if(!!c.active){if(typeof c.x!="undefined"){c.x=b.scrollLeft()}if(typeof c.y!="undefined"){c.y=b.scrollTop()}}},c.delay)},_restoreScroll:function(b,c){setTimeout(function(){if(!b.is(document)){desknets.moveScroll()}if(typeof c.x!="undefined"){b.scrollLeft(c.x)}if(typeof c.y!="undefined"){b.scrollTop(c.y)}c.active=true},c.delay)},_setUpScroll:function(c){var b=this;c.on("scroll.dnScrollManager",function(d){b._onScrollView(a(this))})}};desknets.ListSortable=function(c,b){this.init(c,b);return this};desknets.ListSortable._TMPL_BAR='<div class="co-move-bar"><div class="co-move-bar-arrow"></div></div>';desknets.listSortable={$page:a(),mode:"",_MODES:["sort","pagingSort","drag"],_$table:a(),_$draggable:a(),_$bar:a(),_params:{},_idEntries:null,_isProcessing:false,_isSortable:true,_isCheckedAll:false,_options:{disabled:false,draggableOptions:{},dragToExternal:false,url:"",sortCmd:"",sortParamFilter:null,confirmMessage:desknets.Resource.Message.com_move_conf,getAdditionalData:null,start:function(){},change:function(b){},stop:function(){}},init:function(c,b){this.$page=c;this._$draggable=c.find(".co-tbody-list");this._$table=this._$draggable.parent();this._$bar=a(desknets.ListSortable._TMPL_BAR);this._options=a.extend({},this._options,b);this._initActionArea();this.fixListItems();if(!!this._options.disabled){this._options.disabled=false;this.disable()}},enable:function(){if(!!this._options.disabled){this.$page.find(".jco-list-move").attr("disabled",false);this._options.disabled=false;this._setEnabilityWithCheckbox()}},disable:function(){if(!this._options.disabled){this.$page.find(".jco-list-move").attr("disabled",true);this._$draggable.draggable("disable");this._options.disabled=true}},startToSort:function(){var b=this._getCheckedItems();this._checkAndStartToSort(b,"pagingSort",function(c){desknets.dialog.alert(c,{type:"warn"})})},setSortable:function(b){this._isSortable=b},resetMode:function(){if(a.inArray(this.mode,this._MODES)>=0){this._unsetToSortMode()}},fixListItems:function(){var c=this,b=a.inArray(this.mode,this._MODES)>=0;this.$page.find("input:checkbox").each(function(){var e=a(this);var d=this.value;e.attr("disabled",b);if(b&&!!d&&!!c._idEntries[d]){e.attr("checked",true);e.closest("tr").addClass("co-tr-selected")}});c._hidePlaceholder()},_initActionArea:function(){var b=this;b._$table.wrap('<div class="co-table-move-wrap" />');b._$draggable.draggable(b._getDraggableOption());b.$page.delegate(".co-chk-cnt a, input:checkbox","click",function(){setTimeout(function(){b._setEnabilityWithCheckbox()},0)});b.$page.find(".jco-list-move").click(function(c){c.preventDefault();b.startToSort()});b.$page.find(".jco-list-off-move").click(function(c){c.preventDefault();b.resetMode()})},_startToDragging:function(){var b=this._getCheckedItems();var c=this._isSortable&&!this._isCheckedAll?"sort":"drag";this._checkAndStartToSort(b,c,function(){})},_endToDragging:function(){if(a.inArray(this.mode,["sort","pagingSort"])>=0){this._confirmToSort()}else{if(this.mode=="drag"){this.resetMode()}}},_checkAndStartToSort:function(b,d,c){if(a.inArray(this.mode,this._MODES)<0){if(!this._validateForSortMode(b,d,c)){return}this._setToSortMode(b,d)}},_validateForSortMode:function(b,e,d){if(b.length<=0){var c=desknets.Resource.Message.com_move_nochecked;d(c);return false}if(e!="drag"||!this._options.dragToExternal){if(this.$page.find(".co-chk-cnt-all").is(":visible")){var c=desknets.Resource.Message.com_move_allchecked;d(c);return false}}return true},_setToSortMode:function(b,d){this.mode=d;this._params={id:b};this._idEntries=this._getIdEntries(b);if(d=="sort"||d=="pagingSort"){this.$page.addClass("co-page-move-mode");a('<div class="co-move-list-overlay" />').insertBefore(this._$table);if(d=="pagingSort"){this.$page.addClass("co-page-paging-move-mode");var c=desknets.Resource.Message.com_listchk_cnt_move;c=desknets.tmpl.replaceWordLF(c,"num",b.length+" ");this.$page.find(".co-chk-cnt-move-chk").html(c);this._$draggable.draggable("disable")}this._attachSortEvent()}this.fixListItems();this._options.start()},_attachSortEvent:function(){var c=this;var b=c._$table.closest(".co-table-move-wrap");b.bind("mousemove.listSortable",function(d){c._updatePlaceholder(d.pageY)});b.bind("mouseleave.listSortable",function(d){c._clearPlaceholder()});if(c.mode=="pagingSort"){b.bind("click.listSortable",function(d){c._confirmToSort()})}},_unsetToSortMode:function(){if(this.mode=="sort"||this.mode=="pagingSort"){this._detachSortEvent();if(this.mode=="pagingSort"){this._$draggable.draggable("enable");this.$page.removeClass("co-page-paging-move-mode")}this._$table.siblings(".co-move-list-overlay").remove();this.$page.removeClass("co-page-move-mode");this._$bar.remove()}this.mode="";this._params={};this._idEntries={};this.fixListItems();this._options.stop()},_detachSortEvent:function(){var b=this._$table.closest(".co-table-move-wrap");b.unbind("mousemove.listSortable");b.unbind("mouseleave.listSortable");if(this.mode=="pagingSort"){b.unbind("click.listSortable")}},_getDraggableOption:function(){var b=this;return a.extend({cancel:"input, a",appendTo:b._$table.closest(".co-table-move-wrap"),cursorAt:{left:-5,top:0},helper:function(c){return b._createDragHelper(c)},start:function(c,d){b._startToDragging(c)},stop:function(c){b._endToDragging()}},this._options.draggableOptions)},_createDragHelper:function(d){var c=d.originalEvent;if(!!c){var e=c.target||c.srcElement;var b=a(e).closest("tr");b.find("input:checkbox").prop("checked",true)}return a('<div id="co-dragtip" />').text(this._createDragHelperLabel())},_createDragHelperLabel:function(){var c,d,b;c=this._$table.find(">tbody input:checked");if(c.length==1){d=c.closest("tr").find(".jco-dragname");if(d.length>0){return d.text()}}b=desknets.Resource.listSortableCountFormat;b=desknets.tmpl.replaceWordHtml(b,"count",Math.max(c.length,1));return b},_setEnabilityWithCheckbox:function(){if(!!this._options.disabled){return}var d=this._$draggable.find("input").filter(function(){return this.type=="checkbox"&&!this.checked});var c=d.length>0||this._options.dragToExternal;var b=!this._$draggable.draggable("option","disabled");if(c&&!b){this._$draggable.draggable("enable")}else{if(!c&&b){this._$draggable.draggable("disable")}}this._isCheckedAll=d.length<=0},_getCheckedItems:function(){var b=[];this._$table.find(">tbody input:checked").each(function(){b.push(this.value)});return b},_getIdEntries:function(b){var c={};a.each(b,function(d,e){c[e]=e});return c},_clearPlaceholder:function(){if(!this._isProcessing){this._params.destid=null;this._$bar.remove()}},_updatePlaceholder:function(c){var b=this._$table.closest(".co-table-move-wrap").offset();if(this._isProcessing||!b){return}var f=this._getHoveredPlaceholder(this._$table.find("tbody>tr"),c);var e=f.outerHeight();var d=f.offset();if(f.length<=0||!d){return}this._params.destid=f.find("input:checkbox").val();if(c<=d.top+e/2){this._putPlaceholder(d.top-b.top);this._params.proc="+"}else{this._putPlaceholder(d.top+e-b.top);this._params.proc="-"}},_getHoveredPlaceholder:function(b,d){if(b.length<=0){return a()}var c=Math.floor(b.length/2);var g=b.eq(c);var f=g.find("td:first").height();var e=g.offset();if(!e){return a()}else{if(d<e.top){return this._getHoveredPlaceholder(b.slice(0,c),d)}else{if(d<=e.top+f){return g}else{return this._getHoveredPlaceholder(b.slice(c+1),d)}}}},_putPlaceholder:function(b){this._$bar.css({top:Math.floor(b)+"px"});if(this._$bar.closest(".co-tbody-list").length<=0){this._$bar.insertBefore(this._$table)}},_hidePlaceholder:function(){this._$bar.remove()},_confirmToSort:function(){var b=this,c=this._options.confirmMessage;var e=function(){if(b.mode=="sort"){b.resetMode()}b._isProcessing=false};b._isProcessing=true;if(!b._params.id||!b._params.destid){e();return}var d=desknets.dialog.confirm(c,function(){b._beginToSortRequest({beforeSend:function(){desknets.submitform.setDialogDisabled(d)},complete:function(){desknets.submitform.clearDialogDisabled(d);e();d.dialog("close")}})},{cancel:e})},_beginToSortRequest:function(c){var b=this;var d=a.extend(c,{url:b._options.url,data:b._getSortRequestData(),success:function(e){b._endToSortRequest(e)}});desknets.ajax.rest(d)},_getSortRequestData:function(){var c=a.extend({cmd:this._options.sortCmd},this._params);if(typeof this._options.sortParamFilter=="function"){this._options.sortParamFilter(c)}if(typeof this._options.getAdditionalData=="function"){var b=[];b.push(c);b.push(this._options.getAdditionalData());c=desknets.ajax.arrayToMultiCmdData(b)}return c},_endToSortRequest:function(b){var c=b["1"]||null;this._options.change(c);this.resetMode()},_setDragEnable:function(){this._$draggable.draggable("enable")},_setDragDisable:function(){this._$draggable.draggable("disable")}};desknets.ListSortable.prototype=desknets.listSortable;desknets.ListSortablePane=function(c,b,d){this.init(c,b,d);return this};desknets.listSortablePane={_treeOptions:{treeClass:"co-listview-tree"},_$tree:null,_$overlay:a(),_seqEnable:true,init:function(c,b,d){this.$page=c;this._$draggable=c.find(".co-tbody-list");this._$table=this._$draggable.parent();this._$bar=a(desknets.ListSortable._TMPL_BAR);this._options=a.extend({},this._options,b);this._treeOptions=a.extend({},this._treeOptions,d);this._$tree=c.find("."+this._treeOptions.treeClass);this._$overlay=c.find(".co-listview-overlay");this._initActionArea();this.fixListItems();if(!!this._options.disabled){this._options.disabled=false;this.disable()}},resetMode:function(){if(a.inArray(this.mode,["sort","pagingSort"])>=0){this._$overlay.removeClass(this.mode);this._unsetToSortMode()}},_getDraggableOption:function(){var b=this;return{appendTo:"body",cursorAt:{left:-5,top:0},helper:function(c){return b._createDragHelper(c)},start:function(c,d){b._startToDragging(c)},stop:function(){b._options.stop();if(b._$tree.hasClass("jco-tree-dropend")){b.resetMode()}else{if(!!b._seqEnable){b._confirmToSort()}}b._$tree.removeClass("jco-tree-dropend")}}},_createDragHelper:function(b){return this._options.helper(b)},_setEnabilityWithCheckbox:function(){if(!!this._options.disabled){return}var b=this._$draggable.find("input").filter(function(){return this.type=="checkbox"&&!this.checked});if(b.length>0){this._seqEnable=true}else{if(b.length<=0){this._seqEnable=false}}this._setDragEnable()},_checkAndStartToSort:function(b,e,d){if(a.inArray(this.mode,["sort","pagingSort"])<0){var c=this.$page.find(".jco-list-move").attr("disabled");if(!this._validateForSortMode(b,e,d)||neo.isSet(c)){this._seqEnable=false;if(e=="sort"){this._options.start()}return}this._seqEnable=true;this._setToSortMode(b,e);this._$overlay.addClass(e)}},};desknets.ListSortablePane.prototype=a.extend({},desknets.listSortable,desknets.listSortablePane);(function(b){desknets.page=function(e,h,f,d){var g={callBase:function(m){var l=this;function n(p,q){for(var o in p){if(p[o]==q){return true}}return false}function k(p,q){for(var o=p;!!o;o=o._baseClass){if(n(o,q)){return o._baseClass}}return null}function j(q,p){for(var o=q;!!o;o=o._baseClass){if(b.isFunction(o[m])){return o[m].apply(l,p)}}throw"No method in base class"}return j(k(this._thisClass,arguments.callee.caller),Array.prototype.slice.call(arguments,1))}};function i(){var j=b.extend({},d);j._baseClass=!!f?f._thisClass:null;return j}function c(){var k={};var j=!!f?f:g;b.extend(k,j,d);k._thisClass=i();return k}e[h]=c()}})(jQuery);(function(b){desknets.page(desknets,"PageBase",null,{_mIdPageForm:null,boConnecting:false,_defFormVals:{},mboHasMceEditor:false,$mobjConfirmDlg:null,boautosave:false,borte:false,init:function(){this._initBeforeUnload()},_initBeforeUnload:function(){var e=this;var f;b(window).off("beforeunload.pageBase");if(!e._getBeforeUnloadExec()){return}f=e._getBeforeUnloadMsg();var d=b(window).data("hashobserver");if(d){d.beforeChangePageHash=desknets.paramanalyzer.getLocationHash()}function c(g){e._onBeforeUnload(g);if(neo.isSet(e.$mobjConfirmDlg)&&e.$mobjConfirmDlg.dialog("isOpen")==true){e.$mobjConfirmDlg.dialog("close");return}if(e._formObserveisChanged()&&neo.isSet(f)){g=g||window.event;g.returnValue=f;if(e.boautosave===true){desknets.autosave.save("0","1")}return f}}b(window).on("beforeunload.pageBase",c)},_setBaseHashCmdFlagInit:function(){if(!desknets.isCallExecLocation()){var c="";c=desknets.paramanalyzer.getHashParam("cmd");if(c!=undefined&&c!=""){desknets.saveHashCmdCookie(this._getBaseHashCmd())}}},_getBaseHashCmd:function(){return b("#jco-pv-funcid").val()},funcHashObserver:function(){neo.ajax.abort("desknets-page",true);var c=desknets.paramanalyzer.getHashParams();this.initParamsFromHash(c);this.initReqSend();return},initParamsFromHash:function(d){var c=this;if(c.mboHasMceEditor){c._pageInputRemoveMCEControl()}b(window).off("beforeunload.pageBase");c.resetFuncBeforeHashChange();return},initReqSend:function(){return},_sendRequestAjax:function(c,e,i,j){var d=this;var g;var f;var h;if(!d.setConnecting(true)){return false}if(!d.setNotChangeHash(true)){return false}if(!neo.isSet(e)){e=desknets.ajax.RESTYPE_JSON}if(c==desknets.ajax.REQTYPE_SINGLE){if(!neo.isSet(i)){i=d.getSingleRequest()}if(!neo.isSet(i.cmd)){d.setConnecting(false);d.setNotChangeHash(false);return false}h=i}else{if(!neo.isSet(i)){i=d.getMultiRequest()}if(!neo.isSet(i)||!neo.isSet(i["0"])){d.setConnecting(false);d.setNotChangeHash(false);return false}h=desknets.ajax.arrayToMultiCmdData(i)}g=d._getRestModule();f=desknets.getUrl(g);desknets.ajax.rest({dataType:e,url:f,data:h,success:function(l,k,m){if(neo.isSet(j)&&b.isFunction(j.success)){j.success(l)}else{d.onSuccess(l)}},complete:function(m,k,l){d.setNotChangeHash(false);if(neo.isSet(j)&&b.isFunction(j.complete)){j.complete(m,k,l)}d._onComplete()},error:function(l,k,m){if(neo.isSet(j)&&b.isFunction(j.error)){j.error(l,k,m)}else{desknets.ajax.onError(l.status,m)}}});return true},onSuccess:function(c){},_onComplete:function(){var c=this;c.setConnecting(false)},_initFormRequestAjax:function(e,i){var c=this;var d={};var h=null;var g=b(e);h=i.error;delete i.error;var f=i.success;delete i.success;d={beforeSubmit:function(j,k,l){if(b.isFunction(l.validation)){if(!l.validation(k)){return false}}if(!c.setConnecting(true)){return false}c._onBeforeSubmit(g)},error:function(l,j,k){if(b.isFunction(h)){h(l,j,k)}else{desknets.ajax.onError(l.status,k)}c.onErrorForm(g)},success:function(k,j,l){if(c.boautosave===true){desknets.autosave.stop();desknets.autosave.del()}if(b.isFunction(f)){f(k,j,l)}else{c.onSuccessForm(k,i);c._setLocationHashForm()}},complete:function(l,j,k){c._onCompleteForm()}};if(neo.isSet(i)){b.extend(d,i)}desknets.ajax.submitForm(g,d)},onSuccessForm:function(c,d){if(b.isFunction(d.success)){d.success(c)}},onErrorForm:function(d){var c=this;desknets.submitform.clearDisabled(d);c._initBeforeUnload()},_onBeforeSubmit:function(c){desknets.submitform.setDisabled(c);b(window).off("beforeunload.pageBase");this.resetFuncBeforeHashChange()},_setLocationHashForm:function(){var c=this;var d=c.getLocationFormParam();if(neo.isSet(d)){c._setLocationHash(d)}},getLocationFormParam:function(){return null},_onCompleteForm:function(){var c=this;c._onComplete()},checkInput:function(d){var c=this;var e=null;d.find(".jco-validation-number").each(function(){if(desknets.validation.isMinus(b(this).val())){var f={};f.msg=desknets.Resource.Message.com_minus_data;f.fieldid=b(this).attr("name");f.fieldname=c._getErrorPlace(f.fieldid);e=desknets.getErrConvMsg(f);return false}if(!desknets.validation.isNumber(b(this).val())){var f={};f.msg=desknets.Resource.Message.com_invalid_number;f.fieldid=b(this).attr("name");f.fieldname=c._getErrorPlace(f.fieldid);e=desknets.getErrConvMsg(f);return false}});return e},_initFormErrorEvent:function(){var d=this;var c=b(d._mIdPageForm);c.bind("invalid",function(f){var g=b(f.target);var e=g.attr("name")||g.data("name");desknets.validation.showError(g,d._getErrorPlace(e));d.onErrorForm(b(this));d._onCompleteForm()})},setConnecting:function(d){var c=this;if(d&&c.isConnecting()){return false}c.boConnecting=d;return true},isConnecting:function(){return this.boConnecting},setNotChangeHash:function(c){return desknets.paramanalyzer.setNotChangeHash(c)},_setLocationHash:function(e,f){var d=this;var c;if(neo.isSet(f)&&f){c=b(window).data("hashobserver");if(c){c.stopObserveHash()}desknets.paramanalyzer.setLocationHash(e);if(c){setTimeout(function(){c.startObserveHash()},100)}}else{desknets.paramanalyzer.setLocationHash(e)}return true},_setTitle:function(d,c){if(neo.isSet(c)){jQuery.each(c,function(f,e){d=desknets.tmpl.replaceWordChk(d,f,e)})}b("#jco-m-sub-title").html(d)},_getAreaTitle:function(c){return c.find(".jco-title").val()},_setTopMessage:function(c){var d=c.find(".jco-topmsgid").val();if(d){desknets.pageframe.viewTopMsgFromID(d)}},_getTitle:function(){return b(".jco-title").val()},_getModule:function(){return desknets.msModuleName},_getRestModule:function(){return desknets.MODULE_API_MAIN},getMultiRequest:function(){return null},getSingleRequest:function(){return null},_getResDataList:function(d){console.error("PageBase::_getResDataList()は使用しないでください。");if(b.isArray(d)){return d}else{var c=[];c[0]=d;return c}},_onBeforeUnload:function(c){this._setBaseHashCmdFlagInit()},_getBeforeUnloadMsg:function(){return null},_getBeforeUnloadExec:function(){return true},_formObserveSave:function(f,e){var d=this;var c=d._formObserve_getTargetNames();d._formObserve_save(f,e,c)},_formObserve_save:function(e,i,c){var d=this;var f;var j=i;var g=e;if(g.is("form")){g.find(":input").each(function(){d._formObserve_save(b(this),j,c)})}else{if(g.is(":input")){var f=g.attr("name");if(c.length>0&&b.inArray(f,c)==-1){f=""}if(neo.isSet(f)&&f!=""&&f!="cmd"){var h=d._formObserve_ifVal(g);if(!neo.isSet(h)){return}if(neo.isSet(j[f])){if(j[f] instanceof Array){j[f].push(h)}else{j[f]=[j[f],h]}}else{j[f]=h}}}}},_formObserveisChanged:function(){return false},_formObserve_isChanged:function(p){var o=this;var n,k;var c;var d;var h=false;var e={};var l=o._defFormVals;p.find(".cke").each(function(){var i=b(this);var j=i.attr("id").substring(4);p.find("#"+j).val(CKEDITOR.instances[j].getData())});o._formObserveSave(p,e);if(o._formObserve_isChangedAttach(p)){return true}var g=0,f=0;var m="";for(m in e){g++}for(m in l){f++}if(g!=f){return true}b.each(e,function(j){if(!neo.isSet(j)){return false}if(!neo.isSet(l[j])){h=true;return false}if(neo.isSet(e[j])&&neo.isSet(l[j])){if(e[j] instanceof Array){if(l[j] instanceof Array){c=true;var q=e[j];var r=l[j];if(q.length!=r.length){h=true;return false}b.each(q,function(s,t){if(b.inArray(t,r)==-1){c=false;return false}});if(!c){h=true;return false}}else{h=true;return false}}else{if(e[j]!=l[j]){h=true;return false}}}});return h},_formObserve_isChangedAttach:function(e){var c=this;var d=e.find("."+desknets._CLSNAME_MODFILES);if(d.length){return true}},_formObserve_ifVal:function(c){var d;if(c.is(":radio,:checkbox")){d=c.attr("checked");if(neo.isSet(d)&&d=="checked"){d=c.val()}}else{if(c.is(":input")){d=c.val()}}return d},_formObserve_getTargetNames:function(){return[]},_initPageEnterKeysSubmitFormCancel:function(){var c=this;b(c._mIdPageForm).keypress(function(f){var g=13;var h=f.keyCode;var e=f.target.type;if(h==g&&e!="button"&&e!="submit"&&e!="textarea"){f.preventDefault()}});var d=function(h){var f=8;var i=(h.keyCode!=0)?h.keyCode:h.charCode;var g=h.target.type,e=h.target.contentEditable==="true";if(i==f&&g!="text"&&g!="textarea"&&g!="password"&&!e&&(c._mIdPageForm=="#inputfrm"||c._mIdPageForm=="#frm")){h.preventDefault()}};if(desknets.browser.msie){b(c._mIdPageForm).keydown(d)}else{document.onkeydown=d}},_pageInputRemoveMCEControl:function(){var c=this;b("body").find('input[type="text"]:first').focus().blur();b("body").find("textarea").each(function(){var d=b(this);var e=d.attr("id");if(!!e&&typeof CKEDITOR=="object"&&!!CKEDITOR.instances[e]){CKEDITOR.instances[e].destroy()}})},funcBeforeHashChange:function(){var e=this;var g=e._getBeforeUnloadMsg();var f=desknets.Resource.Message.com_input_beforeentry_addmsg;var d;g=g+"<br />"+f;desknets.dialog.closeAll();if(e._formObserveisChanged()&&neo.isSet(g)){d=b(window).data("hashobserver");var h={cancel:function(){if(d){d.stopObserveHash()}desknets.paramanalyzer.setLocationHash(d.beforeChangePageHash);if(d){setTimeout(function(){d.startObserveHash()},100)}e._initBeforeUnload()}};var c=desknets.dialog.confirm(g,function(){if(e.boautosave===true){desknets.autosave.save("1","1")}b(".jco-page").find("."+desknets._CLSNAME_MODFILES).remove();e.resetFuncBeforeHashChange();b(window).trigger("hashchange")},h);e.$mobjConfirmDlg=c;return true}if(e.boautosave===true){desknets.autosave.stop()}return false},chkRteRead:function(){var c=this;var d=setInterval(function(){if(typeof CKEDITOR=="object"){if(b(".cke_button.cke_button__table.cke_button_disabled").length==0){c.setNotChangeHash(false);c.setConnecting(false);clearInterval(d)}}else{c.setNotChangeHash(false);c.setConnecting(false);clearInterval(d)}},500)},resetFuncBeforeHashChange:function(){var c=b(window).data("hashobserver");if(c){c.beforeHashChangeFunc=null}}})})(jQuery);(function(b){desknets.page(desknets,"PageListBase",desknets.PageBase,{mhashBackErrCmd:"",mhashIdErrBack:"",mhashBackCmd:"",mhashIdBack:"",mBackCmd:"",mIdBack:"jco-m-list-container",_mcListTemplate:null,_mobjParams:{},_mobjDefParams:{},_mchkIDs:[],$mjListPage:null,$mjTableList:null,boGetHtmlSingle:true,boErrBack:false,_allowInPageState:false,_listCheckState:"",mboSearchKeyErrorDisp:false,boChangePageNoHide:false,_mFldsChkScroll:null,init:function(){var c=this;c.callBase("init");c.initGetPageId();c._initSet()},initPage:function(e,d){var c=this;c.boErrBack=true;if(neo.isSet(e)){c.mBackCmd=e}if(neo.isSet(d)){c.mIdBack=d}c._initBeforeUnload();c.initGetPageId();c._initGetHtml()},_initGetHtml:function(){var c=this;var e={};var g={};var f={};var d={};if(c.boGetHtmlSingle){e.success=function(i){if(i[0]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(i[0]["errorno"],i[0]["errormessage"])}else{c._initHtml(i)}};f=c._getSearchExecParam();g=c._getSearchPageParam();g.cmd=f.cmd;d["0"]=g;c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,d,e)}else{var h=desknets.paramanalyzer.getHashParams();g=c._getSearchExecParam();g.cmd=c._getListExecCmd();f=c._getSearchPageParam();f.cmd=h.cmd;d["0"]=g;d["1"]=f;e.success=function(i){if(i[0]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(i[0]["errorno"],i[0]["errormessage"])}else{if(i[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(i[1]["errorno"],i[1]["errormessage"])}else{c._initMultiHtml(i)}}};c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,d,e)}},onError:function(d,f){var c=this;var g=desknets.dialog.alert(f,{errorNo:d});var h=desknets.parseErrorInfo(f,d);var e={close:function(i){desknets.dialog.deleteById(h.level);c.dispBackListPage()}};g.dialog(e)},_initHtml:function(d){var c=this;c.$mjListPage.empty();c.$mjListPage.html(d[0].html);c._initListStart();c._mobjParams=b.extend({},c.getListParamToObj());c._mobjDefParams=b.extend({},desknets.getInputDataToObj(c.$mjListPage.find(".jco-back-page-data")));c._hashUpdatePageParams();c.setNotChangeHash(false);c.setConnecting(false);c._getListAjax(c._getListRow());c._initListEnd()},_initMultiHtml:function(d){var c=this;c.$mjListPage.empty();c.$mjListPage.html(d[1].html);c._initListStart();c._mobjParams=b.extend({},c.getListParamToObj());c._mobjDefParams=b.extend({},desknets.getInputDataToObj(c.$mjListPage.find(".jco-back-page-data")));c._getListAjaxSuccess(d[0]);c._initListEnd()},getLocationFormParam:function(){var c=this;var d={};var e=desknets.paramanalyzer.getHashParams();if(neo.isSet(e.bproc)&&e.bproc!=""){desknets.execLocation(desknets.msUrl+desknets.decodeURIComponentNeo(e.bproc));return null}if(!neo.isSet(c.mBackCmd)||!neo.isSet(c.mIdBack)){return null}d=desknets.getInputDataToObj(b("#"+c.mIdBack).find(".jco-back-page-data"));d.cmd=c.mBackCmd;return d},dispBackListPage:function(){var c=this;var d=c.getLocationFormParam();if(neo.isSet(d)){c._setLocationHash(d)}},initGetPageId:function(){var d=this;var c;c="#"+d._getIdListPage();d.$mjListPage=b(c);c=d._getIdListPageForm();d._mIdPageForm="#"+c;d.mhashBackErrCmd=d.mhashBackCmd;d.mhashIdErrBack=d.mhashIdBack;d.mhashBackCmd=d._getListCmd();d.mhashIdBack=d._getIdListPage()},_initSet:function(){var c=this;c._initListStart();c._initListMain();c._initListEnd()},_initListStart:function(){var c=this;c._initListStartSet();c._initListStartTemplate();c._initListStartChk();c._initListStartModLink();c._initListSetSort()},_initListStartSet:function(){var d=this;d.$mjTableList=d.$mjListPage.find(".co-tbody-list");var e=d.$mjListPage.find(".co-table-list").find("thead").find("tr");for(var c=0;c<e.length;c++){desknets.htmlparts.addLastClass(b(e[c]),"last-child")}},_initListStartTemplate:function(){var c=this;c._mcListTemplate=c.$mjTableList.html();c.$mjTableList.empty()},_initListStartModLink:function(){var c=this;c.$mjTableList.dnclick(".jco-modlink",function(e){var d=b(this).parent().parent().find(".jco-id").val();c.inputDispPage(d)},function(e){var d=b(this).parent().parent().find(".jco-id").val();c.inputModPage(d)},{ignoreOnModifierKey:true})},_initListMain:function(){var d=this;var e="";var c=d._getListAjaxGetId();d._mobjParams=d.getListParamToObj();d._mobjDefParams=b.extend({},desknets.getInputDataToObj(d.$mjListPage.find(".jco-back-page-data")));e=desknets.paramanalyzer.getLocationHash();if(e!==""){d.funcHashObserver()}else{if((typeof jsonRest)!="undefined"){d._getListAjaxSuccess(jsonRest)}else{d._listPage("0")}}},_initListEnd:function(){var c=this;c._initListEndButton();c._initListEndChk();c._initPageEnterKeysSubmitFormCancel()},_initListEndButton:function(){var c=this;c.$mjListPage.find(".co-btn-update").click(function(d){d.preventDefault();b(this).addClass("on");desknets.scrollManager.clearScrollPosition(c._getListCmd());c._getListAjax(c._getListRow())});c.$mjListPage.find(".jco-list-add-page").click(function(d){c.inputAddPage(d)});c.$mjListPage.find(".jco-list-del-submit").click(function(d){c._listDelSubmit(d)})},_listDelSubmit:function(g){g.preventDefault();var c=this;var d=0;var e="";var f="";c.$mjTableList.find("input[type=checkbox]").each(function(){if(b(this).attr("checked")){d++;return false}});if(d<1){f=c._delNoChkMessage();desknets.dialog.alert(f,{type:"warn"});return}e=c._getDelCmd();if(e===""){f=c._delConfMessage();c._setDelConfirm(f);return}c._listDel(false,null);return},_setDelConfirm:function(e){var c=this;var d;d=desknets.dialog.confirm(e,function(){c._listDel(true,d);return false})},_listDel:function(i,h){var e=this;var d=[];if(h!=null){desknets.submitform.setDialogDisabled(h)}if(e.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){d=desknets.PRM_VAL_ALLDEL}else{e.$mjListPage.find('input[name="'+e._getIDName()+'"]:checked').each(function(){d[d.length]=b(this).val()})}if(i){var g={};var c={};c=e._getDelAddPrm();c[e._getIDName()]=d;c.cmd=e._getDelExecCmd();e._mchkIDs=e._getListAjaxGetId();if(e._boDelSingle()){desknets.ajax.rest({url:desknets.getUrl(e._getRestModule()),data:c,success:function(k,j,l){e._getListAjax(e._getListRow())},complete:function(l,j,k){if(h!=null){desknets.submitform.clearDialogDisabled(h);h.dialog("close")}},traditional:true})}else{e._listDelMulti(d,h)}}else{var f={};f=e._getDelAddPrm();f[e._getIDName()]=d;f.cmd=e._getDelCmd();desknets.ajax.rest({url:desknets.getUrl(e._getRestModule()),data:f,id:"desknets-page",success:function(k,j,l){e._setDelConfirm(k.message)},complete:function(l,j,k){if(h!=null){desknets.submitform.clearDialogDisabled(h);h.dialog("close")}},traditional:true})}return},_listDelMulti:function(e,h){var d=this;var g={};var f={};var c={};c=d._getDelAddPrm();c[d._getIDName()]=e;c.cmd=d._getDelExecCmd();d._mchkIDs=d._getListAjaxGetId();g=d.getListParamToObj();f=b.extend({url:desknets.getUrl(d._getRestModule()),data:desknets.ajax.arrayToMultiCmdData([c,g])},d._getListAjaxOptionsExec(h));desknets.ajax.rest(f)},_boDelSingle:function(){var c=this;var d=desknets.paramanalyzer.getHashParams();if(neo.isSet(d.srch_key)&&d.srch_key.length>0){return true}return false},_getListAjaxOptionsExec:function(e){var c=this;var d={};d={success:function(g,f,h){c._getListAjaxSuccessExec(g)},complete:function(h,f,g){if(e!=null){desknets.submitform.clearDialogDisabled(e);e.dialog("close")}}};return d},_getListAjaxSuccessExec:function(d){var c=this;if(d[0]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(d[0]["errorno"],d[0]["errormessage"])}else{c._getListAjaxSuccess(d[1])}},_initListSetSort:function(){var c=this;c.$mjListPage.find(".co-btnarea").find(".co-list-sort-data").click(function(f){f.preventDefault();var e="";var d=b(this);if(d.hasClass("asc")){e=-1}else{if(d.hasClass("desc")){e=1}else{if(d.data("def")=="desc"){e=-1}else{e=1}}}c._listPageSort(d.data("sort"),e)})},_listPageSort:function(d,e){var c=this;c.$mjListPage.find('input[name="fldsort"]').val(d);c.$mjListPage.find(".jco-back-page-data").find('input[name="order"]').val(e);c.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val("0");c._listPage("0")},_listSortLink:function(){var d=this;var e={};var c=null;e=b.extend({},d._mobjParams,desknets.paramanalyzer.getHashParams());var f=d.$mjListPage.find(".co-list-sort-item").find(".co-list-sort-data");f.removeClass("asc");f.removeClass("desc");f.each(function(){c=b(this);if(c.data("sort")==e.fldsort){if(e.order=="1"){c.addClass("asc")}else{c.addClass("desc")}return false}});f=d.$mjListPage.find(".co-table-list").find(".co-list-sort-data");f.removeClass("asc");f.removeClass("desc");f.each(function(){c=b(this);if(c.data("sort")==e.fldsort){if(e.order=="1"){c.addClass("asc")}else{c.addClass("desc")}return false}})},_listPage:function(d){var c=this;c.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val(d);var e=desknets.getInputDataToUrl(c.$mjListPage.find(".jco-back-page-data"));e=e+"&cmd="+c._getListCmd();c._setLocationHash(e)},_getListAjax:function(e){var c=this;var f={};var d={};f=c.getListParamToObj();f.row=e;c._mchkIDs=c._getListAjaxGetId();d=c._getListAjaxOptions();c._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,f,d)},_getListAjaxOptions:function(){var c=this;var d={};d={success:function(f,e,g){c._getListAjaxSuccess(f)}};if(c.boErrBack){d.error=function(f,e,g){c.onError(f.status,g)}}return d},_getListAjaxGetId:function(){return[]},_getListAjaxSuccess:function(h){var k=this;var g=this._getListAjaxSuccessData(h);var j=[];var c=[];var f=0;var i=0;var e=k._mcListTemplate;var d="";if(g.length<=0){k.$mjListPage.find(".co-table-list").hide();k.$mjListPage.find(".co-list-sort").hide();k.$mjTableList.empty();k.$mjListPage.find(".co-nodata").show();d="0"}else{k.$mjListPage.find(".co-table-list").show();k.$mjListPage.find(".co-list-sort").show();k.$mjListPage.find(".co-nodata").hide();f=g.length;for(i=0;i<f;i++){j=g[i];c[c.length]=k._listLine(e,j)}c[c.length]=k._listLineEnd();k.$mjTableList.empty();k.$mjTableList.html(c.join(""));k._setListStyle(h);d=h.row}k.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val(d);k.$mjListPage.find(".jco-pv-cnt").val(i);k.$mjListPage.find(".jco-pv-all-cnt").val(h.allcnt);k._getListAjaxSuccessOtherSet(h);k._getListAjaxSuccessEnd()},_setListStyle:function(d){var c=this;desknets.htmlparts.addStripeClass(c.$mjTableList,"co-tr-even")},_getListAjaxSuccessOtherSet:function(d){var c=this;if(!c.boChangePageNoHide){var e=c.$mjListPage.find(".co-list-search-text");if(e.is(":focus")){e.blur()}}},_listLine:function(e,f){var d=this;var c="";e=d._listLineCmd(e);if(typeof f=="object"){for(c in f){e=d._replaceListLine(e,c,f)}}return e},_listLineCmd:function(c){return desknets.tmpl.replaceWord(c,"cmd",this._getListDispCmd())},_listLineEnd:function(){return""},_replaceListLine:function(c,e,d){return desknets.tmpl.replaceWord(c,e,d[e])},_getListAjaxSuccessEnd:function(){var d=this;var e={};var c=null;d._listMoveScroll();d._listPageLink();d._listSortLink();d._listAllChkClear();d._listAllChkDataCnt();d._setTitle(d._getAreaTitle(d.$mjListPage));d.changPage();d.$mjListPage.find(".co-btn-update").removeClass("on");d._hashUpdatePageParams();d._mchkIDs=[]},changPage:function(){var c=this;if(!c.boChangePageNoHide||c.$mjListPage.css("display")!="block"){b(".jco-page").hide();b(".jco-page").find("."+desknets._CLSNAME_MODFILES).remove()}c.boChangePageNoHide=false;c.$mjListPage.show()},_listMoveScroll:function(){var d=this._getListCmd();var c=desknets.scrollManager.$scrollRoot;desknets.scrollManager.setScrollPosition(d,c,{y:0,delay:10})},_listPageLink:function(){var d=this;var c=d._listPageLinkOption();desknets.Pager.output(d._mIdPageForm,".jco-pager",c)},_listPageLinkOption:function(){var d=this;var e=d.$mjListPage.find(".jco-pv-cnt").val();var f=d.$mjListPage.find(".jco-pv-all-cnt").val();var h=d.$mjListPage.find(".jco-back-page-data").find('input[name="num"]').val();var g=d._getListRow();var c={};c={getCount:e,allCount:f,pageMaxView:h,startRow:g,clickFunc:function(i){d._listPageLinkAjax(i)}};return c},_listPageLinkAjax:function(d){var c=this;c._listPage(d)},inputAddPage:function(d){var c=this;var f="";var e={};d.preventDefault();f=c._getListAddCmd();e=c._getAddPageParam();e.cmd=f;c._inputPage(e)},inputModPage:function(f){var c=this;var e="";var d={};e=c._getListModCmd();d=c._getModPageParam();d.cmd=e;d[c._getIDName()]=f;c._inputPage(d)},inputDispPage:function(f){var c=this;var e="";var d={};e=c._getListDispCmd();d=c._getDispPageParam();d.cmd=e;d[c._getIDName()]=f;c._inputPage(d)},_inputPage:function(e){var c=this;var d={};c._setLocationHash(e)},_getDelAddPrm:function(){return{}},_getListCheckCount:function(){var c=this;return c.$mjTableList.find("input[type=checkbox]:checked").length},_delNoChkMessage:function(){return desknets.Resource.Message.com_del_nochecked},_delConfMessage:function(){var d=this;var c="";if(d.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.com_del_allconf}else{if(d.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){c=desknets.Resource.Message.com_del_someconf}else{c=desknets.Resource.Message.com_del_listconf}}return desknets.tmpl.replaceWordHtml(c,"count",d._getListCheckCount())},_getSearchPageParam:function(){if(!this.boGetHtmlSingle){return desknets.paramanalyzer.getHashParams()}return{}},_getSearchExecParam:function(){return desknets.paramanalyzer.getHashParams()},_getAddPageParam:function(){return{}},_getModPageParam:function(){return{}},_getDispPageParam:function(){return{}},initParamsFromHash:function(d){var c=this;var e="";e=d.cmd;c.callBase("initParamsFromHash",d);if(!neo.isSet(e)||e==c._getListCmd()){c._hashUpdateListPage(d)}else{if(e==c._getListAddCmd()){c._hashUpdateAddPage()}else{if(e==c._getListModCmd()){c._hashUpdateModPage()}else{if(e==c._getListDispCmd()){c._hashUpdateDispPage()}else{c._hashUpdatePageView(e)}}}}},_hashUpdateListPage:function(d){var c=this;c._initBeforeUnload();if(!neo.isSet(d.cmd)){b.extend(c._mobjParams,c._mobjDefParams);c._hashUpdatePageParams()}c._getListAjax(d.row);c.mhashBackErrCmd=c.mhashBackCmd;c.mhashIdErrBack=c.mhashIdBack;c.mhashBackCmd=c._getListCmd();c.mhashIdBack=c._getIdListPage()},_hashUpdateAddPage:function(){var d=this;var e;var c;e=d._getListEntryClass();if(neo.isSet(e)){e.initPage(d.mhashBackCmd,d.mhashIdBack)}},_hashUpdateModPage:function(){var d=this;var c;var e;c=d._getListModClass();if(neo.isSet(c)){c.initPage(d.mhashBackCmd,d.mhashIdBack)}},_hashUpdateDispPage:function(){var d=this;var c;var e;c=d._getListDispClass();if(neo.isSet(c)){c.initPage(d.mhashBackCmd,d.mhashIdBack)}},_hashUpdatePageView:function(c){},_hashUpdatePageParams:function(){var l=this;var g=b.extend({},l._mobjParams);var f=desknets.paramanalyzer.getHashParams();b.extend(g,f);var c=l.$mjListPage.find(".jco-back-page-data");for(var k in g){var d=k;var j=g[k];if(j!==""){var i="";if(b.isArray(j)){j=j[0]}try{i=desknets.decodeURIComponentNeo(j)}catch(h){i=j}i=desknets.escape(i);c.find('input[name="'+d+'"]').val(i)}else{c.find('input[name="'+d+'"]').val("")}}},_getListCmd:function(){return""},_getListExecCmd:function(){return""},_getListAddCmd:function(){return""},_getListModCmd:function(){return""},_getDelCmd:function(){return""},_getDelExecCmd:function(){return""},_getListDispCmd:function(){return""},_getIdListPage:function(){return"jco-m-list-container"},_getIdListPageForm:function(){return"listfrm"},_getListRow:function(){var c=this;return c.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val()},_getListEntryClass:function(){return null},_getListModClass:function(){return null},_getListDispClass:function(){return null},getListParamToObj:function(){var c=this;var e={};var d="";d=c._getListExecCmd();e=desknets.getInputDataToObj(c.$mjListPage.find(".jco-back-page-data"));b.extend(e,desknets.paramanalyzer.getHashParams());e.cmd=d;return e},_getListAjaxSuccessData:function(c){return desknets.ajax.getJsonItems(c)},_getIDName:function(){return"id"},_initListStartChk:function(){var c=this;c.$mjTableList.delegate("input[type=checkbox]","click",function(d){c.$mjListPage.find(".jco-checkbox-all").attr("checked",false);c._updateListCheckState("");if(b(this).attr("checked")){b(this).parent().parent().addClass("co-tr-selected")}else{b(this).parent().parent().removeClass("co-tr-selected")}})},_initListEndChk:function(){var c=this;c.$mjListPage.find(".co-table-list").find("thead").delegate(".jco-checkbox-all","click",function(e){var d=(b(this).attr("checked"))?true:false;c.$mjTableList.find("input[type=checkbox]").attr("checked",d);if(d){c.$mjTableList.find("tr").addClass("co-tr-selected")}else{c.$mjTableList.find("tr").removeClass("co-tr-selected")}if(c.$mjListPage.find(".jco-sort-change").css("display")!="block"){c._updateListCheckState(d?"inPage":"")}});c.$mjListPage.find(".co-chk-cnt-some").find("a").click(function(d){d.preventDefault();c._updateListCheckState("all")});c.$mjListPage.find(".co-chk-cnt-all").find("a").click(function(d){d.preventDefault();c._updateListCheckState("");c.$mjTableList.find("input[type=checkbox]").attr("checked",false).end().find("tr").removeClass("co-tr-selected")})},_listAllChkClear:function(){this._updateListCheckState("")},_listAllChkDataCnt:function(){var c=this;var e=Number(c.$mjListPage.find(".jco-pv-cnt").val());var f=Number(c.$mjListPage.find(".jco-pv-all-cnt").val());var d=desknets.Resource.Message.com_listchk_cnt_some_disp;d=desknets.tmpl.replaceWordLF(d,"num"," "+e+" ");c.$mjListPage.find(".jco-span-chk-msg-page").html(d);d=desknets.Resource.Message.com_listchk_cnt_all_link;d=desknets.tmpl.replaceWordLF(d,"num",f+" ");c.$mjListPage.find(".jco-span-chk-msg-all-link").html(d);d=desknets.Resource.Message.com_listchk_cnt_all_disp;d=desknets.tmpl.replaceWordLF(d,"num",f+" ");c.$mjListPage.find(".jco-span-chk-msg-all").html(d);this._allowInPageState=f>e},_updateListCheckState:function(d){var e=this.$mjListPage.find(".co-chk-cnt-some");var f=this.$mjListPage.find(".co-chk-cnt-all");var c=this.$mjListPage.find(".jco-checkbox-all");if(d=="inPage"&&!this._allowInPageState){d="all"}if(d=="all"){e.hide();f.show();c.prop("checked",true)}else{if(d=="inPage"){e.show();f.hide();c.prop("checked",true)}else{e.hide();f.hide();c.prop("checked",false)}}this._listCheckState=d},chkListSearchKeyLength:function(d){var e=this;var c=true;if(neo.isSet(d,{blank:false})&&d.length>desknets.SRCHKEY_MAXLENGTH){c=false}if(!c){if(!e.mboSearchKeyErrorDisp){e.mboSearchKeyErrorDisp=true;var f=desknets.Resource.Message.com_search_keyword_toolarge;desknets.dialog.alert(f,{type:"warn",close:function(g){e.mboSearchKeyErrorDisp=false}})}}return c},_getFieldsCheckScroll:function(){return[]},_setClearScrollPosition:function(){var c=this;var f;var g={};var d=false;var h=c._getFieldsCheckScroll();var e=desknets.paramanalyzer.getHashParams();for(f=0;f<h.length;f++){if(c._mFldsChkScroll!=null&&c._mFldsChkScroll[h[f]]!=e[h[f]]){d=true}g[h[f]]=e[h[f]]}c._mFldsChkScroll=g;if(d){desknets.scrollManager._targets[c._getListCmd()]=null}}})})(jQuery);(function(b){desknets.page(desknets,"PageInputBase",desknets.PageBase,{mBackCmd:"",mIdBack:"jco-m-list-container",$mjPage:null,seltmpl:'<span class="co-selitem"><span title="{{nametitle}}" class="co-selitem-text">{{name}}</span><a title="'+desknets.Resource.deselectLabel+'" class="co-btn co-btn-close co-selitem-close" href="#">x</a><input type="hidden" value="{{id}}" name="{{fld}}"></span>',_mautosavestartok:true,init:function(){var c=this;c.callBase("init");c.initGetPageId();c._initSet()},initPage:function(g,f){var d=this;if(neo.isSet(g)){d.mBackCmd=g}if(neo.isSet(f)){d.mIdBack=f}d.initGetPageId();d._initGetHtml();var e=function(){return d.funcBeforeHashChange()};var c=b(window).data("hashobserver");if(c){c.beforeHashChangeFunc=e}},initGetPageId:function(){var c=this;c.$mjPage=b("#"+c._getIdPage());c._mIdPageForm="#"+c._getIdPageForm()},_initGetHtml:function(){var c=this;var d={};d.success=function(e){if(e[0]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(e[0]["errorno"],e[0]["errormessage"])}else{c._initHtml(e)}};d.complete=function(g,e,f){c.CompleteExec()};c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,null,d)},getMultiRequest:function(){var c=this;var e={};var d={};e=desknets.paramanalyzer.getHashParams();d["0"]=e;return d},onError:function(d,f){var c=this;c.resetFuncBeforeHashChange();var g=desknets.dialog.alert(f,{errorNo:d});var h=desknets.parseErrorInfo(f,d);var e={close:function(i){desknets.dialog.deleteById(h.level);c.dispBackListPage()}};g.dialog(e)},_initHtml:function(d){var c=this;c.$mjPage.empty();c.$mjPage.html(d[0].html);c.AutoSaveSetup();c._initSet(d)},_initSet:function(d){var c=this;c._initBeforeUnload();c._setTitle(c._getAreaTitle(c.$mjPage));c._setTopMessage(c.$mjPage);desknets.moveScroll();c.chgDateFormat();c.changPage();c._inputAjaxForm();c._inputFormSaveToObserver();c._initPageEnterKeysSubmitFormCancel();c._inputButton();this._initConnectData()},chgDateFormat:function(){var c=this;c.$mjPage.find(".jco-input-chgdate").each(function(){var d=b(this);d.text(desknets.dateTime.dispDateTime(d.text()))})},changPage:function(){var c=this;b(".jco-page").hide();c.$mjPage.show()},_inputAjaxForm:function(){var c=this;var d={};d=c._inputAjaxFormOption();c._initFormRequestAjax(c._mIdPageForm,d);c._initFormErrorEvent()},_inputAjaxFormOption:function(){var c=this;var d={errorconvmsg:function(e,f){var g=desknets.getErrField(e,f);g.fieldname=c._getErrorPlace(g.fieldid);return desknets.getErrConvMsg(g)},validation:function(e){var f=c.checkInput(e);if(neo.isSet(f,{blank:false})){desknets.dialog.alert(f);return false}return true}};return d},_inputFormSaveToObserver:function(){var c=this;var d=c._getIdPageForm();if(d!=""){c._defFormVals={};var e=b("#"+d);c._formObserveSave(e,c._defFormVals)}if(c.boautosave===true&&desknets.autosave.mtimer!==null){desknets.autosave.start()}},_getErrorPlace:function(c){var d=this;if(c!==""){return desknets.getErrFieName(d.$mjPage,c)}return""},_inputButton:function(){var c=this;c.$mjPage.find(".jco-input-list-page").click(function(d){d.preventDefault();c.dispBackListPage()});c.$mjPage.find(".jco-input-add-submit").click(function(d){c._inputAddSubmit(d)});c.$mjPage.find(".jco-input-mod-submit").click(function(d){c._inputModSubmit(d)});c.$mjPage.find(".jco-input-del-submit").click(function(d){c._inputDelSubmit(null)});c.$mjPage.find(".jco-input-del-submit-conf").click(function(d){c._inputDelConfSubmit()})},_setLocationHashForm:function(){var c=this;var d=desknets.paramanalyzer.getHashParams();if(neo.isSet(d.bproc)&&d.bproc!=""){desknets.execLocation(desknets.msUrl+desknets.decodeURIComponentNeo(d.bproc))}else{c.callBase("_setLocationHashForm")}},getLocationFormParam:function(){var c=this;var d={};if(!neo.isSet(c.mBackCmd)||!neo.isSet(c.mIdBack)){return null}d=desknets.getInputDataToObj(b("#"+c.mIdBack).find(".jco-back-page-data"));d.cmd=c.mBackCmd;return d},dispBackListPage:function(){var c=this;var e=desknets.paramanalyzer.getHashParams();if(neo.isSet(e.bproc)&&e.bproc!=""){desknets.execLocation(desknets.msUrl+desknets.decodeURIComponentNeo(e.bproc))}else{var d=c.getLocationFormParam();if(neo.isSet(d)){c._setLocationHash(d)}}},_inputAddSubmit:function(){var c=this;var d="";d=c._getAddExecCmd();c.$mjPage.find('input[name="cmd"]').val(d)},_inputModSubmit:function(){var c=this;var d="";d=c._getModExecCmd();c.$mjPage.find('input[name="cmd"]').val(d)},_inputDelSubmit:function(e){var c=this;var d={};var f=desknets.paramanalyzer.getHashParams();if(e!=null){desknets.submitform.setDialogDisabled(e)}d=c._getDelPrm();d.cmd=c._getDelExecCmd();d[c._getIDName()]=f[c._getIDName()];desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,success:function(h,g,i){b(window).off("beforeunload.pageBase");c.resetFuncBeforeHashChange();if(c.boautosave===true){desknets.autosave.stop()}c.dispBackListPage()},complete:function(i,g,h){if(e!=null){desknets.submitform.clearDialogDisabled(e);e.dialog("close")}}})},_inputDelConfSubmit:function(i){var c=this;var f=null;var e=c._getDelCmd();if(e===""){var h=c._delConfMessage();f=desknets.dialog.confirm(h,function(){c._inputDelSubmit(f);return false})}else{var d={};var g=desknets.paramanalyzer.getHashParams();d=c._getDelPrm();d.cmd=c._getDelCmd();d[c._getIDName()]=g[c._getIDName()];desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,error:function(l,j,k){c._inputDelConfAjaxError(l,j,k)},success:function(k,j,l){c._inputDelConfAjaxSuccess(k,j,l)}})}},_inputDelConfAjaxSuccess:function(e,c,f){var d=this;var g=d._delConfMessage();$dialog=desknets.dialog.confirm(g,function(){d._inputDelSubmit($dialog);return false})},_inputDelConfAjaxError:function(e,c,d){desknets.ajax.onError(e.status,d)},_getDelPrm:function(){return{}},_getIdPage:function(){return"jco-m-input-page"},_getIdPageForm:function(){return"inputfrm"},_delConfMessage:function(){return desknets.Resource.Message.com_del_conf},_getAddExecCmd:function(){return""},_getModExecCmd:function(){return""},_getDelCmd:function(){return""},_getDelExecCmd:function(){return""},_getIDName:function(){return"id"},_getBeforeUnloadMsg:function(){var c=this;if(c.boautosave===true){return desknets.Resource.Message.com_input_beforeentry_autosave_msg}return desknets.Resource.Message.com_input_beforeentry_msg},_formObserveisChanged:function(){var c=this;var d=c._getIdPageForm();if(!neo.isSet(d)){return false}var e=b("#"+d);if(c._formObserve_isChanged(e)){return true}return false},onErrorForm:function(f){var d=this;var e=function(){return d.funcBeforeHashChange()};var c=b(window).data("hashobserver");if(c){c.beforeHashChangeFunc=e}d.callBase("onErrorForm",f)},AutoSaveSetup:function(){var c=this;c.boautosave=false;var d=c.$mjPage.find(".jco-autosave");if(d.length>0){if(d.data("time")>0){c.boautosave=true}}if(c.boautosave===true){desknets.autosave.init(c.AutoSaveOpt(d))}},AutoSaveOpt:function(g){var f=this;var d={};var i=desknets.paramanalyzer.getHashParams();d.module="";d.time=g.data("time");d.userid=g.val();d.fieldid="id";d.attachname="";d.rtename="";d.format="";var j=function(k){f.AutoSaveChk(k)};d.funcchk=j;var e=function(){f.AutoSaveErrChk()};d.funcerrchk=e;var h=function(k){return f.AutoSaveEntry(k)};d.funcentry=h;var c=function(l,k){f.AutoSaveGet(l,k)};d.funcget=c;if(!!i[f._getIDName()]){d.mod=true}else{d.mod=false}return d},CompleteExec:function(){var c=this;if(c.boautosave===true){c.setNotChangeHash(true);desknets.autosave.chk()}else{if(c.borte){c.setNotChangeHash(true);c.chkRteRead()}}},AutoSaveErrChk:function(){var c=this;if(c.borte){c.chkRteRead()}else{c.setNotChangeHash(false);c.setConnecting(false)}},AutoSaveChk:function(e){var c=this;if(!e.id){desknets.autosave.start()}else{var d={cancel:function(){desknets.autosave.del();desknets.autosave.start()}};c.AutoSaveChkConfirm(e,d)}if(c.borte){c.chkRteRead()}else{c.setNotChangeHash(false);c.setConnecting(false)}},AutoSaveDialogLock:function(e){var c=this;if(e!=null){desknets.submitform.setDialogDisabled(e);var d=setInterval(function(){if(c._mautosavestartok==true){desknets.submitform.clearDialogDisabled(e);clearInterval(d)}},500)}},AutoSaveChkConfirm:function(e,d){var c=this;if(e.id=="0"){return c.AutoSaveChkConfirmAdd(e,d)}else{return c.AutoSaveChkConfirmMod(e,d)}},AutoSaveChkConfirmAdd:function(f,d){var c=this;var e=desknets.paramanalyzer.getHashParams();return desknets.dialog.confirm(c.AutoSaveChkConfirmAddMsg(),function(g){desknets.autosave.get()},d)},AutoSaveChkConfirmAddMsg:function(){return desknets.Resource.Message.auto_save_msg},AutoSaveChkConfirmMod:function(f,d){var c=this;var e=desknets.paramanalyzer.getHashParams();if(e[c._getIDName()]==f.id){return desknets.dialog.confirm(c.AutoSaveChkConfirmModMsg(),function(g){desknets.autosave.get()},d)}else{desknets.autosave.del();desknets.autosave.start();return null}},AutoSaveChkConfirmModMsg:function(){return desknets.Resource.Message.auto_save_mod_msg},AutoSaveEntry:function(e){var d=this;var c=d.$mjPage.find("form").formToArrayEx();e=b.extend(c,e);return e},AutoSaveGet:function(d,e){var c=this;b.each(e,function(f,g){if(g=="cmdget"){c.AutoSaveGetData(d[f])}else{if(g=="cmdgetatt"){if(!!d[f]&&!!d[f].attach&&!!d[f].attach.item){if(!b.isArray(d[f].attach.item)){d[f].attach.item=[d[f].attach.item]}c.AutoSaveGetAttData(d[f].attach.item)}else{c.AutoSaveGetAttData([])}}else{if(g=="cmdgetrte"){if(!!d[f]&&!!d[f].attach&&!!d[f].attach.item){if(!b.isArray(d[f].attach.item)){d[f].attach.item=[d[f].attach.item]}c.AutoSaveGetRteData(d[f].attach.item)}else{c.AutoSaveGetRteData([])}}else{if(g=="cmdgetformat"){}}}}})},AutoSaveGetData:function(d){var c=this},AutoSaveGetAttData:function(d){var c=this},AutoSaveGetRteData:function(d){var c=this;desknets.rtfile.chooser.updatefilelist(d)},arrayToData:function(c){if(!c){c=[]}else{if(!b.isArray(c)){c=[c]}}return c},getSelTmplData:function(f,g,d){var c=this;var e="";if(!!g){if(!d){d=""}e=c.seltmpl;e=desknets.tmpl.replaceWordHtml(e,"fld",f);e=desknets.tmpl.replaceWordHtml(e,"id",g);e=desknets.tmpl.replaceWordHtml(e,"name",desknets.tmpl.dispStr(d));e=desknets.tmpl.replaceWordHtml(e,"nametitle",desknets.escapeValue(d))}return e},_initConnectData:function(){var d=this;var c;c=d._getConnectData();if(!c){return}d._setConnectData(c)},_getConnectData:function(){var d=this;var c=null;var h=desknets.paramanalyzer.getHashParams();if(h.link!=="1"){return null}if(window.opener&&window.opener.desknets&&window.opener.desknets.connectapp){c=window.opener.desknets.connectapp.getConnectData(d._getConnectToModuleName());if(desknets.browser.msie8||desknets.browser.msie9){if(!!c.rteatt&&!!c.rteatt.attach&&!!c.rteatt.attach.item){var f=[];var g;var e=c.rteatt.attach.item.length;for(g=0;g<e;g++){f.push(c.rteatt.attach.item[g])}c.rteatt.attach.item=f}}}return c},_getConnectToModuleName:function(){return""},_setConnectData:function(c){var d=this},})})(jQuery);(function(b){desknets.page(desknets,"PageDispBase",desknets.PageInputBase,{_getBeforeUnloadExec:function(){return false},_getIdPageForm:function(){return"dispfrm"},funcBeforeHashChange:function(){},chgDateFormat:function(){},getMultiRequest:function(){var c=this;var f={};var e={};var d={};f=c._getDispDataParam();d["0"]=f;e=c._getDispHtmlParam();d["1"]=e;return d},_getDispDataParam:function(){var c;c=desknets.paramanalyzer.getHashParams();c.cmd=this._getDispExecCmd();return c},_getDispHtmlParam:function(){return desknets.paramanalyzer.getHashParams()},_initHtml:function(d){var c=this;if(d[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[1]["errorno"],d[1]["errormessage"]);return}c._changeDispPage(d[1].html);c._initHtmlTmplSet(d);c._initSet(d)},_initHtmlTmplSet:function(d){var c=this;c.$mjPage.find(".jco-disp-tmplset").tmpl(d[0]).appendTo("#"+c._getIdPage()+" .jco-disp-disparea");c._convertHrefInText()},_convertHrefInText:function(){var c=this.$mjPage.find(".co-textarea-view");if(c.length>0){desknets.htmlparts.convertHrefInText(c)}},_changeDispPage:function(c){this.$mjPage.empty();this.$mjPage.html(c)},_inputAjaxForm:function(){},CompleteExec:function(){var c=this},_inputButton:function(){var c=this;c.$mjPage.find(".co-pageback").click(function(d){d.preventDefault();c.dispBackListPage()});c.$mjPage.find(".jco-pagemod").click(function(d){d.preventDefault();c.inputModPage()});c.$mjPage.find(".jco-input-del-submit").click(function(d){c._inputDelSubmit()});c.$mjPage.find(".jco-input-del-submit-conf").click(function(d){c._inputDelConfSubmit()})},inputModPage:function(){var c=this;var d={};d=desknets.paramanalyzer.getHashParams();d.cmd=c._getDispModCmd();c._setLocationHash(d)},_getIdPage:function(){return"jco-m-disp-page"},_getDispExecCmd:function(){return""},_getDispModCmd:function(){return""}})})(jQuery);(function(b){desknets.page(desknets,"PageMultiList",desknets.PageListBase,{mboNotMulti:false,_initListStart:function(){var c=this;c._initAddDataStart();c.callBase("_initListStart")},_getListAjax:function(e){var c=this;if(!c._boDelSingle()){var f={};var d={};c._hashUpdatePageParams();f=c._getListAjaxParams(e);c._mchkIDs=c._getListAjaxGetId();d=c._getListAjaxOptions();c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,f,d)}else{c.callBase("_getListAjax",e)}},_getListAjaxParams:function(e){var c=this;var f={};var d={};var g={};d=c.getListParamToObj();d.row=e;g=c.getAddDataParam();g.cmd=c._getAddDataGetCmd();f["0"]=d;f["1"]=g;return f},_getListAjaxSuccess:function(d){var c=this;if(typeof(d[0])=="object"){if(d[0]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[0]["errorno"],d[0]["errormessage"])}else{c.callBase("_getListAjaxSuccess",d[0])}c._getListAjaxSuccessAdd(d)}else{c.callBase("_getListAjaxSuccess",d);c._getListAjaxSuccessAddData()}},_getListAjaxSuccessAdd:function(d){var c=this;if(d[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[1]["errorno"],d[1]["errormessage"])}else{c._getAddDataAjaxSuccess(d[1])}},_getListAjaxSuccessAddData:function(){var c=this;if(!c._boDelSingle()&&(typeof jsonRestAddData)!="undefined"){c._getAddDataAjaxSuccess(jsonRestAddData)}else{c._getAddDataAjax()}},_getListAjaxSuccessExec:function(d){var c=this;if(d[0]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[0]["errorno"],d[0]["errormessage"])}else{var e=[];e=c._getListAjaxSuccessExecSplit(d);c._getListAjaxSuccess(e)}},_getListAjaxSuccessExecSplit:function(c){var d=[];d[0]=c[1];d[1]=c[2];return d},_listDelMulti:function(d,g){var c=this;var f={};var e={};c._mchkIDs=c._getListAjaxGetId();f=c._listDelMultiParams(d);e=c._getListAjaxOptionsExec(g);c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,f,e);return},_listDelMultiParams:function(e){var d=this;var g={};var f={};var h={};var c={};c=d._getDelAddPrm();c.id=e;c.cmd=d._getDelExecCmd();f=d.getListParamToObj();h=d.getAddDataParam();h.cmd=d._getAddDataGetCmd();g["0"]=c;g["1"]=f;g["2"]=h;return g},_getAddDataAjax:function(){var c=this;var e={};var d={};e=c.getAddDataParam();e.cmd=c._getAddDataGetCmd();d=c._getAddDataAjaxOptions();d.url=desknets.getUrl(c._getRestModule());d.data=e;desknets.ajax.rest(d)},_getAddDataAjaxOptions:function(){var c=this;var d={};d={success:function(f,e,g){c._getAddDataAjaxSuccess(f)}};return d},_initAddDataStart:function(){},_getAddDataAjaxSuccess:function(c){},_getAddDataGetCmd:function(){return""},getAddDataParam:function(){return{}},_listMoveScroll:function(){var d=this._getListCmd();var c=this.$mjListPage.find(".co-listview-scroll");desknets.scrollManager.setScrollPosition(d,c,{y:0,delay:10})}})})(jQuery);desknets.page(desknets,"PageSubwinSearch",desknets.PageBase,{$_viewArea:null,$_inputArea:null,init:function(){this._initSearch()},_initSearch:function(){var c=this;c.$_viewArea=c.getViewArea();c.$_inputArea=c.getInputArea();c.$_inputArea.find(".co-guide-searchbtn").click(function(d){d.preventDefault();c._execSearch()});c.$_inputArea.find(".co-btnclear").click(function(d){d.preventDefault();c._execClear()});if(desknets.browser.msie8){var b=13;a(".jco-srchtarget-select > option").text(function(d,e){if(e.length>b){return e.substr(0,b)+"..."}})}},_execClear:function(){var b=this;b.$_inputArea.find("input").not(".co-guide-searchbtn").val("");b.$_inputArea.find("input").not(".co-datepicker.ui-invalid-mismatch ui-invalid").removeClass("ui-invalid-mismatch ui-invalid")},_execSearch:function(){var b=this;if(!b._chkInputSearch()){return}this._onBeforeSeach();var c=b.$_viewArea;if(c.length>0){desknets.pageframe.closeSubWin();b._execInitSearch()}else{b._getSearchHtml()}},_chkInputSearch:function(){var b=this;b._setInputTrim();if(!b._chkInputSearchDateInvalid()){return false}if(!b._chkInputSearchRequired()){return false}if(!b._chkInputSearchDateChk()){return false}if(!b._chkInputSearchKeyLength()){return false}return true},_setInputTrim:function(){var b=this;var c=b.$_inputArea.find('input[type="text"]');c.each(function(f){var d=a(this);if(d.hasClass("co-datepicker")){return false}var e=a.trim(d.val());d.val(e)});return},_chkInputSearchRequired:function(){var c=this;var e=false;var b="";c.$_inputArea.find(".jco-search-required").each(function(){if(a(this).find("input:first").val()==""){e=true;b=a(this).find(".co-guide-label").text();return false}});if(e){var d=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",b);desknets.dialog.alert(d,{type:"warn"});return false}return true},_chkInputSearchDateInvalid:function(){var b=this;b.$_inputArea.formSetUp("validate");var c=b.$_inputArea.find(".ui-invalid").eq(0);if(c.length>0){desknets.validation.showError(c);return false}return true},_chkInputSearchDateChk:function(){var d=this;var c=true;var b="";d.$_inputArea.find(".jco-search-date").each(function(){b=a(this).find(".co-guide-label").text();if(!desknets.validation.isInputDateFromTo(a(this),b)){c=false;return false}});return c},_chkInputSearchKeyLength:function(){var c=this;var b=true;var e=c.$_inputArea.find('input[type="text"]');e.each(function(g){var f=a(this);if(f.hasClass("co-datepicker")){return false}var h=f.val();if(h.length>desknets.SRCHKEY_MAXLENGTH){b=false;return false}});if(!b){var d=desknets.Resource.Message.com_search_keyword_toolarge;desknets.dialog.alert(d,{type:"warn"});return false}return true},_onBeforeSeach:function(){desknets.scrollManager.clearScrollPosition(this._getSearchCmd())},_execInitSearch:function(){var b=this;var c={};c=b._getSearchPrm(c);c.cmd=b._getSearchCmd();c._=desknets.createRandomId();b._setLocationHash(c)},_getSearchHtml:function(){var b=this;var b=this;var c={};var d="";var e="";c=b._getSearchPrm(c);c.cmd=b._getSearchCmd();c._=desknets.createRandomId();e=desknets.getUrl(b._getModule());d=desknets.getNeoParam(c);e=e+"?cmd="+b._getMainCmd()+"#"+d;desknets.execLocation(e)},_getSearchPrm:function(b){b.fldsort="SEQNO";b.order="1";b.row="0";return b},_getMainCmd:function(){return""},_getSearchCmd:function(){return""},getViewArea:function(){return a("#jco-m-search-container")},getInputArea:function(){return a(".jco-subwindow-search")}});desknets.page(desknets,"PageLabelInput",desknets.PageInputBase,{_initSet:function(){var b=this;b._initSetLabel();b.callBase("_initSet")},_initSetLabel:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();var d="";if(!neo.isSet(b.id)){d=b.labelid}desknets.label.selectSet(c.$mjPage,d);c.$mjPage.find(".co-drop-down-button").data("position","bottom")},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.success=function(e,d,f){b._updateLabelListId(e);b._setLocationHashForm()};return c},_updateLabelListId:function(f){var b=this;var d=false;var g=a("#"+b.mIdBack).find(".jco-back-page-data");var c="";var e=g.find('input[name="labelid"]').val();if(neo.isSet(f.labelid)){c=f.labelid}if(e==""||e=="0"){d=false}else{if(e=="-1"&&c==""){d=false}else{if(c==""){d=true;g.find('input[name="labelid"]').val("-1")}else{d=true;g.find('input[name="labelid"]').val(c)}}}}});desknets.page(desknets,"PageLabelList",desknets.PageMultiList,{_TMPLDIALOG:"com/labeldialog.html",$mDialog:null,_selName:"",_tmplLabelTitle:'<span class="overflow">{{labelname}}</span>',_iLabelHeight:26,_mboAddPageLabelId:false,mboLabelScrollChg:true,sDefLabelHtml:"",_initListEnd:function(){var b=this;b._initLabelEnd();b.callBase("_initListEnd");a(window).resize(function(){if(desknets.browser.tablet&&a(".co-pop-up-box.show").length>0){return}b.updateListHeight()})},changPage:function(){var b=this;if(b.$mjListPage.css("display")!="block"){b.mboLabelScrollChg=true}else{b.mboLabelScrollChg=false;b.boChangePageNoHide=true}b.callBase("changPage");b.updateListHeight()},updateListHeight:function(){var b=this;desknets.listviewframe.updateListHeight(b.$mjListPage.find(".co-listview"),true,true)},_createFolderDialog:function(){var b=this;desknets.tmpl.load(b.$mjListPage.find(".co-pop-label"),b._TMPLDIALOG)},_initAddDataStart:function(){var b=this;b.sDefLabelHtml=b.$mjListPage.find(".co-listview-items").html();b._createFolderDialog();b._initLabelListBeforeLeft();b._initLabelListBeforeList()},_initLabelListBeforeLeft:function(){var b=this;var c=b.$mjListPage.find(".co-listview-items");c.delegate(".co-label","click",function(e){e.preventDefault();a(this).focus();var f=a(this).find(".jco-label-id").val();var d=c.find(".co-label-none.on").find(".jco-label-id").val();if(f!=d){c.find(".co-label-none.on").removeClass("on")}b.$mjListPage.find('input[name="labelid"]').val(f);b._listPage(0)})},_initLabelListBeforeList:function(){var b=this;var c=b.$mjListPage.find(".co-listview-list");c.delegate(".co-label","click",function(g){g.preventDefault();var d=a(this);var h=null;var f=d.closest("tr");var j=function(){f.removeClass("co-list-dropover")};var i={cancel:j};var e=function(){if(h!=null){desknets.submitform.setDialogDisabled(h)}var k={};var l={};k.cmd=b._getDataLabelDelCmd();k.assignid=f.find(".jco-id").val();k.id=f.find(".jco-label-id").val();l={success:function(n,m,o){b._modCountDelAssignLabel(d);d.remove();if(h!=null){desknets.submitform.clearDialogDisabled(h);h.dialog("close")}j()},error:function(o,m,n){if(h!=null){desknets.submitform.clearDialogDisabled(h)}desknets.ajax.onError(o.status,n)}};b._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,k,l);return false};f.addClass("co-list-dropover");h=desknets.dialog.confirm(desknets.Resource.Message.com_label_datadel,e,i)})},_initLabelEnd:function(){var b=this;desknets.listviewframe.setLeftTitleMenu(b.$mjListPage.find(".co-listview-left-title"));b.$mjListPage.find(".jco-label-add").click(function(c){c.preventDefault();b._dialogLabel(false)});b.$mjListPage.find(".jco-label-mod").click(function(c){c.preventDefault();b._dialogLabel(true)});b.$mjListPage.find(".jco-label-del").click(function(f){f.preventDefault();var c="";var e="";var d=null;var g=null;e=b.$mjListPage.find(".co-label.on").attr("title");c=desknets.tmpl.replaceWordChk(desknets.Resource.Message.com_label_del,"LabelName",e);d=function(){if(!b._boDelSingle()){if(g!=null){desknets.submitform.setDialogDisabled(g)}var j={};var i={};j=b._labelDelMultiParams();b._mchkIDs=b._getListAjaxGetId();i=b._getLabelAjaxOptionsExec(g);b._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,j,i);return false}else{if(g!=null){desknets.submitform.setDialogDisabled(g)}var h={};var j={};var i={};h=b._labelDelMultiParams();j=h["0"];b._mchkIDs=b._getListAjaxGetId();i=b._getLabelAjaxOptions(g);b._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,j,i);return false}};g=desknets.dialog.confirm(c,d)})},_labelDelMultiParams:function(){var c=this;var f={};var d={};var g={};var b={};var e=c.$mjListPage.find('input[name="labelid"]');b.cmd=c._getLabelDelCmd();b.id=e.val();d=c.getListParamToObj();d.labelid="";e.val("");g.cmd=c._getLabelGetCmd();f["0"]=b;f["1"]=d;f["2"]=g;return f},_getLabelAjaxOptionsExec:function(d){var b=this;var c={};c={success:function(g,e,h){b.$mjListPage.find('input[name="labelid"]').val("");b.setNotChangeHash(false);var f=desknets.getInputDataToUrl(b.$mjListPage.find(".jco-back-page-data"));f=f+"&cmd="+b._getListCmd();b._setLocationHash(f,true);b._getListAjaxSuccessExec(g)},complete:function(g,e,f){if(d!=null){desknets.submitform.clearDialogDisabled(d);d.dialog("close")}}};return c},_getLabelAjaxOptions:function(d){var b=this;var c={};c={success:function(f,e,g){b.$mjListPage.find('input[name="labelid"]').val("");b.setNotChangeHash(false);b._listPage(b._getListRow())},complete:function(g,e,f){if(d!=null){desknets.submitform.clearDialogDisabled(d);d.dialog("close")}}};return c},_dialogLabel:function(c){var b=this;var f=null;var e=null;f=b.$mDialog;if(f===null){f=b._makeDialogLabel();b.$mDialog=f}var d={};if(c){e=b.$mjListPage.find(".co-label.on");d.title=desknets.Resource.PageLabelList.menuLabelMod;f.find(".co-label-entry-name").val(e.attr("title"));f.find(".co-label-entry-id").val(e.find(".jco-label-id").val())}else{d.title=desknets.Resource.PageLabelList.menuLabelAdd;f.find(".co-label-entry-name").val("");f.find(".co-label-entry-id").val("")}f.dialog(d);f.dialog("open");desknets.dialog.setFirstDialogOpen(f)},_makeDialogLabel:function(){var c=this;var f=null;var e=null;var d=desknets.dialog.getDialogOption();var b="";d.width=400;d.buttons={};d.buttons[desknets.Resource.OKButtonLabel]=function(){if(f!=null){desknets.submitform.setDialogDisabled(f)}var g={};f=a(this);g.cmd=c._getLabelEntryCmd();g.id=f.find(".co-label-entry-id").val();g.name=f.find(".co-label-entry-name").val();desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:g,success:function(j,h,k){if(g.id!==""){e=c.$mjListPage.find(".co-label.on");e.attr("title",g.name);var i=desknets.tmpl.escapeWord(g.name);e.find(".jco-label-name").html(i);c.$mjListPage.find(".co-listview-list").find(".jco-label-id").each(function(){if(a(this).val()===g.id){a(this).next().html(i).attr("title",g.name)}});c._setTitleLabel()}else{c._setAppendLabel(g,j)}desknets.submitform.clearDialogDisabled(f);f.dialog("close")},error:function(j,h,i){desknets.submitform.clearDialogDisabled(f);c._labelEntryAjaxError(j,h,i)},errorconvmsg:function(h,i){var j=desknets.getErrField(h,i);j.fieldname=c._getErrorPlace(j.fieldid);return desknets.getErrConvMsg(j)}})};d.buttons[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};f=c.$mjListPage.find(".co-pop-label");f=desknets.dialog.setUp(f,d);return f},_getErrorPlace:function(b){var c=this;if(b!==""&&c.$mDialog!==null){return desknets.getErrFieName(c.$mDialog,b)}return""},_setAppendLabel:function(d,e){var b=this;var c=b.$mjListPage.find(".co-listview-items");c.append(b._getLabelLeftHtml(e.id,d.name,"0"));b._getLabelLeftDrag(c.find(".co-label:last"));b._getLabelDrop(c.find(".co-label"),b.$mjListPage.find(".co-label-droppable"))},_labelEntryAjaxError:function(e,b,d){var c=this;if(e.status==desknets.ERRORNO_GRPERR_ITEMNOTHING){desknets.ajax.onError(e.status,desknets.Resource.Message.com_itemnothing_listreload)}else{desknets.ajax.onError(e.status,d)}},_getListAjaxSuccessAddData:function(){var b=this;if(!b._boDelSingle()&&(typeof jsonRestLabel)!="undefined"){b._getAddDataAjaxSuccess(jsonRestLabel)}else{b._getAddDataAjax()}},_getAddDataAjaxSuccess:function(b){this._getLabelAjaxSuccess(b);this._setTitleLabel()},_getLabelAjaxSuccess:function(g){var j=this;var e=desknets.ajax.getJsonItems(g);var i=[];var b=[];var d=[];var k=j.$mjListPage.find(".co-listview-items");var c=0;var h=0;b[b.length]=j.sDefLabelHtml;c=e.length;for(h=0;h<c;h++){i=e[h];b[b.length]=j._getLabelLeftHtml(i.id,i.labelname,i.labelassigncnt)}k.html(b.join(""));j._setCountItemAssignLabelDefault(g);j.$mjListPage.find(".co-listview-left").find(".co-label-none").find(".count").hide().show();j._setLabelOn();var f=j.$mjListPage.find(".co-listview-items").find(".co-label").not(".co-label-none");j._getLabelLeftDrag(f);j._getLabelDrop(f,j.$mjListPage.find(".co-label-droppable"))},_setCountItemAssignLabelDefault:function(c){var b=this;var d=b.$mjListPage.find(".co-listview-left").find(".count.jco-label-cntitem-all");var e=b.$mjListPage.find(".co-listview-left").find(".count.jco-label-cntitem-none");d.text(c.lblassigncntall);e.text(c.lblassigncntnone)},_getLabelLeftHtml:function(d,f,b){var c=desknets.escape(f);c=desknets.escapeValue(c);c=desknets.escapeSpace(c);var e='<li><a class="co-label jco-label-data" href="#" title="'+c+'"><span class="count">'+b+'</span><input type="hidden" class="jco-label-id" value="'+d+'"><span class="co-draghandle">:</span><span class="jco-label-name">'+c+"</span></a></li>";return e},_setParamCondLabelList:function(c){for(var b in c){if(c[b]){if(b=="row"||b=="num"||b=="order"||b=="fldsort"||b=="labelid"){delete c[b]}}}},getAddDataParam:function(){var b=this;var c=b.getListParamToObj();b._setParamCondLabelList(c);return c},_getLabelLeftDrag:function(b){var c=this;b.draggable({start:function(){a(this).focus();c.$mjListPage.find("input[type=checkbox]").attr("checked",false);c.$mjTableList.find("tr").removeClass("co-tr-selected");c.$mjListPage.find(".co-chk-cnt-some").hide();c.$mjListPage.find(".co-chk-cnt-all").hide()},helper:"clone",cursor:"move",cursorAt:{top:0,left:-5}})},_getLabelDrop:function(b,d){var c=this;d.droppable({accept:b,tolerance:"pointer",hoverClass:"co-list-dropover",drop:function(h,n){var q=c.$mjListPage.find(".co-listview-scroll");var f=q.offset().top-15;var k=q.height()+f+15;if(n.offset.top<f||n.offset.top>k){return}var j=a(n.draggable);var g=a(this);var i=null;var p=j.find(".jco-label-id").val();var o=g.find(".co-label-view-area").find(".jco-label-id").val();if(neo.isSet(o)&&p==o){return}var l=function(){if(i!=null){desknets.submitform.setDialogDisabled(i)}var s={};var r={};r.cmd=c._getDataLabelEntryCmd();r.id=p;r.assignid=g.find(".jco-id").val();s={success:function(v,t,w){c._modCountAddAssignLabel(j,g);var u=g.find(".co-label-view-area");u.html("");u.append(desknets.label.getLabelHtml(p,j.find(".jco-label-name").text()));if(i!=null){desknets.submitform.clearDialogDisabled(i);i.dialog("close")}g.removeClass("co-list-dropover")},error:function(v,t,u){if(i!=null){desknets.submitform.clearDialogDisabled(i)}desknets.ajax.onError(v.status,u)},};c._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,r,s);return false};var m=function(){g.removeClass("co-list-dropover")};var e={cancel:m};g.addClass("co-list-dropover");if(g.find(".co-label-view-area").find(".co-label").length>0){i=desknets.dialog.confirm(desknets.Resource.Message.com_label_datamod,l,e)}else{i=null;l()}}})},_setLabelOn:function(){var d=this;var f=true;var c=null;var g=null;var b=d.$mjListPage.find('input[name="labelid"]').val();var e=d.$mjListPage.find(".co-listview-items");e.find(".co-label.on").removeClass("on");e.find(".jco-label-id").each(function(){if(c===null){c=a(this)}if(a(this).val()==b){g=a(this).parent();f=false;return false}});if(f&&c!==null){g=c.parent()}g.addClass("on");if(d.mboLabelScrollChg==true){d._updateScrollTopValue()}d.mboLabelScrollChg=false;if(g.hasClass("co-label-none")){d.$mjListPage.find(".jco-label-mod").attr("disabled",true);d.$mjListPage.find(".jco-label-del").attr("disabled",true)}else{d.$mjListPage.find(".jco-label-mod").attr("disabled",false);d.$mjListPage.find(".jco-label-del").attr("disabled",false)}},_updateScrollTopValue:function(){var c=this;var d=c.$mjListPage.find(".co-listview-left-data");var b=d.find(".on");if(!b||b.length==0){return}var e=0;d.find(".co-label").each(function(){if(a(this).hasClass("on")){return false}e++});d.scrollTop((b.height()+4)*e)},_modCountAddAssignLabel:function(d,b){var j=this;var e;var i=0;var f=j.$mjListPage.find(".co-listview-left-data").find(".co-listview-items");var g=f.find(".jco-label-cntitem-none");var h=b.find(".co-label-view-area").find(".jco-label-id").val();var c=d.find(".jco-label-id").val();if(!neo.isSet(h)){i=parseInt(g.text());i=i-1;g.text(i)}else{f.find(".co-label").each(function(){var k=a(this).find(".jco-label-id").val();if(!neo.isSet(k)||parseInt(k)<=0){return true}if(h==k){e=a(this).find(".count");i=parseInt(e.text());i=i-1;e.text(i)}})}f.find(".co-label").each(function(){var k=a(this).find(".jco-label-id").val();if(!neo.isSet(k)||parseInt(k)<=0){return true}if(c==k){e=a(this).find(".count");i=parseInt(e.text());i=i+1;e.text(i)}})},_modCountDelAssignLabel:function(b){var d=this;var c;var i=0;var f=d.$mjListPage.find(".co-listview-left-data").find(".co-listview-items");var h=f.find(".jco-label-cntitem-none");var g=b.find(".jco-label-id").val();var e=parseInt(h.text());e=e+1;h.text(e);f.find(".co-label").each(function(){var j=a(this).find(".jco-label-id").val();if(!neo.isSet(j)||parseInt(j)<=0){return true}if(g==j){c=a(this).find(".count");i=parseInt(c.text());i=i-1;c.text(i)}})},_getAreaTitle:function(b){var d=this;var c=d._tmplLabelTitle;c=desknets.tmpl.replaceWordChk(c,"labelname",d._selName);if(neo.isSet(d._selName,{blank:false})){c=" > "+c}return d.callBase("_getAreaTitle",b)+c},_setTitleLabel:function(){var d=this;var c="";var e=d.$mjListPage.find(".co-listview-left-data");var b=e.find(".on");if(!b||b.length==0){return}if(b.find("span:last").hasClass("jco-label-name")){c=b.find("span:last").text()}else{c=b.contents().filter(function(){return this.nodeType==3}).text()}if(c.length==0){return}d._selName=c;d._setTitle(d._getAreaTitle(d.$mjListPage))},_getAddPageParam:function(){var b=this;var c={};if(b._mboAddPageLabelId){var d=b.$mjListPage.find(".co-listview-left-data").find(".co-label.on").find(".jco-label-id").val();if(neo.isSet(d)){c.labelid=d}}return c},_getDelAddPrm:function(){var b=this;var c={};c.labelid=b.$mjListPage.find('input[name="labelid"]').val();return c},_getAddDataGetCmd:function(){return this._getLabelGetCmd()},_getLabelGetCmd:function(){return""},_getLabelEntryCmd:function(){return""},_getLabelDelCmd:function(){return""},_getDataLabelEntryCmd:function(){return""},_getDataLabelDelCmd:function(){return""}});desknets.page.GroupSelect=function(){return this};desknets.page.groupSelect={_defTmpl:'<span class="co-btnarea-gname" title="{{longName}}"><input type="hidden" name="{{keyName}}" value="{{id}}" />{{name}}</span>',_defTmplInput:'<span><input type="hidden" name="{{keyName}}" value="{{id}}" />{{longName}}</span>',_defaultOptions:{pageID:"jco-m-list-container",pageCmd:null,fldName:"gid",selectClass:"jco-sel-items",selectTemplate:"jco-group-sel-item-tmpl",dialogID:"co-sel-chooser-dialog",initCreate:true,onSelectGroup:null,assign:false,onSelectGroupHide:true},_boIntput:false,_initDialog:false,_initTitle:"",_selTmpl:"",_dialogObj:null,init:function(d,e,b){var c=this;var f={};if(typeof e!="object"){e={}}f=a.extend({},c._defaultOptions,d);if(neo.isSet(b)&&b==true){c._boIntput=true;f.onSelectGroupHide=false}c._initGroupSelectDialog(f,e)},_initGroupSelectDialog:function(l,b){var k=this;var f;var j;var d;f=a("#"+l.pageID);j=f.find("."+l.selectClass);d=f.find("."+l.selectClass).parent();if(l.assign&&j.length<=0){j=f.find('select[name="'+l.fldName+'"]');j.change(function(m){a(m.target).blur();if(k._boIntput==true){k._onSelectGroupInput(l)}else{k._onSelectGroup(l)}})}else{var e;var i="";var h=f.find("."+l.selectTemplate);if(h.length>0){k._selTmpl=h.remove().html()}else{if(k._boIntput==true){k._selTmpl=k._defTmplInput}else{k._selTmpl=k._defTmpl}}if(k._boIntput==true){e=k._onSelectGroupInput}else{k._initTitle=j.find("span").eq(0).attr("title");e=k._onSelectGroup}var c=desknets.paramanalyzer.getHashParams();if(neo.isSet(l.defaultGroupId)){i=l.defaultGroupId}else{if(c&&c[l.fldName]&&c[l.fldName].length>0){i=c[l.fldName]}else{var g=j.find("input:first");if(g.length>0){i=g.val()}}}b.defaultGroupId=i;k._dialogObj=desknets.chooser.setUpEntry(d,k._getSelectedGroup(l),{dialogID:l.dialogID,initCreate:l.initCreate,template:k._selTmpl,dialogOptions:k._getGroupSelectDialogOptions(b),change:function(){e(l)},extraVars:{group:{keyName:l.fldName}}})}},_getSelectedGroup:function(d){var c=this;var b=[];var f="";var g;var e;g=a("#"+d.pageID);e=g.find("."+d.selectClass);if(g.find("."+d.selectClass).length<=0){return b}b.push({id:g.find('input[name="'+d.fldName+'"]').val(),type:"group",name:e.find("span").text()});if(c._boIntput==false){b[0]["longName"]=desknets.escapeValue(e.find("span:first").attr("title"))}else{b[0]["longName"]=desknets.tmpl.escapeWord(e.find("span:first").text())}return b},_getGroupSelectDialogOptions:function(d){var b=this;var c={mode:"single",chooseTarget:["group"]};a.extend(c,d);return c},_onSelectGroup:function(j){var i=this;var b="";var d="";var e;var h;var g=false;e=a("#"+j.pageID);h=e.find("."+j.selectClass);if(j.assign&&h.length<=0){h=e.find('select[name="'+j.fldName+'"]');d=h.find("option:selected").val();g=true}else{if(j.onSelectGroupHide&&i._initDialog){h.hide()}d=h.find("input").val()}if(!i._initDialog&&!g){i._initDialog=true;return}if(a.isFunction(j.onSelectGroup)){j.onSelectGroup(d);return}var f=e.find(".jco-back-page-data");f.find('input[name="'+j.fldName+'"]').val(d);f.find('input[name="row"]').val("0");var c=desknets.getInputDataToUrl(f);if(neo.isSet(j.pageCmd)){b=j.pageCmd}else{b=a("#jco-pv-funcid").val()}c=c+"&cmd="+b;desknets.paramanalyzer.setLocationHash(c)},_onSelectGroupInput:function(b){return},editSelectedGroup:function(f,g,c){var j=this;var b="";var h="";var d="";var i="";var e=[];if(!c){c=this._defaultOptions.fldName}b=g.evgname;h=g.tgname;d=g[c];if(!neo.isSet(d)||!neo.isSet(b)){return}if(neo.isSet(j._dialogObj)){e.push({id:d,type:"group",name:b});j._dialogObj.replaceItems(e)}i=j._getSelectedGroupHtml(b,h,d,c);f.html(i).show()},editSelectedAssignGroup:function(f,d,c,b){if(d.length<=0){if(!b){b=this._defaultOptions.fldName}d=f.find('select[name="'+b+'"]');var e=c[b];d.val(e)}else{this.editSelectedGroup(d,c,b)}},_getSelectedGroupHtml:function(e,g,f,b){var c=this;var d;if(!neo.isSet(c._selTmpl,{blank:false})){d=c._defTmpl}else{d=c._selTmpl}d=desknets.tmpl.replaceWordHtml(d,"keyName",b);d=desknets.tmpl.replaceWordHtml(d,"id",f);d=desknets.tmpl.replaceWord(d,"longName",g);d=desknets.tmpl.replaceWord(d,"name",e);return d}};desknets.page.GroupSelect.prototype=desknets.page.groupSelect;desknets.hashobserver={targetObj:null,targetFunc:"funcHashObserver",beforeHashChangeFunc:null,beforeChangePageHash:null,_currParams:null,init:function(c){var b=this;this._currParams=this._getCurrParams();b.setTarget(c);b.startObserveHash()},setTarget:function(c){var b=this;b.targetObj=c},startObserveHash:function(){var b=this;a(window).data("hashobserver",b);a(window).bind("hashchange.dnHashobserver",function(){var c=b._onBeforeHashChange();if(!c){b._onHashChange()}})},_onHashChange:function(){var b=this;var c="";c=desknets.paramanalyzer.getPageCmd();desknets.paramanalyzer.cleanParams();b._triggerChangeEvent();if(c in b.targetObj&&b.targetFunc in b.targetObj[c]){b.targetObj[c].funcHashObserver()}},stopObserveHash:function(){a(window).unbind("hashchange.dnHashobserver")},_onBeforeHashChange:function(){var b=this;var c=false;if(typeof b.beforeHashChangeFunc=="function"){c=b.beforeHashChangeFunc()}return c},_triggerChangeEvent:function(){var c=this._currParams;var b=this._getCurrParams();if(!!c.cmd&&!!b.cmd&&c.cmd!=b.cmd){a(document).trigger("pageChanged.desknets",{prevCmd:c.cmd,prevParams:c,currCmd:b.cmd,currParams:b})}else{a(document).trigger("paramChanged.desknets",{prevParams:c,currParams:b})}this._currParams=b},_getCurrParams:function(){var b=desknets.paramanalyzer.getHashParams();if(!b){b={}}if(!b.cmd){b.cmd=a("#jco-pv-funcid").val()}return b}};desknets.paramanalyzer={mboNotChangeHash:false,mObjParams:{},setNotChangeHash:function(c){var b=this;if(c&&b.mboNotChangeHash){return false}b.mboNotChangeHash=c;return true},getPageCmd:function(){var b=this;var d="";var c=location.href;c=c.substr(0,(c+"#").indexOf("#"));var e=b.splitParam(c);if(e.cmd){d=e.cmd}return d},getExecCmd:function(){var b=this;var c="";var d=b.getHashParams();if(d.cmd){c=d.cmd}return c},getHashParam:function(b){var c=this;var d="";var e=c.getHashParams();if(e[b]){d=e[b]}return d},getHashParams:function(){var b=this;if(!a.isEmptyObject(b.mObjParams)){var d=a.extend({},b.mObjParams);return d}var c=b.getLocationHash();b.mObjParams=b.splitParam(c);var d=a.extend({},b.mObjParams);return d},getLocationHash:function(){var c=window.location.href;var b=c.indexOf("#");var d="";if(b>=0){d=c.substring(b+1,c.length)}return d},setLocationHash:function(c){var b=this;if(!b.mboNotChangeHash){desknets.paramanalyzer.cleanParams();var f="";if(typeof c=="object"){f=b.joinParam(c)}else{f=c}try{window.location.hash=f}catch(d){alert(d.message)}}},splitParam:function(b){return desknets.splitParam(b)},joinParam:function(b){return desknets.getNeoParam(b)},cleanParams:function(){var b=this;b.mObjParams={}}};desknets.chooser={MODULE:"zrconst",MODULE_ROLE:"zrconst",CMD_GROUPS:"constructugroups",CMD_GROUPTREE:"constructcmdgrouptree",CMD_USERS:"constructcmdusersearch",CMD_ROLE:"setrolelist",_history:null,init:function(){this.setUserFieldsToShow(desknets.pageframe.getUserDispItems())},setUpEntry:function(e,b,c){var d=a("#"+c.dialogID);if(d.length>0){desknets.chooser.destroyDialog(d)}return new desknets.chooser.Entry(e,b,c)},open:function(e,c){if(!!c&&c.mode=="single"&&String(c.chooseTarget)=="group"){if(a.type(c.items)=="array"&&c.items.length==1&&c.items[0].type=="group"){c.defaultGroupId=c.items[0].id}return desknets.chooser.singleGroup.open(e,c)}if(c.chooseAssignedGroup){return desknets.chooser.assignedGroup.open(e,c)}else{if(c.chooseGrpUsers){return desknets.chooser.grpUser.open(e,c)}}var b=this,d=a("#"+e);if(d.hasClass("ui-dialog-content")){desknets.pageframe.executeOnTipShown(function(){if(!!c&&!!c.items){d.children(".co-sel").dnChooser("items",c.items)}d.dialog("open")})}else{if(d.length<=0){d=a("<div />").attr("id",e).appendTo(document.body);desknets.pageframe.executeOnTipShown(function(){b.setUpDialog(d,c)})}}return d},close:function(c,b){c.dialog("close");if(b){desknets.chooser.saveHistory(c.children().dnChooser("items"))}},setUpDialog:function(f,d){var b=this,e={};var c=a("<div />").appendTo(f);if(!!d){a.extend(e,d);this._setUpChooseEvent(f,d.choose)}f.bind("dnchooserload",function(){var g=(e.mode=="single")?"com_chooser_note_single":"com_chooser_note";desknets.dialog.setUp(f,b._getChooserDialogOptions(d));a('<div class="co-msg co-sel-dialog-note" />').text(desknets.Resource.Message[g]).appendTo(f.closest(".ui-dialog"));if(e.mode=="single"){f.on("dnchooseritemlistadd",function(h){b._onChooseItems(f,e)})}f.dialog("open")});c.dnChooser(e)},destroyDialog:function(b){b.children().dnChooser("destroy");b.dialog("destroy").remove()},_ajaxRest:function(c,e,f,j){var g;if((!!j&&j.mode=="single"&&String(j.chooseTarget)=="group")||(j.chooseAssignedGroup)){g=desknets.Resource.chooser.allGroupName}else{g=desknets.Resource.chooser.allUserName}var b=a.extend({allGroupLabel:g,unassignGroupLabel:desknets.Resource.chooser.unassignGroupName},j);var i=this;var d=i._ajaxRestPrefilter(e,b);var h=a.isArray(d)?desknets.ajax.arrayToMultiCmdData(d):d;desknets.ajax.rest({id:"desknets-chooser",url:c,data:h,type:"POST",success:function(l,k,m){i._ajaxRestPostfilter(d,l,b);f(l,k,m)},error:function(m,l,k){if(l!="abort"){desknets.ajax.onError(m.status,k)}}})},_getSubType:function(c){var b=c.type;if(c.type=="group"){if(c.id=="all"){return"all-"+c.type}else{if(c.id=="0"){return"unassigned-"+c.type}else{if(Number(c.id)<0){return"private-"+c.type}else{if(c.id=="suspended"){return"suspension-"+c.type}else{if(c.id=="loginlock"){return"loginlock-"+c.type}else{return"shared-"+c.type}}}}}}if(c.type=="role"){if(Number(c.id)<=desknets.DBVAL_ROLE_LOCK_MAX){return"system-"+c.type}else{return"user-"+c.type}}else{return c.type}},_ajaxRestPrefilter:function(e,b){if(a.isArray(e)){var d=[];for(var c=0;c<e.length;c++){d.push(this._ajaxRestPrefilterSingle(e[c],b))}return d}else{return this._ajaxRestPrefilterSingle(e,b)}},_ajaxRestPrefilterSingle:function(d,b){var c=a.extend({row:0},d);if(this._isRootGroupRequest(c,b)){if(!!b.allGroup){c=this._ajaxRestPrefilterAllGroup(c,b)}}return c},_ajaxRestPrefilterAllGroup:function(d,b){var c=a.extend({},d);if(d.row>0){c.row--}else{if(!!d.num&&d.num>0){c.num--}}return c},_ajaxRestPostfilter:function(e,d,b){if(a.isArray(e)){for(var c=0;c<e.length;c++){this._ajaxRestPostfilterSingle(e[c],d[c],b)}}else{this._ajaxRestPostfilterSingle(e,d,b)}},_ajaxRestPostfilterSingle:function(d,c,b){this._ajaxRestPostfilterCommon(d,c,b);if(this._isRootGroupRequest(d,b)){if(!!b.allGroup){this._ajaxRestPostfilterAllGroup(d,c,b)}if(!!b.unassignGroup){this._ajaxRestPostfilterUnassignGroup(d,c,b)}}},_ajaxRestPostfilterCommon:function(f,d,c){var e=Number(d.allcnt);var g=Number(d.row)||0;var b=desknets.ajax.getJsonItems(d);if(g==f.row){d.list={item:b}}else{if(g<f.row){d.list={item:b.slice(f.row-g)}}else{d.list={item:[]}}}d.allcnt=!!e?e:d.list.item.length},_ajaxRestPostfilterAllGroup:function(d,c,b){c.allcnt++;if(d.row==0){c.list.item.unshift({id:"all",children:"0",parent:"",Name:b.allGroupLabel})}},_ajaxRestPostfilterUnassignGroup:function(d,c,b){c.allcnt++;if(!d.num||d.num>c.list.item.length){c.list.item.push({id:"0",children:"0",parent:"",Name:b.unassignGroupLabel})}},_isRootGroupRequest:function(c,b){if(c.cmd==b.cmdgrouptree){return true}if(c.cmd==b.cmdgroups&&!c.pgid&&c.area=="2"){return true}return false},_getChooserDialogOptions:function(c){var b=this,d={};d[desknets.Resource.OKButtonLabel]=function(){var e=a(this);desknets.pageframe.executeOnTipShown(function(){b._onChooseItems(e,c)})};d[desknets.Resource.CancelButtonLabel]=function(){b.close(a(this),false)};return{buttons:d,dialogClass:"dn-dialog co-sel-dialog",title:c.title||desknets.Resource.selectLabel,width:800,open:c.open,close:function(){neo.ajax.abort("desknets-chooser",true)}}},_onChooseItems:function(e,c){var b=e.children().dnChooser("items");var d=a.Event("choose.dnChooser");if(!this._validate(b,e)){return}e.trigger(d,[b]);if(!d.isDefaultPrevented()){if(c.chooseHistory||c.chooseHistory==undefined){this.close(e,true)}else{this.close(e,false)}}},_setUpChooseEvent:function(b,c){if(a.isFunction(c)){b.bind("choose.dnChooser",function(f,e){var d=c.apply(this,[e]);if(d===false){f.preventDefault()}})}},_validate:function(b,f){var c=f.find(".co-sel").dnChooser("option");var g=c.chooseTarget;if(c.mode=="single"&&b.length<=0){var d=g.join("_");var e=desknets.Resource.Message["com_chooser_required_"+d];desknets.dialog.alert(e);return false}return true}};a.widget("desknets.dnChooser",{_TMPL:"com/chooser.html",_MAX_HISTORY:20,_tabs:null,_activeTab:null,_$choosenList:null,options:{items:[],lockedItems:[],chooseTarget:["user"],mode:"multi",search:true,chooseGroup:true,choosePrivateGroup:false,chooseDisplayGroup:false,chooseHistory:true,choosenDnD:false,selectedTabIndex:-1,allGroup:null,unassignGroup:null,defaultGroupId:"",choosenListPlugIn:"dnChooserChoosenList",itemListPlugIn:"dnChooserItemList",module:desknets.chooser.MODULE,cmdusers:desknets.chooser.CMD_USERS,cmdgroups:desknets.chooser.CMD_GROUPS,cmdgrouptree:desknets.chooser.CMD_GROUPTREE},_create:function(){var b=this;b._tabs=[];b.element.addClass("co-sel co-sel-"+b.options.mode);desknets.tmpl.load(b.element,b._TMPL,function(){b._createLayout(b.element.find(".co-sel-content"));b._createChoosenList(b.element.find(".co-sel-bottom"));b._createTabs(b.element.find(".co-sel-tabs"),function(){b._trigger("load")})},{cache:true})},items:function(b){if(a.isArray(b)){if(this._$choosenList!=null){this._$choosenList[this.options.choosenListPlugIn]("items",b)}return this}else{return this._getItems()}},deselect:function(){if(this.options.mode=="single"){this.element.find(".co-tr-selected").each(function(){a(this).removeClass("co-tr-selected").find('input[type="radio"]').prop("checked",false)})}},_createLayout:function(c){var b=this;c.layout({zIndex:0,size:220,minSize:120,maxSize:560,spacing_open:12,resizerTip:desknets.Resource.resizeWidthLabel,closable:false,scrollToBookmarkOnLoad:false,onresize_end:function(){b._activeTab.resizeMenu()}});if(this.options.mode=="single"){c.find(".co-sel-bottom").remove()}else{c.find(".co-sel-center").layout({zIndex:0,size:220,minSize:80,maxSize:360,spacing_open:12,resizerTip:desknets.Resource.resizeHeightLabel,scrollToBookmarkOnLoad:false,closable:false})}},_createChoosenList:function(d){var b=this;if(b.options.mode!="single"){var c=a.extend({},b.options,{editDescendant:b.options.editDescendant&&a.inArray("group",b.options.chooseTarget)>=0,change:function(){b._updateSelectedItemsInActiveTab()},choosenDnD:b.options.choosenDnD});b._$choosenList=a("<div />").appendTo(d);b._$choosenList[b.options.choosenListPlugIn](c)}},_createTabs:function(f,e){var d=this,c,b;if(this.options.extraTab){this._createExtraTab(f,this.options.extraTab)}if(this.options.search){this._createTab(f,desknets.chooser.searchTabItem)}if(this.options.chooseGroup){this._createTab(f,desknets.chooser.treeTabItem)}if(a.inArray("role",this.options.chooseTarget)>=0){this._createTab(f,desknets.chooser.roleTabItem)}if(this.options.choosePrivateGroup){this._createTab(f,desknets.chooser.privateGroupTabItem)}if(this.options.chooseDisplayGroup){this._createTab(f,desknets.chooser.displayGroupTabItem)}if(this.options.chooseHistory){this._createTab(f,desknets.chooser.historyTabItem)}f.delegate("li","click",function(g){g.preventDefault();d._selectTab(a(this));d._saveTabSelection()});b=f.children("li:not(.co-sel-disabled)");if(b.length<=this.options.selectedTabIndex){this.options.selectedTabIndex=0}c=this.options.itemListPlugIn.toLowerCase()+"load";this.element.on(c,function(g){d._updateSelectedItemsInActiveTab()});this.element.one(c,function(g){if(typeof e=="function"){e()}});this._selectTab(this._getDefaultTabSelection(b))},_createExtraTab:function(b,c){c.item.rootClass="co-sel-extra";this.element.find(".co-sel-tabs>.co-sel-extra>a").text(c.title).attr("title",c.title);this._createTab(b,c.item)},_createTab:function(d,e){var c=".co-sel-tabs>."+e.rootClass;var b=a.extend({},e);this.element.find(c).removeClass("co-sel-disabled");b.init(this.element,this.options);this._tabs.push(b)},_selectTab:function(c,d){var b=c.prevAll("li:not(.co-sel-disabled)").length;if(this._activeTab!=null){this._activeTab.hide();this._setSelectedItemsInActiveTab([]);c.siblings(".on").removeClass("on")}this._activeTab=this._tabs[b];this._updateSelectedItemsInActiveTab();this._activeTab.show();c.addClass("on")},_updateSelectedItemsInActiveTab:function(){if(!!this._$choosenList){var b=this._$choosenList[this.options.choosenListPlugIn]("items");this._setSelectedItemsInActiveTab(b)}},_setSelectedItemsInActiveTab:function(b){if(!!this._activeTab){this._activeTab.$itemList.dnChooserItemList("select",b)}},_getDefaultTabSelection:function(b){var e,c,d;c=this.options.selectedTabIndex;if(0<=c&&c<b.length){return b.eq(c)}d=desknets.storage.loadData(desknets.storage.FIELD_CHOOSER_TAB);e=b.filter("."+d);if(e.length==1){return e}e=b.filter("."+desknets.chooser.treeTabItem.rootClass);if(e.length==1){return e}return b.eq(0)},_saveTabSelection:function(){if(!!this._activeTab&&!!this._activeTab.rootClass){desknets.storage.saveData(desknets.storage.FIELD_CHOOSER_TAB,this._activeTab.rootClass)}},_getItems:function(){var c,b=null;if(this._$choosenList!=null){return this._$choosenList[this.options.choosenListPlugIn]("items")}c=this.element.find(".co-sel-chooser-items").filter(function(){return a(this).css("display")!="none"});if(c.length>0){b=c[this.options.itemListPlugIn]("getSelected")}return !!b?[b]:[]},_filterHistory:function(c){var b=this,d=[];var e={group:{num:0,id:{}},role:{num:0,id:{}},user:{num:0,id:{}}};a.each(c,function(g,h){var f=e[h.type];if(!!f&&f.num<b._MAX_HISTORY&&!f.id[h.id]){d.push({id:h.id,type:h.type,name:h.name,description:h.description});e[h.type].num++;e[h.type].id[h.id]=true}});return d}});desknets.chooser.tabItem={$sideMenu:a(),$itemList:a(),$pager:a(),rootClass:"",created:false,perPage:100,_linkToChild:false,_components:null,_$choosenList:a(),_options:null};desknets.chooser.tabItem.init=function(d,c){var b;this._$choosenList=d.find(".co-sel-choosen-items");this._options=a.extend({},c);this.$sideMenu=d.find(".co-sel-side ."+this.rootClass);b=d.find(".co-sel-pager");this.$pager=a("<div />").appendTo(b).hide();this.$pager.attr("class","co-page "+this.rootClass);b=d.find(".co-sel-top>.co-sel-explaination").eq(0);this.$itemList=a("<div />").insertBefore(b).hide();this.$itemList.attr("class",this.rootClass);this._components=[this.$sideMenu,this.$pager,this.$itemList]};desknets.chooser.tabItem.destroy=function(){if(this.$itemList!=null){this.$itemList.dnChooserItemList("destroy")}};desknets.chooser.tabItem.show=function(){if(!this.created){this.created=true;this._create(this._$chooserBase)}a.each(this._components,function(c,b){b.show()})};desknets.chooser.tabItem.hide=function(){a.each(this._components,function(c,b){b.hide()})};desknets.chooser.tabItem.resizeMenu=function(){};desknets.chooser.tabItem._create=function(){this._createSideMenu();this._createItemList();this._createPager();this._createOthers()};desknets.chooser.tabItem._createSideMenu=function(b){this.$sideMenu=a()};desknets.chooser.tabItem._createItemList=function(){var b=this;var c=a.extend({},b._options,{mode:(this._options.mode=="single")?"radio":"add",linkToChild:this._linkToChild,add:function(e,d){b._$choosenList[b._options.choosenListPlugIn]("add",d)},sourceChange:function(e){var d=b.$itemList.dnChooserItemList("getTotalPage");b._updatePager(1,d)},open:function(e,d){b._openGroup(d)}});this.$itemList.dnChooserItemList(c)};desknets.chooser.tabItem._createPager=function(){this._updatePager(0,0)};desknets.chooser.tabItem._createOthers=function(){};desknets.chooser.tabItem._openGroup=function(b){};desknets.chooser.tabItem._removeNonTargetElement=function(c){var b=["group","role","user"];for(var d=0;d<b.length;d++){if(a.inArray(b[d],this._options.chooseTarget)<0){c.find(".jco-sel-target-"+b[d]).remove()}}};desknets.chooser.tabItem._updatePager=function(b,e){var c=this,d=100;desknets.Pager.output(this.$pager.parent(),"."+this.rootClass,{getCount:e>0?d:0,allCount:e*d,pageMaxView:d,startRow:(b-1)*d,clickFunc:function(f){c._changePage((f/d)+1)}})};desknets.chooser.tabItem._changePage=function(b){if(this.$itemList!=null){var c=this.$itemList.dnChooserItemList("getTotalPage");this.$itemList.dnChooserItemList("setPage",b);this._updatePager(b,c)}};desknets.chooser.groupListTabItem=a.extend({},desknets.chooser.tabItem,{_linkToChild:true,_area:"",_itemHtml:"",_groupItems:[],_$rootItem:a(),_$list:a()});desknets.chooser.groupListTabItem._createSideMenu=function(c){var b=this;this._$rootItem=this.$sideMenu.find("> ul > li").eq(0);this._$list=this.$sideMenu.find("> ul > li > ul");this.created=false;if(!this._itemHtml){this._itemHtml=this._$list.html();this._$list.empty()}this._$rootItem.children("a").click(function(d){d.preventDefault();b._openRootGroup()});this._$list.delegate("a","click",function(e){e.preventDefault();var d={id:a(this).closest("li").data("id")};b._openGroup(d)});this._createList()};desknets.chooser.groupListTabItem._openRootGroup=function(){this._$rootItem.addClass("on");this._$list.children().removeClass("on");this.$itemList.dnChooserItemList("setItems",this._groupItems)},desknets.chooser.groupListTabItem._openGroup=function(b){if(a.inArray("user",this._options.chooseTarget)>=0){this._$rootItem.removeClass("on");this._$list.children().each(function(){var c=a(this);if(c.data("id")==b.id){c.addClass("on")}else{c.removeClass("on")}});this.$itemList.dnChooserItemList("setDataSources",{user:{cmd:this._options.cmdusers,gid:b.id,num:this.perPage}})}};desknets.chooser.groupListTabItem._createList=function(){var b=this;var d={cmd:b._options.cmdgroups,area:b._area};if(!!b._options.moduletype&&b._area=="4"){d.module=b._options.moduletype}var c=desknets.getUrl(b._options.module);desknets.chooser._ajaxRest(c,d,function(f){var e=desknets.ajax.getJsonItems(f);b._groupItems=b._convertItems(e);b._createListElement();b._openRootGroup();b.created=true},b._options)};desknets.chooser.groupListTabItem._createListElement=function(){if(a.inArray("user",this._options.chooseTarget)>=0){this._$list.html(this._getListHtml(this._groupItems))}};desknets.chooser.groupListTabItem._convertItems=function(b){var c=[];a.each(b,function(d,e){c.push(desknets.chooser.convertGroupItem(e))});return c};desknets.chooser.groupListTabItem._getListHtml=function(c){var b=this,d=[];a.each(c,function(e,g){var f=b._itemHtml;var h=desknets.chooser._getSubType(g);f=desknets.tmpl.replaceWordHtml(f,"id",g.id);f=desknets.tmpl.replaceWord(f,"name",g.name);f=desknets.tmpl.replaceWordHtml(f,"subType",h);d.push(f)});return d.join("")};desknets.chooser.searchTabItem=a.extend({},desknets.chooser.tabItem,{rootClass:"co-sel-search",_$explaination:null});desknets.chooser.searchTabItem._createSideMenu=function(c){var b=this;b._removeNonTargetElement(b.$sideMenu);b.$sideMenu.find("dl:last").addClass("active");b._initFields();this.$sideMenu.find("input:text").bind("focus",function(d){b._updateActiveFieldSet(a(this).closest("dl"))});this.$sideMenu.find("form").bind("submit",function(d){d.preventDefault();b._beginToSearch()})};desknets.chooser.searchTabItem._createOthers=function(){var b=this;b._$explaination=b.$itemList.siblings(".co-sel-search.co-sel-explaination");b._initUserGuide();a.each(b._options.chooseTarget,function(c,d){b._$explaination.addClass("co-sel-search-"+d)});b._components.push(b._$explaination)};desknets.chooser.searchTabItem._initFields=function(){this.$sideMenu.find(".co-guide-label").each(function(){var b=a(this);desknets.user.removeFieldIfHidden(b,b.next())})};desknets.chooser.searchTabItem._initUserGuide=function(){var b=[],d="";var c=this._$explaination.find(".co-sel-msg-user");this.$sideMenu.find(".jco-sel-target-user .co-guide-label").each(function(){b.push('"'+a(this).text()+'"')});d=c.text();d=desknets.tmpl.replaceWordHtml(d,"fields",b.join(desknets.Resource.comma));c.text(d)};desknets.chooser.searchTabItem._updateActiveFieldSet=function(b){b.siblings().removeClass("active");b.addClass("active")};desknets.chooser.searchTabItem._beginToSearch=function(){var b=this,c={},e="group";var d=this.$sideMenu.find("dl.active");var f={cmd:this._options.cmdgroups,num:this.perPage};d.find("input").each(function(){f[this.name]=this.value});if(d.hasClass("co-sel-search-users")){f.cmd=this._options.cmdusers;e="user"}if(!!b._options.moduletype){f.module=b._options.moduletype}c[e]=f;this.$itemList.dnChooserItemList("setDataSources",c);this._$explaination.addClass("searched")};desknets.chooser.treeTabItem=a.extend({},desknets.chooser.tabItem,{rootClass:"co-sel-groups",_linkToChild:true,_tree:null,_$parentButton:a(),_lastID:null});desknets.chooser.treeTabItem._createSideMenu=function(c){var b=this;b.created=false;b._createTree();b.$itemList.bind("dnchooseritemlistsourcechange",function(d){b._tree.openItemById(b._lastID)})};desknets.chooser.treeTabItem._createOthers=function(){var b=this;var c=b._options.defaultGroupId;b._$parentButton=b.$itemList.siblings(".co-sel-groups.co-sel-parent-button");b._components.push(b._$parentButton);b._$parentButton.find(".jco-sel-go-parent").click(function(d){d.preventDefault();b._tree.selectParent()});if(!!c){b.$itemList.one("dnchooseritemlistsourcechange",function(d){b.$itemList.dnChooserItemList("select",c,"group")})}};desknets.chooser.treeTabItem.resizeMenu=function(){this._tree.resize()};desknets.chooser.treeTabItem._createTree=function(){var b=this;b._tree=a.extend({},desknets.groupTree);b._tree.options=a.extend({},b._options,{leafChoosable:a.inArray("user",b._options.chooseTarget)>=0});b._tree.init(b.$sideMenu,{idName:"data-id",isLag:false,selFunc:function(d){var c=!d.hasClass("jstree-leaf");b._getListItemsInGroup(d.data("id"),c)}});b.$sideMenu.find(".co-listview-items").bind("loaded.jstree",function(){b.created=true})};desknets.chooser.treeTabItem._openGroup=function(b){this._tree.selectItemById(b.id)};desknets.chooser.treeTabItem._getListItemsInGroup=function(e,d){var b=this;var c={};e=neo.isSet(e)?String(e):"";this._lastID=e;if(e!=="all"&&e!=="0"&&d){c.group={cmd:this._options.cmdgroups,area:"2",pgid:e,num:this.perPage};if(!!b._options.moduletype){c.group.module=b._options.moduletype}}if(a.inArray("user",this._options.chooseTarget)>=0&&e!==""){c.user={cmd:this._options.cmdusers,gid:e,num:this.perPage}}if(!a.isEmptyObject(c)){this.$itemList.dnChooserItemList("setDataSources",c)}else{this._tree.openItemById(this._lastID)}};desknets.chooser.roleTabItem=a.extend({},desknets.chooser.tabItem,{rootClass:"co-sel-roles",_$history:a(),_$all:a()});desknets.chooser.roleTabItem._createSideMenu=function(c){var b=this;b._$history=this.$sideMenu.find(".co-sel-role-history");b._$all=this.$sideMenu.find(".co-sel-all-roles");if(!b._options.chooseHistory){b._$history.hide()}b._$history.find("a").click(function(d){d.preventDefault();b._beginToGetFromHistory()});b._$all.find("a").click(function(d){d.preventDefault();b._beginToGetFromList()});setTimeout(function(){b._beginToGetFromList()},0)};desknets.chooser.roleTabItem._beginToGetFromHistory=function(){var b=this;desknets.chooser.loadHistory(["role"],this._options,function(c){b.$itemList.dnChooserItemList("setItems",c);b._$history.addClass("on");b._$all.removeClass("on")})};desknets.chooser.roleTabItem._beginToGetFromList=function(){var b={cmd:desknets.chooser.CMD_ROLE,num:this.perPage};if(!!this._options.noAdministrators){b.noadmin="1"}if(!!this._options.noEveryone){b.noeveryone="1"}this.$itemList.dnChooserItemList("setDataSources",{role:b});this._$all.addClass("on");this._$history.removeClass("on")};desknets.chooser.privateGroupTabItem=a.extend({},desknets.chooser.groupListTabItem,{rootClass:"co-sel-private-groups",_area:"1"});desknets.chooser.privateGroupTabItem._convertItems=function(b){var c=[];a.each(b,function(d,e){var f=desknets.chooser.convertGroupItem(e);f.id=-Math.abs(Number(f.id));c.push(f)});return c};desknets.chooser.displayGroupTabItem=a.extend({},desknets.chooser.groupListTabItem,{rootClass:"co-sel-display-groups",_area:"3"});desknets.chooser.historyTabItem=a.extend({},desknets.chooser.tabItem,{rootClass:"co-sel-history"});desknets.chooser.historyTabItem._createSideMenu=function(c){var b=this;b._removeNonTargetListItem();b.$sideMenu.delegate("li","click",function(d){d.preventDefault();b._beginToGetFromHistory(a(this).closest("li"))});setTimeout(function(){var d=b.$sideMenu.find("li").eq(0);b._beginToGetFromHistory(d)},0)};desknets.chooser.historyTabItem._removeNonTargetListItem=function(){this._removeNonTargetElement(this.$sideMenu);if(this._options.chooseTarget.length<=1){this.$sideMenu.find("li").slice(1).remove()}};desknets.chooser.historyTabItem._beginToGetFromHistory=function(e){var c=this;var d=e.data("area");var b=!!d?[d]:c._options.chooseTarget;desknets.chooser.loadHistory(b,c._options,function(f){c.$itemList.dnChooserItemList("setItems",f)});e.siblings().removeClass("on");e.addClass("on")};a.widget("desknets.dnChooserItemList",{_TMPL:"com/chooser.itemList.",_$tbody:null,_itemHtml:null,_loaded:false,_pageNo:1,_totals:null,_sources:null,_selectedItems:null,options:{allGroup:null,chooseTarget:["user"],editDescendant:false,mode:"add",linkToChild:false,perPage:100,unassignGroup:null},_create:function(){var c=this;var b=c._TMPL+c.options.mode+".html";c.element.addClass("co-sel-chooser-items");if(c.options.editDescendant){c.element.addClass("co-sel-edit-descendant")}desknets.tmpl.load(c.element,b,function(){c._$tbody=c.element.find("tbody");c._itemHtml=c._$tbody.find("script").html();c._$tbody.empty();c._createEvents();c._setUpClasses();c._loaded=true;c._trigger("load")},{cache:true})},destroy:function(){this.element.find("thead .add-all").unbind("click");this._$tbody.undelegate(".add-item","click");this._$tbody.undelegate("tr.group .namelink","click");this.element.empty()},setItems:function(c){var b=this;if(!b._loaded){b.element.bind("dnchooseritemlistload",function(){b.setItems(c)});return}b._totals={};b._sources=null;this._$tbody.empty();a.each(c,function(d,e){b._addItemElement(e)});this._onReplaceList();this._trigger("sourceChange")},setDataSources:function(c){var b=this;if(!b._loaded){b.element.bind(this.widgetEventPrefix.toLowerCase()+"load",function(){b.setDataSources(c)});return}var d=neo.array.getKeyArray(c);var e=neo.array.getValueArray(c);b._getList(d,e,function(){b._totals={};b._sources=c;b._pageNo=1},function(){b._onReplaceList();b._trigger("sourceChange")})},setPage:function(b){b=this._coercePageNo(b);var k=this;var c=(b-1)*this.options.perPage;var e=c+this.options.perPage;var i=0,h=[],d=[];this._pageNo=b;for(var j in this._sources){var g=i+this._totals[j];if(i<e&&c<g){var f=a.extend({},this._sources[j]);f.row=Math.max(c-i,0);h.push(j);d.push(f)}i=g}this._getList(h,d,null,function(){k._onReplaceList()})},getTotalPage:function(){var b=0;if(this._sources==null){return this._$tbody.children().length>0?1:0}for(var c in this._totals){b+=this._totals[c]}return Math.ceil(b/this.options.perPage)},getSelected:function(){var b=null;if(this.options.mode=="radio"){b=this._$tbody.find("tr.co-tr-selected").data("item");b=!!b?b:null}return b},select:function(e,c){var d=e,b={};if(!a.isArray(e)){d=[{id:e,type:c}]}a.each(d,function(f,g){b[g.type+g.id]=true});this._selectedItems=b;if(this.options.mode=="radio"){this._updateRadio()}else{this._updateListItems()}},_createEvents:function(){var b=this;this.element.find("thead .add-all").click(function(c){c.preventDefault();b._onAddAllItems()});this._$tbody.on("dblclick","tr",function(c){c.preventDefault();var d=a(c.target).closest("a");if(d.css("cursor")!="pointer"){b._onClickRow(a(this))}});this._$tbody.delegate(".add-item","click",function(c){c.preventDefault();b._onAddItem(a(this).closest("tr"),"")});this._$tbody.delegate(".add-descendant","click",function(c){c.preventDefault();b._onAddItem(a(this).closest("tr"),"all")});this._$tbody.on("click","input:radio",function(d){var c=a(this).closest("tr").data("item");b.select([c])});this._$tbody.delegate("tr.group .namelink","click",function(d){d.preventDefault();if(!a(this).hasClass("notundermove")){var c=a(this).closest("tr").data("item");b._trigger("open",null,c)}})},_setUpClasses:function(){var b=this.element.find(".co-sel-table-list");var c=this.options.choosePrivateGroup;a.each(this.options.chooseTarget,function(d,e){b.addClass(e+"-choosable")});if(!!c&&c!="readonly"&&b.hasClass("group-choosable")){b.addClass("private-group-choosable")}},_getList:function(e,h,d,g){var b=this;var f=(h.length==1)?h[0]:h;var c=desknets.getUrl(this.options.module);desknets.chooser._ajaxRest(c,f,function(i){if(typeof d=="function"){d()}var j=!!i["0"]?i:{"0":i};b._$tbody.empty();b._processResponses(e,j);if(typeof g=="function"){g()}},b.options)},_processResponses:function(c,d){var b=this;var e=b.options.perPage;a.each(c,function(f,h){var g=d[f.toString()];e=b._processResponse(h,g,e)})},_processResponse:function(f,e,h){var c=this;var b=e.list.item;this._totals[f]=e.allcnt;for(var d=0;d<h&&d<b.length;d++){var g=c._convertJsonItem(b[d],f);if(!!g){c._addItemElement(g)}}return h-d},_addItemElement:function(g){var c=a("<tr />"),f=this._itemHtml;var b="name-text namelink";var e=g.type+" "+desknets.chooser._getSubType(g);var d=a.inArray("user",this.options.chooseTarget)>=0;var h="allDescendantsLabel";if(e.indexOf("private-group")>=0){h="privateGroupUsersLabel"}else{if(a.inArray("group",this.options.chooseTarget)<0){h="descendantUsersLabel"}}if(g.type=="user"){b+=" jco-ref-dialog-link"}if(!!g.admin){b+=" notundermove"}f=desknets.tmpl.replaceWord(f,"id",g.id);f=desknets.tmpl.replaceWord(f,"type",g.type);f=desknets.tmpl.replaceWord(f,"name",g.name);f=desknets.tmpl.replaceWordHtml(f,"description",g.description);f=desknets.tmpl.replaceWord(f,"descendantLabel",desknets.Resource.chooser[h]);f=desknets.tmpl.replaceWordHtml(f,"linkClasses",b);if(!!g.admin){if(g.admin=="0"){e+=" co-sel-notadmin"}}else{if(this.options.linkToChild&&g.type=="group"&&(!!g.hasChildren||d)){e+=" co-sel-has-children"}}c.attr("class",e);c.data("item",g).html(f).appendTo(this._$tbody);this._updateSpecialGroup(c,g)},_updateSpecialGroup:function(b,c){if(c.type=="group"){if(c.id=="all"&&this.options.allGroup=="readonly"){b.find(".co-sel-button").addClass("co-sel-readonly")}if(c.id=="0"&&this.options.unassignGroup=="readonly"){b.find(".co-sel-button").addClass("co-sel-disabled co-sel-readonly")}}},_onReplaceList:function(){var b=this._$tbody.closest(".co-sel-list-scroll");b.scrollTop(0);b.scrollLeft(0);if(!!this._selectedItems&&this.options.mode=="add"){this._updateListItems()}},_updateListItems:function(){var b=this;this._$tbody.children("tr").each(function(){var d=a(this);var c=d.data("item");if(!!c&&!!b._selectedItems[c.type+c.id]){d.addClass("co-tr-selected")}else{d.removeClass("co-tr-selected")}})},_updateRadio:function(){var c=this;var b=c._$tbody.children("tr").filter(function(){var d=a(this).data("item");return !!c._selectedItems[d.type+d.id]});b.siblings().removeClass("co-tr-selected");b.addClass("co-tr-selected");b.find("input:radio").attr("checked",true)},_onClickRow:function(c){var b=c.find("input:radio");var d=c.find("td.co-sel-button>*");if(b.length>0&&b.css("visibility")=="visible"){b.prop("checked",true).click()}if(d.css("visibility")=="visible"){this._onAddItem(c,"")}},_onAddAllItems:function(){var b=this,g=[],c=[];if(!this._sources||this.getTotalPage()<=1){this._triggerAdd(b._$tbody.children(),"")}else{var e=a.extend({},b.options,{allGroup:null});e.unassignGroup=e.unassignGroup=="choosable"?"choosable":null;for(var d in this._sources){if(a.inArray(d,this.options.chooseTarget)>=0){var f=a.extend({},this._sources[d],{row:0});if(typeof f.num!="undefined"){delete f.num}g.push(f);c.push(d)}}if(g.length>0){desknets.chooser._ajaxRest(desknets.getUrl(this.options.module),g,function(h){b._triggerAddByJson(h,c)},e)}}},_onAddItem:function(b,c){var d=b.data("item");var e=b.find("td.co-sel-button>*");if(c==""&&b.find(".co-sel-button").hasClass("co-sel-readonly")){this._triggerAddChildren(d.id,c)}else{if(c=="all"&&a.inArray("group",this.options.chooseTarget)<0){this._triggerAddChildren(d.id,c)}else{if(e.css("visibility")=="visible"){this._triggerAdd(b,c)}}}},_triggerAdd:function(e,d){var c=this,b=[];var f=this.element.find(".co-sel-table-list").hasClass("private-group-choosable");e.each(function(){var h=a(this);var g=h.data("item");if(h.find(".co-sel-button").hasClass("co-sel-readonly")){return}if(!g||a.inArray(g.type,c.options.chooseTarget)<0){return}if(g.type=="group"&&Number(g.id)<0&&!f){return}if(g.type=="group"&&h.hasClass("co-sel-notadmin")){return}if(c.options.editDescendant){g.descendant=d}b.push(g)});this._trigger("add",null,b)},_triggerAddChildren:function(e,d){var b=this;var c=desknets.getUrl(this.options.module);desknets.ajax.rest({url:c,data:{cmd:this.options.cmdusers,gid:e,descendant:d=="all"?"1":undefined},success:function(f){b._triggerAddByJson(f,["user"])}})},_triggerAddByJson:function(g,f){var e,d=[],c=this;var b=!!g["0"]?g:{"0":g};for(e=0;e<f.length&&!!b[e.toString()];e++){a.each(desknets.ajax.getJsonItems(b[e.toString()]),function(h,i){d.push(c._convertJsonItem(i,f[e]))})}c._trigger("add",null,d)},_convertJsonItem:function(e,c){var d={group:"convertGroupItem",role:"convertRoleItem",user:"convertUserItem"};var b=d[c];return !!b?desknets.chooser[b](e):null},_coercePageNo:function(b){b=Math.floor(b);return Math.min(Math.max(b,1),this.getTotalPage())}});a.widget("desknets.dnChooserChoosenList",{_TMPL:"com/chooser.choosenList.html",_$tbody:null,_initialized:false,_itemHtml:null,_choosenItems:null,_lockedItems:null,options:{editDescendant:false,choosenDnD:false,items:[],lockedItems:[]},_create:function(){var b=this;b.element.addClass("co-sel-choosen-items");if(b.options.editDescendant){b.element.addClass("co-sel-edit-descendant")}desknets.tmpl.load(b.element,b._TMPL,function(){b._$tbody=b.element.find("tbody");b._itemHtml=b._$tbody.children().html();b._createEvents();b._createLockedItems();if(b.options.editDescendant){b._createDescendantOptions()}b._setItems(b.options.items);b._initialized=true},{cache:true})},destroy:function(){this.element.find("thead .remove-all").unbind("click");this._$tbody.undelegate(".remove","click");this.element.empty()},items:function(b){if(a.isArray(b)){this._setItems(b);return this}else{return neo.array.getValueArray(this._choosenItems)}},add:function(b){if(!a.isArray(b)){b=[b]}this._addItems(b)},_createDescendantOptions:function(){var b=this.element.find("script.jco-sel-descendant-drop-down");if(a("#co-sel-descendant-options").length<=0){a(b.html()).appendTo("body")}b.remove()},_createEvents:function(){var b=this;this.element.find("thead .remove-all").click(function(c){c.preventDefault();b._removeAllItems()});this._$tbody.delegate(".remove-item","click",function(c){c.preventDefault();b._removeSelectedItem(a(this))});this._$tbody.delegate(".co-select-menu","change.selectMenu",function(c){b._updateDescendantState(a(this).closest("tr"))})},_createLockedItems:function(){var b=this;b._lockedItems={};a.each(this.options.lockedItems,function(c,d){b._lockedItems[d.type+"-"+d.id]=true})},_setItems:function(b){this._$tbody.empty();this._choosenItems={};this._addItems(b)},_addItems:function(c){var b=this;a.each(c,function(d,f){var e=f.type+"-"+f.id;b._filterItem(f);if(b._choosenItems[e]){b._updateItem(e,f)}else{b._addItem(e,f)}});b._onChangeItems()},_removeAllItems:function(){var b=this;b._$tbody.children().each(function(){b._removeItem(a(this))});b._selectedObjectRefresh();b._onChangeItems()},_removeSelectedItem:function(b){var c=this;c._removeItem(b.closest("tr"));c._selectedObjectRefresh();c._onChangeItems()},_selectedObjectRefresh:function(){var b=this;var c=a.extend({},b._choosenItems);b._choosenItems=c},_filterItem:function(b){if(this.options.editDescendant&&b.type=="group"&&Number(b.id)>0){b.descendant=(b.descendant=="all")?"all":""}else{b.descendant=undefined}},_onChangeItems:function(){var b=this;if(this._initialized){this._trigger("change")}if(!desknets.browser.tablet&&!!b.options.choosenDnD){b.element.find("table").tableDnD({onDragClass:"co-tr-selected",onDrop:function(d,e){var c=a(e);setTimeout(function(){b._$tbody.children().each(function(){if((a(this).data("id")==c.data("id"))&&(a(this).data("type")==c.data("type"))){b._resetChoosenItems();return false}})},1)}})}},_updateDescendantState:function(b){var c=b.data("type")+"-"+b.data("id");if(this._choosenItems[c]){this._choosenItems[c].descendant=b.find(".co-select-menu").data("value")}},_addItem:function(b,d){var e=desknets.chooser._getSubType(d);var c=a("<tr />");c.attr("class",d.type+" "+e).html(this._itemHtml);c.data("id",d.id).data("type",d.type).appendTo(this._$tbody);if(!!this._lockedItems[b]){c.addClass("locked")}this._updateItemElement(c,d);this._choosenItems[b]=d},_updateItem:function(b,d){var c=this._$tbody.children().filter(function(){var e=a(this);return e.data("id")==d.id&&e.data("type")==d.type});this._updateItemElement(c,d);this._choosenItems[b]=d},_removeItem:function(b){var c=b.data("type")+"-"+b.data("id");if(!this._lockedItems[c]){delete this._choosenItems[c];b.remove()}},_updateItemElement:function(b,e){var g=b.find(".co-sel-name");var f=g.children(".name-text");var d=b.find(".co-sel-description");var c=this._convertText(e.name);g.attr("title",c);f.text(c).data("refid",e.type+e.id);if(e.type=="user"){f.addClass("namelink jco-ref-dialog-link")}d.html(e.description);if(this.options.editDescendant&&b.hasClass("shared-group")){desknets.popUp.setSelectValue(b.find(".co-select-menu"),e.descendant||"")}},_resetChoosenItems:function(){var c=this;var d={};var b=c._choosenItems;c._$tbody.children().each(function(){var f=a(this);var e=f.data("type")+"-"+f.data("id");if(!!b[e]){d[e]=b[e]}});c._choosenItems=d},_convertText:function(b){return neo.isSet(b)?desknets.escapeSpace(String(b),true):""}});desknets.chooser.Entry=function(e,c,d){var b=this._defaultOptions.template;b=desknets.tmpl.replaceWordHtml(b,"L_Delete",desknets.Resource.deselectLabel);this._defaultOptions.template=b;this.init(e,c,d);return this};desknets.chooser.Entry.convertItem=function(b){for(var c=0;c<b.length;c++){var d=String(b[c].description);b[c].descriptionAsText=desknets.escapeValue(desknets.stripTags(d))}};desknets.chooser.Entry.sortLoginUserTop=function(b){var d=[];var e,c;e=desknets.pageframe.getLoginUid();for(c=0;c<b.length;c++){if(b[c]["type"]=="user"&&b[c]["id"]==e){d.push(b[c]);break}}if(c==b.length){return b}for(var c=0;c<b.length;c++){if(b[c]["type"]=="user"&&b[c]["id"]==e){continue}d.push(b[c])}return d};desknets.chooser.entry={_$root:a(),_$items:a(),_options:null,_items:null,_defaultOptions:{change:null,dialogOptions:{},dialogID:"co-sel-chooser-dialog",extraVars:{group:{keyName:"gid"},role:{keyName:"rid"},user:{keyName:"uid"}},filter:null,initCreate:true,template:'<span class="co-selitem"><span class="co-selitem-text" title="{{name}}">{{name}}</span><a href="#" class="co-btn co-btn-close" title="{{L_Delete}}">x</a><input type="hidden" name="{{keyName}}" value="{{id}}" /></span>'},_ChkValue:{id:"id",type:"type"},init:function(d,b,c){this._$root=d.addClass("co-sel-no-items");this._items=[];this._options=a.extend({},this._defaultOptions,c);this._$items=d.find(".jco-sel-items");this._initEvents(d.find(".jco-sel-btn"));if(this._options.initCreate){this.replaceItems(b)}this._updateElement()},destroy:function(){var b=a("#"+this._options.dialogID);if(b.length>0){desknets.chooser.destroyDialog(b)}this._$items.undelegate(".co-btn-close");this._$root.find(".jco-sel-btn").unbind("click")},getItems:function(){return this._items},replaceItems:function(b){if(this._isChanged(b)){this._$items.empty();this._addItemElements(b);this._items=b;this._updateElement(true)}},removeItems:function(e){var b={},d;e.each(function(){var f=a(this);d=f.data("type")+f.data("id");b[d]=true});for(var c=this._items.length-1;c>=0;c--){d=this._items[c].type+this._items[c].id;if(!!b[d]){this._items.splice(c,1)}}e.remove();this._updateElement(true)},_initEvents:function(c){var b=this;b._options.dialogOptions.choose=function(d){b._onChooseItem(d)};c.click(function(d){d.preventDefault();b._options.dialogOptions.items=b._items;desknets.chooser.open(b._options.dialogID,b._options.dialogOptions)});b._$items.delegate(".co-btn-close","click",function(d){d.preventDefault();b.removeItems(b._closestItem(a(this)))})},_isChanged:function(b){if(this._options.extraKeys){a.extend(this._ChkValue,this._options.extraKeys)}if(this._items.length!=b.length){return true}for(var c=0;c<b.length;c++){for(var d in this._ChkValue){if(this._items[c][d]!=b[c][d]){return true}}}return false},_onChooseItem:function(d){var c=this,b;if(typeof(c._options.filter)=="function"){b=c._options.filter(d,function(e){c.replaceItems(e)})}if(b!==false){c.replaceItems(d)}},_addItemElements:function(c){var b=this;a.each(c,function(e,f){var d=b._createItemElement(f);d.data("id",f.id).data("type",f.type);b._removeCloseButtonIfLocked(d,f);b._$items.append(d);d.on("mouseenter",function(g){var h=a(this);setTimeout(function(){h.addClass("hover")},0)});d.on("mouseleave",function(g){var h=a(this);setTimeout(function(){h.removeClass("hover")},0)})})},_createItemElement:function(e){var d=this._options.template;var b=a.extend({},e);b.iconType=desknets.chooser._getSubType(e);b.name=desknets.tmpl.escapeWord(b.name);if(!b.longName){b.longName=desknets.tmpl.escapeWord(desknets.chooser.getLongName(e))}if(typeof b.summary=="string"&&!b.summaryAsText){b.summaryAsText=desknets.escapeValue(desknets.stripTags(b.summary))}if(typeof b.description=="string"&&!b.descriptionAsText){b.descriptionAsText=desknets.escapeValue(desknets.stripTags(b.description))}if(!!this._options.extraVars[e.type]){a.extend(b,this._options.extraVars[e.type])}for(var c in b){d=desknets.tmpl.replaceWordHtml(d,c,b[c])}return a(d)},_updateElement:function(b){if(this._items.length>0){this._$root.removeClass("co-sel-no-items")}else{this._$root.addClass("co-sel-no-items")}if(!!b&&typeof(this._options.change)=="function"){this._options.change()}},_removeCloseButtonIfLocked:function(d,f){var c=this,e;var b=this._options.dialogOptions.lockedItems;if(a.isArray(b)){for(e=0;e<b.length;e++){if(b[e].id==f.id&&b[e].type==f.type){d.find(".co-btn-close").remove()}}}},_closestItem:function(b){if(this._$items.length>0){while(b.length>0&&!b.is("html")){var c=b.parent();if(c.length>0&&c[0]==this._$items[0]){return b}b=c}}return a()}};desknets.chooser.Entry.prototype=desknets.chooser.entry;desknets.chooser.assignedGroup={open:function(d,b){var c=a("#"+d);if(c.length>0&&c.closest(".ui-dialog").length>0){this._showCreatedDialog(c,b)}else{c.remove();c=a("<div />").attr("id",d).appendTo(document.body);this._setUpDialog(c,b)}return c},_setUpDialog:function(f,d){var b=this;var c=a("<div />").appendTo(f);var e=a.extend({title:""},d,{chooseTarget:["group"],mode:"multi",choosenListPlugIn:"dnChooserChoosenList"});c.bind("dnassignedgroupchooserload",function(g){desknets.dialog.setUp(f,b._getDialogOptions(e));b._showCreatedDialog(f,d)});c.dnAssignedGroupChooser(e)},_showCreatedDialog:function(c,b){desknets.pageframe.executeOnTipShown(function(){if(!!b&&!!b.items){c.children(".co-sel").dnAssignedGroupChooser("items",b.items)}c.dialog("open")})},_getDialogOptions:function(c){var b=this,d={};d[desknets.Resource.OKButtonLabel]=function(){b._onChooseItems(a(this),c)};d[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};return{buttons:d,dialogClass:"dn-dialog co-sel-dialog",title:c.title||desknets.Resource.selectLabel,width:700,close:function(){neo.ajax.abort("desknets-chooser",true)}}},_onChooseItems:function(c,b){var d=c.children(".co-sel");desknets.pageframe.executeOnTipShown(function(){if(typeof b.choose=="function"){var e=d.dnAssignedGroupChooser("items");b.choose(e)}c.dialog("close")})}};a.widget("desknets.dnAssignedGroupChooser",{_TMPL_FILENAME:"com/chooser.assignedGroup.html",_tabItem:null,options:{module:desknets.chooser.MODULE,cmdgroups:desknets.chooser.CMD_GROUPS},_create:function(){var b=this;b.element.addClass("co-sel co-sel-assigned-group");b.element.on("dnchooseritemlistload",function(){b._updateSelectedItems();b._trigger("load")});desknets.tmpl.load(b.element,b._TMPL_FILENAME,function(){b._createLayout(b.element.find(".co-sel-content"));b._createChoosenList(b.element.find(".co-sel-bottom"));b._createTab(b.element.find(".co-sel-content"))},{cache:true})},items:function(b){if(a.isArray(b)){if(this._$choosenList!=null){this._$choosenList.dnChooserChoosenList("items",b)}return this}else{if(this._$choosenList!=null){return this._$choosenList.dnChooserChoosenList("items")}else{return[]}}},_createLayout:function(b){b.layout({zIndex:0,size:220,minSize:80,maxSize:360,spacing_open:12,resizerTip:desknets.Resource.resizeHeightLabel,scrollToBookmarkOnLoad:false,closable:false})},_createChoosenList:function(d){var b=this;var c=a.extend({},b.options,{editDescendant:b.options.editDescendant,change:function(){b._updateSelectedItems()}});b._$choosenList=a("<div />").appendTo(d);b._$choosenList.dnChooserChoosenList(c)},_createTab:function(b){this._tabItem=a.extend({},desknets.chooser.assignedGroup.tabItem);this._tabItem.init(this.element,this.options);this._tabItem.show()},_updateSelectedItems:function(){if(!!this._$choosenList&&!!this._tabItem){var b=this._$choosenList.dnChooserChoosenList("items");this._tabItem.$itemList.dnChooserItemList("select",b)}}});desknets.chooser.assignedGroup.tabItem=a.extend({},desknets.chooser.groupListTabItem,{rootClass:"co-sel-assigned-groups",_area:"4"});desknets.chooser.grpUser={open:function(d,b){var c=a("#"+d);if(c.length>0&&c.closest(".ui-dialog").length>0){this._showCreatedDialog(c,b)}else{c.remove();c=a("<div />").attr("id",d).appendTo(document.body);this._setUpDialog(c,b)}return c},_setUpDialog:function(f,d){var b=this;var c=a("<div />").appendTo(f);var e=a.extend({title:""},d,{chooseTarget:["user"],mode:"multi",choosenListPlugIn:"dnChooserChoosenList"});c.bind("dngrpuserchooserload",function(g){desknets.dialog.setUp(f,b._getDialogOptions(e));b._showCreatedDialog(f,d)});c.dnGrpUserChooser(e)},_showCreatedDialog:function(c,b){desknets.pageframe.executeOnTipShown(function(){if(!!b&&!!b.items){c.children(".co-sel").dnGrpUserChooser("items",b.items)}c.dialog("open")})},_getDialogOptions:function(c){var b=this,d={};d[desknets.Resource.OKButtonLabel]=function(){b._onChooseItems(a(this),c)};d[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};return{buttons:d,dialogClass:"dn-dialog co-sel-dialog",title:c.title||desknets.Resource.selectLabel,width:700,close:function(){neo.ajax.abort("desknets-chooser",true)}}},_onChooseItems:function(c,b){var d=c.children(".co-sel");desknets.pageframe.executeOnTipShown(function(){if(typeof b.choose=="function"){var e=d.dnGrpUserChooser("items");b.choose(e)}c.dialog("close")})}};a.widget("desknets.dnGrpUserChooser",{_TMPL_FILENAME:"com/chooser.assignedGroup.html",_tabItem:null,options:{module:desknets.chooser.MODULE,cmdusers:desknets.chooser.CMD_USERS},_create:function(){var b=this;b.element.addClass("co-sel co-sel-group-user");b.element.on("dnchooseritemlistload",function(){b._updateSelectedItems();b._trigger("load")});desknets.tmpl.load(b.element,b._TMPL_FILENAME,function(){b._createLayout(b.element.find(".co-sel-content"));b._createChoosenList(b.element.find(".co-sel-bottom"));b._createTab(b.element.find(".co-sel-content"))},{cache:true})},items:function(b){if(a.isArray(b)){if(this._$choosenList!=null){this._$choosenList.dnChooserChoosenList("items",b)}return this}else{if(this._$choosenList!=null){return this._$choosenList.dnChooserChoosenList("items")}else{return[]}}},_createLayout:function(b){b.layout({zIndex:0,size:220,minSize:80,maxSize:360,spacing_open:12,resizerTip:desknets.Resource.resizeHeightLabel,scrollToBookmarkOnLoad:false,closable:false})},_createChoosenList:function(d){var b=this;var c=a.extend({},b.options,{change:function(){b._updateSelectedItems()}});b._$choosenList=a("<div />").appendTo(d);b._$choosenList.dnChooserChoosenList(c)},_createTab:function(b){this._tabItem=a.extend({},desknets.chooser.grpUser.tabItem);this._tabItem.init(this.element,this.options);this._tabItem.show()},_updateSelectedItems:function(){if(!!this._$choosenList&&!!this._tabItem){var b=this._$choosenList.dnChooserChoosenList("items");this._tabItem.$itemList.dnChooserItemList("select",b)}}});desknets.chooser.grpUserListTabItem=a.extend({},desknets.chooser.groupListTabItem,{});desknets.chooser.grpUserListTabItem._createSideMenu=function(c){var b=this;this._createList()};desknets.chooser.grpUserListTabItem._createList=function(){var b=this;var d={cmd:b._options.cmdusers,area:b._area,gid:b._options.gid};var c=desknets.getUrl(b._options.module);desknets.chooser._ajaxRest(c,d,function(f){var e=desknets.ajax.getJsonItems(f);b._groupItems=b._convertItems(e);b._createListElement();b._openRootGroup();b.created=true},b._options)};desknets.chooser.grpUserListTabItem._convertItems=function(b){var c=[];a.each(b,function(d,e){c.push(desknets.chooser.convertUserItem(e))});return c};desknets.chooser.grpUser.tabItem=a.extend({},desknets.chooser.grpUserListTabItem,{rootClass:"co-sel-group-users",_area:"4"});desknets.chooser.singleGroup={open:function(d,b){var c=a("#"+d);if(c.length>0){if(c.closest(".ui-dialog").length>0){c.dialog("open");if(!c.find(".co-sel-header").is(":visible")){c.find(".jstree").focus()}return c}c.remove()}c=a("<div />").attr("id",d).appendTo(document.body);this.setUpDialog(c,b);return c},destroy:function(d){var c=a("#"+d);var b=c.children(".co-sel-single-group");if(b.length>0){b.dnSingleGroupChooser("destory")}if(c.length>0){c.dialog("destory").remove()}},setUpDialog:function(f,d){var b=this;var e=a.extend({},d);var c=a("<div />").appendTo(f);e.choose=function(h,g){if(typeof d.choose=="function"){d.choose([g])}};c.bind("dnsinglegroupchooserload",function(g){desknets.dialog.setUp(f,b._getDialogOptions(d));f.dialog("open")});c.bind("dnsinglegroupchooserchoose",function(g){setTimeout(function(){f.dialog("close")},0)});c.dnSingleGroupChooser(e)},_getDialogOptions:function(c){var b=!!c.choosePrivateGroup?"singleGroupTitle_p":"singleGroupTitle";return{dialogClass:"dn-dialog co-sel-dialog",title:c.title||desknets.Resource.chooser[b],width:400,close:function(){neo.ajax.abort("desknets-chooser",true)}}}};a.widget("desknets.dnSingleGroupChooser",{_TMPL_FILENAME:"com/chooser.singleGroup.html",_TMPL_PGROUP:'<li data-id="{{id}}" class="co-sel-leaf private-group"><a href="#"><span class="co-gicon"></span>{{name}}</a></li>',_loaded:false,_tree:null,_$contents:a(),_$pgroups:a(),options:{choosePrivateGroup:false,allGroup:null,unassignGroup:null,defaultGroupId:0,selectedTabIndex:0,selectable:true,module:desknets.chooser.MODULE,cmdgroups:desknets.chooser.CMD_GROUPS,cmdgrouptree:desknets.chooser.CMD_GROUPTREE},_create:function(){var b=this;b.element.addClass("co-sel co-sel-single-group");if(!b.options.selectable){b.element.addClass("unselectable")}desknets.tmpl.load(b.element,b._TMPL_FILENAME,function(){b._createSharedGroup();if(!!b.options.choosePrivateGroup){b._createTabs()}},{cache:true})},destory:function(){var b=this.element.find(".co-sel-content > .co-sel-groups");if(b.length>0&&!!this._tree){this._tree.destroy(b)}this.element.find(".co-sel-tabs").undelegate("li","click");this.element.empty().removeClass("co-sel co-sel-single-group")},_createTabs:function(){var b=this;var d=b.element.find(".co-sel-tabs");var c=b.options.selectedTabIndex;b._$contents=b.element.find(".co-sel-content>*");b.element.find(".co-sel-header").show();d.delegate("li","click",function(e){e.preventDefault();b._selectTab(a(this))});if(c>0){b._selectTab(d.find("li").eq(c))}},_selectTab:function(d){var c=d.prevAll().length;var b=this._$contents.eq(c);d.siblings().removeClass("on");b.siblings().hide();d.addClass("on");b.show();if(this._$pgroups.length<=0&&c==1){this._createPrivateGroup()}},_createSharedGroup:function(){var c=this;var e=c.element.find(".co-sel-content > .co-sel-groups");var d=e.find(".co-listview-items");var b=this.options.treePageInstance||desknets.groupTree;c._tree=a.extend({},b);c._tree.options=a.extend({},c.options);c._tree.init(e,{idName:"data-id",isLag:false,showRoot:false,selFunc:function(f){if(!!c._loaded){c._trigger("choose",null,c._getItemByListItem(f))}}});d.bind("loaded.jstree",function(f){setTimeout(function(){c._loaded=true;c._trigger("load")},0)})},_getItemByListItem:function(b){return{id:b.data("id"),type:"group",name:desknets.tree.getItemTitle(b),description:this._getGroupPath(b)}},_getGroupPath:function(f){var e=f.parent().closest("li.co-listview-item");if(e.length<=0||e.children(".root-group").length>0){return""}else{var b=this._getGroupPath(e);var d=(b.length>0)?" - ":"";var c=desknets.tree.getItemTitle(e);return b+desknets.tmpl.escapeWord(d+c)}},_createPrivateGroup:function(){var b=this;var d={cmd:b.options.cmdgroups,area:"1"};var c=desknets.getUrl(b.options.module);desknets.chooser._ajaxRest(c,d,function(e){b._$pgroups=b.element.find(".co-sel-content > .co-sel-private-groups");b._createListItems(e);b._setUpPrivateGroupEvent()},b.options)},_createListItems:function(e){var f=[];var b=desknets.ajax.getJsonItems(e);for(var d=0;d<b.length;d++){var c=this._TMPL_PGROUP;c=desknets.tmpl.replaceWordHtml(c,"id",b[d].id);c=desknets.tmpl.replaceWord(c,"name",b[d].Name);f.push(c)}this._$pgroups.find("ul").html(f.join(""))},_setUpPrivateGroupEvent:function(){var b=this;b._$pgroups.delegate("a","click",function(d){d.preventDefault();var c=a(this);b._trigger("choose",null,{id:-Number(c.closest("li").data("id")),type:"group",name:c.text(),description:""})})}});desknets.chooser._displayFields={assign:0};desknets.chooser.setUserFieldsToShow=function(c){var d={};var b=String(c).split(",");a.each(b,function(f,h){var j=h.split(":");var e=j[0];var g=(b.length>1)?Number(j[1]):0;if(!!e&&(g>0||b.length==1)){d[e]=g}});this._displayFields=d};desknets.chooser.getItemsFromElement=function(e,d){var c=this,b=[];var f=a.extend({},d);var g="";if(f.excludeClass){g=f.excludeClass}e.find(".jco-sel-item").each(function(){var h=a(this),l={};if(g!=""){if(h.hasClass(g)){return true}}var j={id:h.data("id"),type:"user",name:h.data("name")||"",description:h.data("description")||"",summary:""};if(typeof j.id=="string"&&j.id.match(/^[a-z]/)){var i={g:"group",r:"role"};j.type=i[j.id.charAt(0)]||"user";j.id=j.id.substring(1)}if(j.type=="user"){if(!neo.isSet(j.description,{blank:false})){for(var k in c._displayFields){l[k]=h.data(k.toLowerCase())}j.description=c.convertUserDescription(l)}j.summary=h.data("assign")||""}else{j.description=desknets.tmpl.escapeWord(j.description);j.summary=j.description}if(typeof f.itemFilter=="function"){j=f.itemFilter(j,h)}b.push(j)});return b};desknets.chooser.convertGroupItem=function(c){var b={id:c.id,type:"group",name:c.Name,description:"",summary:"",hasChildren:false};if(!!c.parent){b.description=desknets.tmpl.escapeWord(c.parent)}b.summary=b.description;if(!!c.children){b.hasChildren=c.children>0}if(!!c.admin){b.admin=c.admin}return b};desknets.chooser.convertRoleItem=function(c){var b={id:c.id,type:"role",name:c.Name,description:"",hasChildren:false};if(!!c.memo){b.description=desknets.tmpl.escapeWord(c.memo)}b.summary=b.description;return b};desknets.chooser.convertUserItem=function(c){var b={id:c.id,type:"user",name:c.Name,description:this.convertUserDescription(c),summary:"",hasChildren:false};if(!!c.assigngrp&&!!c.assigngrp.Name){b.summary=this.convertAssignedGroups(c.assigngrp.Name)}return b};desknets.chooser.convertUserDescription=function(h){var e=[];for(var g in this._displayFields){var f=neo.isSet(h[g],{blank:false})?h[g]:"";var d=this._displayFields[g];var c='<span class="co-sel-user-field">{{value}}</span>';var b="_convertUserDescription_"+g;if(d>0){c='<span class="co-sel-user-field" style="width:{{width}}px" title="{{asText}}">{{value}}</span>';c=desknets.tmpl.replaceWordHtml(c,"width",String(d))}if(typeof this[b]=="function"){f=this[b](f,h);c=desknets.tmpl.replaceWordHtml(c,"value",f);c=desknets.tmpl.replaceWordHtml(c,"asText",desknets.escapeValue(desknets.stripTags(f)))}else{c=desknets.tmpl.replaceWord(c,"value",f);c=desknets.tmpl.replaceWord(c,"asText",f)}e.push(c)}return e.join("\n")};desknets.chooser.convertAssignedGroups=function(b){var c=desknets.user.getListAssignGroups(b);return c.assign};desknets.chooser.getLongName=function(b){if(b.type=="group"&&!!b.description){var c=a("<div/>").html(b.description).text();return String(c+"\u00A0-\u00A0"+b.name)}return String(b.name)};desknets.chooser._convertUserDescription_level=function(b,c){return desknets.Resource["userLevel_"+b]||""};desknets.chooser._convertUserDescription_assign=function(b,c){if(!b&&!!c.assigngrp&&!!c.assigngrp.Name){b=this.convertAssignedGroups(c.assigngrp.Name)}return b};desknets.chooser._convertUserDescription_gender=function(b,c){return desknets.Resource["userGender_"+b]||""};desknets.chooser._convertUserDescription_birthday=function(b,c){return !!b?desknets.dateTime.dispDateTime(b,"shortDateFormat"):""};desknets.chooser._MAX_HISTORY=20;desknets.chooser._histories={};desknets.chooser.loadHistory=function(e,d,g){var b=this;var f=[],c=[];a.each(e,function(h,j){var k={cmd:"constructcmd"+j+"historylist"};if(!!d.moduletype){k.module=d.moduletype}f.push(k);c.push(j);if(j=="group"&&d.choosePrivateGroup=="choosable"){f.push({cmd:"constructcmdpgrouphistorylist"});c.push("pgroup")}});desknets.chooser._ajaxRest(desknets.getUrl(desknets.chooser.MODULE),f,function(h){g(b._getHistoriesFromMultiJson(h,c,d))},d)};desknets.chooser.saveHistory=function(c){var f=this._filterHistory(c);var e={cmd:"constructcmdsavehistory"};for(var d=0;d<f.length;d++){var b=(d+1).toString();e["id"+b]=f[d].id;e["type"+b]=f[d].type;e["Name"+b]=f[d].name;e["memo"+b]=f[d].description;if(f[d].type=="user"){e["summary"+b]=f[d].summary}}desknets.ajax.rest({url:desknets.getUrl(desknets.chooser.MODULE),data:e})};desknets.chooser._getHistoriesFromMultiJson=function(m,k,n){var g=0,f=[],c=[],h=[];for(g=0;!!m[String(g)];g++){c.push(desknets.ajax.getJsonItems(m[String(g)]));h.push(0)}for(;;){var b="",e=-1,j=false;var d,l;a.each(c,function(i,o){var p=o[h[i]];if(!!p&&b<String(p.updtime)){e=i;b=String(p.updtime)}});if(e<0){break}d=c[e][h[e]];l=k[e];if(l=="role"){if(!!n.noAdministrators&&d.id==desknets.DBVAL_ADMINISTRATORS_ROLE_ID){j=true}else{if(!!n.noEveryone&&d.id==desknets.DBVAL_EVERYONE_ROLE_ID){j=true}}}if(!j){f.push({admin:!!d.admin?d.admin:null,id:l=="pgroup"?-d.id:d.id,type:l=="pgroup"?"group":l,name:d.Name,description:d.memo,summary:d.summary||d.memo})}h[e]++}return f};desknets.chooser._filterHistory=function(c){var b=this,d=[];var e={group:{num:0,id:{}},pgroup:{num:0,id:{}},role:{num:0,id:{}},user:{num:0,id:{}}};a.each(c,function(g,i){var h=Number(i.id)<0&&i.type=="group"?"pgroup":i.type;var f=e[h];if(i.type=="group"&&(i.id=="0"||i.id=="all")){return}if(!f||f.num>=b._MAX_HISTORY||!!f.id[i.id]){return}d.push({id:i.id,type:i.type,name:i.name,description:i.description,summary:i.summary});e[h].num++;e[h].id[i.id]=true});return d};(function(b){desknets.page(desknets,"tree",null,{$_root:null,$_tree:null,_defOptions:{idName:"id",selFunc:null,isLag:true,isOnAlready:false},_options:{},_firstTime:true,_timelag:true,_itemid:"",_isLag:true,_isOnAlready:false,_maxWidth:0,_objMove:{iTop:false,iLeft:false,treeOff:false,treeWidth:false,treeHeight:false},VAL_TREE_SHOWWIDTH:100,_tmplRoot:"",_tmplItem:"",TMPL_FOLDER_DUMY:'<li class="folder_dumy"></li>',init:function(f,d){var c=this;var e;c.$_root=f;c._options=b.extend({},c._defOptions,d);c._itemid=c._options.idName;e=c._getListParent();if(!neo.isSet(c.$_tree)){c.$_tree=e.find("."+c._getTreeItemName())}if(neo.isSet(c._options.isLag)&&c._options.isLag==false){c._isLag=false}c._create(e)},_getListParent:function(){if(neo.isSet(this.$_root)){return this.$_root.find(".co-listview-tree")}return b(".co-listview-tree")},_create:function(d){var c=this;var e=c.$_tree;d.hide();c._createSideMenu(e);c._createEventCommon(d);c._createEventOnItem(d)},_getTreeItemName:function(){return"co-listview-items"},_createSideMenu:function(d){var c=this;c._getSideTreeList(d);d.bind("open_node.jstree",function(e,g){var f=d.find("a.co-listview-item-inside");var h=g.rslt.obj;e.preventDefault();c._onOpenItem(d);b("li.co-listview-item").each(function(){var i=b(this);var j=i.children("ins");if(j.children("a").length==0&&i.hasClass("jstree-leaf")==false){j.append("<a href=#>&nbsp;</a>")}if(i.hasClass("jstree-leaf")){j.children("a").remove()}});setTimeout(function(){c._updateItemsWidth();c._updateScrollTopValue(h)},600);this._firstTime=false})},_getSideTreeList:function(d){var c=this;d.jstree({plugins:["html_data"]});d.bind("loaded.jstree",function(e,f){c._openNodeFirstTime(c._getListParent());c._selectFirstItem(d)})},_selectFirstItem:function(e){var c=this;var d;d=e.find("li.co-listview-item:not(.co-listview-tree-rootli-nosel)").eq(0);if(d.length==0){return}var f=d.attr(c._itemid);c.onSelectItemNoAjax(c._getListParent(),f);c._onSelectItem(null,d.children("a:first"))},_createEventCommon:function(d){var c=this;d.delegate(".co-listview-item>ins","click",function(e){c._createEventToggleIcon(e,b(this))});d.delegate(".co-listview-item>ins>a","click",function(e){e.preventDefault()})},_createEventOnItem:function(d){var c=this;var e="";var f;d.delegate("a.co-listview-item-inside","click",function(k){var g=b(this);var m=g.parent();var j=true;var h=desknets.TIME_GETLIST_LAG;if((c._firstTime==false&&g.hasClass("on")==true&&c._options.isOnAlready==false)||g.hasClass("co-tree-noselect")){k.preventDefault();return}else{if(k.isDefaultPrevented()==true){return}}k.preventDefault();if(neo.isSet(f)){clearTimeout(f)}d.find("a.co-listview-item-inside").removeClass("on");g.addClass("on");c._setButtonErea(g);if(c._timelag==false||c._isLag==false){c._selectItem(k,g)}else{var i=desknets.paramanalyzer.getHashParams();var l=b(".co-table-list");if(l.length>0){b('<div class="co-move-list-overlay" />').insertBefore(l)}f=setTimeout(function(){var n=desknets.paramanalyzer.getHashParams();if(e!=m.attr(c._itemid)){j=false}else{if(i.cmd!=n.cmd){j=false}}if(j==true&&c._timelag==true){c._selectItem(k,g)}},h)}e=m.attr(c._itemid);c._timelag=true})},_createEventToggleIcon:function(e,d){var c=this;e.preventDefault();if(d.parent().hasClass("jstree-closed")){setTimeout(function(){c._updateItemsWidth()},550)}},_selectItem:function(e,c){var d=this;c.attr("action","active");d._onSelectItem(e,c);d._updateItemsWidth();b(".co-move-list-overlay").remove()},_setButtonErea:function(c){},_onSelectItem:function(e,c){var d=this;if(d._options.selFunc&&b.isFunction(d._options.selFunc)){d._options.selFunc(c.parent())}},_updateItemsWidth:function(){var d=this;var e=d._getListParent();if(e.css("display")=="none"){return}var c=e.find("div.jstree");var h=0;b.each(c,function(j,k){h=h+b(this).height()});var g=e.closest("div.co-listview-left").width();if(h>e.height()){var f=desknets.listviewframe.getScrollBarWidth();g=g-f}c.css("min-width",g)},_updateScrollTopValue:function(g,k){var l=this;var m;if(!g||g.length==0){return}var e=desknets.listviewframe.getScrollBarWidth();if(e<=0&&!desknets.browser.tablet){return}if(neo.isSet(k)&&k.length>0){m=k}else{m=l._getListParent()}if(!m.hasClass("co-listview-tree")||m.css("display")=="none"){return}var d=g.offset();var c=m.offset();var i=m.height()-e;var h=d.top-c.top+g.height()-i;if(h>0){var j=m.scrollTop();if(g.height()>i){m.scrollTop(d.top-c.top+j)}else{m.scrollTop(h+j)}}else{if((d.top-c.top)<0){var f=m.children("div:first");if(f.length>0){m.scrollTop(d.top-f.offset().top)}}}h=d.left-c.left-m.width()-e+l.VAL_TREE_SHOWWIDTH;if(h>0){var j=m.scrollLeft();m.scrollLeft(j+h)}else{if(d.left<c.left){var f=m.children("div:first");m.scrollLeft(d.left-f.offset().left)}}},_onOpenItem:function(c){},_openNodeFirstTime:function(d){var c=this;this._firstTime=false;setTimeout(function(){c._getListParent().show();c._updateItemsWidth()},100)},_setUpScrollDraggable:function(d){var c=this;d.bind("mousemove.jstreeMove",function(h){if(b.vakata.dnd.is_drag&&c._objMove.treeOff!=false){var e=b(this);var g=c._objMove;var f=0;if(h.pageX+30>g.treeOff.left+g.treeWidth){if(g.iLeft){clearInterval(g.iLeft)}g.iLeft=setInterval(function(){f=e.scrollLeft();e.scrollLeft(f+b.vakata.dnd.scroll_spd)},100)}else{if(h.pageX-30<g.treeOff.left){if(g.iLeft){clearInterval(g.iLeft)}g.iLeft=setInterval(function(){f=e.scrollLeft();e.scrollLeft(f-b.vakata.dnd.scroll_spd)},100)}else{if(g.iLeft){clearInterval(g.iLeft)}}}if(h.pageY+30>g.treeOff.top+g.treeHeight){if(g.iTop){clearInterval(g.iTop)}g.iTop=setInterval(function(){f=e.scrollTop();e.scrollTop(f+b.vakata.dnd.scroll_spd)},100)}else{if(h.pageY-30<g.treeOff.top){if(g.iTop){clearInterval(g.iTop)}g.iTop=setInterval(function(){f=e.scrollTop();e.scrollTop(f-b.vakata.dnd.scroll_spd)},100)}else{if(g.iTop){clearInterval(g.iTop)}}}}});b("body").bind("mouseup.jstreeMove",function(f){var e=c._objMove;if(e.iLeft){clearInterval(e.iLeft)}if(e.iTop){clearInterval(e.iTop)}})},onSelectItemExternal:function(f,i,d,g){var e=this;var c=e.getItemObject_li(f,i,g);if(c.length==0){return}e._timelag=false;c.children("a:first").trigger("click");if(d==true){var h=b.jstree._reference(e.$_tree);h.open_node(c)}e._timelag=true},onSelectItemNoAjax:function(e,h,g){var d=this;var c=d.getItemObject_li(e,h,g);var f=c.children("a:first");if(f.hasClass("on")==false){e.find("a.co-listview-item-inside").removeClass("on");f.addClass("on")}d._updateScrollTopValue(c,e)},getItemObject_li:function(d,g,e){var c=this;var f=c._itemid;if(neo.isSet(e)&&neo.isSet(e.idName)){f=e.idName}return d.find("["+f+"="+g+"]").eq(0)},getItemTitle:function(d){var c="";if(neo.isSet(d)&&d.length>0){c=d.children("a:first").contents().filter(function(){return this.nodeType==3}).text()}return c},deleteDumyItem:function(e){var d=e.find("li.folder_dumy");if(d.length>0){var c=d.parent().parent();if(c.hasClass("jstree-closed")){c.removeClass("jstree-closed")}else{if(c.hasClass("jstree-open")){c.removeClass("jstree-open")}}c.addClass("jstree-leaf");d.parent().remove()}}})})(jQuery);(function(b){desknets.page(desknets,"folderlist",desknets.tree,{VAL_FOLDERLIST_MENUAD:35,_initfid:"",_backHtml:"",_rootHtml:"",_boUpdate:false,_dragpo:"",_defOptions:{itemArea:"co-listview-items",defArea:"co-listview-defitems",idName:"data-fid",fieldName:"folder",isEdit:true,isOnAlready:false,resetFunc:null},_cmds:{},_loadFunc:null,_creating:false,_$hoverItem:null,_objMove:{iTop:false,iLeft:false,treeOff:false,treeWidth:false,treeHeight:false},_dmyTreeClass:"jco-listview-tree-dmyitem",_tmplInitItem:'<li {{idName}}="{{id}}" class="co-listview-item"><a href="#" class="co-listview-item-inside {{MoveClass}}">{{Name}}</a>{{F_Ul}}</li>',_tmplFItem:'<li {{idName}}="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside {{MoveClass}} {{Drag}}">{{Name}}</a></li>',_tmpSetLink:'<span class="co-listview-item-setlink" ></span>',_tmpSetLinkTitle:'<span class="co-listview-item-setlink-title" title="{{F_Set}}">{{F_Set}}</span>',_tmpMenuAdd:'<div class="co-folder-setadd" title="{{menu_Add}}">{{menu_Add}}</div>',_tmpMenuMod:'<div class="co-folder-setmod" title="{{menu_Mod}}">{{menu_Mod}}</div>',_tmpMenuDel:'<div class="co-folder-setdel" title="{{menu_Del}}">{{menu_Del}}</div>',$_setlink:null,$_setMenu:b('<div class="co-listview-item-setmenu"></div>'),$_moveObj:null,$_dragli:null,init:function(h,e,c){var d=this;var i="";d.$_root=h;d._options=b.extend({},d._defOptions,e);d._cmds=b.extend({},c);var f=d._getListParent();d._itemid=d._options.idName;var g=f.find("."+d._getTreeItemName());d.$_tree=g;d._rootHtml=d.$_tree.html();if(neo.isSet(d._options.isLag)&&d._options.isLag==false){d._isLag=false}if(d._options.isEdit==true&&!desknets.browser.tablet){d._replaceAccMenu();d._createEventSetMenu(f);i="jstree-draggable jstree-drop jco-listview-draggable";d._createEventFolderMove(f)}d._tmplFItem=desknets.tmpl.replaceWordHtml(d._tmplFItem,"MoveClass",i);d._tmplInitItem=desknets.tmpl.replaceWordHtml(d._tmplInitItem,"MoveClass",i);d._tmplFItem=desknets.tmpl.replaceWordHtml(d._tmplFItem,"idName",d._itemid);d._tmplInitItem=desknets.tmpl.replaceWordHtml(d._tmplInitItem,"idName",d._itemid);d._tmplItem=d._tmplFItem;d._createDefaultTree(f);d._create(f);if(neo.isSet(d._options.initDialogFunc)&&b.isFunction(d._options.initDialogFunc)){e.initDialogFunc(d.$_root,d._options)}},_getTreeItemName:function(){return this._options.itemArea},_replaceAccMenu:function(){var c=this;c._tmpSetLinkTitle=desknets.tmpl.replaceWordHtml(c._tmpSetLinkTitle,"F_Set",desknets.Resource.folderlist.menuFolderSet);c._tmpMenuAdd=desknets.tmpl.replaceWordHtml(c._tmpMenuAdd,"menu_Add",desknets.Resource.folderlist.menuFolderAdd);c._tmpMenuMod=desknets.tmpl.replaceWordHtml(c._tmpMenuMod,"menu_Mod",desknets.Resource.folderlist.menuFolderMod);c._tmpMenuDel=desknets.tmpl.replaceWordHtml(c._tmpMenuDel,"menu_Del",desknets.Resource.folderlist.menuFolderDel);c.$_setlink=b(c._tmpSetLink);c.$_setlink.append(c._tmpSetLinkTitle)},_createEventSetMenu:function(e){var d=this;var c=d.$_setMenu;var f=d.$_tree;f.delegate("span.co-listview-item-setlink","click",function(g){var h=b(this);var j=e.offset();var o=h.offset();var n=h.parent();g.preventDefault();if(n.find("div.co-listview-item-setmenu>div").length==0){d._createFolderSetMenu(n)}h.append(c);var l=f.width();var i=e.width();var m=e.height();if(l>i){var k=desknets.listviewframe.getScrollBarWidth();m=m-k}if((o.top+c.height()+n.height()-j.top)>m-8){c.css("top",(c.outerHeight()*-1)-h.height()+5)}else{c.css("top",0)}c.toggle()});f.delegate("span.co-listview-item-setlink","mousedown mouseup",function(g){g.preventDefault()})},_createEventFolderMove:function(e){var d=this;var f=d.$_tree;var c=false;f.delegate("a.co-listview-item-inside","hover",function(h){if(b("#co-dragtip").length>0||b("#co-dragtip-ie8").length>0){return}if(b.vakata.dnd.is_drag){d._$hoverItem=b(this);if(!c){d.changeFolderMoveCss(true);c=true}return}d.changeFolderMoveCss(false);c=false;d._initEventHoverInside(h,b(this))});f.delegate("a.jco-listview-draggable","mousedown mouseup",function(i){var h=b(this);if(i.type=="mousedown"){b("body").focus();f.delegate("a.co-listview-item-inside","mousemove",function(k){if(b.vakata.dnd.is_drag){d.$_moveObj=h.parent();d.changeFolderMoveCss(true);d._backHtml=f.html();var j=desknets.listviewframe.getScrollBarWidth();d._objMove.treeOff=e.offset();d._objMove.treeWidth=e.width()-j;d._objMove.treeHeight=e.height()-j;f.undelegate("a.co-listview-item-inside","mousemove")}})}else{d.$_moveObj=null;f.undelegate("a.co-listview-item-inside","mousemove")}});f.delegate("li.co-listview-item","mouseup",function(h){return});var g=e.find("."+d._options.defArea);if(g.length>0){g.bind("mouseenter.jstree",function(h,i){if(b.vakata.dnd.is_drag&&b.vakata.dnd.user_data.jstree){if(b.vakata.dnd.helper.children("ins").hasClass("jstree-ok")){b.vakata.dnd.helper.children("ins").attr("class","jstree-invalid")}}b("#jstree-marker").hide();b("#jstree-marker-line").hide()})}b(document).on("mouseup.jstreeline","#jstree-marker-line",function(i){var h=b.jstree._reference(f);if(b.vakata.dnd.is_drag&&b.vakata.dnd.user_data.jstree&&neo.isSet(d._$hoverItem)){d._dragpo=h.dnd_show();h.get_settings().dnd.drop_finish.call(f,{r:d._$hoverItem});h.dnd_finish(i);d._$hoverItem=null}});d._setUpScrollDraggable(e);b("body").bind("mouseup",function(h){d.changeFolderMoveCss(false)})},changeFolderMoveCss:function(e){var c=this;var d=c._getListParent();if(e){setTimeout(function(){d.find("a.co-listview-item-inside").addClass("stdrag")},100);d.css("background","#f5faff");c._hideFolderSetMenu()}else{setTimeout(function(){d.find("a.co-listview-item-inside").removeClass("stdrag");d.find("a.co-listview-item-inside").removeClass("co-tree-noselect")},100);d.css("background","#ffffff")}},_initEventHoverInside:function(f,c){var d=this;var e=d._getListParent();var h=c.closest("li");var g=h.attr(d._itemid);if(c.hasClass("jco-tree-nomenu")){return}if(f.type=="mouseenter"){d._showFolderMenuIcon(c)}else{d._hideFolderSetMenu()}},_createEventToggleIcon:function(e,d){var c=this;e.preventDefault();c.callBase("_createEventToggleIcon",e,d);setTimeout(function(){var f=d.closest("li").find(".co-listview-item-setlink");if(f.length>0){c._showFolderMenuIcon(f.closest("a.co-listview-item-inside"),true)}},550)},_showFolderMenuIcon:function(e,o){var n=this;var q=n._getListParent();var l=e.parent();var k=n.$_setlink;var c=n.VAL_FOLDERLIST_MENUAD;if(!neo.isSet(o)||o==false){e.append(k)}var p=q.children(":not(.co-listview-overlay)");var g=0;var j=p.eq(0).width();b.each(p,function(r,s){g=g+b(this).height()});var d=q.width()-(l.offset().left-q.offset().left)-k.width();var m=q.height();var i=desknets.listviewframe.getScrollBarWidth();if(g>m||(j-q.width()>0&&g+i>m)){d=d-i}k.css({left:d});k.show();if(e.offset().left+c>k.offset().left){var h=q.scrollLeft();var f=0;q.scrollLeft(q.scrollLeft()+c);f=q.scrollLeft();d=d+(f-h);k.css({left:d})}n.$_setMenu.hide()},_createFolderSetMenu:function(c){var e=this;var d=e.$_setMenu;d.empty();d.prepend(b(e._tmpMenuDel));d.prepend(b(e._tmpMenuMod));d.prepend(b(e._tmpMenuAdd))},_hideFolderSetMenu:function(){var c=this;if(c.$_setlink!=null){c.$_setMenu.hide();c.$_setlink.hide();c.$_setMenu.remove();c.$_setlink.remove()}},getInputFieldName:function(){return this._options.fieldName},_getSideTreeList:function(d){var c=this;c._getFirstTreeData(d)},_getFirstTreeData:function(d){var c=this;var f=c.getInputFieldName();var e=desknets.paramanalyzer.getHashParams();if(neo.isSet(e)&&e[f]){c._initfid=e[f]}else{if((typeof jsonRestFolder)!="undefined"&&c._boUpdate==false){c._createInitTree(jsonRestFolder);return}}if(!c._isGetFirstTreeAjax()){c._createInitTree({});d.addClass(c._dmyTreeClass);return}c._getFirstTreeAjax()},_isGetFirstTreeAjax:function(){var c=desknets.paramanalyzer.getHashParams();return(b.isEmptyObject(c)||!neo.isSet(c.cmd)||b("#jco-pv-funcid").val()==c.cmd)},_getFirstTreeAjax:function(){var c=this;var d=desknets.getUrl(c._getRestModule());desknets.ajax.rest({url:d,data:c._getRequestFirstParams(),success:function(f,e,g){c._createInitTree(f)}})},_getRequestFirstParams:function(){var c=this;var e=c._initfid;var d={cmd:this._getFolderListCmd()};if(e.length>0){d.folder=e}return d},_getRequestParams:function(e){var c=this;var d=e.attr(c._itemid);return{cmd:this._getFolderListChildCmd(),pfolder:d}},_createInitTree:function(e){var c=this;var h;var d=c._getListParent();var g=c.$_tree;h=c._getHtmlFromJson(e);g.empty();if(neo.isSet(c._rootHtml)&&b(c._rootHtml).find("li").length>0){var f=b("<div />");f.append(c._rootHtml);f.find("li").append("<ul>"+h+"</ul>");h=f.html()}g.append(h);c._createSideTree()},_getHtmlFromJson:function(g){var e=this,f=[],d;if(!g.list||!g.list.item){if(g.status){var c=g.status;if(c=="ok"){return'<li class="folder_dumy"></li>'}}return""}if(e._firstTime==true||neo.isSet(g.folder)){if((!neo.isSet(e._initfid)||e._initfid.length==0)){e._initfid=g.folder}e._getHtmlFromJsonFolder(g.list.item,f)}else{d=b.isArray(g.list.item)?g.list.item:[g.list.item];e._getHtmlFromJsonFolderChild(d,f)}return f.join("")},_getHtmlFromJsonFolder:function(c,f){var e=this;var d=[];if(c.length>1){d=c}else{d=[c]}b.each(d,function(h,j){var k=e._tmplInitItem;k=e._getItemHtml(k,j);if(j.list){var g=[];e._getHtmlFromJsonFolderList(j.list,g);k=desknets.tmpl.replaceWordHtml(k,"F_Ul",g.join(""));f.push(k)}else{k=desknets.tmpl.replaceWordHtml(k,"F_Ul","");f.push(k)}})},_getHtmlFromJsonFolderList:function(d,f){var c=this;var e=c._tmplInitItem;f.push("<ul>");c._getHtmlFromJsonFolder(d.item,f);f.push("</ul>")},_getHtmlFromJsonFolderChild:function(d,e){var c=this;var f=b.vakata.dnd.is_drag;b.each(d,function(g,h){var k=desknets.tmpl.escapeWord(h.Name);var j=c._tmplItem;j=c._getItemHtml(j,h);j=desknets.tmpl.replaceWordHtml(j,"Drag",f?"stdrag":"");e.push(j)})},_getItemHtml:function(e,d){var c=this;var f=desknets.tmpl.escapeWord(d.Name);e=desknets.tmpl.replaceWordHtml(e,"id",d.id);e=desknets.tmpl.replaceWordHtml(e,"Name",f);e=desknets.tmpl.replaceWordHtml(e,"state",d.list?"closed":"leaf");return e},_setFolderOpen:function(){var d=this;var h=d._initfid;var g=d.$_tree;var c;var f;if(!g||g.length==0){return}d._setFolderOpenRoot(h);c=g.find("li.jstree-closed").filter(function(){var j=b(this);return j.attr(d._itemid)>0});c.find("ul").remove();var i=d.getItemObject_li(d.$_root,h);if(!neo.isSet(i)||i.length==0){f=g.find("li.co-listview-item:not(.co-listview-tree-rootli-nosel)").eq(0);if(f.length==0||h>0){var e=d.$_root.find(".co-listview-left-subtitle");if(e.length>0){d._setButtonDisable(e,true)}return}i=f;h=f.attr(d._itemid)}d._setButtonErea(i.find(".co-listview-item-inside").eq(0))},_setFolderOpenRoot:function(g){var d=this;var e=d.$_tree;var f;var c;var h=e.find("li.co-listview-item");h.each(function(k,l){var j=b(this);if(j.attr(d._itemid)==g){if(g>0){f=j.parent().parent()}else{f=j}return false}});if(f){c=f.attr(d._itemid)}if(!neo.isSet(c)){return}f.removeClass("jstree-closed");f.addClass("jstree-open");if(c<=0){return}return d._setFolderOpenRoot(c)},_createSideTree:function(){var c=this;var d;var e=c.$_tree;var f=e.html();if(!neo.isSet(f,{blank:false})){f="<li/>"}c._creating=true;d=desknets.getUrl(c._getRestModule());e.jstree({plugins:c._getFolderTreePlugins(),crrm:c._getFolderTreeCrrm(),dnd:{drop_finish:function(g){if(c.$_dragli!=null){c._inputMoveConfSubmit(c.$_dragli,g.r.closest("li"),c._dragpo)}else{c._moveRollbackHtml()}c.$_dragli=null;c._dragpo=""},open_timeout:1000,copy_modifier:""},html_data:{data:f,ajax:{type:"GET",dataType:"json",url:d,data:function(h){var g=c._getRequestParams(h);desknets.ajax.addParamForCsrf(g);desknets.ajax.addParamForNoCache(g);return g},success:function(g){if(!g||g.status=="ng"){desknets.ajax.onError(g.errorno,g.errormessage);return'<li class="folder_dumy"></li>'}return c._getHtmlFromJson(g)},error:function(i,g,h){desknets.ajax.onError(i.status,neo.ajax.getErrorMessage(i))}}}});e.bind("loaded.jstree",function(h,i){var g=c._options.resetFunc;c._setFolderOpen();c._openNodeFirstTime(c._getListParent());if(neo.isSet(c._loadFunc)&&b.isFunction(c._loadFunc)){setTimeout(function(){c._loadFunc();c._loadFunc=null},500)}if(c._boUpdate==true&&neo.isSet(g)&&b.isFunction(g)){setTimeout(function(){var j=c._searchOnItem();if(neo.isSet(j)&&j.length>0){g(j)}},500)}c._boUpdate=false;c._creating=false})},_searchOnItem:function(g){var d=this;var c=null;var f;if(neo.isSet(g)&&g.length>0){f=g}else{f=d.$_root}var e=f.find("li");b.each(e,function(h,j){if(b(j).children("a.co-listview-item-inside").hasClass("on")){c=b(j);return false}});return c},_getFolderTreePlugins:function(){var c=this;if(c._options.isEdit==true){return["html_data","dnd","crrm"]}return["html_data"]},_getFolderTreeCrrm:function(){var c=this;return{move:{check_move:function(d){if(d.o==-1||d.r==-1){return false}if(!d.r.children("a:first").hasClass("stdrag")){return false}if(d.o.attr(c._itemid)<=0||(d.r.attr(c._itemid)<=0)){return false}if(c.$_dragli==null||c._dragpo!="inside"){if(c.$_moveObj==null){c.$_dragli=d.o}else{c.$_dragli=c.$_moveObj}}c._dragpo=d.p;return true}}}},_openNodeFirstTime:function(e){var c=this;var d=c._initfid;var f=c.getItemObject_li(e,d);c._delRootFolderAct(e);c.onSelectItemNoAjax(e,d);if(!neo.isSet(c._loadFunc)){c._onSelectItem(null,f.children("a:first"))}c.callBase("_openNodeFirstTime",e);c._deleteDumyItem(e);setTimeout(function(){c._updateScrollTopValue(f)},100)},_onOpenItem:function(d){var c=this;c.callBase("_onOpenItem",d);c._deleteDumyItem(d)},_deleteDumyItem:function(e){var d=e.find("li.folder_dumy");if(d.length>0){var c=d.parent().parent();if(c.hasClass("jstree-closed")){c.removeClass("jstree-closed")}else{if(c.hasClass("jstree-open")){c.removeClass("jstree-open")}}c.addClass("jstree-leaf");d.parent().remove()}},_delRootFolderAct:function(d){var c=d.find(".co-listview-tree-rootli-nosel");if(c.length==0){return}c.removeClass("jstree-last");c.removeClass("jstree-open");c.removeClass("jstree-closed")},_setButtonErea:function(c){var d=this;var e=d.$_root.find(".co-listview-left-subtitle");if(!neo.isSet(e)){return}if(c.hasClass("co-listview-tree-rootli-nosel")||c.hasClass("jco-tree-nomenu")||c.closest("div").hasClass("co-listview-defitems")){d._setButtonDisable(e,true);return}d._setButtonDisable(e,false)},_setButtonDisable:function(d,f){var c=":button:not(.jco-litview-item-add)";if(this.$_root.find(".jco-tree-notcreate-root").length>0){c=":button"}var e=d.find(c);e.attr("disabled",f)},_createDefaultTree:function(d){var c=this;var e=d.find("."+c._options.defArea);if(!neo.isSet(e)||e.find("ul").length==0){return}e.jstree({plugins:["html_data"]});e.bind("open_node.jstree",function(f,h){var g=e.find("a.co-listview-item-inside");var i=h.rslt.obj;f.preventDefault();setTimeout(function(){c._updateItemsWidth();c._updateScrollTopValue(i)},500)})},_inputMoveConfSubmit:function(h,g,d){var e=this;var f=e._getListParent();var j=e._moveConfMessage(h);var i={cancel:function(){e._moveRollbackHtml();e._updateItemsWidth()}};var c=desknets.dialog.confirm(j,function(){desknets.submitform.setDialogDisabled(c);e._dropFinishAjax(c,h,g,d);return false},i)},_moveConfMessage:function(d){var c=desknets.Resource.Message.com_folder_move;return desknets.tmpl.replaceWord(c,"FolderName",this.getItemTitle(d))},_moveRollbackHtml:function(){var c=this;var d=c.$_tree;if(c._backHtml.length>0){d.html(c._backHtml)}},_dropFinishAjax:function(d,i,h,c){var e=this;var f;var g=e._getListParent();f=desknets.getUrl(e._getRestModule());desknets.ajax.rest({url:f,data:e._getRequestMoveParams(i,h,c),success:function(){e._backHtml=""},error:function(k,j,l){desknets.ajax.onError(k.status,l);e._moveRollbackHtml()},complete:function(){desknets.submitform.clearDialogDisabled(d);e._updateItemsWidth();d.dialog("close")}})},_getRequestMoveParams:function(h,f,c){var e=this;var g;var i={};if(c=="last"){return{cmd:e._getRequestMoveParentCmd(),id:h.attr(e._itemid),pfolder:f.attr(e._itemid)}}else{var d;if(c=="before"){d="+"}else{d="-"}return{cmd:e._getRequestMoveCmd(),id:h.attr(e._itemid),folder:f.attr(e._itemid),proc:d}}},_getRestModule:function(){return this._cmds.restAPI},_getFolderListCmd:function(){return this._cmds.listCMD},_getFolderListChildCmd:function(){return this._cmds.listchildCMD},_getRequestMoveParentCmd:function(){return this._cmds.moveparentCMD},_getRequestMoveCmd:function(){return this._cmds.movebetweenCMD},updateTreeList:function(c){var d=this;var e=d._getListParent();var f=b.jstree._reference(d.$_tree);if(d._creating==true||b.isEmptyObject(f)){return}d._firstTime=true;d._boUpdate=true;if(neo.isSet(c)&&b.isFunction(c)){d._loadFunc=c}e.hide();f.destroy();d._createSideMenu(d.$_tree);d.$_tree.removeClass(d._dmyTreeClass)},copyTree:function(f,c,e){var d=this._options;if(f.find("."+d.itemArea).length>0){c.find("."+d.itemArea).html(f.find("."+d.itemArea).html())}if(neo.isSet(e)&&!!e&&f.find("."+d.defArea).length>0){c.find("."+d.defArea).html(f.find("."+d.defArea).html())}},makeMoveMessage:function(f){var d="";var e='<table><tbody><tr><th class="co-eth"><span class="co-colon">{{move}}</span></th><td class="co-etd co-tleft">{{fname}}</td></tr></tbody></table>';var c=desknets.Resource;d=desknets.tmpl.replaceWordHtml(e,"move",c.folderlist.moveDest);d=desknets.tmpl.replaceWord(d,"fname",f);return d}})})(jQuery);(function(b){desknets.page(desknets,"folderlist_access",desknets.folderlist,{_tmpMenuAcc:'<hr class="dotted" /><div class="co-folder-setacc" title="{{menu_Acc}}">{{menu_Acc}}</div>',_tmplInitItem:'<li {{idName}}="{{id}}" class="co-listview-item"><a href="#" class="co-listview-item-inside {{MoveClass}}" {{accs}}>{{Name}}</a>{{F_Ul}}</li>',_tmplFItem:'<li {{idName}}="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside {{MoveClass}} {{Drag}}" {{accs}}>{{Name}}</a></li>',_isSetAccess:function(){var c=this;if(neo.isSet(c._options.isSetAccess)){return c._options.isSetAccess}return true},_isCtrlAccess:function(){var c=this;if(neo.isSet(c._options.isCtrlAccess)){return c._options.isCtrlAccess}return false},_isHasAccess:function(f,e,d){var c=this;if(!c._isCtrlAccess()){return true}if(neo.isSet(d)&&d==true){if(Number(f)>=Number(e)){return true}}else{if((Number(f)&Number(e))==Number(e)){return true}}return false},_replaceAccMenu:function(){var c=this;c._tmpMenuAcc=desknets.tmpl.replaceWordHtml(c._tmpMenuAcc,"menu_Acc",desknets.Resource.folderlist.menuFolderAcc);c.callBase("_replaceAccMenu")},_initEventHoverInside:function(g,d){var e=this;var f=e._getListParent();var i=d.closest("li");var h=i.attr(e._itemid);if(d.hasClass("jco-tree-nomenu")){return}if(g.type=="mouseenter"){var c=d.data("access");if(e._isHasAccess(c,2,true)){e._showFolderMenuIcon(d)}}else{e._hideFolderSetMenu()}},_createFolderSetMenu:function(d){var f=this;var e=f.$_setMenu;var c=d.data("access");e.empty();if(f._isSetAccess()&&f._isHasAccess(c,4)){e.prepend(b(f._tmpMenuAcc))}if(f._isHasAccess(c,8)){e.prepend(b(f._tmpMenuDel))}if(f._isHasAccess(c,4)){e.prepend(b(f._tmpMenuMod))}if(f._isHasAccess(c,2)){e.prepend(b(f._tmpMenuAdd))}},_getHtmlFromJson:function(d){var c=this;if(neo.isSet(d.access)&&d.access=="0"){c._options.isSetAccess=false}return c.callBase("_getHtmlFromJson",d)},_getItemHtml:function(e,d){var c=this;var f=desknets.tmpl.escapeWord(d.Name);e=desknets.tmpl.replaceWordHtml(e,"id",d.id);e=desknets.tmpl.replaceWordHtml(e,"Name",f);e=desknets.tmpl.replaceWordHtml(e,"accs",d.accesskind?"data-access="+d.accesskind:"");e=desknets.tmpl.replaceWordHtml(e,"state",d.list?"closed":"leaf");return e},_getFolderTreeCrrm:function(){var c=this;return{move:{check_move:function(d){if(d.o==-1||d.r==-1){return false}if(!d.r.children("a:first").hasClass("stdrag")){return false}if(d.o.attr(c._itemid)<=0||(d.r.attr(c._itemid)<=0)){return false}if(!c._isHasAccess(d.o.children("a:first").data("access"),4)){return false}if(!c._isHasAccess(d.np.children("a:first").data("access"),2)){return false}if(c.$_dragli==null||c._dragpo!="inside"){if(c.$_moveObj==null){c.$_dragli=d.o}else{c.$_dragli=c.$_moveObj}}c._dragpo=d.p;return true}}}},_setButtonErea:function(e){var g=this;var h=b(".co-listview-left-subtitle");var f=h.find(".jco-litview-item-accs");if(!g._isCtrlAccess()){return g.callBase("_setButtonErea",e)}var d=e.data("access");var c=g._isHasAccess(d,8);h.find(".jco-litview-item-del").attr("disabled",!c);c=g._isHasAccess(d,4);if(neo.isSet(f)){f.attr("disabled",!c)}h.find(".jco-litview-item-mod").attr("disabled",!c);c=(g._isHasAccess(d,2)||g._getListParent().find(".jco-tree-notcreate-root").length==0);h.find(".jco-litview-item-add").attr("disabled",!c)}})})(jQuery);(function(b){desknets.page(desknets.folderlist,"dialog",null,{_poptitle:"",_folderid:"",_options:{},$_element:null,$_btnErea:null,init:function(f,d){var c=this;if(neo.isSet(f)){c.$_element=f.find(".co-listview-tree")}else{c.$_element=b(".co-listview-tree")}b.extend(c._options,desknets.folderlist._defOptions,d);var e=b(".co-listview-left-subtitle");if(neo.isSet(e)){c.$_btnErea=e;c._setButtonErea()}},_setButtonErea:function(){},_searchOnItem:function(){var d=this;var c=null;var e=d.$_element.find("li");b.each(e,function(f,g){if(b(g).children("a.co-listview-item-inside").hasClass("on")){c=b(g);return false}});return c},inputButton:function(e){var d=this;var c=e.parent().closest("li");var f;f=d._get_folderid(c);d._folderid=f;d._poptitle=e.text();d._setMenuhide(d.$_element)},_setMenuhide:function(e){var d=e.find("div.co-listview-item-setmenu");var c=e.find("span.co-listview-item-setlink");d.hide();c.hide();c.remove();d.remove()},_delRootFolderAct:function(d){var c=d.find(".co-listview-tree-rootli-nosel");if(c.length==0){return}c.removeClass("jstree-last");c.removeClass("jstree-open");c.removeClass("jstree-closed")},_get_folderid:function(e){var c=this;var d;d=e.attr(c._options.idName);if(d&&d>0){return d}return"0"},_getRestModule:function(){return""},selectFolderOnDialog:function(f,c){var d=this;if(neo.isSet(c)&&c==true){var e=d._get_folderid(f);desknets.folderlist.onSelectItemNoAjax(d.$_element,e,d._options)}else{f.children("a:first").trigger("click")}}})})(jQuery);desknets.page(desknets,"groupTree",desknets.tree,{TMPL_ROOT_START:'<ul><li data-id="" class="jstree-open co-listview-item"><a href="#" class="co-listview-item-inside root-group">{{name}}</a>',TMPL_START:"<ul>",TMPL_ITEM:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside {{classes}} {{subType}}">{{name}}</a>',TMPL_ITEM_NOLINK:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item nolink"><a class="co-listview-item-inside-nolink {{adminunserclasse}} {{classes}} {{subType}}">{{name}}</a>',TMPL_ITEM_END:"</li>",TMPL_END:"</ul>",TMPL_ROOT_END:"</li></ul>",options:{},destroy:function(){if(!!this.$_tree&&this.$_tree.length>0){this.$_tree.unbind("loaded.jstree");this.$_tree.jstree("destroy")}},resize:function(){this._updateItemsWidth()},selectParent:function(){var b=this._getSelectedItem();b=b.parent().closest("li");if(b.length>0){b.children("a:first").trigger("click")}},selectItemById:function(c){var b=this.getItemObject_li(this.$_tree,c,this._options);b.children("a:first").trigger("click")},openItemById:function(c){var b=this.getItemObject_li(this.$_tree,c,this._options);if(b.length>0){this.$_tree.jstree("open_node",b)}},loadTree:function(e){var b=this;var d={cmd:this.options.cmdgrouptree,gid:this.options.defaultGroupId};if(!!this.options.moduletype){d.module=this.options.moduletype}var c=desknets.getUrl(this.options.module);desknets.chooser._ajaxRest(c,d,function(f){b._createTree(e,b._getFirstHtmlFromJson(f))},this.options)},getRequestParams:function(c){var b={cmd:this.options.cmdgroups,pgid:c.data("id"),area:"2"};if(!!this.options.moduletype){b.module=this.options.moduletype}desknets.ajax.addParamForCsrf(b);desknets.ajax.addParamForNoCache(b);return b},getHtmlFromJson:function(e){var c=this;var d=[];var b=desknets.ajax.getJsonItems(e);if(b.length<=0){return""}d.push(c.TMPL_START);a.each(b,function(f,g){var j=c._getItemHtmlFromItemData(g);var h="";if(Number(g.children)>0){h=c.getHtmlFromJson(g)}d.push(j+h+c.TMPL_ITEM_END)});d.push(c.TMPL_END);return d.join("")},_getSideTreeList:function(c){var b=this;b.loadTree(c)},_selectOnLoaded:function(b){var d=this.options.defaultGroupId||"";var c=this.getItemObject_li(b,d,this._options);if(this._options.defaultSelectionRel=="parent"){c=c.parent().closest("li")}if(c.length<=0){c=b.find("li").eq(0)}c.children("a:first").trigger("click")},_createTree:function(e,d){var b=this;var c=desknets.getUrl(this.options.module);if(!d){desknets.dialog.alert(desknets.Resource.Message.com_chooser_no_groups);return}e.bind("loaded.jstree",function(f,g){b._selectOnLoaded(e);setTimeout(function(){e.closest(".co-listview-tree").show();b._updateItemsWidth()},1)});e.on("open_node.jstree",function(f,g){desknets.tree.deleteDumyItem(a(this))});e.jstree({plugins:["html_data"],html_data:{data:d,ajax:{type:"GET",dataType:"json",url:c,data:function(f){return b.getRequestParams(f)},success:function(f){if(!f||f.status=="ng"){desknets.ajax.onError(f.errorno,f.errormessage)}return b.getHtmlFromJson(f)||b.TMPL_FOLDER_DUMY},error:function(h,f,g){desknets.ajax.onError(h.status,neo.ajax.getErrorMessage(h))}}}});b.resize()},_getFirstHtmlFromJson:function(d){var c=this._getRootItemName();var e=this.getHtmlFromJson(d);if(this._options.showRoot){var b=this.TMPL_ROOT_START;b=desknets.tmpl.replaceWordHtml(b,"name",c);e=b+e+this.TMPL_ROOT_END}return e},_getRootItemName:function(){return desknets.Resource.folderselect.folderRoot},_getItemHtmlFromItemData:function(c){var g=this.TMPL_ITEM,e="leaf";var h=desknets.chooser._getSubType({id:c.id,type:"group"});var d=Number(c.children)>0;var i=this.options.leafChoosable!==false||d;var b=i?"":"co-tree-noselect";var f="";if(!!this.options.adminchild&&this.options.adminchild===true){if(!c.admin||c.adminchild=="1"||c.admin=="1"){g=this.TMPL_ITEM}else{g=this.TMPL_ITEM_NOLINK}}else{if(!!c.admin&&c.admin=="0"){g=this.TMPL_ITEM_NOLINK}}if(!!this.options.adminchild&&this.options.adminchild===true){if(!!c.admin&&c.admin=="1"){b+=" co-tree-noselect-nothover"}}if(!!c.adminunder&&c.adminunder=="1"){f="under"}if(!!this.options.adminchild&&this.options.adminchild===true){if(!!c.admin&&c.admin=="0"){b+=" notadmin"}else{f+=" admin"}}if(d){e=!!c.list&&!!c.list.item?"open":"closed"}g=desknets.tmpl.replaceWordHtml(g,"id",c.id);g=desknets.tmpl.replaceWordHtml(g,"state",e);g=desknets.tmpl.replaceWordHtml(g,"classes",b);g=desknets.tmpl.replaceWord(g,"name",c.Name);g=desknets.tmpl.replaceWordHtml(g,"subType",h);g=desknets.tmpl.replaceWordHtml(g,"adminunserclasse",f);return g},_getSelectedItem:function(){return this.$_tree.find(".co-listview-item-inside.on").parent()}});desknets.groupTree._defOptions.showRoot=true;desknets.groupTree._defOptions.defaultSelectionRel="self";desknets.page(desknets,"folderSelectTree",desknets.groupTree,{boChild:false,loadTree:function(e){var b=this;var d={cmd:this.options.cmdgrouptree,folder:this.options.defaultGroupId};var c=desknets.getUrl(this.options.module);desknets.chooser._ajaxRest(c,d,function(f){b._createTree(e,b._getFirstHtmlFromJson(f))},this.options)},getHtmlFromJson:function(c){var b=this;if(b.boChild&&!neo.isSet(c.status)){return""}else{return b.callBase("getHtmlFromJson",c)}},_setFolderOpenRoot:function(f){var c=this;var d=c.$_tree;var e=null;var b;var g=d.find("li.co-listview-item");g.each(function(j,k){var h=a(this);if(h.data("id")==f){if(f>0){e=h.parent().parent()}else{e=h}return false}});if(e){b=e.data("id")}if(!neo.isSet(b)){return}e.removeClass("jstree-closed");e.addClass("jstree-open");if(b<=0){return}return c._setFolderOpenRoot(b)},_selectOnLoaded:function(d){var c=this;var e=this.options.defaultGroupId||"";c._setFolderOpenRoot(e);var b=d.find("li.jstree-closed").filter(function(){var f=a(this);return f.data("id")>0});b.find("ul").remove();c.callBase("_selectOnLoaded",d);setTimeout(function(){c.resize()},100)},_getRootItemName:function(){return desknets.Resource.folderselect.folderRootReal},_getItemHtmlFromItemData:function(c){var f=this.TMPL_ITEM,e="leaf";var g=desknets.chooser._getSubType({id:c.id,type:"group"});var d=Number(c.children)>0;var h=!!this.options.leafChoosable||d;var b=h?"":"co-tree-noselect";if(d){e="closed"}f=desknets.tmpl.replaceWordHtml(f,"id",c.id);f=desknets.tmpl.replaceWordHtml(f,"state",e);f=desknets.tmpl.replaceWordHtml(f,"classes",b);f=desknets.tmpl.replaceWord(f,"name",c.Name);f=desknets.tmpl.replaceWordHtml(f,"subType",g);return f},getRequestParams:function(d){var b=a.cookie(desknets.COOKIENAME_STOKEN);var c={cmd:this.options.cmdgroups,pfolder:d.data("id"),area:"2"};if(neo.isSet(b)){c[b]="1"}this.boChild=true;return c}});(function(b){desknets.page(desknets.folderlist,"dialog_entry",desknets.folderlist.dialog,{_fname:"",_TMPLDIALOG:"com/folder.create.html",_boroot:false,_bomenu:false,mboaccess:false,mboaccessset:false,_inputFolderUpdate:function(){var c=this;var d=function(){c._openAddFolderAfter(c.$_element)};desknets.folderlist.updateTreeList(d)},init:function(e,d){var c=this;c.callBase("init",e,d);c._createFolderDialog(c.$_element);c._inputEntryMenu(c.$_element)},_createFolderDialog:function(e){var c=this;var g=c._TMPLDIALOG;var d=e.parent().find("div.jco-listview-pop");var f=function(){if(c.$_element.parent().find(".jco-tree-notcreate-root").length>0){d.find(".co-pop-folder-sel").remove()}};desknets.tmpl.load(d,g,f,true)},_setButtonErea:function(){var c=this;var d=c.$_btnErea;d.delegate(".jco-litview-item-add","click",function(e){c._setEntryButton(b(this),"add")});d.delegate(".jco-litview-item-mod","click",function(e){c._setEntryButton(b(this),"mod")})},_setEntryButton:function(f,e){var d=this;var c=null;var h=d._getObjFolderDialog().find(".co-pop-folder-sel");var g="0";if(b(".co-move-list-overlay").length>0){return}d._fname="";c=d._searchOnItem();if(neo.isSet(c)){g=d._get_folderid(c);d._folderid=g}if(g<=0){h.find("#sel_root").attr("checked",true);h.find("#sel_sub").attr("checked",false);h.find("#sel_sub").attr("disabled",true)}else{h.find("#sel_root").attr("checked",false);h.find("#sel_sub").attr("checked",true);h.find("#sel_sub").attr("disabled",false);if(e=="mod"){d._fname=desknets.folderlist.getItemTitle(c)}}d._poptitle=f.attr("title");d._bomenu=false;d._onSuccess_Dlg(c,e)},_inputEntryMenu:function(d){var c=this;d.delegate(".co-listview-item-setmenu>.co-folder-setadd","click",function(g){var f=b(this);var e=f.parent().closest("li");var h;c.inputButton(b(this));c._fname="";c._onSuccess_Dlg(e,"add")});d.delegate(".co-listview-item-setmenu>.co-folder-setmod","click",function(g){var f=b(this);var e=f.parent().closest("li");c.inputButton(b(this));c._fname=desknets.folderlist.getItemTitle(e);c._onSuccess_Dlg(e,"mod")})},inputButton:function(d){var c=this;c.callBase("inputButton",d);c._bomenu=true},_onSuccess_Dlg:function(j,e){var l=this;var f=l._getObjFolderDialog();var k=f.find(".co-pop-folder-sel");var g=f.find(".co-pop-folder-add");var m=desknets.dialog.getDialogOption();var h={dialogClass:"dn-dialog co-folder-dialog",buttons:{},title:l._poptitle,width:420,};var d=f.find(".jco-access-msg");var c=f.find(".jco-access-msg-acc");if(e=="mod"){k.hide();g.hide();d.hide()}else{var i=desknets.folderlist.getItemTitle(j);if(!neo.isSet(i,{blank:false})){i="("+desknets.Resource.nothingLabel+")"}g.find(".co-pop-folder-pname").text(i);g.show();if(l._bomenu==false){k.show()}else{k.hide()}if(l.mboaccess){d.show();if(f.find("#sel_root").attr("checked")){f.find(".jco-access-msg-root").show();f.find(".jco-access-msg-folder").hide()}else{f.find(".jco-access-msg-root").hide();f.find(".jco-access-msg-folder").show()}}else{d.hide()}}f.find("input.co-pop-folder-name").val(l._fname);h.buttons[desknets.Resource.OKButtonLabel]=function(){desknets.submitform.setDialogDisabled(f);l._inputFolderEntry(j,e)};h.buttons[desknets.Resource.CancelButtonLabel]=function(){f.dialog("close")};b.extend(m,h);if(b(".co-folder-dialog").length>0){f.dialog(m)}else{desknets.dialog.setUp(f,m);f.find('input[name="sel_create"]').change(function(){if(b(this).val()=="1"){f.find(".jco-access-msg-root").hide();f.find(".jco-access-msg-folder").show()}else{f.find(".jco-access-msg-root").show();f.find(".jco-access-msg-folder").hide()}})}f.dialog("open");desknets.dialog.setFirstDialogOpen(f);f.find(".co-pop-folder-name").focus()},_inputFolderEntry:function(h,d){var e=this;var g;var f;var c=e._getObjFolderDialog();g=e._getRestModule();f=desknets.getUrl(g);desknets.ajax.rest({url:f,data:e._getRequestEntryParams(d),success:function(){if(d=="add"){e._inputAddSuccess(h)}else{if(d=="mod"){e._inputModSuccess(h)}}c.dialog("close")},complete:function(){desknets.submitform.clearDialogDisabled(c)},error:function(k,i,j){desknets.submitform.clearDialogDisabled(c);e._entryAjaxError(k,i,j)},errorconvmsg:function(i,j){var k=desknets.getErrField(i,j);k.fieldname=e._getErrorPlace(k.fieldid);return desknets.getErrConvMsg(k)}})},_getErrorPlace:function(c){var d=this;if(c!==""){return desknets.getErrFieName(d._getObjFolderDialog(),c)}return""},_entryAjaxError:function(f,c,e){var d=this;if(f.status==desknets.ERRORNO_GRPERR_ITEMNOTHING){desknets.ajax.onError(f.status,desknets.Resource.Message.com_itemnothing_listreload)}else{desknets.ajax.onError(f.status,e)}},_inputAddSuccess:function(d){var c=this;if(c._boroot==true){d=c.$_element.find("."+c._options.itemArea).find("li:first");if(d.length==0||Number(c._get_folderid(d))>0){c._inputFolderUpdate();return}}d.find("ul:first").remove();if(d.hasClass("jstree-open")){d.removeClass("jstree-open");d.addClass("jstree-closed")}else{if(d.hasClass("jstree-leaf")){d.removeClass("jstree-leaf");d.addClass("jstree-closed")}else{d.addClass("jstree-closed")}}c._openAddFolder(d)},_openAddFolder:function(f){var c=this;var d=b.jstree._reference(c.$_element.find("."+c._options.itemArea));var e=d.open_node(f,function(){c._openAddFolderAfter(f);var g=c.$_element.find(".co-listview-item").eq(0);if(g.length>0&&g.hasClass("co-listview-tree-rootli-nosel")){c._delRootFolderAct(c.$_element)}})},_openAddFolderAfter:function(h){var d=this;var c=h.find("li:last");if(!!c&&d._get_folderid(c)==0){c=c.prev()}var g=d._options.addFunc;d.selectFolderOnDialog(c,true);var f=d.$_btnErea;if(!neo.isSet(d.$_btnErea)){if(neo.isSet(g)&&b.isFunction(g)){g(c)}return}f.find("button").attr("disabled",false);var e=f.find(".jco-litview-item-accs");if(e.length>0&&!e.is(":hidden")){if(!d.mboaccessset){e.addClass("jco-listview-items-accs-init");e.trigger("click")}else{g(c)}}else{if(neo.isSet(g)&&b.isFunction(g)){g(c)}}},_inputModSuccess:function(g){var d=this;var c=g.children("a.co-listview-item-inside");var e=d._getObjFolderDialog().find(".co-pop-folder-name").val();var f='<ins class="jstree-icon">&nbsp;</ins>'+desknets.tmpl.escapeWord(e);c.html(f);if(d._folderid==d._get_folderid(d._searchOnItem())){b("#jco-m-sub-title").find("span.overflow-auto").text(e)}},_getRequestEntryParams:function(d){var e=this;var c=e._getObjFolderDialog();var h=c.find(".co-pop-folder-name").val();var g=c.find(".co-pop-folder-sel");var f={cmd:e._getFolderEntryCmd(),Name:h};e._boroot=false;if(neo.isSet(g)&&!g.is(":hidden")&&g.find('input[name="sel_create"]').filter(":checked").val()=="0"){e._boroot=true}if(d=="add"&&e._boroot==false){f.pfolder=e._folderid}else{if(d=="mod"){f.folder=e._folderid}}return f},_getObjFolderDialog:function(){var d=this;var c;if(b(".co-folder-dialog").length>0){c=b(".co-folder-dialog").find(".co-pop-folder")}else{c=d.$_element.find(".co-pop-folder")}return c},_getFolderEntryCmd:function(){return""}})})(jQuery);(function(b){desknets.page(desknets,"exportConfigControl",null,{_dialogId:"jcom-export-config-dialog",$dialog:null,options:{},_options:{$control:null,useCharSep:true},_TMPL_DIALOG:"com/exportConfigDialog.html",_DIALOG_TITLE:desknets.Resource.ImEx.exportConfig,init:function(g){this._destroy();b.extend(this.options,this._options,g);var f=this.options["$control"];var h=f.data("defcode");if(neo.isSet(h)){if(h<0||h>2){h="0"}else{h=""+h}}else{h="0"}var e=b.cookie(desknets.COOKIENAME_IMEX_CCODE);e=!!e?e:h;var d=b.cookie(desknets.COOKIENAME_IMEX_CSEP);d=!!d?d:"0";this._build();this._update(e,d);var c=this;f.find("a").click(function(i){i.preventDefault();c.openDialog()});f.closest("form").submit(b.proxy(this._onExport,this))},_destroy:function(){var c=this.options["$control"];if(c==null){return}this.$dialog.dialog("destroy");this.$dialog=null;b("#"+this._dialogId).remove();this._getCharCodeHidden().remove();this._getCharSepHidden().remove();this.options={}},_build:function(){var c=this.options["$control"];c.append("<input type=hidden name=char_code>");if(this.options.useCharSep===true){c.append("<input type=hidden name=char_sep>")}},_update:function(c,e){var d=this.options["$control"];this._getCharCodeHidden().val(c);this._getCharSepHidden().val(e);d.find(".jco-encodetype-char").text(desknets.Resource.ImEx["charCode"+c]);d.find(".jco-encodetype-sep").text(desknets.Resource.ImEx["charSep"+e])},_onExport:function(){var d=this._getCharCodeHidden().val();var c=this._getCharSepHidden().val();desknets.saveCookieToDisk(desknets.COOKIENAME_IMEX_CCODE,d);desknets.saveCookieToDisk(desknets.COOKIENAME_IMEX_CSEP,c)},_getCharCodeHidden:function(){var c=this.options["$control"];return c.find(":hidden[name=char_code]")},_getCharSepHidden:function(){var c=this.options["$control"];return c.find(":hidden[name=char_sep]")},_getDialogOptions:function(){var e={};e[desknets.Resource.OKButtonLabel]=b.proxy(this._onClickOk,this);e[desknets.Resource.CancelButtonLabel]=b.proxy(this._onClickCancel,this);var d=desknets.dialog.getDialogOption();var c={buttons:e,dialogClass:"dn-dialog",resizable:false,title:this._DIALOG_TITLE,width:"500",height:"auto"};b.extend(d,c);return d},openDialog:function(){if(this.$dialog==null){this.$dialog=b("<div />").attr("id",this._dialogId).appendTo(document.body);desknets.tmpl.load(this.$dialog,this._TMPL_DIALOG,b.proxy(function(){this.$dialog.dialog(this._getDialogOptions());this._updateDialog();this.$dialog.dialog("open");desknets.dialog.setFirstDialogOpen(this.$dialog)},this),{})}else{this._updateDialog();this.$dialog.dialog("open").find("input[type=button]").blur()}return this.$dialog},_updateDialog:function(){var d=this.options["$control"];if(this.options.useCharSep!==true){this.$dialog.find("select[name=char_sep]").closest("tr").remove()}var c=this._getCharCodeHidden().val();var e=this._getCharSepHidden().val();this.$dialog.find("select[name=char_code]").val(c);this.$dialog.find("select[name=char_sep]").val(e)},_onClickOk:function(d){var c=this.$dialog.find("select[name=char_code]").val();var f=this.$dialog.find("select[name=char_sep]").val();this._update(c,f);desknets.saveCookieToDisk(desknets.COOKIENAME_IMEX_CCODE,c);desknets.saveCookieToDisk(desknets.COOKIENAME_IMEX_CSEP,f);this.$dialog.dialog("close")},_onClickCancel:function(c){this.$dialog.dialog("close")},banpei:null})})(jQuery);(function(b){desknets.page(desknets.folderlist,"dialog_access",desknets.folderlist.dialog,{_addAccess:false,init:function(e,d){var c=this;c.callBase("init",e,d);c._inputAccessMenu(c.$_element)},_setButtonErea:function(){var c=this;var d=c.$_btnErea;d.delegate(".jco-litview-item-accs","click",function(f){var h=b(this);var e=null;if(b(".co-move-list-overlay").length>0){return}var g=b(".co-table-list");if(g.length>0){b('<div class="co-move-list-overlay" />').insertBefore(g)}if(h.hasClass("jco-listview-items-accs-init")){c._addAccess=true;h.removeClass("jco-listview-items-accs-init")}e=c._searchOnItem();if(!neo.isSet(e)){return}c._poptitle=h.attr("title");c._folderid=c._get_folderid(e);c.createAccessDlg(c.$_element)})},_inputAccessMenu:function(d){var c=this;d.delegate(".co-listview-item-setmenu>.co-folder-setacc","click",function(e){c.inputButton(b(this));c.createAccessDlg(d)})},createAccessDlg:function(f){var c=this;c.shutAccessDlg(b("#jco-acc-list-container"));var g=function(h,i){var j;h.parent().append(i);c._onAccessDlg(h);c._initFolderAccessDlg()};var d=function(j){var h=desknets.ajax.chkAjaxHtmlError(j);if(h.status=="ok"){g(f,j)}else{var i=desknets.dialog.alert(h.message,{errorNo:h.no})}};var e={dataType:desknets.ajax.RESTYPE_HTML,url:desknets.getUrl(c._getRestModule()),data:c._getAccsTmplParams(),success:d,complete:function(){b(".co-move-list-overlay").remove()}};desknets.ajax.rest(e)},_getAccsTmplParams:function(){var c=this;var e=c._folderid;var d=c._getRequestAccsCmd();return{cmd:d,folder:e}},_initFolderAccessDlg:function(){desknets.folderlist.Access.init()},_onAccessDlg:function(g){var d=this;var c=b("#jco-acc-list-container");var e=desknets.dialog.getDialogOption();var f;var h={buttons:{},dialogClass:"dn-dialog jco-folderacc-dialog",title:d._poptitle,width:700};if(c.length==0){c=b(".err")}if(d._addAccess==true){f=function(j){d._addAccess=false;var k=d._options.addFunc;var i=d._searchOnItem();if(neo.isSet(i)&&neo.isSet(k)&&b.isFunction(k)){k(i)}d.shutAccessDlg(c)}}else{f=function(i){d.shutAccessDlg(c)}}h.close=f;h.buttons[desknets.Resource.OKButtonLabel]=function(){d.onSetAccess(c)};h.buttons[desknets.Resource.CancelButtonLabel]=function(){c.dialog("close")};b.extend(e,h);desknets.dialog.setUp(c,e);c.dialog("open");desknets.dialog.setFirstDialogOpen(c)},onSetAccess:function(c){var d=this;desknets.submitform.setDialogDisabled(c);b("#Accessfrm").submit()},shutAccessDlg:function(c){c.remove();c.dialog("destroy")},_getAjaxFormAccsDlgOption:function(){var d=this;var c=b("#jco-acc-list-container");var e={};e={error:function(g,f,h){desknets.ajax.onError(g.status,h)},success:function(g,f,h){d._updateSetFolder();c.dialog("close")},complete:function(h,f,g){desknets.submitform.clearDialogDisabled(c)}};return e},_updateSetFolder:function(){var d=this;var f=d._folderid;var c=null;c=d.$_element.find("li").filter(function(){return b(this).attr(d._options.idName)==d._folderid});if(!neo.isSet(c)){return}var e=c.parent().parent();if(!e.hasClass("co-listview-item")){return}e.find("ul:first").remove();if(e.hasClass("jstree-open")){e.removeClass("jstree-open");e.addClass("jstree-closed")}else{if(e.hasClass("jstree-leaf")){e.removeClass("jstree-leaf");e.addClass("jstree-closed")}else{e.addClass("jstree-closed")}}d._openSetFolder(e)},_openSetFolder:function(f){var c=this;var d=b.jstree._reference(c.$_element.find("."+c._options.itemArea));var e=d.open_node(f,function(){var g=f.find("li").filter(function(){return b(this).attr(c._options.idName)==c._folderid});if(g.length==0){g=c.$_element.find("li:not(.co-listview-tree-rootli-nosel)").eq(0)}c.selectFolderOnDialog(g);c._delRootFolderAct(c.$_element)})},_getRequestAccsCmd:function(){return""}})})(jQuery);(function(b){desknets.page(desknets.folderlist,"dialog_access_under",desknets.folderlist.dialog_access,{_TMPLACCSCONF:"com/folder.accessconf.html",mboUnderDialogChk:false,_getAjaxFormAccsDlgOption:function(){var d=this;var c=b("#jco-acc-list-container");var f=d.callBase("_getAjaxFormAccsDlgOption");var e={error:function(i,h,j){var g=b(".co-pop-folder-accsconf");if(g.length>0){desknets.submitform.clearDialogDisabled(g);g.dialog("close")}desknets.ajax.onError(i.status,j)}};b.extend(f,e);return f},shutAccessDlg:function(c){var d=this;var e=b(".co-pop-folder-accsconf");if(e.length>0){desknets.submitform.clearDialogDisabled(e);e.dialog("close")}d.callBase("shutAccessDlg",c)},onSetAccess:function(d){var e=this;if(e._addAccess==true){return e.callBase("onSetAccess",d)}if(e.mboUnderDialogChk){var c=desknets.folderlist.getItemObject_li(e.$_element,e._folderid,e._options);if(c.hasClass("jstree-leaf")){return e.callBase("onSetAccess",d)}}desknets.submitform.setDialogDisabled(d);e._createAccsConfDlg(d)},_createAccsConfDlg:function(c){var d=this;var f=d._TMPLACCSCONF;var e=c.find("div.jco-folder-accesspop");var g=b("div.co-pop-folder-accsconf");d._poptitle=desknets.Resource.folderlist.accessConf;if(g.length>0){d._onAccessConfDlg(c);return}desknets.tmpl.load(e,f,function(){e.html(desknets.tmpl.replaceWordHtml(e.html(),"AccsMsg",d._getAccessConfMsg()));e.appendTo(document.body);d._onAccessConfDlg(c);b("div.jco-folder-accesspop").remove()},true)},_onAccessConfDlg:function(c){var d=this;var f=b(".co-pop-folder-accsconf");var e=desknets.dialog.getDialogOption();var g={buttons:{},dialogClass:"dn-dialog confirm jco-folderacc-under-dialog",title:d._poptitle,width:575};f.find("input[name=modkind]").val(["0"]);g.buttons[desknets.Resource.OKButtonLabel]=function(){d._setAccessModkind(c,f);desknets.submitform.setDialogDisabled(f);b("#Accessfrm").submit()};g.buttons[desknets.Resource.CancelButtonLabel]=function(){f.dialog("close")};b.extend(e,g);if(b(".jco-folderacc-under-dialog").length>0){f.dialog(e)}else{desknets.dialog.setUp(f,e)}f.dialog("open");desknets.dialog.setFirstDialogOpen(f);desknets.submitform.clearDialogDisabled(c)},_setAccessModkind:function(c,f){var e=this;var d=f.find("input[name=modkind]:checked").val();c.find("input[name=modkind]").attr("value",d)},_getAccessConfMsg:function(){return""}})})(jQuery);(function(b){desknets.page(desknets.folderlist,"dialog_delete",desknets.folderlist.dialog,{init:function(e,d){var c=this;c.callBase("init",e,d);c._inputDeleteMenu(c.$_element)},_setButtonErea:function(){var c=this;var d=c.$_btnErea;d.delegate(".jco-litview-item-del","click",function(f){var e=null;if(b(".co-move-list-overlay").length>0){return}e=c._searchOnItem();if(!neo.isSet(e)){return}c._folderid=c._get_folderid(e);c._inputDelConfSubmit(f,e)})},_inputDeleteMenu:function(d){var c=this;d.delegate(".co-listview-item-setmenu>.co-folder-setdel","click",function(f){var e=b(this);var g=e.closest("li.co-listview-item");c.inputButton(e);c._inputDelConfSubmit(f,g)})},_inputDelConfSubmit:function(i,h){i.preventDefault();var d=this;var g=d._delConfMessage(h);var f=d._delConfAddMessage();var c={};c.extraMessage=f;c.extraClass="co-msg-rs";var e=desknets.dialog.confirm(g,function(){desknets.submitform.setDialogDisabled(e);d._inputDelSubmit(e,h);return false},c)},_delConfMessage:function(d){var c=desknets.Resource.Message.com_folder_del;return desknets.tmpl.replaceWord(c,"FolderName",desknets.folderlist.getItemTitle(d))},_inputDelSuccess:function(e){var k=this;var i=e.children("a.co-listview-item-inside");var f=e.parent().closest("li");e.remove();if(f.find("li").length<1){f.find("ul").remove();f.removeClass("jstree-open");f.addClass("jstree-leaf")}if(i.hasClass("on")||e.find("a.on").length>0){if(f.length==0||f.hasClass("co-listview-tree-rootli-nosel")){f=k.$_element.find("li.co-listview-item:not(.co-listview-tree-rootli-nosel)").eq(0)}if(f.length==0){var g=k.$_btnErea;var h=":button:not(.jco-litview-item-add)";if(k.$_element.find(".jco-tree-notcreate-root").length>0){h=":button"}var d=g.find(h);d.attr("disabled",true);var j=k._options.resetFunc;if(neo.isSet(j)&&b.isFunction(j)){j()}}else{var c=k._options.addFunc;if(b.isFunction(c)){c(null,true)}k.selectFolderOnDialog(f)}}},_inputDelSubmit:function(c,g){var d=this;var f;var e;f=d._getRestModule();e=desknets.getUrl(f);desknets.ajax.rest({url:e,data:d._getRequestDelParams(),success:function(){d._inputDelSuccess(g)},complete:function(){desknets.submitform.clearDialogDisabled(c);c.dialog("close")}})},_getRequestDelParams:function(){var c=this;return{cmd:c._getFolderDelCmd(),folder:c._folderid}},_delConfAddMessage:function(){return""},_getFolderDelCmd:function(){return""}})})(jQuery);(function(b){desknets.page(desknets,"folderinput",desknets.folderlist,{_defOptions:{listAreaObj:b("#jco-m-list-container"),itemArea:"co-listview-items",defArea:"co-listview-defitems",idName:"data-fid",fieldName:"folder",isLag:false,isEdit:false,isOnAlready:false,loadFunc:null,openFunc:null},boGet:false,_getFirstTreeData:function(d){var c=this;var e=c._getFirstTreeDataListCopy();if(!e){c.callBase("_getFirstTreeData",d);c.boGet=true}},_getFirstTreeDataListCopy:function(){var c=this;var e=c._getListParent();var g=c.getInputFieldName();if(neo.isSet(c._options.loadFunc)&&b.isFunction(c._options.loadFunc)){c._loadFunc=c._options.loadFunc}var d=c._options.listAreaObj.find("."+c._options.itemArea);if(d.hasClass(c._dmyTreeClass)){return false}c.copyTree(c._options.listAreaObj,c.$_root);var f=c.$_root.find("."+c._options.itemArea);if(f.find("ins").length>0){f.find("ins").remove();c._createSideTree();c.boGet=true;return true}return false},_createSideTreeInput:function(){var c=this;var d=c.$_root.find("."+c._options.itemArea);if(d.find("ins").length>0){d.find("ins").remove();c._createSideTree();c.boGet=true;return true}return false},_isGetFirstTreeAjax:function(){return true},_setFolderOpen:function(){var c=this;if(c.$_root.find(".co-listview-item-inside").hasClass("on")){return}c.callBase("_setFolderOpen")},_onOpenItem:function(d){var c=this;c.callBase("_onOpenItem",d);if(neo.isSet(c._options.openFunc)&&b.isFunction(c._options.openFunc)){c._options.openFunc()}},_openNodeFirstTime:function(i){var d=this;d._firstTime=false;var e=d.$_root.find("."+d._options.itemArea);if(e.find("a.co-listview-item-inside.on").length==0){if(d._options.listAreaObj.hasClass(d._dmyTreeClass)){d._options.listAreaObj.removeClass(d._dmyTreeClass);d.copyTree(d._options.listAreaObj,d.$_root)}if(e.find("a.co-listview-item-inside.on").length==0){var g=d.getInputFieldName();var h;var f=desknets.paramanalyzer.getHashParams();if(neo.isSet(f)&&f[g]){h=f[g]}d.onSelectItemNoAjax(i,h)}}var c=i.find("a.co-listview-item-inside");c.removeClass("jstree-draggable");c.removeClass("jstree-drop");b(".co-listview-item-setlink").hide();d._delRootFolderAct(i);setTimeout(function(){d._getListParent().show();d._updateScrollTopValue(d._searchOnItem());d._updateItemsWidth()},100)}})})(jQuery);(function(b){desknets.page(desknets,"folderinput_access",desknets.folderinput,{_tmplInitItem:'<li {{idName}}="{{id}}" class="co-listview-item"><a href="#" class="co-listview-item-inside {{MoveClass}}" {{accs}}>{{Name}}</a>{{F_Ul}}</li>',_tmplFItem:'<li {{idName}}="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside {{MoveClass}} {{Drag}}" {{accs}}>{{Name}}</a></li>',_selPerm:[],_isCtrlAccess:function(){var c=this;if(neo.isSet(c._options.isCtrlAccess)){return c._options.isCtrlAccess}return false},_isHasAccess:function(f,e,d){var c=this;if(!c._isCtrlAccess()){return true}if(neo.isSet(d)&&d==true){if(Number(f)>=Number(e)){return true}}else{if((Number(f)&Number(e))==Number(e)){return true}}return false},_getItemHtml:function(e,d){var c=this;var f=desknets.tmpl.escapeWord(d.Name);e=desknets.tmpl.replaceWordHtml(e,"id",d.id);e=desknets.tmpl.replaceWordHtml(e,"Name",f);e=desknets.tmpl.replaceWordHtml(e,"accs",d.accesskind?"data-access="+d.accesskind:"");e=desknets.tmpl.replaceWordHtml(e,"state",d.list?"closed":"leaf");return e},_onOpenItem:function(d){var c=this;c.callBase("_onOpenItem",d);c._setSelectAccsCtrl()},_openNodeFirstTime:function(e){var c=this;c.callBase("_openNodeFirstTime",e);var d=c.$_root.find("input[name="+c.getInputFieldName()+"]");d.each(function(f,g){c._selPerm[f]=b(g).val()});c._setSelectAccsCtrl()},_setSelectAccsCtrl:function(){var c=this;var d=c._getListParent().find("a.co-listview-item-inside:not(.co-tree-noselect)");d.each(function(g,h){var f=b(this);var e=f.data("access");if(b.inArray(f.parent().attr(c._itemid),c._selPerm)>=0){return true}if(!c._isHasAccess(e,2)){f.addClass("co-tree-noselect")}})}})})(jQuery);(function(b){desknets.page(desknets,"folderdisp",desknets.folderinput,{_defOptions:{listAreaObj:b("#jco-m-list-container"),itemArea:"co-listview-items",defArea:"co-listview-defitems",idName:"data-fid",fieldName:"folder",isLag:false,isEdit:false,isDef:false,isOnAlready:true,},_getFirstTreeData:function(d){var c=this;c._getFirstTreeDataListCopy()},_isGetFirstTreeAjax:function(){return false},_onSelectItem:function(e,c){var d=this;d.copyTree(d.$_root,d._options.listAreaObj,true);d.callBase("_onSelectItem",e,c)},_setFolderOpen:function(){var c=this;var d=c.$_root.find(".co-listview-item-inside.on");if(d.length>0){d.removeClass("on")}c.callBase("_setFolderOpen")},getDispTreeAjax:function(c){var d=this;if(neo.isSet(c)&&b.isFunction(c)){d._loadFunc=c}var f=desknets.paramanalyzer.getHashParams();var e=d.getInputFieldName();if(neo.isSet(f)&&f[e]){d._initfid=f[e]}d._getFirstTreeAjax();d.boGet=true},editDispFolderList:function(j,i,p){var o=this;var g="";var c="folder";var e;if(!j||!j.item){return"&nbsp;"}if(neo.isSet(i)){c=i}var k=desknets.ajax.getItems(j.item);e=k.length;if(e==0){return"&nbsp;"}var f={cmd:desknets.paramanalyzer.getPageCmd()};for(var m=0;m<e;m++){var n="";var l=k[m];var d=desknets.tmpl.escapeWord(l.val);var q=" > ";if(m>0){g=g+q}var h="";if(typeof(p)==="object"){b.extend(f,p);h="&"+desknets.getNeoParam(f)}n=n+'<a href="#'+c+"="+l.id+h+'">'+d+"</a>";g=g+n}return g}})})(jQuery);desknets.user={KEY_ASSIGNGROUP:"assigngrp",KEY_GROUP:"Group",KEY_NAME:"val",VAL_DEFGROUP:"1",_hiddenFields:null,getListAssignGroups:function(g){var l=this;var f=[];var k=[];var c;var j;var d;var h;var m="";var b="";var e={assign:"",assigntitle:""};var i;if(!neo.isSet(g)){return e}if(a.isArray(g)){f=g}else{f[0]=g}c=f.length;for(j=0;j<c;j++){k=f[j];if(typeof k!="object"){h=k;i=false}else{h=k[l.KEY_NAME];i=true}if(m.length!=0){m=m+",\n";b=b+",&#x0A;"}h=desknets.tmpl.escapeWord(h);if(i&&k[l.KEY_GROUP]==l.VAL_DEFGROUP){d='<span class="co-busyo-def">'+h+"</span>"}else{d=h}m=m+d;b=b+h}e.assign=m;e.assigntitle=b;return e},removeFieldIfHidden:function(b,c){this._loadHiddenFields();if(this._isFieldToHide(b)){b.remove();if(!!c){c.remove()}}},_isFieldToHide:function(b){var c=b.data("fields");if(!c){return false}var e=c.split(",");for(var d=0;d<e.length;d++){if(a.inArray(e[d],this._hiddenFields)<0){return false}}return true},_loadHiddenFields:function(){if(a.type(this._hiddenFields)!="array"){this._hiddenFields=String(desknets.pageframe.getUserNoDispItems()).split(",")}return this._hiddenFields}};desknets.listviewframe={VAL_LISTVIEWFRAME_MINHEIGHT:330,VAL_LISTVIEWFRAME_BOTTOMBTN:80,VAL_LISTVIEWFRAME_HEAD:30,_barWidth:0,updateListHeight:function(b,f,e,k){var l=this;var j=b.find(".co-btnarea");if(j.length==0||j.offset().top==0){return}var g=j.outerHeight();var h=a(window).height()-b.offset().top-g-l.VAL_LISTVIEWFRAME_BOTTOMBTN;h=Math.max(h,this._getListViewMinHeight(b));b.height(h+g);var i=h+g;if(b.find(".co-listview-left-title").length>0){i=i-l.VAL_LISTVIEWFRAME_HEAD}if(f!==false){i=i-l.VAL_LISTVIEWFRAME_HEAD}if(k===true){i=i-l.VAL_LISTVIEWFRAME_HEAD}b.find(".co-listview-left-data").height(i);var d=h;if(e!=false){d=h-l.VAL_LISTVIEWFRAME_HEAD}var c=b.find(".co-listview-scroll");c.height(d)},updateListHeightScroll:function(c,d,e){var b=this;b.updateListHeight(c,d,e);b.updateListScrollWidth(c)},updateListScrollWidth:function(b){var l=this;var i=b.find(".co-listview-listhead").find(".co-table-list");var h=b.find(".co-listview-scroll");var d=h.find(".co-table-list");if(i.length==0||h.length==0){return}var k=i.find("tr:first").find("th:last");var c=d.find("tr:first").find("td:last");var e=h.scrollLeft();var g=l.getScrollBarWidth();var f=h.height();var j=d.height();if(f<j||(d.width()-h.width()>2&&j+g>f)){c.width(k.width()-g-1)}else{c.width(k.width()-1)}if(Number(e)>0){h.scrollLeft(e)}},updateInputHeight:function(e){var d=this;var c=e.find(".co-ebtnarea");if(c.length==0){c=e.find(".co-vbtnarea")}if(c.length==0||c.offset().top==0){return}var b=c.outerHeight();var f=e.find(".co-listview-edit").height();e.height(f);e.find(".co-listview-left").height(f);e.find(".co-listview-list").height(f);var g=f-b;e.find(".co-listview-left-data").height(g)},setListviewHeight:function(e){var b=e.find(".co-listview-list");if(b.length>0){b.height("auto");var c=b.closest(".co-listview"),g=30,h=b.outerHeight(),d=c.find(".co-listview-items").outerHeight(h-g),f=d.outerHeight();if(f>h){b.outerHeight(f+g)}}},setLeftTitleMenu:function(b){b.find(".co-listview-item-setlink").click(function(d){d.preventDefault();var c=a(this).find(".co-listview-item-setmenu");c.toggle();a(this).parent().hover(function(){},function(f){c.hide();a(this).unbind(f)})})},toggleLeftArea:function(b){b.find(".co-listview").toggleClass("co-listview-left-close")},showLeftArea:function(b){b.find(".co-listview").removeClass("co-listview-left-close")},getScrollBarWidth:function(){var b=this;if(!neo.isSet(b._barWidth)||b._barWidth<=0){var c=a('<div class="jco-listview-checker" />').css("overflow-x","scroll");c.appendTo(document.body);b._barWidth=c.height();a(".jco-listview-checker").remove()}return b._barWidth},_getListViewMinHeight:function(c){var b=String(c.css("min-height")).match(/^(\d+)px$/);return !!b&&b[1]>0?Number(b[1]):this.VAL_LISTVIEWFRAME_MINHEIGHT}};(function(b){desknets.label={selectSet:function(c,f){var g=c.find(".co-combox");if(g.find(".co-combox-item").length==0){g.find(".co-combox-list").hide()}else{var e=g.find(".co-combox-text");if(neo.isSet(f)){g.find(".co-combox-item").each(function(){if(b(this).data("id")==f){e.val(b(this).text());return false}})}var d=function(h){g.find(".co-combox-item").removeClass("on");if(h!==""){g.find(".co-combox-item").each(function(){if(b(this).text()==h){b(this).addClass("on");return false}})}};d(e.val());g.find(".co-combox-item").click(function(){e.val(b(this).text());g.find(".co-combox-item").removeClass("on");b(this).addClass("on");desknets.popUp.hide(b(this))});e.blur(function(){d(e.val())})}},getLabelHtml:function(e,f){var d=desknets.escape(f);d=desknets.escapeValue(d);d=desknets.escapeSpace(d);var c="";c='<a class="co-label jco-label-data" href="#" title="'+d+'"><input type="hidden" class="jco-label-id" value="'+e+'"><span class="jco-label-name">'+d+"</span></a>";return c}}})(jQuery);desknets.capacity={_tmpl:'<div id="co-capacity-detail"><table><tr><th class="co-capacity-th"><span class="co-colon">{{UseCapacity}}</span></th><td class="co-capacity-val">{{sUseSize}}</td><td class="co-capacity-percent">({{sUsePercent}})</td></tr><tr><th class="co-capacity-th"><span class="co-colon">{{FreeCapacity}}</span></th><td class="co-capacity-val">{{sFreeSize}}</td><td class="co-capacity-percent">&nbsp;</td></tr><tr><th class="co-capacity-th"><span class="co-colon">{{Capacity}}</span></th><td class="co-capacity-val">{{iLimitCapa}} MB</td><td class="co-capacity-percent">&nbsp;</td></tr></table></div>{{Capacity}}<span class="co-colon-span">:</span><div class="co-capacity-bar"><div class="co-capacity-bar-in"></div></div>',formatPercentage:function(b,c){return this._formatPercentage(this._getPercentage(b,c),b)},makeHtml:function(k,j,l){var g="";var c="";var d="";var e=false;if(neo.isSet(j)&&j>0){c=desknets.numberFormatByte(l,0,0,2);var h=j*1024*1024;var b=this._getPercentage(l,h);var f=this._formatPercentage(b,l);var i=h-l;if(i<0){i=0}d=desknets.numberFormatByte(i,0,0,2);g=this._tmpl;g=desknets.tmpl.replaceWordHtml(g,"UseCapacity",desknets.Resource.capacity.UseCapacity);g=desknets.tmpl.replaceWordHtml(g,"FreeCapacity",desknets.Resource.capacity.FreeCapacity);g=desknets.tmpl.replaceWordHtml(g,"Capacity",desknets.Resource.capacity.Capacity);g=desknets.tmpl.replaceWordHtml(g,"sUseSize",c);g=desknets.tmpl.replaceWordHtml(g,"sUsePercent",f);g=desknets.tmpl.replaceWordHtml(g,"sFreeSize",d);g=desknets.tmpl.replaceWordHtml(g,"iLimitCapa",desknets.numberFormat(j))}else{c=desknets.numberFormatByte(l,0,0,2);g=desknets.Resource.capacity.Capacity+'<span class="co-colon-span">:</span>'+c}k.html(g).find(".co-capacity-bar-in").css("width",b+"%")},_getPercentage:function(c,d){var b=Math.round(c/d*100);return Math.max(0,Math.min(100,b))},_formatPercentage:function(b,c){return(b<1&&c>0)?desknets.Resource.capacity.LessThanOne:b.toString()+"%"}};desknets.page(desknets,"cabinetregist",null,{HTML_CABREGIST_DEF:"def.html",MODULE_API_CABINET:"zrcabinet",MODULE_CABINET:"zcabinet",loadFiles:{},boview:{},$dialog:{},$area:{},mobjoption:{},boNotAttach:{},sHtml:{},init:function(j,f,g){var h=this;var e=h._setOption(f);var c=e.id;h.mobjoption[c]=e;h.boNotAttach[c]=g;h.$area[c]=j;if(!h.$dialog[c]){var i=desknets.dialog.getDialogOption();var b={extraMessage:null,extraClass:"",btnLabelOk:desknets.Resource.ConfOKButtonLabel,btnLabelCancel:desknets.Resource.ConfCancelButtonLabel};var d=a.extend(i,{title:desknets.Resource.confirmDefaultTitle,dialogClass:"dn-dialog message",buttons:{},open:function(){a(this).parent().find(".ui-dialog-buttonpane button:eq(1)").focus()}});d.buttons[b.btnLabelOk]=function(){desknets.submitform.setDialogDisabled(h.$dialog[c]);h._regCabinet(c)};d.buttons[b.btnLabelCancel]=function(){a(this).dialog("close")};h.$dialog[c]=desknets.dialog.make("confirmcab-"+c,d);desknets.dialog._setMessage(h.$dialog[c],h.mobjoption[c].message)}h._setClickHandlerCabRegist(c)},_setClickHandlerCabRegist:function(c){var b=this;b.$area[c].find(".jco-cab-regist").click(function(d){d.preventDefault();b.$dialog[c].dialog("open");if(!b.boview[c]){b.boview[c]=true;desknets.dialog.setFirstDialogOpen(b.$dialog[c])}})},makeHtmlStr:function(c,d){var b=this;var h=b._setOption(d);var g=h.id;var e=h;var f=function(){if(a.isFunction(e.cabmaketemplate)){b.sHtml[g]=e.cabmaketemplate(e,b.loadFiles[e.cabtemplatename])}else{b.sHtml[g]=b._makeTemplate(c,b.loadFiles[e.cabtemplatename])}if(d.onSet&&a.isFunction(d.onSet)){d.onSet(b.sHtml[g])}};b._geTemplate(f,e.cabtemplatename)},_setOption:function(d){var b=this;var c={message:desknets.Resource.Message.com_cab_regist,copymodule:"",copyprm:null,copycmd:"",cabtemplatename:b.HTML_CABREGIST_DEF,cabmodule:b.MODULE_API_CABINET,cabtitle:null,cabsparetitle:"",cabmaketemplate:null,id:"detail"};return a.extend({},c,d)},_regCabinet:function(c){var b=this;if(b.boNotAttach[c]===true){b._successAttach({},c)}else{b._getAttach(c)}},_getAttach:function(d){var b=this;var c={};if(a.isFunction(b.mobjoption[d].copyprm)){c=b.mobjoption[d].copyprm();if(c===false){return false}}else{c=b._getRestAttachPrm(d)}desknets.ajax.rest({url:desknets.getUrl(b.mobjoption[d].copymodule),data:c,success:function(f,e,g){b._successAttach(f,d)},error:function(g,e,f){desknets.submitform.clearDialogDisabled(b.$dialog[d]);desknets.ajax.onError(g.status,f)}})},_getRestAttachPrm:function(c){var b=desknets.paramanalyzer.getHashParams();b.cmd=this._getRestAttachCmd(c);return b},_getRestAttachCmd:function(b){return this.mobjoption[b].copycmd},_successAttach:function(e,g){var c=this;var b={};var d="";if(neo.isSet(e.tmppid)){d=e.tmppid}b.tmppid=d;if(neo.isSet(e.list)){b.list=e.list}var f=function(){c._sendCabinet(b,g)};c._geTemplate(f,c.mobjoption[g].cabtemplatename,g)},_geTemplate:function(d,b,e){var c=this;if(!neo.isSet(c.loadFiles[b])){desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_HTML,type:"GET",url:desknets.getUrl(desknets.MODULE_HTML_MAIN),data:{cmd:desknets.CMD_TMPLHTML,html:"cabinet/"+b,fldlang:desknets.Resource.code,v:desknets.CACHE_VERSION},allowCacheTempl:false,allowCsrfTempl:false,success:function(h){var f=desknets.ajax.chkAjaxHtmlError(h);if(f.status=="ok"){c.loadFiles[b]=h;if(typeof(d)=="function"){d()}}else{var g=desknets.dialog.alert(f.message,{errorNo:f.no})}},error:function(h,f,g){desknets.submitform.clearDialogDisabled(c.$dialog[e]);desknets.ajax.onError(h.status,g)}})}else{if(typeof(d)=="function"){d()}}},geTemplate:function(d,b,e){var c=this;c._geTemplate(d,b,e)},_sendCabinet:function(b,e){var c=this;var d=c._getRestCabinet(b,e);if(typeof d=="object"){c.sendCabinetAjax(d,e)}},sendCabinetAjax:function(c,d){var b=this;desknets.ajax.rest({url:desknets.getUrl(b.mobjoption[d].cabmodule),data:c,success:function(g,e,h){desknets.submitform.clearDialogDisabled(b.$dialog[d]);b.$dialog[d].dialog("close");if(!!g.noticeerror){var f=desknets.dialog.alert(g.noticeerror,{extraClass:"co-msg-r",type:"warn"});f.bind("dialogclose",function(i){desknets.dialog.deleteById("warn")});return}desknets.dialog.alert(b.getFinMsg(g),{type:"message"})},error:function(i,f,h){desknets.submitform.clearDialogDisabled(b.$dialog[d]);b.$dialog[d].dialog("close");if(i.status==-5110){var g='<a href="'+b.MODULE_CABINET+"."+desknets._msExtension+'?cmd=cabindex">'+desknets.Resource.com_cab+"</a>";var e="<br />"+desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_cab_folderadd,"cabinet",g);desknets.ajax.onError(i.status,h+e)}else{desknets.ajax.onError(i.status,h)}}})},getFinMsg:function(b){return desknets.tmpl.replaceWord(desknets.Resource.Message.com_cab_finregist,"FolderName",b.folder)},_getRestCabinet:function(b,f){var c=this;var d={};d.cmd="cabregist";d.tmppid=b.tmppid;d.modulecmd=c.mobjoption[f].copycmd;if(a.isFunction(c.mobjoption[f].cabtitle)){d.Name=c.mobjoption[f].cabtitle()}else{if(typeof(c.mobjoption[f].cabtitle)==="string"){d.Name=c.mobjoption[f].cabtitle}else{d.Name=c._getTitle(f)}}d.cabsparetitle=c.mobjoption[f]["cabsparetitle"];if(a.isFunction(c.mobjoption[f].cabmaketemplate)){var e=c.mobjoption[f].cabmaketemplate(c.mobjoption[f],c.loadFiles[c.mobjoption[f].cabtemplatename],b,d);if(e===false){return false}d.viewdata=e}else{d.viewdata=c._makeTemplate(c.$area[f],c.loadFiles[c.mobjoption[f].cabtemplatename])}return d},_getTitle:function(b){return this.$area[b].find(".jco-cab-title:first").text()},_makeTemplate:function(b,e){var d=b.find(".jco-cab-template").html();var c=a("<div>"+d+"</div>");desknets.attachDisp.removeAttachAlink(c);return desknets.tmpl.replaceWordHtml(e,"body",c.html())}});desknets.watermark={set:function(d){if(d.attr("title")){var c=a("<label/>"),b=d.attr("title");c.addClass("co-watermark").css("margin-left",parseInt(d.css("text-indent"),10)-d.outerWidth()).click(function(){d.focus()}).text(b).attr("title",b);d.after(c).focus(function(){c.removeClass("on")}).blur(function(){if(d.val()===""){c.addClass("on")}else{c.removeClass("on")}});if(d.val()===""){c.addClass("on")}}}};desknets.keysearch={_mlistfuncTimer:{},_mlistboSearchExec:{},isfocus:function(b){return b.is(":focus")},setUp:function(e,f,c){var b=this;var d=1000;f.keydown(function(g){b._mlistboSearchExec[e]=false;if(g.keyCode==13){g.preventDefault();c()}});f.blur(function(){b.delTimer(e);c()});f.focus(function(){if(b._mlistfuncTimer[e]==null){b._mlistfuncTimer[e]=setInterval(function(){if(b._mlistboSearchExec[e]){c();b._mlistboSearchExec[e]=false}else{b._mlistboSearchExec[e]=true}},d)}})},delTimer:function(c){var b=this;clearInterval(b._mlistfuncTimer[c]);b._mlistfuncTimer[c]=null},fixListWatermark:function(b,c){if(neo.isSet(b)&&!this.isfocus(b.find(".co-list-search-text"))){if(c&&c.srch_key&&c.srch_key.length>0){b.find(".co-list-search-text").val(c.srch_key);b.find(".co-list-search").find(".co-watermark").removeClass("on")}else{b.find(".co-list-search-text").val("");b.find(".co-list-search").find(".co-watermark").addClass("on")}}}};desknets.page(desknets,"attachSetUp",null,{_$pageEntry:null,_$entryAttachList:null,_sDefIdName:"id",_objDefPrm:{},$attach:null,init:function(b,c){this._initGetPage(b);this._initGetArea();this._initSetDefPrm();if(c){this._setUpEntryDialog()}else{this._setUpEntry()}},open:function(){if(this._$entryAttachList!==null){this._$entryAttachList.dnAttachList("openChooser")}},update:function(b){if(this._$entryAttachList!==null){this._$entryAttachList.dnAttachList("updateFile",b)}},_initGetPage:function(b){this._$pageEntry=b},_initGetArea:function(){this._$entryAttachList=this._$pageEntry.find(".jco-setup-attach-list")},_initSetDefPrm:function(){this._objDefPrm={};var b=this._$pageEntry.find('input[name="'+this._sDefIdName+'"]');if(b.length>0&&b.val()!==""){this._objDefPrm[this._sDefIdName]=b.val()}},_setUpEntryDialog:function(){var b=this;var c=b._getOption();c.hideElementOnEmpty=this._getHideArea();c.toggleTargetFunc=this._getToggleTarget();this._$entryAttachList.dnAttachList(c)},_setUpEntry:function(){var c=this;var e=c._getOption();e.fileDrop=c._$entryAttachList;e.totalSizeLimit=2147483648;var h=c._$entryAttachList.data("totalsizelimit");if(!!h){e.totalSizeLimit=h}var f=c._getFiles();if(f!=null){var g={};g.tmpnm="";g.files=f;e.file=g}var b=desknets.attach.ext.getIconList();if(b){e.icon=b}e.beforUpload=c._getbeforUpload;var d=function(){c._getafterUpload()};e.afterUpload=d;a(".co-pop-tp-file-drop").remove();c.$attach=desknets.attach;c.$attach._destroy();c.$attach.totalFileNum=0;c.$attach.upload(e)},_getFiles:function(){var b=this;var c=[];var d=0;this._$entryAttachList.find(".jco-attach-file").each(function(){var e={};e.fno=a(this).val();e.attachdisp=a(this).data("name");e.size=parseInt(a(this).data("size"),10);c[d]=e;d++});this._$entryAttachList.html("");if(d>0){return c}return null},shutAttach:function(){var b=this;b.$attach.totalFileNum=0;b.$attach._destroy();b.$attach=null},_getOption:function(){var j=this;var f=desknets.getUrl(this._getUploadURL());var i=desknets.getUrl(this._getDelURL());var g=desknets.getUrl(this._getDownLoadURL());var h={};var d={};var c={};h=this._getUploadPrm();h.cmd=this._getUploadCmd();d=this._getDelPrm();d.cmd=this._getDelCmd();c=this._getDownLoadPrm();c.cmd=this._getDownLoadCmd();var b=g+"?"+desknets.getNeoParam(c)+this._getDownLoadAddURL();var e={uploadURL:f,uploadParams:h,delURL:i,delParams:d,downloadURL:b};e=j._getOptionAdd(e);return e},_getOptionAdd:function(c){var b=this;return c},_getHideArea:function(){return".jco-setup-attach-area"},_getToggleTarget:function(){return null},_getbeforUpload:function(){var b=this;desknets.submitform.setDisabled(a("#inputfrm"))},_getafterUpload:function(){var b=this;desknets.submitform.clearDisabled(a("#inputfrm"))},_getUploadURL:function(){return""},_getUploadPrm:function(){var b=a.extend({},this._objDefPrm);return b},_getUploadCmd:function(){return""},_getDelURL:function(){return this._getUploadURL()},_getDelPrm:function(){return this._getUploadPrm()},_getDelCmd:function(){return""},_getDownLoadURL:function(){return""},_getDownLoadPrm:function(){return this._getUploadPrm()},_getDownLoadCmd:function(){return""},_getDownLoadAddURL:function(){return"&fno={{id}}&filename={{name}}"}});desknets.page(desknets,"print",null,{DEF_WINDOW_NAME:"desknets_print",setPrintHtmlFunc:null,setPrintHtmlCostFunc:null,$area:null,setPrintHtml:function(c){var b=this;if(!a.isFunction(b.setPrintHtmlFunc)){c.$("#jco-print-body").html(desknets.Resource.Message.print_noset_javascript);return false}else{return b.setPrintHtmlFunc(b.$area,c)}},setPrintCostHtml:function(c){var b=this;if(!a.isFunction(b.setPrintHtmlCostFunc)){c.$("#jco-print-body").html(desknets.Resource.Message.print_noset_javascript);return false}else{return b.setPrintHtmlCostFunc(b.$area,c)}},setPrintHtmlFuncDef:function(c,d){var b=this;d.$("#jco-print-body").html(c.find(".jco-print-template").html());desknets.attachDisp.removeAttachAlink(d.$("body"));d.$("a").each(function(){var f=a(this);var g=f.attr("class");var e=f.html();f.replaceWith('<span class="'+g+'">'+e+"</span>")});return true},delAlink:function(b){b.$("a").each(function(){var d=a(this);var e=d.attr("class");var c=d.html();d.replaceWith('<span class="'+e+'">'+c+"</span>")})},init:function(d,b,e){var c=this;c.$area=d;if(a.isFunction(b)){c.setPrintHtmlFunc=b}else{c.setPrintHtmlFunc=c.setPrintHtmlFuncDef}d.find(".co-msg-printer").click(function(f){f.preventDefault();c.initPrintOpen(e)})},initPrintOpen:function(g){var c=this;var h="";if(neo.isSet(g)&&neo.isSet(g.cgiurl)){var f="";if(neo.isSet(g.cgiprm)){f=desknets.getNeoParam(g.cgiprm)}h=desknets.getUrl(g.cgiurl);if(f!==""){h=h+"?"+f}}else{h=desknets.getUrl("zhtml");var i="printhtml";var e=desknets.Resource.code;var b=desknets.paramanalyzer.getHashParams();var d={};if(!!g&&!!g.prm){d=g.prm}else{b.execcmd=b.cmd;delete b.cmd;d=b}h=h+"?cmd="+i+"&fldlang="+e+"&"+desknets.getNeoParam(d)}window.open(h,this.DEF_WINDOW_NAME).focus()}});desknets.webmail={WINDOW_NAME_DNP:"dnwmail",MODULE_DNP_MAILJS:"zwmljs",MODULE_DNP_MAILC:"zrwemlc",MODULE_DNP_MAIL:"zrweml",CMD_DNP_MAILVIEW:"mailcmdview",CMD_MAILACCOUNTS:"mailaccounts",PAGENAME_DNP_MAILLIST:"MailList",PAGENAME_DNP_MAILEDIT:"MailEdit",PAGENAME_DNP_ADDRLIST:"AddressList",PAGENAME_DNP_SETACCEDIT:"SettingAccountEdit",PAGENAME_DNP_SETSHAREACCEDIT:"SettingShareAccountEdit",MODULE_API_MAIL:"zrmail",CMD_MAILLOGCOUNTUP:"mailcmdlogcountup",CMD_ADDRLOGCOUNTUP:"addrcmdlogcountup",openMailList:function(c){var b=this;b.openMailListCom(null,c,b._getMailListSetting())},openMailSearchList:function(c,d){var b=this;b.openMailListCom(c,d,b._getMailListSetting())},_getMailListSetting:function(){var b=this;var c={listmodule:b.MODULE_DNP_MAILJS,listcmd:b.PAGENAME_DNP_MAILLIST,logcntmodule:b.MODULE_API_MAIL,logcntcmd:b.CMD_MAILLOGCOUNTUP,wndname:b.WINDOW_NAME_DNP};return c},openMailListCom:function(c,g,f){var b=this;var d={};d.page=f.listcmd;if(neo.isSet(c,{blank:false})){d.key=c}url=desknets.getUrl(f.listmodule)+"?"+desknets.getNeoParam(b.getUniqueParams())+"#"+desknets.getNeoParam(d);try{if(window.name==f.wndname){window.name=""}window.open(url,f.wndname);if(g===true){b.loggingCountUp(f.logcntcmd,f.logcntmodule)}}catch(h){}},openMailView:function(e,f){var c=this;var d=c.getUrlMailView(e);var b=c.getWindowOpenOption();window.open(d,"_blank",b);if(f===true){c.loggingCountUp(c.CMD_MAILLOGCOUNTUP,c.MODULE_API_MAIL)}},openMailViewShare:function(f,e,g){var c=this;var d=c.getUrlMailView(f,e);var b=c.getWindowOpenOption();window.open(d,"_blank",b);if(g===true){c.loggingCountUp(c.CMD_MAILLOGCOUNTUP,c.MODULE_API_MAIL)}},getUrlMailView:function(f,d){var b=this;var e={};e.cmd=b.CMD_DNP_MAILVIEW;e.msgid=f;if(neo.isSet(d,{blank:false})){e.said=d}var c=b.MODULE_DNP_MAILC+"."+desknets.getExtension()+"?"+desknets.getNeoParam(e);return c},openMailEditByMailLink:function(d,e,c){var b=this;if(neo.isSet(c,{blank:false})){if(c=="3"){desknets.webmailimap.openMailEdit(d,e);return}}b.openMailEdit(d,e)},openMailEdit:function(c,e){var b=this;var d={};d.cmd=desknets.webmail.CMD_MAILACCOUNTS;d.proc=3;desknets.ajax.rest({async:false,url:desknets.getUrl(desknets.webmail.MODULE_DNP_MAIL),data:d,dataType:"xml",success:function(f){b._successGetAccount(c,e,a(f.documentElement))}})},_getMailEditSetting:function(){var b=this;var c={editmodule:b.MODULE_DNP_MAILJS,editcmd:b.PAGENAME_DNP_MAILEDIT};return c},_successGetAccount:function(e,f,d){var b=this;if(d.find(">list>item").length>0){b.openMailEditCom(e,f,b._getMailEditSetting())}else{var c="";c=d.find("accsetting").text();setTimeout(function(){if(c==="1"){var g=desknets.Resource.Message.mail_move_accset;desknets.dialog.confirm(g,function(){b.openSettingAccount()})}else{var g=desknets.Resource.Message.mail_noaccset;desknets.dialog.alert(g,{type:"warn"})}},10)}},openMailEditCom:function(h,f,l){var k=this;var j={};j.page=l.editcmd;j.method="POST";if(h){if(h.tmpnm){j.tmpnm=h.tmpnm}if(h.to){j.to=h.to}if(h.cc){j.cc=h.cc}if(h.bcc){j.bcc=h.bcc}if(h.accid){j.accid=h.accid}if(h.said){j.said=h.said}}var b=desknets.getUrl(l.editmodule)+"#"+desknets.getNeoParam(j);var g=k.getWindowOpenOption();if(!!h.subject||!!h.body){if(!f){f=a("body").find("#jco-mail-edit-form");if(f.length==0){f=a("<form />").attr("id","jco-mail-edit-form");f.appendTo("body")}}var i=k._getUniqueValue();var d=a('<input type="hidden" name="subject" />').val(h.subject||"");var e=a('<input type="hidden" name="body" />').val(h.body||"");var c=a('<input type="hidden" name="_" />').val(i||"");f.attr("method","POST").attr("target",i).attr("action",b).empty().append(d).append(e).append(c);window.open("",i,g);f.submit()}else{window.open(b,"_blank",g)}},openAddressList:function(c){var b=this;b.openAddressListCom(null,c,b._getAddressListSetting())},openAddressSearchList:function(c,d){var b=this;b.openAddressListCom(c,d,b._getAddressListSetting())},_getAddressListSetting:function(){var b=this;var c={listmodule:b.MODULE_DNP_MAILJS,wndname:b.WINDOW_NAME_DNP};return c},openAddressListCom:function(c,g,f){var b=this;var d={};d.page=b.PAGENAME_DNP_ADDRLIST;if(neo.isSet(c,{blank:false})){d.key=c}url=desknets.getUrl(f.listmodule)+"?"+desknets.getNeoParam(b.getUniqueParams())+"#"+desknets.getNeoParam(d);try{if(window.name==f.wndname){window.name=""}window.open(url,f.wndname);if(g===true){b.loggingCountUp(b.CMD_ADDRLOGCOUNTUP,b.MODULE_API_MAIL)}}catch(h){}},openSettingPage:function(c,e){var b=this;var d={};d.page=c;b.openSettingAccountCom(d,e,b._getSettingAccountSetting())},openSettingAccount:function(e,d){var b=this;var c={};c.page=b.PAGENAME_DNP_SETACCEDIT;if(!!e){c.id=e}b.openSettingAccountCom(c,d,b._getSettingAccountSetting())},openSettingAccountShare:function(e,d){var b=this;var c={};c.page=b.PAGENAME_DNP_SETSHAREACCEDIT;if(!!e){c.id=e}b.openSettingAccountCom(c,d,b._getSettingAccountSetting())},_getSettingAccountSetting:function(){var b=this;var c={accsetmodule:b.MODULE_DNP_MAILJS,logcntmodule:b.MODULE_API_MAIL,logcntcmd:b.CMD_MAILLOGCOUNTUP,wndname:b.WINDOW_NAME_DNP};return c},openSettingAccountCom:function(d,f,c){var b=this;url=desknets.getUrl(c.accsetmodule)+"?"+desknets.getNeoParam(b.getUniqueParams())+"#"+desknets.getNeoParam(d);try{if(window.name==c.wndname){window.name=""}window.open(url,c.wndname);if(f===true){b.loggingCountUp(c.logcntcmd,c.logcntmodule)}}catch(g){}},getWindowOpenOption:function(){var b="";if(!desknets.browser.android){var c=a(window);b=["location=no","menubar=no","resizable=yes","scrollbars=yes","status=no","toolbar=no","width="+c.width(),"height="+c.height()].join(",")}return b},getUniqueParams:function(){var b=this;var c={};c._=b._getUniqueValue();return c},_getUniqueValue:function(){var b=new Date().getTime();return b+""},loggingCountUp:function(c,b){desknets.ajax.rest({url:desknets.getUrl(b),data:{cmd:c,log:"on"}})},isDispAccountSettingLink:function(b){switch(b){case"-2710":case"-2711":case"-2712":case"-2719":case"-2727":case"-6040":case"-6083":return true}return false}};(function(b){desknets.page(desknets,"PagePaneListBase",desknets.PageListBase,{VAL_PAGEPANE_DEFSPLITSIZE:187,_selName:"",_firstFolder:"",_winHeight:"0",_moveParams:{},_boupdate:false,_boGetForce:false,_optTreeId:"data-fid",_initWidthPrm:{},_listSortable:desknets.ListSortablePane,_$draggable:null,_treeClass:null,_tmplFolderTitle:'<span class="overflow">{{foldername}}</span>',_initSet:function(){var c=this;c._initSetLeftTree();c.callBase("_initSet")},_initHtml:function(d){var c=this;c._selName="";c._firstFolder="";c.$mjListPage.empty();c.$mjListPage.html(d[0].html);c._initSetLeftTree();c._initListStart();c._mobjParams=b.extend({},c.getListParamToObj(),desknets.paramanalyzer.getHashParams());c.setNotChangeHash(false);c.setConnecting(false);c._initListEnd()},_initSetLeftTree:function(){var c=this;setTimeout(function(){c.initLeftTree()},1)},_getTreeClass:function(){var c=this;if(b.isEmptyObject(c._treeClass)){return null}return c._treeClass},initLeftTree:function(){},_optTreeGetCmd:function(){return{}},treeUpdateList:function(){},treeUpdateListWidth:function(){},_getSizeHideWidth:function(){return"0"},_optTreeIsEdit:function(){return false},_optTreeInitFuncDialog:function(d,c){},_isAccessCtrl:function(){return false},getInputFieldName:function(){return"folder"},_isMoveListItems:function(){if(desknets.browser.tablet){return false}return true},_isMoveListSeqno:function(){return false},_getSpliterAddOpt:function(){return{size:this.VAL_PAGEPANE_DEFSPLITSIZE}},_getFuncSpliterMove:function(){var c=this;c._updateRightListWidth();c._updateLeftListWidth()},_optTreeSelectFunc:function(i){var c=this;var g=i.attr(c._optTreeId);var h=c.$mjListPage.find(".jco-back-page-data");var e=c.getInputFieldName();var f=desknets.paramanalyzer.getHashParams();h.find('input[name="'+e+'"]').val(g);if(!neo.isSet(c._firstFolder)||c._firstFolder.length==0){var d=desknets.paramanalyzer.getLocationHash();var e=c.getInputFieldName();if(!neo.isSet(f.cmd)||f.cmd==c._getListCmd()){c._setTitlePane(i)}if(!neo.isSet(g,{blank:false})){g=f[e]}c._firstFolder=g;c._mobjParams[e]=g;c._mobjDefParams[e]=g;if(neo.isSet(g,{blank:false})&&c._boGetForce==true){c._boGetForce=false;c._listPage("0");return}else{if((typeof jsonRest)!="undefined"||(neo.isSet(d)&&d.length>0)){return}}c._getListAjax("0")}else{if(!c._boupdate&&(!!f&&f[e]!=g)){c._listPage("0")}else{c._boupdate=false}}},_optTreeAddFolderFunc:function(i,h){var c=this;var g=c.$mjListPage.find(".jco-back-page-data");var e=c.getInputFieldName();var f="";if(neo.isSet(i)&&i.length>0){f=i.attr(c._optTreeId);c._setTitlePane(i)}c.$mjListPage.find(".co-table-list").hide();c.$mjListPage.find(".co-list-sort").hide();c.$mjListPage.find(".co-chk-cnt2").children().hide();c.$mjTableList.empty();c.$mjListPage.find(".co-nodata").show();c.$mjListPage.find(".jco-pv-cnt").val("0");c.$mjListPage.find(".jco-pv-all-cnt").val("0");c._listPageLink();if(neo.isSet(h)&&h==true){return}g.find('input[name="'+e+'"]').val(f);c.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val("0");var d=desknets.getInputDataToUrl(c.$mjListPage.find(".jco-back-page-data"));d=d+"&cmd="+c._getListCmd();c._setLocationHash(d,true);desknets.moveScroll();c._setListviewHeight(c.$mjListPage,true);c._hashUpdatePageParams()},_optTreeResetFunc:function(d){var c=this;if(neo.isSet(d)&&d.length>0){c._setTitlePane(d)}else{c._selName="";c._setTitle(c._getAreaTitle(c.$mjListPage));c._optTreeAddFolderFunc()}},_getOptionLeftTree:function(){var c=this;var f=function(h){c._optTreeSelectFunc(h)};var d=function(h){c._optTreeResetFunc(h)};var e={initDialogFunc:c._optTreeInitFuncDialog,fieldName:c.getInputFieldName(),selFunc:f,idName:c._optTreeId,isEdit:c._optTreeIsEdit(),isCtrlAccess:c._isAccessCtrl(),resetFunc:d};if(c._optTreeIsEdit()==true){var g=function(h){c._optTreeAddFolderFunc(h)};e.addFunc=g}return e},_initListEnd:function(){var c=this;c.callBase("_initListEnd");b(window).resize(function(){if(desknets.browser.tablet&&b(".co-pop-up-box.show").length>0){return}c._setListviewHeight(c.$mjListPage,false)})},_isLeftBtnArea:function(){if(b(".co-listview-left-subtitle").length>0){return true}return false},_initListStart:function(){var c=this;c.callBase("_initListStart");c._listEndRightPane();c._listEndLeftPane()},_initListMain:function(){var c=this;var d=desknets.paramanalyzer.getLocationHash();if((typeof jsonRest)=="undefined"&&d==""&&(!neo.isSet(c._firstFolder)||c._firstFolder.length==0)){return}c.callBase("_initListMain")},_getListAjaxOptions:function(){var c=this;var d=c.callBase("_getListAjaxOptions");d.error=function(f,e,g){c._getListAjaxSuccess({});desknets.ajax.onError(f.status,g);c._boGetForce=true};return d},_initListEndButton:function(){var c=this;c.$mjListPage.find(".co-btn-update").click(function(d){var g=c.$mjListPage.find(".jco-back-page-data");var e=c.getInputFieldName();d.preventDefault();var f=g.find('input[name="'+e+'"]').val();if(neo.isSet(f)&&f.length>0){b(this).addClass("on");c._boupdate=true;c._getListAjax(c._getListRow());c.treeUpdateList();desknets.scrollManager.clearScrollPosition(c._getListCmd())}});c.$mjListPage.find(".jco-list-add-page").click(function(d){if(b(".co-move-list-overlay").length>0){return}c.inputAddPage(d)});c.$mjListPage.find(".jco-list-del-submit").click(function(d){c._listDelSubmit(d)})},_setListviewHeight:function(c,e){var d=this;desknets.listviewframe.updateListHeightScroll(c.find(".co-listview"),d._isLeftBtnArea());if(!neo.isSet(e)||e==true){d.treeUpdateListWidth()}},_listEndRightPane:function(){var d=this;var e=d.$mjListPage.find(".co-listview-scroll");var c=d.$mjListPage.find(".co-listview-listhead");if(!desknets.browser.tablet){e.scroll(function(){var f=e.find(".co-table-list").offset().left;if(f==0){f=e.offset().left}c.offset(function(){return{left:f}})})}if(d._isMoveListItems()){e.delegate("tr.ui-draggable,a","mousedown",function(){b(this).focus()});d._initRightItemDrag()}else{if(!!d._isMoveListSeqno()){d._initRightItemDragSeqno({})}}},_listEndLeftPane:function(){var c=this;if(c._isMoveListItems()){c._initLeftItemDrop()}},changPage:function(){var c=this;var h=c.$mjListPage.find(".co-listview");var j=c.$mjListPage.find(".jco-back-page-data");if(!!c._isMoveListSeqno()){c._listSortable.fixListItems()}else{if(neo.isSet(c._$draggable)){if(!!c._isMoveListEnable()){c._$draggable.draggable("enable")}else{c._$draggable.draggable("disable")}}}c.callBase("changPage");desknets.listviewframe.updateListHeightScroll(h,c._isLeftBtnArea());c._createLayout(h);var d=c.$mjListPage.find(".co-listview-scroll");var g=desknets.paramanalyzer.getLocationHash();var f=c.getInputFieldName();var i=j.find('input[name="'+f+'"]').val();var e=desknets.folderlist.getItemObject_li(h,i,c._getOptionLeftTree());if(g!=""&&(!neo.isSet(e)||e.length==0)||h.find(".jco-listview-tree-dmyitem").length>0){c.treeUpdateList()}},_listMoveScroll:function(){var d=this._getListCmd();var c=this.$mjListPage.find(".co-listview-scroll");desknets.scrollManager.setScrollPosition(d,c,{y:0,delay:10})},_createLayout:function(h){var d=this;var g=d.$mjListPage.find(".co-nodata");var f=function(){d._getFuncSpliterMove()};if(g.is(":hidden")&&!neo.isSet(d._initWidthPrm.spliter)){var c=d.$mjListPage.find(".co-listview-listhead").find(".jco-listview-widauto");var e=d.$mjListPage.find(".co-listview-scroll").find(".jco-listview-widauto:first");d._initWidthPrm.spliter=d._getSpliterAddOpt().size+1;d._initWidthPrm.head=c.width();d._initWidthPrm.scroll=e.width()}desknets.listviewspliter.create(h,f,true,d._getSpliterAddOpt())},_getInitWidthPrm:function(){return this._initWidthPrm},_updateLeftListWidth:function(){var c=this;c.treeUpdateListWidth()},_updateRightListWidth:function(){var k=this;var e=k._getSizeHideWidth();var h=k.$mjListPage.find("div.co-btnarea:first");if(h.width()<e){h.children(":not(.co-btn-update)").hide()}else{h.children(":not(.co-btn-update,.co-list-sort)").show();if(k.$mjListPage.find(".co-table-list").css("display")!="none"){h.children(".co-list-sort").show()}}var l=k._getInitWidthPrm();var d=k.$mjListPage.find(".ui-layout-resizer");if(neo.isSet(l.spliter)&&d.length>0){var g=k.$mjListPage.find(".co-listview").offset().left;var i=d.offset().left;var c=i-g;var f=k.$mjListPage.find(".co-listview-listhead").find(".jco-listview-widauto");var j=k.$mjListPage.find(".co-listview-scroll").find(".jco-listview-widauto:first");if(l.spliter>=c){f.width(l.head+l.spliter-c);j.width(l.scroll+l.spliter-c)}else{f.width(l.head);j.width(l.scroll)}}},_hashUpdateListPage:function(f){var e=this;var i=e.$mjListPage.find(".jco-back-page-data");var g=e.getInputFieldName();var h=f[g];if(!neo.isSet(h,{blank:false})){h=e._firstFolder}i.find('input[name="'+g+'"]').val(h);e.callBase("_hashUpdateListPage",f);setTimeout(function(){desknets.folderlist.onSelectItemNoAjax(e.$mjListPage.find(".co-listview-tree"),h,e._getOptionLeftTree())},500);var c=desknets.folderlist.getItemObject_li(e.$mjListPage.find(".co-listview-tree"),h,e._getOptionLeftTree());e._setTitlePane(c);var d=e._getTreeClass();if(!!d){d._setButtonErea(c.find("a.co-listview-item-inside"))}},_setTitlePane:function(d){var c=this;var f="";f=desknets.folderlist.getItemTitle(d);if(f.length==0){if((typeof jsonRestFolder)!="undefined"&&jsonRestFolder.list){var e=jsonRestFolder.folder;if(neo.isSet(jsonRestFolder.list.item)&&jsonRestFolder.list.item){f=c._getNameJsonRest(jsonRestFolder.list.item,e)}}if(f.length==0){return}}c._selName=f;c._setTitle(c._getAreaTitle(c.$mjListPage))},_getAreaTitle:function(c){var e=this;var d=e._tmplFolderTitle;d=desknets.tmpl.replaceWordChk(d,"foldername",e._selName);if(neo.isSet(e._selName,{blank:false})){d=" > "+d}return e.callBase("_getAreaTitle",c)+d},_getNameJsonRest:function(f,e){var c=this;var d="";b.each(f,function(g,h){if(h.id==e){d=h.Name;return false}else{if(h.list&&h.list.item){d=c._getNameJsonRest(h.list.item,e);if(d.length>0){return false}}}});return d},_initRightItemDrag:function(){var d=this;var f=d.$mjListPage.find("div.co-listview-scroll");var c=d.$mjTableList;var e={appendTo:"body",handle:"tr",distance:5,helper:function(i){var r=i.originalEvent;if(!r){return"<div />"}var k=r.target||r.srcElement;var g=b(k).closest("tr");var q=d.$mjListPage.find("div.co-listview").is(".selmulti"),h=f.find("tr>td.co-chk").find("input:first"),n=g.find("td.co-chk").find("input:first"),j=g.find(".jco-dragname").text();if(!neo.isSet(j,{blank:false})){return"<div />"}if(!g.hasClass("co-tr-selected")){var p=f.find("tr");p.find("td>input").attr("checked",false);p.removeClass("co-tr-selected");g.addClass("co-tr-selected")}var m=f.find(".co-tr-selected").find("input:first");if(q&&m.length>0){n.attr("checked",true);h.trigger("change");if(m.length>1){var o=d.$mjListPage;var l=m.length;if(o.find(".co-chk-cnt-all:not(:hidden)").length>0){l=o.find(".jco-pv-all-cnt").val()}j=d._getMultiCheckedName(l)}}else{h.attr("checked",false);n.attr("checked",true);h.trigger("change")}j=desknets.tmpl.escapeWord(j);if(desknets.browser.msie8){return b('<div id="co-dragtip-ie8"><div class="dragtip" title="'+j+'">'+j+'</div><div class="ieShadow"></div></div>')}else{return b('<div id="co-dragtip" title="'+j+'">'+j+"</div>")}},cursor:"default",cursorAt:{top:0,left:0},start:function(g,h){if(b("#co-dragtip").length==0&&b("#co-dragtip-ie8").length==0){return}d.$mjListPage.find(".ui-layout-resizer").css({"z-index":0});d._startLeftMove()},stop:function(g,h){d.$mjListPage.find(".ui-layout-resizer").css({"z-index":1})}};b.extend(e,d._addOptDraggableList());if(!!d._isMoveListSeqno()){d._initRightItemDragSeqno(e)}else{c.draggable(e);d._$draggable=c}},_addOptDraggableList:function(){return{}},_isMoveListEnable:function(){return true},_initRightItemDragSeqno:function(e){var c=this;var d=c._getSortableOptions();b.extend(d,e);c._listSortable=new desknets.ListSortablePane(c.$mjListPage,d)},_getSortableOptions:function(){var c=this;return{url:desknets.getUrl(c._getRestModule()),sortCmd:c._getSortableListCmd(),getAdditionalData:function(){return b.extend({cmd:c._getListExecCmd()},c.getListParamToObj())},change:function(d){c._getListAjaxSuccess(d)}}},_startLeftMove:function(){var c=this;var d=c.$mjListPage.find(".co-listview-tree");d.css("background","#f5faff");var e=d.find("li.co-listview-item");e.each(function(){var h=b(this);var g=h.children("a:first");var f=g.data("access");if((c._isAccessCtrl()==true&&neo.isSet(f)&&(f&2)==0)||g.hasClass("on")||h.hasClass("jco-tree-nodrop")||h.hasClass("co-listview-tree-rootli-nosel")){g.addClass("co-tree-noselect")}})},_initLeftItemDrop:function(){var c=this;var d=c.$mjListPage.find("div.co-listview-tree:not(.ui-droppable)");if(!neo.isSet(d)||d.length==0){return}d.droppable({accept:".co-tbody-list",hoverClass:"co-listview-dropover",tolerance:"pointer",drop:function(i,h){var g=b(this);if(!!c._isMoveListSeqno()){g.addClass("jco-tree-dropend")}var f=g.find("li:not(.jco-tree-nodrop)>a").filter(function(){return b(this).hasClass("co-tree-dropactive")});g.find("a.co-listview-item-inside").removeClass("co-tree-dropactive");if(f.length==0||f.hasClass("co-tree-noselect")){return}else{if(b("#co-dragtip").length==0&&b("#co-dragtip-ie8").length==0){return}else{c._dropMoveConf(f.eq(0))}}},activate:function(g,f){b(this).delegate("a.co-listview-item-inside","hover.paneDrop",function(e){if(e.type=="mouseenter"){b(this).addClass("co-tree-dropactive")}else{b(this).removeClass("co-tree-dropactive")}})},deactivate:function(g,f){b(this).undelegate("a.co-listview-item-inside","hover.paneDrop")}})},_getMultiCheckedName:function(d){var c=desknets.Resource.Message.com_folder_listdrag;c=desknets.tmpl.replaceWordHtml(c,"count",d);return c},_dropMoveConf:function(c){var d=this;var e=desknets.getUrl(d._getRestModule());var g=d._getRequestMoveConfParams(c);if(g.cmd==null||g.cmd.length==0){var h=d._moveConfMessage();var f={message:h};d._onSuccessMoveConf(c,f);return}desknets.ajax.rest({url:e,data:g,id:"desknets-page",success:function(j,i,k){d._onSuccessMoveConf(c,j)},traditional:true})},_getRequestMoveConfParams:function(e){var k=this;var c=k.$mjListPage.find(".jco-back-page-data");var j=k.getInputFieldName();var d=[];var f=c.find('input[name="'+j+'"]').attr("value");var g=k._getMoveAddPrm();g[j]=f;g.destid=e.closest("li").attr(k._optTreeId);if(k.$mjListPage.find(".co-chk-cnt-all:not(:hidden)").length>0){g.id="all"}else{var h=k.$mjListPage.find(".co-listview-scroll");var i=h.find("tr.co-tr-selected");i.each(function(l,m){d[d.length]=b(this).find(".jco-id").val()});g.id=d}k._moveParams=b.extend({},g);g.cmd=k._getMoveListConfCmd();return g},_moveConfMessage:function(){var d=this;var c="";if(d.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.com_move_allconf}else{if(d.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){c=desknets.Resource.Message.com_move_someconf}else{c=desknets.Resource.Message.com_move_listconf}}return desknets.tmpl.replaceWordHtml(c,"count",d._getListCheckCount())},_onSuccessMoveConf:function(c,e){var d=this;var i="";var h=desknets.folderlist.getItemTitle(c.parent());if(e.message){i=e.message}var g={extraMessage:desknets.folderlist.makeMoveMessage(h)};var f=desknets.dialog.confirm(i,function(){desknets.submitform.setDialogDisabled(f);d._inputMoveSubmit(f);return false},g)},_inputMoveSubmit:function(f){var c=this;var e;var d;var g={};g=c._moveParams;g.cmd=c._getMoveListCmd();d=desknets.getUrl(c._getRestModule());desknets.ajax.rest(b.extend({url:d,data:g,success:function(){c.$mjListPage.find(".co-btn-update").addClass("on");c._getListAjax(c._getListRow());c._moveSuccessAddFunc()},complete:function(){if(!!f){desknets.submitform.clearDialogDisabled(f);f.dialog("close")}},traditional:true},c._getMoveSubmitParams()))},setlistSortableDisabled:function(){this._listSortable.disable()},setlistSortableEnabled:function(){this._listSortable.enable()},_getMoveSubmitParams:function(){return{}},_moveSuccessAddFunc:function(){return},_getMoveAddPrm:function(){return{}},_getMoveListConfCmd:function(){return""},_getSortableListCmd:function(){return""},_getMoveListCmd:function(){return""}})})(jQuery);(function(b){desknets.page(desknets,"PagePaneInputBase",desknets.PageInputBase,{_tmpSelItem:'<span class="co-selitem"><span title="{{Name}}">{{Name}}</span><a class="co-btn co-btn-close co-selitem-close" href="#" title="{{Del}}">x</a><input type="hidden" name="{{fField}}" value="{{fId}}" /></span>',_optTreeId:"data-fid",_loadTree:false,_loadInput:false,_initHtml:function(d){var c=this;c._tmpSelItem=desknets.tmpl.replaceWordHtml(c._tmpSelItem,"fField",c.getInputFieldName());c._tmpSelItem=desknets.tmpl.replaceWordHtml(c._tmpSelItem,"Del",desknets.Resource.deselectLabel);c._loadTree=false;c._loadInput=false;setTimeout(function(){c.initLeftTree()},1);c.callBase("_initHtml",d)},initLeftTree:function(){},_optTreeGetCmd:function(){},treeUpdateListWidth:function(){},getInputFieldName:function(){return"folder"},_isAccessCtrl:function(){return false},_isMultiSelect:function(){return false},_optTreeSelectFunc:function(i){var d=this;var g=d.$mjPage.find("#jco-add-folder");var e=d._tmpSelItem;var f=i.attr(d._optTreeId);var h=desknets.folderlist.getItemTitle(i);h=desknets.tmpl.escapeWord(h);e=desknets.tmpl.replaceWordHtml(e,"Name",h);e=desknets.tmpl.replaceWordHtml(e,"fId",f);if(d._isMultiSelect()==false){g.find(".co-selitem").remove()}g.find(".co-selitem-msg").before(e);d._selectInputTree();if(desknets.browser.msie8){var c=g.html();g.html(c)}},_getOptionLeftTree:function(){var d=this;var f=function(h){d._optTreeSelectFunc(h)};var g=function(){d._setTreeLoadEnd("tree")};var c=function(){d._selectInputTree()};var e={selFunc:f,fieldName:d.getInputFieldName(),idName:d._optTreeId,isCtrlAccess:d._isAccessCtrl(),loadFunc:g};if(!!d._isMultiSelect()){e.openFunc=c}return e},changPage:function(){var c=this;c.callBase("changPage");c._setListviewHeight(c.$mjPage);c._createEventInputPane(c.$mjPage);if(c._isMultiSelect()){c._setTrimSelFolder()}c._setListFolderIDSync();c._setTreeLoadEnd("input")},_setListFolderIDSync:function(){var d=this;var c=d.getLocationFormParam();var f=d.getInputFieldName();if(c&&!neo.isSet(c[f],{blank:false})){var e=desknets.paramanalyzer.getHashParams();if(neo.isSet(e[f],{blank:false})){b("#"+d.mIdBack).find(".jco-back-page-data").find('input[name="'+f+'"]').val(e[f])}}},_setTrimSelFolder:function(){var c=this;var d=c.$mjPage.find("#jco-add-folder");var e=d.find(".co-selitem");d.find(".co-selitem").remove();b.each(e,function(f,g){d.find(".co-selitem-msg").before(g)})},_setTreeLoadEnd:function(d){var c=this;if(d=="tree"){c._loadTree=true}else{if(d=="input"){c._loadInput=true}}if(!!c._loadTree&&!!c._loadInput){c._selectInputTree()}},_selectInputTree:function(){var c=this;var d=c.$mjPage.find(".co-listview-tree");var f=c.$mjPage.find("#jco-add-folder").find(".co-selitem");var e=c.getInputFieldName();d.find("a.co-listview-item-inside").removeClass("on");b.each(f,function(j,k){var h=b(this);var m=h.find('input[name="'+e+'"]').val();if(c._isMultiSelect()==false){desknets.folderlist.onSelectItemNoAjax(d,m,c._getOptionLeftTree())}else{var l=desknets.folderlist.getItemObject_li(d,m,c._getOptionLeftTree());var g=l.children("a:first");if(g.hasClass("on")==false){g.addClass("on")}}})},_setListviewHeight:function(c,e){var d=this;desknets.listviewframe.updateInputHeight(c.find(".co-listview"));if(!neo.isSet(e)||e==true){d.treeUpdateListWidth()}},_createEventInputPane:function(e){var c=this;var d=c.$mjPage.find(".co-listview-tree");e.find(".co-listview").delegate(".co-selitem-close","click",function(h){var g=b(this).parent();var f=g.next();h.preventDefault();g.remove();if(c.$mjPage.find("#jco-add-folder").find(".co-selitem").length==0){f.height()}c._selectInputTree()});if(e.find("textarea").length>0){e.find(".co-listview").delegate("textarea","mouseup",function(){c._setListviewHeight(e)})}},_inputAjaxFormOption:function(){var c=this;var d=c.callBase("_inputAjaxFormOption");d.success=function(f,e,g){c._updatePageListId(f);c._setLocationHashForm()};return d},_updatePageListId:function(e){var c=this;var h=b("#"+c.mIdBack).find(".jco-back-page-data");var g=c.$mjPage.find("#jco-add-folder");var d=c.getInputFieldName();var f=g.find(".co-selitem").eq(0).find('input[name="'+d+'"]').val();h.find('input[name="'+d+'"]').val(f)}})})(jQuery);(function(b){desknets.page(desknets,"PagePaneDispBase",desknets.PageDispBase,{_optTreeId:"data-fid",_treeClass:null,_initHtml:function(d){var c=this;setTimeout(function(){c.initLeftTree()},1);c.callBase("_initHtml",d)},_optTreeSelectFunc:function(g){var c=this;var f=g.attr(c._optTreeId);var e=c.getInputFieldName();var d=c._optTreeSelItemParams();d[e]=f;d.row="0";if(neo.isSet(d)){c._setLocationHash(d)}},_optTreeSelItemParams:function(){return this.getLocationFormParam()},_getOptionLeftTree:function(){var c=this;var e=function(f){c._optTreeSelectFunc(f)};var d={selFunc:e,fieldName:c.getInputFieldName(),idName:c._optTreeId};return d},_getSpliterAddOpt:function(){return{}},changPage:function(){var c=this;c.callBase("changPage");c._createEventDispPane(c.$mjPage);c._setListviewHeight(c.$mjPage);c._setListFolderIDSync();c._createLayout(c.$mjPage.find(".co-listview"))},_setListFolderIDSync:function(){var d=this;var c=d.getLocationFormParam();var f=d.getInputFieldName();if(c&&!neo.isSet(c[f],{blank:false})){var e=desknets.paramanalyzer.getHashParams();if(neo.isSet(e[f],{blank:false})){b("#"+d.mIdBack).find(".jco-back-page-data").find('input[name="'+f+'"]').val(e[f])}}},_createLayout:function(g){var d=this;var e=function(){if(!neo.isSet(d._treeClass)||d._treeClass.boGet){d._setListviewHeight(d.$mjPage)}};var c=function(){if(d._treeClass&&!d._treeClass.boGet){d._treeClass.getDispTreeAjax(e)}};var f={togglerLength_open:"100%",initClosed:true,resizable:false,onopen_start:c};b.extend(f,d._getSpliterAddOpt());desknets.listviewspliter.create(g,e,true,f)},_setListviewHeight:function(c,e){var d=this;desknets.listviewframe.updateInputHeight(c.find(".co-listview"));if(!neo.isSet(e)||e==true){d.treeUpdateListWidth()}},initLeftTree:function(){},_optTreeGetCmd:function(){},treeUpdateListWidth:function(){},_createEventDispPane:function(c){return},getInputFieldName:function(){return"folder"}})})(jQuery);desknets.listviewspliter={VAL_LISTVIEWSPLITER_RAYOUTSIZE:187,VAL_LISTVIEWSPLITER_RAYOUTWIDTH_O:12,VAL_LISTVIEWSPLITER_RAYOUTWIDTH_C:12,VAL_LISTVIEWSPLITER_RAYOUTMINSIZE:161,create:function(h,f,b,e){var c=this;var d=c.setOptions(h,b);if(neo.isSet(f)&&a.isFunction(f)){d.onresize_end=f;if(neo.isSet(b)&&b==true){d.onclose_end=f;d.fxName_close="none"}}if(neo.isSet(e)){a.extend(d,e)}var g=h.layout(d);g.resizeAll()},setOptions:function(g,c){var d=this;var f=false;var e={};if(neo.isSet(c)&&c==true){f=true}var b=g.width()-d.VAL_LISTVIEWSPLITER_RAYOUTWIDTH_O;return{zIndex:0,size:d.VAL_LISTVIEWSPLITER_RAYOUTSIZE,maxSize:b,spacing_open:d.VAL_LISTVIEWSPLITER_RAYOUTWIDTH_O,spacing_closed:d.VAL_LISTVIEWSPLITER_RAYOUTWIDTH_C,closable:f,scrollToBookmarkOnLoad:false,slidable:false,togglerTip_open:desknets.Resource.resizeCloseLabel,togglerTip_closed:desknets.Resource.resizeOpenLabel,togglerLength_closed:"100%",resizerTip:desknets.Resource.resizeWidthLabel}},destroy:function(b){b.layout().destroy()}};desknets.pagetitle={mtitle:"",init:function(){var b=this;b.mtitle=document.title},setNeoTitle:function(g,b,d){var c=this;var f="";var e=0;e=Number(g)+Number(b)+Number(d);if(e>0){f=desknets.tmpl.replaceWord(desknets.Resource.com_page_title,"count",e)+" - "}f=f+c.mtitle;document.title=f;if(a.browser.msie&&!!document.attachEvent){neouploader.setDocumentTitle(f)}}};desknets.webmailimap={WINDOW_NAME_DNP:"dnwmailimap",MODULE_DNP_MAILJS:"zwimapwmljs",MODULE_DNP_MAIL:"zrwimapeml",CMD_MAILACCOUNTS:"mailaccountentry",PAGENAME_DNP_MAILLIST:"MailList",PAGENAME_DNP_MAILVIEW:"MailView",PAGENAME_DNP_MAILEDIT:"MailEdit",PAGENAME_DNP_SETACCEDIT:"SettingAccountEdit",MODULE_API_MAIL:"zrmailimap",CMD_MAILLOGCOUNTUP:"mailimapcmdlogcountup",openMailList:function(c){var b=this;desknets.webmail.openMailListCom(null,c,b._getMailListSetting())},openMailSearchList:function(c,d){var b=this;desknets.webmail.openMailListCom(c,d,b._getMailListSetting())},_getMailListSetting:function(){var b=this;var c={listmodule:b.MODULE_DNP_MAILJS,listcmd:b.PAGENAME_DNP_MAILLIST,logcntmodule:b.MODULE_API_MAIL,logcntcmd:b.CMD_MAILLOGCOUNTUP,wndname:b.WINDOW_NAME_DNP};return c},openMailView:function(e,g,f){var c=this;var d=c.getUrlMailView(e,g);var b=desknets.webmail.getWindowOpenOption();window.open(d,"_blank",b);if(f===true){desknets.webmail.loggingCountUp(c.CMD_MAILLOGCOUNTUP,c.MODULE_API_MAIL)}},getUrlMailView:function(e,f){var b=this;var d={};d.page=b.PAGENAME_DNP_MAILVIEW;d.id=e;d.fid=f;var c=b.MODULE_DNP_MAILJS+"."+desknets.getExtension()+"?"+desknets.getNeoParam(desknets.webmail.getUniqueParams())+"#"+desknets.getNeoParam(d);return c},openMailEdit:function(c,e){var b=this;var d={};d.cmd=b.CMD_MAILACCOUNTS;desknets.ajax.rest({async:false,url:desknets.getUrl(b.MODULE_DNP_MAIL),data:d,dataType:"xml",success:function(f){b._successGetAccount(c,e,a(f.documentElement))}})},_getMailEditSetting:function(){var b=this;var c={editmodule:b.MODULE_DNP_MAILJS,editcmd:b.PAGENAME_DNP_MAILEDIT};return c},_successGetAccount:function(f,g,e){var c=this;var b=e.find("userid").text();if(neo.isSet(b,{blank:false})){desknets.webmail.openMailEditCom(f,g,c._getMailEditSetting())}else{var d=e.find("accsetting").text();setTimeout(function(){if(d==="1"){var h=desknets.Resource.Message.mail_move_accset;desknets.dialog.confirm(h,function(){c.openSettingAccount()})}else{var h=desknets.Resource.Message.mail_noaccset;desknets.dialog.alert(h,{type:"warn"})}},10)}},openAddressList:function(c){var b=this;desknets.webmail.openAddressListCom(null,c,b._getAddressListSetting())},openAddressSearchList:function(c,d){var b=this;desknets.webmail.openAddressListCom(c,d,b._getAddressListSetting())},_getAddressListSetting:function(){var b=this;var c={listmodule:b.MODULE_DNP_MAILJS,wndname:b.WINDOW_NAME_DNP};return c},openSettingPage:function(c,e){var b=this;var d={};d.page=c;desknets.webmail.openSettingAccountCom(d,e,b._getSettingAccountSetting())},openSettingAccount:function(e,d){var b=this;var c={};c.page=b.PAGENAME_DNP_SETACCEDIT;if(!!e){c.id=e}desknets.webmail.openSettingAccountCom(c,d,b._getSettingAccountSetting())},_getSettingAccountSetting:function(){var b=this;var c={accsetmodule:b.MODULE_DNP_MAILJS,logcntmodule:b.MODULE_API_MAIL,logcntcmd:b.CMD_MAILLOGCOUNTUP,wndname:b.WINDOW_NAME_DNP};return c}};desknets.autosave={mtimer:null,mtimersec:60000,mobjprm:{},moption:{},_mdeloption:{cmdsave:"autosave",cmdatt:"autosaveatt",cmdattrte:"autosaveatt",cmdchk:"autosavechk",cmddel:"autosavedel",cmdformat:"autosaveformat",cmdget:"autosaveget",cmdgetatt:"autosavegetatt",cmdgetrte:"autosavegetatt",cmdgetformat:"autosavegetformat"},init:function(c){var b=this;b._mdeloption.url=desknets.getUrl("zrautosave");b.moption=a.extend({},b._mdeloption,c);b.mtimersec=Number(c.time)*60000},start:function(){var b=this;if(b.mtimer===null){b.mtimer=setInterval(function(){b.save(false,false)},b.mtimersec)}b.mobjprm=b.savePrm()},stop:function(){var b=this;if(!!b.mtimer){clearTimeout(b.mtimer);b.mtimer=null}},restart:function(){var b=this;b.stop();b.start()},save:function(f,e){var c=this;var b=c.savePrm();if(f==="1"){c.stop()}else{if(e!=="1"){if(JSON.stringify(c.mobjprm)==JSON.stringify(b)){return}}}var g=true;if(e==="1"){g=false}var d={};d[0]=a.extend({},b);var h=desknets.ajax.arrayToMultiCmdData(d);desknets.ajax.rest({url:c.moption.url,async:g,data:h,success:function(j,i,k){c.mobjprm=b},error:function(k,i,j){desknets.ajax.onError(k.status,j)},})},savePrm:function(){var b=this;var c={};c=b.comPrm(c);c.cmd=b.moption.cmdsave;if(a.isFunction(b.moption.funcentry)){c=b.moption.funcentry(c)}return c},comPrm:function(c){var b=this;if(b.moption.mod){c.flag="1"}else{c.flag="0"}c.module=b.moption.module;c.autosaveid=b.moption.userid;return c},chk:function(){var b=this;desknets.ajax.rest({url:b.moption.url,data:b.chkPrm(),success:function(d,c,e){if(a.isFunction(b.moption.funcchk)){b.moption.funcchk(d)}},error:function(e,c,d){if(a.isFunction(b.moption.funcerrchk)){b.moption.funcerrchk()}desknets.ajax.onError(e.status,d)},})},chkPrm:function(){var b=this;var c={};c=b.comPrm(c);c.cmd=b.moption.cmdchk;c.fieldid=b.moption.fieldid;return c},get:function(){var c=this;var d={};var h=0;var i={};d[h]=c.getPrm();i[h]="cmdget";var f=c.getAttPrm();if(f!=null){h++;d[h]=f;i[h]="cmdgetatt"}var b=c.getRtePrm();if(b!=null){h++;d[h]=b;i[h]="cmdgetrte"}var e=c.getFormatPrm();if(e!=null){h++;d[h]=e;i[h]="cmdgetformat"}var g=desknets.ajax.arrayToMultiCmdData(d);desknets.ajax.rest({url:c.moption.url,async:false,data:g,success:function(k,j,l){if(a.isFunction(c.moption.funcget)){c.moption.funcget(k,i)}c.start()},error:function(l,j,k){desknets.ajax.onError(l.status,k)},detectMultiError:true,})},getPrm:function(){var b=this;var c={};c=b.comPrm(c);c.cmd=b.moption.cmdget;return c},getAttPrm:function(){var b=this;var c={};if(!b.moption.cmdgetatt||!b.moption.attachname){return null}c=b.comPrm(c);c.cmd=b.moption.cmdgetatt;c.attachname=b.moption.attachname;if(!!b.moption.tmpnm){c.tmpnm=b.moption.tmpnm}return c},getRtePrm:function(){var b=this;var c={};if(!b.moption.cmdgetrte||!b.moption.rtename){return null}c=b.comPrm(c);c.cmd=b.moption.cmdgetrte;c.attachname=b.moption.rtename;return c},getFormatPrm:function(){var b=this;var c={};if(!b.moption.cmdgetformat||!b.moption.format){return null}c=b.comPrm(c);c.cmd=b.moption.cmdgetformat;c.format=b.moption.format;return c},del:function(){var b=this;desknets.ajax.rest({url:b.moption.url,data:b.delPrm(),success:function(d,c,e){if(a.isFunction(b.moption.funcdel)){b.moption.funcdel(d)}},error:function(e,c,d){desknets.ajax.onError(e.status,d)},})},delPrm:function(){var b=this;var c={};c=b.comPrm(c);c.cmd=b.moption.cmddel;return c},attachsave:function(){var b=this;if(!!b.mtimer){var c={};c[0]=b.savePrm();c[1]=b.attachPrm();var d=desknets.ajax.arrayToMultiCmdData(c);desknets.ajax.rest({url:b.moption.url,data:d,success:function(f,e,g){b.mobjprm=c[0]},error:function(g,e,f){desknets.ajax.onError(g.status,f)},detectMultiError:true,})}},attachPrm:function(){var b=this;var c={};c=b.comPrm(c);c.cmd=b.moption.cmdatt;c.attachname=b.moption.attachname;if(!!b.moption.tmpnm){c.tmpnm=b.moption.tmpnm}return c},attachrtesave:function(){var b=this;if(!!b.mtimer){var c={};c[0]=b.savePrm();c[1]=b.attachrtePrm();var d=desknets.ajax.arrayToMultiCmdData(c);desknets.ajax.rest({url:b.moption.url,data:d,success:function(f,e,g){b.mobjprm=c[0]},error:function(g,e,f){desknets.ajax.onError(g.status,f)},detectMultiError:true,})}},attachrtePrm:function(){var b=this;var c={};c=b.comPrm(c);c.cmd=b.moption.cmdattrte;c.attachname=b.moption.rtename;return c},formatsave:function(){var b=this;if(!!b.mtimer){var c={};c[0]=b.savePrm();c[1]=b.formatPrm();var d=desknets.ajax.arrayToMultiCmdData(c);desknets.ajax.rest({url:b.moption.url,data:d,success:function(f,e,g){},error:function(g,e,f){desknets.ajax.onError(g.status,f)},detectMultiError:true,})}},formatPrm:function(){var b=this;var c={};c=b.comPrm(c);c.cmd=b.moption.cmdformat;c.format=b.moption.format;return c},};desknets.connectapp={MODULE_INFO:"zinfo",MODULE_CREPORT:"zcreport",MODULE_API_INFO:"zrinfo",objConnectData:{},getConnectData:function(c){var b=this;return b.objConnectData[c]},_setConnectData:function(c,d){var b=this;b.objConnectData[c]=d},connectMail:function(c){var b=this;var d;var e=desknets.Resource.Message.com_open_mailadd;d=desknets.dialog.confirm(e,function(){desknets.submitform.setDialogDisabled(d);b._connectMail(c)})},_connectMail:function(f){var d=this;var i={};var h={};var e={};var b=desknets.pageframe.getLoginConnectMail();var c="2";var g="mail";if(b=="2"){c="3";g="mailimap"}h.cmd=f.restcmd;h.connectid=f.connectid;h.module=g;e.async=false;e.url=desknets.getUrl(f.restmodule);e.data=h;e.success=function(k,j,l){if(e.dataType=="xml"){k=d._convXmlToObj(k)}i.subject=k.title;i.body=k.content;i.tmpnm=k.tmpnm;desknets.webmail.openMailEditByMailLink(i,null,c)};if(f.restcmd&&f.restcmd.indexOf("mail")==0){e.dataType="xml"}desknets.ajax.rest(e)},connectInfo:function(f,g){var c=this;var e={};var b={};var d;e.cmd="infoeditindex";b.cmd="infoentry";b.fid="0";d=c._getURL(c.MODULE_INFO,e,b);f.connectto="info";f.entrypageurl=d;if(g===true){c._connectApp(f)}else{c.checkAccsInfoCategory(function(h){if(h===true){c._connectInfo(f)}else{desknets.dialog.alert(desknets.Resource.Message.info_guide_add_noperm,{type:"warn"})}})}},checkAccsInfoCategory:function(e){var b=this;var d={};var c={};d.cmd="infocatelist";d.folder="0";c.async=false;c.url=desknets.getUrl(b.MODULE_API_INFO);c.data=d;c.success=function(g,f,i){var h=false;if(g&&g.list){h=b._hasAccsInfoCategory(g.list)}if(a.isFunction(e)){e(h)}};desknets.ajax.rest(c)},_hasAccsInfoCategory:function(e){var c=this;var b;var f=false;var d=2;if(!e||!e.item){return false}b=a.isArray(e.item)?e.item:[e.item];a.each(b,function(h,j){var g=j.accesskind;if(g&&((Number(g)&d)==d)){f=true;return false}if(j.list){if(c._hasAccsInfoCategory(j.list)){f=true;return false}}});return f},_connectInfo:function(c){var b=this;var d;var e=desknets.Resource.Message.com_open_infoadd;d=desknets.dialog.confirm(e,function(){desknets.submitform.setDialogDisabled(d);b._connectApp(c)})},connectCreport:function(c){var b=this;var d;var e=desknets.Resource.Message.com_open_creportadd;d=desknets.dialog.confirm(e,function(){desknets.submitform.setDialogDisabled(d);b.connectCreportNoConf(c)})},connectCreportNoConf:function(f){var c=this;var e={};var b={};var d;e.cmd="creportindex";b.cmd="creportcmdentrypage";d=c._getURL(c.MODULE_CREPORT,e,b);f.connectto="creport";f.entrypageurl=d;c._connectApp(f)},connectSch:function(c){var b=this;var d;var e=desknets.Resource.Message.com_open_schadd;d=desknets.dialog.confirm(e,function(){desknets.submitform.setDialogDisabled(d);b.connectSchNoConf(c)})},connectSchNoConf:function(f){var c=this;var e={};var b={};var d;var h=desknets.pageframe.getLoginUid();var g=neo.dateTime.format("yyyyMMdd",desknets.pageframe.getServerDate());e.cmd="schindex";b.cmd="schadd";b.date=g;b.enddate=g;b.id=h;d=c._getURL(desknets.MODULE_MAIN,e,b);f.connectto="sch";f.entrypageurl=d;c._connectApp(f)},_getURL:function(g,f,b){var c=this;var e={};var d;e.link="1";a.extend(b,e);d=desknets.getUrl(g);d+="?"+desknets.getNeoParam(f);d+="#"+desknets.getNeoParam(b);return d},_connectApp:function(d){var b=this;var e={};var c={};e.cmd=d.restcmd;e.connectid=d.connectid;e.module=d.connectto;c.async=false;c.url=desknets.getUrl(d.restmodule);c.data=e;if(d.restcmd&&d.restcmd.indexOf("mail")==0){c.dataType="xml"}c.success=function(g,f,h){if(c.dataType=="xml"){g=b._convXmlToObj(g)}b._setConnectData(d.connectto,g);desknets.execLocation(d.entrypageurl,"_blank")};desknets.ajax.rest(c)},_convXmlToObj:function(e){var m=this;var j,i;var f={};var b=a(e);f.title=b.find("title").text();f.content=b.find("content").text();i=b.find("tmpnm");if(i.length>0){f.tmpnm=i.text()}j=b.find("rteatt");if(j.length>0){var h=[];var c={item:h};var g=j.find("item");for(var l=0;l<g.length;l++){var k=g.eq(l);var d={id:k.attr("id"),attachdisp:k.find("attachdisp").text(),mimetype:k.find("mimetype").text(),size:k.find("size").text()};h.push(d)}f.rteatt={attach:c}}return f},};desknets.page(desknets,"PageListBatSearchBase",desknets.PageListBase,{_searching:false,_onStopsearching:false,_searchParams:{},_interval:3000,_onSrchExec:false,$dialogexec:null,_initGetHtml:function(){var b=this;var c={};b._searching=true;if(a("#jco-m-search-container").find(".jco-title").length>0){var d=desknets.paramanalyzer.getHashParams();b._getListAjax(d.row);return}b._onSrchExec=true;b.callBase("_initGetHtml")},_initHtml:function(c){var b=this;b.$mjListPage.empty();b.$mjListPage.html(c[0].html);b._initListStart();b._mobjParams=desknets.paramanalyzer.getHashParams();b._hashUpdatePageParams();b.setNotChangeHash(false);b.setConnecting(false);b._getListAjax(b._getListRow());b._initListEnd()},_getSearchPageParam:function(){var b={};b.cmd=this._getListCmd();return b},_getListAjax:function(c){var b=this;if(b._onStopsearching==true){return}b.callBase("_getListAjax",c)},_getListAjaxSuccess:function(c){var b=this;if(!b._getListAjaxSuccessCheck(c)){b._hashUpdatePageParams();return}b.callBase("_getListAjaxSuccess",c)},_getListAjaxSuccessCheck:function(c){var b=this;b._setExecSearchPrm();if(c.searching=="1"){b.observe();b._openSearchMessageDialog();return false}b._searching=false;var d=b.$dialogexec;if(!!d&&d.dialog("isOpen")){d.dialog("close")}return true},getListParamToObj:function(){var b=this;var c={};c=b.callBase("getListParamToObj");if(b._isExecBatSearch()||b._onSrchExec==true){b._searching=true;c.init="1"}b._onSrchExec=false;return c},_openSearchMessageDialog:function(){var b=this;var c=b._getDialogSelfOptions();if(neo.isSet(b.$dialogexec)){return}b.$dialogexec=desknets.dialog.alert(b._searchExecMessage(),c);var d={};d[desknets.Resource.abortLabel]=function(){if(!!b._searching){b.onSrchStop()}else{b.$dialogexec.dialog("close")}};b.$dialogexec.dialog("option","buttons",d)},_getDialogSelfOptions:function(){var b=this;return{type:"message",extraMessage:desknets.Resource.Message.com_dialog_execaddmsg,extraClass:"co-loading-dialog",btnLabel:desknets.Resource.abortLabel,close:function(){if(!!b._searching){b.onSrchStop()}desknets.submitform.clearDisabled(b.$dialogexec);b.$dialogexec=null}}},onSrchStop:function(){var b=this;var d={};var c=desknets.getUrl(b._getRestModule());b._searching=false;b._onStopsearching=true;desknets.submitform.setDialogDisabled(b.$dialogexec);d.cmd=b._getStopBatSearchCmd();desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:c,data:d,success:function(f,e,g){b._onStopsearching=false;setTimeout(function(){b._getListAjax(b._getListRow())},100)},error:function(f,e,g){b.onError(f.status,g)}})},onError:function(c,d){var b=this;b._searching=false;b.callBase("onError",c,d)},_searchExecMessage:function(){var b=desknets.Resource.Message.com_dialog_execmsg;b=desknets.tmpl.replaceWordHtml(b,"msg",desknets.Resource.Message.com_search_nowexec);return b},observe:function(c){var b=this;var c=b._getSearchInterval();if(b._searching==false){return}setTimeout(function(){if(!!b._searching){b._getListAjax(b._getListRow())}},c)},_initListEndButton:function(){var b=this;b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()});b.$mjListPage.find(".co-btn-update").click(function(c){c.preventDefault();a(this).addClass("on");b.updateSearchList()});b.$mjListPage.find(".jco-list-del-submit").click(function(c){b._listDelSubmit(c)})},updateSearchList:function(){var b=this;var c=desknets.paramanalyzer.getHashParams();c._=desknets.createRandomId();b._setLocationHash(c)},_isExecBatSearch:function(){var b=this;var e=false;var d=b._getSearchConditionParams();d.push("_");var c=desknets.paramanalyzer.getHashParams();a.each(d,function(f,h){var g=c[h];if(!neo.isSet(g)){g=""}if(b._searchParams[h]!=g){e=true}});return e},_setExecSearchPrm:function(){var b=this;var d=b._getSearchConditionParams();d.push("_");var c=desknets.paramanalyzer.getHashParams();a.each(d,function(e,g){var f=c[g];if(!neo.isSet(f)){f=""}if(b._searchParams[g]!=f){b._searchParams[g]=f}})},_listPage:function(c){var b=this;var d=desknets.paramanalyzer.getHashParam("_");b.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val(c);hash=desknets.getInputDataToUrl(b.$mjListPage.find(".jco-back-page-data"));hash=hash+"&cmd="+b._getListCmd();b._setLocationHash(hash)},_listDel:function(d,c){var b=this;b._listDelSrchFlgSet(d);b.callBase("_listDel",d,c)},_listDelSrchFlgSet:function(c){var b=this;if(c){b._onSrchExec=true}},_getIdListPage:function(){return"jco-m-search-container"},_getIdListPageForm:function(){return"searchfrm"},_getSearchInterval:function(){var b=this;return b._interval},_getStopBatSearchCmd:function(){return""},_getSearchConditionParams:function(){return[]}});desknets.page(desknets,"PageSubwinUserSel",desknets.PageBase,{_mcListTemplate:null,$mjListPage:null,$mjListData:null,mboGet:false,_initDialog:false,msIdName:"jco-subwindow-usersel",msId:"#jco-subwindow-usersel",CMD_USERLISTNAME:"constructcmdusername",FIELD_NODISPLOGIN:"nodisplogin",VALUESTR_NODISPLOGIN:"1",_TMPL_ITEM:'<span title="{{longName}}"><input type="hidden" name="{{KeyName}}" value="{{id}}" />{{name}}</span>',init:function(){this.callBase("init");this.initGetPageId();this._initSet()},_initBeforeUnload:function(){},initGetPageId:function(){this.$mjListPage=a(this.msId);this.$mjListData=a("#jco-subwindow-listusersel")},_initSet:function(){this._initListStart();this._initListMain();this._initListEnd()},_initListStart:function(){this._mcListTemplate=this.$mjListPage.find(".jco-subwindow-usersel-tmpl").html();this._initListStartSetLink();this._initListStartSetDef()},_initListStartSetLink:function(){var b=this;this.$mjListData.delegate(".jco-subwindow-link","click",function(e){e.preventDefault();var c=b.getListParam();delete c.gid;var d=a(this).attr("href");d=d+"#subulist="+desknets.encodeURIComponentNeo(desknets.getNeoParam(c));desknets.execLocation(d)})},_initListStartSetDef:function(){var b=this;var c=desknets.paramanalyzer.getHashParams();if(neo.isSet(c.subulist)){var d=desknets.paramanalyzer.splitParam(c.subulist);b.$mjListPage.find('input[name="fldsort"]').val(d.fldsort);b.$mjListPage.find('input[name="row"]').val(d.row);this.$mjListPage.find(".jco-subwindow-usersel-sel").val(d.fldsort)}},_initListEnd:function(){var b=this;this.$mjListPage.find(".jco-subwindow-usersel-sel").change(function(){b.$mjListPage.find(".jco-back-page-data").find('input[name="fldsort"]').val(a(this).val());b._getListAjax("0")});b._setupGroupChoser()},_setupGroupChoser:function(){var b=this;var d={allGroup:"choosable",unassignGroup:"choosable",chooseTarget:["group"],mode:"single",selectedTabIndex:1,defaultGroupId:b.$mjListPage.find('input[name="gid"]').val()};var c={pageID:b.msIdName,dialogID:"co-sel-chooser-subwindow-usrsel",dialogOptions:d,extraVars:{group:{keyName:"gid"}},template:b._TMPL_ITEM,change:function(){if(!b._initDialog){b._initDialog=true;return}b._getListAjax("0");return}};desknets.chooser.setUpEntry(b.$mjListPage,b._getTarget(),c)},_getTarget:function(){var d=this;var c=[];var b=d.$mjListPage.find(".jco-sel-items").find("span");c.push({id:d.$mjListPage.find("input[name=gid]").val(),type:"group",name:b.text(),longName:desknets.tmpl.escapeWord(b.attr("title"))});return c},_initListMain:function(){var b=this;if(desknets.pageframe.isSubWinOpen()){b.mboGet=true;b._getListAjax(b.$mjListPage.find('input[name="row"]').val())}else{desknets.menu.$root.on("menuChanged.side",function(c,d){if(!b.mboGet){b.mboGet=true;b._getListAjax(b.$mjListPage.find('input[name="row"]').val())}})}},_getListAjax:function(d){var b=this;var e={};var c={};e=b.getListParam();e.cmd=b._getListExecCmd();e.row=d;e[b.FIELD_NODISPLOGIN]=b.VALUESTR_NODISPLOGIN;c=b._getListAjaxOptions();c.url=desknets.getUrl(b._getRestModule());c.data=e;desknets.ajax.rest(c)},_getListAjaxOptions:function(){var b=this;var c={};c={success:function(e,d,f){b._getListAjaxSuccess(e)}};return c},_getListAjaxSuccess:function(i){var l=this;var f=desknets.ajax.getJsonItems(i);var k=[];var b=[];var e=0;var j=0;var d=l._mcListTemplate;var c="";var g=l.$mjListPage.find(".jco-back-page-data").find('input[name="num"]').val();if(f.length<=0){l.$mjListData.hide();l.$mjListData.empty();l.$mjListPage.find(".co-nodata").show();c="0"}else{l.$mjListData.show();l.$mjListPage.find(".co-nodata").hide();e=f.length;for(j=0;j<e;j++){k=f[j];d=desknets.tmpl.replaceWordChk(d,"addPrm",l._getListLineAddParam(i));b[b.length]=l._listLine(d,k)}l.$mjListData.empty();l.$mjListData.html(b.join(""));c=i.row}var h=l.$mjListPage.find(".co-sub-page");if(parseInt(g)>=parseInt(i.allcnt)){h.css("display","none")}else{h.css("display","block")}l.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val(c);l.$mjListPage.find(".jco-pv-cnt").val(j);l.$mjListPage.find(".jco-pv-all-cnt").val(i.allcnt);l._getListAjaxSuccessEnd()},_listLine:function(d,e){var c=this;var b="";if(typeof e=="object"){for(b in e){if(b=="id"||b=="Name"){d=desknets.tmpl.replaceWordChk(d,b,e[b])}}}return d},_getListLineAddParam:function(b){var c="";if(b.gid){c="&gid="+b.gid}return c},_getListAjaxSuccessEnd:function(){this._listPageLink();a(this.msId).show()},_listPageLink:function(){desknets.Pager.output(this.msId,".jco-pager",this._listPageLinkOption())},_listPageLinkOption:function(){var c=this;var d=c.$mjListPage.find(".jco-pv-cnt").val();var e=c.$mjListPage.find(".jco-pv-all-cnt").val();var g=c.$mjListPage.find(".jco-back-page-data").find('input[name="num"]').val();var f=c.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val();var b={};b={getCount:d,allCount:e,pageMaxView:g,startRow:f,clickFunc:function(h){c._getListAjax(h)}};return b},getListParam:function(){var b=desknets.getInputDataToObj(this.$mjListPage.find(".jco-back-page-data"));return b},_getListExecCmd:function(){return this.CMD_USERLISTNAME},_getRestModule:function(){return"zrconst"}});desknets.shortenUrl={_zUrl:null,getShortUrl:function(b){if(!this._zUrl){this._zUrl=desknets.getUrl("z")}return this._zUrl+"?"+b},isShortenUrl:function(b){if(!this._zUrl){this._zUrl=desknets.getUrl("z")}return b.indexOf(this._zUrl)==0},shortenUrlInText:function(f,e){var d=[],g=[];var c=neo.regExpSplit(f,/(https?:\/\/[^\s\u3000]+)/);for(var b=1;b<c.length;b+=2){if(!this.isShortenUrl(c[b])){d.push(c[b]);g.push(b)}}if(d.length<=0){setTimeout(function(){e(f)},0);return}this._sendUrlsToShorten(d,function(j){for(var h=0;h<j.length;h++){c[g[h]]=j[h]}e(c.join(""))})},_sendUrlsToShorten:function(d,e){var c=this;var b=[];a.each(d,function(g,f){b.push({cmd:desknets.ntwi.CMD_SURL_ADD,url:f})});desknets.ajax.rest({url:desknets.ntwi.restUrl,data:desknets.ajax.arrayToMultiCmdData(b),detectMultiError:true,success:function(f){var g=[];a.each(d,function(j,h){g.push(c.getShortUrl(f[j.toString()].id))});e(g)}})}};desknets.RefDialog=function(){return this};desknets.refDialog={_option:{module:"zrconst",linkClass:"jco-ref-dialog-link",idName:"refid",dlgId:"jco-ref-dialog-",closedDel:true,uProfCmd:"constructcmduserinfo",uProfMsetCmd:"constructmsetcmduserinfo",uLdentClass:"co-userprof-dialog",uTmpl:"com/userprofile.html",uTmplObj:null,uMakeFunc:null,gProfCmd:"constructgroupinfo",gLdentClass:"co-groupprof-dialog",gTmpl:"com/groupprofile.html"},_arrMail:["Mail","mailmobile","mailprivate","mailother"],_arrOfficeTel:["TelHand","Tel1","Tel2","Naisen","TelFax"],_arrPrivateTel:["TelHome","TelOther"],$_area:null,$_uTmpl:null,$_gTmpl:null,_tmplMLink:'<a class="jco-userprof-maillink" href="mailto:{{mAddr}}">{{mAddr}}</a>',_tmplMLinkNoLink:'<span title="{{mAddr}}">{{mAddr}}</span>',init:function(){var c=this;var b;if(neo.isSet(c.$_area)){b=c.$_area}else{b=a(document.body)}c.setLinkDisabled(b);b.delegate("."+c._option.linkClass,"click",function(d){d.preventDefault();c._openWithElement(a(this))});if(neo.isSet(c._option.uTmplObj)&&c._option.uTmplObj.length){c.$_uTmpl=c._option.uTmplObj}},setLinkDisabled:function(b){var d=this;var c;if(neo.isSet(b)){c=b}else{c=a(document.body)}if(!desknets.pageframe.isUserInfoDisp()){c.find("."+d._option.linkClass).filter(function(){var e=a(this).data(d._option.idName).match(/user/);return !!e&&e.length==1}).addClass("co-page-linkdisable")}},_openWithElement:function(b){var c=this;var f=b.data(c._option.idName);if(!!f){var e=f.match(/(user|group|role)(\w+|-\w+)/i);if(e&&e.length>2){var d=a("#jco-user-dispitems").data("cmdtype");c._open(e[1],e[2],d)}}},_open:function(d,e,c){var b=this;if(neo.isSet(d)&&d=="user"){if(!!desknets.pageframe.isUserInfoDisp()){b._openUserProf(e,c)}}else{if(neo.isSet(d)&&d=="group"){b._openGroupProf(e)}}},_getProfileInfoAjax:function(e,f){var b=this;var d=desknets.getUrl(b._option.module);var c=desknets.ajax.arrayToMultiCmdData(e);desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:d,data:c,success:function(h,g,i){if(h[0]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.dialog.alert(h[0]["errormessage"],{errorNo:h[0]["errorno"]})}else{if(a.isFunction(f)){f(h)}}}})},_openUserProf:function(f,c){var b=this;var d=a("#"+b._option.dlgId+"user-"+f);if(d.length>0){d.dialog("open");d.find(".co-userprof-status").scrollTop(0);return}else{if(!neo.isSet(b.$_uTmpl)||b.$_uTmpl.length==0){b.$_uTmpl=a("<div />");var e=function(){b._makeUserProf(f,c)};desknets.tmpl.load(b.$_uTmpl,b._option.uTmpl,e);return}}b._makeUserProf(f,c)},_makeUserProf:function(i,f){var d=this;var g={};var c=d._option.dlgId+"user-"+i;var h;var b=function(k){var o={};var r=a.extend(desknets.dialog.getDialogOption(),{dialogClass:"dn-dialog",width:500,title:desknets.Resource.profUserTitle,open:function(){h.next().find("button").focus()},close:function(s){if(d._option.closedDel==true){d._deleteClosedUserAll()}}});var p={};p[desknets.Resource.CloseButtonLabel]=function(s){a(this).dialog("close")};r.buttons=p;h=a('<div class="'+d._option.uLdentClass+'"/>').attr("id",c).appendTo(document.body);var m=a("<div />").html(d.$_uTmpl.html());var j="";for(j in k[0]){if(typeof k[0][j]=="string"){o[j]=desknets.tmpl.dispStr(k[0][j]);if(a.inArray(j,d._arrMail)>=0){var n=d._tmplMLink;var l=desknets.pageframe.getLoginMailLink();if((neo.isSet(l)&&l<=0)||!neo.isSet(l)){n=d._tmplMLinkNoLink}if(neo.isSet(o[j],{blank:false})&&o[j]!=="&nbsp;"){o[j]=desknets.tmpl.replaceWordChkHtml(n,"mAddr",o[j])}if(!o.mailAddress){o.mailAddress="1"}}else{if(!o.officeTel&&a.inArray(j,d._arrOfficeTel)>=0){o.officeTel="1"}else{if(!o.privateTel&&a.inArray(j,d._arrPrivateTel)>=0){o.privateTel="1"}}}}else{o[j]=k[0][j]}}o.uid=i;m.find("#co-userprof-tmpl").tmpl(o).appendTo(h);var q=h.find(".co-userprof-status");if(a.trim(q.text())==""){q.remove()}a.each(h.find(".jco-userprof-maillink"),function(s,t){desknets.htmlparts.setUpMailLink(a(this))});desknets.dialog.setUp(h,r);h.dialog("open");h.find(".co-userprof-status").scrollTop(0);desknets.dialog.setFirstDialogOpen(h);if(d._option.uMakeFunc&&a.isFunction(d._option.uMakeFunc)){d._option.uMakeFunc(h)}};var e;if(neo.isSet(f)&&(f=="mset"||f=="set")){e=d._option.uProfMsetCmd}else{e=d._option.uProfCmd}g["0"]={cmd:e,id:i};d._getProfileInfoAjax(g,b)},_deleteClosedUserAll:function(){a("."+this._option.uLdentClass).each(function(){var b=a(this);if(!b.dialog("isOpen")){b.dialog("destroy").remove()}})},_openGroupProf:function(e){var b=this;var c=a("#"+b._option.dlgId+"group-"+e);if(c.length>0){c.dialog("open");return}else{if(!neo.isSet(b.$_gTmpl)||b.$_gTmpl.length==0){b.$_gTmpl=a("<div />");var d=function(){b._makeGroupProf(e)};desknets.tmpl.load(b.$_gTmpl,b._option.gTmpl,d);return}}b._makeGroupProf(e)},_makeGroupProf:function(g){var d=this;var e={};var c=d._option.dlgId+"group-"+g;var f;var b=function(l){var h={};var j=a.extend(desknets.dialog.getDialogOption(),{dialogClass:"dn-dialog",width:500,title:desknets.Resource.profGroupTitle,close:function(m){if(d._option.closedDel==true){d._deleteClosedGroupAll()}}});var k={};k[desknets.Resource.CloseButtonLabel]=function(m){a(this).dialog("close")};j.buttons=k;f=a('<div class="'+d._option.gLdentClass+'"/>').attr("id",c).appendTo(document.body);var i=a("<div />").html(d.$_gTmpl.html());l[0]["gid"]=g;i.find("#co-groupprof-tmpl").tmpl(l[0]).appendTo(f);desknets.dialog.setUp(f,j);f.dialog("open");desknets.dialog.setFirstDialogOpen(f)};e["0"]={cmd:d._option.gProfCmd,id:g};d._getProfileInfoAjax(e,b)},_deleteClosedGroupAll:function(){a("."+this._option.gLdentClass).each(function(){var b=a(this);if(!b.dialog("isOpen")){b.dialog("destroy").remove()}})},userProfSetUp:function(d,c){var b=this;if(neo.isSet(d)){b._option=a.extend({},b._option,d)}if(neo.isSet(c)&&c.length>0){b.$_area=c}b.init()}};desknets.refDialog.editGroups=function(d){var c="&nbsp;";if(neo.isSet(d)&&neo.isSet(d.Name)){var b=desknets.ajax.getItems(d.Name);a.each(b,function(e,f){b[e]=desknets.tmpl.dispStr(f)});c=b.join(", ")}return c};desknets.RefDialog.prototype=desknets.refDialog;desknets.chooserFolder={};desknets.chooserFolder.treeTabItem=a.extend({},desknets.chooser.treeTabItem,{rootClass:"co-sel-extra",});desknets.chooserFolder.treeTabItem._createSideMenu=function(){var b=this;var d=b.$sideMenu;if(!d.hasClass("co-listview-left")){d.addClass("co-listview-left");d.append('<div class="co-listview-tree co-listview-left-data"><div class="co-listview-items"></div></div>')}b.created=false;b._createTree();b.$itemList.bind("dnchooserfolderitemlistsourcechange",function(e){b._tree.openItemById(b._lastID)});var c=b.$sideMenu.closest(".co-sel").find(".co-sel-tabs");c.undelegate("li","click");c.delegate("li","click",function(e){e.preventDefault()})};desknets.chooserFolder.treeTabItem._createTree=function(){var b=this;b._tree=a.extend({},desknets.folderSelectTree);b._tree.options=b._options;b._tree.init(b.$sideMenu,{idName:"data-id",isLag:false,defaultSelectionRel:"parent",selFunc:function(d){var c=!d.hasClass("jstree-leaf");b._getListItemsInGroup(d.data("id"),c)}});b.$sideMenu.find(".co-listview-items").bind("loaded.jstree",function(){b.created=true})};desknets.chooserFolder.treeTabItem._getListItemsInGroup=function(d,c){var b={};d=neo.isSet(d)?String(d):"";this._lastID=d;if(d!=="all"&&d!=="0"&&c){b.group={cmd:this._options.cmdgroups,area:"2",pfolder:d}}if(a.inArray("user",this._options.chooseTarget)>=0&&d!==""){b.user={cmd:this._options.cmdusers,folder:d}}if(!a.isEmptyObject(b)){this.$itemList.dnChooserFolderItemList("options",this._options.radioAccs);this.$itemList.dnChooserFolderItemList("setDataSources",b)}else{this._tree.openItemById(this._lastID)}};desknets.chooserFolder.treeTabItem._createItemList=function(){var b=this;var c=a.extend({},b._options,{mode:"folder",linkToChild:this._linkToChild,add:function(e,d){b._$choosenList[b._options.choosenListPlugIn]("add",d)},sourceChange:function(e){var d=b.$itemList.dnChooserFolderItemList("getTotalPage");b._updatePager(1,d)},open:function(e,d){b._openGroup(d)}});this.$itemList.dnChooserFolderItemList(c)};desknets.chooserFolder.treeTabItem._changePage=function(b){if(this.$itemList!=null){var c=this.$itemList.dnChooserFolderItemList("getTotalPage");this.$itemList.dnChooserFolderItemList("setPage",b);this._updatePager(b,c)}};desknets.chooserFolder.treeTabItem._createOthers=function(){var b=this;var c;b._$parentButton=b.$itemList.siblings(".co-sel-groups.co-sel-parent-button");b._components.push(b._$parentButton);b._$parentButton.find(".jco-sel-go-parent").click(function(d){d.preventDefault();b._tree.selectParent()});c=b._options.dialogRoot.find("."+b._options.selectClass).find('input[name="'+b._options.keyName+'"]').val();if(!!c){b.$itemList.one("dnchooserfolderitemlistsourcechange",function(d){b.$itemList.dnChooserFolderItemList("select",c,"group")})}b._$parentButton.find(".jco-sel-go-parent").attr("title",desknets.Resource.folderselect.folderGoParent)};desknets.chooserFolder.treeTabItem.destroy=function(){if(this.$itemList!=null){this.$itemList.dnChooserFolderItemList("destroy")}};a.widget("desknets.dnChooserFolderItemList",a.desknets.dnChooserItemList,{select:function(f,d){var e=f,c={};if(!a.isArray(f)){e=[{id:f,type:d}]}a.each(e,function(g,h){c[h.type+h.id]=true});var b=this._$tbody.children("tr").filter(function(){var g=a(this).data("item");return !!c[g.type+g.id]});if(this.options.mode=="folder"){b.siblings().removeClass("co-tr-selected");b.addClass("co-tr-selected");b.find("input:radio").attr("checked",true)}},_processResponse:function(f,e,g){var c=this;var b=e.list.item;var d;if(a.isEmptyObject(this._totals)){this._totals.group=e.allcnt}g=c.options.perPage*c._pageNo;for(d=0;d<g&&d<b.length;d++){c._addItemElement(c._convertFolderItem(b[d]))}return g-d},_convertFolderItem:function(c){var b={id:c.id,type:"group",name:c.Name,description:"",hasChildren:false,accesskind:neo.isSet(c.accesskind)?c.accesskind:"15"};if(!!c.parent){b.description=desknets.escapeValue(desknets.escape(c.parent))}if(!!c.children){b.hasChildren=c.children>0}return b},_addItemElement:function(f){var c=a("<tr />"),e=this._itemHtml;var d=f.type+" "+desknets.chooser._getSubType(f);var b=f.accesskind;e=desknets.tmpl.replaceWord(e,"name",f.name);e=desknets.tmpl.replaceWordHtml(e,"description",f.description);e=desknets.tmpl.replaceWord(e,"accesskind",b);if(this.options.linkToChild&&f.type=="group"&&(!!f.hasChildren)){d+=" co-sel-has-children"}c.attr("class",d);c.data("item",f).html(e).appendTo(this._$tbody);var g=this.options.radioAccs;if(neo.isSet(b)&&!((g&Number(b))==g)){c.find("input:radio").remove()}this._updateSpecialGroup(c,f)},getSelected:function(){var b=null;if(this.options.mode=="folder"){var b=this._$tbody.find("tr.co-tr-selected").data("item");b=!!b?b:null}return b}});desknets.chooserSingleSelFolder={_defOptions:{dialogID:"co-folder-sel-dialog",keyName:"folder",selectClass:"jco-sel-items",funcDefSel:null,change:null,filter:null},_defDialogOptions:{search:false,chooseHistory:false,chooseGroup:false,chooseTarget:["group","folder"],mode:"single",itemListPlugIn:"dnChooserFolderItemList",extraTab:{title:desknets.Resource.folderselect.dialogTitleFolderSelect,item:desknets.chooserFolder.treeTabItem},radioAccs:1},init:function(f,i,j,c){var h=this;var d={};a.extend(d,h._defOptions,j);var b={};a.extend(b,h._defDialogOptions);b.module=i.module;b.cmdgroups=i.cmdchild;b.cmdgrouptree=i.cmddef;b.cmdusers=i.cmddocs;b.dialogRoot=f;b.selectClass=d.selectClass;b.keyName=d.keyName;a.extend(b,c);b.open=function(){var l=f.find("."+d.selectClass+">.co-selitem").eq(0).find("input").val();if(!neo.isSet(l)){var k=a("#"+d.dialogID).find('input[name="item"]');if(k.length>0){k.attr("checked",false)}}a("#"+d.dialogID).on("dnchooserfolderitemlistadd",function(m){desknets.chooser._onChooseItems(a("#"+d.dialogID),b)})};var e=f.find("."+d.selectClass+">.co-selitem").eq(0).find("input").val();if(neo.isSet(e,{blank:false})){b.defaultGroupId=e}if(!neo.isSet(d.funcDefSel)||!a.isFunction(d.funcDefSel)){d.funcDefSel=h._getTargets}var g={};g={dialogID:d.dialogID,dialogOptions:b,extraVars:{group:{keyName:d.keyName}}};if(neo.isSet(d.change)&&a.isFunction(d.change)){g.change=d.change}if(neo.isSet(d.filter)&&a.isFunction(d.filter)){g.filter=d.filter}desknets.chooser.setUpEntry(f,d.funcDefSel(f,d),g)},_getTargets:function(d,c){var b=[];d.find("."+c.selectClass+">.co-selitem").each(function(){var e=a(this).find("input").val();var f=a(this).find(".co-selitem-text").text();if(neo.isSet(e)&&e.length>0&&neo.isSet(f)&&f.length>0){b.push({id:e,type:"group",name:f,description:""})}});return b}};desknets.page(desknets,"sharelink",null,{options:{},$area:null,$dialog:null,$target:null,$popup:null,TMPL:'<div id="co-pop-share"><div id="co-pop-share-title">{{share}}</div><dl id="co-pop-share-main"><div class="btn-area">{{btn}}<div><input type="text" {{readonly}} value="" name="shareurl" class="co-share-urltext"></div><p class="co-msg">{{msg}}</p></dl><form id="mailform_sharelink"></form></div>',TMPL_MAIL:'<a class="mail" href="#" title="{{mail}}">{{mail}}</a>',TMPL_NTWI:'<a class="ntwi talk" href="#" title="{{ntwi}}">{{ntwi}}</a>',TMPL_DM:'<a class="ntwi dm" href="#" title="{{dm}}">{{dm}}</a></div>',init:function(d,e){var c=this;c.$area=d;c.options=c._setOption(e);if(c.$dialog===null){var b=desknets.dialog.getDialogOption();var f={extraMessage:null,extraClass:"",btnLabelOk:desknets.Resource.ConfOKButtonLabel,btnLabelCancel:desknets.Resource.ConfCancelButtonLabel};var g=a.extend(b,{title:desknets.Resource.confirmDefaultTitle,dialogClass:"dn-dialog message",buttons:{},open:function(){a(this).parent().find(".ui-dialog-buttonpane button:eq(1)").focus()}});g.buttons[f.btnLabelOk]=function(){desknets.submitform.setDialogDisabled(c.$dialog);c._makeShortURL()};g.buttons[f.btnLabelCancel]=function(){a(this).dialog("close")};c.$dialog=desknets.dialog.make("confirmshare",g);desknets.dialog._setMessage(c.$dialog,c.options.message)}c._setEventShareLink();if(c.$popup==null){c._setTemplate();c._setEventURLPop()}},_setOption:function(f){var d=this;var b=false;var c=Number(desknets.pageframe.getLoginMailLink());if(c>0){b=true}var e={message:desknets.Resource.Message.share_confirm,linkClass:"jco-disp-share",restUrl:desknets.ntwi.restUrl,afterFunc:null,tmpl:null,mail:b,ntwi:true,dm:true,getMailBodyFunc:null};return a.extend({},e,f)},_setEventShareLink:function(){var b=this;var c="."+b.options.linkClass;b.$area.delegate(c,"click",function(d){d.preventDefault();b.$target=a(this);b._checkExistShortURL()})},_setTemplate:function(){var c=this;var d=desknets.Resource;var b;var e="";b=c.TMPL_MAIL;b=desknets.tmpl.replaceWordHtml(b,"mail",d.com_share_mail);c.TMPL_MAIL=b;b=c.TMPL_NTWI;b=desknets.tmpl.replaceWordHtml(b,"ntwi",d.com_share_ntwi);c.TMPL_NTWI=b;b=c.TMPL_DM;b=desknets.tmpl.replaceWordHtml(b,"dm",d.com_share_dm);c.TMPL_DM=b;if(!!c.options.mail){e=e+c.TMPL_MAIL}if(!!c.options.ntwi){e=e+c.TMPL_NTWI}if(!!c.options.dm){e=e+c.TMPL_DM}b=c.TMPL;b=desknets.tmpl.replaceWordHtml(b,"share",d.com_share_title);b=desknets.tmpl.replaceWordHtml(b,"msg",d.Message.share_popmsg_copy);b=desknets.tmpl.replaceWordHtml(b,"btn",e);if(desknets.browser.tablet){e=""}else{e='readonly="readonly"'}b=desknets.tmpl.replaceWordHtml(b,"readonly",e);c.TMPL=b;c.$popup=a(c.TMPL);c.$popup.appendTo("body")},_setEventURLPop:function(){var b=this;var c=b.$popup;c.delegate("input.co-share-urltext","focus",function(d){if(desknets.browser.tablet){this.setSelectionRange(0,9999)}else{a(this).select()}});c.delegate("input.co-share-urltext","mouseup",function(d){d.preventDefault();a(this).focus()});c.delegate("a.mail","click",function(g){g.preventDefault();var e="";if(a.isFunction(b.options.getMailBodyFunc)){e=b.options.getMailBodyFunc(b.$popup,b.$target)}else{e=b.$popup.find("input.co-share-urltext").val()}var f={body:e};var d=desknets.pageframe.getLoginMailLink();if(d=="2"||d=="3"){desknets.webmail.openMailEditByMailLink(f,a("#mailform_sharelink"),d)}else{location.href="mailto:?body="+desknets.encodeURIComponentNeo(e)}});c.delegate("a.ntwi","click",function(e){e.preventDefault();var d=a(this);var f=function(){var h=a("#dn-ntwi-container").find(".ntwi-entries");var i=h.find(".ntwi-entry-box").find(".ntwi-textarea").find('textarea[name="detail"]');var g=b.$popup.find("input.co-share-urltext").val();if(d.hasClass("talk")){h.find("#jntwi-target-mode-ntwi").trigger("click");desknets.ntwi.entries._setToNtwiEntry();i.val(g);h.find(".ntwi-placeholder").trigger("click");h.find(".ntwi-entry-box").find(".ntwi-textarea").find('textarea[name="detail"]').focus()}else{if(d.hasClass("dm")){h.find("#jntwi-target-mode-message").trigger("click");i.val(g);desknets.ntwi.entries._setToMessageEntry();a("#ntwi-entry-icon-balloon").removeClass("show");h.find(".ntwi-placeholder").trigger("click");h.find(".ntwi-entry-box").find(".ntwi-pictogram-text-editor").focus()}}};desknets.ntwi.content.open(a(".ntwi-header"),f)})},_checkExistShortURL:function(){var b=this;var c={success:function(f,e,g){if(!!f.existflg&&f.existflg=="1"){b._openConfDupDialog(f.id)}else{b.$dialog.dialog("open")}}};var d={cmd:desknets.ntwi.CMD_SURL_CHKEXIST};b._shortURLRest(d,c)},_makeShortURL:function(){var b=this;desknets.submitform.setDialogDisabled(b.$dialog);var c={success:function(f,e,g){b._afterShortURL(f);b.$dialog.dialog("close")},complete:function(g,e,f){desknets.submitform.clearDialogDisabled(b.$dialog)}};var d={cmd:desknets.ntwi.CMD_SURL_ADD,entrydup:"1"};b._shortURLRest(d,c)},_shortURLRest:function(f,h){var d=this;var b=d.$target;if(!b){return}var e=b.data("url");if(e==""){e=window.location.href}var i={url:e};a.extend(i,f);var g=!desknets.browser.ipad;var c={async:g,url:d.options.restUrl,data:i};a.extend(c,h);desknets.ajax.rest(c)},_openConfDupDialog:function(d){var b=this;var e=desknets.Resource.Message.ntwi_surl_entryconf;var c={extraMessage:desknets.Resource.Message.ntwi_surl_entryconf_extra,cancel:function(){var f={};f.id=d;b._afterShortURL(f)}};desknets.dialog.confirm(e,function(){b._makeShortURL()},c)},_afterShortURL:function(e){var c=this;if(a.isFunction(c.options.afterFunc)){c.options.afterFunc(e);return}if(!!e&&!!e.id){var d={target:c.$target};desknets.popUp.open(c.$popup,d);var b=c.$popup.find("input.co-share-urltext");b.val(desknets.shortenUrl.getShortUrl(e.id));b.trigger("focus")}}});desknets.ntwi={MODULE_MAIN:"zntwi",MODULE_API_MAIN:"zrntwi",CMD_NEWS_LIST:"ntwicmdnotice",CMD_NEWS_DEL:"ntwicmdnoticedel",CMD_SAFETYNEWS_DEL:"ntwicmdnoticesafetydel",CMD_TALK_LIST:"ntwicmdlist",CMD_TALK_REF:"ntwicmdref",CMD_TALK_ADD:"ntwicmdentry",CMD_TALK_DEL:"ntwicmddel",CMD_TALK_DOWNLOAD:"ntwidispattach",CMD_MESSAGE_USER_LIST:"ntwicmddmsguserlist",CMD_MESSAGE_LIST:"ntwicmddmsglist",CMD_MESSAGE_ADD:"ntwicmddmsgentry",CMD_MESSAGE_DEL:"ntwicmddmsgdel",CMD_MESSAGE_DOWNLOAD:"ntwidmsgdispattach",CMD_MESSAGE_READ:"ntwicmddmsgread",CMD_NOTIFY:"ntwicmdnoticeread",CMD_GETMANAGER:"ntwicmdchkmng",CMD_GETMEMO:"ntwicmdnewmemo",CMD_COPYATTACH:"ntwicmdcopyattach",CMD_MESSAGE_COPYATTACH:"ntwicmddmsgcopyattach",CMD_HISTORY_LIST:"ntwicmdhistorylist",CMD_HISTORY_DEL:"ntwicmdhistorydel",CMD_EXT_LIST:"ntwigetextlist",CMD_SURL_LIST:"ntwicmdlistsurl",CMD_SURL_ADD:"ntwicmdsurlentry",CMD_SURL_CHKEXIST:"ntwicmdsurlchkexist",CMD_SURL_DEL:"ntwicmdsurldel",CMD_STAMP_CATEGORY_LIST:"ntwicmdstampcatlist",CMD_STAMP_HISTORY_LIST:"ntwicmdstamphistlist",CMD_STAMP_LIST:"ntwicmdstamplist",CMD_PICTOGRAM_LIST:"ntwicmdpictlist",SMALL_ICON_SIZE:{width:20,height:20},ICON_SIZE:{width:40,height:40},ATTACHMENT_SIZE:{width:100,height:100},url:"",restUrl:"",mailRestUrl:"",perPageAll:0,perPageSingle:0,talkAvailable:true,messageAvailable:true,confirmToPost:true,_interval:0,_timer:null,_checkMail:"",_checkingMail:false,init:function(){var b=this;var c=a("#dn-ntwi-container");b.url=desknets.getUrl("zntwi");b.restUrl=desknets.getUrl("zrntwi");b.mailRestUrl=desknets.getUrl("zrweml");b.talkAvailable=!c.hasClass("ntwi-talk-unavailable");b.messageAvailable=!c.hasClass("ntwi-message-unavailable");b.perPageAll=Number(c.data("per-page-all"));b.perPageSingle=Number(c.data("per-page-single"));b.confirmToPost=!!c.data("confirm-to-post");b._checkMail=c.data("check-mail");b._interval=Number(c.data("interval"));desknets.ntwi.toolBar.init();this.start()},start:function(){var b=this;if(b._interval>0){b._restartTimer();a(document.body).bind("mousemove.ntwi",function(c){b._restartTimer()})}},refresh:function(){if(!desknets.ntwi.content.isShown()){desknets.ntwi.toolBar.refresh()}},confirmToProcess:function(c,e,d){var b=this;desknets.dialog.confirm(c,function(){b.beginToProcess(e,d)})},beginToProcess:function(c,b){desknets.ajax.rest({url:desknets.ntwi.restUrl,data:c,success:function(d){b(d)}})},checkMailIfEnabled:function(b){if(!!this._checkMail){if(this._checkMail=="every"||!!b){this._checkMail="sleep";this._beginToCheckMail()}}},getNewsMessage:function(d,e){var b="";if(d.mid=="todo"&&d.count=="0"){b="_end"}if(d.mid=="info"&&d.othercnt=="1"){b="_approval"}var c=desknets.Resource.Message["ntwi_new_item_"+d.mid+b]||"";c=desknets.tmpl.replaceWordHtml(c,"title",d.title);c=desknets.tmpl.replaceWordHtml(c,"detail",d.detail);c=desknets.tmpl.replaceWordHtml(c,"target",d[e]);return c},getIconUrlById:function(b){var c={creport:"circle","-1":"neo"};if(!!c[b]){b=c[b]}return"/"+desknets.DIR_RESHOME+"/images/topmenu/menu_s/"+b+"-menu_icon_s.png"},convertToStampThumbnailUrl:function(b){return String(b).replace(/attach(\d+)\./,"attach$1_mini.")},stopTimer:function(){var b=this;if(!!b._timer){clearTimeout(b._timer);b._timer=null}},_restartTimer:function(){var b=this;b.stopTimer();b._timer=setTimeout(function(){if(b._checkMail=="sleep"){b._checkMail="every"}b.refresh();b._timer=null;b._restartTimer()},b._interval*60000)},_beginToCheckMail:function(){var b=this;if(!b._checkingMail){b._checkingMail=true;desknets.ajax.rest({url:desknets.ntwi.mailRestUrl,data:{cmd:"mailupdnotice"},dataType:"xml",error:function(){},complete:function(){b._checkingMail=false}})}}};desknets.ntwi.toolBar={SLIDE_DURATION:1000,SLIDE_INTERVAL:4000,FLOAT_HEADER_MENU_FROM:80,$root:a(),_$whatsNew:a(),_$headerMenu:a(),_$clock:a(),_$current:a(),_$next:a(),_notifies:[],_currNotify:0,_newMemoTagCount:0,_newMailCount:0,_loaded:false,init:function(){this.$root=a(".ntwi-header");this._$headerMenu=this.$root.children(".ntwi-header-menu");if(this._$headerMenu.length>0){this._initButtons()}this._$whatsNew=this.$root.children(".ntwi-whats-new");if(this._$whatsNew.length>0){this._initNotifier()}this._$clock=this.$root.find(".co-clock");if(this._$clock.length>0){this._initClock()}},getNewItemCount:function(c){var d=this.$root.find(".ntwi-"+c+"-btn>.ntwi-badge");var b=Number(d.data("count"));return b>0?b:0},setNewItemCount:function(b,d){var c={talk:"talkcnt",message:"dmsgcnt"};if(!!c[b]){this._updateSavedNewsCount(c[b],d)}this._updateNotifierBadge(b,d);desknets.pagetitle.setNeoTitle(this.getNewItemCount("news"),this.getNewItemCount("talk"),this.getNewItemCount("message"))},getNewMemoTagCount:function(){return this._newMemoTagCount},getNewMailCount:function(){return this._newMailCount},clearNotifyByModule:function(d){var f=this._loadNews();var c=!!f["0"]?f["0"]:f;var b=desknets.ajax.getJsonItems(c);for(var e=b.length-1;e>=0;e--){if(b[e].mid==d){b.splice(e,1);if(c.allcnt>0){c.allcnt--}}}c.list={item:b};this._updateNotifier(f);this._saveNews(f)},clearNotifies:function(){this._notifies=[]},refresh:function(){if(this._$whatsNew.length>0){this._beginToUpdateNotifier()}},_initNotifier:function(){this._$current=this._$whatsNew.children().eq(0);this._$next=this._$current.next();var b=this;var c=this._loadInitialNews();if(!!c){this._updateNotifier(c)}a(document).bind("ajaxSuccess",function(e,f,d){if(!!neo.ajax.getDataValue(f,"updatenotifier")){setTimeout(function(){b.refresh()},1)}})},_beginToUpdateNotifier:function(){var b=this;desknets.ajax.rest({url:desknets.ntwi.restUrl,data:b._getNotifierParams(),success:function(c){b._saveNews(c);b._updateNotifier(c)},error:function(){desknets.ntwi.stopTimer()}});desknets.ntwi.checkMailIfEnabled()},_getNotifierParams:function(){var b=[];b.push({cmd:desknets.ntwi.CMD_NEWS_LIST,ticker:"1"});if(desknets.pageframe.isShownMenu("memo")){b.push({cmd:desknets.ntwi.CMD_GETMEMO})}return desknets.ajax.arrayToMultiCmdData(b)},_updateNotifier:function(c){var b=!!c["0"]?c["0"]:c;this._updateSlidingNotifier(b);this._newMemoTagCount=!!c["1"]?Number(c["1"].tagmemocnt):0;if(!this._loaded){this._loaded=true;this._initNotifySlider()}this.$root.trigger("ntwirefresh")},_updateSlidingNotifier:function(e){var b=desknets.ajax.getJsonItems(e);this._notifies=[];for(var d=0;d<b.length;d++){var c=this._convertNotifierItem(b[d]);this._notifies.push(c)}this._updateNotifierBadge("talk",e.talkcnt);this._updateNotifierBadge("news",e.allcnt);this._updateNotifierBadge("message",e.dmsgcnt);desknets.pagetitle.setNeoTitle(e.allcnt,e.talkcnt,e.dmsgcnt);this._newMailCount=0;for(var d=0;d<this._notifies.length;d++){if(this._notifies[d]["module"]=="mail"){this._newMailCount=1;break}}},_updateNotifierBadge:function(b,c){var e=this.$root.find(".ntwi-"+b+"-btn>.ntwi-badge");var f=(c>0)?"show":"hide";var d=(c<1000)?String(c):"...";e[f]().data("count",c).text(d)},_convertNotifierItem:function(c){var b=desknets.ntwi.getNewsMessage(c,"title");return{module:c.mid,text:b}},_initNotifySlider:function(){var b=this;b._setCurrentNotifyMessage(b._$current);setInterval(function(){b._beginToShowNextNotify()},this.SLIDE_INTERVAL)},_beginToShowNextNotify:function(){if(this._notifies.length>=1){this._currNotify=(this._currNotify+1)%this._notifies.length;this._setCurrentNotifyMessage(this._$next);this._slideNotifier()}else{this._$current.children(".co-text").text("");this._$current.attr("class","none")}},_slideNotifier:function(){var b=this;b._$whatsNew.addClass("anmating-with-js");b._$whatsNew.animate({top:"-60px"},{duration:b.SLIDE_DURATION,complete:function(){b._completeToShowNextNotify()}})},_completeToShowNextNotify:function(){var b=this._$next.children(".co-text").text();this._setCurrentNotifyMessage(this._$current);this._$whatsNew.css("top","0");this._$whatsNew.removeClass("anmating-with-js")},_setCurrentNotifyMessage:function(c){var b=this._notifies[this._currNotify];if(!!b){c.children(".co-text").text(b.text);c.attr("class",b.module)}},_initButtons:function(){var b=this;this.$root.click(function(c){c.preventDefault();b._onClickBar(a(c.target))});if(desknets.support.cssPositionFixed){a(window).scroll(function(){b._updateHeaderMenu()});a(function(){b._updateHeaderMenu()})}},_updateHeaderMenu:function(){var b=a(window).scrollTop()>=this.FLOAT_HEADER_MENU_FROM;var c=this._$headerMenu.hasClass("floating");if(!c&&b){this._$headerMenu.addClass("floating")}else{if(c&&!b){this._$headerMenu.removeClass("floating")}}},_onClickBar:function(b){var c=this._getOpenContentButton(b);if(c.length>0){desknets.ntwi.content.open(c)}if(b.closest(".ntwi-header-menu.floating a").length>0){a(window).scrollTop(0);this._$headerMenu.removeClass("floating")}},_getOpenContentButton:function(b){var c;c=b.closest(".jntwi-list-type-btn");if(c.length>0){return c}c=b.closest(".ntwi-header-menu.floating");if(c.length>0){return a()}c=b.closest(".ntwi-header");if(c.length>0){return c}return a()},_loadInitialNews:function(){var b=null;if(!!window.jsonRestNtwiNotice){b=window.jsonRestNtwiNotice;window.jsonRestNtwiNotice=null;if(!!window.jsonRestNewMemo){b={"0":b,"1":window.jsonRestNewMemo};window.jsonRestNewMemo=null}this._saveNews(b)}else{b=this._loadNews()}return b},_loadNews:function(){return desknets.storage.loadData(desknets.storage.FIELD_NTWI_NEWS)},_saveNews:function(b){desknets.storage.saveData(desknets.storage.FIELD_NTWI_NEWS,b)},_updateSavedNewsCount:function(b,d){var c=this._loadNews();if(!!c&&!!c[0]&&c[0][b]){c[0][b]=d;this._saveNews(c)}},_initClock:function(){var b=this;a(document).bind("minuteChanged.desknets",function(){var c=desknets.dateTime.current;var e=desknets.Resource.longDateTimeFormat;var d=neo.dateTime.format(e,c);b._$clock.text(d)})}};desknets.ntwi.content={$root:a(),listName:"all",loading:false,_isSetPrivilege:false,open:function(b,d){var c=this;if(!c.loading){c.loading=true;if(c.$root.length<=0){c.create(function(){c.show(b,d);c.loading=false})}else{c.show(b,d);c.loading=false}}},create:function(c){var b=this;b.$root=a('<div class="ntwi-main ui-corner-bottom" />').appendTo("#dn-ntwi-container");desknets.tmpl.load(this.$root,"com/ntwi.html",function(){b._setUp();c()})},show:function(b,d){if(!this.$root.hasClass("show")){this.$root.addClass("show");this._onOpen(b);desknets.pageframe.notifyToShowLayer(this.$root)}if(!desknets.ntwi.lists.loading){if(!!b){var c=this._getListTypeByTarget(b);this._updateShownList(c,!!b.data("end-edit"))}desknets.ntwi.lists.load(!this._isSetPrivilege)}if(a.isFunction(d)){d()}},toggleList:function(c,b){if(!desknets.ntwi.lists.loading){if(this.listName==c){this._updateShownList("all",b)}else{this._updateShownList(c,b)}desknets.ntwi.lists.load(!this._isSetPrivilege)}},search:function(c,d){var b=this;desknets.ntwi.searchList.search(c,function(e){b._updateShownList("search",true);if(typeof d=="function"){d(e)}})},close:function(){if(desknets.ntwi.entries.isInputed()){var b=this,c=desknets.Resource.Message.ntwi_confirm_to_close;c=desknets.tmpl.replaceWordHtml(c,"name",desknets.ntwi.entries.getCurrentModeName());desknets.ntwi.entries.startToEdit();desknets.dialog.confirm(c,function(){b._doClose()})}else{this._doClose()}},isShown:function(){return this.$root.hasClass("show")},setPrivilege:function(c){var b=this.$root.find("#ntwi-setting-menu");this._updateSettingMenuItem(b.find(".adlink"),c>=2);this._updateSettingMenuItem(b.find(".mglink"),c>=1);this._isSetPrivilege=true},_setUp:function(){this._setUpEvents();this._setUpLink();desknets.ntwi.entries.init();desknets.ntwi.searchList.init();desknets.ntwi.lists.init();desknets.ntwi.search.init();desknets.ntwi.cabinetregist.init();desknets.pageframe.setUpSetmenu(a("#ntwi-setting-menu"));desknets.ntwi.shortUrlList.init()},_setUpEvents:function(){var b=this;b.$root.find(".ntwi-close-btn").click(function(c){c.preventDefault();b.close()});b.$root.find(".jntwi-list-type-btn").click(function(d){d.preventDefault();var e=a(d.target).closest(".jntwi-list-type-btn");var c=b._getListTypeByTarget(e);b.toggleList(c,!!e.data("end-edit"))});b.$root.find(".ntwi-list-overlay").click(function(c){desknets.ntwi.entries.endToEdit();desknets.ntwi.messageList.unsetTargetUser(true)})},_setUpLink:function(){this.$root.find(".jntwi-page-link").each(function(){var f=a(this);var e=String(f.attr("href"));f.attr("href",e.replace(/.*\?/,desknets.ntwi.url+"?"))});var b=desknets.pageframe.getHelpHomeUrl();b=b.replace(/\/([\.\w]*\.html?)?$/,"");var d=true;var c=b.lastIndexOf(desknets.Resource.code);if(c>=0){if(b.length==(c+desknets.Resource.code.length)){d=false}}if(d){b+="/"+desknets.Resource.code+"/public/ntwi.html"}else{b+="/public/ntwi.html"}this.$root.find(".co-m-h-setting-menu.hplink>a").attr("href",b)},_onOpen:function(b){var c=this;var d=this.listName;desknets.ntwi.toolBar.clearNotifies();a(document.body).bind("click.ntwiContent",function(g){var e=a(g.target);var h=e.closest("#dn-body").length>0;var f=e.closest("#dn-ntwi-container, .co-topmsg").length>0;if(h&&!f){c.close()}});if(!!b){d=this._getListTypeByTarget(b)}desknets.ntwi.content.$root.trigger("ntwiopen",{listName:d})},_doClose:function(){this.$root.removeClass("show");a(document.body).unbind("click.ntwiContent");desknets.pageframe.notifyToHideLayer(this.$root);desknets.ntwi.entries.reset();desknets.ntwi.entries.endToEdit();desknets.ntwi.content.$root.trigger("ntwiclose")},_updateSettingMenuItem:function(b,c){if(c){b.show()}else{b.remove()}},_updateShownList:function(c,b){if(!!b){desknets.ntwi.entries.endToEdit()}this.$root.removeClass("list-type-"+this.listName);this.listName=c;this.$root.addClass("list-type-"+this.listName);desknets.ntwi.entries.changeMode(c)},_getListTypeByTarget:function(b){var c=b.closest(".jntwi-list-type-btn").data("type");return c||"all"}};desknets.ntwi.entries={$root:a(),_$mode:a(),_$ntwiForm:a(),_$messageForm:a(),_$messageEditor:a(),init:function(){this.$root=a("#dn-ntwi-container .ntwi-entries");this._$mode=this.$root.find(".ntwi-target-mode");this._$ntwiForm=this.$root.find(".ntwi-entry-form-ntwi");this._$messageForm=this.$root.find(".ntwi-entry-form-message");if(desknets.ntwi.talkAvailable||desknets.ntwi.messageAvailable){this._initProfileImage();this._initEvents();if(desknets.ntwi.messageAvailable){this._initEventsInMessage();this._setToMessageEntry()}if(desknets.ntwi.talkAvailable){this._initEventsInNtwi();this._setToNtwiEntry()}}},getCurrentModeName:function(){return this._$mode.find("input:checked").next().text()},setTargetUser:function(b){var e=!!b?b.id:"";var d=!!b?b.name:"";var c=a("#jntwi-user-chooser > .co-sel");this._$messageForm.find(".jntwi-target-id").val(e);this._$messageForm.find(".jntwi-target-name").text(d);if(c.length>0){c.dnChooser("deselect")}},startToEdit:function(){if(!desknets.ntwi.content.$root.hasClass("edit-mode")){desknets.ntwi.content.$root.addClass("edit-mode");this._focusTextarea()}},endToEdit:function(){if(desknets.ntwi.content.$root.hasClass("edit-mode")){desknets.ntwi.content.$root.removeClass("edit-mode")}},setToReplyEntry:function(c,b){this.startToEdit();this.changeMode("talk");this.$root.addClass("target-reply");this._$ntwiForm.find(".jntwi-target-id").prop("disabled",false).val(c);this._$ntwiForm.find(".jntwi-target-name").text(b)},setToSendMessage:function(b,c){this.startToEdit();this.changeMode("message");if(!!b){this.setTargetUser({id:b,name:c})}},changeMode:function(c){var b=this._$mode.find("input:checked").val();if(c==desknets.ntwi.talkList.listName&&b=="message"){this._$mode.find("#jntwi-target-mode-ntwi").prop("checked",true);this._reflectEntryTargetByCheckBox()}else{if(c==desknets.ntwi.messageList.listName&&b=="ntwi"){this._$mode.find("#jntwi-target-mode-message").prop("checked",true);this._reflectEntryTargetByCheckBox()}}},isInputed:function(){var b=desknets.ntwi.content.$root.hasClass("edit-mode-ntwi");return this._isInputedInForm(b?this._$ntwiForm:this._$messageForm)},reset:function(){var b=this;this.$root.find("form").each(function(){b._resetFile(a(this))});this.$root.removeClass("target-reply");this._$ntwiForm.find(".jntwi-target-id").prop("disabled",true);this._$messageEditor.ntwiPictgramEditor("setValue","");this._$ntwiForm.find("textarea").val("").neoCounter("refresh")},sendStamp:function(d,c){var b=this;if(this._validate(this._$messageForm,"stamp")){desknets.ajax.rest({url:desknets.ntwi.restUrl,data:{cmd:desknets.ntwi.CMD_MESSAGE_ADD,to_uid:this._$messageForm.find('input[name="to_uid"]').val(),scid:d,sid:c},beforeSend:function(){desknets.submitform.setDisabled(b._$messageForm)},success:function(e){b._onCompleteToPost(true)},complete:function(){desknets.submitform.clearDisabled(b._$messageForm)}})}},_initProfileImage:function(){var b=desknets.pageframe.getLoginImageUrl();var c=a('<img class="ui-corner-all" />').attr("src",b);this.$root.find(">.co-image-box").append(c);if(b.indexOf("?")>=0){desknets.img.fitSize(c)}else{c.css({width:"100%",height:"100%"})}},_initEvents:function(){var b=this;this.$root.find(".ntwi-placeholder").click(function(c){b.startToEdit()});this._$mode.find("input:radio").click(function(c){b._reflectEntryTargetByCheckBox()});this.$root.on("click",".ntwi-entry-attach-name>.co-icon",function(c){c.preventDefault();b._resetFile(a(this).closest(".ntwi-icon-buttons"))});this.$root.find("form").each(function(){var c=a(this),d=c.find("textarea");b._resetFile(c.find(".ntwi-icon-buttons"));d.neoCounter({counterLabel:c.find(".ntwi-entry-counter"),remainOf:Number(d.data("max"))})})},_initEventsInNtwi:function(){var b=this;this._initForm(b._$ntwiForm);this._$ntwiForm.find(".ntwi-shorten-url-btn").click(function(c){c.preventDefault();b._shortenNtwiUrl()});this._$ntwiForm.find(".ntwi-post-btn").click(function(c){b._onClickNtwiPostButton()})},_initEventsInMessage:function(){var b=this;this._initForm(this._$messageForm);this.$root.find(".jntwi-choose-user").click(function(c){c.preventDefault();b._openUserChooser()});this._$messageEditor=this._$messageForm.find("textarea").ntwiPictgramEditor();desknets.ntwi.stampBalloon.init(this._$messageEditor,this._$messageForm.find(".ntwi-icon-btn"));this._$messageForm.find(".ntwi-shorten-url-btn").click(function(c){c.preventDefault();b._shortenMessageUrl()});this._$messageForm.find(".ntwi-post-btn").click(function(c){b._onClickMessagePostButton()})},_initForm:function(c){var b=this;desknets.ajax.submitForm(c,{url:desknets.ntwi.restUrl,dataType:"xml",beforeSend:function(){desknets.submitform.setDisabled(c)},success:function(d){b._onCompleteToPost()},complete:function(){desknets.submitform.clearDisabled(c)}})},_reflectEntryTargetByCheckBox:function(){var b=this;var d=desknets.ntwi.content.$root;var c=b._$mode.find("input:checked");if(c.is("#jntwi-target-mode-message")&&d.hasClass("edit-mode-ntwi")){b._setToMessageEntry()}else{if(c.is("#jntwi-target-mode-ntwi")&&d.hasClass("edit-mode-message")){b._setToNtwiEntry()}}this._focusTextarea()},_setToNtwiEntry:function(){if(desknets.ntwi.talkAvailable&&desknets.ntwi.messageAvailable){var b=this._$messageEditor.ntwiPictgramEditor("getValue");b=desknets.ntwi.pictogram.encodeForDisplay(b,{pictogram:"text",format:"text"});this.reset();this._$ntwiForm.find("textarea").val(b).neoCounter("refresh")}desknets.ntwi.content.$root.removeClass("edit-mode-message").addClass("edit-mode-ntwi")},_setToMessageEntry:function(){if(desknets.ntwi.talkAvailable&&desknets.ntwi.messageAvailable){var b=this._$ntwiForm.find("textarea").val();this.reset();this._$messageEditor.ntwiPictgramEditor("setValue",b)}desknets.ntwi.content.$root.removeClass("edit-mode-ntwi").addClass("edit-mode-message")},_isInputedInForm:function(b){var d=b.find("textarea").val();var c=b.find('input[type="file"]').val();return !!d||!!c},_focusTextarea:function(){if(desknets.ntwi.content.$root.hasClass("edit-mode-ntwi")){this._$ntwiForm.find("textarea").focus()}else{this._$messageEditor.ntwiPictgramEditor("focus")}},_openUserChooser:function(){var c=this,b=this._$messageForm.find(".ntwi-entries-target");desknets.chooser.open("jntwi-user-chooser",{choosePrivateGroup:true,unassignGroup:"readonly",mode:"single",choose:function(d){if(d.length>0){setTimeout(function(){c.setTargetUser(d[0])},0)}}})},_resetFile:function(d){var b=this;var c=d.find(".ntwi-attach-btn");var e=a('<input type="file" name="attach" />').attr("title",c.attr("title"));d.find('input[type="file"]').remove();d.find(".ntwi-entry-attach-name").hide().children(".text").text("");c.prepend(e);e.on("change",function(f){b._setFileName(a(this))})},_setFileName:function(e){var b=String(e.val());var c=b.replace(/.*[\/\\]/,"");var d=e.closest(".ntwi-icon-buttons").find(".ntwi-entry-attach-name");d.show();d.children(".text").text(c).attr("title",c)},_shortenNtwiUrl:function(){var b=this._$ntwiForm.find("textarea");desknets.shortenUrl.shortenUrlInText(b.val(),function(c){b.val(c).neoCounter("refresh")})},_shortenMessageUrl:function(){var b=this,c=this._$messageEditor.ntwiPictgramEditor("getValue");desknets.shortenUrl.shortenUrlInText(c,function(d){b._$messageEditor.ntwiPictgramEditor("setValue",d)})},_onClickNtwiPostButton:function(){var b=this;if(this._validate(this._$ntwiForm,"ntwi")){if(desknets.ntwi.confirmToPost){var c=desknets.Resource.Message.ntwi_confirm_to_post;desknets.dialog.confirm(c,function(){b._$ntwiForm.submit()})}else{b._$ntwiForm.submit()}}},_onClickMessagePostButton:function(){if(this._validate(this._$messageForm,"message")){this._$messageForm.submit()}},_validate:function(c,e){var b=desknets.Resource.Message;var g=c.find("textarea");var f=c.find("textarea").neoCounter("count");var d=String(c.find('input[name="to_uid"]').val());if(e!="stamp"){if(!this._isInputedInForm(c)){desknets.dialog.alert(b["ntwi_"+e+"_required"]);return false}if(f<0){desknets.dialog.alert(b["ntwi_"+e+"_too_long"]);return false}}if(e!="ntwi"&&!d){desknets.dialog.alert(b.ntwi_message_to_required);return false}return true},_onCompleteToPost:function(c){if(this._$mode.find("input:checked").val()=="ntwi"){desknets.ntwi.lists.loadWithName("talk")}else{var b=this._$messageForm.find(".jntwi-target-id").val();var d=this._$messageForm.find(".jntwi-target-name").text();desknets.ntwi.messageList.setTargetUser(b,d)}if(c!==true||this.isInputed()!=true){this.endToEdit();this.reset()}}};desknets.ntwi.stampBalloon={TMPL_ITEM:'<li><a href="#">{{item}}</a></li>',TMPL_IMAGE_ITEM:'<li data-id="{{id}}"><a href="#"><img src="{{url}}" alt="{{name}}" title="{{name}}" {{attrs}} /></a></li>',STAMP_IMAGE_SIZE:{width:75,height:75},$root:a(),_$editor:a(),_$pictograms:a(),_$stamps:a(),_$stampCategries:a(),_isLoaded:false,init:function(c,b){this.$root=a("#ntwi-entry-icon-balloon");this._$editor=c;this._$pictograms=this.$root.find(".ntwi-entry-icon-body > .pictogram");this._$stamps=this.$root.find(".ntwi-entry-icon-body > .stamp");this._$stampCategries=this.$root.find(".ntwi-entry-icon-stamp-categories");this._initEvent(b)},_initEvent:function(b){var c=this;b.on("open.popup",function(){c._onOpenBalloon()});b.on("close.popup",function(){c._onCloseBalloon()});this.$root.on("click",".ntwi-entry-icon-switch-button",function(d){d.preventDefault();c._toggleMode()});this._$pictograms.on("click","a",function(d){d.preventDefault();c._insertPictogram(a(this))});this._$stamps.on("click","a",function(d){d.preventDefault();c._sendStamp(a(this))});var c=this;c._$stampCategries.prev().click(function(d){d.preventDefault();c._initStampCategoryMove(true)});c._$stampCategries.next().click(function(d){d.preventDefault();c._initStampCategoryMove(false)});this._$stampCategries.on("click","a",function(d){d.preventDefault();c._changeCategory(a(this).closest("li"))})},_initStampCategoryMove:function(d){var b=this;if(b._$stampCategries.not(":animated").length>0){var c=440;if(d){c=-440}var e=b._$stampCategries.scrollLeft()+c;b._$stampCategries.animate({scrollLeft:e},"slow")}},_initStamp:function(f){var e=this;var b=this._$stamps,d=this._$stampCategries;var c=[{cmd:desknets.ntwi.CMD_STAMP_CATEGORY_LIST},{cmd:desknets.ntwi.CMD_STAMP_HISTORY_LIST}];desknets.ajax.rest({url:desknets.ntwi.restUrl,data:desknets.ajax.arrayToMultiCmdData(c),success:function(g){d.html(e._createStampCategoryListHtml(g["0"]));b.html(e._createStampListHtml(g["1"],""));e._setUpStamp(f)}})},_setUpStamp:function(b){var c=this._$stampCategries.children();if(c.length>9){this._$stampCategries.closest(".stamp").addClass("slidable")}if(this._$stamps.children().length<=0&&c.length>1){this._changeCategory(c.eq(1),b)}else{this._selectCategory("");b()}},_createPictogramListHtml:function(){var b=this,c=[];a.each(desknets.ntwi.pictogram.getPictograms(),function(f,d){if(!!d){var e=b.TMPL_ITEM;e=desknets.tmpl.replaceWordHtml(e,"item",desknets.ntwi.pictogram.createImage(f));c.push(e)}});return c.join("")},_createStampCategoryListHtml:function(d){var b=this,e=[],c='width="32" height="24"';e.push(this._createImageItemHtml("","/dneores/images/ntwi/stamp_history.png",desknets.Resource.ntwi.historyLabel));a.each(desknets.ajax.getJsonItems(d),function(f,g){e.push(b._createImageItemHtml(g.id,g.referurl,g.Name,c))});return e.join("")},_createStampListHtml:function(d,f){var c=this,e=[];var b=!!d.attach?desknets.ajax.getItems(d.attach.item):[];a.each(b,function(h,j){var k=j.scid||f;var g=desknets.ntwi.convertToStampThumbnailUrl(j.referurl);e.push(c._createImageItemHtml(k+"_"+j.id,g,j.attachdisp))});return e.join("")},_createImageItemHtml:function(f,d,c,b){var e=this.TMPL_IMAGE_ITEM;e=desknets.tmpl.replaceWord(e,"id",f);e=desknets.tmpl.replaceWord(e,"url",d);e=desknets.tmpl.replaceWord(e,"name",c);e=desknets.tmpl.replaceWordHtml(e,"attrs",b||"");return e},_onOpenBalloon:function(){if(!this._isLoaded){this._isLoaded=true;this._$pictograms.html(this._createPictogramListHtml())}desknets.ntwi.entries.$root.find(".ntwi-post-btn").prop("disabled",true)},_onCloseBalloon:function(){desknets.ntwi.entries.$root.find(".ntwi-post-btn").prop("disabled",false)},_toggleMode:function(){var b=this;function c(){if(b._$stampCategries.children().length>1){b.$root.removeClass("pictogram").addClass("stamp")}else{desknets.dialog.alert(desknets.Resource.Message.ntwi_no_stamps);b.$root.find(".ntwi-entry-icon-buttons").hide()}}if(this.$root.hasClass("stamp")){this.$root.removeClass("stamp").addClass("pictogram")}else{if(this._$stampCategries.children().length<=0){this._initStamp(c)}else{c()}}},_changeCategory:function(f,d){if(!f.is(".on")){var b=this,e=f.data("id");var c=!!e?{cmd:desknets.ntwi.CMD_STAMP_LIST,id:e}:{cmd:desknets.ntwi.CMD_STAMP_HISTORY_LIST};desknets.ajax.rest({url:desknets.ntwi.restUrl,data:c,success:function(g){b._$stamps.html(b._createStampListHtml(g,e));b._selectCategory(e);if(typeof d=="function"){d()}}})}},_selectCategory:function(c){var b=this._$stampCategries.children().filter(function(){return a(this).data("id")==c});if(b.length!=1){b=$cat.children("li:first")}b.siblings(".on").removeClass("on");b.addClass("on")},_insertPictogram:function(b){var c=b.find("img").data("id");this._$editor.ntwiPictgramEditor("insertPictgram",c)},_sendStamp:function(c){var b=String(c.closest("li").data("id")).split("_");if(b.length>=2){desknets.popUp.hide(this.$root);desknets.ntwi.entries.sendStamp(b[0],b[1])}},};desknets.page(desknets.ntwi,"listBase",null,{TMPL_ITEM:"",$root:a(),$list:a(),isEnabled:true,listName:"x",tmplListItem:"",row:0,_TMPL_URL:"{{url}}?cmd={{cmd}}&id={{id}}&fno=1&filename={{name}}",init:function(){var b=this;b.$root=a(".ntwi-lists > .ntwi-"+this.listName+"-list");b.$list=b.$root.find(".ntwi-list-body > ul");b.tmplListItem=b.$root.find(".jntwi-list-item").html();b.$root.find(".ntwi-list-titlebar").click(function(c){if(a(c.target).closest(".ntwi-btn").length<=0){b.toggle()}});b.$root.find(".jntwi-reload").click(function(c){c.preventDefault();b.load()})},toggle:function(){desknets.ntwi.content.toggleList(this.listName,true)},load:function(e){var b=this,d,c;if(desknets.ntwi.lists.startToLoad()){b.row=!!e?e:0;b.unload();c=[b.getRequestParams()];c=desknets.ntwi.lists.filterRequestParams(c,b.listName);d=(c.length==1)?c[0]:desknets.ajax.arrayToMultiCmdData(c);desknets.ajax.rest({url:desknets.ntwi.restUrl,data:d,success:function(g){var f=g["0"]||g;b.setListData(f)},complete:function(){desknets.ntwi.lists.endToLoad()}})}},setListData:function(c){var b=desknets.ajax.getJsonItems(c);this.unload();this.$root.removeClass("ntwi-list-loading");this._updateList(b);if(desknets.ntwi.content.listName!="all"){this._updatePager(c,b)}else{this._updateMoreLink(c,b)}},unload:function(){if(!this.$root.hasClass("ntwi-list-loading")){this.$list.parent().scrollTop(0);this.$list.empty();this.$root.removeClass("ntwi-list-no-items");this.$root.addClass("ntwi-list-loading")}},getRequestParams:function(){var b=desknets.ntwi.content.listName=="all"?desknets.ntwi.perPageAll:desknets.ntwi.perPageSingle;return{row:this.row,num:b}},getListItemHtml:function(b){return this.tmplListItem},replaceUser:function(f,d,e){var c="";var b="";if(!!f.uimgurl){c=String(f.uimgurl);if(c.indexOf("?")<0){b="ntwi-image-default"}else{if(e||c.indexOf("thumbnail=1")<0){b="ntwi-image-loading"}}}else{b="ntwi-image-none"}d=desknets.tmpl.replaceWord(d,"uimgurl",c);d=desknets.tmpl.replaceWord(d,"uname",f.uname);d=desknets.tmpl.replaceWordHtml(d,"userAttr",this._createUserAttr(f.uid,!!f.deluflg,!!f.user_state));d=desknets.tmpl.replaceWord(d,"uimgClass",b);return d},replaceAttachment:function(d,c,e){var b=this._getItemAttachData(d,e);c=desknets.tmpl.replaceWord(c,"attachUrl",b.url);c=desknets.tmpl.replaceWordHtml(c,"attachValue",b.value);c=desknets.tmpl.replaceWordHtml(c,"attachClasses",b.classes);c=desknets.tmpl.replaceWordHtml(c,"attachdisp",b.attachdisp);return c},formatDateTimeText:function(c){var b=neo.dateTime.parse(c);return !!b?neo.dateTime.format(desknets.Resource.dateTimeFormatWithSecond,b):""},updateListItems:function(e){var b=this;var c=this.$root.find(".ntwi-list-item:first");function d(f){if(f.length>0){e(f);setTimeout(function(){d(f.next())},0)}}setTimeout(function(){d(c)},0)},_createUserAttr:function(d,b,c){if(!!b){return'class="ntwi-item-name-deleted"'}else{if(!!c){return'class="ntwi-item-name-suspension"'}else{return'href="#" class="jco-ref-dialog-link" data-refid="user'+d+'"'}}},_getItemAttachData:function(f,g){var c=this._TMPL_URL,e="",d="";var b=!!f.attach&&!!f.attach.item?f.attach.item:{attachdisp:""};c=desknets.tmpl.replaceWordHtml(c,"url",desknets.ntwi.url);c=desknets.tmpl.replaceWordHtml(c,"cmd",g);c=desknets.tmpl.replaceWordHtml(c,"id",f.id);c=desknets.tmpl.replaceWordHtml(c,"name",desknets.encodeURIComponentNeo(b.attachdisp));if(b.thumbnail){e='<img src="{{url}}&thumbnail=1" />';e=desknets.tmpl.replaceWord(e,"url",c);d="co-image-box"}else{if(!!b.attachdisp){e=desknets.tmpl.escapeWord(b.attachdisp);d="ntwi-item-filename"}}return{url:c,value:e,classes:d,attachdisp:b.attachdisp}},_updateList:function(b){var d=[];if(b.length>0){for(var c=0;c<b.length;c++){d.push(this.getListItemHtml(b[c]))}this.$list.html(d.join(""));this.$root.removeClass("ntwi-list-no-items")}else{this.$root.addClass("ntwi-list-no-items")}},_updatePager:function(d,c){var b=this;var e=!!d.allcnt?Number(d.allcnt):c.length;desknets.Pager.output(this.$root,".ntwi-nav",{getCount:c.length,allCount:e,pageMaxView:b._getPerPage(),startRow:b.row,msgPageNavi:"",clickFunc:function(f){b.load(f)}})},_updateMoreLink:function(c,b){var d=(!!c.allcnt&&c.allcnt>b.length)?"addClass":"removeClass";this.$root.find(".ntwi-list-body")[d]("has-more-page")},_getPerPage:function(){return desknets.ntwi.content.listName=="all"?desknets.ntwi.perPageAll:desknets.ntwi.perPageSingle}});desknets.page(desknets.ntwi,"talkList",desknets.ntwi.listBase,{listName:"talk",init:function(){this.callBase("init");this.isEnabled=desknets.ntwi.talkAvailable;this.tmplReplyListItem=this.$root.find(".jntwi-reply-list-item").html();this.tmplListItemBody=this.$root.find(".jntwi-list-item-body").html();this.tmplListItem=this._setUpReplyTmpl(this.tmplListItem);this.tmplReplyListItem=this._setUpReplyTmpl(this.tmplReplyListItem);if(!desknets.pageframe.isShownMenu("cab")){this.$root.addClass("ntwi-cab-unavailable")}this._initSideButton()},setListData:function(c){var b=this;this.callBase("setListData",c);this.updateListItems(function(d){b._updateThreadItem(d,desknets.ntwi.ICON_SIZE)})},getRequestParams:function(){var b=this.callBase("getRequestParams");return a.extend(b,{cmd:desknets.ntwi.CMD_TALK_LIST})},getListItemHtml:function(b){return this._replaceThreadItemHtml(b,this.tmplListItem,false)},_initSideButton:function(){var b=this;b.$list.delegate(".ntwi-btn.reply-to","click",function(c){c.preventDefault();b._toggleReplyToEntry(a(this))});b.$list.delegate(".ntwi-btn.reply","click",function(c){c.preventDefault();b._replyEntry(a(this))});b.$list.delegate(".ntwi-btn.delete","click",function(c){c.preventDefault();b._deleteEntry(a(this))});b.$list.delegate(".ntwi-btn.cabinet","click",function(c){c.preventDefault();b._sendAttachmentToCabinet(a(this))})},_setUpReplyTmpl:function(b){return desknets.tmpl.replaceWordHtml(b,"T_ItemBody",this.tmplListItemBody)},_toggleReplyToEntry:function(c){var b=c.closest(".jntwi-thread-box");if(b.children(".ntwi-replied-box").length<=0){this._beginToCreateBaseEntry(b,c.data("id"))}else{b.toggleClass("ntwi-show-reply-to")}},_beginToCreateBaseEntry:function(b,d){var c=this;if(b.hasClass("ntwi-load-reply-to")){return}b.addClass("ntwi-load-reply-to");desknets.ajax.rest({url:desknets.ntwi.restUrl,data:{cmd:desknets.ntwi.CMD_TALK_REF,id:d},success:function(e){c._setThreadBaseData(b,e)},complete:function(){b.removeClass("ntwi-load-reply-to")}})},_setThreadBaseData:function(b,e){var c=a('<div class="ntwi-replied-box jntwi-thread-box" />');var d=this._replaceThreadItemHtml(e,this.tmplReplyListItem,true);c.html(d);b.append(c).addClass("ntwi-show-reply-to");this._updateThreadItem(c.children(".ntwi-thread-item"),desknets.ntwi.SMALL_ICON_SIZE)},_replaceThreadItemHtml:function(d,b,c){b=desknets.tmpl.replaceWordHtml(b,"id",d.id);b=this.replaceUser(d,b,c);b=desknets.tmpl.replaceWordLF(b,"detail",d.detail);b=desknets.tmpl.replaceWordHtml(b,"date",this.formatDateTimeText(d.cretime));b=desknets.tmpl.replaceWordHtml(b,"replyid",d.replyid||"");b=desknets.tmpl.replaceWordHtml(b,"classes",this._getItemClasses(d));b=this.replaceAttachment(d,b,desknets.ntwi.CMD_TALK_DOWNLOAD);return b},_getItemClasses:function(c){var b=[];if(c.uid==desknets.pageframe.getLoginUid()){b.push("mine")}if(!!c.replyid){b.push("replied")}if(!!c.attach&&!!c.attach.item){b.push("has-attachment")}return b.join(" ")},_updateThreadItem:function(d,b){var c=d.find(".ntwi-item-icon.ntwi-image-loading > img");var f=d.find(".ntwi-item-file-link > .ntwi-image-loading > img");var e=d.find(".jntwi-item-detail");if(c.length>0){c.parent().removeClass("ntwi-image-loading");desknets.img.fitSize(c,b)}desknets.htmlparts.convertHrefInText(e)},_replyEntry:function(b){var d=b.closest(".ntwi-ntwi-item");var e=d.data("id");var c=d.find(".ntwi-item-title").text();setTimeout(function(){desknets.ntwi.entries.setToReplyEntry(e,c)},0)},_deleteEntry:function(b){var c=this;var d=b.closest(".ntwi-ntwi-item");desknets.ntwi.confirmToProcess(desknets.Resource.Message.com_del_conf,{cmd:desknets.ntwi.CMD_TALK_DEL,id:d.data("id")},function(){c.load(0)})},_sendAttachmentToCabinet:function(b){desknets.ntwi.cabinetregist.execute(b)}});desknets.page(desknets.ntwi,"newsList",desknets.ntwi.listBase,{listName:"news",init:function(){this.callBase("init");this._initListEvent()},setListData:function(b){this.callBase("setListData",b);desknets.ntwi.checkMailIfEnabled(true);desknets.ntwi.toolBar.refresh()},getRequestParams:function(){var b=this.callBase("getRequestParams");return a.extend(b,{cmd:desknets.ntwi.CMD_NEWS_LIST})},getListItemHtml:function(e){var c=this.tmplListItem;var b=this._createAttrText("style",e.bgcolor,"background-color:{{value}};");var f=e.iconurl||desknets.ntwi.getIconUrlById(e.mid);var d=desknets.ntwi.getNewsMessage(e,"detail");f=desknets.tmpl.replaceWordHtml(f,"ext",desknets._msExtension);if(e.mid==="safety"){c=desknets.tmpl.replaceWordHtml(c,"id",e.cretime)}else{c=desknets.tmpl.replaceWordHtml(c,"id",e.id)}c=desknets.tmpl.replaceWordHtml(c,"itemAttr",b);c=desknets.tmpl.replaceWordHtml(c,"mid",e.mid);c=desknets.tmpl.replaceWordHtml(c,"iconurl",f);c=desknets.tmpl.replaceWord(c,"title",e.title);c=desknets.tmpl.replaceWordHtml(c,"textAttr",this._createLinkAttrs(e));if(e.mid=="-1"){d=desknets.tmpl.replaceWordHtml(d,"ext",desknets._msExtension);c=desknets.tmpl.replaceWordHtml(c,"message",d)}else{c=desknets.tmpl.replaceWordLF(c,"message",d)}c=desknets.tmpl.replaceWordHtml(c,"count",this._createCountLabel(e));c=desknets.tmpl.replaceWordHtml(c,"date",this._formatCreatedDateTimeText(e));return c},_initListEvent:function(){var b=this;b.$list.delegate(".ntwi-item-title","click",function(c){b._onClickTitle(c)});b.$list.delegate(".ntwi-btn.delete","click",function(c){c.preventDefault();b._deleteEntry(a(this))})},_createLinkAttrs:function(d){var c=[],b=String(d.url);if(d.mid=="safety"){b=b+"#cmd=safetycmddisasterinfolist&"+desknets.createRandomId()+"=1"}c.push(this._createAttrText("href",b));if(d.mid==-1&&b.indexOf("http")==0){c.push('target="_blank"')}return c.join(" ")},_createAttrText:function(b,c,d){if(!neo.isSet(c,{blank:false})){return""}if(typeof d=="string"){c=desknets.tmpl.replaceWordHtml(d,"value",c)}return desknets.tmpl.replaceWord(b+'="{{value}}"',"value",c)},_createCountLabel:function(d){var f="";if(d.mid=="todo"){var e=[];if(Number(d.count)>0){var b=desknets.Resource.ntwi.toDoItemsLabel;e.push(desknets.tmpl.replaceWordHtml(b,"count",d.count))}if(Number(d.othercnt)>0){var c=desknets.Resource.ntwi.toDoExpiredLabel;e.push(desknets.tmpl.replaceWordHtml(c,"othercnt",d.othercnt))}if(e.length>0){f="("+e.join(", ")+")"}}else{if(d.mid=="mail"){}else{if(Number(d.count)>1){f="("+desknets.Resource.ntwi.andNItemsLabel+")";f=desknets.tmpl.replaceWordHtml(f,"count",d.count-1)}}}return f},_formatCreatedDateTimeText:function(c){if(c.mid=="-1"||c.mid==="info"){var d=desknets.Resource.dateFormat;var b=neo.dateTime.parse(c.cretime);return !!b?neo.dateTime.format(d,b):""}else{return this.formatDateTimeText(c.cretime)}},_onClickTitle:function(c){var b=a(c.target).closest(".ntwi-list-item");if(b.hasClass("ntwi-news-item-mail")){c.preventDefault();desknets.ntwi.toolBar.clearNotifyByModule("mail");b.remove();desknets.webmail.openMailList()}if(b.hasClass("ntwi-news-item-info")){setTimeout(function(){desknets.ntwi.content.close()},1000)}},_deleteEntry:function(b){var c=this;var d=b.closest(".ntwi-list-item");if(d.hasClass("ntwi-news-item-safety")){desknets.ntwi.confirmToProcess(desknets.Resource.Message.com_del_conf,{cmd:desknets.ntwi.CMD_SAFETYNEWS_DEL,cretime:d.data("id")},function(){c.load(0)})}else{desknets.ntwi.confirmToProcess(desknets.Resource.Message.com_del_conf,{cmd:desknets.ntwi.CMD_NEWS_DEL,id:d.data("id")},function(){c.load(0)})}}});desknets.page(desknets.ntwi,"messageList",desknets.ntwi.listBase,{_TMPL_USERIMAGE:'<img class="ui-corner-all" src="{{uimgurl}}">',listName:"message",_userId:null,_userName:null,_userImage:null,_tmplCommListItem:"",_tmplStampListItem:"",_tmplCommSep:"",_lastItemDate:"",_lastReadStates:{me:false,you:false},init:function(){this.callBase("init");this.isEnabled=desknets.ntwi.messageAvailable;this._tmplCommListItem=this.$root.find(".jntwi-communication-list-item").html();this._tmplCommSep=this.$root.find(".jntwi-communication-separator").html();this._tmplStampListItem=this.$root.find(".jntwi-stamp-list-item").html();if(this.isEnabled){this._initEvent()}},setListData:function(c){var b=this;if(!!this._userId){this._lastItemDate=neo.dateTime.format("yyyyMMdd",desknets.dateTime.current);this._lastReadStates={me:false,you:false};this._userImage=c.uimgurl||"";this._readMessage(c)}this.callBase("setListData",c);this.updateListItems(function(d){b._updateListItem(d)})},getTargetUserID:function(){return this._userId},setTargetUser:function(g,c,d,f){if(!desknets.ntwi.lists.loading){this._userId=g;this._userName=c;var b=this.$root.find(".ntwi-message-communication-header>.ntwi-item-name");var e=b.find(".ntwi-item-uname-message");e.text(this._userName);if(!!d||!!f){b.find(".ntwi-item-dmreply").hide();e.data("refid","");e.addClass("del");e.removeAttr("href")}else{b.find(".ntwi-item-dmreply").show();e.data("refid","user"+this._userId);e.removeClass("del");e.attr("href","#");this._replyEntry(b.find(".ntwi-item-dmreply"))}this.$root.addClass("ntwi-communication-list");this.load(0)}},unsetTargetUser:function(b){if(!desknets.ntwi.lists.loading){this._unsetTargetUserOnHtml(b);this.load(0)}},getRequestParams:function(){var b=this.callBase("getRequestParams");if(!!this._userId){return a.extend(b,{cmd:desknets.ntwi.CMD_MESSAGE_LIST,id:this._userId})}else{return a.extend(b,{cmd:desknets.ntwi.CMD_MESSAGE_USER_LIST})}},getListItemHtml:function(b){if(!!this._userId){return this._getCommunicationListItemHtml(b)}else{return this._getUserListItemHtml(b)}},_initEvent:function(){var b=this;b.$root.find(".ntwi-btn.delete").click(function(c){c.preventDefault();b._deleteEntries()});b.$root.find(".ntwi-btn.cabinet").click(function(c){c.preventDefault();desknets.ntwi.cabinetregist.execute(a(this))});b.$list.delegate(".ntwi-message-item","click",function(c){if(a(c.target).closest("a").length<=0){c.preventDefault();b._setTargetUserByElement(a(this))}});b.$root.find(".ntwi-message-communication-header > .ntwi-btn.back").click(function(c){c.preventDefault();b.unsetTargetUser()});b.$root.find(".ntwi-item-dmreply").click(function(c){c.preventDefault();b._replyEntry(a(this))});desknets.ntwi.content.$root.on("ntwiclose",function(c,d){b._unsetTargetUserOnHtml()})},_getUserListItemHtml:function(e){var c=this.tmplListItem,d=e.detail;var b=this._getUserItemClasses(e);var f=this._createStampImageTag(e,true);if(!!f){b.push("has-stamp")}var g="0";if(!!e.deluflg){g="1"}c=desknets.tmpl.replaceWordHtml(c,"del",g);c=desknets.tmpl.replaceWordHtml(c,"id",e.uid);c=this.replaceUser(e,c,false);c=desknets.tmpl.replaceWordHtml(c,"classes",b.join(" "));c=desknets.tmpl.replaceWordHtml(c,"detail",this._formatDetailText(d));c=this.replaceAttachment(e,c,desknets.ntwi.CMD_MESSAGE_DOWNLOAD);c=desknets.tmpl.replaceWordHtml(c,"stamp",f);c=desknets.tmpl.replaceWordHtml(c,"date",this.formatDateTimeText(e.cretime));c=desknets.tmpl.replaceWordHtml(c,"suspension",e.user_state);return c},_getCommunicationListItemHtml:function(g){var e=this._tmplCommListItem,f="readByMeLabel",b="";var d={uname:"",uimgurl:this._userImage};var h=this._createStampImageTag(g);var c=this._getCommunicationItemClasses(g);e=!!h?this._tmplStampListItem:this._tmplCommListItem;if(a.inArray("you",c)>=0){f="readByYouLabel";d.uimgurl=this._userImage}e=this._replaceSeparator(g,e);e=desknets.tmpl.replaceWordHtml(e,"id",g.id);e=desknets.tmpl.replaceWordHtml(e,"classes",c.join(" "));e=this.replaceUser(d,e,false);e=desknets.tmpl.replaceWordLF(e,"L_READ",desknets.Resource.ntwi[f]);e=desknets.tmpl.replaceWordHtml(e,"time",this._formatTimeText(g.cretime));e=desknets.tmpl.replaceWordHtml(e,"sysdatetime",g.cretime);if(!!h){e=desknets.tmpl.replaceWordHtml(e,"stampImage",h)}else{e=desknets.tmpl.replaceWordHtml(e,"detail",this._formatDetailText(g.detail));e=this.replaceAttachment(g,e,desknets.ntwi.CMD_MESSAGE_DOWNLOAD)}return e},_updateListItem:function(c){var b=c.find(".ntwi-item-icon.ntwi-image-loading > img");var d=c.find(".ntwi-item-text");if(b.length>0){b.parent().removeClass("ntwi-image-loading");desknets.img.fitSize(b,desknets.ntwi.ICON_SIZE)}desknets.htmlparts.convertHrefInText(d)},_replaceSeparator:function(e,c){var b=e.cretime,f=this._tmplCommSep;if(!!b&&b.indexOf(this._lastItemDate)!=0){var d=neo.dateTime.format(desknets.Resource.longDateFormat,neo.dateTime.parse(b));f=desknets.tmpl.replaceWordHtml(f,"date",d);this._lastItemDate=b.substring(0,8);return f+c}return c},_getUserItemClasses:function(c){var b=[];if(c.read=="0"){b.push("unread")}if(!!c.attach&&!!c.attach.item){b.push("has-attachment")}return b},_getCommunicationItemClasses:function(c){var b=[],d=(c.from=="me");b.push(d?"me":"you");if(!!c.detail){b.push("has-text")}if(!!c.attach&&!!c.attach.item){b.push("has-attachment")}if(d&&c.read=="1"&&!this._lastReadStates.me){b.push("read");this._lastReadStates.me=true}else{if(!d&&!this._lastReadStates.you){b.push("read");this._lastReadStates.you=true}}return b},_formatTimeText:function(b){var d=desknets.Resource.timeFormat;var c=neo.dateTime.parse(b);return !!c?neo.dateTime.format(d,c):""},_formatDetailText:function(b){return desknets.ntwi.pictogram.encodeForDisplay(b)},_createStampImageTag:function(e,d){var b='<img src="{{url}}" alt="{{name}}" />';if(!!e.sname){if(!e.referurl){b="("+e.sname+")"}else{var c=!!d?desknets.ntwi.convertToStampThumbnailUrl(e.referurl):e.referurl;b=desknets.tmpl.replaceWord(b,"url",String(c));b=desknets.tmpl.replaceWord(b,"name",String(e.sname))}return b}return""},_unsetTargetUserOnHtml:function(b){this._userId=null;this.$root.find(".ntwi-message-communication-header>.ntwi-item-name>.ntwi-item-uname-message").text("");this.$root.removeClass("ntwi-communication-list");this.$list.empty();if(!b){desknets.ntwi.entries.setTargetUser(null)}},_setTargetUserByElement:function(b){this.setTargetUser(b.data("id"),b.find(".ntwi-item-title").text(),b.data("del")=="1",b.data("suspension")=="1")},_replyEntry:function(b){var c=this;setTimeout(function(){desknets.ntwi.entries.setToSendMessage(c._userId,c._userName)},0)},_readMessage:function(b){var c=desknets.ntwi.toolBar.getNewItemCount("message");a.each(desknets.ajax.getJsonItems(b),function(d,e){if(e.from!="me"&&e.read!="1"){c--}});desknets.ntwi.toolBar.setNewItemCount("message",Math.max(c,0))},_deleteEntries:function(){var b=this;var c=b.$list.children(".ntwi-communication-item").eq(0).data("id");desknets.ntwi.confirmToProcess(desknets.Resource.Message.ntwi_message_confirm_to_delete,{cmd:desknets.ntwi.CMD_MESSAGE_DEL,uid:b._userId,id:c},function(){b.unsetTargetUser()})}});desknets.page(desknets.ntwi,"searchList",desknets.ntwi.talkList,{listName:"search",_conditions:{},search:function(c,d){var b=this;b._conditions=c;b.row=0;if(desknets.ntwi.lists.startToLoad()){desknets.ajax.rest({url:desknets.ntwi.restUrl,data:b.getRequestParams(),success:function(e){b.unload();b.setListData(e);if(typeof d=="function"){d(e.history_id)}},complete:function(){desknets.ntwi.lists.endToLoad()}})}},init:function(){var b=this,c=a(".ntwi-lists > .ntwi-search-list");a(".ntwi-lists > .ntwi-talk-list script").each(function(){a(this).clone().appendTo(c)});this.callBase("init")},getRequestParams:function(){var b=this.callBase("getRequestParams");return a.extend(b,this._conditions)}});desknets.ntwi.lists={loading:false,_$lists:a(),_lists:[],_hasExtList:true,init:function(){this._$lists=desknets.ntwi.content.$root.find(".ntwi-lists");this._$lists.resizable({handles:"s",minHeight:250});this._lists=[desknets.ntwi.talkList,desknets.ntwi.newsList,desknets.ntwi.messageList];for(var b=0;b<this._lists.length;b++){this._lists[b].init()}},load:function(d){var b=this;if(this.startToLoad()){for(var c=0;c<b._lists.length;c++){b._lists[c].row=0}desknets.ajax.rest({url:desknets.ntwi.restUrl,data:b._getRequestParams(d),success:function(e){b._updateContents(e,d)},complete:function(){b.endToLoad()}})}},loadWithName:function(c){var b=this._getActiveLists();for(var d=0;d<b.length;d++){if(b[d].listName==c){b[d].load()}}},unload:function(){for(var b=0;b<this._lists.length;b++){this._lists[b].unload()}},startToLoad:function(){if(this.loading){return false}this.loading=true;return true},endToLoad:function(){this.loading=false},filterRequestParams:function(f,b){var g=desknets.ntwi.talkList.listName;var c=desknets.ntwi.newsList.listName;var e=desknets.ntwi.messageList.listName;var d=desknets.ntwi.messageList.getTargetUserID();if(!b){b=desknets.ntwi.content.listName}if(b==g){if(desknets.ntwi.toolBar.getNewItemCount(g)>0){f.push({cmd:desknets.ntwi.CMD_NOTIFY,kind:"1"});desknets.ntwi.toolBar.setNewItemCount(g,0)}}else{if(b==c){if(desknets.ntwi.toolBar.getNewItemCount(c)>0){f.push({cmd:desknets.ntwi.CMD_NOTIFY,kind:"3"})}}}if((b=="all"||b=="message")&&!!d){f.push({cmd:desknets.ntwi.CMD_MESSAGE_READ,uid:d})}return f},_getRequestParams:function(f){var e=[];var b=this._getActiveLists();var c=desknets.attach.ext.getListParam();if(!desknets.ntwi.pictogram.isSet()){e.push({cmd:desknets.ntwi.CMD_PICTOGRAM_LIST})}for(var d=0;d<b.length;d++){e.push(b[d].getRequestParams())}if(f){e.push({cmd:desknets.ntwi.CMD_GETMANAGER})}if(!!c){this._hasExtList=false;e.unshift({cmd:desknets.ntwi.CMD_EXT_LIST})}e=this.filterRequestParams(e);return desknets.ajax.arrayToMultiCmdData(e)},_updateContents:function(g,h){var b=this._getActiveLists(),d=0,f;f=g[d.toString()];if(!this._hasExtList&&!!f){desknets.attach.ext.saveList(f);d++;this._hasExtList=true}if(!desknets.ntwi.pictogram.isSet()){desknets.ntwi.pictogram.setValuesFromJson(g[d.toString()]);d++}for(var e=0;e<b.length;e++){b[e].setListData(g[d.toString()]);d++}f=g[d.toString()];if(h&&!!f){var c=f.manage;desknets.ntwi.content.setPrivilege(c);d++}},_getActiveLists:function(){var b=[];var c=desknets.ntwi.content.listName;for(var d=0;d<this._lists.length;d++){var e=this._lists[d];if((c=="all"||c==e.listName)&&e.isEnabled){b.push(e)}}if(c==desknets.ntwi.shortUrlList.listName){b.push(desknets.ntwi.shortUrlList)}return b}};desknets.page(desknets.ntwi,"shortUrlList",desknets.ntwi.listBase,{listName:"shorturl",init:function(){var b=this;b.callBase("init");b.$list=b.$root.find(".ntwi-surl-list > ul");b._initSURLEvent()},getRequestParams:function(){var b=this._getSortParams();return a.extend(b,{cmd:desknets.ntwi.CMD_SURL_LIST})},getListItemHtml:function(c){var b=this.tmplListItem;b=desknets.tmpl.replaceWordHtml(b,"id",c.id);b=desknets.tmpl.replaceWord(b,"url",c.url);b=desknets.tmpl.replaceWordHtml(b,"click_cnt",c.click_cnt);b=desknets.tmpl.replaceWordHtml(b,"cretime",desknets.dateTime.dispDateTime(c.cretime,{type:"list"}));b=desknets.tmpl.replaceWordHtml(b,"surl",desknets.shortenUrl.getShortUrl(c.id));return b},_updatePager:function(d,c){var b=this;b.$root.find(".jco-checkbox-all").attr("checked",false)},_initSURLEvent:function(){var b=this;b.$root.find(".ntwi-surl-btn.shorten").click(function(c){b._AddShortenURL()});b.$root.find(".ntwi-surl-btn.pageshorten").click(function(c){b._AddShortenURLGetPage()});b.$root.find(".ntwi-surl-btn.clear").click(function(c){b._ClearShortenURL()});b.$root.find(".jco-list-del-submit").click(function(c){b._listDelSubmit()});b._initSURLInput();b._initSURLTextArea();b._initSURLSelectBtn();b._initChkBox();b._initSort()},_getSortParams:function(){var c=this;var b=c.$root.find(".ntwi-surl-list-sort-item");if(b.find(".desc").length==1){return{fldsort:b.find(".desc").data("sort"),order:"-1"}}else{if(b.find(".asc").length==1){return{fldsort:b.find(".asc").data("sort"),order:"1"}}}return{}},_AddShortenURL:function(){var b=this.$root.find('input[name="url"]').val();this._AddShortenURLAjax(b)},_AddShortenURLGetPage:function(){var b=window.location.href;this._AddShortenURLAjax(b)},_AddShortenURLAjax:function(c){var b=this;var e={cmd:desknets.ntwi.CMD_SURL_ADD,url:c};b.$root.find(".ntwi-surl-btn").attr("disabled",true);var d=!desknets.browser.ipad;desknets.ajax.rest({async:d,url:desknets.ntwi.restUrl,data:e,success:function(g,f,h){if(neo.isSet(g.existflg)){b._ConfirmShortenURL(g,c)}else{b._AddSuccess(g,c,true)}},complete:function(h,f,g){b.$root.find(".ntwi-surl-btn").attr("disabled",false)},error:function(i,g,k){var j=k;var f=a.parseJSON(i.responseText);if(!!f.errmsgadd){var h={};h.msg=f.errormessage;h.fieldid=f.errmsgadd;if(f.errmsgadd=="url"){h.fieldname="URL"+desknets.merrMsgConnect}j=desknets.getErrConvMsg(h)}desknets.ajax.onError(i.status,j)}})},_ConfirmShortenURL:function(e,d){var b=this;var f=desknets.Resource.Message.ntwi_surl_entryconf;var c={extraMessage:desknets.Resource.Message.ntwi_surl_entryconf_extra,cancel:function(){b._AddSuccess(e,d,false)}};desknets.dialog.confirm(f,function(){b._EntryShortenURLAjax(d)},c)},_EntryShortenURLAjax:function(c){var b=this;var e={cmd:desknets.ntwi.CMD_SURL_ADD,url:c,entrydup:"1"};var d=!desknets.browser.ipad;desknets.ajax.rest({async:d,url:desknets.ntwi.restUrl,data:e,success:function(g,f,h){b._AddSuccess(g,c,true)}})},_AddSuccess:function(d,c,g){var b=this;var f=desknets.shortenUrl.getShortUrl(d.id);var e='<a target="_blank" href="'+desknets.tmpl.escapeWord(c)+'" title="'+desknets.tmpl.escapeWord(c)+'">'+desknets.tmpl.escapeWord(c)+"</a><br />";b.$root.find(".ntwi-surl-input-balloon-info").html(e);if(g){b.$root.find(".ntwi-surl-input-balloon-info").append(desknets.Resource.ntwi.urlShorten)}else{b.$root.find(".ntwi-surl-input-balloon-info").append(desknets.Resource.ntwi.urlShortenExist)}b.$root.find(".ntwi-surl-input-result").find(".jntwi-surl").val(f);b.$root.find(".ntwi-surl-input-result").find('input[name="surl"]').val(f);b.$root.find(".ntwi-surl-input").hide();b.$root.find(".ntwi-surl-input-result").show();if(g){b._Success()}b.$root.find(".ntwi-surl-input-result").find("input:text").trigger("focus")},_Success:function(d){var c=this;var b;b=c.$root.find(".ntwi-surl-list-sort-item");b.find("a").each(function(){var e=a(this);e.removeClass("desc");e.removeClass("asc");if(e.data("sort")=="cretime"){e.addClass("desc")}});b.hide();c.load()},_initSURLInput:function(){var b=this;var d=b.$root.find(".ntwi-surl-input").find("input:text");var c=b.$root.find(".ntwi-surl-input").find(".co-watermark");c.click(function(){d.focus()}).text(d.attr("title"));d.focus(function(){c.removeClass("on")}).blur(function(){if(d.val()==""){c.addClass("on")}})},_initSURLTextArea:function(){var b=this;b.$root.find(".ntwi-surl-input-result").find("input:text").focus(function(c){if(desknets.browser.tablet){this.setSelectionRange(0,9999)}else{a(this).select()}}).mouseup(function(c){c.preventDefault()});b.$root.find(".ntwi-surl-input-result").find("input:text").change(function(c){b._resetShortenURL(a(this))})},_initSURLSelectBtn:function(){var b=this;b.$list.on("focus",".ntwi-surl-copytext",function(c){if(desknets.browser.tablet){this.setSelectionRange(0,9999)}else{a(this).select()}}).mouseup(function(c){c.preventDefault()});b.$list.on("click",".ntwi-surl-copy",function(c){a(this).closest("div").find(".ntwi-surl-copytext").trigger("focus");return false});b.$list.find(".ntwi-surl-copytext").change(function(c){b._resetShortenURL(a(this))})},_ClearShortenURL:function(){var b=this;var c=b.$root.find(".ntwi-surl-input");c.find("input:text").val("");c.find(".co-watermark").addClass("on");b.$root.find(".ntwi-surl-input-result").hide();b.$root.find(".ntwi-surl-input").show()},_resetShortenURL:function(c){var b=this;var d=c.closest("div").find("input:hidden").val();c.val(d)},_initSort:function(){var b=this;b.$root.find(".ntwi-surl-list-sort").click(function(c){b.$root.find(".ntwi-surl-list-sort-item").toggle()});a(".ntwi-main").mousedown(function(c){if(a(c.target).closest(".ntwi-surl-list-sort-item").length>0||a(c.target).closest(".ntwi-surl-list-sort").length>0){return}b.$root.find(".ntwi-surl-list-sort-item").hide()});b.$root.find(".ntwi-surl-list-sort-item > ul > li > a").click(function(c){c.preventDefault();var d=a(this);if(d.hasClass("asc")){d.removeClass("asc");d.addClass("desc")}else{if(d.hasClass("desc")){d.removeClass("desc");d.addClass("asc")}else{d.closest("ul").find("a").removeClass("desc");d.closest("ul").find("a").removeClass("asc");d.addClass(d.data("def"))}}b.$root.find(".ntwi-surl-list-sort-item").hide();b.load()})},_initChkBox:function(){var b=this;b.$root.find(".jco-checkbox-all").click(function(d){var c=(a(this).attr("checked"))?true:false;b.$list.find("input[type=checkbox]").attr("checked",c)});b.$list.on("click","input[type=checkbox]",function(c){b.$root.find(".jco-checkbox-all").attr("checked",false)})},_listDelSubmit:function(){var b=this;var d=0;var c;d=b._getListCheckCount();if(d<1){cMessage=b._delNoChkMessage();desknets.dialog.alert(cMessage,{type:"warn"});return}cMessage=b._delConfMessage();c=desknets.dialog.confirm(cMessage,function(){b._listDel(c);return false})},_listDel:function(d){var c=this;var b=[];if(d!=null){desknets.submitform.setDialogDisabled(d)}if(c.$root.find(".jco-checkbox-all").attr("checked")=="checked"){b=desknets.PRM_VAL_ALLDEL}else{c.$list.find('input[name="id"]:checked').each(function(){b[b.length]=a(this).val()})}var e={cmd:desknets.ntwi.CMD_SURL_DEL,id:b};desknets.ajax.rest({url:desknets.ntwi.restUrl,data:e,success:function(g,f,h){c._ClearShortenURL();c._Success(g)},complete:function(h,f,g){if(d!=null){desknets.submitform.clearDialogDisabled(d);d.dialog("close")}},traditional:true})},_delNoChkMessage:function(){return desknets.Resource.Message.com_del_nochecked},_delConfMessage:function(){var c=this;var b="";if(c.$root.find(".jco-checkbox-all").attr("checked")=="checked"){return desknets.Resource.Message.com_del_allconf}else{b=desknets.Resource.Message.com_del_listconf}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())},_getListCheckCount:function(){var b=this;return b.$list.find("input[type=checkbox]:checked").length}});desknets.ntwi.search={TMPL_HISTORY:'<li data-id="{{id}}" data-target="{{target}}"><a href="#" class="ntwi-label-text"><span class="co-icon search"></span><span class="text">{{text}}</span></a><a href="#" class="ntwi-delete-btn"><span class="co-icon close">x</span></a></li>',$popUp:a(),$dialog:a(),_$dialogForm:a(),init:function(){this.$popUp=a("#ntwi-search-menu");this._initPopUpEvent()},openDialog:function(){if(this.$dialog.length<=0){this._createDialog()}else{this._showDialog()}},_initPopUpEvent:function(){var b=this;var c=a("#dn-ntwi-container .ntwi-side>.ntwi-search-btn");c.on("open.popup",function(d){d.preventDefault();b._onOpenPopUp()});b.$popUp.find("form").submit(function(d){d.preventDefault();b._startKeywordSearch()});b.$popUp.delegate(".ntwi-search-histories .ntwi-label-text","click",function(d){d.preventDefault();b._startSearchWithHistory(a(this))});b.$popUp.delegate(".ntwi-search-histories .ntwi-delete-btn","click",function(d){d.preventDefault();var e=a(this);setTimeout(function(){b._deleteKeyword(e)},0)});b.$popUp.find(".ntwi-adv-search-link a").click(function(d){d.preventDefault();b.openDialog();desknets.popUp.hideAll()})},_onOpenPopUp:function(){var b=this;var c=this.$popUp.find(".ntwi-search-histories");if(!c.is(".ntwi-search-loaded, .ntwi-search-loading")){c.addClass("ntwi-search-loading");desknets.ajax.rest({url:desknets.getUrl(desknets.ntwi.MODULE_API_MAIN),data:{cmd:desknets.ntwi.CMD_HISTORY_LIST},success:function(d){c.removeClass("ntwi-search-loading");c.addClass("ntwi-search-loaded");b._createHistoryList(c,d)}})}},_createHistoryList:function(e,d){var f=[];var b=desknets.ajax.getJsonItems(d);for(var c=0;c<b.length;c++){f.push(this._getKeywordItemHtml(b[c].id,b[c].srch_key,b[c].srch_target))}e.html(f.join(""))},_createDialog:function(){var b=this;var c=this._getDialogOptions();var d=desknets.dialog.make("ntwi-search-entries",c);d.addClass("co-editarea");desknets.tmpl.load(d,"com/ntwi.search.html",function(){b.$dialog=d;b._$dialogForm=d.find("form");b._setUpDialog();b._showDialog()})},_setUpDialog:function(){var b=this;desknets.htmlparts.setUpForm(b._$dialogForm);b._$dialogForm.find("input:radio").click(function(c){b._updateTargetKey()});b._$dialogForm.submit(function(c){c.preventDefault();b._startAdvancedSearch()})},_showDialog:function(){var b=this.$popUp.find("input.ntwi-search-keyword").val();this._$dialogForm.resetForm();this._$dialogForm.find('input[type="hidden"]').val("");this._updateTargetKey();this._$dialogForm.find(".ntwi-search-keyword").val(b);this.$dialog.dialog("open")},_getDialogOptions:function(){var b=this;var c=desknets.dialog.getDialogOption();a.extend(c,{title:desknets.Resource.ntwi.advancedSearchLabel,width:500,buttons:{}});c.buttons[desknets.Resource.searchLabel]=function(){b._$dialogForm.submit()};c.buttons[desknets.Resource.CancelButtonLabel]=function(){b.$dialog.dialog("close")};return c},_updateTargetKey:function(){if(a("#jntwi-search-on-user").is(":checked")){this._$dialogForm.attr("class","ntwi-search-target-user")}else{this._$dialogForm.attr("class","ntwi-search-target-entry")}},_startKeywordSearch:function(){var b=this;var d=b.$popUp.find("input.ntwi-search-keyword");var c={srch_key:d.val(),srch_target:"entry"};d.blur();desknets.ntwi.content.search(c,function(e){b._addKeyword(e,c.srch_key,"entry");desknets.popUp.hideAll()})},_startSearchWithHistory:function(d){var b=this;var c={srch_key:d.text(),srch_target:d.closest("li").data("target")};desknets.ntwi.content.search(c,function(e){b._addKeyword(e,c.srch_key,"entry");desknets.popUp.hideAll()})},_startAdvancedSearch:function(){var b=this;if(!b._validateAdvancedCondition()){return}var c=b._getAdvancedCondition();desknets.ntwi.content.search(c,function(d){b._addKeyword(d,c.srch_key,c.srch_target);b.$dialog.dialog("close")})},_validateAdvancedCondition:function(){this._$dialogForm.formSetUp("validate");var c=this._$dialogForm.find(".ui-invalid").eq(0);if(c.length>0){desknets.validation.showError(c);return false}var b=this._$dialogForm.find(".ntwi-search-term");if(!desknets.validation.isInputDateFromTo(b,false)){return false}return true},_getAdvancedCondition:function(){var b={srch_key:this._$dialogForm.find(".ntwi-search-keyword").val(),srch_target:this._getTarget()};this._setDateCondition(b,"sdate");this._setDateCondition(b,"edate");return b},_getTarget:function(){if(a("#jntwi-search-on-user").is(":checked")){return this._$dialogForm.find(".ntwi-search-subtarget > select").val()}else{return"entry"}},_setDateCondition:function(d,c){var e=this._$dialogForm.find('input[name="'+c+'"]');var b=neo.dateTime.parse(e.val());if(!!b){d[c]=neo.dateTime.format("yyyyMMdd",b)}},_addKeyword:function(g,b,d){var f=a();var c=this.$popUp.find(".ntwi-search-histories");var e=desknets.escapeSpace(b,true);c.children().each(function(){var h=a(this);if(h.find(".ntwi-label-text>.text").text()==e&&h.data("target")==d){f=h}});if(f.length<=0){f=a(this._getKeywordItemHtml(g,b,d))}f.prependTo(c);c.children().slice(5).remove()},_deleteKeyword:function(c){var d=c.closest("li"),b=this;desknets.ajax.rest({url:desknets.getUrl(desknets.ntwi.MODULE_API_MAIN),data:{cmd:desknets.ntwi.CMD_HISTORY_DEL,id:d.data("id")},success:function(e){d.remove();b.$popUp.removeClass("show");setTimeout(function(){b.$popUp.addClass("show")},0)}})},_getKeywordItemHtml:function(e,b,d){var c=this.TMPL_HISTORY;c=desknets.tmpl.replaceWord(c,"id",e);c=desknets.tmpl.replaceWord(c,"text",b);c=desknets.tmpl.replaceWordHtml(c,"target",d);return c}};desknets.page(desknets.ntwi,"cabinetregist",desknets.cabinetregist,{_tmpls:{},cabid:"ntwi",init:function(){},execute:function(b){var c=this;var d=desknets.Resource.Message.com_cab_regist;c.$dialog[c.cabid]=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled(c.$dialog[c.cabid]);if(b.closest(".ntwi-communication-list").length>0){c._startMessage(b)}else{if(b.closest(".ntwi-ntwi-list").length>0){c._startNtwi(b)}}return false})},_startNtwi:function(b){var d=this;this.$area=b.closest(".ntwi-ntwi-item");this.boNotAttach=!d.$area.hasClass("has-attachment");var e=this.$area.find(".jntwi-item-detail").text();var c=this.$area.find(".ntwi-item-file-link > a").data("name");d.mobjoption[d.cabid]=a.extend(d._setOption(),{copymodule:desknets.ntwi.MODULE_API_MAIN,copycmd:desknets.ntwi.CMD_COPYATTACH,copyprm:function(){return{cmd:desknets.ntwi.CMD_COPYATTACH,id:d.$area.data("id")}},cabtitle:e||c,cabmaketemplate:function(g,f){return desknets.tmpl.replaceWordHtml(f,"body",d._createHtmlOfNtwi())}});this._regCabinet(d.cabid)},_createHtmlOfNtwi:function(){var d=this,g=this._getTemplate("ntwi");var f=this.$area.find(".ntwi-item-title").html();var h=this.$area.find(".jntwi-item-detail").text();var c=this.$area.find(".ntwi-item-file-link > a").data("name");var e=this.$area.find(".ntwi-item-date").text();var i=!!h?"table-row":"none";var b=this.$area.hasClass("has-attachment")?"table-row":"none";g=desknets.tmpl.replaceWordHtml(g,"text_display",i);g=desknets.tmpl.replaceWordHtml(g,"file_display",b);g=desknets.tmpl.replaceWordHtml(g,"name",f);g=desknets.tmpl.replaceWordLF(g,"content",h);g=desknets.tmpl.replaceWord(g,"attach",c);g=desknets.tmpl.replaceWordHtml(g,"date",e);return g},_startMessage:function(b){var e=this,d;var f=b.closest(".ntwi-communication-list").find(".ntwi-list-body > ul");var c=desknets.ntwi.messageList.getRequestParams();this.$area=f;this.boNotAttach=this.$area.find(".has-attachment").length<=0;d=this._getValuesOfMessage();this.mobjoption[e.cabid]=a.extend(e._setOption(),{copymodule:desknets.ntwi.MODULE_API_MAIN,copycmd:desknets.ntwi.CMD_MESSAGE_COPYATTACH,copyprm:function(){return{cmd:desknets.ntwi.CMD_MESSAGE_COPYATTACH,uid:c.id,id:f.children(".ntwi-communication-item").eq(0).data("id"),row:c.row,num:c.num}},cabtitle:this._createTitleOfMessage(d),cabmaketemplate:function(h,g){return desknets.tmpl.replaceWordHtml(g,"body",e._createHtmlOfMessage(d))}});this._regCabinet(e.cabid)},_getValuesOfMessage:function(){var d=this.$area.closest(".ntwi-list-body");var e=this.$area.find(">.ntwi-communication-item:last .ntwi-item-date").data("time");var b=this.$area.find(">.ntwi-communication-item:first .ntwi-item-date").data("time");var c=d.find(">.ntwi-message-communication-header .ntwi-item-uname-message").text();return{name:c,start:neo.dateTime.parse(e),end:neo.dateTime.parse(b)}},_createTitleOfMessage:function(c){var d=desknets.Resource.ntwi.cabinetMessageTitle;var e=neo.dateTime.format(desknets.Resource.longDateTimeFormat,c.start);var b=neo.dateTime.format(desknets.Resource.longDateTimeFormat,c.end);d=desknets.tmpl.replaceWordHtml(d,"name",c.name);d=desknets.tmpl.replaceWordHtml(d,"start",e);d=desknets.tmpl.replaceWordHtml(d,"end",b);return d},_createHtmlOfMessage:function(e){var d=this,c=[];var f=this._getTemplate("message");var g=neo.dateTime.format(desknets.Resource.longDateTimeFormat,e.start);var b=neo.dateTime.format(desknets.Resource.longDateTimeFormat,e.end);this.$area.children(".ntwi-communication-item").each(function(){c.push(d._createItemHtmlOfMessage(a(this),e))});f=desknets.tmpl.replaceWordHtml(f,"start",g);f=desknets.tmpl.replaceWordHtml(f,"end",b);f=desknets.tmpl.replaceWordHtml(f,"items",c.join(""));return f},_createItemHtmlOfMessage:function(g,c){var e=this._getTemplate("message-item");var d=g.hasClass("me")?desknets.pageframe.getLoginName():c.name;var b=g.find(".ntwi-item-date").data("time");var f=neo.dateTime.format(desknets.Resource.dateTimeFormatWithSecond,neo.dateTime.parse(b));e=desknets.tmpl.replaceWordHtml(e,"classes",g.attr("class"));e=desknets.tmpl.replaceWordHtml(e,"content",this._getContentOfMessage(g));e=desknets.tmpl.replaceWord(e,"attach",this._getFileNameOfMessage(g,b));e=desknets.tmpl.replaceWord(e,"name",d);e=desknets.tmpl.replaceWordHtml(e,"dateTime",f);return e},_getContentOfMessage:function(d){var b,c;b=d.find(".ntwi-item-stamp-image > img");if(b.length>0){return"("+b.attr("alt")+")"}b=d.find(".ntwi-item-baloon.text .ntwi-item-text");if(b.length>0){c=desknets.ntwi.pictogram.decodeForSend(b.html());c=desknets.ntwi.pictogram.encodeForDisplay(c,{pictogram:"text"});return c}return""},_getFileNameOfMessage:function(e,b){var c=String(e.find(".ntwi-item-baloon.attachment").data("name"));var d="_"+String(b).substring(4);if(c.indexOf(".")<0){return c+d}return c.replace(/(.*)\./,"$1"+d+".")},_getTemplate:function(b){if(!this._tmpls[b]){this._tmpls[b]=this.$area.closest(".ntwi-list").find(".jntwi-cabinet-"+b).html()}return this._tmpls[b]}});desknets.ntwi.showBirthDay=function(i,d){var c=neo.dateTime.parse(i);var g=neo.dateTime.parse(d);function j(){desknets.ajax.rest({url:desknets.getUrl("zrconst"),data:{cmd:"constructcmdusersearch",birthday_s:i.substring(4),birthday_e:d.substring(4)},success:function(m){l(m)}})}function l(n){var m=e(n);var o=desknets.dialog.make("ntwi-birthday-dialog",{width:620,height:472,buttons:[{text:desknets.Resource.closeLabel,click:function(){a(this).dialog("close")}}]});o.html(b(m));o.on("click",".ntwi-birthday-user",function(p){p.preventDefault();k(a(this))});o.dialog("open")}function e(o){var m={};var n=desknets.ajax.getJsonItems(o);for(date=c;date<=g;date=neo.dateTime.moveDate(date,1)){var p="_"+neo.dateTime.format("MMdd",date);var q=neo.dateTime.format(desknets.Resource.longMDFormat,date);m[p]={label:q,users:[]}}a.each(n,function(r,t){var s="_"+String(t.birthday).substring(4);if(!!m[s]){m[s].users.push(t)}});return m}function b(q){var n='<div class="ntwi-birthday-content"><table><tbody>{{items}}</tbody></table></div>';var p="";for(var m in q){var o=q[m];p+=f(o.label,o.users)}n=desknets.tmpl.replaceWordHtml(n,"items",p);return n}function f(p,o){var m="<tr><th>{{date}}</th><td>{{users}}</td></tr>";var n=[];a.each(o,function(r,q){n.push(h(q))});m=desknets.tmpl.replaceWordHtml(m,"date",p);m=desknets.tmpl.replaceWordHtml(m,"users",n.join(", "));return m}function h(m){var n=desknets.ntwi.messageAvailable?'<a class="ntwi-birthday-user" data-id="{{id}}" href="#">{{name}}</a>':"<span>{{name}}</span>";n=desknets.tmpl.replaceWordHtml(n,"id",m.id);n=desknets.tmpl.replaceWord(n,"name",m.Name);return n}function k(n){var o=n.data("id");var m=n.text();setTimeout(function(){desknets.ntwi.entries.setToSendMessage(o,m)},10);desknets.dialog.deleteById("ntwi-birthday-dialog")}j()};desknets.ntwi.showInfo=function(f,b){var i=Math.min(a(window).width(),900);var j=a(window).height();var g=52;var d=108;function e(){var k=[{text:desknets.Resource.closeLabel,click:function(){a(this).dialog("close")}}];var l=desknets.dialog.make("ntwi-information-dialog",{title:f,width:i,height:j,buttons:k,close:function(){a(this).dialog("destroy").remove()}});c(l,function(){l.dialog("open");l.closest(".ui-dialog").css({left:"-99999px",top:"-99999px"});setTimeout(function(){h(l)},1)})}function c(k,m){var l=desknets.tmpl.replaceWordHtml(b,"ext",desknets._msExtension);a.ajax({url:l,success:function(n){n=desknets.tmpl.replaceWordHtml(n,"ext",desknets._msExtension);a('<div class="ntwi-information-content not-resized"></div>').html(n).appendTo(k);m()}})}function h(n){var l=n.find(".ntwi-information-content");var m=Math.min(n.width(),l.width()+g);var k=Math.min(n.height(),l.height()+d);l.removeClass("not-resized");n.dialog("option","width",m);n.dialog("option","height",k);n.dialog("option","position","center")}e()};desknets.ntwi.pictogram={_TMPL_URL:"{{cginame}}?cmd=referdownload&item1=neotwidm/category/{{scid}}&filename=attach{{id}}.png&mimetype=image/png",_isSet:false,_names:[],_sscid:"",isSet:function(){return this._isSet},getPictograms:function(){return this._names},setValuesFromJson:function(c){var b=this;b._sscid=c.scid;a.each(desknets.ajax.getJsonItems(c),function(d,e){b._names[e.id]=e.Name});this._isSet=true},getCode:function(c){var b=Number(c);if(!b){b=Number(a(c).data("id"))}return !!b&&!!this._names[b]?String.fromCharCode(56192,56319+b):null},createImage:function(e,c){var d=a.extend({size:0},c);var b=this._names[e];return !!b?this._createImageTagWithName(e,b,d):""},encodeForDisplay:function(f,d){var c=this;var e=a.extend({size:0,pictogram:"image",format:"html"},d);var b=e.format=="text"?String(f):desknets.tmpl.escapeWordLF(String(f));return b.replace(/\uDB80[\uDC00-\uDFFF]/g,function(h){var i=h.charCodeAt(1)-56319;var g=c._names[i];if(!!g){if(e.pictogram=="text"){return"("+g+")"}else{return c._createImageTagWithName(i,g,e)}}return h})},decodeForSend:function(c){var d=[],b;if(typeof c=="object"){b=c}else{b=a("<div />").html(c)}this._decodeNode(d,b[0]);return d.join("")},_createImageTagWithName:function(e,c,b){var d=["<img"];d.push(this._createHtmlAttr("src",this._getImageUrl(e)));d.push(this._createHtmlAttr("data-id",e));d.push(this._createHtmlAttr("alt",c));d.push(this._createHtmlAttr("title",c));if(b.size>0){d.push(this._createHtmlAttr("width",b.size+"px"));d.push(this._createHtmlAttr("height",b.size+"px"))}return d.join(" ")+"/>"},getStampUrl:function(c,b){},_getImageUrl:function(d){var b=this;var c=b._TMPL_URL;c=desknets.tmpl.replaceWordHtml(c,"cginame",desknets.getUrl(desknets.MODULE_REFER));c=desknets.tmpl.replaceWordHtml(c,"id",desknets.zeroPadding(d,5));c=desknets.tmpl.replaceWordHtml(c,"scid",b._sscid);return c},_createHtmlAttr:function(b,c){return desknets.tmpl.replaceWord(b+'="{{value}}"',"value",c)},_decodeNode:function(d,c){var b=this;a.each(c.childNodes,function(f,e){if(e.nodeType==1){if(e.tagName=="IMG"){var g=b.getCode(e);if(!!g){d.push(g)}}else{if(e.tagName=="BR"){d.push("\n")}else{b._decodeNode(d,e);if(b._isEndWithLineFeed(e)){d.push("\n")}}}}else{if(e.nodeType==3||e.nodeType==4){d.push(e.data)}}})},_isEndWithLineFeed:function(b){return this._isBlockElement(b)&&!!b.nextSibling},_isBlockElement:function(b){return !!b&&b.nodeType==1&&a.inArray(b.tagName,["P","DIV"])>=0}};a.widget("desknets.ntwiPictgramEditor",{options:{brOnEmptyBlock:!desknets.browser.msie},_$editor:a(),_$textarea:a(),_create:function(){this._$editor=this.element;if(this.element.is("textarea")){this._$editor=a("<div />");this._$textarea=this.element}this._createEditor()},getValue:function(){var b=this._$editor.clone().prop("contentEditable",false);if(this.options.brOnEmptyBlock){b.find("br:last-child").remove()}return desknets.ntwi.pictogram.decodeForSend(b)},setValue:function(e){var b=this,d=[];var c=desknets.ntwi.pictogram.encodeForDisplay(e);a.each(c.split("<br />"),function(g,f){if(!f&&b.options.brOnEmptyBlock){f="<br />"}d.push("<p>"+f+"</p>")});this._$editor.html(d.join(""));this._reflectToTextArea()},insertPictgram:function(c){var b=desknets.ntwi.pictogram.createImage(c);this.focus();if(!!b){if(!!document.getSelection){this._insertElement_w3cRange(a(b)[0])}else{if(!!document.selection){this._insertHtml_ie(b)}}this._reflectToTextArea()}},focus:function(){this._$editor.focus()},_createEditor:function(){var b=this;this._$editor.addClass("ntwi-pictogram-text-editor");this._$editor.prop("contentEditable",true);this._$editor.on("focus",function(){setTimeout(function(){b._onFocusEditor()},0)});if(!!this._$textarea.length>0){this._$textarea.hide();this._$editor.insertBefore(this._$textarea);this._$editor.on("input keyup blur cut",function(){b._reflectToTextArea()});this._$editor.on("paste",function(c){c.preventDefault();b._onPasteText(b._getTextToPaste(c))})}},_onPasteText:function(b){if(!!document.getSelection){this._insertText_w3cRange(b)}else{if(!!document.selection){this._insertHtml_ie(desknets.tmpl.escapeWordLF(b))}}},_onFocusEditor:function(){if(this._$editor.children().length<1){this._startToEditOnEmpty()}if(!!document.getSelection&&!this._getRange_w3cRange()){this._focusDefaultPosition_w3cRange()}},_reflectToTextArea:function(){this._$textarea.val(this.getValue()).trigger("input")},_startToEditOnEmpty:function(){var c=this,b=document.createElement("P");this._$editor.append(b);if(!!document.getSelection){this._startToEditOnEmpty_w3cRange(b)}},_cleanFormat:function(){var b=this.getValue();this.setValue(b)},_isInEditor:function(c){var b=(c.nodeType==1)?a(c):a(c.parentNode);return b.parent().closest(".ntwi-pictogram-text-editor").length>0},_getTextToPaste:function(e){var f="",g=e.originalEvent;try{f=g.clipboardData.getData("text/plain")}catch(d){try{f=g.view.clipboardData.getData("text")}catch(c){try{f=window.clipboardData.getData("text")}catch(b){}}}return f},_startToEditOnEmpty_w3cRange:function(c){if(desknets.browser.msie){this._selectNode_w3cRange(c,"children")}else{var b=document.createElement("BR");c.appendChild(b);this._selectNode_w3cRange(b,"prev")}},_focusDefaultPosition_w3cRange:function(){var b=this._$editor.children(":first-child");if(b.length>0){if(!!b[0].firstChild){this._selectNode_w3cRange(b[0].firstChild,"prev")}else{this._selectNode_w3cRange(b[0],"children")}}},_insertText_w3cRange:function(d){var c=this,b=d.split("\n");a.each(d.split("\n"),function(f,e){if(f>0){c._insertElement_w3cRange(document.createElement("BR"))}c._insertElement_w3cRange(document.createTextNode(e))})},_insertElement_w3cRange:function(c){var b=this._getRange_w3cRange();if(!!b){b.deleteContents();b.insertNode(c);this._selectNode_w3cRange(c,"next")}},_selectNode_w3cRange:function(d,b){var e=document.getSelection();e.removeAllRanges();if(b=="children"){e.selectAllChildren(d)}else{var c=document.createRange();c.selectNode(d);if(b!="all"){c.collapse(b=="prev")}e.addRange(c)}},_getRange_w3cRange:function(){var d=document.getSelection(),b;for(var c=0;c<d.rangeCount;c++){b=d.getRangeAt(c);if(this._isInEditor(b.commonAncestorContainer)){return b}}return null},_insertHtml_ie:function(c){var b=document.selection.createRange();if(this._isInEditor(b.parentElement())){b.pasteHTML(c)}}});desknets.tags={restURL:"",$root:a(),topZIndex:1000,topElement:null,_tagEntries:{},_unloadEventAttached:false,init:function(){var b=this;b.restURL=desknets.getUrl("zrtag");b.$root=a("#dn-tags");b._initEvents();desknets.tags.item.init();desknets.tags.memo.init();desknets.tags.memopad.init();a("#dn-ntwi-container").bind("ntwirefresh",function(){b._updateMemoTagBadge()});if(!desknets.pageframe.isShownMenu("memp")){b.$root.find(".tag-colored:last-child").hide()}if(!desknets.pageframe.isShownMenu("memo")){b.$root.find(".tag-module:first-child").hide()}else{b._updateMemoTagBadge()}},readOneMemo:function(){var c=this.$root.find(".tag-module > a.memo > .tag-badge");if(c.length>0){var b=Number(c.text())-1;if(b>0){c.text(b)}else{c.remove()}}},hideAllTags:function(){this._deleteElements(this.$root.find(".tag-item"))},onShowTag:function(){if(this.$root.find(".tag-item").length>0){desknets.pageframe.notifyToShowLayer(this.$root)}},onHideTag:function(){if(this.$root.find(".tag-item").length<=0){desknets.pageframe.notifyToHideLayer(this.$root)}},_initEvents:function(){var b=this;var c=b.$root.children("#tag-links");a(window).bind("resize",function(){b._updateButtonPosition()});c.delegate("li.tag-module","click",function(d){d.preventDefault();b._toggleItems("module",a(this).data("id"))});c.delegate("li.tag-colored","click",function(d){d.preventDefault();b._toggleItems("tagcolor",a(this).data("id"))});b.$root.delegate(".tag-toolbox-btn.btn-hide","click",function(d){d.preventDefault();b._deleteElement(a(this).closest(".tag-item"),true)});b.$root.delegate(".tag-toolbox-btn.btn-peel","click",function(d){d.preventDefault();b._peel(a(this).closest(".tag-item"))});b.$root.delegate(".jtag-title-link","click",function(d){b.hideAllTags();var e=a(this).data("hashcmd")||"fin";desknets.saveHashCmdCookie(e)});b._updateButtonPosition()},_initUnloadEvents:function(){var b=this;a(document.body).bind("click.tag",function(d){var c=a(d.target);if(c.closest("#dn-header, #dn-body").length>0){b.hideAllTags()}});b._unloadEventAttached=true},_updateButtonPosition:function(){var b=(desknets.browser.tablet||a(window).height()<500)?"addClass":"removeClass";this.$root.children("#tag-links")[b]("small-screen")},_toggleItems:function(c,e){var b=c+e;var d=this.$root.find(".tag-item-"+b);if(c=="tagcolor"&&e=="0"){this._createItemsToAdd()}else{if(d.length>0){this._deleteElements(d)}else{this._loadItems(c,e)}}if(!this._unloadEventAttached){this._initUnloadEvents()}},_loadItems:function(c,e){var b=this;var d={cmd:"taglist"};d[c]=e;d.num=(c=="module")?"20":"";desknets.ajax.rest({url:b.restURL,data:d,success:function(f){b._createItems(f,c,e)}})},_deleteElements:function(c){var b=this;c.each(function(){b._deleteElement(a(this),false)});b.onHideTag()},_deleteElement:function(c,b){var d=this._getItemClass(c.data("module"));d.deleteElement(c,{checkLayer:b})},_updateMemoTagBadge:function(){var c=desknets.ntwi.toolBar.getNewMemoTagCount();var b=this.$root.find(".tag-module > a.memo");var d=b.children(".tag-badge");if(c>0){if(d.length<=0){d=a('<span class="tag-badge" />').appendTo(b)}d.text(c)}else{if(d.length>0){d.remove()}}},_createItems:function(e,f,g){var b=this;var d=desknets.ajax.getJsonItems(e);function c(){for(var h=d.length-1;h>=0;h--){var j=b._getItemClass(d[h].module);j.create(d[h],f,g)}b.onShowTag()}if(f=="module"&&d.length<e.allcnt){desknets.tags.memo.onTruncated(e.allcnt,d.length,{cancel:c})}else{c()}},_createItemsToAdd:function(){var c=desknets.tags.memopad;var b=c.create(c.getItemForCreate(),"tagcolor","1");c.setToEditMode(b);this.onShowTag()},_peel:function(b){var c=this._getItemClass(b.data("module"));c.peel(b)},_getItemClass:function(b){if(b=="memo"){return desknets.tags.memo}else{if(b=="memp"){return desknets.tags.memopad}}return desknets.tags.item}};desknets.page(desknets.tags,"item",null,{leftIcon:"none",stackCancel:"a",mfuncAfterAjax:null,TMPL_BODY:'<h3 class="tag-title"><div class="tag-module-icon module-{{module}}"></div><div class="tag-title-text"><a href="{{Url}}" target="{{target}}" class="jtag-title-link" data-hashcmd="{{hashCmd}}">{{title}}</a></div></h3><div class="tag-scroller"><div class="tag-body">{{body}}</div></div>',_tmpl:'<div class="tag-item tag-item-module-{{module}} tag-item-{{type}} tag-item-{{type}}{{typeID}}" style="left: {{x}}px; top: {{y}}px; width: {{width}}px; height: {{height}}px;" data-id="{{id}}" data-module="{{module}}" data-type-id="{{typeID}}"><div class="tag-item-header"><a href="#" class="tag-toolbox-btn btn-{{leftIcon}}"><span class="tag-icon {{leftIcon}}"></span></a><a href="#" class="tag-toolbox-btn btn-hide" title="{{L_Hide}}"><span class="tag-icon hide">{{L_Hide}}</span></a><a href="#" class="tag-toolbox-btn btn-peel" title="{{L_Peel}}"><span class="tag-icon peel">{{L_Peel}}</span></a></div><div class="tag-item-content">{{TagBody}}</div></div>',init:function(){this._tmpl=this.initTemplate(this._tmpl)},deleteElement:function(b,c){var d=a.extend({checkLayer:true},c);b.draggable("destroy");b.resizable("destroy");b.unbind("click");b.remove();if(!!d.checkLayer){desknets.tags.onHideTag()}},setUpFuncAfterAjax:function(c){var b=this;if(a.isFunction(c)){b.mfuncAfterAjax=c}},initTemplate:function(b){var c=desknets.Resource.tags;b=desknets.tmpl.replaceWordHtml(b,"TagBody",this.TMPL_BODY);b=desknets.tmpl.replaceWordHtml(b,"L_Hide",c.hideTagLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Peel",c.deleteTagLabel);return b},create:function(b,d,e){var c=a(this.createTagHtml(b,d,e)).appendTo(desknets.tags.$root);this.setUpItem(c,b,d,e);return c},createTagHtml:function(c,f,i){var e=this._tmpl;var d=desknets.tmpl.replaceWordHtml(c.Url,"ext",desknets.getExtension());var b=desknets.tmpl.replaceWordHtml(c.body,"ext",desknets.getExtension());var h=!!Number(c.newwnd)?"_blank":"_self";var g=this._getHashCmdFromUrl(d);this._coercePosition(c);e=desknets.tmpl.replaceWordHtml(e,"type",f);e=desknets.tmpl.replaceWordHtml(e,"typeID",i);e=desknets.tmpl.replaceWordHtml(e,"id",c.id);e=desknets.tmpl.replaceWordHtml(e,"module",c.module);e=desknets.tmpl.replaceWordHtml(e,"x",c.x);e=desknets.tmpl.replaceWordHtml(e,"y",c.y);e=desknets.tmpl.replaceWordHtml(e,"width",c.width);e=desknets.tmpl.replaceWordHtml(e,"height",c.height);e=desknets.tmpl.replaceWord(e,"title",c.title);e=desknets.tmpl.replaceWordHtml(e,"body",b);e=desknets.tmpl.replaceWordHtml(e,"Url",d);e=desknets.tmpl.replaceWordHtml(e,"target",h);e=desknets.tmpl.replaceWordHtml(e,"leftIcon",this.leftIcon);e=desknets.tmpl.replaceWordHtml(e,"hashCmd",g);return e},setUpItem:function(c,b,d,e){this._setUpDraggable(c);this._setUpResizeable(c);this._setUpStacking(c);c.data("did",b.did)},changeGeom:function(c){var b=this;desknets.ajax.rest({url:desknets.tags.restURL,data:{cmd:"tagresize",id:c.data("id"),x:b._getCssNumValue(c,"left"),y:b._getCssNumValue(c,"top"),width:b._getCssNumValue(c,"width"),height:b._getCssNumValue(c,"height")}})},peel:function(c){var b=this,d=desknets.Resource.Message;var e=c.data("id");desknets.dialog.confirm(d.tag_confirm_to_delete,function(){desknets.ajax.rest({url:desknets.tags.restURL,data:{cmd:"tagdel",id:e},success:function(){if(b.execAfterAjax(c,null)){b.deleteElement(c)}}})})},execAfterAjax:function(c,d){var b=this;if(a.isFunction(b.mfuncAfterAjax)){return b.mfuncAfterAjax(c,d)}return true},moveToTop:function(c){var b=c[0];if(!!b&&b!=desknets.tags.topElement){desknets.tags.topElement=b;desknets.tags.topZIndex++;c.css("z-index",desknets.tags.topZIndex);return true}return false},_setUpDraggable:function(c){var b=this;c.draggable({handle:".tag-item-header",containment:document.body,start:function(){b.moveToTop(a(this))},stop:function(d,e){b.changeGeom(a(this))}})},_setUpResizeable:function(c){var b=this;c.resizable({handles:"n, e, s, w, ne, se, sw, nw",minWidth:200,minHeight:150,containment:"document",start:function(){b.moveToTop(a(this))},stop:function(d,e){b.changeGeom(a(this))}})},_setUpStacking:function(c){var b=this;c.click(function(e){var f=a(this);if(a(e.target).closest(b.stackCancel).length<=0){var d=b.moveToTop(f);if(d&&!f.hasClass("tag-edit-mode")){b.changeGeom(f)}}});b.moveToTop(c)},_getHashCmdFromUrl:function(b){if(typeof b=="string"){var c=b.match(/cmd=(\w+)/);if(!!c&&c.length>=2){return c[1]}}return""},_coercePosition:function(b){var d=a(document.body);var e=d.outerWidth();var c=d.outerHeight();b.width=Math.min(b.width,e);b.height=Math.min(b.height,c);b.x=Math.min(b.x,e-b.width);b.y=Math.min(b.y,c-b.height)},_getCssNumValue:function(b,c){var d=b.css(c);if(typeof(d)=="string"){return parseInt(d,10)}return 0}});desknets.page(desknets.tags,"memo",desknets.tags.item,{leftIcon:"new-memo",TMPL_NAME:'<span class="name">{{title}}</span>',TMPL_BODY:'<h3 class="tag-title"><div class="tag-title-text"><a href="{{Url}}">{{from}}</a></div></h3><div class="tag-scroller"><div class="tag-body">{{body}}</div></div>',onTruncated:function(b,g,d){var c=desknets.getUrl(desknets.MODULE_MAIN);var f=desknets.Resource.Message.tag_memo_truncated_shown;var e=a.extend({},d);desknets.dialog.confirm(f,function(){location.href=c+"?cmd=memoindex#cmd=memoreceive"},e)},initTemplate:function(b){var c=desknets.Resource.tags;b=this.callBase("initTemplate",b);b=desknets.tmpl.replaceWordHtml(b,"from",c.memofromLabel);b=desknets.tmpl.replaceWordHtml(b,"nameNode",this.TMPL_NAME);return b},setUpItem:function(d,b,e,f){var c=this;this.callBase("setUpItem",d,b,e,f);d.data("did",b.did);desknets.htmlparts.convertHrefInText(d.find(".jtag-memo-contact"));this._setUpReadButton(d);d.find(".btn-new-memo").click(function(g){g.preventDefault()})},createTagHtml:function(b,d,e){var c=this.callBase("createTagHtml",b,d,e);c=desknets.tmpl.replaceWordHtml(c,"L_Confirm",desknets.Resource.confirmedLabel);return c},_setUpReadButton:function(d){var c=this;var b=d.find(".tag-confirm-btn");if(b.length>0){d.find(".tag-title").prepend(b.parent());d.addClass("tag-new-memo-item");b.click(function(e){c._readMemo(a(this))})}},_readMemo:function(d){var c=this;var b=d.closest(".tag-item");var e=b.data("did");desknets.comMemo.read(e,{peel:true,success:function(f){if(c.execAfterAjax(b,f)){if(!!f.peel||!!f["delete"]){c.deleteElement(b)}else{c._changeElementToRead(b)}desknets.tags.readOneMemo()}}})},_changeElementToRead:function(b){b.find(".tag-buttons").remove();b.removeClass("tag-new-memo-item")}});desknets.page(desknets.tags,"memopad",desknets.tags.item,{leftIcon:"edit",TMPL_BODY:'<div class="tag-scroller"><ul class="tag-color-chooser"><li class="tag-colored"><a href="#1" class="blue">{{L_Blue}}</a></li><li class="tag-colored"><a href="#2" class="green">{{L_Green}}</a></li><li class="tag-colored"><a href="#3" class="yellow">{{L_Yellow}}</a></li><li class="tag-colored"><a href="#4" class="pink">{{L_Pink}}</a></li><li class="tag-colored"><a href="#5" class="red">{{L_Red}}</a></li><li class="tag-colored"><a href="#6" class="gray">{{L_Gray}}</a></li></ul><div class="tag-body" data-value="{{memoData}}">{{memo}}</div><div class="tag-buttons"><input type="button" value="{{L_OK}}" class="jtag-btn-ok" /><input type="button" value="{{L_Cancel}}" class="jtag-btn-cancel" /></div></div>',BLANK_DATA:{id:"",module:"memp",did:"",title:"",body:"",Url:"",width:480,height:240,y:100},getItemForCreate:function(){var b=a(window).innerWidth();return a.extend({x:(b-this.BLANK_DATA.width)/2},this.BLANK_DATA)},setToEditMode:function(c){if(!c.hasClass("tag-edit-mode")){var d=c.find(".tag-body").empty();var b=c.data("type-id");var e=d.data("value");var f=a("<textarea />").appendTo(d);c.addClass("tag-edit-mode");f.val(e).data("choosen-color",b).focus()}},unsetFromEditMode:function(c){if(c.hasClass("tag-edit-mode")){var d=c.find(".tag-body");var b=c.data("type-id");var e=d.data("value");if(!c.data("id")){this.deleteElement(c)}else{this._changeColor(c,b);d.html(desknets.tmpl.escapeWordLF(e));c.removeClass("tag-edit-mode")}}},initTemplate:function(b){var b=this.callBase("initTemplate",b);var c=desknets.Resource;b=desknets.tmpl.replaceWordHtml(b,"L_Blue",c.tags.color1);b=desknets.tmpl.replaceWordHtml(b,"L_Green",c.tags.color2);b=desknets.tmpl.replaceWordHtml(b,"L_Yellow",c.tags.color3);b=desknets.tmpl.replaceWordHtml(b,"L_Pink",c.tags.color4);b=desknets.tmpl.replaceWordHtml(b,"L_Red",c.tags.color5);b=desknets.tmpl.replaceWordHtml(b,"L_Gray",c.tags.color6);b=desknets.tmpl.replaceWordHtml(b,"L_OK",c.OKButtonLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Cancel",c.CancelButtonLabel);return b},createTagHtml:function(b,d,e){var c=this.callBase("createTagHtml",b,d,e);c=desknets.tmpl.replaceWordLF(c,"memo",b.body);c=desknets.tmpl.replaceWord(c,"memoData",b.body);return c},setUpItem:function(d,b,e,f){var c=this;this.callBase("setUpItem",d,b,e,f);d.data("did",b.did);d.find(".btn-edit").click(function(g){g.preventDefault();c.setToEditMode(a(this).closest(".tag-item"))});d.find(".tag-scroller").dblclick(function(g){g.preventDefault();c.setToEditMode(a(this).closest(".tag-item"))});d.delegate(".tag-colored > a","click",function(g){g.preventDefault();c._changeColorByIcon(a(this))});d.find(".jtag-btn-ok").click(function(g){g.preventDefault();c._saveTagData(a(this).closest(".tag-item"))});d.find(".jtag-btn-cancel").click(function(g){g.preventDefault();c.unsetFromEditMode(a(this).closest(".tag-item"))})},changeGeom:function(b){if(!!b.data("id")){this.callBase("changeGeom",b)}},_changeColorByIcon:function(d){var b=d.closest(".tag-item");var c=d.attr("href").substring(1);this._changeColor(b,c)},_changeColor:function(c,b){var e=c.find(".tag-body textarea");var d=String(e.data("choosen-color"));if(d!=b){c.removeClass("tag-item-tagcolor"+d);c.addClass("tag-item-tagcolor"+b);e.data("choosen-color",b)}},_saveTagData:function(c){var b=this;desknets.ajax.rest({url:desknets.tags.restURL,data:b._getRequestParams(c),beforeSend:function(){desknets.submitform.setDisabled(c)},success:function(d){if(b.execAfterAjax(c,d)){b._updateTagData(c,d);b.unsetFromEditMode(c)}},complete:function(){desknets.submitform.clearDisabled(c)}})},_getRequestParams:function(b){var e=b.data("did");var d=b.find("textarea");var c={cmd:"tagmempentry",memo:d.val(),tagcolor:d.data("choosen-color")};if(!!e){c.id=e}return c},_updateTagData:function(b,d){var e=b.find(".tag-body");var f=e.children("textarea");var c=!b.data("id");b.data("type-id",f.data("choosen-color"));e.data("value",f.val());if(c){b.data("id",d.tagid);b.data("did",d.id);this.changeGeom(b)}}});desknets.hsearch={MODULE_SEARCH:"zsearch",CMD_SCHEDULE:"sch",CMD_PLANT:"plant",CMD_ADDRESS:"addr",CMD_BOARD:"info",CMD_WORK:"todo",CMD_FLOW:"flow",CMD_MAIL:"mail",CMD_CREPORT:"creport",CMD_FORUM:"forum",CMD_DOC:"doc",CMD_LUNCH:"koubai",CMD_PROJECT:"prj",CMD_PAY:"pay",CMD_STOCK:"stock",CMD_AGENT:"agent",CMD_MEMP:"memp",CMD_CABINET:"cab",CMD_USET:"uset",CMD_ENQUETE:"enq",CMD_AGENDA:"agenda",CMD_SAFETY:"safety",CMD_MAILIMAP:"mailimap",_STORAGENAME_VALUES:"neozsearchexec",init:function(){var b=this;var c=a("#dn-h-search");c.find(".jdn-h-search-button").click(function(j){j.preventDefault();var h=c.find('input[name="hsearch"]');var i=a.trim(h.val());h.val(i);var g=c.find('select[name="hmodule"]').val();var d=c.find('select[name="hmodule"] option:selected').data("module");var k=c.find('select[name="hmodule"] option:selected').data("topcmd");if(g.length>0){if(neo.isSet(i,{blank:false})&&i.length>desknets.SRCHKEY_MAXLENGTH){var f=desknets.Resource.Message.com_search_keyword_toolarge;desknets.dialog.alert(f,{type:"warn"});return}if(b._runSearch(g,d,k,i)){c.find('input[name="hsearch"]').val("");c.find('select[name="hmodule"]').val("")}}});c.delegate('input[name="hsearch"]',"keypress",function(d){if((d.which&&d.which==13)||(d.keyCode&&d.keyCode==13)){d.preventDefault()}})},_runSearch:function(e,f,i,d){var c=this;if(!neo.isSet(d)||d.length<=0){var b=desknets.Resource.searchcond;sMessage=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",b);desknets.dialog.alert(sMessage,{type:"warn"});return false}if(e=="0"){var h={};var g={};h.cmd="searchalldisp";g.cmd="searchalldisp";g.srch_key=d;g._=desknets.createRandomId();c.setZsearchExec();c._changeLocation(c.MODULE_SEARCH,h,g)}else{if(e==c.CMD_SCHEDULE){var h={};var g={};h.cmd=i;g.cmd="schsearch";g.key=d;g.sterm="7";g.rankflg="";g.reserve="";g.flag="";g.visitflg="";g.sfuture="1";g.outflg="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_WORK){var h={};var g={};h.cmd=i;g.cmd="todolistsearch";g.srch_key=d;g.row="0";g.srch_limdate_s="";g.srch_limdate_e="";g.complete="0";g.mytask="0";g.labelid="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_MAIL){h={};h.cmd=i;h.key=d;c._changeLocation(f,h)}else{if(e==c.CMD_PLANT){var h={};var g={};h.cmd=i;g.cmd="plantsearch";g.key=d;g.entry="";g.splantgroup="0";g.sterm="7";g.rankflg="";g.reserve="";g.flag="";g.visitflg="";g.sfuture="1";g.outflg="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_FLOW){var h={};var g={};h.cmd=i;g.cmd="flowsearch";g.srch_key=d;g.fldsort="entrydate";g.order="1";g.row="0";g.sw_formatid="";g.sw_status="-1";g.sw_entry="";g.sw_attach="";g.sw_important="0";g.sdate="";g.edate="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_CREPORT){var h={};var g={};h.cmd=i;g.cmd="creportcmdsearchpage";g.srch_key=d;g.fldsort="entrydate";g.order="-1";g.row="0";g.sw_attach="";g.sw_subject="";g.sw_status="-1";g.sw_entry="";g.sw_important="0";g.sdate="";g.edate="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_AGENDA){var h={};var g={};h.cmd=i;g.cmd="agendasrch";g.srch_key=d;g.fldsort="sdate";g.order="-1";g.row="0";g.sdate="";g.edate="";g.sw_entry="";g.sw_topic="0";g.labelid="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_BOARD){var h={};var g={};h.cmd=i;g.cmd="infosrchindex";g.srch_key=d;g.fldsort="sdate";g.order="-1";g.row="0";g.srch_catekind="0";g.srch_important="0";g.sdate="";g.edate="";g.fid="0";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_ADDRESS){h={};h.cmd=i;h.key=d;c._changeLocation(f,h)}else{if(e==c.CMD_FORUM){var h={};var g={};h.cmd=i;g.cmd="forumsearch";g.srch_key=d;g.sdate="";g.edate="";g.sw_target="3";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_DOC){var h={};var g={};h.cmd=i;g.cmd="docsearchindex";g.srch_key=d;g.fldsort="";g.order="";g.row="0";g.sdate="";g.edate="";g.sfolder="";g.folder="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_LUNCH){var h={};var g={};h.cmd=i;g.cmd="koubairvsearch";g.srch_key=d;g.srch_type="1";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_PROJECT){var h={};var g={};h.cmd=i;g.cmd="prjsearch";g.srch_key=d;g.sdate="";g.srch_sdaterange="1";g.edate="";g.srch_edaterange="1";g.srch_reportrange="0";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_PAY){var h={};var g={};h.cmd=i;g.cmd="paysearch";g.srch_key=d;g.demand="0";g.report="0";g.fldsort="procdate";g.order="1";g.row="0";g.sdate="";g.edate="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_STOCK){var h={};var g={};h.cmd=i;g.cmd="stocksearchlist";g.srch_key=d;g.fldsort="Group";g.order="1";g.row="0";g.min="";g.max="";g.gid="all";g.init="1";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_ENQUETE){var h={};var g={};h.cmd=i;g.cmd="enqcmdsearchindexpage";g.srch_key=d;g.fldsort="entrydate";g.order="-1";g.row="0";g.sw_subject="";g.sw_status="-1";g.sw_entry="";g.sw_important="0";g.sdate="";g.edate="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_AGENT){var h={};var g={};h.cmd=i;g.cmd="agentindex";g.srch_key=d;g._=desknets.createRandomId();c._changeLocation(f,h,g)}else{if(e==c.CMD_MEMP){var h={};var g={};h.cmd=i;g.cmd="mempsearch";g.srch_key=d;g.fldsort="updtime";g.order="-1";g.row="0";g.labelid="";g.sdate="";g.edate="";g.updsdate="";g.updedate="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_CABINET){var h={};var g={};h.cmd=i;g.cmd="cabsearch";g.srch_key=d;g.row="0";g.srch_size="";g.srch_sizerange="1";g.srch_extension="";g.srch_updtime="";g.srch_updunit="1";g.sfolder="";g.folder="";g._=desknets.createRandomId();c._initSubWinSrchArea(e,d,'input[name="srch_key"]');c._changeLocation(f,h,g)}else{if(e==c.CMD_USET){var h={};var g={};h.cmd=i;g.cmd="usetindex";g.srch_key=d;g._=desknets.createRandomId();c._changeLocation(f,h,g)}else{if(e==c.CMD_SAFETY){var h={};var g={};h.cmd=i;g.cmd="safetylist";g.srch_key=d;g._=desknets.createRandomId();c._changeLocation(f,h,g)}else{if(e==c.CMD_MAILIMAP){h={};h.cmd=i;h.key=d;c._changeLocation(f,h)}}}}}}}}}}}}}}}}}}}}}}}return true},_changeLocation:function(d,e,c,f){var b=desknets.getUrl(d);if(neo.isSet(e)){b+="?"+desknets.getNeoParam(e)}if(neo.isSet(c)){b+="#"+desknets.getNeoParam(c)}desknets.execLocation(b,f)},_initSubWinSrchArea:function(d,c,f){var b=this;if(b._isNowScreen(d)){var e=a("#dn-s-guide");e.find(".co-btnclear").trigger("click");e.find(f).val(c)}},_isNowScreen:function(e){var c=this;var d=false;var b=a("#jco-pv-funcid").val();if(neo.isSet(b)&&b.length>0){if(e==b.substr(0,e.length)){d=true}}return d},setZsearchExec:function(){desknets.storage.saveData(desknets.storage.FIELD_ZSEARCH_EXEC,"1")},clearZsearchExec:function(){desknets.storage.clearData(desknets.storage.FIELD_ZSEARCH_EXEC)},getZsearchExec:function(){var b=this;var d=false;var c=desknets.storage.loadData(desknets.storage.FIELD_ZSEARCH_EXEC);if(neo.isSet(c)&&c==="1"){d=true}return d},};desknets.rtfile={TMPL_IMAGE_TAG:'<img src="{{src}}" alt="{{alt}}" title="{{alt}}" width="{{width}}" height="{{height}}" {{otherAttrs}} />',TMPL_A_START_TAG:'<a href="{{href}}" target="_blank">',pageURL:"",restURL:"",pageTmpURL:"",pageTmpDLCmd:"",restTmpURL:"",restTmpAddCmd:"",restTmpModCmd:"",restTmpDelCmd:"",intervals:null,setUpChooserButton:function(e,d){var b=this;this._init(d);e.ui.addButton("ImgEditor",{label:desknets.Resource.rtfile.title});desknets.rtfile.chooser.cleanFile();var c=setInterval(function(){var f=a(".cke_button__imgeditor");if(f.length>0){f.closest(".cke_toolbar").css("float","right");f.click(function(){if(desknets.browser.msie||desknets.browser.edge){CKEDITOR.focusManager(e);e.focus()}if(f.hasClass("sourceview")||f.hasClass("maximizeview")){return}b.openPopInput(e,d)});clearInterval(c)}},200);e.on("doubleclick",function(g){var f=g.data.element;if(f.getAttribute("type")==="neoimage"){a(".jsIedOpenInput").trigger("hover").trigger("click",{initTab:1})}else{f.is("img")&&(!f.data("cke-realelement")&&!f.isReadOnly())&&(g.data.dialog="image")}})},openPopInput:function(d,c){var b=this;desknets.rtfile.chooser.open(function(e){b._insertImageElement(d,e)},{editor:d,attachsave:c.attachsave})},replaceDownloadUrlforConnectApp:function(f){var e=this;var c=f.content||"";if(f.arAttach&&f.arAttach.length>0){var b="{{cgi}}?cmd={{cmd}}&amp;fno={{fno}}&amp;filename={{filename}}";var d=f.module+"."+desknets.getExtension();b=desknets.tmpl.replaceWordHtml(b,"cgi",d);b=desknets.tmpl.replaceWordHtml(b,"cmd",f.cmd);a.each(f.arAttach,function(g,i){var h=b;h=desknets.tmpl.replaceWordHtml(h,"fno",i.id);h=desknets.tmpl.replaceWordHtml(h,"filename",i.attachdisp);c=desknets.tmpl.replaceWordHtml(c,"fno="+i.id,h)})}return c},_init:function(c){var b=this;b.pageURL="zcabinet."+desknets.getExtension();b.restURL=desknets.getUrl("zrcabinet");b.pageTmpURL=c.pagurl+"."+desknets.getExtension();b.restTmpURL=desknets.getUrl(c.resturl);b.pageTmpDLCmd=c.dl;b.restTmpAddCmd=c.add;b.restTmpModCmd=c.mod;b.restTmpDelCmd=c.del},_insertImageElement:function(g,e){var b=this;var d;var f=false;if(e.type=="cabimg"){d=b._getCabImgTagHtml(e)}else{if(e.type=="cabfile"){d=b._getCabFileTagHtml(e)}else{if(e.type=="cabvideo"){d=b._getCabVideoTagHtml(e);f=true}else{if(e.type=="img"){d=b._getTmpImgTagHtml(e)}else{if(e.type=="file"){d=b._getTmpFileTagHtml(e)}else{d=b._getTmpVideoTagHtml(e);f=true}}}}}if(f){var c=g.document.createElement("video");c.setAttribute("src",e.url);c.setAttribute("controls","controls");c=g.createFakeElement(c,"co-cke-media-placeholder video","media_video",true);g.insertElement(c)}else{g.insertHtml(d)}},_getCabImgTagHtml:function(d){var c;var b=this._getAttrForAlign(d.align);d.src="{{cgi}}?folder={{folder}}&cmd={{cmd}}&id={{id}}&fno={{fno}}&filename={{name}}&width={{width}}&height={{height}}";d.src=desknets.tmpl.replaceWord(d.src,"cgi",d.cgi);d.src=desknets.tmpl.replaceWord(d.src,"folder",d.folder);d.src=desknets.tmpl.replaceWord(d.src,"cmd",d.cmd);d.src=desknets.tmpl.replaceWord(d.src,"id",d.id);d.src=desknets.tmpl.replaceWord(d.src,"fno",d.fno);d.src=desknets.tmpl.replaceWord(d.src,"name",desknets.encodeURIComponentNeo(d.name));d.src=desknets.tmpl.replaceWord(d.src,"width",d.width);d.src=desknets.tmpl.replaceWord(d.src,"height",d.height);c=this._getImgTagHtml(d,b);if(!!d.href){c=this._getAStartTagHtml(d)+c+"</a>"}if(d.align=="c"){c='<div style="text-align: center;">'+c+"</div>"}return c},_getCabFileTagHtml:function(d){var b=this;var c="{{cgi}}?folder={{folder}}&cmd={{cmd}}&id={{id}}&fno={{fno}}&filename={{name}}&mimetype={{mimetype}}";c=desknets.tmpl.replaceWord(c,"cgi",d.cgi);c=desknets.tmpl.replaceWord(c,"folder",d.folder);c=desknets.tmpl.replaceWord(c,"cmd",d.cmd);c=desknets.tmpl.replaceWord(c,"id",d.id);c=desknets.tmpl.replaceWord(c,"fno",d.fno);c=desknets.tmpl.replaceWord(c,"name",desknets.encodeURIComponentNeo(d.name));c=desknets.tmpl.replaceWord(c,"mimetype",d.mimetype);d.url=c;return b._getFileTagHtml(d)},_getCabVideoTagHtml:function(d){var b=this;var c="{{cgi}}?folder={{folder}}&cmd={{cmd}}&id={{id}}&fno={{fno}}&filename={{name}}&mimetype={{mimetype}}";c=desknets.tmpl.replaceWord(c,"cgi",d.cgi);c=desknets.tmpl.replaceWord(c,"folder",d.folder);c=desknets.tmpl.replaceWord(c,"cmd",d.cmd);c=desknets.tmpl.replaceWord(c,"id",d.id);c=desknets.tmpl.replaceWord(c,"fno",d.fno);c=desknets.tmpl.replaceWord(c,"name",desknets.encodeURIComponentNeo(d.name));c=desknets.tmpl.replaceWord(c,"mimetype",d.mimetype);d.url=c},_getTmpImgTagHtml:function(d){var c;var b=this._getAttrForAlign(d.align);d.src="{{cgi}}?cmd={{cmd}}&fno={{fno}}&filename={{name}}";d.src=desknets.tmpl.replaceWord(d.src,"cgi",d.cgi);d.src=desknets.tmpl.replaceWord(d.src,"cmd",d.cmd);d.src=desknets.tmpl.replaceWord(d.src,"fno",d.fno);d.src=desknets.tmpl.replaceWord(d.src,"name",desknets.encodeURIComponentNeo(d.name));c=this._getImgTagHtml(d,b);if(!!d.href){c=this._getAStartTagHtml(d)+c+"</a>"}if(d.align=="c"){c='<div style="text-align: center;">'+c+"</div>"}return c},_getTmpFileTagHtml:function(d){var b=this;var c="{{cgi}}?cmd={{cmd}}&fno={{fno}}&filename={{name}}&mimetype={{mimetype}}";c=desknets.tmpl.replaceWord(c,"cgi",d.cgi);c=desknets.tmpl.replaceWord(c,"cmd",d.cmd);c=desknets.tmpl.replaceWord(c,"fno",d.fno);c=desknets.tmpl.replaceWord(c,"name",desknets.encodeURIComponentNeo(d.name));c=desknets.tmpl.replaceWord(c,"mimetype",d.mimetype);d.url=c;return b._getFileTagHtml(d)},_getTmpVideoTagHtml:function(d){var b=this;var c="{{cgi}}?cmd={{cmd}}&fno={{fno}}&filename={{name}}&mimetype={{mimetype}}";c=desknets.tmpl.replaceWord(c,"cgi",d.cgi);c=desknets.tmpl.replaceWord(c,"cmd",d.cmd);c=desknets.tmpl.replaceWord(c,"fno",d.fno);c=desknets.tmpl.replaceWord(c,"name",desknets.encodeURIComponentNeo(d.name));c=desknets.tmpl.replaceWord(c,"mimetype",d.mimetype);d.url=c},_getAttrForAlign:function(b){if(b=="l"){return'style="float:left"'}else{if(b=="r"){return'style="float:right"'}}return""},_getImgTagHtml:function(d,b){var c=this.TMPL_IMAGE_TAG;c=desknets.tmpl.replaceWord(c,"src",d.src);c=desknets.tmpl.replaceWord(c,"alt",d.alt);c=desknets.tmpl.replaceWord(c,"width",d.width);c=desknets.tmpl.replaceWord(c,"height",d.height);c=desknets.tmpl.replaceWordHtml(c,"otherAttrs",b);return c},_getFileTagHtml:function(c){var b='<a type="neofile" href="{{url}}" target="_blank">{{viewname}}</a>';b=desknets.tmpl.replaceWord(b,"url",c.url);b=desknets.tmpl.replaceWord(b,"viewname",c.alt);return b},_getAStartTagHtml:function(c){var b=this.TMPL_A_START_TAG;b=desknets.tmpl.replaceWord(b,"href",c.href);return b},onHeightSizeChk:function(d,e){var c=this;if(c.intervals!=null){clearInterval(c.intervals);c.intervals=null}if(!d||d.length==0){return}var b=d.height();var f=0;c.intervals=setInterval(function(){var g=d.height();f++;if(f>10){clearInterval(c.intervals)}if(b<g){f=0;b=g;if(typeof(e)=="function"){e()}}},1000)},};desknets.page(desknets.rtfile,"cabinetFolderTree",desknets.tree,{TMPL_START:"<ul>",TMPL_ITEM:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside">{{name}}</a>{{children}}</li>',TMPL_END:"</ul>",_defaultFolder:0,init:function(c,b){a.extend(this._defOptions,{idName:"data-id"});this.callBase("init",c,b)},_getSideTreeList:function(c){var b=this;desknets.ajax.rest({url:desknets.rtfile.restURL,data:{cmd:"cabcmdfolderlist"},success:function(d){b._defaultFolder=Number(d.folder);b._createTree(c,b._getHtmlFromJson(d,true))}})},_selectFirstItem:function(b){if(this._defaultFolder>0){var c=this.getItemObject_li(b,this._defaultFolder,this._options);this.onSelectItemNoAjax(this._getListParent(),this._defaultFolder);this._onSelectItem(null,c.children("a:first"))}else{this.callBase("_selectFirstItem",b)}},_createTree:function(d,c){var b=this;if(typeof c!="string"||!!c.match(/^\s+$/)){d.trigger("rtfileNoFolders");return}d.on("loaded.jstree",function(){setTimeout(function(){b._selectFirstItem(d);b._updateItemsWidth()},1)});d.jstree({plugins:["html_data"],html_data:{data:c,ajax:{dataType:"json",url:desknets.rtfile.restURL,data:function(e){return b._getRequestParams(e)},success:function(f,e,g){return b._getHtmlFromJson(f,false)}}}});d.closest(".co-listview-tree").show()},_getRequestParams:function(d){var b=a.cookie(desknets.COOKIENAME_STOKEN);var c={cmd:"cabcmdfolderlistchild",pfolder:d.data("id")};c[String(b)]="1";return c},_getHtmlFromJson:function(c,d){var b=desknets.ajax.getJsonItems(c);if(b.length<=0){return" "}return this._getHtmlFromItems(b,d,0)},_getHtmlFromItems:function(c,g,f){var b=this,d=[b.TMPL_START],e=false;a.each(c,function(j,k){var m=b.TMPL_ITEM,h="";var l=Number(k.children)>0?"closed":"leaf";if(g){var n=desknets.ajax.getJsonItems(k);if(b._defaultFolder==k.id){e=true}if(n.length>0){h=b._getHtmlFromItems(n,g,f+1);if(!!h){e=true;l="open"}}}m=desknets.tmpl.replaceWordHtml(m,"id",k.id);m=desknets.tmpl.replaceWordHtml(m,"state",l);m=desknets.tmpl.replaceWord(m,"name",k.Name);m=desknets.tmpl.replaceWordHtml(m,"children",h);d.push(m)});d.push(b.TMPL_END);return(f>0&&!e)?"":d.join("")}});desknets.rtfile.chooser={LENGTH_IMAGE_EDGE:100,PER_PAGE:20,TMPL_CABINET_LINK:'<a href="{{cgi}}?cmd=cabindex">{{name}}</a>',_$dialog:a(),_$ImgEditordialog:a(),mfileupload:{},miupcnt:0,miloadcnt:0,$popInput_tabs:null,_onChoose:null,inputeditor:null,mautosave:null,_cabimgitemHtml:"",_cabfileitemHtml:"",_cabvideoitemHtml:"",_tmpimgitemHtm:"",_tmpfileitemHtml:"",_tmpvideoitemHtml:"",_footbtn:"",_filelist:{},_boload:false,_$cabkeyword:a(),_$cabtree:a(),_$cablist:a(),_cabfid:0,_cabkeyword:"",_cabtree:null,_$cabuploadbtn:a(),_imgeditor:null,editorlang:{msgInputHere:desknets.Resource.rtfile.msgInputHere,msgStartApplyFilter:desknets.Resource.rtfile.msgStartApplyFilter,errCanvasSizeLimitSmall:desknets.Resource.rtfile.errCanvasSizeLimitSmall,errCanvasSizeLimitLarge:desknets.Resource.rtfile.errCanvasSizeLimitLarge,errTooManyObjectSelected:desknets.Resource.rtfile.errTooManyObjectSelected,confReset:desknets.Resource.rtfile.confReset,titlePreview:desknets.Resource.preview},open:function(c,f){var b=this;b._onChoose=c;b.inputeditor=f.editor;b.mautosave=f.attachsave;if(b._$dialog.length<=0){var d=function(){b._$dialog.find(".co-pop-tp-choose-link").each(function(){var h=a(this);if(h.css("display")!="none"){h.append('<input type="file" id="ifiles" size="299" tabindex="-1" multiple>')}});if(b._$dialog.find(".co-pop-tp-file").data("disableFileAppend")==true){b._$dialog.find("#ifiles").attr("disabled","disbled")}b._$dialog.find("#ifiles").on("change",{attach:this},this._onChange)};b.mfileupload=a.extend({},desknets.attach,{attachInput:d,_execCurrentFileCancel:function(h){h.resolveCurrentFile(false)},});var e=desknets.attach.ext.getListParam();if(!!e){desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:e,success:function(h){desknets.attach.ext.saveList(h)},})}b.loadJs();b._create()}else{var g=b._$dialog.find(".ui-tabs-panel:not(.ui-tabs-hide)");if(g.is("#ied-input-upload")){b._setUpUploadFileUp(g)}b._show()}},updatefilelist:function(c){var b=this;if(!!c){b._filelist={};a.each(c,function(d,e){e.fno=e.id;e.size=Number(e.size);e=b.setFileUpd(e);b._filelist[e.fno]=e})}},destroy:function(){var b=this;if(b._$dialog.length>0){b._$dialog.dialog("destroy").remove();b._$dialog=a();b._cabfid=0;b._cabkeyword="";b._cabtree=null}},loadJs:function(){if(a(".co-rtfile-js").length<=0&&!desknets.browser.msie8){var b=[];if(desknets.browser.tablet){b[0]="/dneores/js/extlibs/fabricjs/fabric_with_gestures.min.js"}else{b[0]="/dneores/js/extlibs/fabricjs/fabric.min.js"}b[1]="/dneores/js/neolibs/imgeditor.js";a.each(b,function(d,f){var c=document.createElement("script");c.className="co-rtfile-js";c.type="text/javascript";c.src=f;var e=document.getElementsByTagName("head")[0];e.appendChild(c)})}},_create:function(){var b=this;var c=a('<div id="rtfile-dialog-content" />').appendTo(document.body);desknets.tmpl.load(c,"com/rtfile.html",function(){b._$dialog=desknets.dialog.setUp(c,b._getDialogOptions());b._cabimgitemHtml=c.find(".jrtfile-list-item-cabimg").remove().html();b._cabfileitemHtml=c.find(".jrtfile-list-item-cabfile").remove().html();b._cabvideoitemHtml=c.find(".jrtfile-list-item-cabvideo").remove().html();b._tmpimgitemHtml=c.find(".jrtfile-list-item-tmpimg").remove().html();b._tmpfileitemHtml=c.find(".jrtfile-list-item-tmpfile").remove().html();b._tmpvideoitemHtml=c.find(".jrtfile-list-item-tmpvideo").remove().html();b._footbtn=c.find(".jrtfile-footerbtn").remove().html();b._$dialog.find(".rtfile-container-east").html(c.find(".jrtfile-fileset").remove().html());b._setUp();b._show();b.$popInput_tabs.tabs("option","selected",1);b._unselectItem()})},_getDialogOptions:function(){var b=this;var c=desknets.dialog.getDialogOption();c.width=900;c.title=desknets.Resource.rtfile.title;c.dialogClass=c.dialogClass+" co-ied-pop";c.close=function(){b._destroyFileUp()};c.buttons=[{text:desknets.Resource.rtfile.insertLabel,"class":"ied-btn",click:function(){b._onClickOkButton()}},{text:desknets.Resource.CancelButtonLabel,"class":"ied-btn ied-btn-2",click:function(){b._$dialog.dialog("close")}},];return c},_setUp:function(){var b=this;b.$popInput_tabs=b._$dialog.find(".tabs").tabs({select:function(d,e){b.handleTabActivation(e.panel)}});b._setUpImgEditor();b._$dialog.find(".ied-btn.jsIedOpenEditor").click(function(){desknets.submitform.clearDialogDisabled(b._$ImgEditordialog);b._$ImgEditordialog.dialog("open")});if(!desknets.pageframe.isShownMenu("cab")){b._$dialog.find(".rtfile-cabinet-tab").hide()}var c=b._$dialog.closest(".co-ied-pop");c.find(".ui-dialog-buttonpane").append(b._footbtn);b._$cabuploadbtn=c.find(".rtfile-upload-btn");b._$cabuploadbtn.hide();b.jsKeepRatio()},handleTabActivation:function(b){var c=this;var d=a(b);c._destroyFileUp();c._unselectItem();c._$cabuploadbtn.hide();if(d.is("#ied-input-upload")){c._setUpUploadFileUp(d)}else{if(d.is("#ied-input-select")){if(!d.data("initialized")){c._setUpContentFile(d);d.data("initialized",true)}}else{if(d.is("#ied-input-cabinet")){if(d.data("cab")===true){c._$cabuploadbtn.show()}if(!d.data("initialized")){c._setUpContentCab(d);c._setUpFolderTreeCab(d);d.data("initialized",true)}}}}},_show:function(){var b=this;b._getContentFileUse();b._unselectItem();b._$dialog.find('.rtfile-entry-size input[name="ratio"]').attr("checked",true);b._$dialog.dialog("open")},_onClickOkButton:function(){var b=this;var c=b._getImageProperties();if(!!c){if(c.type=="img"||c.type=="cabimg"){if(!desknets.validation.isNumber(c.width)||!desknets.validation.isNumber(c.height)){var d={};d.msg=desknets.Resource.Message.com_invalid_number;d.fieldid="size";d.fieldname=b._$dialog.find(".jrtfile-entry-size-title").eq(0).text()+desknets.merrMsgConnect;msg=desknets.getErrConvMsg(d);desknets.dialog.alert(msg);return}if((!!c.width&&Number(c.width)==0)||(!!c.height&&Number(c.height)==0)){var d={};d.msg=desknets.Resource.Message.com_minus_data;d.fieldid="size";d.fieldname=b._$dialog.find(".jrtfile-entry-size-title").eq(0).text()+desknets.merrMsgConnect;msg=desknets.getErrConvMsg(d);desknets.dialog.alert(msg);return}}if(typeof b._onChoose=="function"){b._onChoose(c)}b._$dialog.dialog("close")}else{desknets.dialog.alert(desknets.Resource.Message.rtfile_no_image)}},_selectItem:function(c){var b=this;b._unselectItem();c.addClass("rtfile-selected");b._setImageProperties(c)},_unselectItem:function(){var b=this;var c=b._$dialog.find(".ui-tabs-panel:not(.ui-tabs-hide)");c.find(".rtfile-selected").removeClass("rtfile-selected");b._cleanImageProperties()},_setImageProperties:function(e){var d=this;var f=e.find(".jrtfile-list-item-title").attr("title");var c=e.data("name");var h=d._$dialog.find(".ui-tabs-panel:not(.ui-tabs-hide)");var g=h.find(".rtfile-container-east dl");if(h.is("#ied-input-select")){g.find(".delete").show()}g.find(".jrtfile-entry-filename").text(c);g.find(">.rtfile-entry-alt-text>input").val(f);g.find(">.rtfile-entry-alt-text>input").val(f);if(e.data("width")>0){g.find('>.rtfile-entry-alignment input[name="align"]').removeAttr("disabled");g.find(">.rtfile-entry-href>input").removeAttr("disabled");g.find(">.rtfile-entry-size input").removeAttr("disabled");g.find(".ied-btn").removeAttr("disabled");var b=g.find(">.rtfile-entry-size input");b.eq(0).val(e.data("width"));b.eq(1).val(e.data("height"));b.eq(0).data("org",e.data("width"));b.eq(1).data("org",e.data("height"))}else{g.find('>.rtfile-entry-alignment input[name="align"]').attr("disabled","disbled");g.find(">.rtfile-entry-size input").attr("disabled","disbled");g.find(">.rtfile-entry-href>input").attr("disabled","disbled");g.find(".ied-btn").attr("disabled","disbled")}},_getImageProperties:function(){var c=this;var h=c._$dialog.find(".ui-tabs-panel:not(.ui-tabs-hide)");var d=h.find(".rtfile-selected");if(d.length<=0){return null}var f=h.find(".rtfile-container-east dl");var g=f.find(">.rtfile-entry-href>input").val();var b=f.find(">.rtfile-entry-size>input");var e={};e.alt=f.find(">.rtfile-entry-alt-text>input").val();e.align=f.find('>.rtfile-entry-alignment input[name="align"]:checked').val();e.href=!!g&&g!="http://"?g:"";e.width=b.eq(0).val();e.height=b.eq(1).val();e.type=d.data("type");e.name=d.data("name");e.cgi=d.data("cgi");e.folder=d.data("folder");e.cmd=d.data("cmd");e.id=d.data("id");e.fno=d.data("fno");e.mimetype=d.data("mimetype");return e},_cleanImageProperties:function(){var b=this;var d=b._$dialog.find(".ui-tabs-panel:not(.ui-tabs-hide)");var c=d.find(".rtfile-container-east dl");c.find(".jrtfile-entry-filename").text(" ");c.find(">.rtfile-entry-alt-text>input").val("");c.find(">.rtfile-entry-href>input").val("http://");c.find(">.rtfile-entry-size input").val("");c.find(".delete").hide();c.find('input[name="align"]').val([""]);c.find('>.rtfile-entry-alignment input[name="align"]').attr("disabled","disbled");c.find(">.rtfile-entry-size input").attr("disabled","disbled");c.find(">.rtfile-entry-href>input").attr("disabled","disbled");c.find(".ied-btn").attr("disabled","disbled")},_getSizeToFit:function(d,b,c){if(d<=0||b<=0){return{width:0,height:0}}var e=c/Math.max(d,b,c);return{width:Math.floor(d*e),height:Math.floor(b*e)}},getIsVideoExt:function(b){var c=b.lastIndexOf(".");if(c>=0){var d=b.substring(c+1,b.length);d=d.toLowerCase();if(d=="mp4"||d=="ogg"||d=="ogv"||d=="webm"){return true}}return false},jsKeepRatio:function(){var b=this;b._$dialog.find(".rtfile-entry-size").each(function(){var h=a(this);var c=h.find("input");var e=c.eq(0);var g=c.eq(1);var d=c.eq(2);var f=Number.MAX_SAFE_INTEGER||9007199254740991;e.add(g).on("change",function(){$thisinput=a(this);if(!d.is(":checked")){return}var m=$thisinput.val();if(m!=parseInt(m,10)||m<0||m>f){return}var n=$thisinput;var l=$thisinput.siblings("input[type=text]").eq(0);var k=n.data("org");var i=l.data("org");var j=Math.round(i*m/k);if(j>f){return}l.val(j)})});return false},_setUpUploadFileUp:function(d){var b=this;var c={uploadURL:desknets.rtfile.restTmpURL,uploadParams:{cmd:desknets.rtfile.restTmpAddCmd},delURL:desknets.rtfile.restTmpURL,delParams:{cmd:desknets.rtfile.restTmpDelCmd},downloadURL:desknets.rtfile.pageTmpURL+"?cmd="+desknets.rtfile.pageTmpDLCmd+"&fno={{id}}&updtime={{updtime}}&filename={{name}}",totalSizeLimit:2147483648,icon:desknets.attach.ext.getIconList(),file:{tmpnm:"",files:b._filelist},fileDrop:d.find(".ied-upload-msg"),afterUpload:function(){if(b._boload){return}b._boload=true;var e=b.uploadChgData();if(a("#neodialog-warn").length==0&&a("#neodialog-confirm").length==0&&a("#neodialog-error").length==0&&!e){setTimeout(function(){b.$popInput_tabs.tabs("option","selected",1)},500)}},};b.mfileupload.upload(c);if(a.browser.msie&&!!document.attachEvent){neouploader.setAttachObj(b.mfileupload)}},_destroyFileUp:function(){var b=this;b.mfileupload._destroy();b.mfileupload.totalFileNum=0;if(a.browser.msie&&!!document.attachEvent){neouploader.setAttachObj(null)}a(".co-pop-tp-file-drop").remove()},uploadChgData:function(){var d=this;var g=desknets.attach.getAttachFileInfo();var c;var f=0;a.each(d._filelist,function(i,j){f++});if(f>g.files.length){c=true}else{c=false}var b=a.extend({},d._filelist);d._filelist={};d.miupcnt=0;d.miloadcnt=0;a.each(g.files,function(i,j){if(!!j.servertime||!b[j.fno]){j=d.setFileUpd(j);d._filelist[j.fno]=j}else{d._filelist[j.fno]=b[j.fno]}});var h=0;var e=setInterval(function(){h++;if(d.miloadcnt>=d.miupcnt||h>20){d.createListFile(true);d._boload=false;clearInterval(e)}},500);return c},setFileUpd:function(e){var b=this;b.miupcnt++;var d=new Image();e.width=0;e.height=0;d.onload=function(){e.width=d.width;e.height=d.height;b.miloadcnt++};d.onerror=function(){b.miloadcnt++};if(!e.servertime){var c=new Date();e.servertime=neo.dateTime.format("yyyyMMddHHmmss",c)}if(!e.mimetype){e.mimetype=""}d.src=desknets.rtfile.pageTmpURL+"?cmd="+desknets.rtfile.pageTmpDLCmd+"&fno="+e.fno+"&updtime="+e.servertime;e.Name=e.attachdisp;e.updtime=e.servertime;return e},cleanFile:function(){var b=this;b._filelist={};if(b._$dialog.length>0){$list=b._$dialog.find(".rtfile-list-large").html("")}if(b.$popInput_tabs!=null){b.$popInput_tabs.tabs("option","selected",1)}},_setUpContentFile:function(d){var b=this;var c=b._$dialog.find("#ied-input-select .rtfile-list.large");b._$dialog.find(".rtfile-container-east .delete").click(function(e){e.preventDefault();b.delTmpFile()});c.on("click","li",function(e){e.preventDefault();b._selectItem(a(this))});d.find('select[name="fileselect"]').change(function(){b._unselectItem();b.createListFile(false)})},delTmpFile:function(){var b=this;var c="";var d=b._$dialog.find(".ui-tabs-panel:not(.ui-tabs-hide)").find(".rtfile-selected");desknets.ajax.rest({url:desknets.rtfile.restTmpURL,data:{cmd:desknets.rtfile.restTmpDelCmd,fno:d.data("fno")},success:function(e){d.remove();if(!!b._filelist[String(d.data("fno"))]){delete b._filelist[String(d.data("fno"))]}b._cleanImageProperties();if(a.isFunction(b.mautosave)){b.mautosave()}},})},createListFile:function(d){var c=this;var f="";if(d&&a.isFunction(c.mautosave)){c.mautosave()}var e=c._$dialog.find("#ied-input-select .rtfile-list.large");var b=c._$dialog.find('select[name="fileselect"]').val();a.each(c._filelist,function(g,h){var i=true;if(b==="2"){if(h.use!=="1"){i=false}}else{if(b==3){if(h.width==0){i=false}}else{if(b==4){if(h.use==="1"){i=false}}}}if(i){f=f+c._createListHtmlFile(h)}});e.html(f)},_createListHtmlFile:function(f){var c=this;var e="";if(f.width==0){if(c.getIsVideoExt(f.attachdisp)){e=c._tmpvideoitemHtml}else{e=c._tmpfileitemHtml}e=desknets.tmpl.replaceWordHtml(e,"imgfile",c._getIcon(f.attachdisp))}else{var d=c._getSizeToFit(f.width,f.height,c.LENGTH_IMAGE_EDGE);e=c._tmpimgitemHtml}var b="";if(f.use=="1"){b="rtfile-used"}e=desknets.tmpl.replaceWordHtml(e,"use",b);e=desknets.tmpl.replaceWordHtml(e,"cgi",desknets.rtfile.pageTmpURL);e=desknets.tmpl.replaceWordHtml(e,"cmd",desknets.rtfile.pageTmpDLCmd);e=desknets.tmpl.replaceWordHtml(e,"fno",f.fno);e=desknets.tmpl.replaceWord(e,"name",f.Name);e=desknets.tmpl.replaceWord(e,"attachdisp",f.attachdisp);e=desknets.tmpl.replaceWord(e,"attachdisp_enc",desknets.encodeURIComponentNeo(f.attachdisp));e=desknets.tmpl.replaceWordHtml(e,"width",f.width);e=desknets.tmpl.replaceWordHtml(e,"height",f.height);e=desknets.tmpl.replaceWordHtml(e,"mimetype",f.mimetype);return e},_getContentFileUse:function(){var b=this;var c=b.inputeditor.getData();a.each(b._filelist,function(d,f){var e="{{cgi}}?cmd={{cmd}}&amp;fno={{fno}}&amp;";e=desknets.tmpl.replaceWordHtml(e,"cgi",desknets.rtfile.pageTmpURL);e=desknets.tmpl.replaceWordHtml(e,"cmd",desknets.rtfile.pageTmpDLCmd);e=desknets.tmpl.replaceWordHtml(e,"fno",f.fno);if(c.indexOf(e)>=0){f.use="1"}else{f.use="0"}});b.createListFile(false)},_setUpContentCab:function(c){var b=this;b._$cabkeyword=c.find(".co-list-search-text");b._$cabtree=c.find(".co-listview-left");b._$cablist=c.find(".ui-layout-center > ul");b._cabtree=a.extend({},desknets.rtfile.cabinetFolderTree);desknets.keysearch.setUp("rtfile",b._$cabkeyword,function(){b._loadImagesWithKeywordCab(b._$cabkeyword.val())});b._$cabkeyword.siblings(".co-list-search-btn").click(function(d){d.preventDefault();b._loadImagesWithKeywordCab(b._$cabkeyword.val())});b._$cabuploadbtn.click(function(d){b._openUploadDialogCab()});b._$cablist.on("click","li",function(d){d.preventDefault();b._selectItem(a(this))})},_setUpFolderTreeCab:function(d){var c=this;var b=c._$cabtree.find(".co-listview-items");b.on("loaded.jstree",function(){c._onLoadTree(d)});b.on("rtfileNoFolders",function(){c._onFolderNotFoundCab()});c._cabtree.init(c._$cabtree,{selFunc:function(e){c._loadImagesWithFolderCab(e)}})},_onLoadTree:function(c){var b=this;c.data("cab",true);b._$cabuploadbtn.show();b._setUpLayoutCab(b._$dialog)},_onFolderNotFoundCab:function(){var b=this;var c=b.TMPL_CABINET_LINK,d;c=desknets.tmpl.replaceWordHtml(c,"cgi",desknets.rtfile.pageURL);c=desknets.tmpl.replaceWordHtml(c,"name",desknets.Resource.com_cab);d=desknets.Resource.Message.rtfile_no_cabinet_folder;d=desknets.tmpl.replaceWordHtml(d,"cabinet",c);b._unselectItem();desknets.dialog.alert(d)},_setUpLayoutCab:function(c){var b=this,d=c.find("#ied-input-cabinet").find(".co-listview");b._$dialog.find("#ied-input-cabinet .rtfile-cabinet-data").show();desknets.watermark.set(b._$cabkeyword);d.layout({zIndex:0,scrollToBookmarkOnLoad:false,"default":{size:200},west:{minSize:90,maxSize:300,spacing_open:12,closable:false,resizerTip:desknets.Resource.resizeWidthLabel,onresize_end:function(){b._cabtree._updateItemsWidth()}},});b._cabtree._updateItemsWidth()},_loadImagesWithFolderCab:function(c){var b=this;var d=c.data("id");if(d!=b._cabfid){b._cabfid=d;b._loadImagesCab(0)}},_loadImagesWithKeywordCab:function(c){var b=this;if(c!=b._cabkeyword){b._cabkeyword=c;b._loadImagesCab()}},_loadImagesCab:function(d){var b=this,c;b._unselectItem();c={cmd:"cabimagelist",folder:b._cabfid};if(!!b._cabkeyword){c.srch_key=b._cabkeyword}if(!!d){c.row=d}neo.ajax.abort("destnets-rtfile");desknets.ajax.rest({id:"destnets-rtfile",url:desknets.rtfile.restURL,data:c,success:function(e){b._replaceListItemsCab(e);b._updatePagerCab(e);b._$cablist.trigger("rtfileChooserChanged")}})},_replaceListItemsCab:function(d){var c=this,e=[];var b=desknets.ajax.getJsonItems(d);if(b.length>0){a.each(b,function(f,g){e.push(c._createListHtmlCab(g))});c._$cablist.html(e.join(""));c._$cablist.parent().removeClass("rtfile-no-items")}else{c._$cablist.empty();c._$cablist.parent().addClass("rtfile-no-items")}},_createListHtmlCab:function(e){var b=this;var d="";if(e.width==0){if(b.getIsVideoExt(e.attachdisp)){d=b._cabvideoitemHtml}else{d=b._cabfileitemHtml}d=desknets.tmpl.replaceWordHtml(d,"imgfile",b._getIcon(e.attachdisp))}else{var c=b._getSizeToFit(e.width,e.height,b.LENGTH_IMAGE_EDGE);d=b._cabimgitemHtml;d=desknets.tmpl.replaceWordHtml(d,"dispWidth",c.width);d=desknets.tmpl.replaceWordHtml(d,"dispHeight",c.height)}d=desknets.tmpl.replaceWordHtml(d,"cgi",desknets.rtfile.pageURL);d=desknets.tmpl.replaceWordHtml(d,"folder",b._cabfid);d=desknets.tmpl.replaceWordHtml(d,"id",e.id);d=desknets.tmpl.replaceWordHtml(d,"fno",e.fno);d=desknets.tmpl.replaceWord(d,"name",e.Name);d=desknets.tmpl.replaceWord(d,"attachdisp",e.attachdisp);d=desknets.tmpl.replaceWord(d,"attachdisp_enc",desknets.encodeURIComponentNeo(e.attachdisp));d=desknets.tmpl.replaceWordHtml(d,"width",e.width);d=desknets.tmpl.replaceWordHtml(d,"height",e.height);d=desknets.tmpl.replaceWordHtml(d,"updtime",e.updtime);d=desknets.tmpl.replaceWordHtml(d,"mimetype",e.mimetype);return d},_getIcon:function(f){var c=this;var b=desknets.attach.ext.getIconList();var e=b.none;var d=f.lastIndexOf(".");if(d>=0){var g=f.substring(d,f.length);g=g.toLowerCase();if(!!b[g]){e=b[g]}}return e},_updatePagerCab:function(c){var b=this;desknets.Pager.output(b._$cablist.parent(),".rtfile-pager",{getCount:b._$cablist.children().length,allCount:c.allcnt,pageMaxView:b.PER_PAGE,startRow:c.row,clickFunc:function(d){b._loadImagesCab(d)}})},_openUploadDialogCab:function(){var c=this;var e={uploadURL:desknets.rtfile.restURL,uploadParams:{cmd:"cabcmdaddattach"},delURL:desknets.rtfile.restURL,delParams:{cmd:"cabcmddelattach"},downloadURL:desknets.rtfile.pageURL+"?cmd=cabdispattach&fno={{id}}&updtime={{updtime}}&filename={{name}}",totalSizeLimit:2147483648,icon:desknets.attach.ext.getIconList(),file:{tmpnm:"",files:{}},afterUpload:function(){},};function d(){desknets.attach.uploadDialog(e)}function b(f){if(!!f.files&&f.files.length>0){desknets.ajax.rest({url:desknets.rtfile.restURL,data:{cmd:"cabrtfileattach",folder:c._cabfid},error:function(l,g,j){var i=desknets.ajax.getErrorNumber(l,g);var h=desknets.Resource.Message.rtfile_any_image_not_added;var k={errorNo:i,extraMessage:h,extraClass:"co-msg"};desknets.dialog.alert(j,k)},complete:function(){c._loadImagesCab(0)}})}}e.done=b;desknets.ajax.rest({url:desknets.rtfile.restURL,data:{cmd:"cabcmddelattach"},error:function(){},complete:d})},_setUpImgEditor:function(){var b=this;var c=a('<div id="ied-imgeditor-dialog-content" />').appendTo(document.body);desknets.tmpl.load(c,"com/ied-editor.html",function(){b._$ImgEditordialog=desknets.dialog.setUp(c,b._getImgEditorDialogOptions());b._$ImgEditordialog.dialogExtend({maximize:true,events:{maximize:function(f){a(this).closest(".ui-dialog").css("position","absolute")}}});var d=b._$ImgEditordialog.closest(".ui-dialog");d.find(".ui-dialog-titlebar-maximize").attr("title",desknets.Resource.rtfile.maximize);d.find(".ui-dialog-titlebar-restore").attr("title",desknets.Resource.rtfile.restore);if(desknets.browser.msie){desknets.submitform.setBackSpaseEvent(d)}})},_getImgEditorDialogOptions:function(){var b=this;var c=desknets.dialog.getDialogOption();b._imgeditor=null;c.width=845;c.minWidth=845;c.height=588;c.minHeight=589;c.resizable=true;c.title=desknets.Resource.rtfile.title_imagemod;c.dialogClass=c.dialogClass+" co-ied-pop";c.open=function(){if(b._imgeditor===null){b._imgeditor=NeoEditor.createEditor({dialog:b._$ImgEditordialog,url:b.getSelectImg(),lang:b.editorlang})}else{b._imgeditor.imageUrl=b.getSelectImg();b._imgeditor.resetCanvas();return}};c.buttons=[{text:desknets.Resource.OKButtonLabel,"class":"ied-btn",click:function(){desknets.submitform.setDialogDisabled(b._$ImgEditordialog);b._onClickOkButtonImgEditor()}},{text:desknets.Resource.preview,"class":"ied-btn",click:function(){b._imgeditor.preview()}},{text:desknets.Resource.CancelButtonLabel,"class":"ied-btn ied-btn-2",click:function(){a(this).dialog("close")}},];return c},getSelectImg:function(){var b=this;var e=b._$dialog.find(".ui-tabs-panel:not(.ui-tabs-hide)");var d=e.find(".rtfile-selected img");if(d.length<=0){return null}var c=String(d.attr("src")).replace(/&thumbnail=1$/,"");return c},_onClickOkButtonImgEditor:function(){var k=this;var c;var d=false;var j={};var i=k._imgeditor.getImageData();var b=k._getImageProperties();var g=i.indexOf(",");if(g>0){j.attach=i.substring(g+1,i.length);j.mimetype=i.substring(5,g-7)}j.filename=b.name;if(k._$dialog.find(".ui-tabs-panel:not(.ui-tabs-hide)").is("#ied-input-cabinet")){d=true;j.cmd="cabimgrtefileattach";j.folder=k._cabfid;c=desknets.rtfile.restURL}else{d=false;j.cmd=desknets.rtfile.restTmpModCmd;c=desknets.rtfile.restTmpURL;var g=j.filename.lastIndexOf(".");if(g>=0){var e=j.filename.substring(0,g);var h=j.filename.substring(g,j.filename.length);var f=new Date();j.filename=e+"_"+neo.dateTime.format("yyyyMMddHHmmss",f)+h}}desknets.ajax.rest({url:c,data:j,success:function(m){if(d){k._loadImagesCab();k._$ImgEditordialog.dialog("close")}else{var o={Name:m.attachdisp,attachdisp:m.attachdisp,fno:m.fno,mimetype:m.mimetype,size:Number(m.size),servertime:m.servertime,updtime:m.servertime};o=k.setFileUpd(o);var n=0;var l=setInterval(function(){n++;if(o.width!=0||n>3){k._filelist[o.fno]=o;k.createListFile(true);clearInterval(l);k._$ImgEditordialog.dialog("close")}},500)}},})},};desknets.menu={$state:a(),$root:a(),_isGlobalInitialized:false,initSideMenu:function(){var b=this,c;this.$state=a(document.body);this.$root=a("#dn-side-wrap");c=a(document.body).attr("class").match(/dn-side-(\w+)/);if(c.length>1){this._setApplicationMenuState(c[1])}this._initGlobal();this._onPageSizeChanged();this.$root.on("click",".co-menu-application-btn",function(d){d.preventDefault();b._onClickToggleButton(a(d.target))});this.$root.on("click",".jco-menu-item-link",function(d){if(b._navigateToPage(a(this))){d.preventDefault()}})},saveMenuState:function(b,f){var g="",e="0i";var c=a.cookie(desknets.COOKIENAME_LEFT_MENU)||"";for(var d=0;d<b;d++){g+=c.length>d?c.charAt(d):e.charAt(d)}g+=f.charAt(0)+c.substring(b+1);desknets.saveCookieToDisk(desknets.COOKIENAME_LEFT_MENU,g)},reload:function(){var b=this;desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:{cmd:"menucmdcontenthtml"},dataType:"html",success:function(c){b._replaceMenu(c)}})},close:function(){this._setApplicationMenuState("close")},_initGlobal:function(){var b=this;if(!this._isGlobalInitialized){a(window).off("resize.dneoMenu").on("resize.dneoMenu",function(){b._onPageSizeChanged()});this._isGlobalInitialized=true}},_onPageSizeChanged:function(){setTimeout(function(){var d=a("#dn-body"),c=1;var b=a(window).height()-a("#dn-header").height();d.find(".jco-menu-min-height").each(function(){c+=a(this).outerHeight()});b=Math.max(b,c);d.css("min-height",b+"px")},10)},_onClickToggleButton:function(b){var d;var c=b.closest(".jco-menu-application-btn").data("type");if(a.inArray(c,["close","open","fit"])>=0){this._setApplicationMenuState(c)}else{if(c=="toggle"){d=a(document.body).hasClass("dn-side-close");this._setApplicationMenuState(d?"open":"close")}}},_setApplicationMenuState:function(d){var c=this.$state.data("side-menu")||"";var b=this.$root.find('.co-menu-application-btn[data-type="toggle"]');if(c!="open"&&d=="open"){this._onStartFloat()}else{if(c=="open"&&d!="open"){this._onEndFloat()}}if(c=="close"&&d!="close"){b.attr("title",desknets.Resource.closeLabel)}else{if(c!="close"&&d=="close"){b.attr("title",desknets.Resource.openLabel)}}if(c!="fit"&&d=="fit"){this.saveMenuState(0,"1")}else{if(c=="fit"&&d!="fit"){this.saveMenuState(0,"0")}}this.$state.removeClass("dn-side-"+c);this.$state.addClass("dn-side-"+d);this.$state.data("side-menu",d);this.$root.trigger("menuChanged.side",{oldState:c,newState:d})},_onStartFloat:function(){var b=this;desknets.pageframe.notifyToShowLayer(this.$root);a(document.body).on("click.side_close",function(d){for(var c=a(d.target);c.length>0;c=c.parent()){if(c.is("body, #dn-side-wrap")){break}if(c.is("#dn-body, #dn-header, #dn-tags")){b._setApplicationMenuState("close")}}})},_onEndFloat:function(){desknets.pageframe.notifyToHideLayer(this.$root);a(document.body).off("click.side_close")},_replaceMenu:function(c){var b=a("#dn-side-wrap");var d=a('<div class="co-menu-side-pane" />').html(c);var e=d.children(".co-menu-palette-menu").length>0?"palette":"slide";this._moveSubWindow(b,d,e);b.remove();this.$state.removeClass("dn-palette-menu dn-slide-menu");this.$state.data("side-menu","");d.prependTo("#dn-body");d.attr("id","dn-side-wrap");this.$state.addClass("dn-"+e+"-menu");if(e=="palette"){desknets.menu.bar.initSideMenu()}else{if(e=="slide"){desknets.menu.frame.initSideMenu()}}},_moveSubWindow:function(d,e,g){var f=d.find(".dn-s-guide").parent();var b=e.find(".dn-s-guide").parent();if(f.find("> .dn-s-guide > *").length>0&&b.length>0){b.empty().append(f.children());b.find(".co-no-menu-application").removeClass("co-no-menu-application")}else{if(g=="palette"&&!a(document.body).hasClass("dn-side-close")){var c=this.$state.data("side-menu")||"";this.$state.removeClass("dn-side-"+c).addClass("dn-side-close")}}},_navigateToPage:function(d){var f=d.closest("li"),c=f.data("kind"),e=f.data("did");var b=String(d.attr("href")).indexOf("&log=on")>=0;if(c=="optmenu"){this._authOptMenu(d);return true}return false},_authOptMenu:function(b){desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_OPT),data:{cmd:"optauth",id:b.closest("li").data("did")},async:false,success:function(c){desknets.execLocation(b.attr("href"),b.attr("target"))}})},};desknets.menu.bar={_tmplItem:"",initSideMenu:function(){var c=this,b=a("#dn-side-wrap");desknets.menu.initSideMenu();this._tmplItem=b.find("script.jco-menu-tmpl").html();this.setUp(b);desknets.menu.$root.on("click",".jco-menu-group",function(d){d.preventDefault();var e=a(this);if(!e.hasClass("co-drop-down-button")){c._loadSubContents(e.closest("li").data("did"),e)}});desknets.menu.$root.on("click",".co-menu-list-in-group a",function(d){desknets.popUp.hide(a(this).closest(".co-menu-list-in-group"))});a("#dn-s-guide > .dn-s-menu-title > .dn-s-menu-link").removeAttr("href")},setUp:function(b){var c=this;b.find(".co-menu-toggle-btn").click(function(d){d.preventDefault();c._toggleItemState(a(this).closest(".co-menu-palette-menu"))})},_toggleItemState:function(b){if(b.closest(".co-setmenu-tab-content").length>0){b.toggleClass("text")}else{desknets.menu.$state.toggleClass("text");desknets.menu.saveMenuState(1,desknets.menu.$state.hasClass("text")?"t":"i")}},_loadSubContents:function(e,d){var c=this;var b=a("#"+d.data("for"));desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:{cmd:"menucmdcontentlist",id:e},success:function(h){var f=desknets.ajax.getJsonItems(h);var g=a('<ul class="co-menu-list co-menu-sub-list"></ul>');g.html(c._createSubContentsHtml(f));b.empty().append(g);d.addClass("co-drop-down-button");desknets.popUp.open(b,{target:d,position:"right"})}})},_createSubContentsHtml:function(c){var b=this,d=[];a.each(c,function(f,g){var e=b._tmplItem;e=desknets.tmpl.replaceWord(e,"id",g.id);e=desknets.tmpl.replaceWord(e,"kind",g.kind);e=desknets.tmpl.replaceWord(e,"sid_data",g.sid_data);e=desknets.tmpl.replaceWord(e,"icon",g.menufilename);e=desknets.tmpl.replaceWord(e,"url",g.Url);e=desknets.tmpl.replaceWord(e,"target",g.target);e=desknets.tmpl.replaceWord(e,"name",g.Name);d.push(e)});return d.join("")}};desknets.menu.frame={_tmplItem:"",initSideMenu:function(){desknets.menu.initSideMenu();this._setLeftMenu()},_setLeftMenu:function(){var b=this;a("#dn-s-menu").find(".dn-s-menu-link").click(function(){var d="0";var c=a(this).parent();c.next().slideToggle();if(!c.hasClass("on")){d="1"}c.toggleClass("on");c=a("#dn-s-option").find(".dn-s-menu-link").parent();if(c.hasClass("on")){c.next().slideToggle();c.toggleClass("on")}c=a("#dn-s-guide").find(".dn-s-menu-link").parent();if(c.hasClass("on")){c.next().slideToggle();c.toggleClass("on")}c=a("#dn-s-adminmenu").find(".dn-s-menu-link").parent();if(c.hasClass("on")){c.next().slideToggle();c.toggleClass("on")}return false});a("#dn-s-option").find(".dn-s-menu-link").click(function(){var d="0";var c=a(this).parent();c.next().slideToggle();if(!c.hasClass("on")){d="1"}c.toggleClass("on");c=a("#dn-s-menu").find(".dn-s-menu-link").parent();if(c.hasClass("on")){c.next().slideToggle();c.toggleClass("on")}c=a("#dn-s-guide").find(".dn-s-menu-link").parent();if(c.hasClass("on")){c.next().slideToggle();c.toggleClass("on")}c=a("#dn-s-adminmenu").find(".dn-s-menu-link").parent();if(c.hasClass("on")){c.next().slideToggle();c.toggleClass("on")}return false});a("#dn-s-guide").find(".dn-s-menu-link").click(function(){var d="0";var c=a(this).parent();c.next().slideToggle();if(!c.hasClass("on")){d="1"}c.toggleClass("on");c=a("#dn-s-menu").find(".dn-s-menu-link").parent();if(c.hasClass("on")){c.next().slideToggle();c.toggleClass("on")}c=a("#dn-s-option").find(".dn-s-menu-link").parent();if(c.hasClass("on")){c.next().slideToggle();c.toggleClass("on")}c=a("#dn-s-adminmenu").find(".dn-s-menu-link").parent();if(c.hasClass("on")){c.next().slideToggle();c.toggleClass("on")}return false})}};desknets.menu.icon={setUp:function(e){var b=this;var d=e.find(".co-menu-icon-current"),c=d.attr("src");e.addClass("jco-menu-icon-box");d.data("default-src",c);e.find(".jco-menu-icon-select-btn").click(function(f){f.preventDefault();b._toggleDisplay(a(this).closest(".jco-menu-icon-box"),".co-menu-icon-select",".co-menu-icon-upload")});e.find(".jco-menu-icon-upload-btn").click(function(f){f.preventDefault();b._toggleDisplay(a(this).closest(".jco-menu-icon-box"),".co-menu-icon-upload",".co-menu-icon-select")});e.find(".co-menu-icon-select").on("click","li",function(f){f.preventDefault();b._selectIcon(a(this).find("img"))});e.find("input.jco-menu-uploaded-icon").change(function(f){b._selectFile(a(this))});this.setInitialValue(e,c)},setInitialValue:function(e,c){var b=e.find("input.jco-menu-selected-icon");var d=e.find(".co-menu-icon-current");d.attr("src",c).data("default-src",c).show();if(c.indexOf("?")>=0){this._toggleDisplay(e,".co-menu-icon-upload",".co-menu-icon-select");b.val("")}else{this._toggleDisplay(e,".co-menu-icon-select",".co-menu-icon-upload");b.val(c)}},_toggleDisplay:function(f,d,c){var e=f.find(d);var b=f.find(c);b.hide();e.show();desknets.popUp.hide(f.find(".co-pop-up-box"))},_selectIcon:function(c){var d=c.closest(".jco-menu-icon-box");var b=c.attr("src");d.find(".co-menu-icon-current").show().attr("src",b);d.find("input.jco-menu-selected-icon").val(b)},_selectFile:function(b){var d=b.closest(".jco-menu-icon-box");var c=d.find(".co-menu-icon-current");if(!!b.val()){c.hide()}else{c.show().attr("src",c.data("default-src"))}d.find("input.jco-menu-selected-icon").val("")},};app.addInitialAction(function(){desknets.init()})})(jQuery);