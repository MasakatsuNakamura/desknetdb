/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.uset={CMD_USETINDEX:"usetcmdindex",};a.extend(desknets.uset,{PAGE_USETINDEX:"usetindex",PAGE_USETSEARCH:"usetsearch",CMD_USETSEARCH:"usetcmdsearch",KEY_GROUP:"Group",KEY_ASSIGNGROUP:"assigngrp",KEY_NAME:"Name",init:function(){var b=this;var c=a("#jco-pv-funcid").val();if(b.isLoadOnly(c)){return}desknets.pageframe.setFuncSel(c);if(c==b.PAGE_USETINDEX){desknets.hashobserver.init(desknets.uset);desknets.uset.subwin.init();desknets.uset.usetindex.init()}},isLoadOnly:function(b){if(b.indexOf("set")==0){return true}return false}});desknets.page(desknets.uset,"usetindex",desknets.PageListBase,{_initListEnd:function(){var b=this;b.callBase("_initListEnd");b._initListEndSetUsetIndex()},_initListEndSetUsetIndex:function(){var b=this;var h=b.$mjListPage.find(".jco-back-page-data");var g=b.$mjListPage.find(".co-list-search-text");var f=function(i){h.find('input[name="srch_key"]').val("");g.val("").blur();h.find('input[name="gid"]').val(i);b._listPage("0")};var c={assign:true,onSelectGroup:f};var d={allGroup:"choosable",choosePrivateGroup:true,unassignGroup:"choosable"};desknets.page.groupSelect.init(c,d);var e=function(){var i=h.find('input[name="srch_key"]');if(!b.chkListSearchKeyLength(g.val())){return}if(i.val()!=desknets.escape(g.val())){i.val(g.val());b.boChangePageNoHide=true;b._listPage("0")}};a(".co-list-search-btn").find("a").click(function(i){i.preventDefault();e()});desknets.keysearch.setUp("usetcmdlist",g,e)},_getListAjaxSuccess:function(c){var b=this;b.callBase("_getListAjaxSuccess",c);desknets.page.groupSelect.editSelectedGroup(b.$mjListPage.find(".jco-sel-items"),c);var d=desknets.paramanalyzer.getHashParams();desknets.keysearch.fixListWatermark(b.$mjListPage,d)},_getListAjaxSuccessEnd:function(){var b=this;b.callBase("_getListAjaxSuccessEnd");a.each(b.$mjListPage.find(".uset-maillink"),function(c,d){desknets.htmlparts.setUpMailLink(a(this))})},_listLine:function(b,c){b=desknets.uset.edit.editIndexListLine(b,c,this._replaceListLine);return b},changPage:function(){var b=this;b.callBase("changPage");if(!b.boSetwatermark){b.boSetwatermark=true;desknets.watermark.set(b.$mjListPage.find(".co-list-search-text"))}},_getListCmd:function(){return desknets.uset.PAGE_USETINDEX},_getListExecCmd:function(){return desknets.uset.CMD_USETINDEX},initParamsFromHash:function(c){var b=this;var e=desknets.paramanalyzer.getHashParams();b.changeSubWin();var d=c.cmd;if(!neo.isSet(d)||d==b._getListCmd()){b._hashUpdateListPage(c)}else{b._hashUpdatePageView(d)}},changeSubWin:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(b.cmd)||(b.cmd==c._getListCmd()&&b.gid!="all")||(b.cmd==desknets.uset.PAGE_USETSEARCH&&b.descendant!="all")){desknets.uset.subwin.setSubWinSelectDescendant(true)}else{desknets.uset.subwin.setSubWinSelectDescendant(false)}},_hashUpdatePageView:function(d){var c=this;var e=desknets.paramanalyzer.getHashParams();var b="#"+c._getIdListSearchPage();if(a(b).find(".jco-title").length>0){desknets.uset.usetsearch._getListAjax(e.row)}else{desknets.uset.usetsearch.initPage(c._getListCmd(),c._getIdListPage())}c.mhashBackCmd=c._getListSearchCmd();c.mhashIdBack=c._getIdListSearchPage()},_getIdListSearchPage:function(){return desknets.uset.usetsearch._getIdListPage()},_getListSearchCmd:function(){return desknets.uset.PAGE_USETSEARCH}});desknets.uset.edit={_tmplMail:'<span class="uset-mail-set uset-list-mailswitch-{{key}}"><a class="uset-mail-{{icon}} uset-maillink" href="mailto:{{key}}"><span title="{{key}}">{{key}}</span></a></span><br />',_tmplMailNoLink:'<span class="uset-mail-set"><span class="uset-mail-{{icon}}"><span title="{{key}}">{{key}}</span></span></span><br />',editIndexListLine:function(c,j,f){var k=this;var h={Mail:"company",mailprivate:"home",mailmobile:"phone",mailother:"other"};var b="";var g="";if(typeof j=="object"){if(!j.assigngrp){j.assigngrp={}}if(!j.Naisen){j.Naisen=""}if(!j.Post){j.Post=""}for(b in j){if(neo.isSet(j[b],{blank:false})&&(b=="Mail"||b=="mailprivate"||b=="mailmobile"||b=="mailother")){var i=k._tmplMail;var d=desknets.pageframe.getLoginMailLink();if((neo.isSet(d)&&d<=0)||!neo.isSet(d)){i=k._tmplMailNoLink}i=desknets.tmpl.replaceWord(i,"key",j[b]);i=desknets.tmpl.replaceWord(i,"icon",h[b]);g=g+i}else{if(b==desknets.user.KEY_ASSIGNGROUP){var e=[];e=desknets.user.getListAssignGroups(j[b].Name);c=desknets.tmpl.replaceWordChkHtml(c,b,e.assign);c=desknets.tmpl.replaceWordChkHtml(c,"assigntitle",e.assigntitle)}else{if(a.isFunction(f)){c=f(c,b,j)}}}}}c=desknets.tmpl.replaceWordChkHtml(c,"mailaddr",g);return c}};desknets.page(desknets.uset,"usetsearch",desknets.uset.usetindex,{_boDelSingle:function(){return true},_initGetHtml:function(){var b=this;b.boGetHtmlSingle=b._boDelSingle();b.callBase("_initGetHtml")},initSortLinkUserList:function(){desknets.user.listsort.setUpSort(this.$mjListPage,this,{sortPopAreaID:"co-list-sort-item-search"})},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".jco-list-page").click(function(c){c.preventDefault();b.dispBackListPage()})},_initListEndSetUsetIndex:function(){},_getIdListPage:function(){return"jco-m-search-container"},_getIdListPageForm:function(){return"listfrmsrch"},_getListCmd:function(){return desknets.uset.PAGE_USETSEARCH},_getListExecCmd:function(){return desknets.uset.CMD_USETSEARCH}});desknets.page(desknets.uset,"subwin",desknets.PageSubwinSearch,{VAL_GETALL:"all",VAL_GETCURRENT:"current",VAL_GETLOWER:"lower",SRCHTEL_MAXLENGTH:63,init:function(){var b=this;var c=a(".jco-subwindow-search");var d=desknets.paramanalyzer.getHashParams();c.find('input[name="Name"]').val(d.Name);c.find('input[name="Tel"]').val(d.Tel);c.find('input[name="Post"]').val(d.Post);c.find('input[name="Mail"]').val(d.Mail);c.find('input[name="descendant"]').val(d.descendant);c.find('input[name="gid"]').val(d.gid);b.callBase("init");b._setInit();b._initUsetSubWin()},_initUsetSubWin:function(){var b=this;b.$_inputArea.find(".co-guide-label").each(function(){var c=a(this);desknets.user.removeFieldIfHidden(c,c.next())})},_getSearchPrm:function(e){var b=this;var f={};var c=b.$_inputArea;var d=b._getGroupIdFromUserIndex();e.row="0";e.Name=c.find('input[name="Name"]').val();e.Tel=c.find('input[name="Tel"]').val();e.Post=c.find('input[name="Post"]').val();e.Mail=c.find('input[name="Mail"]').val();e.descendant=c.find('select[name="descendant"]').val();e.gid=d;e.fldsort="SEQNO";e.order="1";return e},_chkInputSearchRequired:function(){var b=this;if(!b._boCheckCondSrchUset()){var c=b._getMsgNoCondSrchUset();desknets.dialog.alert(c,{type:"warn"});return false}return b.callBase("_chkInputSearchRequired")},_boCheckCondSrchUset:function(){var d=this;if(!neo.isSet(d.$_inputArea)){return false}var g=d.$_inputArea.find('input[name="Name"]');var b=d.$_inputArea.find('input[name="Tel"]');var h=d.$_inputArea.find('input[name="Post"]');var f=d.$_inputArea.find('input[name="Mail"]');var c=d.$_inputArea.find('select[name="descendant"]');if(g.length>0&&g.val().length>0){return true}if(b.length>0&&b.val().length>0){return true}if(h.length>0&&h.val().length>0){return true}if(f.length>0&&f.val().length>0){return true}if(!!c&&c.val().length>0){if(c.val()==d.VAL_GETCURRENT||c.val()==d.VAL_GETLOWER){var e=d._getGroupIdFromUserIndex();if(e=="all"){return false}if(!!e&&e.length>0){return true}}}return false},_getMsgNoCondSrchUset:function(){var b=desknets.Resource.com_srch_noset;var c=desknets.Resource.Message.com_search_required;return desknets.tmpl.replaceWordHtml(c,"item",b)},_execClear:function(){var b=this;b.callBase("_execClear");var c=b.getInputArea().find('select[name="descendant"]');if(!c.attr("disabled")){c.val("current")}},_getGroupIdFromUserIndex:function(){var b=this;var c="";var d=desknets.paramanalyzer.getHashParams();if(neo.isSet(d)&&neo.isSet(d.gid)){c=d.gid}else{c=a("#jco-m-list-container").find(".jco-back-page-data").find('input[name="gid"]').val();if(!c){c=b.$_inputArea.find('input[name="searchgid"]').val()}}return c},_chkInputSearchKeyLength:function(){var b=this;var c=null;c=b.$_inputArea.find('input[name="Tel"]');if(c.length>0&&c.val().length>b.SRCHTEL_MAXLENGTH){sMessage=desknets.Resource.Message.com_search_keyword_toolarge_short;desknets.dialog.alert(sMessage,{type:"warn"});return false}return b.callBase("_chkInputSearchKeyLength")},_setInit:function(){var d=this;var b=desknets.paramanalyzer.getHashParams();var c=a("#jco-pv-funcid").val();if(c==desknets.uset.PAGE_USETINDEX&&b.cmd!=d._getMainCmd()){d.setSubWinSelectDescendant(true)}else{d.setSubWinSelectDescendant(false)}},setSubWinSelectDescendant:function(d){var e=this;var f=e.getInputArea();var g=f.find('select[name="descendant"]');var c="all";var b=desknets.paramanalyzer.getHashParams();if(d){if(!g.attr("disabled")){return}if(!b.cmd||b.cmd==e._getMainCmd()){c="current"}}if(b.cmd==e._getSearchCmd()){c=b.descendant}g.val(c);g.attr("disabled",!d)},_getMainCmd:function(){return desknets.uset.PAGE_USETINDEX},_getSearchCmd:function(){return desknets.uset.PAGE_USETSEARCH}});app.addInitialAction(function(){desknets.uset.init()})})(jQuery);