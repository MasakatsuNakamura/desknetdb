/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.plant={CMD_RPLANTPRIVATE:"plantprivate",CMD_RPLANTHOLDONENTRY:"plantschholdonentry",CMD_PLANTHOLIDAY:"plantholidaylist",PAGE_PLANTYEARCAL:"plantyearcalhtml"};a.extend(desknets.plant,{PAGE_PLANTWEEKGRP:"plantweekgrp",PAGE_PLANTDAYGRP:"plantdaygrp",PAGE_PLANTWEEK:"plantweek",PAGE_PLANTDAY:"plantday",PAGE_PLANTMONTH:"plantmonth",CMD_RPLANTGROUP:"plantgrp",PAGE_PLANTWEEKSEL:"plantweeksel",PAGE_PLANTDAYSEL:"plantdaysel",PAGE_PLANTFREE:"plantfree",PAGE_PLANTSEARCH:"plantsearch",CMD_PLANTSEARCHSTOP:"plantsearchstop",CMD_PLANTSEARCH:"plantcmdsearch",CMD_PLANTSEARCHDEL:"plantcmdsearchdel",CMD_PLANTSEARCHDELCONF:"plantcmdsearchdelconf",PAGE_PLANTADD:"plantadd",PAGE_PLANTMOD:"plantmod",PAGE_PLANTADDTARGET:"plantaddtarget",PAGE_PLANTREFERDTL:"plantreferdtl",PAGE_PLANTMSETWEEKGRP:"plantmsetweekgrp",PAGE_PLANTMSETDAYGRP:"plantmsetdaygrp",PAGE_PLANTMSETWEEK:"plantmsetweek",PAGE_PLANTMSETDAY:"plantmsetday",PAGE_PLANTMSETMONTH:"plantmsetmonth",CMD_RPLANTMSETGROUP:"plantmsetgrp",CMD_RPLANTMSETPRIVATE:"plantmsetprivate",PAGE_PLANTMSETWEEKSEL:"plantmsetweeksel",PAGE_PLANTMSETDAYSEL:"plantmsetdaysel",PAGE_PLANTMSETFREE:"plantmsetfree",CMD_PLANTMSETSCHFREE:"plantmsetcmdfree",CMD_PLANTMSETFREECHECKENTRY:"plantmsetcmdfreecheck",PAGE_PLANTMSETSEARCH:"plantmsetsearch",CMD_PLANTMSETSEARCH:"plantmsetcmdsearch",CMD_PLANTMSETSEARCHDEL:"plantmsetcmdsearchdel",CMD_PLANTMSETSEARCHDELCONF:"plantmsetcmdsearchdelconf",PAGE_PLANTMSETADD:"plantmsetadd",PAGE_PLANTMSETMOD:"plantmsetmod",PAGE_PLANTMSETADDTARGET:"plantmsetaddtarget",CMD_PLANTMSETSCHREF:"plantmsetschref",PAGE_PLANTMSETREFERDTL:"plantmsetreferdtl",CMD_PLANTMSETSELPLANT:"plantmsetselplant",CMD_PLANTMSETSELPGROUP:"plantmsetselpgroup",init:function(){var c=this;var b=false;var d={};var e=a("#jco-pv-funcid").val();desknets.sch.module="plant";if(this.isPlantSetCmd(e)){return}else{if(this.isPlantPSetCmd(e)){desknets.plant.subwin.dispPrintMenu(false);return}else{if(this.isPlantMSetCmd(e)){desknets.cal.updateCmds({PAGE_PLANT_INDEX:desknets.plant.PAGE_PLANTMSETWEEKGRP,PAGE_PLANT_REF:desknets.plant.PAGE_PLANTMSETREFERDTL,PAGE_PLANT_ADD:desknets.plant.PAGE_PLANTMSETADD,CMD_PLANT_REF:desknets.plant.CMD_PLANTMSETSCHREF,CMD_PLANT_DEL:desknets.plant.CMD_RSCHMSETDEL});if(e!=this.PAGE_PLANTMSETWEEKGRP&&e!=this.PAGE_PLANTMSETDAYGRP&&e!=this.PAGE_PLANTMSETWEEK&&e!=this.PAGE_PLANTMSETDAY&&e!=this.PAGE_PLANTMSETMONTH){desknets.plant.subwin.dispPrintMenu(false);return}desknets.pageframe.setFuncSel(this.PAGE_PLANTMSETWEEKGRP);b=true;d.profCmd=desknets.sch.CMD_PLANTINFO}}}desknets.sch.initSchRegistryEvent();desknets.hashobserver.init(desknets.plant);desknets.sch.util.init("plant");if(b){desknets.plant.plantmsetweekgrp.init(e);desknets.plant.subwinmset.init();desknets.tags.item.setUpFuncAfterAjax(c.changeMainContent)}else{desknets.plant.plantweekgrp.init(e);desknets.plant.subwin.init();desknets.tags.item.setUpFuncAfterAjax(c.changeMainContent)}desknets.plant.util.profile.init(d)},isPlantPSetCmd:function(b){if(b.substr(0,9)=="plantpset"){return true}else{return false}},isPlantMSetCmd:function(b){if(b.substr(0,9)=="plantmset"){return true}else{return false}},isPlantSetCmd:function(b){if(b.substr(0,8)=="plantset"){return true}else{return false}},changeMainContent:function(c,d){if(c.data("module")!="sch"){return true}var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(b.cmd)){b.cmd=""}if(!neo.isSet(b.sid)){b.sid=""}if(b.cmd==desknets.plant.PAGE_PLANTMSETREFERDTL||b.cmd==desknets.plant.PAGE_PLANTMSETMOD||b.cmd==desknets.plant.PAGE_PLANTREFERDTL||b.cmd==desknets.plant.PAGE_PLANTMOD){if(b.sid==a.trim(c.data("did"))){a(".jsch-entry-for-me").find(".co-select-menu-text").html(a(".tag-disp-options:first").find("a:first").html());a(".tag-disp-select").find(".co-select-menu-text").html(a(".tag-disp-options:first").find("a:first").html());a('input[name="tagcolor"]').val("0")}}return true}});desknets.plant.cmds={index:desknets.plant.PAGE_PLANTMSETWEEKGRP,cmdPrivate:desknets.plant.CMD_RPLANTPRIVATE,add:desknets.plant.PAGE_PLANTADD,addTarget:desknets.plant.PAGE_PLANTADDTARGET,ref:desknets.plant.PAGE_PLANTREFERDTL,cmdRef:desknets.cal.CMD_SCH_REF,mod:desknets.plant.PAGE_PLANTMOD,cmdModDate:desknets.sch.CMD_RSCHMODDATE,cmdDel:desknets.sch.CMD_RSCHDEL,cmdHoliday:desknets.plant.CMD_PLANTHOLIDAY};desknets.plant.msetCmds={index:desknets.plant.PAGE_PLANTMSETWEEKGRP,cmdPrivate:desknets.plant.CMD_RPLANTMSETPRIVATE,add:desknets.plant.PAGE_PLANTMSETADD,addTarget:desknets.plant.PAGE_PLANTMSETADDTARGET,ref:desknets.plant.PAGE_PLANTMSETREFERDTL,cmdRef:desknets.plant.CMD_PLANTMSETSCHREF,mod:desknets.plant.PAGE_PLANTMSETMOD,cmdModDate:desknets.sch.CMD_RSCHMSETMODDATE,cmdDel:desknets.sch.CMD_RSCHMSETDEL,cmdHoliday:desknets.plant.CMD_PLANTHOLIDAY};desknets.plant.util={paramsToBack:{},savePrevGroupCalendarPage:function(){var b=desknets.sch.util.pageID||a("#jco-pv-funcid").val();if(this.isRootPage(b)){this.paramsToBack=a.extend({cmd:b},desknets.sch.util.pageParams)}},goToSavedGroupCalendarPage:function(){desknets.paramanalyzer.setLocationHash(this.paramsToBack)},isRootPage:function(c){var d=c.replace(/mset/,"");var b=[desknets.plant.PAGE_PLANTWEEKGRP,desknets.plant.PAGE_PLANTDAYGRP];return a.inArray(d,b)>=0},isTopPage:function(c){var d=c.replace(/mset/,"");var b=[desknets.plant.PAGE_PLANTWEEKGRP,desknets.plant.PAGE_PLANTDAYGRP,desknets.plant.PAGE_PLANTWEEK,desknets.plant.PAGE_PLANTDAY,desknets.plant.PAGE_PLANTMONTH,desknets.plant.PAGE_PLANTFREE,desknets.plant.PAGE_PLANTWEEKSEL,desknets.plant.PAGE_PLANTDAYSEL];return a.inArray(d,b)>=0},isMonthPage:function(b){var c=b.replace(/mset/,"");return c==desknets.plant.PAGE_PLANTMONTH}};desknets.plant.util.calbox={_dispGroup:"0",init:function(b){this._initPGroup(b);this._initPlantFree(b)},shut:function(b){b.$mjPage.find("select[name=gid]").unbind("change")},changeGroup:function(c){var d=c.$mjPage.find(".jsch-cal-list");var b=c.getParamsForCalendar(c.getSchCalAreaCmd(),c.date);b.gid=desknets.sch.REQ_GIDSELECT;b.pid=desknets.sch.util.page.getIDs(d.find(".plant-chk").filter(":checked"));b.row=0;c._setLocationHash(b,false)},showOtherCalendar:function(f,d){var b=d.closest(".jsch-cal");var c=d.attr("href").substring(5);var e=f.getParamsForCalendar(c,f.date);f._filterTargetToParams(e,b);if(e.gid!=desknets.sch.REQ_GIDSELECT){this._dispGroup=f.$mjPage.find('select[name="gid"]').val();e.gid=this._dispGroup}e.pid=e.id;f._setLocationHash(e,false)},_initPGroup:function(e){var b;var c=this;b=e.$mjPage.find("select[name=gid]");var d=e.baseParams.gid;if(d){b.data(desknets.sch.util.plant.DATA_GROUPINIT,d)}desknets.sch.util.plant.setGroupSelect(jsonRestPGroup,desknets.Resource.sch.plantg_sel_allref,b);b.change(function(){e._changeGroup(a(this).find("option:selected").val())})},_initPlantFree:function(b){b.$mjPage.find(".plant-free-search").click(function(d){d.preventDefault();var c=a(this).attr("href");var e=String(c).match(/#.*cmd=(\w+)/);if(!!e&&e.length>1){var f={};var g=b.$mjPage.find(".jsch-cal-list");f.cmd=e[1];if(!!b.narrowSelectIds&&b.narrowSelectIds.plant){f.pid=b.narrowSelectIds.plant}else{f.pid=desknets.sch.util.calbox.getCheckedIDs(g,"plant")}f.date=neo.dateTime.format("yyyyMMdd",b.date);b._setLocationHash(f)}})},getMultiRequestAsArray:function(b){var c=[];if(!b._pageLoaded){c.push(b.getParamsForPage())}if(!window[b.preloadedMemberRestKey]){c.push(b.getParamsForMemberEvents())}if(b.isHolidayShown()&&!window[b.preloadedHolidayRestKey]){c.push(b.getParamsForHolidays())}return c},setMultiResponse:function(e,d,b){var c;if(!e._pageLoaded){e._loadPageWithJson(d[b.index.toString()]);if(!e._pageLoaded){return}b.index++}else{e.showCalendar()}c=e.getCalendarRest(d,b,e.preloadedMemberRestKey);if(e.isHolidayShown()){e.getHolidayItems(d,b)}if(!!c){e.updateMemberCalendar(c)}desknets.sch.util.showPage(e.getSchCalAreaCmd());e._printName=c.evgname;e.setCalendarPrint()},createPage:function(b){var c="jsch-"+b;if(a("#"+c).length<=0){var d=a('<div class="jco-page" />').attr("id",c);d.appendTo("#dn-main>.co-m-content")}return a("#"+c)}};desknets.plant.util.profile={_defOptions:{area:a("#dn-main"),module:desknets.MODULE_API_MAIN,profCmd:desknets.sch.CMD_PLANTINFO,profTemp:"plant/plantprofile.html",linkClass:"plant-ref-target-link",dialogId:"jplant-ref-dialog-",ldentClass:"jplant-ref-dialog"},_options:{},$_page:null,$_Tmpl:null,init:function(c){var b=this;b._options=a.extend({},b._defOptions,c);b.$_page=b._options.area;b._initPlantProfEvent(b.$_page)},_initPlantProfEvent:function(c){var b=this;c.delegate("."+b._options.linkClass,"click",function(e){e.preventDefault();var d=a(this).data("pid");if(neo.isSet(d,{blank:false})){b._openPlantProfDialog(d)}})},_openPlantProfDialog:function(e){var b=this;var c=a("#"+b._options.dialogId+e);if(c.length>0){c.dialog("open");return}else{if(!neo.isSet(b.$_Tmpl)||b.$_Tmpl.length==0){b.$_Tmpl=a("<div />");var d=function(){b._makePlantProf(e)};desknets.tmpl.load(b.$_Tmpl,b._options.profTemp,d);return}}b._makePlantProf(e)},_makePlantProf:function(i){var d=this;var g={};var c=d._options.dialogId+i;var h;d._deleteClosedPlantAll();var b=function(n){var j={};var l=a.extend(desknets.dialog.getDialogOption(),{dialogClass:"dn-dialog",width:600,title:desknets.Resource.plant.profTitle});var m={};m[desknets.Resource.CloseButtonLabel]=function(o){a(this).dialog("close")};l.buttons=m;h=a('<div class="'+d._options.ldentClass+'"/>').attr("id",c).appendTo(d.$_page);var k=a("<div />").html(d.$_Tmpl.html());n[0]["pid"]=i;k.find("#plant-pop-viewplant").tmpl(n[0]).appendTo(h);desknets.dialog.setUp(h,l);h.dialog("open");desknets.dialog.setFirstDialogOpen(h)};g["0"]={cmd:d._options.profCmd,id:i};var f=desknets.ajax.arrayToMultiCmdData(g);var e=desknets.getUrl(d._options.module);desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:e,data:f,success:function(k,j,l){if(k[0]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.dialog.alert(k[0]["errormessage"],{errorNo:k[0]["errorno"]})}else{b(k)}}})},_deleteClosedPlantAll:function(){a("."+this._options.ldentClass).each(function(){var b=a(this);if(!b.dialog("isOpen")){b.dialog("destroy").remove()}})}};desknets.plant.util.sel=a.extend({},desknets.sch.util.sel,{msprmname:"pid",mscookiename:desknets.storage.FIELD_PLANT_SEL,schpseldlg:a.extend({},desknets.sch.schpseldlg,{_DIALOG_ID:"jsch-plant-select-dialog-plantdaysel"}),narrowSelectIds:{},getViewTopMsgFromID:function(c){var b=this;var d="";if(b.mbomaxsel){d="plant_selectover"}b.mbomaxsel=false;return d},_initGroup:function(){var b=this;var d=b.$mjPage.find(".plant-cal-btnarea").find(".jco-sel-items");var c=b.$mjPage.find(".jsch-cal-checkbox");c.each(function(){d.append('<input type="hidden" name="pid" value="'+a(this).val()+'" />')});b.schpseldlg.setUp(b.$mjPage.find(".plant-cal-btnarea"),b._getSchPlantDlgOptions());b.schpseldlg.transPSelPlantFromCaller()},_getSchPlantDlgOptions:function(){var b=this;var c=function(f,d,e){b._onChangeSelectPlant()};return{guide_chk:desknets.Resource.sch.pselGuide_chk_sel,template:'<input type="hidden" name="pid" value="{{id}}" />',change:c}},_onChangeSelectPlant:function(){var c=this;var b=[];var d=c.$mjPage.find(".plant-cal-btnarea").find(".jco-sel-items").find('input[name="pid"]');d.each(function(){b[b.length]=a(this).val()});var e=c.getParamsForCalendar(c.getSchCalAreaCmd(),c.date);e.pid=b;e.gid="select";c.mbonotsetcookie=true;c._setLocationHash(e,false)},_initChoosenMenu:function(){var b=this;desknets.sch.util.calbox.initSelCheck(b.$mjPage,{add:function(c){var d=b.getParamsForAddSelected(c);if(!!d){b._setLocationHash(d,false)}},narrow:function(c,d){b.mbonotsetcookie=true;var e=b.getParamsForNarrowedCalendar(c);b._setLocationHash(e,false)}})},_resetSubWinMenu:function(){this.callBase("_resetSubWinMenu")},});desknets.plant.plantCal={getCalItemsFromJson:function(c){var b=!!c.slist?desknets.ajax.getItems(c.slist.item):[];return desknets.cal.item.getItemsFromPlant(b)},replaceItems:function(d,c){var b=!!d.slist?desknets.ajax.getItems(d.slist.item):[];var e=desknets.cal.item.getItemsFromPlant(b);this.replaceCalItems(e,c)},getModuleLen:function(){return 5},getModuleName:function(){return"plant"},isToDoShown:function(){return false},_resetSubWinMenu:function(){desknets.plant.subwin.dispPrintMenu(true)}};desknets.plant.singlePlantCal=a.extend({},desknets.plant.plantCal,{initParamsFromHash:function(b){desknets.plant.util.savePrevGroupCalendarPage();this.callBase("initParamsFromHash",b)},initCalendar:function(){this.callBase("initCalendar");this._initBackButton()},_initBackButton:function(){var b=this;b.$mjPage.find(".co-pageback").click(function(c){c.preventDefault();desknets.plant.util.goToSavedGroupCalendarPage()})}});desknets.plant.groupPlantCal=a.extend({},desknets.plant.plantCal,{cachePage:function(c){var b=this.callBase("cachePage",c);if(b){b=String(this.baseParams.pid)==String(c.pid)}return b},updatePageParams:function(b){this.callBase("updatePageParams",b);this.narrowIds=String(b.selkind)=="select"?b.pid:null},initMyCalendar:function(){},initGroupCalendar:function(){},destroyMyCalendar:function(){},destroyGroupCalendar:function(){},getParamsForPage:function(){var b=this.callBase("getParamsForPage");if(!!this.narrowIds){b.pid=this.narrowIds;b.id=[]}return b},getMultiRequestAsArray:function(){return desknets.plant.util.calbox.getMultiRequestAsArray(this)},getParamsForMemberEvents:function(){var b=this.callBase("getParamsForMemberEvents");if(!!this.narrowIds){b.pid=this.narrowIds;b.id=[]}return b},getParamsForNarrowedCalendar:function(c){var b=!!c.plant;return{cmd:this.getSchCalAreaCmd(),date:neo.dateTime.format("yyyyMMdd",this.date),selkind:b?"select":[],gid:this.baseParams.gid,pid:b?c.plant:[]}},getParamsForAddSelected:function(b){return{cmd:this.cmds.addTarget,date:neo.dateTime.format("yyyyMMdd",this.date),pid:!!b.plant?b.plant:[]}},setMultiResponse:function(c,b){desknets.plant.util.calbox.setMultiResponse(this,c,b)},replaceMyCalItems:function(b){},replaceGroupsCalItems:function(b){},_changeGroup:function(b){if(b==desknets.sch.REQ_GIDSELECT){desknets.plant.util.calbox.changeGroup(this)}else{this.callBase("_changeGroup",b)}},_getSaveParamNames:function(){return["gid","date","row","pid","selkind"]},_getBaseParams:function(b){var c={};if(neo.isSet(b.gid,{blank:false})){c.gid=b.gid}if(neo.isSet(b.pid,{blank:false})){c.pid=b.pid}return c},_showOtherCalendar:function(b){desknets.plant.util.calbox.showOtherCalendar(this,b)}});desknets.page(desknets.plant,"plantday",desknets.sch.schday,a.extend({},desknets.plant.singlePlantCal,{cmds:desknets.plant.cmds,getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTDAY},getPrintPageID:function(){return"plantprtday"},setSchCalTitle:function(){this._setTitle("&nbsp;&gt;&nbsp;"+desknets.Resource.plant.dayTitle)}}));desknets.page(desknets.plant,"plantweek",desknets.sch.schweek,a.extend({},desknets.plant.singlePlantCal,{cmds:desknets.plant.cmds,getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTWEEK},getCmdForCalendar:function(b,c){return desknets.plant.PAGE_PLANTDAY},getPrintPageID:function(){return"plantprtweek"},setSchCalTitle:function(){this._setTitle("&nbsp;&gt;&nbsp;"+desknets.Resource.plant.weekTitle)}}));desknets.page(desknets.plant,"plantmonth",desknets.sch.schmonth,a.extend({},desknets.plant.singlePlantCal,{cmds:desknets.plant.cmds,getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTMONTH},getSchYearCalCmd:function(){return desknets.plant.PAGE_PLANTYEARCAL},getCmdForCalendar:function(b,c){if(b=="week"){return desknets.plant.PAGE_PLANTWEEK}if(b=="day"){return desknets.plant.PAGE_PLANTDAY}return b},getPrintPageID:function(){return"plantprtmonth"},setSchCalTitle:function(){this._setTitle("&nbsp;&gt;&nbsp;"+desknets.Resource.plant.monthTitle)},getCalItemsFromJson:function(c){var b=!!c.slist?desknets.ajax.getItems(c.slist.item):[];return desknets.cal.item.getItemsFromPlant(b)}}));desknets.page(desknets.plant,"plantdaygrp",desknets.sch.schdaygrp,a.extend({},desknets.plant.groupPlantCal,{cmds:desknets.plant.cmds,getPrintPageID:function(){return"plantprtdaygroup"},initCalendar:function(){this.callBase("initCalendar");desknets.plant.util.calbox.init(this);if(a.isEmptyObject(this.memberCalendars)){this.$mjPage.find(".co-nodata").show();this.$mjPage.find(".sch-cal-group-day").hide()}else{this.$mjPage.find(".co-nodata").hide();this.$mjPage.find(".sch-cal-group-day").show()}},destroyCalendar:function(){this.callBase("destroyCalendar");desknets.plant.util.calbox.shut(this)},getParamCommandGroup:function(){return desknets.plant.CMD_RPLANTGROUP},getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTDAYGRP},_initChoosenMenuOpt:function(){var b=this;return{selected:b.narrowSelectIds,type:"plant"}},}));desknets.page(desknets.plant,"plantweekgrp",desknets.sch.schweekgrp,a.extend({},desknets.plant.groupPlantCal,{cmds:desknets.plant.cmds,_narrowingcal:null,getWeekGrpCalObj:function(b,c){return new desknets.cal.DateHorizontal(b,"plant",c)},initParamsFromHash:function(c){if(!this.$mjPage||this.$mjPage.length<=0){var b=this.getSchCalAreaCmd();this.$mjPage=a("#jsch-"+b).empty()}this.callBase("initParamsFromHash",c)},getPrintPageID:function(){return"plantprtweekgroup"},initCalendar:function(){this.callBase("initCalendar");desknets.plant.util.calbox.init(this);if(a.isEmptyObject(this.memberCalendars)){this.$mjPage.find(".co-nodata").show();this.$mjPage.find(".sch-cal-group-week").hide()}else{this.$mjPage.find(".co-nodata").hide();this.$mjPage.find(".sch-cal-group-week").show()}},destroyCalendar:function(){this.callBase("destroyCalendar");if(this._narrowingcal!=null){this._narrowingcal.destroy()}desknets.plant.util.calbox.shut(this)},getParamsForHolidays:function(){var b=this.callBase("getParamsForHolidays");b.cmd=desknets.sch.CMD_SCHHOLIDAY;return b},getParamCommandGroup:function(){return desknets.plant.CMD_RPLANTGROUP},getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTWEEKGRP},getCmdForCalendar:function(b){if(b=="day"){return desknets.plant.PAGE_PLANTDAYGRP}return b},_initChoosenMenuOpt:function(){var b=this;return{selected:b.narrowSelectIds,type:"plant"}},init:function(b){if(b){this._initStart(b)}else{this.callBase("init")}},funcHashObserver:function(){this._initStart()},_initStart:function(c){var d=desknets.paramanalyzer.getHashParams();var b=d.cmd;if(!c){c=this.getSchCalAreaCmd()}this._initBeforeUnload();if(!b){desknets.plant[c].init()}else{if(typeof desknets.plant[b]=="object"){desknets.sch.util.page.clearPreloadedData();desknets.plant[b].initParamsFromHash(d);desknets.plant[b].initReqSend()}}}}));desknets.page(desknets.plant,"plantdaysel",desknets.plant.plantdaygrp,a.extend({},desknets.plant.util.sel,{schpseldlg:a.extend({},desknets.sch.schpseldlg,{_DIALOG_ID:"jsch-plant-select-dialog-plantdaysel"}),getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTDAYSEL}}));desknets.page(desknets.plant,"plantweeksel",desknets.plant.plantweekgrp,a.extend({},desknets.plant.util.sel,{schpseldlg:a.extend({},desknets.sch.schpseldlg,{_DIALOG_ID:"jsch-plant-select-dialog-plantweeksel"}),getCmdForCalendar:function(b,c){if(b=="day"){return desknets.plant.PAGE_PLANTDAYSEL}return this.callBase("getCmdForCalendar",b)},getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTWEEKSEL}}));desknets.page(desknets.plant,"subwin",desknets.sch.subwin,{init:function(){this._initSchSWinHarhSet();this._initSearch();this._initSchSWinRegistryMenuEvent();desknets.sch.util.plant.setGroupSelect(jsonRestPGroup,desknets.Resource.sch.plantg_sel_allref,a("#subwinfrm").find("[name=splantgroup]"))},dispPrintMenu:function(b){if(b){a("#jplant-swin-print").show()}else{a("#jplant-swin-print").hide()}},_execClear:function(){this.callBase("_execClear");var b=a(".jco-subwindow-search");b.find('select[name="splantgroup"]').val("0")},_getSearchPrm:function(c){var b=this;c=b.callBase("_getSearchPrm",c);c.fldsort="date";c.order="1";c.row="0";return c},_getSearchCmd:function(){return desknets.plant.PAGE_PLANTSEARCH},_initSchSWinHarhSet:function(){this.callBase("_initSchSWinHarhSet");var b=a(".jco-subwindow-search");var c=desknets.paramanalyzer.getHashParams();b.find('input[name="entry"]').val(c.entry)},_initSchSWinRegistryMenuEvent:function(){var b=this;a(".jsch-swin-print").click(function(c){var f;c.preventDefault();var j=desknets.sch.util.getFuncID();b.boMonth=desknets.plant.util.isMonthPage(j);var d=a(this).attr("href");var e=a(this).attr("target");var g=b._getSchSWinDate();var i=desknets.sch.util.getCurrentPgae();var k=i.find(".plant-cal-target");if(k.length>0){d=d+"&pid="+k.data("pid")}else{var h=desknets.sch.util.page.getGid();d=d+"&gid="+h;if(h=="select"){i.find(".jplant-gcal-target").each(function(l){d=d+"&pid="+a(this).data("pid")})}}d=d+"&date="+g;desknets.execLocation(d,e);desknets.pageframe.closeSubWin()});b._initSchSWinRegistryMenuEventSelPage();b._initSchSWinRegistryMenuEventTargetSet()},_initSchSWinRegistryMenuEventSelPage:function(){var b=this;a(".jsch-swin-sel").click(function(d){d.preventDefault();if(neo.isSet(desknets.sch.util.pageParams.pid)){delete desknets.sch.util.pageParams.pid}var c=a(this).attr("href");var e=String(c).match(/#.*cmd=(\w+)/);if(!!e&&e.length>1){desknets.sch.util.goToPage(e[1])}desknets.pageframe.closeSubWin()})},_initSchSWinRegistryMenuEventTargetSet:function(){var c=this;var b=a("#dn-s-guide").find(".jplant-swin-target");desknets.clickAlinkExecEvent(b,function(h,e){var f=desknets.sch.util.getFuncID();var d=desknets.getDataAttr(h,"href");if(f==desknets.plant.PAGE_PLANTDAY||f==desknets.plant.PAGE_PLANTWEEK||f==desknets.plant.PAGE_PLANTMONTH){var g=desknets.sch.util.pageParams.id;if(!!g){d=d+"&id="+g}}h.attr("href",d)})}});desknets.page(desknets.plant,"plantfree",desknets.sch.schfree,{cmds:a.extend({},desknets.plant.cmds,{add:desknets.plant.PAGE_PLANTADDTARGET}),getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTFREE},getParamsForHolidays:function(){var b=this.callBase("getParamsForHolidays");b.cmd=desknets.sch.CMD_SCHHOLIDAY;return b},getModuleLen:function(){return 5},getModuleName:function(){return"plant"},_resetSubWinMenu:function(){desknets.plant.subwin.dispPrintMenu(false)}});desknets.page(desknets.plant,"plantsearch",desknets.PageListBatSearchBase,{_TMPL_Base:null,_TMPL_Base_NoLink:null,_boPlantSearchInit:true,_getListCmd:function(){return desknets.plant.PAGE_PLANTSEARCH},_getListExecCmd:function(){return desknets.plant.CMD_PLANTSEARCH},_getListDispCmd:function(){return desknets.plant.PAGE_PLANTREFERDTL},_getListModCmd:function(){return desknets.plant.PAGE_PLANTMOD},_getDelCmd:function(){return desknets.plant.CMD_PLANTSEARCHDELCONF},_getDelExecCmd:function(){return desknets.plant.CMD_PLANTSEARCHDEL},_getStopBatSearchCmd:function(){return desknets.plant.CMD_PLANTSEARCHSTOP},_getListDispClass:function(){return desknets.plant.plantreferdtl},_getListModClass:function(){return desknets.plant.plantmod},initParamsFromHash:function(c){var b=a("#"+this._getIdListPage());this.initPage(desknets.sch.util.getBackPage(),desknets.sch.util.getBackId());this.callBase("initParamsFromHash",c);this._resetSubWinMenu()},_setDelConfirm:function(b){b=b.replace(/\n/g,"<br />");this.callBase("_setDelConfirm",b)},getLocationFormParam:function(){desknets.sch.util.goToPage()},_getListAjaxSuccessData:function(b){this._setSchSearchTitle(b);return desknets.cal.tmplList.getJsonItems(b)},_listLine:function(c,d){var f=d.entry;var e=String(d.sid).split("_");if(d.accessopen!=desknets.sch.VAL_SCHACCESSENABLE){f="";if(this._TMPL_Base_NoLink==null){this._TMPL_Base_NoLink=desknets.tmpl.replaceWordHtml(c,"subject",desknets.sch.schsearch.TMPL_NoLink)}c=this._TMPL_Base_NoLink}else{if(this._TMPL_Base==null){this._TMPL_Base=desknets.tmpl.replaceWordHtml(c,"subject",desknets.sch.schsearch.TMPL_Link)}c=this._TMPL_Base}var b=desknets.cal.tmplList.getRowHtml(c,d);b=desknets.tmpl.replaceWord(b,"entry",f);b=desknets.tmpl.replaceWord(b,"Name",d.Name);b=desknets.tmpl.replaceWordHtml(b,"cmd",this._getListDispCmd());b=desknets.tmpl.replaceWordHtml(b,"id",e[0]);b=desknets.tmpl.replaceWordHtml(b,"seldate",e[2]||"");return b},inputModPage:function(e){var b=this;var d="";var c={};d=b._getListModCmd();c=b._getModPageParam();c.cmd=d;c.seldate=desknets.cal.tmplList.getSelDate(e,this._isSchSearchGetSelDate());c[b._getIDName()]=desknets.cal.tmplList.getId(e);desknets.sch.util.setBackPage(this._getListCmd(),this._getIdListPage());b._inputPage(c)},inputDispPage:function(e){var b=this;var d="";var c={};d=b._getListDispCmd();c=b._getDispPageParam();c.cmd=d;c.seldate=desknets.cal.tmplList.getSelDate(e,this._isSchSearchGetSelDate());c[b._getIDName()]=desknets.cal.tmplList.getId(e);desknets.sch.util.setBackPage(this._getListCmd(),this._getIdListPage());b._inputPage(c)},_getIDName:function(){return"sid"},_setTitle:function(b){},_openSearchMessageDialog:function(){if(!neo.isSet(this.$dialogexec)){this._boPlantSearchInit=true}this.callBase("_openSearchMessageDialog")},_setSchSearchTitle:function(c){var b=this._getAreaTitle(this.$mjListPage);a("#jco-m-sub-title").html(b+c.title);if(this._boPlantSearchInit&&neo.isSet(c[desknets.RES_TAG_MSGGETLIMIT])){this._boPlantSearchInit=false;desknets.pageframe.viewTopMsg(c[desknets.RES_TAG_MSGGETLIMIT],"info")}},_resetSubWinMenu:function(){desknets.plant.subwin.dispPrintMenu(false)},_isSchSearchGetSelDate:function(){return false}});desknets.page(desknets.plant,"plantadd",desknets.sch.schadd,{isCost:function(){return false},getLocationFormParam:function(){var b=this.callBase("getLocationFormParam");if(!b||desknets.plant.util.isTopPage(b.cmd)){b={cmd:desknets.sch.util.pageID};a.extend(b,desknets.sch.util.pageParams)}return b}});desknets.page(desknets.plant,"plantaddtarget",desknets.sch.schaddtarget,{isCost:function(){return false},getLocationFormParam:function(){var b=this.callBase("getLocationFormParam");if(!b||desknets.plant.util.isTopPage(b.cmd)){b={cmd:desknets.sch.util.pageID};a.extend(b,desknets.sch.util.pageParams)}return b}});desknets.page(desknets.plant,"plantmod",desknets.sch.schmod,{_getDispCmd:function(){return"plantreferdtl"},isCost:function(){return false},getLocationFormParam:function(){var b=this.callBase("getLocationFormParam");if(!b||desknets.plant.util.isTopPage(b.cmd)){b={cmd:desknets.sch.util.pageID};a.extend(b,desknets.sch.util.pageParams)}return b}});desknets.page(desknets.plant,"plantreferdtl",desknets.sch.schreferdtl,{isCost:function(){return false},_initHtmlTmplSet:function(c){var b=this;if(!!c[0].connectmailuse){delete c[0].connectmailuse}b.callBase("_initHtmlTmplSet",c)},_getDispModCmd:function(){return desknets.plant.PAGE_PLANTMOD},_isSchRefTopPage:function(b){return desknets.plant.util.isTopPage(b)},_getSchRefAddCmd:function(){return desknets.plant.PAGE_PLANTADD}});desknets.page(desknets.plant,"subwinpset",desknets.plant.subwin,{_initSchSWinRegistryMenuEventSelPage:function(){},_getMainCmd:function(){return desknets.plant.PAGE_PLANTWEEKGRP}});desknets.page(desknets.plant,"subwinmset",desknets.plant.subwin,{_initSchSWinRegistryMenuEventSelPage:function(){var b=a("#jco-pv-funcid").val();if(b==desknets.plant.PAGE_PLANTMSETWEEKGRP){this.callBase("_initSchSWinRegistryMenuEventSelPage")}},_getMainCmd:function(){return desknets.plant.PAGE_PLANTMSETWEEKGRP},_getSearchCmd:function(){return desknets.plant.PAGE_PLANTMSETSEARCH}});desknets.page(desknets.plant,"plantmsetday",desknets.plant.plantday,{cmds:desknets.plant.msetCmds,getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTMSETDAY},getCmdForCalendar:function(b){if(b=="week"){return desknets.plant.PAGE_PLANTMSETWEEK}if(b=="day"){return desknets.plant.PAGE_PLANTMSETDAY}return b},getPrintPageID:function(){return"plantmsetprtday"}});desknets.page(desknets.plant,"plantmsetweek",desknets.plant.plantweek,{cmds:desknets.plant.msetCmds,setSchCalTitle:function(){this._setTitle("&nbsp;&gt;&nbsp;"+desknets.Resource.plant.weekTitle)},getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTMSETWEEK},getCmdForCalendar:function(b){if(b=="week"){return desknets.plant.PAGE_PLANTMSETWEEK}if(b=="day"){return desknets.plant.PAGE_PLANTMSETDAY}return b},getPrintPageID:function(){return"plantmsetprtweek"}});desknets.page(desknets.plant,"plantmsetmonth",desknets.plant.plantmonth,{cmds:desknets.plant.msetCmds,setSchCalTitle:function(){this._setTitle("&nbsp;&gt;&nbsp;"+desknets.Resource.plant.monthTitle)},getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTMSETMONTH},getCmdForCalendar:function(b){if(b=="week"){return desknets.plant.PAGE_PLANTMSETWEEK}if(b=="day"){return desknets.plant.PAGE_PLANTMSETDAY}return b},getPrintPageID:function(){return"plantmsetprtmonth"}});desknets.page(desknets.plant,"plantmsetdaygrp",desknets.plant.plantdaygrp,{cmds:desknets.plant.msetCmds,getPrintPageID:function(){return"plantmsetprtdaygroup"},getParamCommandGroup:function(){return desknets.plant.CMD_RPLANTMSETGROUP},getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTMSETDAYGRP}});desknets.page(desknets.plant,"plantmsetweekgrp",desknets.plant.plantweekgrp,{cmds:desknets.plant.msetCmds,getCmdForCalendar:function(b){if(b=="day"){return desknets.plant.PAGE_PLANTMSETDAYGRP}return b},getParamCommandGroup:function(){return desknets.plant.CMD_RPLANTMSETGROUP},getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTMSETWEEKGRP},getPrintPageID:function(){return"plantmsetprtweekgroup"}});desknets.page(desknets.plant,"plantmsetdaysel",desknets.plant.plantdaysel,{cmds:desknets.plant.msetCmds,getParamCommandGroup:function(){return desknets.plant.CMD_RPLANTMSETGROUP},_getSchPlantDlgOptions:function(){var b=this;var c={};c=b.callBase("_getSchPlantDlgOptions");c.cmd=desknets.plant.CMD_PLANTMSETSELPLANT;c.cmdgrp=desknets.plant.CMD_PLANTMSETSELPGROUP;return c},getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTMSETDAYSEL}});desknets.page(desknets.plant,"plantmsetweeksel",desknets.plant.plantweeksel,{cmds:desknets.plant.msetCmds,getCmdForCalendar:function(b){if(b=="day"){return desknets.plant.PAGE_PLANTMSETDAYSEL}return b},getParamCommandGroup:function(){return desknets.plant.CMD_RPLANTMSETGROUP},_getSchPlantDlgOptions:function(){var b=this;var c={};c=b.callBase("_getSchPlantDlgOptions");c.cmd=desknets.plant.CMD_PLANTMSETSELPLANT;c.cmdgrp=desknets.plant.CMD_PLANTMSETSELPGROUP;return c},getCmdForCalendar:function(b,c){if(b=="day"){return desknets.plant.PAGE_PLANTMSETDAYSEL}return this.callBase("getCmdForCalendar",b)},getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTMSETWEEKSEL}});desknets.page(desknets.plant,"plantmsetfree",desknets.plant.plantfree,{cmds:a.extend({},desknets.plant.cmds,{add:desknets.plant.PAGE_PLANTMSETADDTARGET}),getSchCalAreaCmd:function(){return desknets.plant.PAGE_PLANTMSETFREE},getParamCommandAdd:function(){return desknets.plant.PAGE_PLANTMSETADDTARGET},getParamCommandPrivate:function(){return desknets.plant.CMD_PLANTMSETSCHFREE},_getSchPlantDlgOptions:function(){return{cmd:desknets.plant.CMD_PLANTMSETSELPLANT,cmdgrp:desknets.plant.CMD_PLANTMSETSELPGROUP}},getSchCalFreePlantInfo:function(){return desknets.sch.CMD_PLANTMSETINFO},getSchFreeCheckAddCmd:function(){return desknets.plant.CMD_PLANTMSETFREECHECKENTRY}});desknets.page(desknets.plant,"plantmsetsearch",desknets.plant.plantsearch,{_getListCmd:function(){return desknets.plant.PAGE_PLANTMSETSEARCH},_getListExecCmd:function(){return desknets.plant.CMD_PLANTMSETSEARCH},_getListDispCmd:function(){return desknets.plant.PAGE_PLANTMSETREFERDTL},_getListModCmd:function(){return desknets.plant.PAGE_PLANTMSETMOD},_getDelCmd:function(){return desknets.plant.CMD_PLANTMSETSEARCHDELCONF},_getDelExecCmd:function(){return desknets.plant.CMD_PLANTMSETSEARCHDEL},_getListDispClass:function(){return desknets.plant.plantmsetreferdtl},_getListModClass:function(){return desknets.plant.plantmsetmod}});desknets.page(desknets.plant,"plantmsetadd",desknets.plant.plantadd,{getPrivilege:function(){return"mset"}});desknets.page(desknets.plant,"plantmsetaddtarget",desknets.plant.plantaddtarget,{getPrivilege:function(){return"mset"}});desknets.page(desknets.plant,"plantmsetmod",desknets.plant.plantmod,{_getDelExecCmd:function(){return desknets.sch.CMD_RSCHMSETDEL},getPrivilege:function(){return"mset"}});desknets.page(desknets.plant,"plantmsetreferdtl",desknets.plant.plantreferdtl,{_getDispExecCmd:function(){return desknets.plant.CMD_PLANTMSETSCHREF},_getDispModCmd:function(){return desknets.plant.PAGE_PLANTMSETMOD},_getDelExecCmd:function(){return desknets.sch.CMD_RSCHMSETDEL},_getSchRefAddCmd:function(){return desknets.plant.PAGE_PLANTMSETADD}});app.addInitialAction(function(){desknets.plant.init()})})(jQuery);