/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.memoutil={_tmplManu:'<span title="{{title}}">{{value}}</span>',_tmplAuto:'<div title="{{title}}" class="memo-sch">{{value}}</div>',_tmplAutoEvent:'<div title="{{title}}" class="memo-sch">{{icon}}{{value}}</div>',_editArray:["event","place","date","memo"],_tmplOpts:{sameDateDisp:false,dateTimeDisp:true},_$dialog:null,_otherto:null,_DIALOG_ID:"memo-entry-dialog",PAGE_MEMOENTRY:"memoentrytarget",CMD_MEMOENTRY:"memocmdentry",getWhereContactClass:function(d){var b="memo-tel-other";var c={"1":"memo-tel-company","2":"memo-tel-naisen","3":"memo-tel-phone"};if(neo.isSet(d)&&neo.isSet(c[d])){b=c[d]}return b},editWhereListLine:function(d,i,b){var j=this;var g;if(!!b){g=b}else{g=j._editArray}i.contactClass=j.getWhereContactClass(i.contactflg);if(neo.isSet(i.allcnt)){if(i.allcnt!="0"){var e=desknets.ajax.getItems(i.list.item);a.each(e,function(l,m){a.each(g,function(n,o){if(o=="event"){i[o]=j._replaceWhereSchEvent(i[o],m)}else{if(o=="place"){i[o]=j._replaceWhereSchPlace(i[o],m)}else{if(o=="date"){i[o]=j._replaceWhereSchDate(i[o],m)}else{if(o=="memo"){i[o]=j._replaceWhereSchMemo(i[o],m)}}}}})});var c=Number(i.allcnt)-e.length;if(c>0){var k=desknets.tmpl.replaceWordChk(desknets.Resource.Message.com_memo_where_schmore,"morecnt",c);var h=desknets.tmpl.replaceWordChk(j._tmplAuto,"title",k);h=desknets.tmpl.replaceWordChk(h,"value",k);var f=desknets.tmpl.replaceWordChk(j._tmplAuto,"title","");f=desknets.tmpl.replaceWordChkHtml(f,"value","&nbsp;");a.each(g,function(l,m){if(l==0){i[m]=i[m]+h}else{i[m]=i[m]+f}})}delete i.list}else{a.each(g,function(l,m){i[m]="&nbsp;"})}}else{if(neo.isSet(i.where,{blank:false})){i.place="["+i.where+"]"+i.place}a.each(g,function(m,n){var l=j._tmplManu;l=desknets.tmpl.replaceWordChk(l,"title",i[n]);l=desknets.tmpl.replaceWordChk(l,"value",i[n]);i[n]=l})}return i},setWhereListStyle:function(c){if(desknets.browser.msie8&&!!c){var b=0;var d=c.find("tr");a.each(d,function(e,g){var f=a(this).find("td").eq(2).find(".memo-sch");if(neo.isSet(f)&&f.length>2){f.eq(2).addClass("memo-sch-more")}b=e});d.eq(b).addClass("memo-list-lasttr")}},entryDialogInit:function(c,b,d){if(!!d){this._DIALOG_ID=d}this.entryDialogDestroy();this._otherto={id:c,name:b};this._sendSchMemoAjaxGetHtml()},entryDialogDestroy:function(){if(this._$dialog){desknets.dialog.deleteById(this._DIALOG_ID);this._$dialog=null}},_replaceWhereSchEvent:function(c,e){var b=this;var f="";var g=b._tmplAutoEvent;var d=desknets.cal.getSubject(e.event,e.detail);if(!neo.isSet(c)){c=""}f=desknets.cal.tmpl.getIconsAsText(e)+d;g=desknets.tmpl.replaceWordChk(g,"title",f);g=desknets.tmpl.replaceWordChk(g,"value",d.length>0?d:" ");g=desknets.tmpl.replaceWordChkHtml(g,"icon",desknets.cal.tmpl.getIconsAsHtml(e));return c+g},_replaceWhereSchPlace:function(d,e){var c=this;var f=c._tmplAuto;var b=desknets.cal.getSubject(e.place,e.other);if(!neo.isSet(d)){d=""}f=desknets.tmpl.replaceWordChk(f,"title",b);f=desknets.tmpl.replaceWordChk(f,"value",b.length>0?b:" ");return d+f},_replaceWhereSchDate:function(d,e){var b=this;var f=b._tmplAuto;var c=desknets.cal.tmplList.getRowHtml("{{date}}",e,b._tmplOpts);if(!neo.isSet(d)){d=""}f=desknets.tmpl.replaceWordChkHtml(f,"title",c);f=desknets.tmpl.replaceWordChkHtml(f,"value",c.length>0?c:"&nbsp;");return d+f},_replaceWhereSchMemo:function(d,e){var c=this;var f=c._tmplAuto;var b=e.memo;if(!neo.isSet(d)){d=""}f=desknets.tmpl.replaceWordChk(f,"title",neo.isSet(b)?b:"");f=desknets.tmpl.replaceWordChk(f,"value",neo.isSet(b,{blank:false})?b:" ");return d+f},_sendSchMemoAjaxGetHtml:function(){var b=this;var c=desknets.getUrl(desknets.MODULE_API_MAIN);var d=desknets.ajax.arrayToMultiCmdData(this._getSchMemoAjaxParamGetHtml());desknets.ajax.rest({id:this._DIALOG_ID,url:c,data:d,type:"POST",success:function(f,e,g){b._onSuccessSchMemoGetHtml(f)},error:function(g,f,e){if(f!="abort"){desknets.ajax.onError(g.status,e)}}})},_getSchMemoAjaxParamGetHtml:function(){var c;var b={};var d=0;c={};c.cmd=this.PAGE_MEMOENTRY;c.uid=this._otherto.id;b[d]=c;d++;return b},_onSuccessSchMemoGetHtml:function(c){var b=0;var d;d=this._setSchMemoDlgHtml(c[b]);if(!d){return}b++;this._$dialog.dialog("open");var e=this._$dialog.find(".jco-input-whom");desknets.watermark.set(e);e.removeAttr("title");e.blur()},_setSchMemoDlgHtml:function(e){var d=e.html;if(!neo.isSet(d)){return false}var c=a(d).find(".co-mainarea").find(".co-etable");var b=a("<form></form>").append(c);b.find(".jsch-memo-dlg-target").text(this._otherto.name);this._$dialog=desknets.dialog.make(this._DIALOG_ID,this._getDialogOption());this._$dialog.append(b);desknets.comMemo.setTagColorVal(this._$dialog);return true},_getDialogOption:function(){var b=this;var e={};e[desknets.Resource.OKButtonLabel]=function(){desknets.submitform.setDialogDisabled(b._$dialog);b._sendSchMemoAjaxAddMemo()};e[desknets.Resource.CancelButtonLabel]=function(){b._$dialog.dialog("close")};var d=desknets.dialog.getDialogOption();var c={title:desknets.Resource.Message.com_memo_dialogtitle,width:600,buttons:e,close:function(){neo.ajax.abort(b._DIALOG_ID,true)}};a.extend(d,c);return d},_sendSchMemoAjaxAddMemo:function(){var b=this;var c=desknets.getUrl(desknets.MODULE_API_MAIN);var d=this._getSchMemoAjaxParamAddMemo();desknets.ajax.rest({id:this._DIALOG_ID,url:c,data:d,type:"POST",success:function(f,e,g){b._$dialog.dialog("close");desknets.submitform.clearDialogDisabled(b._$dialog)},error:function(g,f,e){if(f!="abort"){desknets.ajax.onError(g.status,e);desknets.submitform.clearDialogDisabled(b._$dialog)}},errorconvmsg:function(e,f){var g=desknets.getErrField(e,f);g.fieldname=desknets.getErrFieName(b._$dialog,g.fieldid);return desknets.getErrConvMsg(g)}})},_getSchMemoAjaxParamAddMemo:function(){var b;b={};b.cmd=this.CMD_MEMOENTRY;b.otherto=this._otherto.id;form=this._$dialog.find("form").formToArrayEx();a.extend(b,form);if(!b.tag){b.tag=desknets.comMemo.VAL_MEMO_TAGOFF}return b}};desknets.sch={CMD_RSCHPRIVATE:"schprivate",CMD_RSCHDEL:"schdel",CMD_RSCHMODTAG:"schmodtag",CMD_RSCHMODAPPROV:"schmodapprov",CMD_SCHHOLIDAY:"schholidaylist",CMD_SCHFILTARGET:"schfiltarget",CMD_SCHMODDISPATTACH:"schmoddispattach",CMD_SCHHOLDONENTRY:"schcmdholdonentry",CMD_SCHSEARCH:"schcmdsearch",CMD_PLANTSELPLANT:"plantselplant",CMD_PLANTSELPGROUP:"plantselpgroup",PAGE_SCHYEARCAL:"schyearcalhtml",VAL_SCHDELSELF:"1",VAL_SCHDELALL:"2",VAL_SCHACCESSENABLE:"1",REPEAT_WEEK:"w",REPEAT_MONTH:"m",banpei:null};a.extend(desknets.sch,{CMD_RSCHGROUP:"schgrp",CMD_RSCHPRIVATEGROUP:"schprivategroup",CMD_RSCHPRIVATEDTL:"schprivatedetail",CMD_RSCHCALENDAR:"schcalendar",CMD_RSCHMODDATE:"schcmddateentry",CMD_RSCHMODALARM:"schmodalarm",CMD_RSCHATTDEL:"schattachdel",CMD_RSCHATTLIST:"schattachlist",CMD_SCHCPCABATTACH:"schcpcabattach",CMD_SCHFREE:"schcmdfree",CMD_SCHSEARCHDEL:"schcmdsearchdel",CMD_SCHSEARCHDELCONF:"schcmdsearchdelconf",CMD_SCHLIST:"schcmdlist",CMD_SCHLISTDEL:"schcmdlistdel",CMD_SCHLISTDELCONF:"schcmdlistdelconf",CMD_SCHICONS:"schicons",CMD_SCHADDATTACH:"schaddattach",CMD_SCHMODATTACH:"schmodattach",CMD_SCHADDATTACHDEL:"schaddattachdel",CMD_SCHMODATTACHDEL:"schmodattachdel",CMD_SCHADDDISPATTACH:"schadddispattach",CMD_PLANTINFO:"plantinfo",CMD_SCHFREECHECKENTRY:"schcmdfreecheck",CMD_SCHCONNECTAPP:"schcmdconnectapp",CMD_RSCHMSETGROUP:"schmsetgrp",CMD_RSCHMSETPRIVATE:"schmsetprivate",CMD_RSCHMSETPRIVATEGROUP:"schmsetprivategroup",CMD_RSCHMSETPRIVATEDTL:"schmsetprivatedetail",CMD_RSCHMSETREFER:"schmsetref",CMD_RSCHMSETMODDATE:"schmsetcmddateentry",CMD_RSCHMSETDEL:"schmsetdel",CMD_SCHMSETCPCABATTACH:"schmsetcpcabattach",CMD_SCHMSETFILTARGET:"schmsetfiltarget",CMD_SCHMSETCONNECTAPP:"schmsetcmdconnectapp",CMD_PLANTMSETINFO:"plantmsetinfo",PAGE_SCHINDEX:"schindex",PAGE_SCHWEEK:"schweek",PAGE_SCHDAY:"schday",PAGE_SCHMONTH:"schmonth",PAGE_SCHGWEEK:"schweekgrp",PAGE_SCHGDAY:"schdaygrp",PAGE_SCHDAYSEL:"schdaysel",PAGE_SCHWEEKSEL:"schweeksel",PAGE_SCHFREE:"schfree",PAGE_SCHSEARCH:"schsearch",PAGE_SCHLISTWEEK:"schlistweek",PAGE_SCHLISTMONTH:"schlistmonth",PAGE_RSCHCALHTML:"schcalhtml",PAGE_SCHADD:"schadd",PAGE_SCHMOD:"schmod",PAGE_SCHADDTARGET:"schaddtarget",PAGE_SCHMSETINDEX:"schmsetindex",PAGE_SCHMSETWEEK:"schmsetweek",PAGE_SCHMSETDAY:"schmsetday",PAGE_SCHMSETMONTH:"schmsetmonth",PAGE_SCHMSETGWEEK:"schmsetweekgrp",PAGE_SCHMSETGDAY:"schmsetdaygrp",PAGE_SCHMSETADD:"schmsetadd",PAGE_SCHMSETMOD:"schmsetmod",PAGE_SCHMSETREFERDTL:"schmsetreferdtl",PAGE_SCHMSETADDTARGET:"schmsetaddtarget",PAGE_SCHPSELDLG:"schpseldlg",PAGE_SCHPOPUPPLANT:"schpopupplant",PAGE_SCHPOPUPSCH:"schpopupsch",REQ_GIDSELECT:"select",WH_TIME_LINE:21,DELAY_MOUSEOVER:500,DATA_NAME:"name",DATA_ASSIGNGROUP:"assigngroup",DATA_TARGET:"target",MAX_WEEKROW:6,HEIGHT_TITLE:24,ACCESS_OPEN:1,ACCESS_MOD:4,ACCESS_ADD:2,ACCESS_DEL:8,ACCESS_ADD_ALLOW:"1",SCHHOLIDAYFLG_ON:"1",PLANT_HOLIDAY_NONUSE:"0",PLANT_HOLIDAY_USE:"1",PLANT_RESERVSCHLIMIT:"1",WEEKHOLIDAY_DAYOFF:"1",PROC_WEEK:"w",PROC_MONTH:"m",module:"sch",MAX_SCHSELECTLIST:100,init:function(){var c=this;var b=false;var d=a("#jco-pv-funcid").val();if(this.isLoadOnly(d)){return}if(this.isSchSetCmd(d)||this.isSchPSetCmd(d)){return}else{if(this.isSchMSetCmd(d)){desknets.cal.updateCmds({PAGE_SCH_INDEX:desknets.sch.PAGE_SCHMSETINDEX,PAGE_SCH_REF:desknets.sch.PAGE_SCHMSETREFERDTL,PAGE_SCH_ADD:desknets.sch.PAGE_SCHMSETADD,CMD_SCH_REF:desknets.sch.CMD_RSCHMSETREFER,CMD_SCH_DEL:desknets.sch.CMD_RSCHMSETDEL});if(d!=this.PAGE_SCHMSETWEEK&&d!=this.PAGE_SCHMSETDAY&&d!=this.PAGE_SCHMSETMONTH&&d!=this.PAGE_SCHMSETGWEEK&&d!=this.PAGE_SCHMSETGDAY){return}desknets.pageframe.setFuncSel(this.PAGE_SCHMSETINDEX);b=true}}this.initSchRegistryEvent();desknets.hashobserver.init(desknets.sch);desknets.sch.util.init("sch");if(b){desknets.sch.schmsetindex.init(d);desknets.sch.subwinset.init();desknets.tags.item.setUpFuncAfterAjax(c.changeMainContent)}else{desknets.sch.schindex.init(d);desknets.sch.subwin.init();desknets.tags.item.setUpFuncAfterAjax(c.changeMainContent)}if(desknets.pageframe.isCost()){a("#sch-cost-list-open").find("a").click(function(e){e.preventDefault();desknets.popUp.hide(a(this));desknets.cost.list.open()})}else{a("#jsch-cost-setting-link").hide()}},initSchRegistryEvent:function(){var b=this;a("#co-m-h-tabs").find("a").click(function(d){d.preventDefault();var c=a(this).attr("href");var e=String(c).match(/#.*cmd=(\w+)/);if(!!e&&e.length>1){desknets.sch.util.goToPage(e[1])}})},isSchPSetCmd:function(b){if(b.substr(0,7)=="schpset"){return true}else{return false}},isSchMSetCmd:function(b){if(b.substr(0,7)=="schmset"){return true}else{return false}},isSchSetCmd:function(b){if(b.substr(0,6)=="schset"){return true}else{return false}},isLoadOnly:function(b){if(b.indexOf("agenda")==0||b.indexOf("plant")==0){return true}},changeMainContent:function(c,d){if(c.data("module")!="sch"){return true}var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(b.cmd)){b.cmd=""}if(!neo.isSet(b.sid)){b.sid=""}if(b.cmd==desknets.sch.PAGE_SCHMSETREFERDTL||b.cmd==desknets.sch.PAGE_SCHMSETMOD||b.cmd==desknets.cal.PAGE_SCH_REF||b.cmd==desknets.sch.PAGE_SCHMOD){if(b.sid==a.trim(c.data("did"))){a(".jsch-entry-for-me").find(".co-select-menu-text").html(a(".tag-disp-options:first").find("a:first").html());a(".tag-disp-select").find(".co-select-menu-text").html(a(".tag-disp-options:first").find("a:first").html());a('input[name="tagcolor"]').val("0")}}return true},delGrpListAllCheckOptionSelect:function(){var b=this;b.delGrpListCheckOptionSelect(desknets.sch.schdaygrp.narrowSelectIds);b.delGrpListCheckOptionSelect(desknets.sch.schweekgrp.narrowSelectIds)},delGrpListCheckOptionSelect:function(b){for(key in b){b[key]=[]}},});desknets.sch.cmds={index:desknets.sch.PAGE_SCHINDEX,cmdPrivate:desknets.sch.CMD_RSCHPRIVATE,add:desknets.sch.PAGE_SCHADD,addTarget:desknets.sch.PAGE_SCHADDTARGET,ref:desknets.cal.PAGE_SCH_REF,cmdRef:desknets.cal.CMD_SCH_REF,mod:desknets.sch.PAGE_SCHMOD,cmdModDate:desknets.sch.CMD_RSCHMODDATE,cmdDel:desknets.sch.CMD_RSCHDEL,cmdHoliday:desknets.sch.CMD_SCHHOLIDAY};desknets.sch.msetCmds={index:desknets.sch.PAGE_SCHMSETINDEX,cmdPrivate:desknets.sch.CMD_RSCHMSETPRIVATE,add:desknets.sch.PAGE_SCHMSETADD,addTarget:desknets.sch.PAGE_SCHMSETADDTARGET,ref:desknets.sch.PAGE_SCHMSETREFERDTL,cmdRef:desknets.sch.CMD_RSCHMSETREFER,mod:desknets.sch.PAGE_SCHMSETMOD,cmdModDate:desknets.sch.CMD_RSCHMSETMODDATE,cmdDel:desknets.sch.CMD_RSCHMSETDEL,cmdHoliday:desknets.sch.CMD_SCHHOLIDAY};(function(b){desknets.page(desknets.sch,"schbase",desknets.PageBase,{setConnecting:function(c){if(c&&desknets.sch.util.isConnecting()){return false}desknets.sch.util.setConnecting(c);return true},_getBaseHashCmd:function(){return desknets.sch.PAGE_SCHINDEX}})})(jQuery);desknets.page(desknets.sch,"schindex",desknets.sch.schbase,{init:function(c){if(!!location.hash){var b=this.getStartPage();a("#jsch-"+b).remove()}this._initStart(c)},funcHashObserver:function(){this._initStart()},getStartPage:function(){return desknets.sch.util.getSettings().toppage},_initStart:function(c){var d=desknets.paramanalyzer.getHashParams();var b=d.cmd;if(!c){c=this.getStartPage()}this._initBeforeUnload();if(!b){desknets.sch[c].init()}else{if(typeof desknets.sch[b]=="object"){desknets.sch.util.page.clearPreloadedData();desknets.sch[b].initParamsFromHash(d);desknets.sch[b].initReqSend()}}}});desknets.sch.util={};a.extend(desknets.sch.util,{pageID:null,pageParams:{},_shownPageID:null,_defaultStatus:{},boConnecting:false,funcID:null,_backPage:null,_backId:null,init:function(b){this._initSettings(b,window.jsonRestSchPSet);this._defaultStatus.id=desknets.pageframe.getLoginUid();this._defaultStatus.gid=""},goToPage:function(b){var c={cmd:(b||this.pageID)};a.extend(c,this.pageParams);desknets.paramanalyzer.setLocationHash(c)},navigateToPage:function(b,e){var f=a.extend({autoCreate:true},e);var c="jsch-"+b;if(f.autoCreate&&a("#"+c).length<=0){var d=a('<div class="jco-page" />').attr("id",c);d.appendTo("#dn-main>.co-m-content");if(!!f.created){f.created(d)}}desknets.sch.util.page.toggleTitleTab(b);this.pageID=b},showPage:function(b){var c=a("#jsch-"+b);c.siblings().hide();c.show();this._shownPageID=b},isCurrentPage:function(b){var c=a("#jsch-"+b);return this.pageID==b&&c.is(":visible")},savePageParams:function(c,d){var b=this,e={};a.each(c,function(g,f){if(typeof d[f]!="undefined"){e[f]=d[f]}});b.pageParams=e},getCurrentPgae:function(){var b=a("#jsch-"+this.pageID);return b},getSettings:function(){return desknets.cal.settings.of(desknets.sch.module)},isConnecting:function(){return this.boConnecting},setConnecting:function(b){this.boConnecting=b},getFuncID:function(){return this.pageID},_initSettings:function(e,d){var b=this;var f=desknets.cal.settings.of(e);for(var c in d){f[c]=d[c]}},setBackPage:function(c,b){this._backPage=c;this._backId=b},getBackPage:function(){if(this._backPage!=null){return this._backPage}if(!this.pageID){this.pageID=a("#jco-pv-funcid").val()}return this.getFuncID()},getBackId:function(){return this._backId},dispWeekGroup:function(c){var b=desknets.paramanalyzer.getHashParams();b.cmd=desknets.sch.PAGE_SCHGWEEK;b.date=c;desknets.paramanalyzer.setLocationHash(b)},dispDayGroup:function(c){var b=desknets.paramanalyzer.getHashParams();b.cmd=desknets.sch.PAGE_SCHGDAY;b.date=c;desknets.paramanalyzer.setLocationHash(b)},dispWeekSel:function(c){var b=desknets.paramanalyzer.getHashParams();b.cmd=desknets.sch.PAGE_SCHWEEKSEL;b.date=c;desknets.paramanalyzer.setLocationHash(b)},dispDaySel:function(c){var b=desknets.paramanalyzer.getHashParams();b.cmd=desknets.sch.PAGE_SCHDAYSEL;b.date=c;desknets.paramanalyzer.setLocationHash(b)},dispWeek:function(c){var b=desknets.paramanalyzer.getHashParams();b.cmd=desknets.sch.PAGE_SCHWEEK;b.date=c;delete b.gid;delete b.id;desknets.paramanalyzer.setLocationHash(b)},dispDay:function(c){var b=desknets.paramanalyzer.getHashParams();b.cmd=desknets.sch.PAGE_SCHDAY;b.date=c;delete b.gid;delete b.id;desknets.paramanalyzer.setLocationHash(b)},isTopPage:function(c){var d=c.replace(/mset/,"");var b=[desknets.sch.PAGE_SCHWEEK,desknets.sch.PAGE_SCHDAY,desknets.sch.PAGE_SCHMONTH,desknets.sch.PAGE_SCHGWEEK,desknets.sch.PAGE_SCHGDAY,desknets.sch.PAGE_SCHFREE,desknets.sch.PAGE_SCHWEEKSEL,desknets.sch.PAGE_SCHDAYSEL];return a.inArray(d,b)>=0}});desknets.sch.util.page={toggleTitleTab:function(c){a("#co-m-h-tabs").find(".co-m-h-tab").removeClass("on");if(c==null){return}var b="#jsch-tab-"+c;a(b).addClass("on")},getIDs:function(c){var b=[];c.each(function(){b.push(a(this).val())});return b},getGid:function(){var b=desknets.sch.util.getCurrentPgae();return b.find("[name=gid]").val()},clearPreloadedData:function(){var b=["jsonRestToDo","jsonRestHoliday","jsonRestLogin","jsonRestGroup","jsonRest"];a.each(b,function(d,c){window[c]=null})}};desknets.sch.util.calbox={_scrollPositions:{},_formatChoosenCount:"",initDragScroll:function(b,d){var c=a.extend({start:function(e){a(this).data("dragging",true)},stop:function(e){var f=a(this);setTimeout(function(){f.data("dragging",false)},0)}},d);b.bind("beforeSelect.cal",function(e){if(a(this).data("dragging")){e.preventDefault()}});b.bind(desknets.EVENT_SCROLL,function(){desknets.cal.refPopUp.close()});b.dndscroll(c)},initHourScroll:function(e,d,b,f){var c=this;c.scrollTo(e,d,b,f);d.bind("scroll.sch",function(g){var i=(e=="vertical")?"scrollTop":"scrollLeft";var h=d[i]()/b;c.setPositionByHour(e,h)})},destroyHourScroll:function(b){b.unbind("scroll.sch")},scrollTo:function(e,d,b,f){var g=(e=="vertical")?"scrollTop":"scrollLeft";var c=this.getPositionByHour(e,f)*b;setTimeout(function(){d[g](c)},0)},getPositionByHour:function(b,c){if(typeof this._scrollPositions[b]!="number"){var d=desknets.cal.settings.of(!!c?c:"sch");this._scrollPositions[b]=Number(d.start)}return this._scrollPositions[b]},setPositionByHour:function(b,c){this._scrollPositions[b]=Number(c)},initGroupCheck:function(f,c){var b=this,d=a.extend({},c);var e=f.find(".sch-choose-menu");this._formatChoosenCount=e.find(".jsch-choosen-count").text();e.find(".jsch-btn-narrow").click(function(h){h.preventDefault();if(typeof d.narrow=="function"){var g=d.narrow(d.selected);if(g){b._delGroupCheckOptionSelect(d)}}});e.find(".jsch-btn-cancel").click(function(g){g.preventDefault();b._hideChoosenMenu(f);if(typeof d.narrow=="function"){var h=desknets.paramanalyzer.getHashParams();if(!!h.selkind&&h.selkind==desknets.sch.REQ_GIDSELECT){desknets.sch.delGrpListAllCheckOptionSelect()}else{b._delGroupCheckOptionSelect(d)}d.narrow({})}});e.find(".jsch-btn-add").click(function(g){g.preventDefault();if(typeof d.add=="function"){d.add(d.selected)}});f.on("click",".jsch-cal-checkbox",function(){b._updateWithCheckPage(f,d,a(this))});this._updateWithCheckPage(f,d,null)},getCheckedIDs:function(d,c){var b=this._getChoosenItems(d);return !!b[c]?b[c]:[]},initSelCheck:function(f,c){var b=this,d=a.extend({},c);var e=f.find(".sch-choose-menu");this._formatChoosenCount=e.find(".jsch-choosen-count").text();e.find(".jsch-btn-narrow").click(function(g){g.preventDefault();if(typeof d.narrow=="function"){d.narrow(b._getChoosenItems(f),desknets.sch.REQ_GIDSELECT)}});e.find(".jsch-btn-cancel").click(function(g){g.preventDefault();b._hideChoosenMenu(f)});e.find(".jsch-btn-notnarrow").click(function(g){g.preventDefault();if(typeof d.narrow=="function"){d.narrow(b._getChoosenNotItems(f),desknets.sch.REQ_GIDSELECT)}});e.find(".jsch-btn-add").click(function(g){g.preventDefault();if(typeof d.add=="function"){d.add(b._getChoosenItems(f))}});f.on("click",".jsch-cal-checkbox",function(){b._updateWithCheck(f)});this._updateWithCheck(f)},_updateWithCheck:function(e){var d=0,b=this._getChoosenItems(e);for(var c in b){d+=b[c].length}if(d>0){this._showChoosenMenu(e,d)}else{this._hideChoosenMenu(e)}},_updateWithCheckPage:function(h,b,n){var p=this;var m;var d;var g=0;var j=0;var i=b.type;var e=h.find(".jsch-cal-checkbox:checked");var f=desknets.paramanalyzer.getHashParams();if(e.length>0&&n===null){p._delGroupCheckOptionSelect(b);e.each(function(){m=a(this).data("key");if(!!b.selected[m]){b.selected[m].push(this.value)}else{b.selected[m]=[this.value]}})}if(n!==null){if(!!b.selected[i]){j=b.selected[i].length}m=n.data("key");d=n.val();if(n.attr("checked")=="checked"){var k=desknets.sch.MAX_SCHSELECTLIST;var c=true;if(i=="user"){var o=desknets.pageframe.getLoginUid();if(m!="group"&&d!=o){if(!!b.selected.user&&desknets.chkInArray(o,b.selected.user)>=0){k++}}else{c=false}}if(c&&j>=k){if(i=="plant"){desknets.dialog.alert(desknets.Resource.Message.plant_checkselectover)}else{desknets.dialog.alert(desknets.Resource.Message.sch_checkselectover)}n.attr("checked",false);return}if(!!b.selected[m]){b.selected[m].push(d)}else{b.selected[m]=[d]}}else{for(var l in b.selected[m]){if(b.selected[m][l]==d){b.selected[m].splice(l,1);break}}}}else{h.find(".jsch-cal-checkbox").each(function(){var q=a(this);m=q.data("key");d=q.val();if(!!b.selected[m]&&a.inArray(d,b.selected[m])>=0){q.attr("checked",true)}})}for(m in b.selected){g+=b.selected[m].length}if(g>0){this._showChoosenMenu(h,g)}else{if(String(f.selkind)==desknets.sch.REQ_GIDSELECT){h.find(".sch-choose-menu .jsch-btn-cancel").click()}else{this._hideChoosenMenu(h)}}},_delGroupCheckOptionSelect:function(b){for(key in b.selected){b.selected[key]=[]}},_showChoosenMenu:function(d,b){var c=d.find(".sch-choose-menu");var e=desknets.tmpl.replaceWordHtml(this._formatChoosenCount,"count",b);c.find(".jsch-choosen-count").text(e);if(c.css("display")=="none"){c.slideDown()}},_hideChoosenMenu:function(b){b.find(".jsch-cal-checkbox:checked").prop("checked",false);b.find(".sch-choose-menu").fadeOut()},_getChoosenItems:function(c){var b={};c.find(".jsch-cal-checkbox:checked").each(function(){var d=a(this).data("key");if(!!b[d]){b[d].push(this.value)}else{b[d]=[this.value]}});return b},_getChoosenNotItems:function(c){var b={};c.find(".jsch-cal-checkbox").each(function(){if(!a(this).attr("checked")){var d=a(this).data("key");if(!!b[d]){b[d].push(this.value)}else{b[d]=[this.value]}}});return b}};desknets.sch.util.edit={isAccess:function(c,d){var b=c.split(desknets.sch.DELM_SCHEDULE);if(b[3]&d){return true}else{return false}}};desknets.sch.util.dateTime={getRecurrenceMessage:function(b){return[this._getRecurrenceRangeMessage(b),this._getRecurrenceIntervalMessage(b)].join(" ")},_getRecurrenceRangeMessage:function(e){var d,c,b;if(e.rependtimes>0){d=desknets.Resource.sch.recurrenceDescFormat_repeat;d=desknets.tmpl.replaceWordHtml(d,"rependtimes",e.rependtimes)}else{d=desknets.Resource.sch.recurrenceDescFormat_enddate;b=this._getRecurrenceDateMessage(e.enddate);d=desknets.tmpl.replaceWordHtml(d,"enddate",b)}c=this._getRecurrenceDateMessage(e.startdate);d=desknets.tmpl.replaceWordHtml(d,"startdate",c);return d},_getRecurrenceDateMessage:function(b){if(a.type(b)!="date"){b=neo.dateTime.parse(b)||new Date()}return neo.dateTime.format(desknets.Resource.dateFormat,b)},_getRecurrenceIntervalMessage:function(e){var b,d;b=desknets.Resource.sch["recurrenceDescFormat_"+e.repeat];b=desknets.tmpl.replaceWordHtml(b,"interval",e.interval);if(e.repeat==desknets.sch.REPEAT_WEEK&&!!e.everyweekday){var c=this._getRecurrenceDayOfWeekMessage(e.everyweekday,"short");d=desknets.Resource.sch.recurrenceDescFormat_dayOfWeek;d=desknets.tmpl.replaceWordHtml(d,"recurrence",b);d=desknets.tmpl.replaceWordHtml(d,"daysOfWeek",c)}else{if(e.repeat==desknets.sch.REPEAT_MONTH){d=this._getRecurrenceMonthMessage(e);d=desknets.tmpl.replaceWordHtml(d,"recurrence",b)}else{d=b}}return d},_getRecurrenceDayOfWeekMessage:function(d,c){var f=[];var e=neo.Resource.dateTime[c+"Weeks"];for(var b=0;b<d.length;b++){if(d.charAt(b)=="1"){f.push(e[(b+1)%7])}}return f.join(", ")},_getRecurrenceMonthMessage:function(h){var g,e=h.everyweek;if(!!e&&!!h.everyweekday){var f=desknets.Resource.sch.recurrenceDescFormat_weekOfMonth;var b=(0<e&&e<=f.length)?f[e]:f[0];var c=this._getRecurrenceDayOfWeekMessage(h.everyweekday,"long");g=desknets.Resource.sch.recurrenceDescFormat_weekAndDayOfMonth;g=desknets.tmpl.replaceWordHtml(g,"weekOfMonth",b);g=desknets.tmpl.replaceWordHtml(g,"dayOfWeek",c)}else{var d=h.startdate;if(a.type(d)!="date"){d=neo.dateTime.parse(d)}g=desknets.Resource.sch.recurrenceDescFormat_dayOfMonth;g=desknets.tmpl.replaceWordHtml(g,"day",d.getDate())}return g}};a.extend(desknets.sch.util.dateTime,{SCHSUNDAYFLG_ON:"1",getDays:function(b,d){var e=neo.dateTime.parse(b);var g=neo.dateTime.parse(d);var c=e.getTime();var f=g.getTime();if(c>f){return 0}return(f-c)/24/60/60/1000},_getTimeMinute:function(e,b){if(!neo.isSet(e)||e.length==0){e=null}if(!neo.isSet(b)||b.length==0){b=null}if((e!=null&&b==null)||(e==null&&b!=null)){return 30}var d=neo.dateTime.parse("20111231"+e+"00");var g=neo.dateTime.parse("20111231"+b+"00");var c=d.getTime();var f=g.getTime();if(c>f){return 0}return(f-c)/60/1000},addTimeMinute:function(g,d){var h=null;var b="20120101";var f=neo.dateTime.parse(b+g+"00");var e=f.getTime()+d*60*1000;f.setTime(e);var c=neo.dateTime.format("yyyyMMddHHmm",f);if(c.substr(0,8)!=b){if(c.substr(8,4)=="0000"){h="2400"}}else{h=c.substr(8,4)}return h},subTimeMinute:function(g,d){var h=null;var b="20120101";var f=neo.dateTime.parse(b+g+"00");var e=f.getTime()-d*60*1000;f.setTime(e);var c=neo.dateTime.format("yyyyMMddHHmm",f);if(c.substr(0,8)==b){h=c.substr(8,4)}return h},addTimeHM:function(e,c){var b=parseInt(c.substr(0,2),10);var d=parseInt(c.substr(2,2),10);if(b>24){b=0}if(d>59){d=0}return desknets.sch.util.dateTime.addTimeMinute(e,b*60+d)},getFirstDay:function(f,e){var d=neo.dateTime.parse(f.substr(0,6)+"01");var c=desknets.sch.util.dateTime.getNumDay(d,e);var b=neo.dateTime.moveDate(d,c*-1);return neo.dateTime.format("yyyyMMdd",b)},getNumDay:function(d,c){var b=d.getDay();if(c==this.SCHSUNDAYFLG_ON){if(b==0){b=6}else{b=b-1}}return b},isSunday:function(c,b){if(b==this.SCHSUNDAYFLG_ON){if(c==6){return true}}else{if(c==0){return true}}return false},isSaturday:function(c,b){if(b==this.SCHSUNDAYFLG_ON){if(c==5){return true}}else{if(c==6){return true}}return false},_downBarTime:function(b){if(neo.isSet(b)&&b.length==4){if(b.substr(2,2)<30){b=b.substr(0,2)+"00"}else{b=b.substr(0,2)+"30"}}return b},getBarTime:function(d,b){d=this._downBarTime(d);b=this._downBarTime(b);var c=this._getTimeMinute(d,b);return c/30}});desknets.sch.util.memo={_DIALOG_ID:"sch-memo-dialog",init:function(c,b){desknets.memoutil.entryDialogInit(c,b,this._DIALOG_ID)}};desknets.sch.util.plant={DATA_GROUPINIT:"init",setGroupSelect:function(c,d,b){var f=[];f=desknets.ajax.getJsonItems(c);var e=b.data(desknets.sch.util.plant.DATA_GROUPINIT);desknets.htmlparts.setSelectOption(b,f,"id","Name",{tval:"0",tstr:d,selected:e})},isSetLimit:function(b){if(neo.isSet(b,{blank:false})&&b!=-1){return true}else{return false}},limitTime:function(c,b){var d;if(desknets.sch.util.plant.isSetLimit(c)){if(c=="0000"&&b=="2400"){return desknets.Resource.cal.allDayLabel}d=desknets.dateTime.formatHour(desknets.Resource.shortTimeFormat,c);d=d+" - ";if(neo.isSet(b,{blank:false})){d=d+" "+desknets.dateTime.formatHour(desknets.Resource.shortTimeFormat,b)}}else{d=desknets.Resource.sch.pInfoNoLimit}return d},limitUseTime:function(b){var c;if(desknets.sch.util.plant.isSetLimit(b)){c=desknets.tmpl.replaceWordHtml(desknets.Resource.sch.pInfoMaxTime,"maxtime",b)}else{c=desknets.Resource.sch.pInfoNoLimit}return c},limitHolidayUse:function(b){var c;if(b==desknets.sch.PLANT_HOLIDAY_NONUSE){c=desknets.Resource.disallow}else{c=desknets.Resource.allow}return c},limitReserv:function(d,b,c){var e;if(neo.isSet(d,{blank:false})){if(d=="-1"){e=desknets.Resource.sch.pInfoNoLimit}else{if(d=="d"&&!!c){e=desknets.dateTime.formatDate("m",c)}else{if(d=="n"&&!!b){e=desknets.tmpl.replaceWordHtml(desknets.Resource.sch.pInfoAcceptDay,"reservlimit",b)}else{e=desknets.Resource.sch.pInfoNoLimit}}}}else{e=desknets.Resource.sch.pInfoNoLimit}return e},limitReservSch:function(c){var b;if(c==desknets.sch.PLANT_RESERVSCHLIMIT){b=desknets.Resource.sch.pInfoLimit}else{b=desknets.Resource.sch.pInfoNoLimit}return b}};desknets.sch.util.sel={miselcnt:0,mbomaxsel:false,mbonotsetcookie:false,msprmname:"id",mscookiename:desknets.storage.FIELD_SCH_SEL,_onChangePageParams:function(c){var b=this;b._onChangePageParamsInit(c);b.callBase("_onChangePageParams",c);b.savePageParams(c)},_onChangePageParamsInit:function(h){var c=this;c.miselcnt=0;h.selkind=desknets.sch.REQ_GIDSELECT;h.gid=desknets.sch.REQ_GIDSELECT;if(!c.mbonotsetcookie&&!neo.isSet(h[c.msprmname])){var f=desknets.storage.loadData(c.mscookiename);if(neo.isSet(f)){var e=f.split(",");var d=desknets.pageframe.getLoginUid();if(e[0]==d){e.shift();h[c.msprmname]=e;c.miselcnt=e.length}}}else{if(typeof h[c.msprmname]=="string"){c.miselcnt=1}else{if(!neo.isSet(h[c.msprmname])){c.miselcnt=0}else{if(h[c.msprmname].length>desknets.sch.MAX_SCHSELECTLIST){var b=[];for(var g=0;g<desknets.sch.MAX_SCHSELECTLIST;g++){b[g]=h[c.msprmname][g]}h[c.msprmname]=b;c.mbomaxsel=true}c.miselcnt=h[c.msprmname].length}}}c.mbonotsetcookie=false},savePageParams:function(d){var b=this;var c=a.extend({},d);delete c[b.msprmname];delete c.selkind;delete c.gid;desknets.sch.util.savePageParams(b._getSaveParamNames(),c)},onSuccess:function(e){var b=this;b.callBase("onSuccess",e);var d=b.getSelCnt();var c="";if(d!=0){c=desknets.tmpl.replaceWordHtml(desknets.Resource.sch.sch_userselectcnt,"count",d)}b.$mjPage.find(".jsch-cal-sel-user-cnt").html(c);var f=b.getViewTopMsgFromID(d);if(f!=""){desknets.pageframe.viewTopMsgFromID(f)}},getViewTopMsgFromID:function(c){var b=this;var d="";if(b.mbomaxsel){d="sch_userselectover"}b.mbomaxsel=false;if(b.miselcnt>c){if(d!=""){d+=","}d+="sch_userselectnotview"}return d},getSelCnt:function(){var c=this;var f=0;var b=[];c.$mjPage.find(".sch-gcal-target-header").each(function(){var g=a(this);if(g.data("target")!="me"&&g.parent().data("target")!="me"){b[f]=g.find(".jsch-cal-checkbox").val();f++}});var e="";var d=desknets.pageframe.getLoginUid();if(f>0){e=d+","+b.join(",")}desknets.storage.saveData(c.mscookiename,e);return f},_initGroup:function(){var b=this;var c=b.$mjPage.find(".jsch-cal-sel-user");c.click(function(d){b._openUserChoser()})},_openUserChoser:function(){var c=this;var d="sch-cal-chooser-"+c.getSchCalAreaCmd();var b=c._getUserChoser();desknets.chooser.open(d,{chooseTarget:["user"],choosePrivateGroup:"readonly",allGroup:"readonly",unassignGroup:"readonly",chooseDisplayGroup:true,items:b,choosenDnD:true,choose:function(e){c._changeUser(e)}})},_getUserChoser:function(){var b=this;return[]},_changeUser:function(d){var c=this;var e=0;var b=d.length;var h=[];var f=desknets.pageframe.getLoginUid();for(e=0;e<b;e++){h.push(d[e].id)}h=neo.array.remove(h,f);c.mbonotsetcookie=true;var g=c.getParamsForCalendar(c.getSchCalAreaCmd(),c.date);g.id=h;c._setLocationHash(g,false)},_initChoosenMenu:function(){var b=this;var c=desknets.pageframe.getLoginUid();desknets.sch.util.calbox.initSelCheck(b.$mjPage,{add:function(d){var e=b.getParamsForAddSelected(d);if(!!e){b._setLocationHash(e,false)}},narrow:function(d,e){b.mbonotsetcookie=true;if(neo.isSet(d.user)){d.user=neo.array.remove(d.user,c)}var f=b.getParamsForNarrowedCalendar(d);b._setLocationHash(f,false)}})},_resetSubWinMenu:function(){desknets.sch.subwin.dispGroupMenu(false);desknets.sch.subwin.setSubwinMonthCal(false)},getParamsForPage:function(){var b=this;var c=b.callBase("getParamsForPage");c.num=desknets.sch.MAX_SCHSELECTLIST;return c},getParamsForMemberEvents:function(){var b=this;var c=b.callBase("getParamsForMemberEvents");c.gid=desknets.sch.REQ_GIDSELECT;c.num=desknets.sch.MAX_SCHSELECTLIST;return c}};desknets.sch.util.user={onSucessFilter:function(h,l,e,i,b){var n;var k;var j,m;var g=false;var d=[];var c=0;if(neo.isSet(h[0])){k=desknets.ajax.getJsonItems(h[0])}else{k=desknets.ajax.getJsonItems(h)}var f=k.length;for(j=0;j<l.length;j++){for(m=0;m<f;m++){n=k[m];if(n.id==l[j].id){break}}if(m!=f){d.push(l[j])}else{g=true}}e(d);if(g){desknets.pageframe.viewTopMsgFromID(b)}else{desknets.pageframe.closeTopMsg()}desknets.submitform.clearDisabled(i)}};desknets.sch.util.yearpopup={_page:null,_$area:null,_onSelect:null,init:function(d,c,e){var b=this;if(neo.isSet(d)&&c&&c.length>0){b._page=d;b._$area=c;b._onSelect=e;b._initYearPopUpEvent()}},_initYearPopUpEvent:function(){var b=this;b._$area.delegate(".sch-cal-year-link","click",function(d){d.preventDefault();var c=neo.dateTime.format("yyyyMMdd",b._page.date);var e=a(".jsch-cal-yeardialog");var f=a(this).text();if(e.length>0){if(e.find('input[name="caldate"]').val()!==c){b.destroy(e)}else{e.dialog("open");return}}b._makeYearPopUpDialog(c,f)})},_makeYearPopUpDialog:function(d,f){var c=this;var e;var b=function(i){var g={};var h=a.extend(desknets.dialog.getDialogOption(),{dialogClass:"dn-dialog sch-cal-year",width:510,title:f});e=a('<div class="jsch-cal-yeardialog"/>').html(i[0].html).appendTo(document.body);c._createEventYearPopUpDialog(e);e=desknets.dialog.setUp(e,h);e.dialog("open");desknets.dialog.setFirstDialogOpen(e)};c._getHtmlAjaxMulti(d,b)},_getHtmlAjaxMulti:function(e,g){var b=this;var f={};f["0"]={cmd:b._page.getSchYearCalCmd(),caldate:e};var d=desknets.ajax.arrayToMultiCmdData(f);var c=desknets.getUrl(desknets.MODULE_API_MAIN);desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:c,data:d,success:function(i,h,j){if(i[0]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.dialog.alert(i[0]["errormessage"],{errorNo:i[0]["errorno"]})}else{if(a.isFunction(g)){g(i)}}}})},_createEventYearPopUpDialog:function(d){var c=this;var b=function(e){d.html(e[0].html)};d.delegate(".sch-anual-nav>a","click",function(g){g.preventDefault();var f=d.find('input[name="caldate"]').val();var e=c._editNextYearDate(f,a(this));c._getHtmlAjaxMulti(e,b)});d.delegate(".sch-anual>li","click",function(g){g.preventDefault();var f=a(this).find('input[name="calmdate"]').val();if(a.isFunction(c._onSelect)){var e=neo.dateTime.parse(f);c._onSelect(e)}d.dialog("close")})},_editNextYearDate:function(c,d){var b="";if(d.hasClass("next")){b=desknets.dateTime.computeMonth(c,"+12")}else{if(d.hasClass("prev")){b=desknets.dateTime.computeMonth(c,"-12")}}return b},destroy:function(b){b.dialog("destroy").remove()}};desknets.page(desknets.sch,"schcal",desknets.sch.schbase,{REQ_PROC_WEEK:"w",REQ_PROC_MONTH:"m",REQ_PROC_DAY:"d",TMPL_PRINT:'<div class="dn-preview-header"><h1 class="dn-preview-title">{{date}} {{Name}}</h1></div>',$mjPage:a(),$dateNav:a(),date:desknets.pageframe.getServerDate(),baseParams:{},preloadedRestKey:"jsonRestPrivate",preloadedHolidayRestKey:"jsonRestHoliday",preloadedToDoRestKey:"jsonRestToDo",cmds:desknets.sch.cmds,_printName:null,_printDate:null,_pageLoaded:false,init:function(){this.callBase("init");if(!this._pageLoaded&&this.$mjPage.children().length>0){this._onNavigateToPage();this._initPreLoadedPage()}else{this.initParamsFromHash({cmd:this.getSchCalAreaCmd()})}},initParamsFromHash:function(b){if(desknets.sch.util.isConnecting()){return}if(!desknets.sch.util.isCurrentPage(this.getSchCalAreaCmd())){this._onNavigateToPage()}this._onChangePageParams(b);this._resetSubWinMenu()},getMultiRequest:function(){var c=this.getMultiRequestAsArray();var b={};if(c.length<=0){this.onSuccess({});return null}a.each(c,function(d,e){b[d.toString()]=e});return b},onSuccess:function(c){var b={index:0};this.setMultiResponse(c,b);this.setSchCalTitle();desknets.sch.util.page.clearPreloadedData();desknets.scrollManager.setScrollPosition(this.getSchCalAreaCmd(),desknets.scrollManager.$scrollRoot,{y:0,delay:10})},_onComplete:function(){this.callBase("_onComplete");this.$mjPage.find(".co-btn-update").removeClass("on")},setConnecting:function(c){var b=this.callBase("setConnecting",c);if(b&&this.$dateNav.length>0){if(c){this.$dateNav.neoDateNav("disable")}else{this.$dateNav.neoDateNav("enable")}}return b},getSchCalParamProc:function(){return""},getSchCalAreaCmd:function(){return""},cachePage:function(c){var b=a.extend({gid:""},this.baseParams);var d=a.extend({gid:""},this._getBaseParams(c));return b.gid==d.gid&&String(b.id)==String(d.id)},updatePageParams:function(b){this.date=!!b.date?neo.dateTime.parse(b.date):desknets.dateTime.current;this.baseParams=this._getBaseParams(b)},initCalendar:function(){var b=this;b._initDateNav();b._initCalendarEvents();b.$mjPage.find(".co-btn-update").click(function(c){c.preventDefault();a(this).addClass("on");b._sendRequestAjax();desknets.scrollManager.clearScrollPosition(b.getSchCalAreaCmd())});desknets.moveScroll()},getPrintPageID:function(){return""},initPrint:function(d,c){var b=this;if(!b.$mjPage||b.$mjPage.length<=0){b.$mjPage=a("#jsch-"+b.getSchCalAreaCmd())}b.$mjPage.find(".co-btn-sch-print").click(function(e){e.preventDefault();window.open(b.getPrintPageUrl(),"schprint")})},getPrintPageUrl:function(){var c=desknets.getUrl("dneo")+"?cmd="+this.getPrintPageID();c+="&date="+neo.dateTime.format("yyyyMMdd",this.date);for(var b in this.baseParams){c+="&"+b+"="+this.baseParams[b]}return c},showCalendar:function(){},updateCalendar:function(b){},destroyCalendar:function(){var b=this.getPageElement();this.$mjPage.find(".co-btn-update").unbind("click");this.$dateNav.neoDateNav("destroy");b.unbind("navigate.cal");b.unbind("add.cal");b.unbind("refer.cal");b.unbind("modify.cal");b.unbind("refresh.cal");this.$mjPage.empty()},getMultiRequestAsArray:function(){var b=[];if(!this._pageLoaded){b.push(this.getParamsForPage())}if(!window[this.preloadedRestKey]){b.push(this.getParamsForEvents())}if(this.isToDoShown()&&!window[this.preloadedToDoRestKey]){b.push(this.getParamsForToDo())}if(this.isHolidayShown()&&!window[this.preloadedHolidayRestKey]){b.push(this.getParamsForHolidays())}return b},getParamsForPage:function(){return a.extend({cmd:this.getSchCalAreaCmd(),date:neo.dateTime.format("yyyyMMdd",this.date)},this.baseParams)},getParamsForEvents:function(){return a.extend({cmd:this.cmds.cmdPrivate,date:neo.dateTime.format("yyyyMMdd",this.date),proc:this.getSchCalParamProc()},this.baseParams)},getParamsForToDo:function(){var b=neo.dateTime.format("yyyyMMdd",this.date);return{cmd:"todocmdlistsearch",srch_limdate_s:b,srch_limdate_e:b}},getParamsForHolidays:function(){var b=neo.dateTime.format("yyyyMMdd",this.date);return{cmd:this.cmds.cmdHoliday,startdate:b,enddate:b}},getParamsForCalendar:function(c,b){return a.extend({cmd:c,date:neo.dateTime.format("yyyyMMdd",b)},this.baseParams)},getParamsForRefer:function(b){var d=desknets.getDataAttr(b,"id");if(b.hasClass("todo")){return{cmd:"todoref",id:d}}else{var c="0";if(!b.data("mydata")||b.data("mydata")=="1"){c="1"}return a.extend({cmd:this.cmds.ref,sid:d,mydata:c,seldate:b.data("date")},this.baseParams)}},getModuleLen:function(){return 3},getModuleName:function(){return"sch"},getParamCommandTargetAdd:function(){return this.cmds.addTarget},getParamsForAdd:function(c,d,b){var e=a.extend({cmd:this.cmds.add,date:neo.dateTime.format("yyyyMMdd",c),enddate:neo.dateTime.format("yyyyMMdd",d)},this.baseParams);return e},getParamsForModify:function(c,b,d){var e=a.extend({cmd:this.cmds.mod,sid:desknets.getDataAttr(c,"id"),seldate:c.data("date")},this.baseParams);this._addDateParamsForModify(e,c,b,d);if(!!e.startdate){e.date=e.startdate;delete e.startdate}return e},getParamsForModifyData:function(c,b,d){var e={cmd:this.cmds.cmdModDate,sid:desknets.getDataAttr(c,"id")};this._addDateParamsForModify(e,c,b,d);return e},addMyData:function(b){if(this.isMyData(b)){b.data("mydata","1")}else{b.data("mydata","0")}},isMyData:function(b){if(!!this.baseParams.id&&this.baseParams.id==desknets.pageframe.getLoginUid()){return true}return false},setSchCalTitle:function(){this._setTitle("")},setMultiResponse:function(e,c){if(!this._pageLoaded){this._loadPageWithJson(e[c.index.toString()]);if(!this._pageLoaded){return}c.index++}else{this.showCalendar()}var d=this.getCalendarRest(e,c,this.preloadedRestKey);var f=this.getCalItemsFromJson(d),b;if(f==null){return}this._printName=d.Name;if(this.isToDoShown()){b=this.getToDoItems(e,c);a.merge(b,f);f=b}if(this.isHolidayShown()){b=a.merge([],this.getHolidayItems(e,c));f=a.merge(b,f)}this.updateCalendar({add:!!d.accessadd});this.replaceCalItems(f);desknets.sch.util.showPage(this.getSchCalAreaCmd());this.setCalendarPrint()},getCalItemsFromJson:function(c){var b=!!c.slist?desknets.ajax.getItems(c.slist.item):[];return desknets.cal.item.getItemsFromSch(b)},getCalendarRest:function(e,c,b){var d;if(!!window[b]){d=window[b]}else{d=e[c.index.toString()];if(!!d){c.index++}}return d},replaceItems:function(d,c){var b=!!d.slist?desknets.ajax.getItems(d.slist.item):[];var e=desknets.cal.item.getItemsFromSch(b);this.replaceCalItems(e,c)},replaceCalItems:function(b,c){},getHolidayItems:function(e,c){var d=this.getCalendarRest(e,c,this.preloadedHolidayRestKey);if(!!d){if(d.status!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(d.errorno,d.errormessage);return[]}var b=desknets.ajax.getJsonItems(d);return desknets.cal.item.getItemsFromHoliday(b)}return[]},getToDoItems:function(e,c){var d=this.getCalendarRest(e,c,this.preloadedToDoRestKey);if(!!d){if(d.status!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(d.errorno,d.errormessage);return[]}var b=desknets.ajax.getJsonItems(d);return desknets.cal.item.getItemsFromToDo(b)}return[]},showCalRef:function(b,e){var d=this.getParamsForRefer(b);var c={cmdindex:this.cmds.index,cmdref:this.cmds.cmdRef,pageref:this.cmds.ref,pageadd:this.cmds.add,cmddel:this.cmds.cmdDel};if(!!e){this._setLocationHash(d,false)}else{if(b.hasClass("todo")){c.bproc=desknets.getProcUrl(true)}desknets.cal.refPopUp.open(b,c)}},showCalMod:function(c,b,e){var d;if(c.hasClass("todo")){d=desknets.getNeoParam({cmd:"todotaskentry",id:desknets.getDataAttr(c,"id"),bproc:desknets.getProcUrl(true)});location.href=desknets.cal.CGI_TODO+"?cmd="+desknets.cal.PAGE_TODO_INDEX+"#"+d}else{d=this.getParamsForModify(c,b,e);this._setLocationHash(d,false)}},modifyCalItem:function(d,b,e){var c=this,f=this.getParamsForModifyData(d,b,e);desknets.ajax.rest({url:desknets.getUrl(this._getRestModule()),data:f,success:function(){c._sendRequestAjax()},error:function(j,g,i){var h=desknets.ajax.getErrorNumber(j,g);c.showCalMod(d,b,e);setTimeout(function(){a(document).one("ajaxComplete",function(){desknets.ajax.onError(h,i)})},0)}})},setCalendarPrint:function(){var c=this,b=this.$mjPage.find(".jsch-btn-print-screen");if(b.length>0){desknets.print.$area=this.$mjPage;desknets.print.setPrintHtmlFunc=function(e,f){var d;desknets.print.setPrintHtmlFuncDef(e,f);f.$(".cal-selection").remove();d=c.setCalPrintWindow(f);return true};b.off("click").click(function(d){d.preventDefault();desknets.print.initPrintOpen({})})}},setCalPrintWindow:function(c){var b;b=this.TMPL_PRINT;b=desknets.tmpl.replaceWord(b,"Name",this._printName);b=desknets.tmpl.replaceWordHtml(b,"date",this._printDate);return b},getPageElement:function(){return this.$mjPage},getCmdForCalendar:function(b,c){if(b=="week"){return desknets.sch.PAGE_SCHWEEK}if(b=="day"){return desknets.sch.PAGE_SCHDAY}return b},isToDoShown:function(){var b=desknets.pageframe.getLoginUid();if(desknets.cal.settings.of("sch").todo!="1"){return false}if(!this.baseParams.id||this.baseParams.id!=b){return false}return true},isHolidayShown:function(){return desknets.cal.settings.of(this.getModuleName()).holiday=="1"},_onNavigateToPage:function(){var b=this;var c=this.getSchCalAreaCmd();desknets.sch.util.navigateToPage(c,{created:function(d){b.$mjPage=d}});desknets.sch.util.setBackPage(c,"jsch-"+c)},_onChangePageParams:function(c){desknets.sch.util.savePageParams(this._getSaveParamNames(),c);if(!this.$mjPage||this.$mjPage.length<=0){this._initPreLoadedPage(c)}else{var b=this.$mjPage.children().length>0;this._pageLoaded=b&&this.cachePage(c);this.updatePageParams(c);this.$dateNav.neoDateNav("date",this.date);this._sendRequestAjax()}},_getSaveParamNames:function(){return["id","gid","date","row","selkind"]},_initPreLoadedPage:function(b){this.$mjPage=a("#jsch-"+this.getSchCalAreaCmd());this.updatePageParams(b||{});this.initCalendar();desknets.sch.util.showPage(this.getSchCalAreaCmd());this._pageLoaded=true;this._sendRequestAjax();this.initPrint()},_getBaseParams:function(b){var c={};if(neo.isSet(b.gid,{blank:false})){c.gid=b.gid}else{c.id=desknets.pageframe.getLoginUid()}if(neo.isSet(b.id,{blank:false})){c.id=b.id}return c},_changeDate:function(b,d){if(neo.dateTime.compareOn(this.date,b,"day")!=0){this.date=b;var c=this.getParamsForPage();this._setLocationHash(c,d)}},_initDateNav:function(){var b=this;b.$dateNav=b.$mjPage.find(".jsch-cal-date-header");desknets.htmlparts.setUpDateNav(b.$dateNav,{date:b.date,change:function(d,c){b._changeDate(c.date,false)}})},_initCalendarEvents:function(){var b=this;var c=this.getPageElement();c.bind("navigate.cal",function(e,d){var f=b.getCmdForCalendar(d.type,a(e.target).closest(".jsch-cal"));var g=b.getParamsForCalendar(f,d.date);b._setLocationHash(g,false)});c.bind("add.cal",function(e,d){var f=b.getParamsForAdd(d.date,d.endDate,a(e.target));b._setLocationHash(f,false);setTimeout(function(){desknets.cal.selection.unselect()},0)});c.bind("refer.cal",function(d,e){b.addMyData(a(d.target));b.showCalRef(a(d.target),!!e&&e.mode=="page")});c.bind("modify.cal",function(d){b.showCalMod(a(d.target))});c.bind("termChanged.cal",function(d,e){b.modifyCalItem(a(d.target),e.date,e.endDate)});c.bind("refresh.cal",function(d){b._sendRequestAjax()})},_loadPageWithJson:function(c){var b=c.html;if(c.status!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(c.errorno,c.errormessage);return}if(this.$mjPage.children().length>0){this.destroyCalendar()}this.$mjPage.html(b);this.initCalendar();this._pageLoaded=true;this.initPrint()},_addDateParamsForModify:function(e,c,b,d){if(!c.data("repeat")){if(!!b){e.startdate=neo.dateTime.format("yyyyMMdd",b)}if(!!d){e.enddate=neo.dateTime.format("yyyyMMdd",d)}}if(c.closest(".jsch-time-calendar").length>0){if(!!b){e.starttime=neo.dateTime.format("HHmm",b)}if(!!d){e.endtime=neo.dateTime.format("HHmm",d)}}},_resetSubWinMenu:function(){desknets.sch.subwin.dispGroupMenu(false);desknets.sch.subwin.setSubwinMonthCal(false)}});desknets.page(desknets.sch,"schday",desknets.sch.schcal,{fullTimeList:desknets.cal.FullTimeList.prototype,timeLine:desknets.cal.TimeVertical.prototype,getSchCalParamProc:function(){return desknets.sch.schcal.REQ_PROC_DAY},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHDAY},getPrintPageID:function(){return"schprtday"},initCalendar:function(){this.callBase("initCalendar");var b=this.$mjPage.find(".cal-timebar-allday");var e=this.$mjPage.find(".cal-v-meter");var c=this.getModuleName();var d=this.timeLine.pixelPerUnit;this.fullTimeList=new desknets.cal.FullTimeList(b,c);this.fullTimeList.setDate(this.date);this.timeLine=new desknets.cal.TimeVertical(e,c,{resizable:true,movable:true});this.timeLine.setDate(this.date);desknets.sch.util.calbox.initHourScroll("vertical",e,d,c)},showCalendar:function(){var b=this.$mjPage.find(".cal-v-meter");desknets.sch.util.calbox.scrollTo("vertical",b,this.timeLine.pixelPerUnit)},updateCalendar:function(b){this.fullTimeList.setSelectable(!!b.add);this.timeLine.setSelectable(!!b.add)},destroyCalendar:function(){var b=this.$mjPage.find(".cal-v-meter");desknets.sch.util.calbox.destroyHourScroll(b);this.fullTimeList.destroy();this.timeLine.destroy();this.callBase("destroyCalendar")},getParamsForAdd:function(c,d,b){var e=this.callBase("getParamsForAdd",c,d,b);if(this.timeLine.$root.is(b)){e.starttime=neo.dateTime.format("HHmm",c);e.endtime=neo.dateTime.format("HHmm",d)}else{e.starttime="0000";e.endtime="2400"}return e},getParamsForHolidays:function(){var b=this.callBase("getParamsForHolidays");a.extend(b,this.baseParams);return b},replaceCalItems:function(b){this._updateCal(this.timeLine,b);this._updateCal(this.fullTimeList,b)},setCalPrintWindow:function(e){var c;var b=this.$mjPage.find(".cal-v-meter").scrollTop();var f=e.$(".cal-v-meter");this._printDate=neo.dateTime.format(desknets.Resource.longDateFormat,this.date);f.removeClass("jcal-v-scroller co-scrollable co-drag-scrollable");f.find(".cal-curtime").remove();f.children().css("margin-top","-"+b+"px");var d=f.height()+b;f.find(".cal-v-box-data").height(d);c=this.callBase("setCalPrintWindow",e);e.$(".sch-cal-day").before(c);return c},getPageElement:function(){return this.$mjPage.find(".sch-cal-day")},isHolidayShown:function(){return false},_updateCal:function(c,b){c.setDate(this.date);c.extractItems(b)}});desknets.page(desknets.sch,"schweek",desknets.sch.schcal,{timeLines:null,getSchCalParamProc:function(){return desknets.sch.schcal.REQ_PROC_WEEK},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHWEEK},initCalendar:function(){this.callBase("initCalendar");var d=this.$mjPage.find(".sch-cal-week");var b=this.$mjPage.find(".sch-cal-timelines");var c=this.getModuleName();var f=desknets.cal.TimeVertical.prototype.pixelPerUnit;var e={maxLines:4,date:this.date,resizable:true,movable:true};this.timeLines=new desknets.cal.WeekTimeLines(d,c,e);desknets.sch.util.calbox.initHourScroll("vertical",b,f,c)},showCalendar:function(){var b=this.$mjPage.find(".sch-cal-timelines");desknets.sch.util.calbox.scrollTo("vertical",b,desknets.cal.TimeVertical.prototype.pixelPerUnit)},updateCalendar:function(b){this.timeLines.setSelectable(!!b.add)},destroyCalendar:function(){var b=this.$mjPage.find(".sch-cal-timelines");desknets.sch.util.calbox.destroyHourScroll(b);this.timeLines.destroy();this.callBase("destroyCalendar")},getPrintPageID:function(){return"schprtweek"},getParamsForAdd:function(c,d,b){var e=this.callBase("getParamsForAdd",c,d,b);if(b.closest(".cal-week-timelines").length>0){e.starttime=neo.dateTime.format("HHmm",c);e.endtime=neo.dateTime.format("HHmm",d)}else{e.starttime="0000";e.endtime="2400"}return e},getParamsForHolidays:function(){var b=this.callBase("getParamsForHolidays");b.enddate=neo.dateTime.format("yyyyMMdd",neo.dateTime.moveDate(this.date,6));a.extend(b,this.baseParams);return b},getParamsForToDo:function(){var c=this.callBase("getParamsForToDo");var b=neo.dateTime.moveDate(this.date,6);c.srch_limdate_e=neo.dateTime.format("yyyyMMdd",b);return c},replaceCalItems:function(b){this.timeLines.setDate(this.date);this.timeLines.replaceItems(b)},setCalPrintWindow:function(i){var e,d,g=desknets.Resource.longDateFormat;var b=this.$mjPage.find(".cal-week-timelines"),h=i.$(".cal-week-timelines");var c,f;e=neo.dateTime.format(g,this.date);d=neo.dateTime.format(g,neo.dateTime.moveDate(this.date,6));this._printDate=e+" "+desknets.Resource.kara+" "+d;h.find(".cal-curtime").remove();h.css("overflow","hidden");h.width(b.width());h.children().css("margin-top","-"+b.scrollTop()+"px");c=this.callBase("setCalPrintWindow",i);f=i.$('<div class="sch-cal-week" />');f.width(b.find(".cal-week-timelines-days > .cal-v-meter").width()*7+56);i.$("#jco-print-body > *").wrapAll(f).parent().eq(0).before(c);return c},getPageElement:function(){return this.$mjPage.find(".sch-cal-week")}});desknets.page(desknets.sch,"schmonth",desknets.sch.schcal,{calendar:desknets.cal.MonthCalendar.prototype,getSchCalParamProc:function(){return desknets.sch.schcal.REQ_PROC_MONTH},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHMONTH},getSchYearCalCmd:function(){return desknets.sch.PAGE_SCHYEARCAL},getPrintPageID:function(){return"schprtmonth"},initCalendar:function(){var b=this;this.callBase("initCalendar");var d=this.$mjPage.find(".cal-month");var c={date:this.date,movable:true};this.calendar=new desknets.cal.MonthCalendar(d,this.getModuleName(),c);var e=function(f){b._changeDate(f,false)};desknets.sch.util.yearpopup.init(this,b.$mjPage.find(".jsch-cal-date-header"),e)},updateCalendar:function(b){this.calendar.setSelectable(!!b.add)},destroyCalendar:function(){var b=this.$mjPage.find(".sch-cal-timelines");desknets.sch.util.calbox.destroyHourScroll(b);this.calendar.destroy();this.callBase("destroyCalendar")},getMultiRequestAsArray:function(){var d=this.callBase("getMultiRequestAsArray");var b=desknets.cal.settings.of(this.getModuleName());if(!!Number(b.rokuyou)){var c={cmd:"schrokuyoulist"};this.extendDateRange(c,"smonth","emonth");d.push(c)}return d},getParamsForHolidays:function(){var b=this.callBase("getParamsForHolidays");this.extendDateRange(b,"startdate","enddate");a.extend(b,this.baseParams);return b},getParamsForToDo:function(){var b=this.callBase("getParamsForToDo");this.extendDateRange(b,"srch_limdate_s","srch_limdate_e");return b},setMultiResponse:function(d,c){var f=this.callBase("setMultiResponse",d,c);var e=desknets.cal.settings.of(this.getModuleName());if(!!Number(e.rokuyou)){var b=desknets.ajax.getJsonItems(d[c.index]);this.calendar.set6WeekContents(b);c.index++}return f},replaceCalItems:function(b){this.calendar.setDate(this.date);this.calendar.replaceItems(b)},setCalPrintWindow:function(c){var b;this._printDate=neo.dateTime.format(desknets.Resource.longYMFormat,this.date);c.$(".cal-week-header").hide();b=this.callBase("setCalPrintWindow",c);c.$(".cal-month").prepend(b);return b},extendDateRange:function(g,d,c){var e=desknets.cal.settings.of(this.getModuleName());var b=desknets.cal.MonthCalendar.getLeftTopDate(this.date,e.sunday);var f=desknets.cal.MonthCalendar.getRightBottomDate(this.date,e.sunday);g[d]=neo.dateTime.format("yyyyMMdd",b);g[c]=neo.dateTime.format("yyyyMMdd",f)},getPageElement:function(){return this.$mjPage.find(".sch-cal-month")},_resetSubWinMenu:function(){desknets.sch.subwin.dispGroupMenu(false);desknets.sch.subwin.setSubwinMonthCal(true,this.date)}});desknets.page(desknets.sch,"schgcal",desknets.sch.schcal,{myCalendar:null,groupCalendar:null,memberCalendars:{},preloadedRestKey:"jsonRestLogin",preloadedGroupRestKey:"jsonRestGroup",preloadedMemberRestKey:"jsonRest",startRow:0,holidays:null,narrowIds:null,narrowSelectIds:{},getPrintPageStartRow:function(){return this.startRow},cachePage:function(d){var b=this.callBase("cachePage",d);if(b){var c=Number(d.row);c=!isNaN(c)?c:0;if(c!=this.startRow){b=false}if((!this.narrowIds&&d.selkind=="select")||(!!this.narrowIds&&d.selkind!="select")){b=false}}return b},updatePageParams:function(c){this.callBase("updatePageParams",c);var b=Number(c.row);this.startRow=!isNaN(b)?b:0;if(String(c.selkind)=="select"){this.narrowIds=a.type(c.id)=="array"?c.id:[c.id]}else{this.narrowIds=null}if(!this.baseParams.id&&a.inArray("id",this._getSaveParamNames())>=0){this.baseParams.id=desknets.pageframe.getLoginUid()}},initCalendar:function(){this.callBase("initCalendar");this.initMyCalendar();this.initGroupCalendar();this.initMemberCalendars();this._initTargetHeader();this._initGroup();this._initChoosenMenu()},destroyCalendar:function(){this.$mjPage.find(".jsch-cal-sel-group").unbind("click");var b=this.$mjPage.find(".jsch-cal-list");b.undelegate(".jsch-cal-change","click");b.undelegate(".jsch-cal-mail","click");this.destroyMyCalendar();this.destroyGroupCalendar();this.destroyMemberCalendars();this.callBase("destroyCalendar")},getPrintPageUrl:function(){var b=this.callBase("getPrintPageUrl");if(!this.baseParams.gid){b+="&gid="+this.$mjPage.find('input[name="gid"]').val()}b+="&row="+this.getPrintPageStartRow();return b},getMultiRequestAsArray:function(){var b=this.callBase("getMultiRequestAsArray");if(!window[this.preloadedGroupRestKey]){b.push(this.getParamsForGroupEvents())}if(!window[this.preloadedMemberRestKey]){b.push(this.getParamsForMemberEvents())}return b},getParamsForPage:function(){var d=this.callBase("getParamsForPage");var c=desknets.pageframe.getLoginUid();var b=desknets.cal.settings.of(this.getModuleName());d.row=this.startRow;d.num=b.row;if(!!this.narrowIds){d.id=neo.array.remove(this.narrowIds,c);d.selkind="select";d.num=desknets.sch.MAX_SCHSELECTLIST}return d},getParamsForEvents:function(){return{cmd:this.cmds.cmdPrivate,date:neo.dateTime.format("yyyyMMdd",this.date),proc:this.getSchCalParamProc()}},getParamsForCalendar:function(d,b,c){var e=this.callBase("getParamsForCalendar",d,b);if(!!c&&!!c.user){e.id=c.user}return e},getParamsForRefer:function(c){var d=this.callBase("getParamsForRefer",c);if(!c.hasClass("todo")){var b=c.closest(".jsch-cal");this._filterTargetToParams(d,b)}return d},getParamsForAdd:function(d,e,c){var f=this.callBase("getParamsForAdd",d,e,c);var b=c.closest(".jsch-cal");this._filterTargetToParams(f,b);return f},setMultiResponse:function(d,b){var c;this.callBase("setMultiResponse",d,b);c=this.getCalendarRest(d,b,this.preloadedGroupRestKey);if(!!c){this.replaceItems(c,"group")}c=this.getCalendarRest(d,b,this.preloadedMemberRestKey);if(!!c){this.updateMemberCalendar(c)}this._printName=c.evgname},replaceCalItems:function(b,c){var d=Number(c);if(!isNaN(d)&&d!=0){this.replaceMembersCalItems(b,d)}else{if(c=="group"){this.replaceGroupsCalItems(b)}else{this.replaceMyCalItems(b)}}},isToDoShown:function(){var b=desknets.pageframe.getLoginUid();if(desknets.cal.settings.of("sch").todo!="1"){return false}return true},isMyData:function(b){if(b.closest(".jsch-cal").data("target")=="me"){return true}return false},initMyCalendar:function(){},initGroupCalendar:function(){},initMemberCalendars:function(){},destroyMyCalendar:function(){},destroyGroupCalendar:function(){},destroyMemberCalendars:function(){},getParamsForGroupEvents:function(){return{cmd:this.getParamCommandGroupPrivate(),date:neo.dateTime.format("yyyyMMdd",this.date),proc:this.getSchCalParamProc(),gid:this.baseParams.gid}},getParamsForMemberEvents:function(){var c=desknets.cal.settings.of(this.getModuleName());var b=desknets.pageframe.getLoginUid();var d={cmd:this.getParamCommandGroup(),date:neo.dateTime.format("yyyyMMdd",this.date),proc:this.getSchCalParamProc(),gid:this.baseParams.gid,row:this.startRow,num:c.row};if(!!this.narrowIds){d.id=neo.array.remove(this.narrowIds,b);d.gid="select";d.num=desknets.sch.MAX_SCHSELECTLIST}return d},getParamsForNarrowedCalendar:function(c){var b=!!c.user||c.group;return{cmd:this.getSchCalAreaCmd(),date:neo.dateTime.format("yyyyMMdd",this.date),selkind:b?"select":[],gid:this.baseParams.gid,id:b?c.user:[]}},getParamsForAddSelected:function(b){return{cmd:this.cmds.addTarget,date:neo.dateTime.format("yyyyMMdd",this.date),id:!!b.user?b.user:[],gid:!!b.group?b.group:[]}},getParamCommandGroup:function(){return desknets.sch.CMD_RSCHGROUP},getParamCommandGroupPrivate:function(){return desknets.sch.CMD_RSCHPRIVATEGROUP},updateMemberCalendar:function(d){var c=this,h={};var e=desknets.ajax.getJsonItems(d);a.each(e,function(i,j){h[j.id]=j});for(var g in this.memberCalendars){var f=this.memberCalendars[g];var b=h[g];if(!!b){c.updateCalendar({id:g,add:!!b.accessadd});c.replaceItems(b,g)}else{c.updateCalendar({id:g,add:false});c.replaceItems({},g)}}this.updatePager(d)},replaceMyCalItems:function(b){},replaceGroupsCalItems:function(b){},replaceMembersCalItems:function(b,c){},updatePager:function(d){var b=this;var e=desknets.ajax.getJsonItems(d).length;var c=b.$mjPage.find(".jco-back-page-data .jco-pv-num").val();if(!!this.narrowIds){c=desknets.sch.MAX_SCHSELECTLIST}b.$mjPage.find(".co-actionwrap").each(function(){desknets.Pager.output(this,".co-page",{getCount:e,allCount:d.allcnt||e,pageMaxView:Number(c)||e,startRow:d.row||0,clickFunc:function(g){var f=b.getParamsForPage();f.row=g;b._setLocationHash(f,false)}})})},_initTargetHeader:function(){var b=this;var c=b.$mjPage.find(".jsch-cal-list");c.delegate(".jsch-cal-change","click",function(d){d.preventDefault();b._showOtherCalendar(a(this))});c.delegate(".jsch-cal-mail","click",function(f){f.preventDefault();var g=a(this).attr("href").substring(1);var e={to:g};var d=desknets.pageframe.getLoginMailLink();desknets.webmail.openMailEditByMailLink(e,null,d)});c.delegate(".jsch-cal-memo","click",function(e){e.preventDefault();var d=a(this).parent().find(".sch-gcal-target").text();var f=a(this).attr("href").substring(1);desknets.sch.util.memo.init(f,d)})},_initGroup:function(){var b=this;var d=b.$mjPage.find(".jsch-cal-sel-group");if(d.length<=0){d=b.$mjPage.find('select[name="gid"]');d.change(function(f){a(f.target).blur();b._changeGroup(a(this).val())})}else{d.click(function(f){b._openGroupChoser()})}if(!!b.baseParams.gid){var c=b.$mjPage.find('input[name="gid"]').val();if(b.baseParams.gid!=c&&!isNaN(Number(c))){b.baseParams.gid=c;var e=desknets.paramanalyzer.getHashParams();e.gid=c;desknets.sch.util.savePageParams(b._getSaveParamNames(),e)}}},_initChoosenMenu:function(){var b=this;desknets.sch.util.calbox.initGroupCheck(this.$mjPage.find("form"),a.extend({},{add:function(c){var d=b.getParamsForAddSelected(c);if(!!d){b._setLocationHash(d,false)}},narrow:function(c,d){var f=b.getParamsForNarrowedCalendar(c);var e=desknets.paramanalyzer.getHashParams();if(b.getboolObjectSame(e,f)){return false}else{b._setLocationHash(f,false)}return true},},b._initChoosenMenuOpt()))},_initChoosenMenuOpt:function(){var b=this;return{selected:b.narrowSelectIds,type:"user"}},getboolObjectSame:function(i,c){var d=this;var e;e=true;if(c.length!=i.length){e=false}else{for(var f in c){if(f!="id"&&f!="pid"){if(c[f]!=i[f]){e=false;break}}else{var b=c[f];var h=i[f];if(!b){b=[]}else{if(typeof b=="string"){b=[b]}}if(!h){h=[]}else{if(typeof h=="string"){h=[h]}}if(b.length!=h.length){e=false}else{for(var g in b){if(b[g]!=h[g]){e=false;break}}}}}}return e},_openGroupChoser:function(){var b=this;var d="sch-cal-chooser-"+b.getSchCalAreaCmd();var c=b.$mjPage.find('input[name="gid"]').val();desknets.chooser.open(d,{chooseTarget:["group"],mode:"single",defaultGroupId:(Number(c)<0?"all":c),selectedTabIndex:(Number(c)<0?1:0),choosePrivateGroup:"choosable",allGroup:"choosable",unassignGroup:"choosable",choose:function(e){if(e.length>0&&e[0].type=="group"){b._changeGroup(e[0].id)}}})},_changeGroup:function(c){var b=this.getParamsForCalendar(this.getSchCalAreaCmd(),this.date);desknets.sch.delGrpListAllCheckOptionSelect();b.gid=c;b.row=0;this._setLocationHash(b,false)},_showOtherCalendar:function(d){var b=d.closest(".jsch-cal");var c=d.attr("href").substring(5);var e=this.getParamsForCalendar(c,this.date);this._filterTargetToParams(e,b);if(!e.gid&&!!this.baseParams.gid){e.gid=this.baseParams.gid}this._setLocationHash(e,false)},_filterTargetToParams:function(d,b){var c=b.data("target");var e=Number(c);if(!!d.id){delete d.id}if(!!d.gid){delete d.gid}if(!isNaN(e)&&e!=0){d.id=e}else{if(c=="group"){d.gid=this.$mjPage.find('.jco-back-page-data>input[name="gid"]').val()}else{if(c=="me"){d.id=desknets.pageframe.getLoginUid()}}}},_resetSubWinMenu:function(){desknets.sch.subwin.dispGroupMenu(true);desknets.sch.subwin.setSubwinMonthCal(false)}});desknets.page(desknets.sch,"schdaygrp",desknets.sch.schgcal,{TIMEBAR_HEIGHT:82,timeMeter:desknets.cal.TimeHorizontal.prototype,myCalendar:desknets.cal.FullTimeList.prototype,myTimeLine:desknets.cal.TimeHorizontal.prototype,groupCalendar:null,groupTimeLine:null,memberCalendars:{},memberTimeLines:{},narrowSelectIds:{},_$timeLines:a(),_$fullTimes:a(),_dragging:false,getPrintPageID:function(){return"schprtdaygroup"},initCalendar:function(){this._$timeLines=this.$mjPage.find(".sch-gday-timebar");this._$fullTimes=this.$mjPage.find(".sch-gday-allday");var b=this._$timeLines.find(".jsch-time-group-cal").eq(0);this.timeMeter=new desknets.cal.TimeHorizontal(b);this.timeMeter.setDate(this.date);this.callBase("initCalendar");this._initScroller()},initMyCalendar:function(){var e=this._$timeLines.find(".jsch-my-group-cal");var b=this._$fullTimes.find(".jsch-my-group-cal");var c=this.getModuleName(),d={movable:true,resizable:true};this.myTimeLine=new desknets.cal.TimeHorizontal(e,c,d);this.myTimeLine.setDate(this.date);this.myCalendar=new desknets.cal.FullTimeList(b);this.myCalendar.setDate(this.date)},initGroupCalendar:function(){var e=this._$timeLines.find(".jsch-groups-group-cal");var b=this._$fullTimes.find(".jsch-groups-group-cal");var c=this.getModuleName(),d={movable:true,resizable:true};if(e.length>0&&b.length>0){this.groupTimeLine=new desknets.cal.TimeHorizontal(e,c,d);this.groupTimeLine.setDate(this.date);this.groupCalendar=new desknets.cal.FullTimeList(b);this.groupCalendar.setDate(this.date)}},initMemberCalendars:function(){var c=this;var b={};var e={};var d=this.getModuleName(),f={movable:true,resizable:true};c.memberTimeLines=b;c.memberCalendars=e;this._$timeLines.find(".jsch-members-group-cal").each(function(){var h=a(this);var g=new desknets.cal.TimeHorizontal(h,d,f);g.setDate(c.date);c.memberTimeLines[h.data("target")]=g});this._$fullTimes.find(".jsch-members-group-cal").each(function(){var g=a(this);var h=new desknets.cal.FullTimeList(g);h.setDate(c.date);c.memberCalendars[g.data("target")]=h})},onSuccess:function(c){this.callBase("onSuccess",c);if(a(document.documentElement).hasClass("co-browser-IE-10")){var b=this;this._$timeLines.css("position","static");setTimeout(function(){b._$timeLines.css("position","relative")},100)}},showCalendar:function(){desknets.sch.util.calbox.scrollTo("horizontal",this._$timeLines,this.myTimeLine.pixelPerUnit)},updateCalendar:function(b){var c=b.id;if(!!c){if(!!this.memberTimeLines[c]){this.memberTimeLines[c].setSelectable(b.add)}if(!!this.memberCalendars[c]){this.memberCalendars[c].setSelectable(b.add)}}},destroyCalendar:function(){desknets.sch.util.calbox.destroyHourScroll(this._$timeLines);this.timeMeter.destroy();this.timeMeter=null;this.callBase("destroyCalendar")},destroyMyCalendar:function(){this.myTimeLine.destroy();this.myTimeLine=null;this.myCalendar.destroy();this.myCalendar=null},destroyGroupCalendar:function(){if(this.groupTimeLine!=null&&this.groupCalendar!=null){this.groupTimeLine.destroy();this.groupTimeLine=null;this.groupCalendar.destroy();this.groupCalendar=null}},destroyMemberCalendars:function(){var b;for(b in this.memberTimeLines){this.memberTimeLines[b].destroy()}this.memberTimeLines={};for(b in this.memberCalendars){this.memberCalendars[b].destroy()}this.memberCalendars={}},getParamsForAdd:function(c,d,b){var e=this.callBase("getParamsForAdd",c,d,b);if(b.closest(".sch-gday-timebar").length>0){e.starttime=neo.dateTime.format("HHmm",c);e.endtime=neo.dateTime.format("HHmm",d)}else{e.starttime="0000";e.endtime="2400"}return e},setMultiResponse:function(c,b){this.callBase("setMultiResponse",c,b);this._updateTimeBarHeight()},replaceCalItems:function(b,c){this.callBase("replaceCalItems",b,c);this.timeMeter.setDate(this.date)},replaceMyCalItems:function(b){var c=this._filterItemsForCal(b);this.myTimeLine.setDate(this.date);this.myTimeLine.replaceItems(c.timeBar);this.myCalendar.setDate(this.date);this.myCalendar.replaceItems(c.fullTime)},replaceGroupsCalItems:function(b){if(this.groupTimeLine!=null&&this.groupCalendar!=null){var c=this._filterItemsForCal(b);this.groupTimeLine.setDate(this.date);this.groupTimeLine.replaceItems(c.timeBar);this.groupCalendar.setDate(this.date);this.groupCalendar.replaceItems(c.fullTime)}},replaceMembersCalItems:function(b,d){var c=this._filterItemsForCal(b);if(!!this.memberTimeLines[d]){this.memberTimeLines[d].setDate(this.date);this.memberTimeLines[d].replaceItems(c.timeBar)}if(!!this.memberCalendars[d]){this.memberCalendars[d].setDate(this.date);this.memberCalendars[d].replaceItems(c.fullTime)}},setCalPrintWindow:function(f){var b=this.$mjPage.find(".sch-gday-timebar"),e=f.$(".sch-gday-timebar");var c,d;this._printDate=neo.dateTime.format(desknets.Resource.longDateFormat,this.date);f.$('input[type="checkbox"],.jco-dndscroll-btn,.sch-icon-1,.sch-icon-7,.sch-icon-31,.sch-icon-memo,.sch-icon-mail').remove();e.css("overflow","hidden");e.children().css("margin-left","-"+b.scrollLeft()+"px");c=this.callBase("setCalPrintWindow",f);d=f.$('<div class="sch-gday-wrap sch-cal-group-day" />');d.width(this.$mjPage.find(".sch-cal-group-day").width());f.$("#jco-print-body > *").wrapAll(d).parent().eq(0).before(c);return c},getSchCalParamProc:function(){return desknets.sch.schcal.REQ_PROC_DAY},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHGDAY},getPageElement:function(){return this.$mjPage.find(".sch-cal-group-day")},isHolidayShown:function(){return false},_initChoosenMenuOpt:function(){var b=this;return{selected:b.narrowSelectIds,type:"user"}},_initScroller:function(){var b=this;desknets.sch.util.calbox.initDragScroll(b._$timeLines,{cancel:".cal-h-meter-body",leftButton:b.$mjPage.find(".sch-gday-time-prev"),rightButton:b.$mjPage.find(".sch-gday-time-next"),moveInterval:50,movePixel:20});desknets.sch.util.calbox.initHourScroll("horizontal",b._$timeLines,this.myTimeLine.pixelPerUnit,this.getModuleName())},_filterItemsForCal:function(c){var b={fullTime:[],timeBar:[]};for(var d=0;d<c.length;d++){if(c[d].isFullTime()&&!c[d].allday){b.fullTime.push(c[d])}else{b.timeBar.push(c[d])}}return b},_updateTimeBarHeight:function(){var c=this;var e=c.$mjPage.find(".sch-gday-target>.sch-gcal-target-header");var d=c.$mjPage.find(".sch-gday-timebar .cal-h-meter-body");var b=c.$mjPage.find(".sch-gday-allday>.cal-timebar-allday");d.each(function(g){var j=a(this);var f=b.eq(g);var i=c.TIMEBAR_HEIGHT;i=Math.max(j.children(".cal-h-box-data").height(),i);i=Math.max(f.find(".cal-allday-box-data").outerHeight(),i);e.eq(g).height(i);j.height(i);b.eq(g).height(i)})}});desknets.page(desknets.sch,"schweekgrp",desknets.sch.schgcal,{myCalendar:desknets.cal.DateHorizontal.prototype,groupCalendar:null,_$calendars:a(),_myHolidays:null,narrowSelectIds:{},getPrintPageID:function(){return"schprtweekgroup"},initCalendar:function(){this._$calendars=this.getWeekGrpCalendars();this._$calendars.addClass("cal-h-cell jsch-cal");this._$calendars.each(function(){a(this).data("target",a(this).find(">tbody>tr").data("target"))});this.callBase("initCalendar")},getWeekGrpCalendars:function(){return this.$mjPage.find(".jsch-cal-list>.sch-gcal-target")},initMyCalendar:function(){var c=this._$calendars.filter(".me:first").find(".cal-h-week");var b={date:this.date,movable:true};this.myCalendar=new desknets.cal.DateHorizontal(c,"sch",b)},initGroupCalendar:function(){var c=this._$calendars.filter(".group:first").find(".cal-h-week");if(c.length>0){var b={date:this.date,showHolidayName:false,movable:true};this.groupCalendar=new desknets.cal.DateHorizontal(c,"sch",b)}},initMemberCalendars:function(){var b=this;var c={};b.memberCalendars=c;this._$calendars.filter(".other").each(function(){var f=a(this);var d=f.children(".cal-h-week");var e={date:b.date,showHolidayName:false,movable:true};var g=b.getWeekGrpCalObj(d,e);if(f.find(".sch-gcal-target-header-title").length==0){g.headerHeight=0}b.memberCalendars[f.data("target")]=g})},getWeekGrpCalendarDate:function(){return this.date},getWeekGrpCalObj:function(b,c){return new desknets.cal.DateHorizontal(b,"sch",c)},updateCalendar:function(b){var c=b.id;if(!!c&&!!this.memberCalendars[c]){this.memberCalendars[c].setSelectable(b.add)}},destroyMyCalendar:function(){this.myCalendar.destroy();this.myCalendar=null},destroyGroupCalendar:function(){if(this.groupCalendar!=null){this.groupCalendar.destroy();this.groupCalendar=null}},destroyMemberCalendars:function(){for(var b in this.memberCalendars){this.memberCalendars[b].destroy()}this.memberCalendars={}},getParamsForHolidays:function(){var b=this.callBase("getParamsForHolidays");b.enddate=neo.dateTime.format("yyyyMMdd",neo.dateTime.moveDate(this.date,6));return b},getParamsForToDo:function(){var c=this.callBase("getParamsForToDo");var b=neo.dateTime.moveDate(this.date,6);c.srch_limdate_e=neo.dateTime.format("yyyyMMdd",b);return c},getHolidayItems:function(d,c){var b=this.callBase("getHolidayItems",d,c);this._myHolidays=b;return b},replaceMyCalItems:function(b){this.myCalendar.setDate(this.date);this.myCalendar.replaceItems(b)},replaceGroupsCalItems:function(b){if(this.groupCalendar!=null){if(!!this._myHolidays){a.merge(b,this._myHolidays)}this.groupCalendar.setDate(this.date);this.groupCalendar.replaceItems(b)}},replaceMembersCalItems:function(b,c){if(!!this.memberCalendars[c]){if(this.memberCalendars[c].$root.find(".cal-day-header").length>0&&!!this._myHolidays){a.merge(b,this._myHolidays)}this.memberCalendars[c].setDate(this.getWeekGrpCalendarDate());this.memberCalendars[c].replaceItems(b)}},setCalPrintWindow:function(g){var d,c,f=desknets.Resource.longDateFormat;var b,e;d=neo.dateTime.format(f,this.date);c=neo.dateTime.format(f,neo.dateTime.moveDate(this.date,6));this._printDate=d+" "+desknets.Resource.kara+" "+c;g.$('input[type="checkbox"],.sch-icon-1,.sch-icon-7,.sch-icon-31,.sch-icon-memo,.sch-icon-mail').remove();b=this.callBase("setCalPrintWindow",g);e=g.$('<div class="sch-gweek sch-cal-group-week" />');g.$("#jco-print-body > *").wrapAll(e).parent().eq(0).before(b);return b},getSchCalParamProc:function(){return desknets.sch.schcal.REQ_PROC_WEEK},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHGWEEK},getPageElement:function(){return this.$mjPage.find(".sch-cal-group-week")},_initChoosenMenuOpt:function(){var b=this;return{selected:b.narrowSelectIds,type:"user"}},getCmdForCalendar:function(b,c){if(b=="day"){if(c.data("target")=="me"){this.baseParams.id=desknets.pageframe.getLoginUid();return desknets.sch.PAGE_SCHDAY}else{return desknets.sch.PAGE_SCHGDAY}}return this.callBase("getCmdForCalendar",b)}});desknets.page(desknets.sch,"schdaysel",desknets.sch.schdaygrp,a.extend({},desknets.sch.util.sel,{_getUserChoser:function(){var b=this;return desknets.chooser.getItemsFromElement(b.$mjPage.find(".jsch-cal-list"))},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHDAYSEL}}));desknets.page(desknets.sch,"schweeksel",desknets.sch.schweekgrp,a.extend({},desknets.sch.util.sel,{getCmdForCalendar:function(b,c){if(b=="day"){if(c.data("target")=="me"){this.baseParams.id=desknets.pageframe.getLoginUid();return desknets.sch.PAGE_SCHDAY}else{return desknets.sch.PAGE_SCHDAYSEL}}return this.callBase("getCmdForCalendar",b)},_getUserChoser:function(){var b=this;return desknets.chooser.getItemsFromElement(b.$mjPage.find(".jsch-cal.other"))},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHWEEKSEL}}));(function(b){desknets.page(desknets.sch,"subwin",desknets.PageSubwinSearch,{_checkbox:{rankflg:"2",reserve:"2",flag:"1",visitflg:"1",sfuture:"1"},_selUserTmpl:'<span title="{{name}}">{{name}}</span><input type="hidden" name="{{keyName}}" value="{{id}}" />',targetMonth:null,calTemplate:null,calWeekTmpl:null,calDayTmpl:null,sundayRight:"0",holidayDisp:"1",boConnecting:false,newTargetDate:null,monthTargetDate:null,calHoliday:null,nWidthCalDay:0,boDispGroup:false,boMonth:false,_firstTime:false,_isInit:false,_userDialog:null,init:function(){this._mIdPageForm=b("#subwinfrm");this._initPageEnterKeysSubmitFormCancel();this._initSchSWinSaveInfo();this._initSchSWinRegistryMenuEvent();this._initSchSWinRegistryToggleEvent();this._initSchSWinRegistryCalEvent();this._initSchSWinRegistryPSetEvent();this._initSchSWinTabSelect();this._initSchSWinUserSelectDialog();this._initSchSWinHarhSet();this.callBase("init");if(this._isSchSWinOpen()){this.newTargetDate=b("#jsch-swin-caldate").val();this._firstTime=true;this._sendRequestAjax()}this._isInit=true},_getSearchPrm:function(e){var d=0;var f=b("#subwinfrm").formToArrayEx();b.extend(f,e);for(var c in this._checkbox){if(!f[c]){f[c]=""}}if(f.outflg_in){d=1;delete f.outflg_in}if(f.outflg_out){d+=2;delete f.outflg_out}if(d!=0){f.outflg=d}else{f.outflg=""}return f},_execClear:function(){var c=b(".jco-subwindow-search");c.find('select[name="sterm"]').val("3");c.find('input[type="text"]').val("");c.find('input[type="checkbox"]').removeAttr("checked");this.resetTargetUser(c.find(".jsch-search-resetuser").find('input[name="id"]').val(),c.find(".jsch-search-resetuser").find('input[name="loginname"]').val());if(!!this._userDialog){this._userDialog.destroy();this._initSchSWinUserSelectDialog()}},_getMainCmd:function(){return desknets.sch.util.getFuncID()},_getSearchCmd:function(){return desknets.sch.PAGE_SCHSEARCH},_initSchSWinUserSelectDialog:function(){var d=this;var f=b("#jsch-search-choose");var e={chooseTarget:["user"],allGroup:"choosable",choosePrivateGroup:"choosable",unassignGroup:"choosable",mode:"single"};var c=desknets.chooser.getItemsFromElement(f);d._userDialog=desknets.chooser.setUpEntry(f,c,{dialogID:"jscht-search-user-sel",dialogOptions:e,extraVars:{user:{keyName:"search_id"}},template:d._selUserTmpl})},resetTargetUser:function(f,d){var c=this;var e="";e=desknets.tmpl.replaceWordHtml(c._selUserTmpl,"keyName","search_id");e=desknets.tmpl.replaceWordHtml(e,"id",f);e=desknets.tmpl.replaceWord(e,"name",d);b("#jsch-search-choose").find(".jco-sel-items").html(e)},_initSchSWinHarhSet:function(){var c=b(".jco-subwindow-search");var e=desknets.paramanalyzer.getHashParams();c.find('input[name="key"]').val(e.key);for(var d in this._checkbox){if(e[d]==this._checkbox[d]){c.find('input[name="'+d+'"]').attr("checked","checked")}}switch(e.outflg){case"1":c.find('input[name="outflg_in"]').attr("checked","checked");break;case"2":c.find('input[name="outflg_out"]').attr("checked","checked");break;case"3":c.find('input[name="outflg_out"]').attr("checked","checked");c.find('input[name="outflg_in"]').attr("checked","checked");break}if(!!e.sterm){c.find('select[name="sterm"]').val(e.sterm)}if(this.boMonth&&e.date){this.monthTargetDate=desknets.dateTime.moveMonth(e.date,"1")}},_initSchSWinRegistryToggleEvent:function(){var c=this;desknets.menu.$root.on("menuChanged.side",function(d,e){if(c._isSchSWinOpen()){c._saveSchSWinCalWidth();c.newTargetDate=b("#jsch-swin-caldate").val();c._sendRequestAjax()}})},_initSchSWinTabSelect:function(){var c=this;var d=b("#jsch-tab-schmonth");if(d.length>0&&d.hasClass("on")){var e=desknets.pageframe.getServerDate();c.setSubwinMonthCal(true,e)}else{c.boMonth=false}},_saveSchSWinCalWidth:function(){this.nWidthCalDay=b("#jsch-swin-month>.week>.day").width()+4;if(this.nWidthCalDay==4){this.nWidthCalDay=25}},_isSchSWinOpen:function(){if(desknets.pageframe.isSubWinOpen()&&b("#jsch-swin-cal").parent().hasClass("on")){return true}return false},_initSchSWinSaveInfo:function(){this.calTemplate=b("#jsch-swin-cal-tmpl").html();this.calWeekTmpl=b("#jsch-swin-cal-tmpl-week").html();this.calDayTmpl=b("#jsch-swin-cal-tmpl-day").html();this.sundayRight=b("#jsch-swin-sunday").val();this.holidayDisp=b("#jsch-swin-holiday").val();this.targetMonth=b("#jsch-swin-caldate").val()},_initSchSWinRegistryMenuEvent:function(){var c=this;b("#jsch-swin-menu").find("a").filter(":not(.jsch-swin-print):not(.jsch-swin-sel)").click(function(d){d.preventDefault();desknets.pageframe.closeSubWin();c.callFunc(b(this))});b(".jsch-swin-print").click(function(h){var g;h.preventDefault();var f=b(this).attr("href");var d=b(this).attr("target");var e=c._getSchSWinDate();if(b(this).parent().attr("id")=="jsch-swin-gprint"){f=f+"&gid="+desknets.sch.util.page.getGid()}f=f+"&date="+e;desknets.execLocation(f,d);desknets.pageframe.closeSubWin()});b(".jsch-swin-sel").click(function(e){e.preventDefault();if(neo.isSet(desknets.sch.util.pageParams.id)){delete desknets.sch.util.pageParams.id}var d=b(this).attr("href");var f=String(d).match(/#.*cmd=(\w+)/);if(!!f&&f.length>1){desknets.sch.util.goToPage(f[1])}desknets.pageframe.closeSubWin()});c._initSchSWinRegistryMenuEventTargetSet()},_initSchSWinRegistryMenuEventTargetSet:function(){var d=this;var c=b("#dn-s-guide").find(".jsch-swin-target");desknets.clickAlinkExecEvent(c,function(j,h){var i=desknets.sch.util.getFuncID();var g=desknets.getDataAttr(j,"href");if(i==desknets.sch.PAGE_SCHDAY||i==desknets.sch.PAGE_SCHWEEK||i==desknets.sch.PAGE_SCHMONTH){var f=desknets.sch.util.pageParams.id;if(!!f){g=g+"&id="+f}var e=desknets.sch.util.pageParams.gid;if(!!e){g=g+"&gid="+e}if(!neo.isSet(f,{blank:false})&&!neo.isSet(e,{blank:false})){g=g+"&id="+desknets.pageframe.getLoginUid()}}j.attr("href",g)})},callFunc:function(c){var f={};var e=c.attr("href");var g=e.substr(e.indexOf("#"));if(!!g){var d=this._getSchSWinDate();if(g.charAt(0)=="#"){g=g.substring(1)}g=g+"&date="+d;f=desknets.paramanalyzer.splitParam(g)}desknets.paramanalyzer.setLocationHash(f)},_getSchSWinDate:function(){var c=desknets.paramanalyzer.getHashParam("date");if(!c||c.length!=8){c=neo.dateTime.format("yyyyMMdd",desknets.pageframe.getServerDate())}if(this.boMonth){c=c.substr(0,6)+"01"}return c},_initSchSWinRegistryCalEvent:function(){var c=this;b("#jsch-swin-change-today").click(function(d){d.preventDefault();var e=desknets.pageframe.getServerDate();c.newTargetDate=neo.dateTime.format("yyyyMMdd",e);c._sendRequestAjax()});b(".jsch-swin-change-month").click(function(d){d.preventDefault();var e=b(this).attr("href").replace(/#/,"");if(!neo.isSet(c.targetMonth)){c.targetMonth=b("#jsch-swin-caldate").val()}c.newTargetDate=desknets.dateTime.moveMonth(c.targetMonth,e);c._sendRequestAjax()})},_initSchSWinRegistryDataEvent:function(d){var c=this;if(!d||d.length<=0){return}d.delegate(".jsch-swin-calweek","click",function(e){e.preventDefault();var g=b(this).attr("href").replace(/#/,"");var f=desknets.sch.util.getFuncID();if(f==desknets.sch.PAGE_SCHGWEEK||f==desknets.sch.PAGE_SCHGDAY){desknets.sch.util.dispWeekGroup(g)}else{if(f==desknets.sch.PAGE_SCHWEEKSEL||f==desknets.sch.PAGE_SCHDAYSEL){desknets.sch.util.dispWeekSel(g)}else{desknets.sch.util.dispWeek(g)}}desknets.pageframe.closeSubWin()});d.delegate(".jsch-daylink","click",function(e){e.preventDefault();var g=b(this).attr("href").replace(/#/,"");var f=desknets.sch.util.getFuncID();if(f==desknets.sch.PAGE_SCHGWEEK||f==desknets.sch.PAGE_SCHGDAY){desknets.sch.util.dispDayGroup(g)}else{if(f==desknets.sch.PAGE_SCHWEEKSEL||f==desknets.sch.PAGE_SCHDAYSEL){desknets.sch.util.dispDaySel(g)}else{desknets.sch.util.dispDay(g)}}desknets.pageframe.closeSubWin()})},_initSchSWinRegistryPSetEvent:function(){var c=this;b(".jsch-pset-menu").click(function(d){d.preventDefault();c._clickSchSWinAlink(b(this))})},_clickSchSWinAlink:function(c){var d=c.attr("href");desknets.execLocation(d+"&caldate="+this.targetMonth)},getMultiRequest:function(){var c={};var d=0;if(this.boMonth){this.targetMonth=this.monthTargetDate}else{if(!neo.isSet(this.newTargetDate)){var e=desknets.pageframe.getServerDate();this.targetMonth=neo.dateTime.format("yyyyMMdd",e)}else{this.targetMonth=this.newTargetDate}}this.getSchSWinParam(c,d);return c},onSuccess:function(c){this._firstTime=false;this.appendSchSWin(c,0)},getSchSWinParam:function(e,g){var c=this;var f;if(!this._isSchSWinOpen()){return g}if(this.holidayDisp==desknets.sch.SCHHOLIDAYFLG_ON){var d=neo.dateTime.parse(this.targetMonth)||new Date();e[g]={cmd:desknets.sch.CMD_SCHHOLIDAY,startdate:neo.dateTime.format("yyyyMMdd",new Date(d.getFullYear(),d.getMonth(),1)),enddate:neo.dateTime.format("yyyyMMdd",new Date(d.getFullYear(),d.getMonth()+(c.boMonth?2:1),0))};g++}f={};f.cmd=desknets.sch.CMD_RSCHCALENDAR;f.month=this.targetMonth;if(c.boMonth){f.num="2"}e[g]=f;g++;return g},appendSchSWin:function(e,d){if(!neo.isSet(e[d])){return}if(this.holidayDisp==desknets.sch.SCHHOLIDAYFLG_ON){this.calHoliday=e[d];d++}if(this.boMonth){this.appendSchSWinDataMonth(e[d]);this._initSchSWinRegistryDataEvent(b("#sch-swin-cal-month"));this.setSubwinCalTitle(b("#sch-swin-cal-month"))}else{this.appendSchSWinData(e[d]);var c=desknets.dateTime.dispDateTime(this.targetMonth,"longYMFormat");b("#jsch-swin-cal").children(".sch-swin-cal-switch").show();b("#jsch-swin-cal").children(".sch-swin-cal-date").text(c);b("#jsch-swin-caldate").val(this.targetMonth);b("#sch-swin-cal-month").remove()}this._initSchSWinRegistryDataEvent(b("#jsch-swin-month"));this.setSubwinCalTitle(b("#jsch-swin-month"))},resetSchSWinArea:function(d){if(!neo.isSet(d)){return false}var c=d.html;if(!neo.isSet(c)){return false}b("#jsch-swin-cal").empty();b("#jsch-swin-cal").html(c);this._initSchSWinRegistryCalEvent();return true},appendSchSWinData:function(p){var f=[];var o=[];var l=[];var s,q;var n,m;var h;var d;var v;var t,j;o=desknets.cal.item.getItemsFromHoliday(desknets.ajax.getJsonItems(this.calHoliday));n=o.length;m=0;f=desknets.cal.tmplList.getJsonItems(p);h=this.targetMonth.substr(0,6);d=desknets.sch.util.dateTime.getFirstDay(h,this.sundayRight);v=neo.dateTime.format("yyyyMMdd",desknets.pageframe.getServerDate());s=f.length;q=0;for(t=0;t<desknets.sch.MAX_WEEKROW;t++){if(d.substr(0,6)>h){break}l[l.length]='<tr class="week">';l[l.length]=desknets.tmpl.replaceWordChkHtml(this.calWeekTmpl,"week",d);for(j=0;j<7;j++){var k,e;var r,u;var g=this.calDayTmpl;if(d.substr(0,6)!=h){l[l.length]='<td class="day">&nbsp;</td>';d=desknets.dateTime.moveDate(d,1);continue}if(d==v){e=" today"}else{e=""}g=desknets.tmpl.replaceWordChkHtml(g,"class_day",e);e="";if(desknets.sch.util.dateTime.isSunday(j,this.sundayRight)){e=" co-sunday"}else{if(desknets.sch.util.dateTime.isSaturday(j,this.sundayRight)){e=" co-saturday"}}for(;m<n;m++){var c=o[m]["startdate"];if(c<d){continue}else{if(c!=d){break}}e=" co-holiday";break}g=desknets.tmpl.replaceWordChkHtml(g,"class_week",e);g=desknets.tmpl.replaceWordChkHtml(g,"date",d);k=d.substr(6);g=desknets.tmpl.replaceWordChkHtml(g,"day",k);r=null;if(s>q){var i=f[q];if(i.id==d){r=this._editSchSWinSch(i.am,"am",this.calTemplate);u=this._editSchSWinSch(i.pm,"pm",this.calTemplate);q++}}if(r==null){r=this._editSchSWinSch("0","am",this.calTemplate);u=this._editSchSWinSch("0","pm",this.calTemplate)}l[l.length]=desknets.tmpl.replaceWordChkHtml(g,"data",r+u);d=desknets.dateTime.moveDate(d,1)}l[l.length]="</tr>"}b("#jsch-swin-month").html(l.join(""))},appendSchSWinDataMonth:function(n){var o=this;var r=b("#jsch-swin-cal");var g=[];var d=[];var s=[];var h={};var q,j;var p,f;var m=o.targetMonth;var i=o.targetMonth.substr(0,6);b("#sch-swin-cal-month").remove();g=desknets.cal.tmplList.getJsonItems(n);var l=0;var c=0;b.each(g,function(v,w){var u=this;if(u.id.substr(0,6)==i){d[l]=u;l++}else{s[c]=u;c++}});h.slist={item:[]};o.targetMonth=desknets.dateTime.computeMonth(o.targetMonth,"+1");h.slist.item=s;f=desknets.dateTime.dispDateTime(o.targetMonth,"longYMFormat");o.appendSchSWinData(h);j=b("#jsch-swin-month").html();o.targetMonth=m;h.slist.item=d;p=desknets.dateTime.dispDateTime(o.targetMonth,"longYMFormat");o.appendSchSWinData(h);r.children(".sch-swin-cal-switch").hide();r.children(".sch-swin-cal-date").text(p);var t=b('<div id="sch-swin-cal-month">');t.append('<div class="sch-swin-cal-date">'+f+"</div>");t.append('<table class="sch-swin-cal"></table>');var e=r.find("table.sch-swin-cal").eq(0).children("thead").html();var k=t.find(".sch-swin-cal").eq(0);k.append("<thead>"+e+"</thead>");k.append("<tbody>"+j+"</tbody>");r.append(t);t.show()},_editSchSWinSch:function(j,i,d){var c,e;var h;var g,f;if(j=="1"){e=i+" single";c=desknets.Resource.sch["swincal"+i+"s"];h=' title="'+desknets.tmpl.escapeWord(c)+'"'}else{if(j!="0"){e=i+" multi";c=desknets.Resource.sch["swincal"+i+"m"];h=' title="'+desknets.tmpl.escapeWord(c)+'"'}else{e=i+" none";c="&nbsp;";h=""}}d=desknets.tmpl.replaceWordHtml(d,"class_day",e);d=desknets.tmpl.replaceWordHtml(d,"schtitle",h);d=desknets.tmpl.replaceWord(d,"sch",c);return d},dispGroupMenu:function(c){if(c){b("#jsch-swin-gprint").show()}else{b("#jsch-swin-gprint").hide()}this.boDispGroup=c;this.setSubwinCalTitle(b("#jsch-swin-month"))},setSubwinCalTitle:function(d){var c;var e=desknets.sch.util.getFuncID();if(e==desknets.sch.PAGE_SCHWEEKSEL||e==desknets.sch.PAGE_SCHDAYSEL){c=desknets.Resource.sch.swincalsel}else{if(this.boDispGroup){c=desknets.Resource.sch.swincalgw}else{c=desknets.Resource.sch.swincalpw}}d.find(".jsch-swin-calweek").attr("title",c)},setNotChangeHash:function(c){if(this._firstTime){return true}return this.callBase("setNotChangeHash",c)},setSubwinMonthCal:function(g,e){var d=this;if(g==true){d.boMonth=true;var f=neo.dateTime.moveMonth(e,1);d.monthTargetDate=neo.dateTime.format("yyyyMMdd",f);if(!d._firstTime&&d._isInit==true){d._firstTime=true;d._sendRequestAjax()}}else{var c=b("#sch-swin-cal-month");d.targetMonth=null;d.boMonth=false;if(c.length>0&&!c.is(":hidden")){c.hide();var h=desknets.pageframe.getServerDate();d.newTargetDate=neo.dateTime.format("yyyyMMdd",h);d._firstTime=true;d._sendRequestAjax()}}},setConnecting:function(c){if(this._firstTime){return true}if(c&&desknets.sch.util.isConnecting()){return false}desknets.sch.util.setConnecting(c);return true}})})(jQuery);desknets.page(desknets.sch,"schfree",desknets.sch.schweek,{TMPL_SELECTED_USER:'<span class="co-selitem"><span title="{{title}}">{{title}}</span><a title="{{del}}" href="#" class="co-btn co-btn-close">{{del}}</a><input type="hidden" name="id" data-name="{{title}}" data-assigngroup="{{gname}}" value="{{id}}"/></span>',calfreeDisabledElm:[],calfreeNeedCurrent:200,cmds:a.extend({},desknets.sch.cmds,{add:desknets.sch.PAGE_SCHADDTARGET}),_searchExec:false,_prevPageParams:null,freeClickTimer:null,_dataParam:false,_dataError:false,initParamsFromHash:function(c){if(desknets.sch.util.isConnecting()){return}this.$mjPage=a("#jsch-opt-free-page");desknets.sch.util.setBackPage(null,null);var b=desknets.sch.util.pageID;if(neo.isSet(b,{blank:false})&&b!=this.getSchCalAreaCmd()){this._prevPageParams=a.extend({cmd:b},desknets.sch.util.pageParams)}this._onChangePageParams(c);desknets.sch.util.pageID=this.getSchCalAreaCmd();this._resetSubWinMenu()},getLocationFormParam:function(){if(!neo.isSet(this._prevPageParams)){desknets.sch.util.pageID=null}this._setLocationHash(this._prevPageParams,false)},getMultiRequestAsArray:function(){var c=[];var b={};b=this.getParamsForEvents();this._dataParam=false;this._dataError=false;if(b){this._dataParam=true;c.push(b);if(!this._pageLoaded){c.push(this.getParamsForPage())}}else{if(!this._pageLoaded){c.push(this.getParamsForPage())}}if(this.isHolidayShown()){c.push(this.getParamsForHolidays())}return c},getParamsForPage:function(){return{cmd:this.getSchCalAreaCmd(),date:neo.dateTime.format("yyyyMMdd",this.date),id:this._getSchFreeUserID(),pid:this.getSchFreePlantID(),plantsearchkind:this._getSchFreeSearchKind(false)}},getParamsForEvents:function(){var c={};var b=this._getSchFreeUserID();var d=this.getSchFreePlantID();if(b.length==0&&d.length==0){return null}c.cmd=this.getParamCommandPrivate();c.date=this._getSchFreeTargetDate();if(b.length>0){c.id=b}if(d.length>0){c.pid=d}c.plantsearchkind=this._getSchFreeSearchKind(false);return c},setSchCalTitle:function(){this._setTitle(this._getAreaTitle(this.$mjPage))},setMultiResponse:function(f,c){var h=false;var e;if(this._dataParam){e=f[c.index.toString()];if(e.status!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(e.errorno,e.errormessage);this._dataError=true;return}c.index++}if(!this._pageLoaded){this._loadPageWithJson(f[c.index.toString()]);if(!this._pageLoaded){return}c.index++;h=true}if(h){this._initSchFreeInput()}if(e){if(h){this._setMultiResSchFreeTarget(e)}var g=this.getCalItemsFromJson(e);if(g==null){return}if(this.isHolidayShown()){var b=this.getHolidayItems(f,c);a.merge(b,g);g=b}this.replaceCalItems(g);this._destroySchFreeDesabled(this.calfreeDisabledElm);var d=this.getCalItemsPlantFromJson(e);if(d==null){return}this.replaceCalItemsPlant(d);if(this._searchExec||h){this._searchExec=false;this._hideSchFreeTargetInput()}this.$mjPage.find("#sch-schfree").show()}if(h){this._initSchFreeInputDialog()}desknets.sch.util.showPage("opt-free-page");desknets.sch.util.calbox.scrollTo("vertical",this.$mjPage.find(".sch-cal-timelines"),desknets.cal.TimeVertical.prototype.pixelPerUnit)},_initCalendarEvents:function(){var b=this;var c=this.getPageElement();c.bind("navigate.cal",function(e,d){var f=b.getCmdForCalendar(d.type,a(e.target).closest(".jsch-cal"));var g=b.getParamsForCalendar(f,d.date);b._setLocationHash(g,false)});c.bind("add.cal",function(e,d){if(!b._isSchFreeEnableAdd(d)){desknets.cal.selection.unselect();return}var f=b.getParamsForAdd(d.date,d.endDate,a(e.target));b.checkSchFreeEnableAddAjax(f,function(g){desknets.sch.util.setBackPage(b.getSchCalAreaCmd(),"jsch-opt-free-page");b._setLocationHash(g,false);desknets.cal.selection.unselect()})})},getSchCalParamProc:function(){return""},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHFREE},cachePage:function(c){if(desknets.sch.util.pageID!=this.getSchCalAreaCmd()){return false}var b=a.extend({pid:""},this.baseParams);var d=a.extend({pid:""},this._getBaseParams(c));return b.pid==d.pid&&b.id==d.id},_getSaveParamNames:function(){return["id","pid","date","row","plantsearchkind"]},getParamsForAdd:function(c,d,b){var e=this.callBase("getParamsForAdd",c,d,b);e.id=this._getSchFreeUserID();e.pid=this.getSchFreePlantID();return e},replaceCalItems:function(c){var b=c.length;for(var e=0;e<b;e++){var d=c[e];d.event=desknets.Resource.sch.freeReserved}this.callBase("replaceCalItems",c)},isToDoShown:function(){return false},_setMultiResSchFreeTarget:function(b){this._setSchFreeTargetUser(b.otherto,b.gNameHtml);if(b.pids){desknets.sch.schpseldlg.savePSelPlantFromCaller(desknets.ajax.getItems(b.pids.item));desknets.sch.schpseldlg.setPSelPlantToCaller()}},getCalItemsPlantFromJson:function(c){var b=!!c.plantschlist?desknets.ajax.getItems(c.plantschlist.item):[];return desknets.cal.item.getItemsFromSch(b)},replaceCalItemsPlant:function(e){var g;var d;var f;var b;var c=this;a.each(e,function(h,j){var i=c.getSchFreeRoundUp(j.starttime);var k=c.getSchFreeRoundUp(j.endtime);d=c._getSchFreeTargetDate();if(j.startdate==j.enddate){if(j.starttime==j.endtime){k=null}for(g=0;g<c.getSchCalDays();g++){if(d==j.startdate){f=c.getDisableTimeCount("0000",i);b=c.getDisableTimeCount(i,k);c.addDisabledElement(g,f,b);break}d=desknets.dateTime.moveDate(d,1)}}})},getSchFreeRoundUp:function(c){if(c==null||c.length!=4){return c}var b=parseInt(c.substr(3),10);if(b==5||b==0){return c}if(b>5){return desknets.sch.util.dateTime.addTimeMinute(c,10-b)}return desknets.sch.util.dateTime.addTimeMinute(c,5-b)},getDisableTimeCount:function(e,b){if(e==null||e.length!=4||b==null||b.length!=4){return 1}var d=neo.dateTime.parse("20140101"+e+"00");var g=neo.dateTime.parse("20140101"+b+"00");var c=d.getTime();var f=g.getTime();if(c>=f){return 0}return(f-c)/60/1000/5},addDisabledElement:function(d,i,f){var b,h;var c;var e;var g;e=this.timeLines.getDayTimeLine(d);if(i%6==0){g=1}else{g=0}c=a('<div class="sch-disabled" />');e.putSelectionElement(c,d);h=i*desknets.sch.WH_TIME_LINE/6+g;b=f*desknets.sch.WH_TIME_LINE/6-g;c.css({height:b+"px",width:"100%",top:h});this.calfreeDisabledElm.push(c)},_initSchFreeInput:function(){var c=this;var b=this.$mjPage.find("#jsch-free-choose");this.$mjPage.find(".co-pageback").click(function(d){d.preventDefault();c._onClickSchFreeBack()});desknets.htmlparts.setUpForm(this.$mjPage.find("#jsch-frmfree"));this.$mjPage.find(".jsch-freetarget-search").click(function(){c._onClickSchFreeSearch()});desknets.sch.schpseldlg.setUp(this.$mjPage.find("#jsch-free-choose-plant"),this._getSchPlantDlgOptions());this.$mjPage.find(".co-searchaera-open").click(function(d){d.preventDefault();a("#sch-free-input").slideDown().removeClass("close")});this.$mjPage.find('input[value="'+this._getSchFreeSearchKind(true)+'"]').attr("checked",true)},_initSchFreeInputDialog:function(){var d=this;var c=this.$mjPage.find("#jsch-free-choose");var b=desknets.chooser.getItemsFromElement(c);desknets.chooser.setUpEntry(c,b,{dialogID:"jsch-free-choose-dialog",dialogOptions:d._getSchFreeChooserOptions(),extraVars:{user:{keyName:"id"}},filter:function(f,h){var g;var e=[];for(g=0;g<f.length;g++){e[e.length]=f[g].id}if(e.length==0){return}desknets.submitform.setDisabled(d.$mjPage);desknets.ajax.rest({url:desknets.cal.CGI_SCH_REST,data:{cmd:desknets.sch.CMD_SCHFILTARGET,accesskind:desknets.sch.ACCESS_OPEN,id:e},success:function(i){desknets.sch.util.user.onSucessFilter(i,f,h,d.$mjPage,"sch_guide_open_noperm")},error:function(k,i,j){desknets.ajax.onError(k.status,j);desknets.submitform.clearDisabled(d.$mjPage)}})}})},_getSchPlantDlgOptions:function(){return{}},_getSchFreeChooserOptions:function(){return{chooseDisplayGroup:true,choosePrivateGroup:"readonly",allGroup:"readonly",unassignGroup:"readonly",editDescendant:true,chooseTarget:["user"]}},_onClickSchFreeBack:function(){var b=this.getLocationFormParam();if(neo.isSet(b)){this._setLocationHash(b)}},_onClickSchFreeSearch:function(){var b={};this.date=this.$mjPage.find("#jsch-freetarget-date").datepicker("getDate");b=this.getParamsForPage();b.id=this._getSchFreeUserID();b.pid=this.getSchFreePlantID();var c=this._validateSchFree(b.id,b.pid);if(c){desknets.dialog.alert(c);return}b._=desknets.createRandomId();this._searchExec=true;this._setLocationHash(b)},_validateSchFree:function(d,b){if(d.length==0&&b.length==0){return desknets.Resource.Message.sch_freetargetselect}var c=this.$mjPage.find("#jsch-freetarget-date");if(c.hasClass("ui-invalid")){return desknets.Resource.Message.com_datechk_fromto}return null},_setSchCalNeedTime:function(f){var e=0,c;var b=parseInt(f.substr(0,2),10);var d=parseInt(f.substr(2,2),10);if(b>24||(b==24&&d==30)){return}if(d==30){b=b+0.5}while(!!(c=this.timeLines.getDayTimeLine(e))){c.selectSize=c.pixelPerUnit*b;c.maxIndex=24-b;e++}},_hideSchFreeTargetInput:function(){this.$mjPage.find("#sch-free-input").addClass("close").hide()},_getSchFreeTargetDate:function(){return neo.dateTime.format("yyyyMMdd",this.date)},_getSchFreeUserID:function(){if(!this._pageLoaded&&!this._dataError){var b=desknets.paramanalyzer.getHashParams();if(b.id){return b.id}else{return[]}}else{return desknets.sch.util.page.getIDs(this.$mjPage.find("#jsch-free-choose").find('input[name="id"]'))}},getSchFreePlantID:function(){if(!this._pageLoaded&&!this._dataError){var b=desknets.paramanalyzer.getHashParams();if(b.pid){return b.pid}else{return[]}}else{return desknets.sch.util.page.getIDs(this.$mjPage.find("#jsch-free-choose-plant").find('input[name="pid"]'))}},_setSchFreeTargetUser:function(f,c){var d=[];var e=[];if(f){d=desknets.ajax.getItems(f.item)}if(d.length==0){return}if(c){e=desknets.ajax.getItems(c.item)}var m=this;var l=this.$mjPage.find("#jsch-free-choose").find(".jco-sel-items");var i=this.TMPL_SELECTED_USER;var g=l.html();var h=[];for(var j=0;j<d.length;j++){var b=d[j];var k=desknets.tmpl.replaceWordHtml(i,"id",b.id);k=desknets.tmpl.replaceWord(k,"title",b.val);k=desknets.tmpl.replaceWordHtml(k,"del",desknets.Resource.deselectLabel);if(e.length>j){k=desknets.tmpl.replaceWordHtml(k,"gname",desknets.tmpl.escapeWord(a("<div/>").append(e[j].val).text()))}else{k=desknets.tmpl.replaceWordHtml(k,"gname","")}h[h.length]=k}l.empty();l.html(h.join(""))},_getSchFreeSearchKind:function(b){if(!this._pageLoaded&&!this._dataError||b){var c=desknets.paramanalyzer.getHashParams();if(c.plantsearchkind){return c.plantsearchkind}else{return""}}else{var d=this.$mjPage.find('input[name="plantsearchkind"]:checked');if(d.length==1){return d.val()}else{return""}}},_destroySchFreeDesabled:function(b){a.each(b,function(d,c){if(c){c.remove()}});b=[]},_isSchFreeEnableAdd:function(b){return true},checkSchFreeEnableAddAjax:function(e,d){var b=this;var f=this.getSchFreePlantID();var c=a.extend({},e,{cmd:b.getSchFreeCheckAddCmd(),id:[]});if(f.length==0){d(e);return}desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),data:c,success:function(l,h,m){var j=desknets.ajax.getItems(l.pids.item);if(j.length==0){desknets.dialog.alert(desknets.Resource.Message.sch_free_no_available,{close:desknets.cal.selection.unselect()})}else{if(j.length<f.length){var g=[];var n=desknets.tmpl.dispItems(l.pids);for(var i=0;i<j.length;i++){g[g.length]=j[i].id}var k=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.sch_free_available_exist,"plantnames",n);desknets.dialog.confirm(k,function(){var o=a.extend(e,{pid:g});d(o)},{cancel:desknets.cal.selection.unselect()})}else{d(e)}}}})},getSchFreeCheckAddCmd:function(){return desknets.sch.CMD_SCHFREECHECKENTRY},getParamCommandPrivate:function(){return desknets.sch.CMD_SCHFREE},getSchCalDays:function(){return 7}});desknets.page(desknets.sch,"schpseldlg",null,{TMPL_ITEMLIST:'<tr><td class="co-td icon"><a class="co-btn co-btn-close" href="#" title="{{L_Delete}}">{{L_Delete}}</a><input type="hidden" name="pid" value="{{id}}" /></td><td class="co-td"><span class="jplant-selitem"><span data-pid="{{id}}">{{Name}}</span></span></td></tr>',TMPL_ITEMONE:'<span><input type="hidden" name="id" value="{{id}}" />{{name}}</span>',_TMPL_SELECTPLANT:'<li class="sch-pop-rs-search-item jsch-pseldlg-item"><input type="{{type}}" value="{{pid}}" id="{{dialogId}}-{{pid}}" name="pid"/><span class="sch-pseldlg-name jsch-pseldlg-label" data-pid="{{pid}}"><label for="{{dialogId}}-{{pid}}" class="sch-pop-rs-si-label" data-pid="{{pid}}">{{Name}}</label></span></li>',_DIALOG_ID:"jsch-plant-select-dialog",_defaultOptions:{template:'<span class="co-selitem jplant-selitem"><span data-pid="{{id}}">{{Name}}</span><a title="{{L_Delete}}" href="#" class="co-btn co-btn-close">{{L_Delete}}</a><input type="hidden" name="pid" value="{{id}}"/></span>',access:desknets.sch.ACCESS_OPEN,cmd:desknets.sch.CMD_PLANTSELPLANT,cmdgrp:desknets.sch.CMD_PLANTSELPGROUP,pgrouptop:desknets.Resource.sch.plantg_sel_allref,guide_chk:desknets.Resource.sch.pselGuide_chk_ref,guide:desknets.Resource.sch.pselGuide_ref,change:null},_pselGid:"",_templateSelectPlant:null,_templateCallerPlant:null,_pselClickTimer:null,_$dialog:null,_$callerbase:null,_functionChange:null,_options:null,_ids:[],_noDataToSelectHtml:"",resetPlantDlgHtml:function(){if(this._$dialog!=null){this._$dialog.empty();this._$dialog=null}this._pselGid=""},init:function(){if(this._$dialog==null){this._sendSchPSelAjax()}else{this._initSchPSelUnCheck();this._initSchPSelCheck();this._$dialog.dialog("open")}},setUp:function(d,c){var b=this;this._options=a.extend({},this._defaultOptions,c);this._$callerbase=d;this._clearPSelDlgID();if(this._$dialog==null){desknets.sch.plantPopUp.init();this._initSchPSelTemplate();var e=desknets.Resource.deselectLabel;this._templateCallerPlant=desknets.tmpl.replaceWordHtml(this._options.template,"L_Delete",e)}this._initSchPSelCaller();d.find(".jco-sel-btn").click(function(){b.init()})},_initSchPSelCaller:function(){var b=this;var c=this._$callerbase.find(".jco-sel-items");desknets.selitem.registryCloseEvent(c,function(e){var d=a(this).parent().find('input[name="pid"]').val();var f=b._inArray(d,b._ids);if(f>=0){delete b._ids[f]}if(b._options.template==b.TMPL_ITEMLIST){a(this).parent().parent().remove()}b._dispPSelCaller();desknets.sch.plantPopUp.closeTimer(b._pselClickTimer);b._pselClickTimer=null});c.delegate(".jplant-selitem","mouseover",function(e){var d=a(this).find("span");b._pselClickTimer=desknets.sch.plantPopUp.openDelay(d,b._pselClickTimer)});c.delegate(".jplant-selitem","mouseleave",function(){desknets.sch.plantPopUp.closeTimer(b._pselClickTimer);b._pselClickTimer=null});c.on("mouseenter","tr",function(d){var e=a(this);setTimeout(function(){e.addClass("hover")},0)});c.on("mouseleave","tr",function(d){var e=a(this);setTimeout(function(){e.removeClass("hover")},0)})},_dispPSelCaller:function(){var b=this._$callerbase.find(".jplant-selitem");if(b.length>0){this._$callerbase.removeClass("co-sel-no-items")}else{this._$callerbase.addClass("co-sel-no-items")}},_initSchPSelTemplate:function(){this._templateSelectPlant=desknets.tmpl.replaceWordHtml(this._TMPL_SELECTPLANT,"type","checkbox");this._templateSelectPlant=desknets.tmpl.replaceWordHtml(this._templateSelectPlant,"dialogId",this._DIALOG_ID)},_initSchPSelUnCheck:function(){var b=this;var c=this._$dialog.find("#plant-pop-sel-list").find("input:checkbox").filter(":checked");a(c).each(function(){var d=a(this).val();if(b._inArray(d,b._ids)<0){a(this).attr("checked",false)}})},_inArray:function(d,b){var c;for(c=0;c<b.length;c++){if(b[c]){if(b[c].id==d){break}}}if(b.length==c){return -1}else{return c}},_initSchPSelCheck:function(){var b=this;var c=this._$dialog.find("#plant-pop-sel-list").find("input:checkbox");a(c).each(function(){var d=a(this).val();if(b._inArray(d,b._ids)>=0){a(this).attr("checked",true)}})},_sendSchPSelAjax:function(){var b=this;var c;var d;c=desknets.getUrl(desknets.MODULE_API_MAIN);d=desknets.ajax.arrayToMultiCmdData(this._getSchPSelAjaxReq());desknets.ajax.rest({id:this._DIALOG_ID,url:c,data:d,type:"POST",success:function(f,e,g){b._onSuccessSchPsel(f)},complete:function(f,e){b._setSelectDisabled(false)},error:function(g,f,e){if(f!="abort"){desknets.ajax.onError(g.status,e)}}})},_getSchPSelAjaxReq:function(){var c;var b={};var d=0;if(this._$dialog==null){c={};c.cmd=desknets.sch.PAGE_SCHPSELDLG;b[d]=c;d++;c={};c.cmd=this._options.cmdgrp;c.accesskind=this._options.access;b[d]=c;d++}c={};c.cmd=this._options.cmd;c.gid=this._pselGid;c.accesskind=this._options.access;b[d]=c;d++;return b},_onSuccessSchPsel:function(c){var b=0;var d;if(this._$dialog==null){d=this._onSuccess_CallFunc(c[b],this._setSchPSelDlgHtml);if(!d){return}b++;this._onSuccess_CallFunc(c[b],this._setSchPSelDlgPGroup);b++;this._initSchPSelDlgRegistryEvent();this._onSuccess_CallFunc(c[b],this._setSchPSelDlgPlant);b++;this._initSchPSelDlgRegistryEventData();this._initSchPSelCheck();this._$dialog.dialog("open")}else{this._onSuccess_CallFunc(c[b],this._setSchPSelDlgPlant);b++}},_initSchPSelDlgRegistryEvent:function(){var b=this;this._$dialog.find(".jsch-pseldlg-pgroup").change(function(c){a(c.target).blur();b._pselGid=a(this).find("option:selected").val();b._setSelectDisabled(true);b._saveSchPSelPlantID();b._sendSchPSelAjax()})},_initSchPSelDlgRegistryEventData:function(){var b=this;this._$dialog.delegate(".jsch-pseldlg-label","mouseover",function(c){b._pselClickTimer=desknets.sch.plantPopUp.openDelay(a(this),b._pselClickTimer)});this._$dialog.delegate(".jsch-pseldlg-label","mouseleave",function(){desknets.sch.plantPopUp.closeTimer(b._pselClickTimer);b._pselClickTimer=null})},_setSchPSelDlgHtml:function(c){var b=c.html;if(!neo.isSet(b)){return false}this._$dialog=desknets.dialog.make(this._DIALOG_ID,this._getDialogOption());b=desknets.tmpl.replaceWordHtml(b,"Guide_chk",this._options.guide_chk);b=desknets.tmpl.replaceWordHtml(b,"Guide",this._options.guide);b=desknets.tmpl.replaceWordHtml(b,"dialogId",this._DIALOG_ID);this._$dialog.append(b);this._noDataToSelectHtml=this._$dialog.find("#plant-pop-sel-list").html();return true},_setSchPSelDlgPGroup:function(b){desknets.sch.util.plant.setGroupSelect(b,this._options.pgrouptop,this._$dialog.find(".jsch-pseldlg-pgroup"))},_setSchPSelDlgPlant:function(f){var h=[];var e=[];var g;h=desknets.ajax.getJsonItems(f);var b=h.length;if(b<=0){e=[this._noDataToSelectHtml]}else{e[e.length]="<ul>";for(var d=0;d<b;d++){var c=h[d];g=this._templateSelectPlant;g=desknets.tmpl.replaceWordHtml(g,"pid",c.id);g=desknets.tmpl.replaceWord(g,"Name",c.Name);e[e.length]=g}e[e.length]="</ul>"}this._$dialog.find("#plant-pop-sel-list").html(e.join(""));if(neo.isSet(f[desknets.RES_TAG_MSGDISPLIMIT])){this._$dialog.find("#jsch-pseldlg-msg").text(f[desknets.RES_TAG_MSGDISPLIMIT])}else{this._$dialog.find("#jsch-pseldlg-msg").text("")}this._initSchPSelCheck()},_getDialogOption:function(){var b=this;var e={};e[desknets.Resource.OKButtonLabel]=function(){b._saveSchPSelPlantID();b.setPSelPlantToCaller();if(b._options.change){b._options.change()}b._$dialog.dialog("close")};e[desknets.Resource.CancelButtonLabel]=function(){b._$dialog.dialog("close")};var d=desknets.dialog.getDialogOption();var c={title:desknets.Resource.sch.pselDlgTitle,width:700,buttons:e,close:function(){neo.ajax.abort(b._DIALOG_ID,true)}};a.extend(d,c);return d},_setSelectDisabled:function(b){this._$dialog.find(".jsch-pseldlg-pgroup").attr("disabled",b)},_saveSchPSelPlantID:function(){var b=this;var c=this._$dialog.find("#plant-pop-sel-list").find("input:checkbox");a(c).each(function(){var e=a(this).val();var f=b._inArray(e,b._ids);if(a(this).attr("checked")){if(f<0){var d=a(this).next().text();b._savePSelDlgID(e,d)}}else{if(f>=0){delete b._ids[f]}}})},_savePSelDlgID:function(c,b){this._ids.push({id:c,val:b})},_clearPSelDlgID:function(){this._ids=[]},transPSelPlantFromCaller:function(){var b=this;var c=this._$callerbase.find('input[name="pid"]');this._clearPSelDlgID();c.each(function(){var e=a(this).val();var d=a(this).data(desknets.sch.DATA_NAME);b._savePSelDlgID(e,d)});c.remove();this.setPSelPlantToCaller()},savePSelPlantFromCaller:function(b){this._ids=b},setPSelPlantToCaller:function(){var h=this._$callerbase.find(".jco-sel-items");var c=this._templateCallerPlant;var e=h.html();var b=[];var i=this._ids;for(var d=0;d<i.length;d++){var f=i[d];if(f){var g=desknets.tmpl.replaceWordHtml(c,"id",f.id);g=desknets.tmpl.replaceWord(g,"name",f.val);b[b.length]=g}}h.empty();h.html(b.join(""));this._dispPSelCaller()},_onSuccess_CallFunc:function(c,b,d){if(!neo.isSet(c)){return false}if(c.status!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(c.errorno,c.errormessage);return false}return b.apply(this,[c])}});desknets.sch.plantPopUp={TMPL_PLANT:'<div class="sch-plant-pop-up-titlebar">${Name}</div>{{if attach}}<img class="plant-edit-img" src="${attach}">{{/if}}<div id="sch-pop-rs-main"><dl><dt><span class="co-colon">{{L_plantTitleTime}}</span></dt><dd>&nbsp;{{html desknets.sch.util.plant.limitTime(starttime, endtime)}}</dd></dl><dl><dt><span class="co-colon">{{L_plantTitleUseTime}}</span></dt><dd>&nbsp;{{html desknets.sch.util.plant.limitUseTime(usetime)}}</dd></dl><dl><dt><span class="co-colon">{{L_plantTitleHoliday}}</span></dt><dd>&nbsp;{{html desknets.sch.util.plant.limitHolidayUse(holidayuse)}}</dd></dl><dl><dt><span class="co-colon">{{L_plantTitleReserv}}</span></dt><dd>&nbsp;{{html desknets.sch.util.plant.limitReserv(reserve_limit_use, reserve_limited_num, reserve_limited_date)}}</dd></dl><dl><dt><span class="co-colon">{{L_plantTitleReservSch}}</span></dt><dd>&nbsp;{{html desknets.sch.util.plant.limitReservSch(reservschlimit)}}</dd></dl><fieldset><legend class="co-strong">{{L_plantTitleMemo}}</legend>{{html desknets.tmpl.dispStr(memo)}}</fieldset></div>',MAX_POP_MEMOCOL:"50",MAX_POP_MEMOROW:"3",init:function(){var c=desknets.Resource.sch,b;b=this.TMPL_PLANT;b=desknets.tmpl.replaceWord(b,"L_plantTitleTime",c.plantTitleTime);b=desknets.tmpl.replaceWord(b,"L_plantTitleUseTime",c.plantTitleUseTime);b=desknets.tmpl.replaceWord(b,"L_plantTitleHoliday",c.plantTitleHoliday);b=desknets.tmpl.replaceWord(b,"L_plantTitleReserv",c.plantTitleReserv);b=desknets.tmpl.replaceWord(b,"L_plantTitleReservSch",c.plantTitleReservSch);b=desknets.tmpl.replaceWord(b,"L_plantTitleMemo",c.plantTitleMemo);this.TMPL_PLANT=b},close:function(){desknets.popUp.hide("#sch-plant-pop-up")},open:function(b,f,d){var c=this;var e=a.extend({},d);desknets.ajax.rest({url:desknets.cal.CGI_SCH_REST,data:{cmd:desknets.sch.CMD_PLANTINFO,id:f,MemoCol:this.MAX_POP_MEMOCOL,MemoRow:this.MAX_POP_MEMOROW},success:function(g){var h=c._createPopUpBody(b,c.TMPL_PLANT,g)}})},openDelay:function(c,b){var d=this;if(neo.isSet(b)){clearTimeout(b)}b=setTimeout(function(){var e=c.data("pid");if(c.is(":visible")){d.open(c,e)}},desknets.sch.DELAY_MOUSEOVER);return b},closeTimer:function(b){if(neo.isSet(b)){clearTimeout(b)}this.close()},_createPopUpBody:function(b,d,f){var g=this._getBlankPopUp();var e=a('<script type="text/x-jquery-tmpl" />').prop("text",d).tmpl(f);var c={target:b,collision:"flip"};g.find(".jsch-plnat-pop-up-frame").html(e);desknets.popUp.open(g,c);return g},_getBlankPopUp:function(){var b=a("#sch-plant-pop-up");if(b.length<=0){b=a(desknets.popUp.TMPL_POP_UP).attr("id","sch-plant-pop-up");b.children(".co-baloon-body").addClass("jsch-plnat-pop-up-frame")}else{b.attr("class","co-baloon co-pop-up-box");b.find(".jsch-plnat-pop-up-frame").empty()}b.appendTo("body");return b}};desknets.page(desknets.sch,"schsearch",desknets.PageListBase,{TMPL_NoLink:"<span>{{iconHtml}}{{subject}}</span>",TMPL_Link:'<a href="#cmd={{cmd}}&sid={{id}}&seldate={{seldate}}&mydata={{mydata}}" class="jco-modlink" title="{{iconText}}{{subject}}">{{iconHtml}}{{subject}}</a>',_TMPL_Base:null,_TMPL_Base_NoLink:null,_initHtml:function(c){var b=this;b.callBase("_initHtml",c);b._resetSubWinSearch()},_getSearchPageParam:function(){var c={};var b=desknets.paramanalyzer.getHashParams();c.search_id=b.search_id;return c},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()})},_getIdListPage:function(){return"jco-m-search-container"},_getIdListPageForm:function(){return"searchfrm"},_getListCmd:function(){return desknets.sch.PAGE_SCHSEARCH},_getListExecCmd:function(){return desknets.sch.CMD_SCHSEARCH},_getListDispCmd:function(){return desknets.cal.PAGE_SCH_REF},_getListModCmd:function(){return desknets.sch.PAGE_SCHMOD},_getDelCmd:function(){return desknets.sch.CMD_SCHSEARCHDELCONF},_getDelExecCmd:function(){return desknets.sch.CMD_SCHSEARCHDEL},_getDelAddPrm:function(){var b;b=desknets.getInputDataToObj(this.$mjListPage.find(".jco-back-page-data"));return b},_getListDispClass:function(){return desknets.sch.schreferdtl},_getListModClass:function(){return desknets.sch.schmod},initParamsFromHash:function(c){var b=a("#"+this._getIdListPage());if(b.find(".jco-title").length<=0){this.initPage(desknets.sch.util.getBackPage(),desknets.sch.util.getBackId())}this.callBase("initParamsFromHash",c);this._resetSubWinMenu()},_setDelConfirm:function(b){b=b.replace(/\n/g,"<br />");this.callBase("_setDelConfirm",b)},getLocationFormParam:function(){desknets.sch.util.goToPage()},_getListAjaxSuccessData:function(b){this._setSchSearchTitle(b);return desknets.cal.tmplList.getJsonItems(b)},_listLine:function(b,c){if(c.accessopen!=desknets.sch.VAL_SCHACCESSENABLE){if(this._TMPL_Base_NoLink==null){this._TMPL_Base_NoLink=desknets.tmpl.replaceWordHtml(b,"subject",this.TMPL_NoLink)}b=this._TMPL_Base_NoLink}else{if(this._TMPL_Base==null){this._TMPL_Base=desknets.tmpl.replaceWordHtml(b,"subject",this.TMPL_Link)}b=this._TMPL_Base}var d=desknets.cal.tmplList.getRowHtml(b,c);var e=String(c.sid).split("_");d=desknets.tmpl.replaceWordHtml(d,"cmd",this._getListDispCmd());d=desknets.tmpl.replaceWordHtml(d,"id",e[0]);d=desknets.tmpl.replaceWordHtml(d,"seldate",e[2]||"");var f=desknets.paramanalyzer.getHashParams();var g="0";if(!f.search_id||f.search_id==desknets.pageframe.getLoginUid()){g="1"}d=desknets.tmpl.replaceWordHtml(d,"mydata",g);return d},inputModPage:function(e){var b=this;var d="";var c={};d=b._getListModCmd();c=b._getModPageParam();c.cmd=d;c.seldate=desknets.cal.tmplList.getSelDate(e,this._isSchSearchGetSelDate());c[b._getIDName()]=desknets.cal.tmplList.getId(e);desknets.sch.util.setBackPage(this._getListCmd(),this._getIdListPage());b._inputPage(c)},inputDispPage:function(f){var b=this;var e="";var c={};e=b._getListDispCmd();c=b._getDispPageParam();c.cmd=e;c.seldate=desknets.cal.tmplList.getSelDate(f,this._isSchSearchGetSelDate());c[b._getIDName()]=desknets.cal.tmplList.getId(f);var d=desknets.paramanalyzer.getHashParams();if(!d.search_id||d.search_id==desknets.pageframe.getLoginUid()){c.mydata="1"}else{c.mydata="0"}desknets.sch.util.setBackPage(this._getListCmd(),this._getIdListPage());b._inputPage(c)},_getIDName:function(){return"sid"},_setTitle:function(b){},_setSchSearchTitle:function(c){var b=this._getAreaTitle(this.$mjListPage);a("#jco-m-sub-title").html(b+c.title)},_resetSubWinMenu:function(){desknets.sch.subwin.dispGroupMenu(false)},_resetSubWinSearch:function(){var b=this;var d=b.$mjListPage.find(".jsch-search-resetuser").find('input[name="id"]').val();var c=b.$mjListPage.find(".jsch-search-resetuser").find('input[name="Name"]').val();if(d!==""&&c!==""){desknets.sch.subwin.resetTargetUser(d,c)}},_isSchSearchGetSelDate:function(){return false}});desknets.page(desknets.sch,"schlistweek",desknets.sch.schsearch,{_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");this.$mjListPage.find(".jsch-change-date").click(function(d){d.preventDefault();var e=a(this).attr("href").replace(/#/,"");var c=b._getSchListTargetDate();e=desknets.dateTime.moveDate(c,e);b._changeSchListDate(e)});this.$mjListPage.find(".jsch-change-today").click(function(c){c.preventDefault();var d=desknets.pageframe.getServerDate();b._changeSchListDate(neo.dateTime.format("yyyyMMdd",d))})},_getIdListPage:function(){return"jsch-opt-listw-page"},_getIdListPageForm:function(){return"listwfrm"},_getListCmd:function(){return desknets.sch.PAGE_SCHLISTWEEK},_getListExecCmd:function(){return desknets.sch.CMD_SCHLIST},_getDelCmd:function(){return desknets.sch.CMD_SCHLISTDELCONF},_getDelExecCmd:function(){return desknets.sch.CMD_SCHLISTDEL},_getDelAddPrm:function(){var b;b=desknets.getInputDataToObj(this.$mjListPage.find(".jco-back-page-data"));b.proc=desknets.sch.PROC_WEEK;return b},_getSearchExecParam:function(){var b=desknets.paramanalyzer.getHashParams();b.proc=desknets.sch.PROC_WEEK;return b},_setTitle:function(b){a("#jco-m-sub-title").html(b)},_setSchSearchTitle:function(b){a(".sch-date").text(b.title)},_getSchListTargetDate:function(){return this.$mjListPage.find(".jco-back-page-data").find('input[name="date"]').val()},_changeSchListDate:function(c){this.$mjListPage.find(".jco-back-page-data").find('input[name="date"]').val(c);this.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val("0");var b=desknets.getInputDataToUrl(this.$mjListPage.find(".jco-back-page-data"));b=b+"&cmd="+this._getListCmd();this._setLocationHash(b)},_isSchSearchGetSelDate:function(){return true},_resetSubWinSearch:function(){}});desknets.page(desknets.sch,"schlistmonth",desknets.sch.schlistweek,{_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");this.$mjListPage.find(".jsch-change-month").click(function(d){d.preventDefault();var e=a(this).attr("href").replace(/#/,"");var c=b._getSchListTargetDate();e=desknets.dateTime.moveMonth(c,e);b._changeSchListDate(e)})},_getIdListPage:function(){return"jsch-opt-listm-page"},_getIdListPageForm:function(){return"listmfrm"},_getListCmd:function(){return desknets.sch.PAGE_SCHLISTMONTH},_getDelAddPrm:function(){var b;b=desknets.getInputDataToObj(this.$mjListPage.find(".jco-back-page-data"));b.proc=desknets.sch.PROC_MONTH;return b},_getSearchExecParam:function(){var b=desknets.paramanalyzer.getHashParams();b.proc=desknets.sch.PROC_MONTH;return b}});desknets.sch.input={};desknets.page(desknets.sch,"SchInputBase",desknets.PageInputBase,{_type:"normal",_dialogNames:["plant","user","recurrence","dates","attach","approval","alarm","visitor","option","publiclevel"],_$dateRow:null,_TMPL_SCH_EVENT:'<li class="co-select-menu-pull-down-item"><a href="#" data-value="" title=""><span class="jsch-event-name"></span></a></li>',initReqSend:function(){this.initPage(desknets.sch.util.getBackPage(),desknets.sch.util.getBackId())},getMultiRequest:function(){var c=this.callBase("getMultiRequest");var b=desknets.attach.ext.getListParam();if(!!b){c["1"]=b}return c},getLocationFormParam:function(){var b=this.callBase("getLocationFormParam");if(!b||desknets.sch.util.isTopPage(b.cmd)){b={cmd:desknets.sch.util.pageID};a.extend(b,desknets.sch.util.pageParams)}return b},_initSet:function(b){this.callBase("_initSet");if(!!b["1"]){desknets.attach.ext.saveList(b["1"])}this._setUp()},_getErrorPlace:function(g){var f=desknets.Resource;if(!g){return""}else{if(g=="startdate"){return f.sch.startDateLabel+desknets.merrMsgConnect}else{if(g=="enddate"){return f.sch.endDateLabel+desknets.merrMsgConnect}}}var e=this.callBase("_getErrorPlace",g);if(!!e){return e}for(var d in desknets.sch.input){var c=desknets.sch.input[d];if(!!c.getErrorPlace&&!!c.id){e=c.getErrorPlace(g);if(!!e){var b=this.$mjPage.find(".jsch-title-"+c.id).text();return b+" &gt; "+e}}}return""},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.success=function(d){b._onSuccessToSubmit(d)};if(b.isCost()){c.validation=function(d){return b._onBeforeSubmitValidation(d)}}return c},_onBeforeSubmitValidation:function(d){var c=this;var b=false;var e="";var f="";f=c.checkInput(d);if(neo.isSet(f,{blank:false})){desknets.dialog.alert(f);return false}if(c.$mjPage.find(".jcost-sch-sum-input div").length>0){e=desknets.pageframe.getLoginUid();d.find('input[name="otherto"]').each(function(){if(a(this).val()==e){b=true;return false}});if(!b){desknets.dialog.alert(desknets.Resource.cost.cost_otherto_mynot);return false}}return true},setNormalSchedule:function(){this._$dateRow.attr("class","sch-row-date normal");this._updateScheduleRow()},setRecurrenceSchedule:function(){this._$dateRow.attr("class","sch-row-date recurrence");this._updateScheduleRow()},setScheduleWithDates:function(){this._$dateRow.attr("class","sch-row-date dates");this._updateScheduleRow()},setReserveOnly:function(b){desknets.sch.input.option.setReserveOnly(b);desknets.sch.input.publiclevel.setReserveOnly(b)},onSetTargetUsers:function(){var b=desknets.pageframe.getLoginUid();var d=this.$mjPage.find(".jsch-entry-for-me");var c=this.$mjPage.find('input[name="otherto"]').filter(function(){return this.value==b});if(c.length<=0){d.addClass("co-disabled");d.find("input").attr("disabled",true)}else{d.removeClass("co-disabled");d.find("input").attr("disabled",false)}desknets.sch.input.alarm.updateVisibility();desknets.sch.input.approval.updateVisibility()},getDateRangeParams:function(){var c={};var b={startdate:true,enddate:true,dates:true};this._$dateRow.find("input").each(function(){var e=a(this);if(!!this.name&&!this.disabled){var d=!!b[this.name]?this.value.replace(/-/g,""):this.value;if(this.name=="dates"){if(!c.dates){c.dates=[]}c.dates.push(d)}else{c[this.name]=""+String(d)}}});return c},getPrivilege:function(){return""},getStartDate:function(){var b,c;if(this._type=="dates"){b=this._$dateRow.find('input[name="dates"]').eq(0).val()}else{b=this._$dateRow.find('input[name="startdate"]').val()}c=neo.dateTime.parse(b);return !!c?c:new Date()},getOccurenceMessage:function(){if(this._type=="dates"){var b=this.$mjPage.find(".jsch-title-dates").text();return b+" "+this._getOccurenceTimeRange()}else{if(this._type=="recurrence"){b=this._$dateRow.find(".sch-entry-recurrence > a").text();return b+" "+this._getOccurenceTimeRange()}else{return this._getOccurenceMessageNormal()}}},_setUp:function(){var b=this;var d=this.$mjPage.children(".co-m-content");var c={};this._$dateRow=this.$mjPage.find(".sch-row-date");a.each(b._dialogNames,function(e,f){desknets.sch.input[f].init(b)});d.delegate(".jsch-button","click",function(e){e.preventDefault();b._openDialog(a(this))});d.delegate(".sch-edit-select-title","click",function(f){var e=a(this);setTimeout(function(){e.next().click()},0);return false});this._setUpDateForm();this._setUpEvent();this._setUpTargetChooser();this._setUpSettings();this.onSetTargetUsers();this._formObserveSave(this.$mjPage.find("form"),c);this._defFormVals=c;if(b.isCost()){b._setUpCost()}else{b.$mjPage.find(".jsch-cost-open").hide()}},isCost:function(){return desknets.pageframe.isCost()},_setUpCost:function(){var b=this;b._setUpCostAdd();b._setUpCostMod()},_setUpCostAdd:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();var d=false;if(!!b.sid&&(c._type=="dates"||c._type=="recurrence")){d=true}c.$mjPage.find(".jsch-cost-open").click(function(f){f.preventDefault();if(c.$mjPage.find(".jcost-sch-sum-input>div").length>=desknets.cost.micostmaxcnt){desknets.dialog.alert(desknets.tmpl.replaceWordHtml(desknets.Resource.cost.cost_notaddschcost,"count",desknets.cost.micostmaxcnt),{});return}var g=desknets.cost.costOpenGetDefOption();g.boMulti=true;g.data.title=c.$mjPage.find('input[name="event"]').val();if(g.data.title=="--"){g.data.title=""}var e=c.$mjPage.find(".jco-input-detail").val();if(!!g.data.title&&e){g.data.title=g.data.title+" : "}g.data.title=g.data.title+e;if(d){g.data.seldate=b.seldate}else{if(c._type=="dates"){g.data.seldate=c._$dateRow.find('input[name="dates"]').eq(0).val()}else{g.data.seldate=c.$mjPage.find('input[name="startdate"]').val()}}g.starttime=c.$mjPage.find('input[name="starttime"]').val();g.bosch=true;g.oncomplete=function(h,i){c._costOnComplete(h,i)};desknets.cost.input.open(g)})},_setUpCostMod:function(){var b=this;b.$mjPage.find(".cost-sch-sum").click(function(d){d.preventDefault();var e={};e.data={};var c=b.$mjPage.find(".jcost-sch-sum-input div");if(c.length==1){b._costModOpen(c)}else{var e={};e.data={};e.data.list=[];c.each(function(){var f=a(this);var g={};g.id=desknets.getDataAttr(f,"id");g.seldate=desknets.getDataAttr(f,"seldate");g.title=desknets.getDataAttr(f,"title");g.total_amount=desknets.getDataAttr(f,"price");e.data.list[e.data.list.length]=g});e.oncomplete=function(i,h){var g=b.$mjPage.find(".jcost-sch-sum-input div");var f=null;g.each(function(){f=a(this);if(desknets.getDataAttr(f,"id")==i){return false}});b._costModOpen(f,h)};desknets.cost.inputsel.open(e)}})},_costModOpen:function(c,d){var b=this;var e={};e.boMulti=true;e.starttime=b.$mjPage.find('input[name="starttime"]').val();e.data=b._getCostRow(c);e.oncomplete=function(f,g){b._costOnComplete(f,g);if(!!d){d.dialog("close")}};e.bosch=true;desknets.cost.input.open(e)},_getCostRow:function(c){var b=this;var d={};d.id=desknets.getDataAttr(c,"id");d.title=desknets.getDataAttr(c,"title");d.seldate=desknets.getDataAttr(c,"seldate");d.total_amount=desknets.getDataAttr(c,"price");d.meisai={};d.meisai.item=[];c.find("input").each(function(){var f=a(this);var e={};e.id=desknets.getDataAttr(f,"id");e.attach=desknets.getDataAttr(f,"attach");e.dtype=desknets.getDataAttr(f,"dtype");e.dep_st_name=desknets.getDataAttr(f,"dep_st_name");e.dep_st_kbn=desknets.getDataAttr(f,"dep_st_kbn");e.dep_st_busname=desknets.getDataAttr(f,"dep_st_busname");e.arv_st_name=desknets.getDataAttr(f,"arv_st_name");e.arv_st_kbn=desknets.getDataAttr(f,"arv_st_kbn");e.arv_st_busname=desknets.getDataAttr(f,"arv_st_busname");e.memo=desknets.getDataAttr(f,"memo");e.sid_acc=desknets.getDataAttr(f,"sid_acc");e.acc_name=desknets.getDataAttr(f,"acc_name");if(!e.acc_name){e.acc_name=desknets.Resource.cost.cost}e.amount=desknets.getDataAttr(f,"amount");e.status_code=desknets.getDataAttr(f,"status_code");e.status_codemsg=desknets.getDataAttr(f,"status_codemsg");d.meisai.item[d.meisai.item.length]=e});return d},_costOnComplete:function(l,b){var m=this;var i=m.$mjPage.find(".cost-sch-sum");var c=m.$mjPage.find(".jcost-sch-sum-input");var j=c.find("div");var f=0;var e='<div data-id="{{id}}" data-seldate="{{seldate}}" data-title="{{title}}" data-price="{{price}}">';e=desknets.tmpl.replaceWordHtml(e,"id",desknets.escapeValue(l.id));e=desknets.tmpl.replaceWordHtml(e,"seldate",desknets.escapeValue(l.seldate));e=desknets.tmpl.replaceWordHtml(e,"title",desknets.escapeValue(l.title));if(!a.isArray(l.meisai.item)){l.meisai.item=[l.meisai.item]}a.each(l.meisai.item,function(o,p){var n='<input type="hidden" value="" data-id="{{id}}" data-attach="{{attach}}" data-dtype="{{dtype}}" data-sid_acc="{{sid_acc}}" data-acc_name="{{acc_name}}" data-amount="{{amount}}" data-memo="{{memo}}" data-dep_st_name="{{dep_st_name}}" data-dep_st_kbn="{{dep_st_kbn}}" data-dep_st_busname="{{dep_st_busname}}" data-arv_st_name="{{arv_st_name}}" data-arv_st_kbn="{{arv_st_kbn}}" data-arv_st_busname="{{arv_st_busname}}" data-status_code="{{status_code}}" data-status_codemsg="{{status_codemsg}}">';n=desknets.tmpl.replaceWordHtml(n,"id",p.id);if(!!p.attach){n=desknets.tmpl.replaceWordHtml(n,"attach","hasFile")}else{n=desknets.tmpl.replaceWordHtml(n,"attach","")}n=desknets.tmpl.replaceWordHtml(n,"dtype",desknets.escapeValue(p.dtype));n=desknets.tmpl.replaceWordHtml(n,"sid_acc",desknets.escapeValue(p.sid_acc));n=desknets.tmpl.replaceWordHtml(n,"acc_name",desknets.escapeValue(p.acc_name));n=desknets.tmpl.replaceWordHtml(n,"amount",desknets.escapeValue(p.amount));n=desknets.tmpl.replaceWordHtml(n,"memo",desknets.escapeValue(p.memo));n=desknets.tmpl.replaceWordHtml(n,"dep_st_name",desknets.escapeValue(p.dep_st_name));n=desknets.tmpl.replaceWordHtml(n,"dep_st_kbn",desknets.escapeValue(p.dep_st_kbn));n=desknets.tmpl.replaceWordHtml(n,"dep_st_busname",desknets.escapeValue(p.dep_st_busname));n=desknets.tmpl.replaceWordHtml(n,"arv_st_name",desknets.escapeValue(p.arv_st_name));n=desknets.tmpl.replaceWordHtml(n,"arv_st_kbn",desknets.escapeValue(p.arv_st_kbn));n=desknets.tmpl.replaceWordHtml(n,"arv_st_busname",desknets.escapeValue(p.arv_st_busname));if(!p.status_code){p.status_code=""}n=desknets.tmpl.replaceWordHtml(n,"status_code",desknets.escapeValue(p.status_code));if(!p.status_codemsg){p.status_codemsg=""}n=desknets.tmpl.replaceWordHtml(n,"status_codemsg",desknets.escapeValue(p.status_codemsg));e=e+n;if(p.amount!=""){f=f+parseInt(p.amount,10)}});e=desknets.tmpl.replaceWordHtml(e,"price",f);e=e+"</div>";if(l.meisai.item.length==0){e="";if(isNaN(l.id)){var k='<input type="hidden" value="'+l.id+'">';m.$mjPage.find(".jcost-sch-sum-input-del").append(k)}}var d=false;j.each(function(){var n=a(this);if(!d&&desknets.getDataAttr(n,"date")>l.date){n.before(e);d=true}if(desknets.getDataAttr(n,"id")==l.id){n.remove()}});if(!d){c.append(e)}var h=0;j=c.find("div");j.each(function(){h=h+a(this).data("price")});var g=desknets.tmpl.replaceWordHtml(desknets.Resource.cost.price,"price",desknets.numberFormat(h));if(j.length>1){g=g+" ("+desknets.tmpl.replaceWordHtml(desknets.Resource.cost.costother,"count",j.length-1)+")"}i.find(".cost").text(g);if(j.length>0){i.removeClass("hide")}else{i.addClass("hide")}if(!!b){b.dialog("close")}},_setUpDateForm:function(){var b=this;b._$dateRow.find(".sch-entry-reset").click(function(c){c.preventDefault();b.setNormalSchedule()});desknets.htmlparts.setUpForm(b.$mjPage.find("form"));this._setUpTimeForm();this._updateScheduleRow()},_setUpTimeForm:function(){var i=this;var b=this.$mjPage.find('input[name="starttime"]');var h=this.$mjPage.find('input[name="endtime"]');var g=this.$mjPage.find("input.jsch-startdate");var j=this.$mjPage.find("input.jsch-enddate");var e=this._$dateRow.find("#jsch-entry-input-all-day");var f=b.val()=="0000"&&h.val()=="2400";var d=desknets.sch.util.getSettings();var c={minuteStep:Number(d.unit),baseHour:Number(d.start)};desknets.timePicker.create(b,c);desknets.timePicker.create(h,c);desknets.timePicker.controlByRange(h,b,j,g);e.click(function(){i._setAllDay(a(this).prop("checked"))});if(f){e.prop("checked",true);i._setAllDay(true)}},_setUpEvent:function(){var b=this;var d=b.$mjPage.find(".sch-row-event").find(".co-select-menu-pull-down");var c=b._setOnPullDown(d);if(c==null){b._addRecodePullDown(d)}var h=d.find(".co-drop-down-button");var e=h.find(".co-select-menu-pull-down-selected");var f=b.$mjPage.find('input[name="schcolor"]').closest(".co-select-menu");var g=b.$mjPage.find("#sch-edit-color-options");d.on("click",".co-select-menu-pull-down-item>a",function(j){j.preventDefault();var k=a(this);d.find('input[name="event"]').val(desknets.getDataAttr(k,"value"));d.find(".co-select-menu-text").html(k.html());c=b._setOnPullDown(d);e.attr("title",h.find(".jsch-event-name").text());var i=desknets.getDataAttr(e.find(".sch-edit-color"),"color");if(!!i){f.click();g.find('a[data-value="'+i+'"]').click()}desknets.popUp.hide(a(this))});h.on("open.popup",function(j){var k=d.find(".co-pop-up-box");var i=k.find(".on").position();if(i){k.scrollTop(k.scrollTop()+i.top+1)}})},_setOnPullDown:function(c){var b=this;var e=null;var g=c.find('input[name="event"]').val();var f=desknets.getDataAttr(c.find(".co-select-menu-pull-down-selected").children(".sch-edit-color"),"color");var d=c.find(".co-select-menu-pull-down-item");d.removeClass("on");d.each(function(){var i=a(this);var h=i.find("a");if(desknets.getDataAttr(h,"value")==g){if(g=="--"||desknets.getDataAttr(h.children(".sch-edit-color"),"color")==f){i.addClass("on");e=i;return false}}});return e},_addRecodePullDown:function(c){var b=this;var d=b.$mjPage.find('input[name="schcolor"]').closest(".co-select-menu");var e=c.find('input[name="event"]').val();var g=a(b._TMPL_SCH_EVENT);var f=g.find("a");desknets.setDataAttr(f,"value",e);f.attr("title",e);f.prepend(d.find(".co-select-menu-text").html());desknets.setDataAttr(f.children(".sch-edit-color"),"color",d.find('input[name="schcolor"]').val());f.find(".jsch-event-name").html(desknets.tmpl.escapeWord(e));g.addClass("on");c.find(".co-pop-up-box").append(g)},_setUpTargetChooser:function(){var b=true;var d=this.$mjPage.find(".sch-row-other-to .jco-sel-items input:hidden").eq(0);var c=this.$mjPage.find(".jsch-entry-target-chooser");if(d.attr("name")!="otherto"&&d.val()<0){b=false}if(!b){c.addClass("co-disabled");c.find("input").attr("disabled",true)}desknets.sch.input.plant.updateVisibility();desknets.sch.input.visitor.updateVisibility()},_setUpSettings:function(){var c=this.$mjPage.children(".co-m-content");var b=c.data("sch-settings");var d=c.data("plant-settings");a.extend(desknets.cal.settings.of("sch"),b);a.extend(desknets.cal.settings.of("plant"),d)},_openDialog:function(b){var c=b.data("dialog");if(!!c&&!b.hasClass("co-disabled")){setTimeout(function(){desknets.sch.input[c].open()},0)}},_updateScheduleRow:function(){if(this._$dateRow.hasClass("recurrence")){this._updateRecurrenceScheduleRow()}else{if(this._$dateRow.hasClass("dates")){this._updateDatesScheduleRow()}else{this._updateNormalScheduleRow()}}this._updateDatepickers()},_updateNormalScheduleRow:function(){this._type="normal";this._$dateRow.find(".sch-entry-recurrence input").remove();this._$dateRow.find(".sch-entry-dates input").remove();this._$dateRow.find('input[name="repeat"]').val("")},_updateRecurrenceScheduleRow:function(){var d,b=this,e={};var c=["startdate","enddate","repeat","interval","rependtimes","everyweekday","everyweek"];var f=this._$dateRow.find(".sch-entry-recurrence");this._type="recurrence";this._$dateRow.find(".sch-entry-dates input").remove();a.each(c,function(h,g){e[g]=b._$dateRow.find('input[name="'+g+'"]').val()});d=desknets.sch.util.dateTime.getRecurrenceMessage(e);f.children(".jsch-button").text("\u00A0");setTimeout(function(){f.children(".jsch-button").text(d)},1)},_updateDatesScheduleRow:function(){var c,d=this._$dateRow.find(".sch-entry-dates");var b=d.find('input[name="dates"]').length;this._type="dates";this._$dateRow.find(".sch-entry-recurrence input").remove();c=desknets.Resource.sch.datesDescFormat;c=desknets.tmpl.replaceWordHtml(c,"count",b);d.children(".jsch-button").text(c)},_updateDatepickers:function(){var b=this;b._$dateRow.find(".co-datepicker").each(function(){a(this).datepicker(b._type=="normal"?"enable":"disable")})},_setAllDay:function(e){var c="";var b=this._$dateRow.find(".co-timepicker select").prop("disabled",e);var d=this._$dateRow.find('input[name="endtime"] + select > [value="0"]');function f(g){var h=desknets.Resource.timePickerHourFormat;var i=desknets.tmpl.replaceWordHtml(h,"hour",g);return neo.dateTime.format(i,new Date(1970,0,1,g,0,0))}if(e){b.val("0");c=f(24);this._$dateRow.find('input[name="starttime"]').val("0000");this._$dateRow.find('input[name="endtime"]').val("2400")}else{b.val("").change();c=f(0)}d.text(c).prop("label",c)},_getOccurenceMessageNormal:function(){var c=this._getDateTimeText(this._$dateRow.find('input[name="startdate"]'),this._$dateRow.find('input[name="stime"]'));var b=this._getDateTimeText(this._$dateRow.find('input[name="enddate"]'),this._$dateRow.find('input[name="etime"]'));return[c,b].join(" "+desknets.Resource.kara+" ")},_getOccurenceTimeRange:function(){var h=this._$dateRow.find('input[name="stime"]');var e=this._$dateRow.find('input[name="etime"]');var g=h.val();var d=e.val();var c="";if(!!g&&!h.attr("disabled")){var f=neo.dateTime.parse("19700101"+g);c+=neo.dateTime.format(desknets.Resource.timeFormat,f)}if(!!d&&!e.attr("disabled")){var b=neo.dateTime.parse("19700101"+d);c+=" "+desknets.Resource.kara+" ";c+=neo.dateTime.format(desknets.Resource.timeFormat,b)}return c},_getDateTimeText:function(f,c){var e=f.val();var b=c.val();var d=desknets.Resource.dateFormat;if(!!b&&!c.attr("disabled")){e=e.replace(/-/g,"")+""+b;d=desknets.Resource.dateTimeFormat}return neo.dateTime.format(d,neo.dateTime.parse(e))},_onSuccessToSubmit:function(e){var b=this;var g=b.$mjPage.find(".jcost-sch-sum-input div");var d=b.$mjPage.find(".jcost-sch-sum-input-del input");if(b.isCost()&&(g.length>0||d.length>0)){var c={};c.sid_sch=e.sid;c.cmd="costcmdentry";c.id=[];c.title=[];c.seldate=[];c.total_amount=[];g.each(function(){var q=a(this);var t=b._getCostRow(q);c.id[c.id.length]=t.id;c.title[c.title.length]=t.title;c.seldate[c.seldate.length]=t.seldate;c.total_amount[c.total_amount.length]=t.total_amount;var h=[];var u=[];var k=[];var l=[];var m=[];var r=[];var p=[];var s=[];var n=[];var j=[];var i=[];var o=[];a.each(t.meisai.item,function(v,w){h[h.length]=w.id;u[k.length]=w.dtype;k[k.length]=w.sid_acc;l[l.length]=w.acc_name;r[r.length]=w.memo;m[m.length]=w.amount;p[p.length]=w.dep_st_name;s[s.length]=w.dep_st_kbn;n[n.length]=w.dep_st_busname;j[j.length]=w.arv_st_name;i[i.length]=w.arv_st_kbn;o[o.length]=w.arv_st_busname});c[t.id+"_id"]=h;c[t.id+"_dtype"]=u;c[t.id+"_sid_acc"]=k;c[t.id+"_acc_name"]=l;c[t.id+"_amount"]=m;c[t.id+"_memo"]=r;c[t.id+"_dep_st_name"]=p;c[t.id+"_dep_st_kbn"]=s;c[t.id+"_dep_st_busname"]=n;c[t.id+"_arv_st_name"]=j;c[t.id+"_arv_st_kbn"]=i;c[t.id+"_arv_st_busname"]=o});c.delid=[];d.each(function(){c.delid[c.delid.length]=a(this).val()});desknets.ajax.rest({url:desknets.cost.getUrl(),data:c,success:function(i,h,j){},traditional:true})}if(!!e.noticeerror){var f=desknets.dialog.alert(e.noticeerror,{type:"warn",extraClass:"co-msg-r",extraMessage:e.msgadd});f.one("dialogclose",function(){b._setLocationHashForm()})}else{b._setLocationHashForm()}}});desknets.page(desknets.sch,"schadd",desknets.sch.SchInputBase,{_initSet:function(c){this.callBase("_initSet",c);var d=desknets.paramanalyzer.getHashParams();var b=this.$mjPage.find("form");desknets.inputUtil.loadPresetFormValues(d.cmd,b)},_setUpCost:function(){var b=this;b.callBase("_setUpCost");desknets.cost.costDelTmpAtt()},_getConnectToModuleName:function(){return"sch"},_setConnectData:function(b){var c=this;c.$mjPage.find('input[name="detail"]').val(b.title);c.$mjPage.find('textarea[name="memo"]').val(b.content)},});desknets.page(desknets.sch,"schaddtarget",desknets.sch.schadd,{});desknets.page(desknets.sch,"schmod",desknets.sch.SchInputBase,{_typeOnServer:null,_DIALOG_ID:"sch-modconfirm-dialog",ERRORNO_XERR_SCHXMODACCESS:-2179,_initGetHtml:function(){var b=this;var c={};c.success=function(f){if(f[0]["status"]!=desknets.RES_STATUS_SUCCESS){var d=desknets.paramanalyzer.getHashParams();if(f[0]["errorno"]==b.ERRORNO_XERR_SCHXMODACCESS&&d.detail!="1"){d.cmd=b._getDispCmd();var e=a(window).data("hashobserver");if(!d.bproc){if(e){e.stopObserveHash();b.resetFuncBeforeHashChange()}history.back()}if(e){setTimeout(function(){e.startObserveHash();b._setLocationHash(d)},100)}}else{b.onError(f[0]["errorno"],f[0]["errormessage"])}}else{b._initHtml(f)}};c.complete=function(f,d,e){b.CompleteExec()};b._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,null,c)},_getDispCmd:function(){return"schreferdtl"},_setUpDateForm:function(){this.callBase("_setUpDateForm");var b=this.$mjPage.find(".sch-ebtnarea");this._typeOnServer=this._type;if(this._type=="dates"){b.children('a[data-dialog="recurrence"]').hide()}if(this._type=="recurrence"){b.children('a[data-dialog="dates"]').hide()}if(this._type!="normal"){this._$dateRow.find(".sch-entry-reset").hide()}},_inputAjaxFormOption:function(){var b=this;var c=this.callBase("_inputAjaxFormOption");c.beforeSerialize=function(d,e){var f=b.$mjPage.find('input[name="modkind"]');if(b._isModKindRequired()){b._openModifyTargetChooser();return false}else{if(!f.val()){f.val("3")}}};return c},_inputDelSubmit:function(b){var c=this;var e=desknets.paramanalyzer.getHashParam(c._getIDName());var d={cmd:c._getDelExecCmd(),approval:false,confirm:"",date:neo.dateTime.parse(c.$mjPage.find('input[name="seldate"]').val()),repeat:c._defFormVals.repeat,success:function(){a(window).off("beforeunload.pageBase");c.resetFuncBeforeHashChange();c.dispBackListPage()}};desknets.cal.deleteItem(e,d)},_getIDName:function(){return"sid"},_getDelExecCmd:function(){return desknets.sch.CMD_RSCHDEL},_getDelPrm:function(){var c=this.$mjPage.find("input");var d=c.filter('[name="seldate"]').val();var b=c.filter('[name="modkind"]').val();return !!b?{seldate:d,modkind:b}:{}},_isModKindRequired:function(){var c=this.$mjPage.find('input[name="modkind"]').val();var b=neo.dateTime.parse(this.$mjPage.find('input[name="seldate"]').val());return this._typeOnServer!="normal"&&!c&&!!b},isCost:function(){var b=this;if(!desknets.pageframe.isCost()){return false}if(b.$mjPage.find(".co-actionwrap.top").find('input[type="submit"]').length<=0){return false}return true},_setUpCost:function(){var c=this;c.callBase("_setUpCost");var b=desknets.paramanalyzer.getHashParams();desknets.cost.costDelCopyTmpAtt("",b.sid);desknets.ajax.rest({url:desknets.cost.getUrl(),data:{cmd:"costcmddetailindex",sid_sch:b.sid},success:function(e,d,f){if(Number(e.allcnt)>0){var g=desknets.ajax.getJsonItems(e);a.each(g,function(h,i){if(!!i.seldate){i.seldate=neo.dateTime.format("yyyy-MM-dd",neo.dateTime.parse(i.seldate))}c._costOnComplete(i)})}},})},_openModifyTargetChooser:function(){var c=this;var h=c.$mjPage.find('input[name="seldate"]').val();var g=null;var f;var d=desknets.Resource;var e=(c._defFormVals.repeat=="r")?"dates":"recurrence";var b=a.extend(desknets.dialog.getDialogOption(),{loadFunc:function(){},okFunc:function(i){c.$mjPage.find('input[name="modkind"]').val(i);c.$mjPage.find("form").submit();setTimeout(function(){c.$mjPage.find('input[name="modkind"]').val("")},1)}});g=desknets.cal.openTargetChooser(h,"mod",e,c._DIALOG_ID,b)}});desknets.page(desknets.sch.input,"base",null,{$entry:null,$root:null,id:null,page:null,_$case:null,init:function(b){if(!!this.page){this.destroy()}this.page=b;this.$entry=b.$mjPage;this._setUpEntry()},open:function(){if(this.$root==null){this._create()}else{this._show()}},getErrorPlace:function(b){if(!!this.$root){entryName=desknets.getErrFieName(this.$root,b);if(!!entryName){return entryName}}return""},destroy:function(){this._tearDownContent();desknets.dialog.deleteById("sch-edit-"+this.id);this._tearDownEntry();this.page=null;this.$entry=null;this.$root=null;this._$case=null},_setUpEntry:function(){},_create:function(){var b=this._getDialogOptions();this.$root=desknets.dialog.make("sch-edit-"+this.id,b);this._loadContent()},_getDialogOptions:function(){var b=this;var d={};var c={title:b.$entry.find(".jsch-title-"+b.id).text(),dialogClass:"dn-dialog",modal:true,resizable:false,buttons:d};d[desknets.Resource.OKButtonLabel]=function(e){if(b._validateEntry()){a(this).dialog("close");b._updateEntryValue()}};d[desknets.Resource.CancelButtonLabel]=function(e){a(this).dialog("close")};return c},_loadContent:function(){var b=this;desknets.tmpl.load(b.$root,"sch/edit."+b.id+".html",function(){b._setUpContent();b._show()})},_setUpContent:function(){var b=this;this._$case=this.$root.find(".sch-edit-choose-cases :radio");this._$case.click(function(){b._updateEnability()})},_show:function(){var b=this;this.$root.dialog("open");setTimeout(function(){b._updateEnability()},0)},_validateEntry:function(){return true},_updateEntryValue:function(){},_updateEnability:function(){this._$case.filter(":not(:checked)").siblings().find("select,input").attr("disabled",true);this._$case.filter(":checked").siblings().find("select,input").attr("disabled",false)},_tearDownContent:function(){},_tearDownEntry:function(){}});desknets.page(desknets.sch.input,"plant",desknets.sch.input.base,{_FREE_TMPL:'<li data-reserve-only="{{reserve}}"><input type="checkbox" value="{{id}}" id="jsch-entry-plant-free-{{id}}" /><span class="sch-entry-plant-name" data-pid="{{id}}"><label for="jsch-entry-plant-free-{{id}}">{{Name}}</label></span></li>',id:"plant",_$entryPlant:null,_$entryPlantList:null,_tmplItem:'<span class="co-selitem" data-reserve-only="{{reserve}}"><span title="{{name}}">{{name}}</span><a title="{{L_Delete}}" href="#" class="co-btn co-btn-close">{{L_Delete}}</a><input type="hidden" name="pids" value="{{id}}" /></span>',_defGroupId:0,_perPage:100,_selectedItems:{},_setUpTabs:{},_$tabs:null,_$pager:null,_$free:a(),_$freeList:a(),_freeTimer:null,_$reserve:a(),_$reserveDateNav:a(),_$reserveList:a(),updateVisibility:function(){if(!!this._$entryPlant&&!!this._$entryPlantList){this._updateEntryList()}},_setUpEntry:function(){var b=this;b._$entryPlant=b.$entry.find(".sch-row-plant");if(b._$entryPlant.length>0){b._$entryPlantList=b._$entryPlant.find(".jco-sel-items");b._defGroupId=b._$entryPlant.data("group");b._perPage=b._$entryPlant.data("row-other");b._initTemplate();b._initEntryList();desknets.sch.plantPopUp.init();b._$entryPlantList.delegate(".co-btn-close","click",function(c){c.preventDefault();a(this).closest(".co-selitem").remove();b._updateEntryList()})}},_getDialogOptions:function(){var b=this.callBase("_getDialogOptions");return a.extend(b,{width:795,height:"auto"})},_setUpContent:function(){var b=this;this.callBase("_setUpContent");b._$tabs=b.$root.find(".sch-entry-plant-tab");b._$pager=b.$root.find(".sch-entry-plant-pager");b._$tabs.tabs({select:function(c,d){setTimeout(function(){b._onShowTabItem()},0)}});b.$root.delegate("input:checkbox","click",function(c){b._updatePlantWithCheckBox(a(this))});b._setUpPlantGroup()},_show:function(){this.callBase("_show");this._saveSelectedFromEntry();this._onShowTabItem();this.$root.find(".sch-entry-plant-date-value").text(this._getDateMessage())},_updateEntryValue:function(){this.callBase("_updateEntryValue");this._updateEntryLabels(this._selectedItems)},_tearDownContent:function(){this._tearDownFreeList();this._tearDownReserveList();this._selectedItems={};this._setUpTabs={};this._$pager=null;if(!!this._$tabs){this._$tabs.tabs("destroy");this._$tabs=null}if(!!this.$root){this.$root.undelegate("input:checkbox","click")}},_tearDownEntry:function(){if(!!this._$entryPlantList){this._$entryPlantList.undelegate(".co-btn-close","click");this._$entryPlantList=null}this._$entryPlant=null},_initTemplate:function(){var b,c=desknets.Resource;b=this._tmplItem;b=desknets.tmpl.replaceWord(b,"L_Delete",c.deselectLabel);this._tmplItem=b},_getDateMessage:function(){var c="",e=this.page.getDateRangeParams();var b=desknets.cal.tmplRef.dispTimeLong(e.starttime);var d=desknets.cal.tmplRef.dispTimeLong(e.endtime);if(!!e.repeat){c=this.page.getOccurenceMessage();if(b!="&nbsp;"){c+=" "+b}if(d!="&nbsp;"){c+=" - "+d}}else{c=desknets.dateTime.formatDate("m",e.startdate);if(b!="&nbsp;"){c+=" "+b}c+=" - "+desknets.dateTime.formatDate("m",e.enddate);if(d!="&nbsp;"){c+=" "+d}}return c},_setUpPlantGroup:function(){var b=this;var c=b.page.getPrivilege()||"";desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:{cmd:"plant"+c+"selpgroup",accesskind:"1"},success:function(f){var d=desknets.ajax.getJsonItems(f);var h=b.$root.find("#sch-entry-plant-tab-free .jsch-entry-plant-group");var k=b.$root.find("#sch-entry-plant-tab-reserve .jsch-entry-plant-group");var g="("+desknets.Resource.sch.allSelectablesLabel+")";var j="("+desknets.Resource.allLabel+")";var e=a.merge([{id:"0",Name:g}],d);var i=a.merge([{id:"0",Name:j}],d);desknets.htmlparts.setSelectOption(h,e,"id","Name",{selected:b._defGroupId});desknets.htmlparts.setSelectOption(k,i,"id","Name",{selected:b._defGroupId})}})},_onShowTabItem:function(){var b=this._$tabs.tabs("option","selected");if(b==0){this._onShowFreePlantList()}else{this._onShowReservePlantList()}},_updatePlantsWithAllChecker:function(e,b){var c=this;var d=e.attr("checked");b.find("input:checkbox").each(function(){this.checked=d;c._updatePlantWithCheckBox(a(this))})},_updatePlantWithCheckBox:function(e){var f=e.val();if(!!f){var c=e.closest("li, tr");var d=c.find("label").text();var b=Number(c.data("reserve-only"))>0;if(!!e.attr("checked")){this._selectedItems[f]={id:f,name:d,reserve:b};c.addClass("selected")}else{if(!!this._selectedItems[f]){delete this._selectedItems[f]}c.removeClass("selected")}}},_onShowFreePlantList:function(){if(!this._setUpTabs.free){this._setUpTabs.free=true;this._setUpFreeList()}else{this._checkSelectedItems(this._$freeList)}this._$pager.find(".sch-plant-free-time-list").hide();this._$pager.find(".sch-entry-plant-free").show()},_setUpFreeList:function(){var b=this;b._$free=b.$root.find("#sch-entry-plant-tab-free");b._$freeList=b._$free.find(".sch-entry-plant-free-list>ul");b._$free.find(".jsch-entry-plant-group-button").click(function(c){b._loadFreePlantList(0)});b._$free.delegate(".sch-entry-plant-name","mouseenter",function(c){b._freeTimer=desknets.sch.plantPopUp.openDelay(a(this),b._freeTimer)});b._$free.delegate(".sch-entry-plant-name","mouseleave",function(c){desknets.sch.plantPopUp.closeTimer(b._freeTimer);b._freeTimer=null})},_loadFreePlantList:function(e){var b=this;var f=b._$free.find(".jsch-entry-plant-group").val();var c=b.page.getPrivilege()||"";var d=a.extend({cmd:"plant"+c+"entryfreelist",gid:f,row:e,num:b._perPage},b.page.getDateRangeParams());desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:d,success:function(h){var g=desknets.ajax.getJsonItems(h);b._replaceFreePlantList(g);b._updateFreePlantPager(e,h.allcnt)}})},_replaceFreePlantList:function(c){var b=this;var d=[];desknets.sch.plantPopUp.close();if(c.length>0){a.each(c,function(e,h){var f=b._FREE_TMPL;var g=!!b._selectedItems[h.id];f=desknets.tmpl.replaceWordHtml(f,"id",h.id);f=desknets.tmpl.replaceWord(f,"Name",h.Name);f=desknets.tmpl.replaceWord(f,"reserve",h.reservschlimit);d.push(f)});b._$free.removeClass("sch-list-no-data");b._$freeList.empty().html(d.join(""));b._checkSelectedItems(b._$freeList)}else{b._$free.addClass("sch-list-no-data")}},_updateFreePlantPager:function(d,c){var b=this;var e=b._$freeList.children().length;desknets.Pager.output(b._$pager,".sch-entry-plant-free",{getCount:e,pageMaxView:b._perPage,allCount:c,startRow:d,clickFunc:function(f){b._loadFreePlantList(f)}})},_tearDownFreeList:function(){this._$free.find(".jsch-entry-plant-group-button").unbind("click");this._$free.undelegate("label","mouseenter");this._$free.undelegate("label","mouseleave");this._$freeList=a();this._$free=a()},_onShowReservePlantList:function(){if(!this._setUpTabs.reserve){this._setUpTabs.reserve=true;this._setUpReserveList()}else{this._$reserveList.schedulePlantFreeTimeList("setRangeParams",this.page.getDateRangeParams());this._checkSelectedItems(this._$reserveList)}this._$pager.find(".sch-entry-plant-free").hide();this._$pager.find(".sch-plant-free-time-list").show()},_setUpReserveList:function(){var b=this;var d=this.page.getStartDate();var c=b.page.getPrivilege()||"";b._$reserve=b.$root.find("#sch-entry-plant-tab-reserve");b._$reserveList=b._$reserve.find(".sch-entry-plant-reserve-list");b._$reserveDateNav=b._$reserve.find(".jsch-cal-date-header");b._$reserve.find(".jsch-entry-plant-group").change(function(e){var f=b._$reserve.find(".jsch-entry-plant-group").val();b._$reserveList.schedulePlantFreeTimeList("setID",f)});desknets.htmlparts.setUpDateNav(b._$reserveDateNav,{date:d,eventWait:desknets.TIME_GETLIST_LAG,change:function(f,e){b._$reserveList.schedulePlantFreeTimeList("setDate",e.date)}});b._$reserveList.schedulePlantFreeTimeList({pager:b._$pager,date:d,rangeParams:b.page.getDateRangeParams(),cmdPlants:"plant"+c+"selplant",cmdFree:"plant"+c+"entryfree",perPage:b._perPage,updated:function(){b._checkSelectedItems(b._$reserveList)}});b._$reserve.find(".co-allchk").click(function(e){var f=a(this);b._updatePlantsWithAllChecker(f,f.closest("thead").next())});b._$reserveList.schedulePlantFreeTimeList("setID","")},_checkSelectedItems:function(b){var c=this;b.find("input:checkbox").each(function(){this.checked=!!c._selectedItems[this.value];c._updatePlantWithCheckBox(a(this))})},_tearDownReserveList:function(){this._$reserve.find(".jsch-entry-plant-group").unbind("change");this._$reserveDateNav.neoDateNav("destroy");this._$reserveList.schedulePlantFreeTimeList("destroy");this._$reserve.find(".co-allchk").unbind("click");this._$reserveDateNav=a();this._$reserveList=a();this._$reserve=a()},_initEntryList:function(){var b={};this._$entryPlantList.find("input:hidden").each(function(){var c=a(this);b[this.value]={id:this.value,name:c.data("name"),reserve:c.data("reserve-only")}});this._updateEntryLabels(b)},_updateEntryLabels:function(b){var c=[];for(var e in b){var d=this._tmplItem;d=desknets.tmpl.replaceWordHtml(d,"id",b[e].id);d=desknets.tmpl.replaceWord(d,"name",b[e].name);d=desknets.tmpl.replaceWord(d,"reserve",b[e].reserve);c.push(d)}this._$entryPlantList.html(c.join(""));this._updateEntryList()},_updateEntryList:function(){var d=this._$entryPlantList.find(".co-selitem");var b=this._$entryPlant.hasClass("co-disabled");var c=d.filter(function(){return Number(a(this).data("reserve-only"))>0}).length>0;if(d.length>0&&!b){this._$entryPlant.show()}else{this._$entryPlant.hide()}if(c){this._$entryPlant.addClass("sch-edit-reserve-only")}else{this._$entryPlant.removeClass("sch-edit-reserve-only")}this.page.setReserveOnly(c)},_saveSelectedFromEntry:function(){var b={};this._$entryPlantList.find('input[name="pids"]').each(function(){var c=a(this).closest(".co-selitem");b[this.value]={id:this.value,name:c.children("span:not(.co-btn)").text(),reserve:Number(c.data("reserve-only"))>0}});this._selectedItems=b}});desknets.page(desknets.sch.input,"user",null,{$entry:null,id:"user",page:null,_userTmpl:'<span class="co-selitem"><span class="co-selitem-text" title="{{longName}}">{{name}}</span><a href="#" class="co-btn co-btn-close" title="{{L_Delete}}">x</a><input type="hidden" name="{{keyName}}" value="{{id}}" /></span>',_$entryUser:a(),_$entryContact:a(),_defaultUsers:{},init:function(b){if(!!this.page){this.destroy()}this.page=b;this.$entry=b.$mjPage;this._$entryUser=this.$entry.find(".sch-row-other-to");this._$entryContact=this.$entry.find(".sch-row-contact-with");this._initTemplate();this._setUpEntry()},open:function(){this._$entryUser.find(".jco-sel-btn").click()},destroy:function(){this.page=null;this.$entry=null;this._$entryUser=null},_initTemplate:function(){var c=desknets.Resource;var b=this._userTmpl;b=desknets.tmpl.replaceWord(b,"L_Delete",c.deselectLabel);this._userTmpl=b},_setUpEntry:function(){var b=desknets.chooser.getItemsFromElement(this._$entryUser);this._setUpDefaultUsers(b);this._setUpContactRow();this._setUpChooserDialog(b);this._updateEntryList()},_setUpDefaultUsers:function(b){var c={};a.each(b,function(d,e){c[e.id]=true});this._defaultUsers=c},_setUpChooserDialog:function(c){var b=this;var d=b._$entryUser.children("td");desknets.chooser.setUpEntry(d,c,{dialogID:"sch-entry-other-to-dialog",dialogOptions:b._getChooserOptions(),template:b._userTmpl,extraVars:{group:{keyName:"gids"},user:{keyName:"otherto"}},filter:function(f,e){b._beginToFilterWithPrivilege(f,e);return false},change:function(){b._updateTargets()}})},_setUpContactRow:function(){var b=this;if(b.$entry.children(".co-m-content").data("mailuse")!="1"){b._$entryContact.find(".jsch-edit-contact-mail").remove()}if(!desknets.pageframe.isShownMenu("memo")){b._$entryContact.find(".jsch-edit-contact-memo").remove()}if(b._$entryContact.find("li").length<=1){b._$entryContact=a()}else{b._$entryContact.delegate("input:checkbox","click",function(c){b._updateToContactWith()})}},_getChooserOptions:function(){var b=this;var c=b.page.getPrivilege()||"";var d={chooseDisplayGroup:true,choosePrivateGroup:"readonly",allGroup:"readonly",unassignGroup:"readonly",choosenListPlugIn:"scheduleChoosenList",getInitialDate:function(){return b.page.getStartDate()},title:desknets.Resource.sch.othertoChooserTitle,cmdusers:"construct"+c+"cmdusersearch",cmdGroupFree:"sch"+c+"grpfree",cmdUserFree:"sch"+c+"entryfree",getRangeParams:function(){return b.page.getDateRangeParams()}};return d},_updateTargets:function(){this.page.onSetTargetUsers();if(this._$entryUser.find(".co-selitem").length>0){this._$entryUser.show()}else{this._$entryUser.hide()}if(this._$entryUser.find('input[name="otherto"]').length>0){this._$entryContact.show()}else{this._$entryContact.hide()}},_updateEntryList:function(){var b=this._$entryUser.find(".co-selitem input");if(b.length>0){this._$entryUser.show()}else{this._$entryUser.hide()}if(b.attr("name")=="gids"&&b.val()<0){this._$entryUser.addClass("sch-readonly")}},_updateToContactWith:function(){var b=0;this._$entryContact.find("input:checked").each(function(){b+=Number(a(this).val())});this._$entryContact.find('input[name="sendhowto"]').val(b)},_beginToFilterWithPrivilege:function(d,b){var c=this;var e=c.page.getPrivilege()||"";var f=c._getIDsToCheckPrivilege(d);if(f.length<=0){b(d)}else{desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:{cmd:"sch"+e+"filtarget",accesskind:"2",id:f},success:function(g){c._filterWithPrivilege(d,g,b)}})}},_getIDsToCheckPrivilege:function(c){var b=this,d=[];a.each(c,function(e,f){if(f.type=="user"&&!b._defaultUsers[f.id]){d.push(f.id)}});return d},_filterWithPrivilege:function(d,e,c){var f=desknets.ajax.getJsonItems(e);var b=this._filterWithIDs(d,f);c(b);if(d.length>b.length){setTimeout(function(){desknets.pageframe.viewTopMsgFromID("com_accs_otherto_add")},1)}},_filterWithIDs:function(e,d){var c=this,f={},b=[];a.each(d,function(g,h){f[h.id]=true});a.each(e,function(g,h){var j=!!f[h.id];var i=!!c._defaultUsers[h.id];if(h.type!="user"||j||i){b.push(h)}});return b}});desknets.page(desknets.sch.input,"recurrence",desknets.sch.input.base,{id:"recurrence",_activeKind:"w",_$entryDate:null,_$active:null,_setUpEntry:function(){this._$entryDate=this.$entry.find(".sch-row-date")},_getDialogOptions:function(){var b=this;var c=this.callBase("_getDialogOptions");a.extend(c,{width:640,height:"auto"});c.buttons[desknets.Resource.OKButtonLabel]=function(d){if(b._validateEntry()){a(this).dialog("close");b._updateEntryValue()}};return c},_setUpContent:function(){var b=this;b.callBase("_setUpContent");desknets.htmlparts.setUpForm(b.$root.find("form"),{required:true});b.$root.find('select[name="repeat"]').bind("change",function(){b._setToSelectedKind()})},_show:function(){this.callBase("_show");this._setDialogRepeatValues();this._setDialogIntervalValues();this._setDialogStartValues();this._setDialogEndValues();this._setDialogTimesValues();this._setDialogDayOfWeekValue();this._setDialogDayOfMonthValue()},_validateEntry:function(){this.$root.find("form").formSetUp("validate");var b=this._$active.find(".ui-invalid");if(b.length>0){desknets.validation.showError(b.eq(b.length-1));return false}if(!desknets.validation.checkNumberInput(this._$active)){return false}return true},_updateEntryValue:function(){this.callBase("_updateEntryValue");var b=this._getValuesForEntry();this._updateEntryInputValue(b);this.page.setRecurrenceSchedule()},_updateEnability:function(){this.callBase("_updateEnability");this.$root.find("form").formSetUp("validate")},_setDialogRepeatValues:function(){if(this._$entryDate.hasClass("recurrence")){var b=this._$entryDate.find('input[name="repeat"]').val();this.$root.find('select[name="repeat"]').val(b)}this._setToSelectedKind()},_setDialogIntervalValues:function(){var b=this._$entryDate.find('input[name="interval"]').val()||"1";this.$root.find('select[name="interval"]').val(b)},_setDialogStartValues:function(){var b=this.page.getStartDate();if(a.type(b)=="date"){this._getDatePickers(this.$root,"startdate").each(function(){a(this).datepicker("setDate",b)})}},_setDialogEndValues:function(){var b=this._getDatePickers(this._$entryDate,"enddate").datepicker("getDate");if(a.type(b)=="date"){this._getDatePickers(this.$root,"enddate").each(function(){a(this).datepicker("setDate",b)})}},_setDialogTimesValues:function(){var c=this.$root.find('input[name^="_endtype"]');var b=this._$entryDate.find('input[name="rependtimes"]').val();if(!!b){c.filter('[value="1"]').attr("checked",true);this.$root.find('input[name="rependtimes"]').val(b)}else{c.filter('[value="2"]').attr("checked",true);this.$root.find('input[name="rependtimes"]').val("10")}},_setDialogDayOfWeekValue:function(){var d=this._$entryDate.find('input[name="everyweekday"]').val();var f=this.$root.find('input[name="_dayofweek"]');var c=this.page.getStartDate();if(!!d&&d.length>=7){for(var e=0;e<7;e++){f.eq(e).attr("checked",d.charAt(e)=="1")}}else{if(!!c){var b=(c.getDay()+6)%7;f.filter(function(){return this.value==b}).attr("checked",true)}}},_setDialogDayOfMonthValue:function(){var e=this._$entryDate.find('input[name="everyweek"]').val();var c=this._$entryDate.find('input[name="everyweekday"]').val();var b=this.$root.find('input[name="_occur"]');if(!!e&&!!c){b.filter('[value="2"]').attr("checked",true);this.$root.find('select[name="everyweek"]').val(e);this.$root.find('select[name="everyweekday"]').val(c)}else{var d=this.page.getStartDate();b.filter('[value="1"]').attr("checked",true);e=Math.floor((d.getDate()-1)/7);c=(d.getDay()+6)%7;this.$root.find('select[name="everyweek"] > option').eq(e).attr("selected",true);this.$root.find('select[name="everyweekday"] > option').eq(c).attr("selected",true)}},_setToSelectedKind:function(){var c=this.$root.find('select[name="repeat"]').val();var b=!!this._$active?this._$active:this._$entryDate;this.$root.find(".sch-edit-recur-field").hide();this._$active=this.$root.find(".sch-edit-recur-"+c).show();this._activeKind=c},_getValuesForEntry:function(){var b={};this._$active.find("input,select").each(function(){if(!this.disabled&&!!this.name&&this.name.charAt(0)!="_"){b[this.name]=a(this).val()}});if(this._activeKind=="w"){b=this._filterValuesForEntry_w(b)}return b},_filterValuesForEntry_w:function(b){var c=[];this._$active.find('input[name="_dayofweek"]').each(function(){c.push(this.checked?"1":"0")});b.everyweekday=c.join("");return b},_updateEntryInputValue:function(b){var e=this._$entryDate.find(".sch-entry-recurrence");e.children("input").remove();for(var c in b){if(c=="startdate"||c=="enddate"){var d=this._getDatePickers(this._$entryDate,c);d.datepicker("setDate",neo.dateTime.parse(b[c]))}else{a('<input type="hidden" />').attr("name",c).val(b[c]).appendTo(e)}}this._$entryDate.find('input[name="repeat"]').val(this._activeKind)},_getDatePickers:function(c,b){return c.find('input[name="'+b+'"]').prev(".hasDatepicker")}});desknets.page(desknets.sch.input,"dates",desknets.sch.input.base,{_TMPL_LABEL:'<span class="co-selitem" data-id="{{id}}"><span>{{title}}</span><a title="{{L_Delete}}" href="#" class="co-btn co-btn-close">{{L_Delete}}</a></span>',id:"dates",_dates:null,_holidays:{},_$dateNav:a(),_$calendars:a(),_$selected:a(),_$entryDate:a(),init:function(b){this.callBase("init",b);this._dates={}},destroy:function(){this.callBase("destroy");if(this._$dateNav.length>0){this._$dateNav.neoDateNav("destroy");this._$dateNav=a()}if(this._$calendars.length>0){this._$calendars.datepicker("destroy");this._$calendars=a()}if(this._$selected.length>0){this._$selected.undelegate(".co-btn-close","click");this._$selected=a()}this._$entryDate=a()},_setUpEntry:function(){this._$entryDate=this.$entry.find(".sch-row-date")},_getDialogOptions:function(){var b=this.callBase("_getDialogOptions");return a.extend(b,{width:540,height:"auto"})},_setUpContent:function(){this.callBase("_setUpContent");this._$dateNav=this.$root.find(".jsch-cal-date-header");this._$calendars=this.$root.find(".sch-edit-dates-calenders");this._$selected=this.$root.find(".sch-edit-dates-selected");this._setUpNav();this._setUpCalendars();this._setUpDates()},_show:function(){this.callBase("_show");this._setDateValues()},_updateEntryValue:function(){var b=neo.array.getKeyArray(this._dates);if(b.length>0){this._updateEntryInputValue(b);this.page.setScheduleWithDates()}else{this.page.setNormalSchedule()}},_setUpNav:function(){var b=this;b._$dateNav.neoDateNav({date:b.page.getStartDate(),change:function(d,c){b._getHolidayIfRequired(c.date,function(){b._$calendars.datepicker("setDate",c.date)})}})},_setUpCalendars:function(){var b=this;var c=b._$dateNav.neoDateNav("date");var d=desknets.sch.util.getSettings();b._$calendars.datepicker({defaultDate:c,numberOfMonths:[2,3],changeYear:false,changeMonth:false,showButtonPanel:false,showOtherMonths:true,beforeShowDay:function(e){return b._beforeShowDay(e)},onSelect:function(f,e){b._onDatepickerSelect(f,e)}});if(Number(d.holiday)>0){b._getHolidayIfRequired(c,function(){b._$calendars.datepicker("refresh")})}},_setUpDates:function(){var b=this;this._$selected.delegate(".co-btn-close","click",function(c){c.preventDefault();b._removeDate(a(this).closest(".co-selitem"));b._$calendars.datepicker("refresh")})},_getHolidayIfRequired:function(c,e){var b=this;var d=desknets.sch.util.getSettings();if(Number(d.holiday)>0){desknets.ajax.rest({url:desknets.cal.CGI_SCH_REST,data:{cmd:desknets.sch.CMD_SCHHOLIDAY,startdate:neo.dateTime.format("yyyyMMdd",new Date(c.getFullYear(),c.getMonth(),-5)),enddate:neo.dateTime.format("yyyyMMdd",new Date(c.getFullYear(),c.getMonth()+6,6))},success:function(g){var f=desknets.cal.item.getItemsFromHoliday(desknets.ajax.getJsonItems(g));b._holidays={};a.each(f,function(h,j){b._holidays[j.startdate]=j.event});e()}})}else{b._holidays={};e()}},_beforeShowDay:function(b){var e=neo.dateTime.format("yyyyMMdd",b);var d=[];var c=b.getDay();if(c==0){d.push("co-sunday")}if(c==6){d.push("co-saturday")}if(neo.dateTime.compareOn(b,desknets.dateTime.current,"day")==0){d.push("co-today")}if(!!this._holidays[e]){d.push("co-holiday")}if(!!this._dates[e]){d.push("selected")}return[true,d.join(" "),null]},_onDatepickerSelect:function(g,f){var c=new Date(f.selectedYear,f.selectedMonth,f.selectedDay);var e=neo.dateTime.format("yyyyMMdd",c);if(!!this._dates[e]){var b=this._$selected.find('.co-selitem[data-id="'+e+'"]');this._removeDate(b)}else{var d=this._getLabelElement(e,g);this._dates[e]=g;a(d).appendTo(this._$selected)}},_getLabelElement:function(d,e){var c=desknets.Resource,b=this._TMPL_LABEL;b=desknets.tmpl.replaceWordHtml(b,"L_Delete",c.deselectLabel);b=desknets.tmpl.replaceWordHtml(b,"id",d);b=desknets.tmpl.replaceWordHtml(b,"title",e);return b},_removeDate:function(b){var c=desknets.getDataAttr(b,"id");if(this._dates[c]){delete this._dates[c]}b.remove()},_setDateValues:function(){var b=this;var c=[];b._dates={};b.$entry.find('input[name="dates"]').each(function(){var e=a(this).val();var d=neo.dateTime.parse(e);var f=neo.dateTime.format("yyyy/MM/dd",d);b._dates[e]=f;c.push(b._getLabelElement(e,f))});this._$selected.html(c.join(""));this._$calendars.datepicker("refresh")},_updateEntryInputValue:function(b){var c=this._$entryDate.find(".sch-entry-dates");c.children("input").remove();a.each(b,function(e,d){a('<input type="hidden" name="dates" />').val(d).appendTo(c)});this._$entryDate.find('input[name="repeat"]').val("r")}});desknets.page(desknets.sch.input,"approval",desknets.sch.input.base,{id:"approval",_canSendMail:false,_$status:null,_$mail:null,_$entryApproval:null,_$entryStatus:null,_$entryMail:null,updateVisibility:function(){if(!!this._$entryStatus&&!!this._$entryApproval){var b=Number(this._$entryStatus.val());var c=(b==1||b==2)&&!this._$entryApproval.hasClass("co-disabled");var d=c?"show":"hide";this._$entryApproval[d]()}},_setUpEntry:function(){this._canSendMail=this.$entry.children(".co-m-content").data("mailuse")=="1";this._$entryApproval=this.$entry.find(".sch-row-approval");this._$entryStatus=this._$entryApproval.find('input[name="approvreq"]');this._$entryMail=this._$entryApproval.find('input[name="aprvmailnotice"]');var b=Number(this._$entryStatus.val());if(!this._canSendMail){this._$entryApproval.find(".sch-entry-approval-mail").hide()}this.updateVisibility()},_setUpContent:function(){this.callBase("_setUpContent");this._$status=this.$root.find(".sch-entry-approval");this._$mail=this.$root.find(".sch-entry-approval-mail");if(!this._canSendMail){this.$root.find(".jsch-entry-approval-mail").hide()}},_show:function(){this.callBase("_show");this._setFormValues()},_updateEntryValue:function(){var d=this._$status.filter(":checked").val();var b=this._$status.filter(":checked").data("label");this._$entryStatus.val(d);this._$entryApproval.find(".jsch-approval").text(b);if(d=="1"&&this._canSendMail){var c=neo.form.getSelectedLabel(this._$mail);this._$entryMail.val(this._$mail.val());this._$entryApproval.find(".jsch-approval-mail").text(c);this._$entryApproval.find(".sch-entry-approval-mail").show()}else{this._$entryMail.val("0");this._$entryApproval.find(".sch-entry-approval-mail").hide()}this.updateVisibility()},_setFormValues:function(){var b=Number(this._$entryStatus.val());if(b==1||b==2){a("#sch-entry-approval-1").attr("checked",true);this._$mail.val(this._$entryMail.val())}else{a("#sch-entry-approval-0").attr("checked",true);this._$mail.val("0")}}});desknets.page(desknets.sch.input,"alarm",desknets.sch.input.base,{id:"alarm",_$alarm:null,_$entryAlarm:null,_$entryStatus:null,_$entryTime:null,updateVisibility:function(){if(!!this._$entryStatus&&!!this._$entryAlarm){var b=this._$entryStatus.val()=="1"&&!this._$entryAlarm.hasClass("co-disabled");var c=b?"show":"hide";this._$entryAlarm[c]()}},_setUpEntry:function(){this.callBase("_setUpEntry");this._$entryAlarm=this.$entry.find(".sch-row-alarm");if(this._$entryAlarm.length>0){this._$entryStatus=this._$entryAlarm.find('input[name="alarm"]');this._$entryTime=this._$entryAlarm.find('input[name="alarmtime"]');this._updateEntryText(this._$entryTime.val())}},_getDialogOptions:function(){var b=this.callBase("_getDialogOptions");return a.extend(b,{minHeight:100})},_setUpContent:function(){var b=this;b.callBase("_setUpContent");b._$alarm=b.$root.find(".sch-entry-alarm")},_show:function(){this.callBase("_show");this._setFormValues()},_updateEntryValue:function(){var b=this._$alarm.val();this._$entryStatus.val(!!b?"1":"0");this._$entryTime.val(b);this._updateEntryText(b)},_updateEntryText:function(d){var c="",b=desknets.Resource;if(d%1440==0){c=desknets.tmpl.replaceWordHtml(b.alarmDayLabel,"num",d/1440)}else{if(d%60==0){c=desknets.tmpl.replaceWordHtml(b.alarmHourLabel,"num",d/60)}else{c=desknets.tmpl.replaceWordHtml(b.alarmMinuteLabel,"num",d)}}c=desknets.tmpl.replaceWordHtml(b.sch.alermTimeFormat,"time",c);this._$entryAlarm.find(".jsch-alarm-time").text(c);this.updateVisibility()},_setFormValues:function(){if(this._$entryStatus.val()=="1"){this._$alarm.val(this._$entryTime.val())}else{this._$alarm.val("")}}});desknets.page(desknets.sch.input,"visitor",desknets.sch.input.base,{id:"visitor",visitorRestUrl:"",_tmplItem:'<tr><td class="co-thd-1em"><a class="co-btn co-btn-close" href="#" title="{{L_Delete}}" tabIndex="-1">x</a></td><td class="sch-width-company"><input class="co-width-100p" type="text" name="visit_officename" value="{{officename}}" /></td><td class="sch-width-name"><input class="co-width-100p" type="text" name="visit_Name" value="{{Name}}" /></td><td><input class="co-width-100p" type="text" name="visit_members" value="{{members}}" /></td></tr>',_tmplEntryItem:'<tr><td class="co-td-icon"><a class="co-btn co-btn-close" href="#" title="{{L_Delete}}">x</a><input type="hidden" name="visit_officename{{index}}" value="{{officename}}" /><input type="hidden" name="visit_Name{{index}}" value="{{Name}}" /><input type="hidden" name="visit_members{{index}}" value="{{members}}" /></td><td>{{officename}}</td><td>{{Name}}</td><td class="co-td-num">{{membersAsText}}</td></tr>',_$contacter:null,_$details:null,_$entryVisitor:null,_$entryVisitorList:null,_contacterID:0,_focusedIndex:-1,getErrorPlace:function(f){var e=["visit_officename","visit_Name","visit_members"];var c=this.$root.find(".sch-entry-visitor-detail-headers th");var d=this.callBase("getErrorPlace",f);if(!!d){return d}for(var b=0;b<e.length;b++){if(f.indexOf(e[b])==0){var d=desknets.Resource.sch.visitorDetailErrorFormat;d=desknets.tmpl.replaceWordHtml(d,"name",c.eq(b+1).text());d=desknets.tmpl.replaceWordHtml(d,"index",f.replace(/\D/g,""));return d}}return""},updateVisibility:function(){if(!!this._$entryVisitor&&!!this._$entryVisitorList){this._updateEntryList()}},_setUpEntry:function(){var b=this,c;b.callBase("_setUpEntry");b.visitorRestUrl=desknets.getUrl("zrvisitor");b._$entryVisitor=b.$entry.find(".sch-row-visitor");b._$entryVisitorList=b._$entryVisitor.find(".sch-entry-choose-items");if(b._$entryVisitor.length>0&&b._$entryVisitorList.length>0){b._initTemplate();b._initEntryList();b._$entryVisitorList.delegate(".co-btn-close","click",function(d){d.preventDefault();a(this).closest("tr").remove();b._updateEntryList()});b._$entryVisitor.find(".jsch-remove-all").click(function(d){b._$entryVisitorList.empty();b._updateEntryList()})}},_getDialogOptions:function(){var b=this.callBase("_getDialogOptions");return a.extend(b,{width:700,height:"auto"})},_loadContent:function(){var b=this;desknets.tmpl.load(b.$root,"sch/edit.visitor.html",function(){b._loadPlaces(function(){b._setUpContent();b._show()})})},_setUpContent:function(){var b=this;b.callBase("_setUpContent");b._$contacter=b.$root.find('select[name="visit_contact"]');b._$details=b.$root.find(".sch-entry-visitor-details tbody");b._$contacter.change(function(c){b._changeUserContactTo()});b._$details.delegate("input","focus",function(c){b._onStartToEditDetail(a(this).closest("tr"))});b._$details.delegate("input","blur",function(c){b._onEndToEditDetail(a(this).closest("tr"))});b._$details.delegate(".co-btn-close","click",function(c){b._removeDetailRow(a(this).closest("tr"))})},_show:function(){if(this.$root.find(".jsch-locations > option").length<=0){desknets.dialog.alert(desknets.Resource.Message.sch_visitor_no_locations);return}this.callBase("_show");this._setUsersToContact();this._updatePlantsWithEntry();this._setFormValues()},_validateEntry:function(){var b=this._$details.find("input").filter(function(){return String(this.name).indexOf("ame")>=0&&!!this.value});if(b.length<=0){desknets.dialog.alert(desknets.Resource.Message.sch_visitor_no_details);return false}return true},_updateEntryValue:function(){this.callBase("_updateEntryValue");var b=neo.form.getSelectedLabel(this._$contacter);var e=neo.form.getSelectedLabel(this.$root.find('select[name="visit_location"]'));var d=this.$root.find('input[name="visit_locationdtl"]').val();var c=this._getDetailsFromElement(this._$details);this._updateEntryHiddenValue();this._$entryVisitor.find('input[name="visit_contact"]').attr("data-name",b);this._$entryVisitor.find(".jsch-subentry-visit-contact > td").text(b);this._$entryVisitor.find(".jsch-subentry-visit-location > td").text(e+" "+d);this._replaceEntryList(c)},_initTemplate:function(){var b,c=desknets.Resource;b=this._tmplItem;b=desknets.tmpl.replaceWord(b,"L_Delete",c.deselectLabel);this._tmplItem=b;b=this._tmplEntryItem;b=desknets.tmpl.replaceWord(b,"L_Delete",c.deselectLabel);this._tmplEntryItem=b},_initEntryList:function(){var d=[];var c=this._$entryVisitorList.find("input");for(var b=0;b<c.length;b+=3){d.push({officename:c.eq(b).val(),Name:c.eq(b+1).val(),members:c.eq(b+2).val()})}this._replaceEntryList(d)},_loadPlaces:function(c){var b=this;desknets.ajax.rest({url:b.visitorRestUrl,data:{cmd:"visitorplaces"},success:function(d){b._replacePlaces(d);c()}})},_replacePlaces:function(d){var b=desknets.ajax.getJsonItems(d);var c=this.$root.find(".jsch-locations");var e=this._$entryVisitor.find('input[name="visit_location"]');desknets.htmlparts.setSelectOption(c,b,"id","Name",{selected:e.val()})},_setUsersToContact:function(){var c=this._$entryVisitor.find('input[name="visit_contact"]');var b=c.val();desknets.htmlparts.setSelectOption(this._$contacter,this._getUsersToContact(),"id","name");if(!!b){this._$contacter.val(b)}this._contacterID=this._$contacter.val()},_getUsersToContact:function(){var f,b,e=[],c={};var d=this._$entryVisitor.find('input[name="visit_contact"]');this.$entry.find('.sch-row-other-to input[name="otherto"]').each(function(){b=a(this).siblings(".co-selitem-text").text();e.push({id:this.value,name:b});c[this.value]=true});f=d.val();if(!!f&&!c[f]){b=d.data("name");e.unshift({id:f,name:b})}if(e.length<=0){f=desknets.pageframe.getLoginUid();b=desknets.pageframe.getLoginName();e.push({id:f,name:b})}e.push({id:"select",name:desknets.Resource.sch.visitorChooseUser});return e},_updatePlantsWithEntry:function(){var b=[];this.$entry.find(".sch-row-plant .co-selitem").each(function(){b.push(a(this).children("span").text())});this.$root.find(".jsch-plants").text(b.join(", "))},_setFormValues:function(){var b=this._$entryVisitor.find('input[name="visit_location"]').val();var d=this._$entryVisitor.find('input[name="visit_locationdtl"]').val();var c=this._$entryVisitor.find('input[name="visit_note"]').val();neo.form.selectValue(this.$root.find('select[name="visit_location"]'),b);this.$root.find('input[name="visit_locationdtl"]').val(d);this.$root.find('textarea[name="visit_note"]').val(c);this._setDetailList()},_setDetailList:function(){var c=this._getDetailsFromElement(this._$entryVisitorList);var d=[];for(var b=0;b<c.length;b++){d.push(this._getListItem(this._tmplItem,c[b],b+1))}d.push(this._getListItem(this._tmplItem,null,b+1));this._$details.empty().html(d.join(""));desknets.htmlparts.addStripeClass(this._$details,"co-tr-even")},_changeUserContactTo:function(){var b=this,d,c;d=b._$contacter.val();if(d=="select"){c=b.page.getPrivilege()||"";desknets.chooser.open("jsch-edit-visitor-user-dialog",{mode:"single",chooseDisplayGroup:true,choosePrivateGroup:"readonly",unassignGroup:"readonly",cmdusers:"construct"+c+"cmdusersearch",choose:function(e){if(e.length>0){b._updateUserToContact(e[0].id,e[0].name)}}});setTimeout(function(){b._$contacter.val(b._contacterID)},0)}else{b._contacterID=d}},_updateUserToContact:function(d,b){this._$contacter.val(d);if(this._$contacter.val()!=d){var c=a("<option />").attr("value",d).text(b);this._$contacter.prepend(c).val(d)}},_onStartToEditDetail:function(b){var c=this;c._focusedIndex=b.prevAll().length;setTimeout(function(){c._onForusDetailRow()},1)},_onEndToEditDetail:function(b){var c=this;c._focusedIndex=-1;setTimeout(function(){c._onForusDetailRow()},1)},_onForusDetailRow:function(){var b=this;var c=b._$details.children("tr");var e=c.length-1;c.each(function(g){var f=a(this);var h=f.find("input").filter(function(){return !!this.value}).length>0;if(!h&&g!=e&&g!=b._focusedIndex){f.remove();if(g<b._focusedIndex){b._focusedIndex--}}});if(b._focusedIndex==e&&e<9){var d=this._getListItem(this._tmplItem,null,e+1);this._$details.append(d)}desknets.htmlparts.addStripeClass(this._$details,"co-tr-even")},_removeDetailRow:function(b){if(b.siblings().length<=0){var c=this._getListItem(this._tmplItem,null,1);a(c).insertBefore(b)}b.remove()},_updateEntryHiddenValue:function(){var c=this._$entryVisitor.find(".sch-entry-choose-buttons");var d=this.$root.find("form").serializeArray();c.children('input[type="hidden"]').remove();for(var b=0;b<d.length;b++){var e=a('<input type="hidden" />');e.attr("name",d[b].name);e.attr("value",d[b].value);e.appendTo(c)}},_replaceEntryList:function(c){var d=['<table class="sch-entry-visitor-list"><tbody>'];for(var b=0;b<c.length;b++){d.push(this._getListItem(this._tmplEntryItem,c[b],b+1))}d.push("</tbody></table>");this._$entryVisitorList.html(d.join(""));this._updateEntryList()},_updateEntryList:function(){var c=this._$entryVisitorList.find("tbody>tr");var b=this._$entryVisitor.hasClass("co-disabled");if(c.length>0&&!b){c.each(function(d){a(this).find("input").each(function(){this.name=this.name.replace(/\d+/,d+1)})});this._$entryVisitor.show()}else{this._$entryVisitor.find('.sch-entry-choose-buttons > input[type="hidden"]').val("");this._$entryVisitor.hide()}},_getListItem:function(b,e,c){var d=b;e=!!e?e:{officename:"",Name:"",members:""};d=desknets.tmpl.replaceWord(d,"officename",e.officename);d=desknets.tmpl.replaceWord(d,"Name",e.Name);d=desknets.tmpl.replaceWord(d,"members",e.members);d=desknets.tmpl.replaceWordHtml(d,"membersAsText",desknets.tmpl.dispMember(e.members));d=desknets.tmpl.replaceWordHtml(d,"index",c);return d},_getDetailsFromElement:function(b){var c=[];b.find("tr").each(function(){var g=a(this);var f=g.find('input[name^="visit_officename"]').val();var e=g.find('input[name^="visit_Name"]').val();var d=g.find('input[name^="visit_members"]').val();if(!!f||!!e){c.push({officename:f,Name:e,members:d})}});return c}});desknets.page(desknets.sch.input,"option",desknets.sch.input.base,{_TMPL_OTHER:'<li data-id="{{id}}"><input type="radio" name="iconno" value="{{id}}" id="co-edit-icon-other-{{id}}" /><label for="co-edit-icon-other-{{id}}">{{img}}</label></li>',id:"option",_$othersList:null,_$entryIcons:null,_$entryOptions:null,setReserveOnly:function(d){var b=this;if(!!b._$entryOptions&&b._$entryIcons){var c=b._$entryIcons.siblings(".sch-edit-select-title").andSelf();b._setIconEnability(!d);if(d){b._$entryIcons.html('<input type="hidden" name="iconno" />');b._updateIconElement()}b._$entryOptions.find("input:checkbox").each(function(){var e=a(this);if(d){e.attr("checked",e.is("#co-edit-option-tmp"))}e.attr("disabled",d);b._reflectCheckboxes(e)})}},_setUpEntry:function(){var b=this;b._$entryIcons=b.$entry.find(".sch-edit-option-field>.jsch-value-option");b._$entryOptions=b.$entry.find(".sch-row-options");b._updateIconElement();b._setUpOptionCheckboxes();b._$entryOptions.delegate("input:checkbox","click",function(c){b._reflectCheckboxes(a(this))})},_getDialogOptions:function(){var b=this.callBase("_getDialogOptions");var c=this._$entryIcons.siblings(".sch-edit-select-title").text();return a.extend(b,{width:500,height:"auto",title:c})},_loadContent:function(){var b=this;desknets.tmpl.load(b.$root,"sch/edit.option.html",function(){b._setUpContent()})},_setUpContent:function(){var b=this;b.callBase("_setUpContent");b._$othersList=b.$root.find(".co-edit-option-others>ul");desknets.ajax.rest({url:a("#inputfrm").attr("action"),data:{cmd:desknets.sch.CMD_SCHICONS},success:function(c){b._setUpOtherIcons(c);b._show()}});b.$root.find(".co-edit-icon-link>a").click(function(c){c.preventDefault();b._clearToCheck()})},_show:function(){this.callBase("_show");this._setFormValues()},_updateEntryValue:function(){var b=this,d="",c="";var e=b._$othersList.find("input:checked");b._$entryIcons.empty();if(e.length>0){d=e.attr("value");c=e.siblings("label").children("img").attr("title")}a('<input type="hidden" name="iconno" />').appendTo(b._$entryIcons).attr("value",d).data("title",c);b._updateIconElement()},_setUpOptionCheckboxes:function(){var b=desknets.sch.util.getSettings();this._$entryOptions.find("input:hidden").each(function(){var c=a(this).siblings("input:checkbox");c.attr("checked",this.value==c.val())})},_reflectCheckboxes:function(d){var f=d.siblings("input:hidden");var b=d.val();var c=f.val();var e=!!d.attr("checked")?b:"";if(c!=b&&e==b){f.val(e)}else{if(c==b&&e!=b){f.val(e)}}},_updateIconElement:function(){var d,e={};var b=this._$entryIcons.find('input[name="iconno"]');var c=Number(b.val());if(c){e.iconno={no:c,val:b.data("title")}}d=desknets.cal.tmpl.getIconsAsHtml(new desknets.cal.SchItem(e));if(d.length<=0){d=desknets.Resource.nothingLabel}a("<span />").html(d).appendTo(this._$entryIcons)},_setIconEnability:function(c){var b=this._$entryIcons.siblings(".sch-edit-select-title").andSelf();if(c){b.removeClass("co-disabled")}else{b.addClass("co-disabled")}},_setUpOtherIcons:function(d){var c=this;var e=[];var b=desknets.ajax.getJsonItems(d);a.each(b,function(f,h){var g=c._TMPL_OTHER;var i=desknets.cal.tmpl.getOtherIconHtml(h.id,h.Name);g=desknets.tmpl.replaceWordHtml(g,"id",h.id);g=desknets.tmpl.replaceWordHtml(g,"img",i);e.push(g)});c._$othersList.html(e.join(""))},_setFormValues:function(){var b=this;b._clearToCheck();b._$entryIcons.find("input").each(function(){var c=this;b.$root.find("input").filter(function(){return c.name==this.name&&c.value==this.value}).attr("checked",true)})},_clearToCheck:function(){this.$root.find("input").attr("checked",false)}});desknets.page(desknets.sch.input,"attach",null,{$entry:null,id:"attach",page:null,_$entryAttachList:null,_cmds:null,init:function(b){this.page=b;this.$entry=b.$mjPage;this._setUpEntry()},open:function(){this._$entryAttachList.dnAttachList("openChooser")},_setUpEntry:function(){this._setUpCmds();this._$entryAttachList=this.$entry.find(".jsch-attach-list");this._$entryAttachList.dnAttachList({hideElementOnEmpty:this.$entry.find(".sch-row-attaches"),uploadURL:desknets.getUrl(desknets.MODULE_API_MAIN),uploadParams:this._getParams(this._cmds.addUpload,this._cmds.modUpload),delURL:desknets.getUrl(desknets.MODULE_API_MAIN),delParams:this._getParams(this._cmds.addRemove,this._cmds.modRemove),downloadURL:this._getDownLoadURL()})},_setUpCmds:function(){this._cmds={modUpload:desknets.sch.CMD_SCHMODATTACH,modRemove:desknets.sch.CMD_SCHMODATTACHDEL,modGet:desknets.sch.CMD_SCHMODDISPATTACH};if(this.page.getPrivilege()=="mset"){for(var b in this._cmds){this._cmds[b]="schmset"+this._cmds[b].substring(3)}}a.extend(this._cmds,{addUpload:desknets.sch.CMD_SCHADDATTACH,addRemove:desknets.sch.CMD_SCHADDATTACHDEL,addGet:desknets.sch.CMD_SCHADDDISPATTACH})},_getDownLoadURL:function(){var b=this._getParams(this._cmds.addGet,this._cmds.modGet);return desknets.getUrl(desknets.MODULE_MAIN)+"?"+desknets.getNeoParam(b)+"&fno={{id}}"},_getParams:function(d,c){var e={};var b=this.$entry.find('input[name="sid"]');if(b.length>0){e={cmd:c,sid:b.val()}}else{e={cmd:d}}return e}});desknets.page(desknets.sch.input,"publiclevel",desknets.sch.input.base,{id:"publiclevel",_chooser:null,_$entryRow:null,_$entryUsers:null,_selTmpl:'<span class="co-selitem jsch-selitem-permituser"><span class="co-selitem-text" title="{{name}}">{{name}}</span><a href="#" class="co-btn co-btn-close" title="{{L_Delete}}">x</a><input type="hidden" name="{{keyName}}" value="{{id}}" data-id="{{id}}" data-name="{{name}}" /><div class="sch-permituser-summary" >{{summary}}</div><div class="sch-permituser-description" >{{description}}</div></span>',setReserveOnly:function(c){var b=this;if(!b._$entryRow||!b._$entryUsers){return}if(c){b._$entryRow.removeClass("permission");b._$entryRow.removeClass("secret");b._$entryUsers.html("");b._$entryRow.find('input[name="public_level"]').val("");b._$entryRow.addClass("sch-edit-reserve-only")}else{b._$entryRow.removeClass("sch-edit-reserve-only")}},_setUpEntry:function(){var c=this;var d=desknets.sch.util.getSettings();var f=c.$entry.find(".sch-edit-reserve-only-guide");c._$entryRow=c.$entry.find(".sch-row-public-level");if(Number(d.openperm)>=2){c._$entryUsers=null;c._$entryRow.remove();f.find(".sch-guide-nochange").remove()}else{c._$entryUsers=c._$entryRow.find(".jco-sel-items");f.find(".sch-guide-nochange-except-recipients").remove()}var e=desknets.Resource;var b=this._selTmpl;b=desknets.tmpl.replaceWord(b,"L_Delete",e.deselectLabel);this._selTmpl=b},_show:function(){var c=this;if(c._$entryRow.hasClass("permission")){c.$root.find("#sch-entry-publiclevel-permission").attr("checked",true)}else{if(c._$entryRow.hasClass("secret")){c.$root.find("#sch-entry-publiclevel-secret").attr("checked",true)}else{c.$root.find("#sch-entry-publiclevel-open").attr("checked",true)}}var b=desknets.chooser.getItemsFromElement(c._$entryUsers,{itemFilter:function(e,d){var f=d.closest(".co-selitem");if(f.hasClass("jsch-selitem-permituser")){e.summary=f.find(".sch-permituser-summary").html();e.description=f.find(".sch-permituser-description").html()}return e}});if(c._chooser){c._chooser.replaceItems(b)}else{c._chooser=desknets.chooser.setUpEntry(c.$root.find(".sch-entry-select-permituser"),b,{dialogID:"jsch-entry-permit-user",dialogOptions:c._getChooserOptions(),extraVars:{user:{keyName:"permit_user"}},filter:function(d,e){if(d.length>0){c.$root.find("#sch-entry-publiclevel-permission").attr("checked",true)}return true},template:c._selTmpl})}c.callBase("_show")},_validateEntry:function(){var b=this;if(b.$root.find("#sch-entry-publiclevel-permission").attr("checked")&&b.$root.find(".co-selitem").length==0){desknets.dialog.alert(desknets.Resource.Message.sch_no_permit_users);return false}return true},_updateEntryValue:function(){var b=this;b._$entryRow.removeClass("secret");b._$entryRow.removeClass("permission");b._$entryRow.addClass(b.$root.find('input[type="radio"]:checked').val());b._$entryRow.find('input[name="public_level"]').val(b.$root.find('input[type="radio"]:checked').val());b._$entryUsers.html(b.$root.find(".jco-sel-items").html());b._$entryUsers.find(".co-selitem").each(function(){a(this).find(".co-btn-close").remove();a(this).find("input").addClass("jco-sel-item")})},_updateEnability:function(){},_getChooserOptions:function(){var b=this;var c={chooseTarget:["user"],allGroup:"choosable",choosePrivateGroup:"choosable",chooseDisplayGroup:true,unassignGroup:"choosable",};return c},_tearDownEntry:function(){this._$entryRow=null;this._$entryUsers=null;if(this._chooser){this._chooser.destroy();this._chooser=null}}});a.widget("desknets.scheduleFreeTimeList",{_$tbody:null,_sDate:"",_startTime:null,_endTime:null,_cellWidth:16,_itemEntries:{},setRangeParams:function(c){var b=this;this.options.rangeParams=c;desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:b._getSelectRangeParams(),success:function(d){b._setSelectedTimes(d);b._trigger("updated")}})},_getFreeTimeParams:function(b){},_getEventsParams:function(b){},_convertCalItems:function(b){return[]},_attachCommonEvent:function(){var b=this;b._$tbody.on("click",".sch-item",function(c){c.preventDefault();b._openDetailPopUp(a(this))})},_loadFreeTime:function(f,e){var b=this;var c=neo.array.getKeyArray(f);var d=b._getFreeTimeParams(f);d.push(b._getSelectRangeParams());desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:desknets.ajax.arrayToMultiCmdData(d),detectMultiError:true,success:function(h){var g=b._getFreeTimeItems(h,c);if(typeof e=="function"){e(h)}b._setSelectedTimes(h[c.length]);b._setFreeTimeElements(g);b._trigger("updated")}})},_getXCoordByDateStr:function(h,e,g){if(!!h&&h<this._sDate){return 0}else{if(h>this._sDate){return this._cellWidth*24}else{e=!!e?e:g;var c=Number(e.substring(0,2));var i=Number(e.substring(2,4));var f=Math.min(c+i/60,24)*2;var d=this._cellWidth/2;var b=e<g?"ceil":"floor";return Math[b](f)*d}}},_getSelectRangeParams:function(){var b=this.options.rangeParams||{};return a.extend({cmd:"schtimerange",date:this._sDate},b)},_setSelectedTimes:function(b){if(!!b&&!!b.starttime&&!!b.endtime){this._startTime=b.starttime;this._endTime=b.endtime}else{this._startTime=null}this._setSelectionRange(this._$tbody.parent().find("tr"))},_setSelectionRange:function(c){var b=this;this._$tbody.parent().find(".sch-entry-free-time-range").remove();if(!!b._startTime){c.each(function(){var d=a(this);if(b._startTime<=b._endTime){b._addRangeElement(d,b._startTime,b._endTime)}else{b._addRangeElement(d,"0000",b._endTime);b._addRangeElement(d,b._startTime,"2400")}})}},_addRangeElement:function(b,f,d){var h=this._getRangeElement(b);var g=this._getXCoordByDateStr(this._sDate,f,"0000");var c=this._getXCoordByDateStr(this._sDate,d,"2400");var e=Math.max(c-g,this._cellWidth/2)-4;h.css({left:g+"px",width:e+"px"})},_getRangeElement:function(b){var c=a('<div class="sch-entry-free-time-range" />');c.text(desknets.Resource.sch.freeTimeRangeLabel);c.appendTo(b.find(".sch-entry-free-time-item-bars"));return c},_getFreeTimeItems:function(e,d){var b={},f=0,c=0;while(!!e[f]&&!!d[c]){if(!!e[f].busytime&&e[f].busytime.item){b[d[c]]=desknets.ajax.getItems(e[f].busytime.item)}f++;c++}return b},_setFreeTimeElements:function(c){for(var f in c){var d=c[f];for(var e=0;e<d.length;e++){var b=this._getRowElementById(f,d[e].id);b.addClass("jco-sel-choosable");this._setFreeTimeElement(b,d[e])}}},_setFreeTimeElement:function(b,f){if(!!f.startdate&&!!f.enddate&&f.startdate<=this._sDate){var g=this._getXCoordByDateStr(f.startdate,f.starttime,"0000");var c=this._getXCoordByDateStr(f.enddate,f.endtime,"2400");var e=60/this._cellWidth;var d=c-g;if(d<0){d=this._cellWidth*24-g}else{if(d<this._cellWidth/2){d=this._cellWidth/2}}a('<a class="sch-item" href="#" />').css({left:g+"px",width:(d-2)+"px"}).data("start",g*e).data("end",c*e).appendTo(b.find(".sch-entry-free-time-item-bars"))}},_getRowElementById:function(c,d){var b=this._itemEntries[c+"-"+d];return !!b?b:a([])},_openDetailPopUp:function(c){var b=this;desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:b._getEventsParams(c),success:function(d){b._showDetailPopUp(c,b._convertCalItems(d))}})},_showDetailPopUp:function(d,f){var g=d.data("start"),c=d.data("end");var b=this._getBlankPopUp();var e=this._getEventsHtml(f,g,c);b.find(".co-baloon-body").html(e);desknets.popUp.open(b,{target:d})},_getBlankPopUp:function(){var b=a("#sch-entry-free-detail-pop-up");if(b.length<=0){$popup=a(desknets.popUp.TMPL_POP_UP).attr("id","sch-entry-free-detail-pop-up");$popup.addClass("side-connecter large-connecter");$popup.appendTo("body")}else{$popup.find(".co-baloon-body").empty()}return $popup},_getEventsHtml:function(e,g,b){var c=this,d=[],f=10;a.each(e,function(j,h){if(c._isInRange(h,g,b)){if(f>0){d.push(c._getEventHtml(h))}f--}});if(f<0){d.push(this._getEventRestHtml(-f))}return d.join("")},_getEventHtml:function(b){var c=this._getCalDateTimeText(b);return desknets.cal.tmpl.getItemHtml(b,{term:c,termTip:c,link:false})},_getEventRestHtml:function(b){var c=desknets.Resource.sch.freeTimeRestFormat;c=desknets.tmpl.replaceWordHtml(c,"rest",String(b));return'<div class="sch-entry-free-detail-rest">'+c+"</div>"},_isInRange:function(b,f,c){if(!b.starttime&&!b.endtime){return false}var d=(b.startdate==this._sDate)?b.getStartTimeAsMinute():0;var e=(b.enddate==this._sDate)?b.getEndTimeAsMinute():1440;return f<=d&&e<=c},_getCalDateTimeText:function(b){if(b.startdate==b.enddate){return b.getTimeText()}else{return b.getDateTimeText()}}});a.widget("desknets.schedulePlantFreeTimeList",a.desknets.scheduleFreeTimeList,{options:{cmdPlants:"plantselplant",cmdFree:"plantentryfree",perPage:100},_TMPL:'<tr data-reserve-only="{{reserve}}"><th><input type="checkbox" value="{{id}}" id="jsch-entry-plant-reserve-{{id}}" /><label for="jsch-entry-plant-reserve-{{id}}" title="{{Name}}">{{Name}}</label></th><td><div class="sch-entry-free-time-item-bars"></div></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>',_cellWidth:20,_gid:0,_ids:[],_create:function(){this.options.date=this.options.date||new Date();this._$tbody=this.element.find("table>tbody");this._sDate=neo.dateTime.format("yyyyMMdd",this.options.date);this._attachCommonEvent()},setID:function(b){this._gid=b;this._loadPlantList(0)},setOffset:function(b){this._loadPlantList(b)},setDate:function(b){this.options.date=b;this._sDate=neo.dateTime.format("yyyyMMdd",b);this._$tbody.find(".sch-item").remove();this._loadFreeTime({plant:this._ids})},_getFreeTimeParams:function(b){var c=[];if(a.isArray(b.plant)){c.push({cmd:this.options.cmdFree,pid:b.plant,date:this._sDate,accesskind:"1"})}return c},_getEventsParams:function(b){var c=b.closest("tr").find("input:checkbox").val();return{cmd:"plantprivate",proc:"d",id:c,date:this._sDate}},_convertCalItems:function(c){var b=!!c.slist?desknets.ajax.getItems(c.slist.item):[];return desknets.cal.item.getItemsFromPlant(b)},_loadPlantList:function(d){var b=this;var c=function(f){var e=desknets.ajax.getJsonItems(f);b._replacePlantList(e);b._updatePlantPager(d,f.allcnt)};desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:{cmd:this.options.cmdPlants,accesskind:"2",gid:b._gid,row:d,num:b.options.perPage},success:function(e){b._saveIds(e);b._loadFreeTime({plant:b._ids},function(){c(e)})}})},_saveIds:function(c){var b=desknets.ajax.getJsonItems(c);var d=[];a.each(b,function(e,f){d.push(f.id)});this._ids=d},_replacePlantList:function(c){var b=this;b._$tbody.empty();b._itemEntries={};if(c.length>0){a.each(c,function(e,g){var f=b._TMPL,d;f=desknets.tmpl.replaceWordHtml(f,"id",g.id);f=desknets.tmpl.replaceWord(f,"Name",g.Name);f=desknets.tmpl.replaceWord(f,"reserve",g.reservschlimit);d=a(f).appendTo(b._$tbody);b._itemEntries["plant-"+g.id]=d});this.element.removeClass("sch-list-no-data")}else{this.element.addClass("sch-list-no-data")}},_updatePlantPager:function(d,c){var b=this;var e=b._$tbody.children().length;desknets.Pager.output(b.options.pager,".sch-plant-free-time-list",{getCount:e,pageMaxView:b.options.perPage,allCount:c,startRow:d,clickFunc:function(f){b._loadPlantList(f)}})}});a.widget("desknets.scheduleChoosenList",a.desknets.scheduleFreeTimeList,{_tmpl:null,_$dateNav:null,_initialized:false,options:{items:[],lockedItems:{},getInitialDate:function(){return new Date()},getRangeParams:function(){return{}},cmdUserFree:"schentryfree",cmdGroupFree:"schgrpfree"},_create:function(){var b=this;b.element.addClass("sch-entry-free-time co-sel-choosen-items");desknets.tmpl.load(b.element,"sch/widget.choosenList.html",function(){b._setUpContent();b._createEvents();b._createLockedItems();b._setItems(b.options.items);b._initialized=true},{cache:true})},items:function(b){if(b===undefined){return this.options.items}else{this._setItems(b);return this.element}},add:function(b){if(!a.isArray(b)){b=[b]}this._addItems(b)},destroy:function(){this._$tbody.undelegate(".remove","click");this.element.find("thead .remove-all").unbind("click");this.element.find(".sch-switch > *").unbind("click");this.element.empty()},_getFreeTimeParams:function(b){var c=[];if(a.isArray(b.group)){c.push({cmd:this.options.cmdGroupFree,gid:b.group[0],date:this._sDate})}if(a.isArray(b.user)){c.push({cmd:this.options.cmdUserFree,id:b.user,date:this._sDate})}return c},_getEventsParams:function(b){var c=b.closest("tr").data("item");var d={cmd:"schprivate",proc:"d",date:this._sDate};d[c.type=="group"?"gid":"id"]=c.id;return d},_convertCalItems:function(c){var b=!!c.slist?desknets.ajax.getItems(c.slist.item):[];return desknets.cal.item.getItemsFromSch(b)},_setUpContent:function(){var b=this;var c=b.options.getInitialDate();b._$tbody=b.element.find("tbody");b._sDate=neo.dateTime.format("yyyyMMdd",c);b._tmpl=b._$tbody.html();b._$tbody.empty();b._$dateNav=b.element.find(".jsch-cal-date-header");desknets.htmlparts.setUpDateNav(b._$dateNav,{date:c,eventWait:desknets.TIME_GETLIST_LAG,change:function(e,d){b._changeDate(d.date)}})},_createEvents:function(){var b=this;b._attachCommonEvent();b.element.find("thead .remove-all").click(function(c){c.preventDefault();b._removeAllItems()});b._$tbody.delegate(".remove-item","click",function(c){c.preventDefault();b._removeSelectedItem(a(this))})},_createLockedItems:function(){var b=this;b._lockedItems={};a.each(this.options.lockedItems,function(c,d){b._lockedItems[d.type+"-"+d.id]=true})},_setItems:function(b){this._$tbody.empty();this._itemEntries={};this._addItems(b)},_addItems:function(d){var c=this,e=[];var b={};a.each(d,function(f,h){var g=h.type+"-"+h.id;if(c._itemEntries[g]){c._updateItem(g,h)}else{e.push(h);c._addItem(g,h)}});c._loadFreeTimeWithItems(e);c._onChangeItems()},_removeAllItems:function(){var b=this;this._$tbody.children().each(function(){b._removeItem(a(this))});b._onChangeItems()},_removeSelectedItem:function(b){this._removeItem(b.closest("tr"));this._onChangeItems()},_onChangeItems:function(){this.options.items=this._getItems();if(this._initialized){this._trigger("change")}},_getItems:function(){var b=[];this._$tbody.children().each(function(){b.push(a(this).data("item"))});return b},_removeItem:function(b){var d=b.data("item");var c=d.type+"-"+d.id;if(!this._lockedItems[c]){delete this._itemEntries[c];b.remove()}},_addItem:function(b,d){var c=a(this._tmpl).data("item",d).attr("class",d.type).appendTo(this._$tbody);if(!!this._lockedItems[b]){c.addClass("locked")}c.find(".name-text").text(d.name);if(d.type=="user"){c.find(".name-text").addClass("namelink jco-ref-dialog-link").attr("data-refid",d.type+d.id)}this._itemEntries[b]=c},_updateItem:function(b,d){var c=this._$tbody.children().filter(function(){var e=a(this).data("item");return e.id==d.id&&e.type==d.type});c.find(".name-text").text(d.name);c.data("item",d);this._itemEntries[b]=c},_changeDate:function(b){this._sDate=neo.dateTime.format("yyyyMMdd",b);this._$tbody.find(".sch-item").remove();this._loadFreeTimeWithItems(this._getItems())},_loadFreeTimeWithItems:function(b,e){var d={};this.options.rangeParams=this.options.getRangeParams();if(b.length>0){for(var c=0;c<b.length;c++){if(!d[b[c].type]){d[b[c].type]=[]}d[b[c].type].push(b[c].id)}this._loadFreeTime(d,e)}}});desknets.page(desknets.sch,"schreferdtl",desknets.PageDispBase,{_refdelconfirm:"0",_refrep:"",_refdelkind:null,_refapprov:null,_refapprovreq:null,_refseldate:null,_refstarttime:null,mboOtherToInMy:false,initReqSend:function(){this.initPage(desknets.sch.util.getBackPage(),desknets.sch.util.getBackId())},_initSet:function(f){var b;this._refdelconfirm=f[0].delconfirm;this._refrep=f[0].repeat;this._refapprov=f[0].approvsts;this._refapprovreq=f[0].approvreq;this._refseldate=f[0].seldate;this._refstarttime=f[0].starttime;b="sch-view-status-"+desknets.cal.item.getColorById(f[0].schcolor);this.$mjPage.find(".co-vbtnarea").addClass(b);var e=this.$mjPage.find(".sch-pop-input-icon");e.find(".sch-ictype1-agenda").remove();e.find(".sch-ictype1-agendaend").remove();desknets.tagDisp.initTagEvent(desknets.MODULE_API_MAIN,this._getSchRefTagParam());this.callBase("_initSet",f);var d=this;var g=function(j,i){return d._makeCabTemplate(d.$mjPage,i,f[0])};var h={copymodule:desknets.MODULE_API_MAIN,copycmd:this._getSchRefCabCopyCmd(),cabmaketemplate:g};h.cabtitle=desknets.cal.getSubject(f[0].event,f[0].detail);if(h.cabtitle==""){h.cabtitle="--"}h.cabsparetitle=f[0].event;var c=false;if(!neo.isSet(f[0]["attach"])){c=true}desknets.cabinetregist.init(this.$mjPage,h,c)},_makeCabTemplate:function(b,h,e){var g=b.find(".jco-cab-template").html();var c=a("<div>"+g+"</div>");desknets.attachDisp.removeAttachAlink(c);var d=desknets.cal.tmplRef.dispOptionName(e);c.find(".jsch-refer-option").text(d);c.find(".sch-subentry").css({border:"1px solid #FFEE66","background-color":"#FFFFEE","line-height":"1.5em"});var f=c.find("table.sch-subentry");f.css({"border-collapse":"collapse",width:"100%"});f.find("th").css({padding:"2px 4px",width:"100px",color:"#666666","text-align":"right","white-space":"nowrap"});return desknets.tmpl.replaceWordHtml(h,"body",c.html())},_inputButton:function(){var b=this;b.callBase("_inputButton");b.$mjPage.find(".jsch-button-approv").click(function(c){c.preventDefault();b._onClickSchRefApprov("admit")});b.$mjPage.find(".jsch-button-denial").click(function(c){c.preventDefault();var d=desknets.Resource.Message.sch_confirm_denial;$dialog=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled($dialog);b._onClickSchRefApprov("denial",$dialog);return false})});b.$mjPage.find(".jsch-button-copy").click(function(c){c.preventDefault();b._onClickSchRefCopy()});b.$mjPage.find(".sch-msg-alarm").click(function(c){c.preventDefault();b._onClickSchRefAlarm()});if(b.isCost()){b.$mjPage.find(".cost-msg-cost").click(function(e){e.preventDefault();if(b.$mjPage.find(".cost-sch-sum").data("count")>=desknets.cost.micostmaxcnt){desknets.dialog.alert(desknets.tmpl.replaceWordHtml(desknets.Resource.cost.cost_notaddschcost,"count",desknets.cost.micostmaxcnt),{});return}params=desknets.paramanalyzer.getHashParams();var f=desknets.cost.costOpenGetDefOption();var d=b.$mjPage.find(".jsch-referdtl-event").text();if(d==" "||d=="\u00A0"){d=""}f.data.title=d;f.data.seldate=params.seldate;f.starttime=b._refstarttime;var c={sid_sch:params.sid};c.oncomplete=function(){b._getCostSchData()};f.oncomplete=function(g,h){desknets.cost.costOnComplete(g,c,h)};f.bosch=true;desknets.cost.input.open(f)});b.$mjPage.find(".cost-sch-sum").click(function(e){e.preventDefault();params=desknets.paramanalyzer.getHashParams();var d={cmd:"costcmdschindex",sid_sch:params.sid};var c={sid_sch:params.sid,starttime:b._refstarttime};c.oncomplete=function(){b._getCostSchData()};c.bosch=true;desknets.ajax.rest({url:desknets.cost.getUrl(),data:d,success:function(i,f,k){var h=desknets.ajax.getJsonItems(i);if(h.length==0){params=desknets.paramanalyzer.getHashParams();var g={};g.id="";g.name=b.$mjPage.find(".jsch-referdtl-event").text();g.date=params.seldate;g.list=[];desknets.cost.costModOpen(g,c)}else{if(h.length<=1){desknets.cost.costModOpenGet(h[0].id,c)}else{var j={};j.data={};j.data.list=h;j.oncomplete=function(m,l){desknets.cost.costModOpenGet(m,c,l)};desknets.cost.inputsel.open(j)}}},})});b._getCostSchData()}b._inputButtonAgendaRegistryEvent();this._inputButtonMail()},_inputButtonAgendaRegistryEvent:function(){var c=this;var b=c.$mjPage.find(".sch-msg-agenda");b.click(function(d){d.preventDefault();var f=desknets.paramanalyzer.getHashParams();var e={cmd:c._getDispExecCmd(),sid:f.sid,seldate:f.seldate||""};desknets.ajax.rest({async:false,url:desknets.getUrl(desknets.MODULE_API_MAIN),data:e,success:function(j,g,k){if(neo.isSet(j.agnids,{blank:false})){e.agnids=j.agnids}delete e.cmd;var h=c._getAgendaUrl(e);if(e.agnids==0){var i;var l=desknets.Resource.Message.com_open_agendaadd;i=desknets.dialog.confirm(l,function(){desknets.submitform.setDialogDisabled(i);desknets.execLocation(h,"_blank")})}else{desknets.execLocation(h,"_blank")}}})})},_getAgendaUrl:function(b){return desknets.cal.refPopUp.GetAgendaUrl(b,false)},_inputButtonMail:function(){var c=this;var d={};var b=desknets.paramanalyzer.getHashParams();d.connectid=b[c._getIDName()];d.restmodule=c._getRestModule();d.restcmd=c._getConnectAppCmd();c.$mjPage.find(".jco-connectmail").click(function(e){e.preventDefault();desknets.connectapp.connectMail(d)})},isCost:function(){var b=this;if(!desknets.pageframe.isCost()){return false}params=desknets.paramanalyzer.getHashParams();if(!!params.mydata&&params.mydata!="1"){return false}if(!b.mboOtherToInMy){return false}return true},_initHtmlTmplSet:function(d){var c=this;c._initAgendaHtmlTmplSet(d);if(!!d[0].otherto&&!!d[0].otherto.item){c.mboOtherToInMy=false;var b=desknets.pageframe.getLoginUid();var e=desknets.ajax.getItems(d[0].otherto.item);a.each(e,function(f,g){if(b==g.id){c.mboOtherToInMy=true;return false}})}if(c.isCost()){d[0]["cost"]="1"}c.callBase("_initHtmlTmplSet",d)},_getCostSchData:function(){var b=this;params=desknets.paramanalyzer.getHashParams();desknets.ajax.rest({url:desknets.cost.getUrl(),data:{cmd:"costcmdschindex",sid_sch:params.sid},success:function(h,d,i){var j=desknets.ajax.getJsonItems(h);var g=b.$mjPage.find(".cost-sch-sum");var f=j.length;g.data("count",f);if(f>0){var c=0;a.each(j,function(k,l){c=c+Number(l.total_amount)});var e=desknets.tmpl.replaceWordHtml(desknets.Resource.cost.price,"price",desknets.numberFormat(c));if(f>=2){f--;e=e+" ("+desknets.tmpl.replaceWordHtml(desknets.Resource.cost.costother,"count",f)+")"}g.find(".cost").text(e);g.show()}else{g.hide()}},})},_initAgendaHtmlTmplSet:function(d){var b=this;if(!neo.isSet(d[0].agnids,{blank:false})){return}var e=desknets.paramanalyzer.getHashParams();var c={sid:e.sid,seldate:e.seldate||"",agnids:d[0].agnids};d[0]["agendaUrl"]=b._getAgendaUrl(c)},_getDispExecCmd:function(){return desknets.cal.CMD_SCH_REF},_getDispModCmd:function(){return desknets.sch.PAGE_SCHMOD},_inputDelConfSubmit:function(f){var d;var b=this;d=desknets.paramanalyzer.getHashParams();var e=d[b._getIDName()];var c={cmd:b._getDelExecCmd(),approval:!desknets.cal.tmplRef.isApprovOrNormal(this._refapprov,this._refapprovreq),confirm:b._refdelconfirm,date:neo.dateTime.parse(d.seldate),repeat:b._refrep,success:function(){b.dispBackListPage()}};desknets.cal.deleteItem(e,c)},_getDelPrm:function(){var b={};if(neo.isSet(this._refdelkind)){b.modkind=this._refdelkind;b.seldate=this._getSchRefSelDate();this._refdelkind=null;if(this._refdelconfirm==desknets.sch.VAL_SCHDELSELF){b.delkind=desknets.sch.VAL_SCHDELALL}}return b},_getDelExecCmd:function(){return desknets.sch.CMD_RSCHDEL},_getIDName:function(){return"sid"},getLocationFormParam:function(){var b=this.callBase("getLocationFormParam");if(this._isSchRefTopPage(b.cmd)){desknets.sch.util.goToPage();a("#jco-m-sub-title").html("")}else{return b}},_formObserveisChanged:function(){return},_getSchRefSelDate:function(){var c=desknets.paramanalyzer.getHashParams();var b;if(neo.isSet(this._refseldate,{blank:false})){b=this._refseldate}else{b=c.seldate}return b},_getSchRefTagParam:function(){var b=desknets.paramanalyzer.getHashParams();b.cmd=desknets.sch.CMD_RSCHMODTAG;return b},_onClickSchRefApprov:function(f,e){var b=this;var d=desknets.paramanalyzer.getHashParams();d.cmd=this._getSchRefApprovCmd();d.proc=f;var c={success:function(h,g,i){b._onSuccessSchRefApprov(h)},complete:function(){if(neo.isSet(e)){desknets.submitform.clearDialogDisabled(e)}}};this._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,d,c)},_onSuccessSchRefApprov:function(d){var b=this;if(!!d.noticeerror){var c=desknets.dialog.alert(d.noticeerror,{extraMessage:d.msgadd,extraClass:"co-msg-r",type:"warn"});c.bind("dialogclose",function(f){desknets.dialog.deleteById("warn");b.dispBackListPage()});return}setTimeout(function(){b.dispBackListPage()},100)},_isSchRefTopPage:function(b){return desknets.sch.util.isTopPage(b)},_onClickSchRefCopy:function(){var b=desknets.paramanalyzer.getHashParams();b.copyid=b.sid;delete b.sid;b.cmd=this._getSchRefAddCmd();this._setLocationHash(b)},inputModPage:function(){var b=this;var c={};c=desknets.paramanalyzer.getHashParams();c.cmd=b._getDispModCmd();c.detail="1";b._setLocationHash(c)},_onClickSchRefAlarm:function(){desknets.sch.schreferdtl.alarm.init(this);desknets.sch.schreferdtl.alarm.open()},_getSchRefAddCmd:function(){return desknets.sch.PAGE_SCHADD},_getSchRefApprovCmd:function(){return desknets.sch.CMD_RSCHMODAPPROV},_getSchRefCabCopyCmd:function(){return desknets.sch.CMD_SCHCPCABATTACH},_getConnectAppCmd:function(){return desknets.sch.CMD_SCHCONNECTAPP},});desknets.page(desknets.sch.schreferdtl,"alarm",desknets.sch.input.alarm,{_$referAlarm:null,_setUpEntry:function(){this._$entryAlarm=this.$entry.find(".jsch-title-alarm");this._$entryStatus=this.$entry.find('input[name="alarm"]');this._$entryTime=this.$entry.find('input[name="alarmtime"]');this._$referAlarm=this.$entry.find(".jsch-refer-alarm")},_getDialogOptions:function(){var b=this;var d={};var c=a.extend(desknets.dialog.getDialogOption(),{title:b.$entry.find(".jsch-title-"+b.id).text(),buttons:d});d[desknets.Resource.OKButtonLabel]=function(e){desknets.submitform.setDialogDisabled(b.$root);b._submitAlarmEntry()};d[desknets.Resource.CancelButtonLabel]=function(e){a(this).dialog("close")};return c},_submitAlarmEntry:function(){var c=this;var d;var f={};var b=desknets.paramanalyzer.getHashParams();d=desknets.getUrl(desknets.MODULE_API_MAIN);f.cmd=desknets.sch.CMD_RSCHMODALARM;var e=this._$alarm.val();if(!!e){f.alarm=desknets.cal.tmplRef.ALARM_USE;f.alarmtime=e}else{f.alarm=desknets.cal.tmplRef.ALARM_NONUSE;f.alarmtime="0"}f.sid=b.sid;desknets.ajax.rest({url:d,data:f,success:function(h,g,i){c._updateEntryValue();c.$root.dialog("close")},complete:function(h,g){desknets.submitform.clearDialogDisabled(c.$root)}})},_updateEntryValue:function(){var b=this._$alarm.val();if(!!b){this._$entryStatus.val(desknets.cal.tmplRef.ALARM_USE);this._$entryTime.val(b);this._$referAlarm.show()}else{this._$entryStatus.val(desknets.cal.tmplRef.ALARM_NONUSE);this._$entryTime.val("");this._$referAlarm.hide()}this._updateEntryText(b)},_updateEntryText:function(c){var b;if(this._$entryStatus.val()==desknets.cal.tmplRef.ALARM_USE){b=desknets.cal.tmplRef.dispAlarm(desknets.cal.tmplRef.ALARM_USE,c)}else{b=desknets.cal.tmplRef.dispAlarm(desknets.cal.tmplRef.ALARM_NONUSE,c)}this._$entryAlarm.attr("title",b);this._$referAlarm.find(".jsch-alarm-time").text(b)}});(function(b){desknets.page(desknets.sch,"subwinset",desknets.sch.subwin,{initReqSend:function(){this.init();this.newTargetDate=b("#jsch-swin-caldate").val();this._sendRequestAjax()},_getMainCmd:function(){return desknets.sch.PAGE_SCHINDEX},_initSchSWinRegistryMenuEvent:function(){var c=this;b("#jsch-swin-menu").find("a").click(function(g){var f;g.preventDefault();var e=b(this).attr("href");var d=b(this).attr("target");desknets.execLocation(e+"&caldate="+c.targetMonth,d)});c._initSchSWinRegistryMenuEventTargetSet()}})})(jQuery);desknets.page(desknets.sch,"schpselalldlg",desknets.sch.schpseldlg,{_initSchPSelDlgRegistryEvent:function(){var b=this;b.callBase("_initSchPSelDlgRegistryEvent");b._initPlantSelDlgAllSelectEvent()},_initPlantSelDlgAllSelectEvent:function(){var b=this;b._$dialog.find(".sch-pseldlg-pgroup-all").show();b._$dialog.find(".sch-pseldlg-pgroup-all-chk").click(function(d){var c=a(this).prop("checked");b._$dialog.find("#plant-pop-sel-list").find("input[type=checkbox]").prop("checked",c)})},_setSchPSelDlgPlant:function(c){var b=this;var d=[];b.callBase("_setSchPSelDlgPlant",c);d=desknets.ajax.getJsonItems(c);if(d.length<=0){b._$dialog.find(".sch-pseldlg-pgroup-all-chk").prop("checked",false);return}},_initSchPSelCheck:function(){var b=this;var d=true;var c=this._$dialog.find("#plant-pop-sel-list").find("input:checkbox");if(c.length==0){d=false}c.each(function(){var f=a(this);var e=f.val();if(b._inArray(e,b._ids)>=0){f.prop("checked",true)}else{d=false}});b._$dialog.find(".sch-pseldlg-pgroup-all-chk").prop("checked",d)}});desknets.page(desknets.sch,"schmsetindex",desknets.sch.schindex,{getStartPage:function(){var b=this.callBase("getStartPage");return b.replace("sch","schmset")}});desknets.page(desknets.sch,"schmsetday",desknets.sch.schday,{cmds:desknets.sch.msetCmds,getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHMSETDAY},getCmdForCalendar:function(b){if(b=="week"){return desknets.sch.PAGE_SCHMSETWEEK}if(b=="day"){return desknets.sch.PAGE_SCHMSETDAY}return b},getPrintPageID:function(){return"schmsetprtday"},_resetSubWinMenu:function(){}});desknets.page(desknets.sch,"schmsetweek",desknets.sch.schweek,{cmds:desknets.sch.msetCmds,getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHMSETWEEK},getCmdForCalendar:function(b){if(b=="week"){return desknets.sch.PAGE_SCHMSETWEEK}if(b=="day"){return desknets.sch.PAGE_SCHMSETDAY}return b},getPrintPageID:function(){return"schmsetprtweek"},_resetSubWinMenu:function(){}});desknets.page(desknets.sch,"schmsetmonth",desknets.sch.schmonth,{cmds:desknets.sch.msetCmds,getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHMSETMONTH},getCmdForCalendar:function(b){if(b=="week"){return desknets.sch.PAGE_SCHMSETWEEK}if(b=="day"){return desknets.sch.PAGE_SCHMSETDAY}return b},getPrintPageID:function(){return"schmsetprtmonth"},_resetSubWinMenu:function(){}});desknets.page(desknets.sch,"schmsetdaygrp",desknets.sch.schdaygrp,{cmds:desknets.sch.msetCmds,getPrintPageID:function(){return"schmsetprtdaygroup"},getParamCommandGroup:function(){return desknets.sch.CMD_RSCHMSETGROUP},getParamCommandGroupPrivate:function(){return desknets.sch.CMD_RSCHMSETPRIVATEGROUP},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHMSETGDAY},_resetSubWinMenu:function(){}});desknets.page(desknets.sch,"schmsetweekgrp",desknets.sch.schweekgrp,{cmds:desknets.sch.msetCmds,getPrintPageID:function(){return"schmsetprtweekgroup"},getParamCommandGroup:function(){return desknets.sch.CMD_RSCHMSETGROUP},getParamCommandGroupPrivate:function(){return desknets.sch.CMD_RSCHMSETPRIVATEGROUP},getSchCalAreaCmd:function(){return desknets.sch.PAGE_SCHMSETGWEEK},getCmdForCalendar:function(b,c){if(b=="day"){return c.data("target")=="me"?desknets.sch.PAGE_SCHMSETDAY:desknets.sch.PAGE_SCHMSETGDAY}return b},_resetSubWinMenu:function(){}});desknets.page(desknets.sch,"schmsetadd",desknets.sch.schadd,{getPrivilege:function(){return"mset"}});desknets.page(desknets.sch,"schmsetaddtarget",desknets.sch.schaddtarget,{});desknets.page(desknets.sch,"schmsetmod",desknets.sch.schmod,{_getDelExecCmd:function(){return desknets.sch.CMD_RSCHMSETDEL},getPrivilege:function(){return"mset"}});desknets.page(desknets.sch,"schmsetreferdtl",desknets.sch.schreferdtl,{_getDispExecCmd:function(){return desknets.sch.CMD_RSCHMSETREFER},_getDispModCmd:function(){return desknets.sch.PAGE_SCHMSETMOD},_getDelExecCmd:function(){return desknets.sch.CMD_RSCHMSETDEL},_getSchRefAddCmd:function(){return desknets.sch.PAGE_SCHMSETADD},_getSchRefCabCopyCmd:function(){return desknets.sch.CMD_SCHMSETCPCABATTACH},_getConnectAppCmd:function(){return desknets.sch.CMD_SCHMSETCONNECTAPP},});app.addInitialAction(function(){desknets.sch.init()})})(jQuery);