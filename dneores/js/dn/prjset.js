/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.prjset={MODULE_PRJ:"zproject",MODULE_API_PRJ:"zrproject",PAGE_PRJPSETGEN:"prjpsetgen",PAGE_PRJMSETLIST:"prjmsetlist",PAGE_PRJMSETPRJENTRY:"prjmsetprjentry",PAGE_PRJMSETGANTTLIST:"prjmsetganttlist",CMD_PRJMSETTASKLISTGT:"prjmsetcmdtasklistgt",CMD_PRJMSETPROJECTUSERS:"prjmsetcmdprojectusers",CMD_PRJMSETTASKUSERS:"prjmsetcmdtaskusers",CMD_PRJMSETTASKDEL:"prjmsetcmdtaskdel",CMD_PRJMSETTASKENTRY:"prjmsetcmdtaskentry",CMD_PRJMSETTASKENTRYMV:"prjmsetcmdtaskmv",PAGE_PRJMSETMOVETASK:"prjmsetmovetaskindex",CMD_PRJMSETMOVETASKLIST:"prjmsetcmdmovetasklist",CMD_PRJMSETPROCESSLIST:"prjmsetcmdprocesslist",CMD_PRJMSETMOVESEQNOTASK:"prjmsetcmdmoveseqnotask",CMD_PRJMSETMOVETASK:"prjmsetcmdmovetask",PAGE_PRJMSETSEARCH:"prjmsetsearch",CMD_PRJMSETTASKSEARCHINDEX:"prjmsetcmdsrchindex",CMD_PRJMSETTASKSEARCHSTOP:"prjmsetcmdsrchstop",PAGE_PRJMSETREPORTLIST:"prjmsetreportindex",CMD_PRJMSETPRJENTRY:"prjmsetcmdprjentry",CMD_PRJMSETPRJDEL:"prjmsetcmdprjdel",CMD_PRJMSETLIST:"prjmsetcmdlist",CMD_PRJMSETTASKINFO:"prjmsetcmdtaskinfo",CMD_PRJMSETTASKLIST:"prjmsetcmdtasklist",CMD_PRJMSETREPORTLIST:"prjmsetcmdreportlist",CMD_PRJMSETREPORTENTRY:"prjmsetcmdreportentry",CMD_PRJMSETREPORTDELCONF:"prjmsetcmdreportdelconf",CMD_PRJMSETREPORTDEL:"prjmsetcmdreportdel",CMD_PRJMSETCOMMENTLIST:"prjmsetcmdcommentlist",CMD_PRJMSETCOMMENTENTRY:"prjmsetcmdcommententry",CMD_PRJMSETCOMMENTDELCONF:"prjmsetcmdcommentdelconf",CMD_PRJMSETCOMMENTDEL:"prjmsetcmdcommentdel",CMD_PRJMSETREFATTACH:"prjmsetdispattach",CMD_PRJMSETREFTASKATTACH:"prjmsetdisptaskattach",CMD_PRJMSETREFREPORTATTACH:"prjmsetdispreportattach",CMD_PRJMSETVIEWATTACH:"prjmsetviewattach",CMD_PRJMSETVIEWTASKATTACH:"prjmsetviewtaskattach",CMD_PRJMSETVIEWREPORTATTACH:"prjmsetviewreportattach",PAGE_PRJSETADMIN:"prjsetadmin",PAGE_PRJSETGEN:"prjsetgen",PAGE_PRJSETMANAGER:"prjsetmanager",init:function(){var b=a("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(b);if(b==desknets.prjset.PAGE_PRJPSETGEN){desknets.prjset.prjpsetgen.init();desknets.prj.subwin.init()}else{if(b==desknets.prjset.PAGE_PRJMSETLIST){desknets.hashobserver.init(desknets.prjset);desknets.prjset.prjmsetlist.init();desknets.prjset.TaskUser.init();desknets.prjset.subwin.init()}else{if(b==desknets.prjset.PAGE_PRJSETGEN){desknets.prjset.prjsetgen.init()}else{if(b==desknets.prjset.PAGE_PRJSETMANAGER){desknets.prjset.prjsetmanager.init()}}}}},changeLocationToInitTop:function(b,e,d,g){var f=[];var h=desknets.getUrl(desknets.prjset.MODULE_PRJ);f.cmd=desknets.prj.PAGE_PRJINDEX;var c=desknets.getNeoParam(f);h=h+"?"+c;desknets.execLocation(h)},};desknets.page(desknets.prjset,"subwin",desknets.prj.subwin,{_getSearchCmd:function(){return desknets.prjset.PAGE_PRJMSETSEARCH}});desknets.page(desknets.prjset,"ganttDialogUserSel",desknets.PageSetList,{$mDialog:null,init:function(c){var b=this;b.$mDialog=c;b.callBase("init")},_setTitle:function(c,b){},_initSetAjaxFrom:function(){},_initPageView:function(){},_listNodata:function(){var b=this;b.callBase("_listNodata");b._$listArea.find(".co-table-list-scroll").hide()},_listView:function(){var b=this;b.callBase("_listView");b._$listArea.find(".co-table-list-scroll").show()},_initListButton:function(){var b=this;b.callBase("_initListButton");b._initUserSelButton()},_initUserSelButton:function(){var b=this;b.$mDialog.find("#jprj-dialog-seluser-btn").click(function(){b._openSelUserDialog()})},_openSelUserDialog:function(){var b=this;arItems=b._getSelectedItems();var c={chooseTarget:["user"],choose:function(d){b._onSelectItems(d)},items:arItems,unassignGroup:"choosable",cmdusers:desknets.CMD_CHOOSERMSETUSERSEL,};desknets.chooser.open("jprj-dialog-seluser",c)},_getSelectedItems:function(){var b=this;var c=[];c=desknets.chooser.getItemsFromElement(b._$listTable.find(".co-tbody-list"),{itemFilter:function(f,d){var e=d.closest("tr").find(".co-busyo").find("span").first().html();cGroupTitle=desknets.stripTags(e);cGroupTitle=desknets.escapeValue(cGroupTitle);f.summary=e;f.summaryAsText=cGroupTitle;return f}});return c},_onSelectItems:function(d){var b=this;var f;var g=[];var e=d.length;for(f=0;f<e;f++){var i=desknets.tmpl.escapeWord(d[f].name);var c=desknets.escapeValue(a("<div>"+d[f].description+"</div>").text());g[g.length]="<tr>";var h=desknets.stripTags(d[f].summary);h=desknets.escapeValue(h);g[g.length]='<td class="co-chk"><input class="jco-sel-item" data-id="'+d[f].id+'" data-name="'+i+'" data-description="'+desknets.escapeValue(d[f].description)+'" type="checkbox" name="userid" value="'+d[f].id+'"></td>';g[g.length]='<td class="co-td-dialog-user"><span title="'+i+'">'+i+"</span></td>";g[g.length]='<td class="co-busyo"><span title="'+h+'">'+d[f].summary+"</span></td>";g[g.length]="</tr>"}b._$listTable.find(".co-tbody-list").html(g.join(""));b._listSet()},_getIdListArea:function(){return"jprj-task-user"},setDefUser:function(e,d){var b=this;var c={};if(neo.isSet(d)){c.cmd=desknets.prjset.CMD_PRJMSETTASKUSERS;c.pid=e;c.tid=d}else{c.cmd=desknets.prjset.CMD_PRJMSETPROJECTUSERS;c.pid=e;c.suspended="3"}desknets.ajax.rest({url:desknets.getUrl(desknets.prj.MODULE_API_PRJ),data:c,success:function(g,f,h){b._onDefSelectItems(g)},error:function(h,f,g){if(h.status==desknets.ERRORNO_GRPERR_ITEMNOTHING){desknets.ajax.onError(h.status,desknets.Resource.Message.prj_taskuser_itemnothing)}else{desknets.ajax.onError(h.status,g)}}})},_onDefSelectItems:function(c){var j=this;var e=desknets.ajax.getJsonItems(c);var g;var f=[];var b=e.length;for(g=0;g<b;g++){var h="";a.each(e[g],function(m,l){if(m!="assigngrp"){h+=" data-"+m+'="'+desknets.tmpl.escapeWord(l)+'"'}});var d=desknets.tmpl.escapeWord(e[g].Name);var i=desknets.user.getListAssignGroups(e[g].assigngrp.Name);var k=desknets.escape(i.assign);k=desknets.escapeValue(k);h+=' data-assign="'+k+'"';f[f.length]="<tr>";f[f.length]='<td class="co-chk"><input type="checkbox" class="jco-sel-item" '+h+' name="userid" value="'+e[g].id+'"></td>';f[f.length]='<td class="co-td-dialog-user"><span title="'+d+'">'+d+"</span></td>";f[f.length]='<td class="co-busyo"><span title="'+i.assigntitle+'">'+i.assign+"</span></td>";f[f.length]="</tr>"}j._$listTable.find(".co-tbody-list").html(f.join(""));j._listSet()},_delNoChkMessage:function(){return desknets.Resource.Message.com_sel_nochecked},});desknets.page(desknets.prjset,"TaskUser",desknets.prj.TaskUser,{_getTaskCmd:function(){return desknets.prjset.CMD_PRJMSETTASKUSERS},_getPrjCmd:function(){return desknets.prjset.CMD_PRJMSETPROJECTUSERS},});desknets.page(desknets.prjset,"ReportDialog",desknets.prj.ReportDialog,{_getGetReportCmd:function(){return desknets.prjset.CMD_PRJMSETREPORTLIST},_getSaveReportCmd:function(){return desknets.prjset.CMD_PRJMSETREPORTENTRY},_getReportattach:function(){return desknets.prjset.reportattach},});desknets.page(desknets.prjset,"TaskInfoDialog",desknets.prj.TaskInfoDialog,{_getGetTaskInfoCmd:function(){return desknets.prjset.CMD_PRJMSETTASKINFO},_getDownLoadCmd:function(){return desknets.prjset.CMD_PRJMSETVIEWTASKATTACH},});desknets.prjset.input={};desknets.page(desknets.prjset.input,"user",null,{$entry:null,page:null,_$entryUser:null,_isLoaded:false,_chooser:null,init:function(b){this.page=b;this.$entry=b.$mjPage;this._$entryUser=this.$entry.find(this._getEntryAreaName());this._setUpEntry()},open:function(){this._$entryUser.find(".jco-sel-btn").click()},_setUpEntry:function(){var b=this;var d=b._$entryUser.children("td");var c=a("#"+b._getDialogName());b.updateElement();b._chooser=desknets.chooser.setUpEntry(d,b._getTargets(),{dialogID:b._getDialogName(),dialogOptions:b._getChooserOptions(),extraVars:{user:{keyName:b._getEntryKeyName()}},change:function(){b.updateElement()}});this._isLoaded=true},_getTargets:function(){var c=this;var b=[];b=desknets.chooser.getItemsFromElement(c._$entryUser.find(".co-selmulti-items-scroll"));return b},updateElement:function(){var b=this._$entryUser.find(this._getEntryItemsName());if(this._isLoaded||b.length>0){this._$entryUser.show()}if(b.length<=0){this._$entryUser.hide()}},_getChooserOptions:function(){return{allGroup:"choosable",chooseTarget:["user"],unassignGroup:"choosable",cmdusers:desknets.CMD_CHOOSERMSETUSERSEL,}},_getDialogName:function(){return"jprj-entry-other-to-dialog"},_getEntryAreaName:function(){return".jprj-row-other-to"},_getEntryItemsName:function(){return".jprj-otherto-choose-items > .co-selitem"},_getEntryKeyName:function(){return"otherto"},_getEntryDescriptionName:function(){return".jprj-otherto-groups"},});desknets.page(desknets.prjset.input,"admin",desknets.prjset.input.user,{_getDialogName:function(){return"jprj-entry-admin-dialog"},_getEntryAreaName:function(){return".jprj-row-admin"},_getEntryItemsName:function(){return".jprj-admin-choose-items > .co-selitem"},_getEntryKeyName:function(){return"admin"},_getEntryDescriptionName:function(){return".jprj-admin-groups"},});desknets.page(desknets.prjset.input,"admgrp",desknets.prjset.input.user,{_setUpEntry:function(){var b=this;var d=b._$entryUser.children("td");var c=a("#"+b._getDialogName());b.updateElement();b._chooser=desknets.chooser.setUpEntry(d,b._getTargets(),{dialogID:b._getDialogName(),dialogOptions:b._getChooserOptions(),extraVars:{group:{keyName:b._getEntryKeyName()}},change:function(){b.updateElement()}});this._isLoaded=true},_getDialogName:function(){return"jprj-entry-admgrp-dialog"},_getChooserOptions:function(){var b=this;return{mode:"single",chooseTarget:["group"],defaultGroupId:b.$entry.find('input[name="admgrp"]').val(),}},_getEntryAreaName:function(){return".jprj-row-admgrp"},_getEntryItemsName:function(){return".jprj-admgrp-choose-items > .co-selitem"},_getEntryKeyName:function(){return"admgrp"},});desknets.page(desknets.prjset,"attach",desknets.prj.attach,{_getDownLoadCmd:function(){return desknets.prjset.CMD_PRJMSETREFATTACH},});desknets.page(desknets.prjset,"taskattach",desknets.prj.taskattach,{_getDownLoadCmd:function(){return desknets.prjset.CMD_PRJMSETREFTASKATTACH},});desknets.page(desknets.prjset,"reportattach",desknets.prj.reportattach,{_getDownLoadCmd:function(){return desknets.prjset.CMD_PRJMSETREFREPORTATTACH},});desknets.page(desknets.prjset,"PagePrjEntry",desknets.PageInputBase,{_initSet:function(){var b=this;b.callBase("_initSet");b._setUpDialog();b._setUpAttach()},_setUpDialog:function(){var b=this;desknets.prjset.input.admin.init(b);desknets.prjset.input.user.init(b);desknets.prjset.input.admgrp.init(b);b.$mjPage.find(".co-ebtnarea").delegate(".jprj-pop-button","click",function(c){c.preventDefault();if(a(this).hasClass("jprj-admin")){desknets.prjset.input.admin.open()}else{if(a(this).hasClass("jprj-user")){desknets.prjset.input.user.open()}else{if(a(this).hasClass("jprj-admgrp")){desknets.prjset.input.admgrp.open()}}}})},_setUpAttach:function(){var b=this;desknets.prjset.attach.init(b.$mjPage,true);b.$mjPage.find(".jprj-attach-button").click(function(c){c.preventDefault();desknets.prjset.attach.open()})},_getRestModule:function(){return desknets.prjset.MODULE_API_PRJ},_getDelExecCmd:function(){return desknets.prjset.CMD_PRJMSETPRJDEL},_getAddExecCmd:function(){return desknets.prjset.CMD_PRJMSETPRJENTRY},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()},});desknets.page(desknets.prjset,"PagePrjListBase",desknets.prj.PagePrjListBase,{msTmplSetLink:'<a title="{{setting}}" class="co-listview-item-setlink" href="#"></a><div class="co-listview-item-setmenu"><div class="jprj-folder-set-mod" title="{{update}}">{{update}}</div><div class="jprj-folder-set-del" title="{{delete}}">{{delete}}</div></div>',_initListStart:function(){var b=this;if(desknets.browser.tablet){b.msTmplSetLink=""}b.callBase("_initListStart")},_initListEnd:function(){var b=this;b._initFolderEnd();b.callBase("_initListEnd")},_initFolderEnd:function(){var b=this;b.$mjListPage.find(".jprj-folder-add").click(function(c){c.preventDefault();b._clickFolderAdd()});b.$mjListPage.find(".jprj-folder-mod").click(function(c){c.preventDefault();var d=b._getTargetFolderId();b._clickFolderMod(d)});b.$mjListPage.find(".jprj-folder-del").click(function(d){d.preventDefault();var e=b._getTargetFolderId();var c=b._getSelectFolderNameTitle();b._clickFolderDel(e,c)})},_initAddDataStart:function(){var b=this;b.callBase("_initAddDataStart");b._setFolderPulldownIconClock()},_setFolderPulldownIcon:function(){var b=this;if(desknets.browser.tablet){return}var c=b.$mjListPageLeft.find(".co-listview-folders");c.find(".jprj-folder").hover(function(){},function(){a(this).find(".co-listview-item-setmenu").hide()})},_setFolderPulldownIconClock:function(){var b=this;if(desknets.browser.tablet){return}var c=b.$mjListPageLeft.find(".co-listview-folders");c.delegate(".co-listview-item-setlink","click",function(i){var d=a(this);var g=b.$mjListPageLeft.find(".co-listview-left-data");var f=g.offset();var j=d.offset();var k=a("<div />").css({height:"100%"});var h=d.parent();i.preventDefault();var e=h.find(".co-listview-item-setmenu");k.appendTo(g);if(desknets.browser.chrome){k.height(k.height()-b.VAL_TREE_ADDSCROLL)}if((j.top+e.height()+h.height()-f.top)>k.height()-1){e.css("top",(e.outerHeight()*-1)-d.height()+5)}else{e.css("top",0)}k.remove();e.toggle()});c.delegate(".jprj-folder-set-mod","click",function(d){d.preventDefault();var e=a(this).parents().find(".jprj-folder").data("fid");b._clickFolderMod(e)});c.delegate(".jprj-folder-set-del","click",function(e){e.preventDefault();var f=a(this).parents().find(".jprj-folder").data("fid");var d=b._getSelectFolderName(f);b._clickFolderDel(f,d)})},_clickFolderAdd:function(){var b=this;var c={};c.cmd=b._getFolderEntryPageCmd();b._inputPage(c)},_clickFolderMod:function(c){var b=this;var d={};d.cmd=b._getFolderEntryPageCmd();d.id=c;b._inputPage(d)},_clickFolderDel:function(d,g){var c=this;var b="";var e=null;var f=null;b=desknets.tmpl.replaceWord(desknets.Resource.prj.confirmation_delfolder,"FolderName",g);e=function(){if(f!=null){desknets.submitform.setDialogDisabled(f)}var l=c.$mjListPage.find(".jco-back-page-data");var i=l.find('input[name="pid"]').val();if(d==i){l.find('input[name="pid"]').val("");var m=desknets.getInputDataToUrl(c.$mjListPage.find(".jco-back-page-data"));m=m+"&cmd="+c._getListCmd();c._setLocationHash(m,true)}if(!c._boDelSingle()){var k={};var j={};k=c._folderDelMultiParams(d);c._mchkIDs=c._getListAjaxGetId();j=c._getFolderAjaxOptionsExec(f);c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,k,j);return false}else{var h={};var k={};var j={};h=c._folderDelMultiParams(d);k=h["0"];c._mchkIDs=c._getListAjaxGetId();j=c._getFolderAjaxOptions(f);c._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,k,j);return false}};f=desknets.dialog.confirm(b,e)},_folderDelMultiParams:function(f){var c=this;var h={};var e={};var d={};var b={};b.cmd=c._getFolderDelCmd();b.id=f;e=c.getListParamToObj();d.cmd=c._getFolderGetCmd();var g=c.$mjListPage.find(".jco-back-page-data");d.row=g.find('input[name="prjrow"]').val();d.num=g.find('input[name="num"]').val();h["0"]=b;h["1"]=e;h["2"]=d;return h},_getFolderAjaxOptionsExec:function(d){var b=this;var c={};c={success:function(g,e,h){b.setNotChangeHash(false);var f=desknets.getInputDataToUrl(b.$mjListPage.find(".jco-back-page-data"));f=f+"&cmd="+b._getListCmd();b._setLocationHash(f,true);b._getListAjaxSuccessExec(g)},complete:function(g,e,f){if(d!=null){desknets.submitform.clearDialogDisabled(d);d.dialog("close")}}};return c},_getFolderAjaxOptions:function(d){var b=this;var c={};c={success:function(f,e,g){b.setNotChangeHash(false);b._listPage(b._getListRow())},complete:function(g,e,f){if(d!=null){desknets.submitform.clearDialogDisabled(d);d.dialog("close")}}};return c},_hashUpdatePageView:function(c){var b=this;var d=desknets.paramanalyzer.getHashParams();if(c==b._getFolderEntryPageCmd()){desknets.prjset.PagePrjEntry.initPage(b.mhashBackCmd,b.mhashIdBack)}else{b.callBase("_hashUpdatePageView",c)}},_getAddDataAjaxSuccess:function(c){var b=this;b.callBase("_getAddDataAjaxSuccess",c);b._setFolderPulldownIcon()},_getCompleteClassName:function(c){var b=this;var d="";if(c=="0"){d="ahead"}else{if(c=="1"){d="finished"}else{if(c=="2"){d="abort"}}}return d},_getCompleteTitle:function(c){var b=this;var d="";if(c=="0"){d=desknets.Resource.prj["prj-ahead"]}else{if(c=="1"){d=desknets.Resource.prj["prj-finished"]}else{if(c=="2"){d=desknets.Resource.prj["prj-stop"]}}}return d},onSetSelectFolder:function(c){var b=this;b.callBase("onSetSelectFolder",c);if(c){b._setPrjEditButton(false)}else{b._setPrjEditButton(true)}},_setPrjEditButton:function(c){var b=this;var d=b.$mjListPageLeft.find(".co-listview-left-subtitle");d.find(".jprj-folder-mod").attr("disabled",c);d.find(".jprj-folder-del").attr("disabled",c)},_getGantchartPageCmd:function(){return desknets.prjset.PAGE_PRJMSETGANTTLIST},_getTasklistPageCmd:function(){return desknets.prjset.PAGE_PRJMSETLIST},_getFolderGetCmd:function(){return desknets.prjset.CMD_PRJMSETLIST},_getFolderEntryPageCmd:function(){return desknets.prjset.PAGE_PRJMSETPRJENTRY},_getFolderDelCmd:function(){return desknets.prjset.CMD_PRJMSETPRJDEL},});desknets.page(desknets.prjset,"PageReportListBase",desknets.prj.PageReportListBase,{_getListReportExecCmd:function(){return desknets.prjset.CMD_PRJMSETREPORTLIST},_getListCommentExecCmd:function(){return desknets.prjset.CMD_PRJMSETCOMMENTLIST},_getRefAttachCmd:function(){return desknets.prjset.CMD_PRJMSETVIEWREPORTATTACH},_getArticleEntryCmd:function(){return desknets.prjset.CMD_PRJMSETREPORTENTRY},_getArticleDelCmd:function(){return desknets.prjset.CMD_PRJMSETREPORTDEL},_getCommentEntryCmd:function(){return desknets.prjset.CMD_PRJMSETCOMMENTENTRY},_getCommentDelCmd:function(){return desknets.prjset.CMD_PRJMSETCOMMENTDEL},_getTaskInfoDialog:function(){return desknets.prjset.TaskInfoDialog},_getReportDialog:function(){return desknets.prjset.ReportDialog},_getReportattach:function(){return desknets.prjset.reportattach},});desknets.page(desknets.prjset,"prjpsetgen",desknets.PageSet,{_getNextCmd:function(){return desknets.prj.PAGE_PRJINDEX}});desknets.page(desknets.prjset,"PageTopListBase",desknets.prj.PageTopListBase,{init:function(){var b=this;b.mBackCmd="";b.mIdBack="jco-m-list-container";b.callBase("init")},_getAddDataAjaxSuccessOtherSet:function(b){},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()})},dispBackListPage:function(){var b=this;if(neo.isSet(b.mBackCmd)&&b.mBackCmd.length>0){b.callBase("dispBackListPage")}else{desknets.prjset.changeLocationToInitTop()}},_openDialogTask:function(d,c){var b=this;desknets.prjset.TaskUser.openDialogTask(d,c)},_openDialogPrj:function(d,b){var c=this;desknets.prjset.TaskUser.openDialogPrj(d,b)},_hashUpdateListPage:function(d){var c=this;var e=d.cmd;var b=desknets.paramanalyzer.getHashParams();if(e==desknets.prjset.PAGE_PRJMSETLIST){c._getListAjax(b.row)}c.callBase("_hashUpdateListPage",d)},_hashUpdatePageView:function(h){var e=this;var c=desknets.paramanalyzer.getHashParams();if(h==desknets.prjset.PAGE_PRJMSETGANTTLIST){var d="#"+desknets.prjset.prjmsetganttlist._getIdListPage();if(a(d).find(".jco-title").length>0&&!neo.isSet(c.init)){desknets.prjset.prjmsetganttlist._getListAjax(c.row)}else{desknets.prjset.prjmsetganttlist.initPage(e.mhashBackCmd,e.mhashIdBack)}}else{if(h==desknets.prjset.PAGE_PRJMSETMOVETASK){var d="#"+desknets.prjset.prjmsetganttlist._getIdListPage();if(a(d).find(".jco-title").length>0){desknets.prjset.prjmsetmovetaskindex.initPage(desknets.prjset.PAGE_PRJMSETGANTTLIST,"jprj-m-ganttchart-container")}else{desknets.prjset.prjmsetmovetaskindex.initPage(e.mhashBackCmd,e.mhashIdBack)}}else{if(h==desknets.prjset.PAGE_PRJMSETSEARCH){desknets.prjset.prjsearchindex.initPage(desknets.prjset.PAGE_PRJMSETLIST,"jco-m-list-container");e.mhashBackErrCmd=e.mhashBackCmd;e.mhashIdErrBack=e.mhashIdBack;e.mhashBackCmd=desknets.prjset.PAGE_PRJMSETSEARCH;e.mhashIdBack="jco-m-search-container"}else{if(h==desknets.prjset.PAGE_PRJMSETREPORTLIST){var g="#"+desknets.prjset.prjmsetreportlist._getIdListPage();if(a(g).find(".jco-title").length>0&&!neo.isSet(c.init)){desknets.prjset.prjmsetreportlist._getListAjax(c.row)}else{var d="#"+desknets.prjset.prjmsetganttlist._getIdListPage();if(neo.isSet(c.init)&&c.init==desknets.prj.DEF_INIT_GANT&&a(d).find(".jco-title").length>0){var f=desknets.prjset.PAGE_PRJMSETGANTTLIST;var b="jprj-m-ganttchart-container";desknets.prjset.prjmsetreportlist.initPage(f,b)}else{desknets.prjset.prjmsetreportlist.initPage(e.mhashBackCmd,e.mhashIdBack)}}}else{e.callBase("_hashUpdatePageView",h)}}}}},_getListCmd:function(){return desknets.prjset.PAGE_PRJMSETLIST},_getListExecCmd:function(){return desknets.prjset.CMD_PRJMSETTASKLIST},_getReportListPageCmd:function(){return desknets.prjset.PAGE_PRJMSETREPORTLIST},_getPrjDownLoadCmd:function(){return desknets.prjset.CMD_PRJMSETVIEWATTACH},});desknets.page(desknets.prjset,"baseprjlist",desknets.prjset.PagePrjListBase,desknets.prjset.PageReportListBase);desknets.page(desknets.prjset,"baseprjtoplist",desknets.prjset.baseprjlist,desknets.prjset.PageTopListBase);desknets.page(desknets.prjset,"prjmsetlist",desknets.prjset.baseprjtoplist,{init:function(){var b=this;b._mbPageBreakMode=false;b.callBase("init")},});desknets.page(desknets.prjset,"PageReportList",desknets.prj.PageReportList,{_getListCmd:function(){return desknets.prjset.PAGE_PRJMSETREPORTLIST},_getListExecCmd:function(){return desknets.prjset.CMD_PRJMSETREPORTLIST},});desknets.page(desknets.prjset,"baseprjreportlist1",desknets.PageListBase,desknets.prjset.PageReportListBase);desknets.page(desknets.prjset,"baseprjreportlist2",desknets.prjset.baseprjreportlist1,desknets.prjset.PageReportList);desknets.page(desknets.prjset,"prjmsetreportlist",desknets.prjset.baseprjreportlist2,{});desknets.page(desknets.prjset,"prjsearchindex",desknets.prj.prjsearchindex,{_initListEndAssignLink:function(){var b=this;b.$mjListPage.find(".co-tbody-list").delegate(".jprj-task-user-view","click",function(e){e.preventDefault();var d=a(this).parent().parent();var c=d.find(".jprj-prjid").val();desknets.prjset.TaskUser.openDialogTask(c,d.data("id"))})},_getListCmd:function(){return desknets.prjset.PAGE_PRJMSETSEARCH},_getListExecCmd:function(){return desknets.prjset.CMD_PRJMSETTASKSEARCHINDEX},_getStopBatSearchCmd:function(){return desknets.prjset.CMD_PRJMSETTASKSEARCHSTOP},_getListDispCmd:function(){return desknets.prjset.PAGE_PRJMSETREPORTLIST},_getListGunttCmd:function(){return desknets.prjset.PAGE_PRJMSETGANTTLIST},_getReportListPageCmd:function(){return desknets.prjset.PAGE_PRJMSETREPORTLIST},});desknets.page(desknets.prjset,"prjmsetganttlist",desknets.prj.prjganttlist,{_TMPLDIALOG:"prj/taskdialog.html",$mDialog:null,msTmplSetLink:'<span class="co-listview-item-setlink" title="{{setting}}">{{setting}}</span>',_mcTemplateInputAttach:null,_initListStart:function(){var b=this;if(desknets.browser.tablet){b.msTmplSetLink=""}b.callBase("_initListStart");b._createDialogHtml();b.$mjListPage.find(".co-listview-left-data").delegate(".prj-listview-folder","click",function(d){var e=a(this);var c=a(d.target);if(!(d.target.nodeName=="A"||d.target.nodeName=="a")){d.preventDefault();b._setSelectTask(e,true)}})},_setSelectTask:function(d,c){var b=this;b.$mjListPage.find('input[name="tid"]').val(d.data("id"));if(neo.isSet(c)&&c){b._setLocationHashGantt()}b.$mjListPage.find(".prj-listview-folder").removeClass("on");d.addClass("on");if(d.hasClass("prj-class-class")){b.$mjListPage.find(".jprj-dialog-mid").attr("disabled",false)}else{b.$mjListPage.find(".jprj-dialog-mid").attr("disabled",true)}},_initListEnd:function(){var b=this;b.callBase("_initListEnd");var c=b.$mjListPage.find(".co-listview-item-setmenu");b.$mjListPage.find(".jprj-dialog-top").click(function(d){d.preventDefault();b._setDialog("1",true)});b.$mjListPage.find(".jprj-dialog-mid").click(function(d){d.preventDefault();b._setDialog("2",true)});b.$mjListPage.find(".jprj-dialog-tak").click(function(d){d.preventDefault();b._setDialog("3",true)});b.$mjListPage.find(".jprj-move").click(function(f){f.preventDefault();if(b.isSelectedProject()){var d=desknets.paramanalyzer.getHashParams();var e={};e.pid=d.pid;e.cmd=desknets.prjset.PAGE_PRJMSETMOVETASK;b._setLocationHash(e)}});b.$mjListPage.find(".jprj-dialog-mod").click(function(e){e.preventDefault();var d=b.$mjListPage.find(".prj-listview-folder.on");var f;if(d.hasClass("prj-class-class")){f="1"}else{if(d.hasClass("prj-class-subclass")){f="2"}else{if(d.hasClass("prj-class-task")){f="3"}}}b._setDialog(f,false)});b.$mjListPage.find(".jprj-dialog-del").click(function(d){d.preventDefault();b._delTask()});b.$mjListPage.find(".co-listview-left-data").delegate(".co-listview-item-setlink","click",function(f){f.preventDefault();var d=a(this);var e=d.closest(".prj-listview-folder");if(e.hasClass("prj-class-class")){c.find(".jprj-dialog-mid").show();c.find(".jprj-dialog-tak").show();c.find("hr").show()}else{if(e.hasClass("prj-class-subclass")){c.find(".jprj-dialog-mid").hide();c.find(".jprj-dialog-tak").show();c.find("hr").show()}else{c.find(".jprj-dialog-mid").hide();c.find(".jprj-dialog-tak").hide();c.find("hr").hide()}}var i=d.offset();var h=i.left-130;var g=i.top-37;c.css("left",h+"px");c.css("top",g+"px");c.show()});b.$mjListPage.find(".co-listview-left-data").delegate(".prj-listview-folder","hover",function(e){if(e.type=="mouseenter"){var d=a(this).find(".co-listview-item-setlink");var f=185+b.$mjListPage.find(".co-listview-left-data").scrollLeft();d.css("left",f+"px")}else{if(e.type=="mouseleave"){c.hide()}}});c.mouseenter(function(){c.show()});c.mouseleave(function(){c.hide()})},_initListEndDialog:function(){var b=this;b.$mjListPage.find(".co-listview-left-data").delegate(".jprj-task-user-view","click",function(f){f.preventDefault();var e=a(this).parent();var d=desknets.paramanalyzer.getHashParams();desknets.prjset.TaskUser.openDialogTask(d.pid,e.data("id"))});var c=function(e,d){b.$mjListPage.find(".jco-back-page-data").find('input[name="uid"]').val(e);b.$mjListPage.find(".jprj-sel-user-name").html(d);b._listPage("0")};b.$mjListPage.find(".jprj-charge-sel").click(function(e){e.preventDefault();if(b.isSelectedProject()){var d=desknets.paramanalyzer.getHashParams();desknets.prjset.TaskUser.openDialogPrj(d.pid,c)}})},_getListAjaxSuccess:function(c){var b=this;b.callBase("_getListAjaxSuccess",c);if(b.msMonth==""||b.msMonth!==b.msPrmMonth){b._setTaskMove()}},_setTaskMove:function(){var p=this;var d=null;var c=null;var l="";var h="";var f="";var i="";var m="";var n=desknets.paramanalyzer.getHashParams();var k=function(){if(c!=null){desknets.submitform.setDialogDisabled(c)}var u=p.$mjListPage.find('.prj-listview-folder[data-id="'+d.data("id")+'"]');var t=u.data("startdate");var s=u.data("enddate");var q="";if(m=="update"){if(l==h){var w=neo.dateTime.moveDate(neo.dateTime.parse(s),(i-f)/50);s=neo.dateTime.format("yyyyMMdd",w);q=neo.dateTime.format("MM/dd",w)}else{var w=neo.dateTime.moveDate(neo.dateTime.parse(t),(h-l)/50);t=neo.dateTime.format("yyyyMMdd",w)}}else{if(m=="move"){var w=neo.dateTime.moveDate(neo.dateTime.parse(t),(h-l)/50);t=neo.dateTime.format("yyyyMMdd",w);var w=neo.dateTime.moveDate(neo.dateTime.parse(s),(h-l)/50);s=neo.dateTime.format("yyyyMMdd",w);q=neo.dateTime.format("MM/dd",w)}}var r={};var v={};r.cmd=desknets.prjset.CMD_PRJMSETTASKENTRYMV;r.pid=n.pid;r.id=d.data("id");r.startdate=t;r.enddate=s;desknets.ajax.rest({url:desknets.getUrl(p._getRestModule()),data:r,success:function(z,x,A){if(c!=null){desknets.submitform.clearDialogDisabled(c);c.dialog("close")}u.data("startdate",t);u.data("enddate",s);var y=d.closest(".prj-chart-folder");if(q!=""){y.find(".prj-chart-end").html(q)}p._getListAjax(p._getListRow())},error:function(z,x,y){desknets.submitform.clearDialogDisabled(c);desknets.ajax.onError(z.status,y)}});return false};var j=function(){var q={};q.left=l+"px";q.width=f+"px";d.css(q)};var b={cancel:j};var e=a("#prj-chart-size").width();var g=false;var o=false;p.$mjListPage.find(".prj-chart-bar").resizable({handles:"w, e",grid:[50,0],minWidth:50,start:function(r,q){d=a(this);l=parseInt(d.css("left"),10);f=parseInt(d.width(),10);g=false;o=false;if(l>=0){g=true}if(e>l+f){o=true}},resize:function(s,r){h=parseInt(d.css("left"),10);i=parseInt(d.width(),10);if(g&&h<0){i=i+h;h=0;var q={};q.left="0px";q.width=i+"px";d.css(q)}if(o&&e<h+i){i=e-h-2;d.css("width",i+"px")}},stop:function(s,r){h=parseInt(d.css("left"),10);i=parseInt(d.width(),10);if(g&&h<0){i=i+h;h=0;var q={};q.left="0px";q.width=i+"px";d.css(q)}if(o&&e<h+i){i=e-h-2;d.css("width",i+"px")}if(l!=h||f!=i){m="update";c=desknets.dialog.confirm(desknets.Resource.Message.prj_task_datemove,k,b)}}});p.$mjListPage.find(".prj-chart-bar").draggable({axis:"x",grid:[50,0],containment:p.$mjListPage.find("#prj-chart-size"),start:function(r,q){d=a(this);l=parseInt(d.css("left"),10);f=parseInt(d.width(),10)},drag:function(r,q){h=parseInt(d.css("left"),10)},stop:function(r,q){h=parseInt(d.css("left"),10);if(l!=h){m="move";c=desknets.dialog.confirm(desknets.Resource.Message.prj_task_datemove,k,b)}}})},_getListAjaxSuccessEnd:function(){var c=this;c.callBase("_getListAjaxSuccessEnd");if(c.$mjListPage.find(".prj-listview-folder.on").length===0){var d=null;var b=desknets.paramanalyzer.getHashParams();if(neo.isSet(b.tid)){d=c.$mjListPage.find('.prj-listview-folder[data-id="'+b.tid+'"]')}if(d===null||d.length===0){d=c.$mjListPage.find(".prj-listview-folder:first")}if(d===null||d.length===0){c.$mjListPage.find(".jprj-dialog-mid").attr("disabled",true)}else{c._setSelectTask(d)}}},_delTask:function(){var c=this;var b="";var g="";var e=null;var f=null;var d=c.$mjListPage.find(".prj-listview-folder.on");g=d.find(".folder").text();b=desknets.tmpl.replaceWordChk(desknets.Resource.Message.prj_task_del,"TaskName",g);e=function(){if(f!==null){desknets.submitform.setDialogDisabled(f)}var h=desknets.paramanalyzer.getHashParams();var i={};i.pid=h.pid;i.id=d.data("id");i.cmd=desknets.prjset.CMD_PRJMSETTASKDEL;desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:i,success:function(k,j,l){desknets.submitform.clearDialogDisabled(f);f.dialog("close");c._getListAjax(c._getListRow())},error:function(l,j,k){desknets.submitform.clearDialogDisabled(f);desknets.ajax.onError(l.status,k)}})};f=desknets.dialog.confirm(b,e)},_createDialogHtml:function(){var b=this;if(neo.isSet(b.$mDialog)){return}var c=function(){b._createDialog();desknets.prjset.ganttDialogUserSel.init(b.$mDialog)};desknets.tmpl.load(b.$mjListPage.find(".jprj-dialog-task"),b._TMPLDIALOG,c)},_createDialog:function(){var b=this;var d=desknets.dialog.getDialogOption();desknets.htmlparts.setUpForm(b.$mjListPage.find(".jprj-dialog-task"));d.width=580;d.autoOpen=false;d.buttons={};d.buttons[desknets.Resource.OKButtonLabel]=function(){if(b.$mDialog.find(".co-datepicker").hasClass("ui-invalid")){desknets.dialog.alert(desknets.Resource.Message.com_invalid_date,{type:"warn"});return false}desknets.submitform.setDialogDisabled(b.$mDialog);var e=desknets.paramanalyzer.getHashParams();var g={};g.cmd=desknets.prjset.CMD_PRJMSETTASKENTRY;g.id=b.$mDialog.find(".jprj-dialog-task-id").val();g.pid=e.pid;g.type=b.$mDialog.find(".jprj-dialog-task-type").val();if(g.type=="0"){g.ptaskid=b.$mDialog.find(".jprj-dialog-task-parent-id").val()}else{if(b.$mDialog.find('input[name="sel_create"]:checked').val()==1){g.ptaskid=b.$mDialog.find(".jprj-dialog-task-parent-id").val()}else{g.ptaskid=""}}g.Name=b.$mDialog.find(".jprj-dialog-task-name").val();g.memo=b.$mDialog.find('textarea[name="memo"]').val();g.startdate=b.$mDialog.find('input[name="startdate"]').val();g.enddate=b.$mDialog.find('input[name="enddate"]').val();var f=[];b.$mDialog.find(".co-tbody-list").children().each(function(){f[f.length]=a(this).find('input[name="userid"]').val()});if(f.length>0){g.uid=f}desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),data:g,success:function(i,h,j){desknets.submitform.clearDialogDisabled(b.$mDialog);b.$mDialog.dialog("close");b._getListAjax(b._getListRow())},error:function(j,h,i){desknets.submitform.clearDialogDisabled(b.$mDialog);if(j.status==desknets.ERRORNO_GRPERR_ITEMNOTHING){desknets.ajax.onError(j.status,desknets.Resource.Message.com_itemnothing_listreload)}else{desknets.ajax.onError(j.status,i)}},errorconvmsg:function(h,i){var j=desknets.getErrField(h,i);j.fieldname=b._getErrorPlace(j.fieldid);return desknets.getErrConvMsg(j)}})};d.buttons[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};b.$mDialog=b.$mjListPage.find(".jprj-dialog-task");b._mcTemplateInputAttach=b.$mDialog.find(".jprj-attach-list").html();var c=a('input[name="attach-totalSizeLimit"]').val();c=Number(c);if(!!c){b._mcTemplateInputAttach=desknets.tmpl.replaceWordHtml(b._mcTemplateInputAttach,"item_max_size",c)}b.$mDialog=desknets.dialog.setUp(b.$mDialog,d)},_getErrorPlace:function(b){var c=this;if(b!==""&&c.$mDialog!==null){return desknets.getErrFieName(c.$mDialog,b)}return""},_setDialog:function(b,e){var j=this;var g={};var d=j.$mjListPage.find(".prj-listview-folder.on");var i=desknets.paramanalyzer.getHashParams();if(!j.isSelectedProject()){return}j.$mDialog.find(".jprj-dialog-task-id").val("");j.$mDialog.find(".jprj-dialog-task-parent-id").val("");j.$mDialog.find(".jprj-dialog-task-type").val("0");j.$mDialog.find(".jprj-dialog-task-name").val("");j.$mDialog.find('input[name="startdate"]').val("");j.$mDialog.find('input[name="enddate"]').val("");j.$mDialog.find(".jprj-dialog-task-name-title").text("");j.$mDialog.find('textarea[name="memo"]').val("");j.$mDialog.find(".jprj-attach-list").empty();j.$mDialog.find(".jprj-attach-list").html(j._mcTemplateInputAttach);j.$mDialog.find(".co-datepicker").val("");j.$mDialog.find(".co-datepicker").removeClass("ui-invalid-mismatch ui-invalid");j.$mDialog.find(".co-tbody-list").html("");desknets.prjset.ganttDialogUserSel._listNodata();j.$mDialog.find(".co-chk-cnt").find(".co-chk-cnt-all").hide();j.$mDialog.find(".jprj-task-user").hide();j.$mDialog.find(".jprj-sel").hide();j.$mDialog.find(".jprj-area-memo").hide();j.$mDialog.find(".jprj-area-attach").hide();if(b=="1"){j.$mDialog.find(".jprj-dialog-task-name-title").text(desknets.Resource.prj.classname);if(e){g.title=desknets.Resource.prj.classadd}else{g.title=desknets.Resource.prj.classmod}}else{if(b=="2"){j.$mDialog.find(".jprj-dialog-task-name-title").text(desknets.Resource.prj.subclassname);if(e){j.$mDialog.find(".jprj-dialog-task-parent-id").val(d.data("id"));g.title=desknets.Resource.prj.subclassadd;var c="yyyy-MM-dd";var f=desknets.Resource.dateFormat;var k=neo.dateTime.parse(d.data("startdate"));j.$mDialog.find('input[name="startdate"]').val(neo.dateTime.format(c,k));j.$mDialog.find('input[name="startdate"]').prev().val(neo.dateTime.format(f,k));k=neo.dateTime.parse(d.data("enddate"));j.$mDialog.find('input[name="enddate"]').val(neo.dateTime.format(c,k));j.$mDialog.find('input[name="enddate"]').prev().val(neo.dateTime.format(f,k))}else{g.title=desknets.Resource.prj.subclassmod}}else{j.$mDialog.find(".jprj-dialog-task-type").val("1");j.$mDialog.find(".jprj-dialog-task-name-title").text(desknets.Resource.prj.taskname);j.$mDialog.find(".jprj-task-user").show();j.$mDialog.find(".jprj-area-memo").show();j.$mDialog.find(".jprj-area-attach").show();if(e){if(d.length>0){j.$mDialog.find(".jprj-dialog-task-parent-id").val(d.data("id"));if(!d.hasClass("prj-class-task")){var c="yyyy-MM-dd";var f=desknets.Resource.dateFormat;var k=neo.dateTime.parse(d.data("startdate"));j.$mDialog.find('input[name="startdate"]').val(neo.dateTime.format(c,k));j.$mDialog.find('input[name="startdate"]').prev().val(neo.dateTime.format(f,k));k=neo.dateTime.parse(d.data("enddate"));j.$mDialog.find('input[name="enddate"]').val(neo.dateTime.format(c,k));j.$mDialog.find('input[name="enddate"]').prev().val(neo.dateTime.format(f,k))}}j.$mDialog.find(".jprj-sel").show();j.$mDialog.find("#jprj-sel-sub").attr("disabled",false);if(d===null||d.length===0||d.hasClass("prj-class-task")){j.$mDialog.find("#jprj-sel-root").attr("checked",true);j.$mDialog.find("#jprj-sel-sub").attr("disabled",true)}else{j.$mDialog.find("#jprj-sel-sub").attr("checked",true)}desknets.prjset.ganttDialogUserSel.setDefUser(i.pid);g.title=desknets.Resource.prj.taskadd;desknets.prjset.taskattach.init(j.$mDialog,true)}else{g.title=desknets.Resource.prj.taskmod}}}if(e){j.$mDialog.dialog(g);j.$mDialog.dialog("open")}else{var h={};h.cmd=desknets.prj.CMD_PRJATTACHDELTEMP;desknets.ajax.rest({url:desknets.getUrl(j._getRestModule()),data:h,success:function(m,l,n){j._setTaskData(i.pid,d.data("id"),g)},})}},_setTaskData:function(f,e,d){var b=this;var c={};c.cmd=desknets.prjset.CMD_PRJMSETTASKINFO;c.pid=f;c.tid=e;desknets.ajax.rest({url:desknets.getUrl(desknets.prj.MODULE_API_PRJ),data:c,success:function(j,g,l){b.$mDialog.find(".jprj-dialog-task-id").val(j.id);b.$mDialog.find(".jprj-dialog-task-name").val(j.Name);b.$mDialog.find('textarea[name="memo"]').val(j.memo);var k="yyyy-MM-dd";var h=desknets.Resource.dateFormat;var i=neo.dateTime.parse(j.startdate);b.$mDialog.find('input[name="startdate"]').val(neo.dateTime.format(k,i));b.$mDialog.find('input[name="startdate"]').prev().val(neo.dateTime.format(h,i));i=neo.dateTime.parse(j.enddate);b.$mDialog.find('input[name="enddate"]').val(neo.dateTime.format(k,i));b.$mDialog.find('input[name="enddate"]').prev().val(neo.dateTime.format(h,i));desknets.prjset.ganttDialogUserSel._onDefSelectItems(j);desknets.prj.setListAttach(j,b.$mDialog.find(".jprj-attach-list"));desknets.prjset.taskattach.init(b.$mDialog,true,f,e);b.$mDialog.dialog(d);b.$mDialog.dialog("open")},error:function(i,g,h){if(i.status==desknets.ERRORNO_GRPERR_ITEMNOTHING){desknets.ajax.onError(i.status,desknets.Resource.Message.prj_taskuser_itemnothing)}else{desknets.ajax.onError(i.status,h)}}})},_getListCmd:function(){return desknets.prjset.PAGE_PRJMSETGANTTLIST},_getListExecCmd:function(){return desknets.prjset.CMD_PRJMSETTASKLISTGT},_getTaskCmd:function(){return desknets.prjset.PAGE_PRJMSETREPORTLIST}});desknets.page(desknets.prjset,"prjmsetmovetaskindex",desknets.PageMultiList,{msTmplProcess:'<div class="co-listview-folder prj-class-class {{classlevel}} {{opensts}}" data-id="{{id}}" data-hierarchy="{{HIERARCHY}}">{{open}}<a class="folder prjmg-move-fopen {{on}}" href="#" title="{{name}}">{{name}}</a></div>',msTmplProcessOpen:'<a class="toggle" href="#">+</a>',_sortStartListID:null,_sortStartListPos:null,_dragStartListID:null,_dragStartTreeID:null,_moveParams:{},_mPrjName:"",initPage:function(d,c){var b=this;b.boGetHtmlSingle=false;b.callBase("initPage",d,c)},_initGetHtml:function(){var c=this;var d={};c._searching=true;var b=c._getIdListPage();if(a("#"+b).find(".jco-title").length>0){c._getListAjax(0);return}c.callBase("_initGetHtml")},_getListAjax:function(d){var b=this;var e={};var c={};b._hashUpdatePageParams();e=b.getListParamToObj();e.row=d;c=b._getListAjaxOptions();b._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,e,c)},_getListAjaxSuccess:function(d){var b=this;b._mPrjName=d.prjname;b.callBase("_getListAjaxSuccess",d);b.$mjListPage.find(".co-table-list").show();var c=b._getListSortableOptions();var f=b.$mjListPage.find(".co-tbody-list");var e=f.find("tr");e.each(function(){var g=a(this).find("td:first");if(g.find('input[type="hidden"]').data("type")==0){g.closest("tr").find(".prj-list-taskname-move").addClass("prj-process-type0")}});f.sortable(c)},_replaceListLine:function(c,g,d){var b=this;var f;var e;if(g==="startdate"||g==="enddate"){e=desknets.dateTime.dispDateTime(d[g],{type:"list"});f=new RegExp("{{"+g+"}}","ig");c=c.replace(f,e)}else{return b.callBase("_replaceListLine",c,g,d)}return c},_getListAjaxSuccessAdd:function(c){var b=this;b._getListAjaxSuccessAddData()},_getAddDataAjaxSuccess:function(m){var r=this;var k=r._getListAjaxSuccessData(m);var g=0;var n=0;var p={};var o={};var d="";var c;var e;var b;var q;var f=[];var l;var h=desknets.paramanalyzer.getHashParams();l=false;b=0;q=neo.isSet(h.parent)?h.parent:0;g=k.length;for(n=0;n<g;n++){p=k[n];if(n<g-1){o=k[n+1]}else{o=null}c=Number(p.HIERARCHY.length)/3;if(isNaN(c)){c=1}if(o!=null){e=Number(o.HIERARCHY.length)/3}else{e=0}if(b!=0&&b!=c){if(b>c){f[f.length]="</li>";f[f.length]="</ul>"}if(b<c){l=true}}if(b!=0&&l!=true){f[f.length]="</li>"}if(l){f[f.length]='<ul class="co-listview-folder-inside">';l=false}d=r.msTmplProcess;d=desknets.tmpl.replaceWordChkHtml(d,"opensts","open");if(c==1){if(c<e){d=desknets.tmpl.replaceWordChkHtml(d,"open",r.msTmplProcessOpen)}else{d=desknets.tmpl.replaceWordChkHtml(d,"open","")}d=desknets.tmpl.replaceWordChkHtml(d,"classlevel","second")}else{d=desknets.tmpl.replaceWordChkHtml(d,"open","");d=desknets.tmpl.replaceWordChkHtml(d,"classlevel","third")}if(q==p.id){d=desknets.tmpl.replaceWordChkHtml(d,"on","on")}else{d=desknets.tmpl.replaceWordChkHtml(d,"on","off")}d=desknets.tmpl.replaceWord(d,"name",p.Name);d=desknets.tmpl.replaceWordChkHtml(d,"id",p.id);d=desknets.tmpl.replaceWordChkHtml(d,"HIERARCHY",p.HIERARCHY);f[f.length]='<li class="jprj-listview-folder-item">';f[f.length]=d;b=c}for(n=1;n<c;n++){f[f.length]="</li>";f[f.length]="</ul>"}f[f.length]="</li>";var j=r.$mjListPage.find("li.jprj-listview-folder-root");var i=r.$mjListPage.find("li.jprj-listview-folder-root").find("ul.co-listview-folder-inside");i.empty().html(f.join(""));if(q==0){j.find("div:first").find("a").addClass("on")}else{j.find("div:first").find("a").removeClass("on")}r._updateItemsWidth()},_updateItemsWidth:function(){var b=this;var c=b.$mjListPage.find(".co-listview-left");var g=c.find(".co-listview-items");var f=c.find("a.prjmg-move-fopen");var e=g.offset();var d=0;d=g.width();f.each(function(){var h=a(this);h.css("width","auto");var j=h.offset().left-e.left;var i=parseInt(h.parent().css("padding-left"))-parseInt(h.css("padding-left"));var k=h.width()+j+i;if(k>d){d=k}});a(".jprj-listview-folder-item").width(d);f.each(function(){var h=a(this);h.width(d-(h.offset().left-e.left))})},_initListEnd:function(){var b=this;desknets.listviewframe.updateListHeight(b.$mjListPage.find(".co-listview"),false);b.$mjListPage.find(".co-listview-items").delegate(".toggle","click",function(e){e.preventDefault();var c=a(this).parent();var d=c.next();c.toggleClass("open");d.animate({height:"toggle"},"slow")})},_initAddDataStart:function(){var b=this;b._initListProcess()},_initListProcess:function(){var b=this;var c=b.$mjListPage.find(".co-listview-items");c.delegate(".prjmg-move-fopen","click",function(e){e.preventDefault();var d=a(this).parent().data("id");var f=c.find(".co-listview-folder.on").parent().data("id");if(d!=f){c.find(".co-listview-folder.on").removeClass("on")}b.$mjListPage.find('input[name="parent"]').val(d);b._listPage(0)})},_getListSortableOptions:function(){var b=this;var c={cancel:".unsortable",opacity:0.8,cursor:"pointer",helper:"clone",containment:b.$mjListPage.find(".co-listview-list"),start:function(d,e){b._onSortStartList(d,e)},stop:function(d,e){b._onSortStopList(d,e)},tolerance:"pointer",items:"tr",placeholder:"prj-move-placeholder"};return c},_onSortStartList:function(c,d){var b=this;b._sortStartListID=d.item.find(".jco-id").val();b._sortStartListPos=b._getSortListPos(d.item)},_onSortStopList:function(e,g){var b=this;var d=b._getSortListPos(g.item);if(b._sortStartListPos==d){return}var f=b._getSortListDestID(g.item);if(f.id<0){b._getListAjax(0);return}var c={success:function(i){b._setListStyle(i);b._getListAjaxSuccessAddData()},error:function(j,i,k){b.onError(j.status,k)}};var h=b._getMoveSeqnoTaskRequest(f);b._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,h,c)},_getSortListDestID:function(b){var e;var g={};var f;var d;var c=b.parent().find("tr");for(e=0;e<c.length;e++){if(a(c[e]).find(".jco-id").val()==b.find(".jco-id").val()){if(e+1<c.length){f=a(c[e+1]).find(".jco-id").val();d="+"}else{f=a(c[e-1]).find(".jco-id").val();d="-"}break}}g.id=f;g.proc=d;return g},_getSortListPos:function(b){var d;var c=b.parent().find("tr");for(d=0;d<c.length;d++){if(a(c[d]).find(".jco-id").val()==b.find(".jco-id").val()){break}}return d},_getMoveSeqnoTaskRequest:function(c){var b=this;var d={};d=b.getAddDataParam();d.cmd=b._getMoveTaskExecCmd();d.destid=c.id;d.id=b._sortStartListID;d.proc=c.proc;return d},changPage:function(){var c=this;var d=c.$mjListPage.find(".co-listview");var f=c.$mjListPage.find(".jco-back-page-data");c.callBase("changPage");var b=c._getListDraggable();var e=c._getListDroppable();c._initRightItemDrag(b);c._initLeftItemDrop(e)},_initRightItemDrag:function(b){var c=this;if(!neo.isSet(b)||b.length==0){return}var d=c._getListDraggableOptions();b.draggable(d)},_getListDraggableOptions:function(){var b=this;var c=b.$mjListPage.find("div.co-listview-scroll");return{appendTo:"body",handle:"tr",distance:5,helper:function(){var e=a(this).parent(),d=a(this).parent().find(".prj-list-taskname-move").find("span").html();if(desknets.browser.msie8){return a('<div id="co-dragtip-ie8"><div class="dragtip" title="'+d+'">'+d+'</div><div class="ieShadow"></div></div>')}else{return a('<div id="co-dragtip" title="'+d+'">'+d+"</div>")}},cursor:"move",cursorAt:{top:0,left:0},start:function(f,d){b._dragStartListID=a(f.target).parent().find(".jco-id").val();b._startLeftMove()},stop:function(g,f){var d=b.$mjListPage.find(".co-listview-left");setTimeout(function(){d.find(".on").removeClass("jprj-process-noselect")},100);d.css("background","#ffffff")}}},_startLeftMove:function(){var b=this;var c=b.$mjListPage.find(".co-listview-left");c.css("background","#f5faff");c.find(".on").addClass("jprj-process-noselect")},_initLeftItemDrop:function(d){var b=this;if(!neo.isSet(d)||d.length==0){return}var c=b._getTreeListDroppableOptions();d.droppable(c)},_getTreeListDroppableOptions:function(){var b=this;return{hoverClass:"co-listview-dropover",tolerance:"pointer",accept:".co-thd-handle",drop:function(g,f){var d=a(this);var c=d.find("li.jprj-listview-folder-item").find("a:hover");c.removeClass("prj-listview-dropactive");if(c.length==0||c.hasClass("jprj-process-noselect")){return}b._dropMoveConf(c.closest("div"))},activate:function(f,d){var c=a(f.target).find("li.jprj-listview-folder-item").find("a.prjmg-move-fopen");c.bind("mouseover",function(){a(this).addClass("prj-listview-dropactive")});c.bind("mouseout",function(){a(this).removeClass("prj-listview-dropactive")})},deactivate:function(f,d){var c=a(f.target).find("li.jprj-listview-folder-item").find("a.prjmg-move-fopen");c.unbind("mouseover").unbind("mouseout")}}},_dropMoveConf:function(b){var c=this;var d=desknets.getUrl(c._getRestModule());var f=c._getRequestMoveParams(b);var g=c._moveConfMessage();var e={message:g};c._moveParams=a.extend({},f);c._dispDialogMoveConf(b,e)},_getRequestMoveParams:function(b){var c=this;var d=b.data("id");params=c.getAddDataParam();params.destid=d;params.id=c._dragStartListID;params.cmd=c._getMoveListCmd();return params},_moveConfMessage:function(){var c=this;var b="";b=desknets.Resource.Message.com_move_listconf;return desknets.tmpl.replaceWordHtml(b,"count",1)},_dispDialogMoveConf:function(b,d){var c=this;var h="";var g=b.find(".prjmg-move-fopen").text();if(d.message){h=d.message}var f={extraMessage:desknets.folderlist.makeMoveMessage(g)};var e=desknets.dialog.confirm(h,function(){desknets.submitform.setDialogDisabled(e);c._inputMoveSubmit(e);return false},f)},_inputMoveSubmit:function(e){var b=this;var d;var c;var f={};f=b._moveParams;f.cmd=b._getMoveListCmd();c=desknets.getUrl(b._getRestModule());desknets.ajax.rest({url:c,data:f,success:function(){b._getListAjax(0)},complete:function(){desknets.submitform.clearDialogDisabled(e);e.dialog("close")},error:function(h,g,i){b.onError(h.status,i)}})},_getListDraggable:function(){var b=this;var c=b.$mjListPage.find("div#prjmg-move-tasks-scroll");return c.find("td.unsortable")},_getListDroppable:function(){var b=this;var c=b.$mjListPage.find("div.co-listview-left:not(.ui-droppable)");return c},_listPageLink:function(){return},onError:function(c,d){var b=this;var f=desknets.dialog.alert(d,{errorNo:c});var e={close:function(h){var g=f.hasClass("warn")?"warn":"error";desknets.dialog.deleteById(g)}};f.dialog(e)},_initListStart:function(){var b=this;b.callBase("_initListStart");b._initListStartPageBack()},_initListStartPageBack:function(){var b=this;b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();if(!neo.isSet(b.mBackCmd)||!neo.isSet(b.mIdBack)){return null}arPrm=desknets.getInputDataToObj(a("#"+b.mIdBack).find(".jco-back-page-data"));arPrm.cmd=b.mBackCmd;if(neo.isSet(arPrm)){b._setLocationHash(arPrm)}})},_setTitle:function(d){var c=this;var b={};b.title=c._mPrjName;c.callBase("_setTitle",d,b)},_getRestModule:function(){return desknets.prjset.MODULE_API_PRJ},_getListCmd:function(){return desknets.prjset.PAGE_PRJMSETMOVETASK},_getListExecCmd:function(){return desknets.prjset.CMD_PRJMSETMOVETASKLIST},_getAddDataGetCmd:function(){return desknets.prjset.CMD_PRJMSETPROCESSLIST},_getMoveTaskExecCmd:function(){return desknets.prjset.CMD_PRJMSETMOVESEQNOTASK},_getMoveListCmd:function(){return desknets.prjset.CMD_PRJMSETMOVETASK},_getIdListPage:function(){return"jprj-m-movetask-container"},_getIdListPageForm:function(){return"movetaskfrm"},getAddDataParam:function(){var b=this;var c={};c.pid=b.$mjListPage.find(".jco-back-page-data").find('input[name="pid"]').val();return c},});desknets.page(desknets.prjset,"prjsetgen",desknets.PageSet,{_getNextCmd:function(){return desknets.prjset.PAGE_PRJSETADMIN}});desknets.page(desknets.prjset,"prjsetmanager",desknets.PageAdmin,{_getNextCmd:function(){return desknets.prjset.PAGE_PRJSETADMIN}});app.addInitialAction(function(){desknets.prjset.init()})})(jQuery);