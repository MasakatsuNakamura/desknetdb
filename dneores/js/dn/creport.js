/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.creportutilroutecom={MODULE_API_CREPORT:"zrcreport",CMD_CREPORTROUTELIST:"creportcmdroutelist",CMD_CREPORTUSERROUTELIST:"creportcmduserroutelist",CMD_CREPORTROUTESELECT:"creportcmdrouteselect",};desknets.creportutilroute={$mdialog:null,moptions:{},mcreportmodule:desknets.creportutilroutecom.MODULE_API_CREPORT,mcreportcmd:desknets.creportutilroutecom.CMD_CREPORTROUTELIST,mcreportpcmd:desknets.creportutilroutecom.CMD_CREPORTUSERROUTELIST,mcreportget:desknets.creportutilroutecom.CMD_CREPORTROUTESELECT,mcreportprivate:desknets.Resource.setprivate,_moptions:{dialogid:"jcreport-route-select-dialog",title:desknets.Resource.routetitle,tmpl:"com/creport.route.html",onOk:null,onCancel:null},init:function(c){var b=this;b.moptions=a.extend({},b._moptions,c);b.destroy()},destroy:function(){var b=this;if(b.$mdialog){b.$mdialog.dialog("destroy");b.$mdialog=null}a("#"+b.moptions.dialogid).remove()},open:function(){var b=this;if(b.$mdialog==null){b.$mdialog=a("<div />").attr("id",b.moptions.dialogid).appendTo(document.body);desknets.tmpl.load(b.$mdialog,b.moptions.tmpl,a.proxy(function(){desknets.dialog.setUp(b.$mdialog,b._getDialogOptions());b.$mdialog.find(".jcreport-data").hide();b.$mdialog.find(".jcreport-nodata").hide();b._ajaxRouteListGet();b.$mdialog.dialog("open");desknets.dialog.setFirstDialogOpen(b.$mdialog)},this),{})}else{b.$mdialog.dialog("open").find('input[type="button"]').blur();b.$mdialog.find(":checkbox:checked").attr("checked",false)}return b.$mdialog},_getDialogOptions:function(){var b=this;var e={};e[desknets.Resource.OKButtonLabel]=a.proxy(b._onClickOk,this);e[desknets.Resource.CancelButtonLabel]=a.proxy(b._onClickCancel,this);var d=desknets.dialog.getDialogOption();var c={buttons:e,title:b.moptions.title,width:"500",close:function(){neo.ajax.abort(b.moptions.dialogid,true)}};a.extend(d,c);return d},_ajaxRouteListGet:function(){var b=this;var c={};c["0"]={cmd:b.mcreportcmd,row:"0",order:"1",num:"-1"};c["1"]={cmd:b.mcreportpcmd,row:"0",order:"1",num:"-1"};desknets.ajax.rest({id:b.moptions.dialogid,url:desknets.getUrl(b.mcreportmodule),data:desknets.ajax.arrayToMultiCmdData(c),success:a.proxy(function(e,d,f){b._updateRouteTable(e["0"].list,e["1"].list)})})},_updateRouteTable:function(d,e){var c=this;var f=[];var g;g=d.item==null?[]:d.item;g=a.isArray(g)?g:[g];a.each(g,function(h,i){f[f.length]='<tr><td class="co-chk"><input type="checkbox" name="route-id"';f[f.length]=' value="pub:'+i.id+'"></td>';f[f.length]='<td><span title="'+desknets.tmpl.escapeWord(i.Name)+'">'+desknets.tmpl.escapeWord(i.Name)+"</span></td></tr>"});g=e.item==null?[]:e.item;g=a.isArray(g)?g:[g];a.each(g,function(h,i){f[f.length]='<tr><td class="co-chk"><input type="checkbox" name="route-id"';f[f.length]=' value="usr:'+i.id+'"></td>';f[f.length]='<td><span title="'+desknets.tmpl.escapeWord(i.Name+c.mcreportprivate)+'">'+desknets.tmpl.escapeWord(i.Name+c.mcreportprivate)+"</span></td></tr>"});var b=c.$mdialog.find("tbody");b.empty();b.html(f.join(""));desknets.htmlparts.addStripeClass(b,"co-tr-even");c.$mdialog.find(".jcreport-nodata").toggle(f.length<=0);c.$mdialog.find(".jcreport-data").toggle(f.length>0)},_onClickCancel:function(c){var b=this;if(b.moptions.onCancel){b.moptions.onCancel(c)}b.$mdialog.dialog("close")},_onClickOk:function(c){var b=this;var d=b._getSelected();if(b.moptions.onOk){if(d!=null){b._ajaxRouteDetailGet(d,function(f,e,g){b.moptions.onOk(f)})}else{b.moptions.onOk(null)}}b.$mdialog.dialog("close")},_getSelected:function(){var b=this;var d=[];var c=b.$mdialog.find("input[name=route-id]:checked").closest("tr");if(c.length<=0){return null}a.each(c,function(f,j){var i=a(j);var k=a(j).find(":checked").val();var h=new RegExp("(pub|usr):([0-9]*)");k.match(h);var g=RegExp.$1;var l=RegExp.$2;var e=i.text();d.push({routeType:g,routeId:l,routeName:e})});return d.length?d:d},_ajaxRouteDetailGet:function(g,d){var b=this;var e=[],h=[];a.each(g,function(i,j){var k=j.routeType;var l=j.routeId;if(k=="pub"){e.push(l)}else{h.push(l)}});var c=desknets.getUrl(b.mcreportmodule);var f={};f.cmd=b.mcreportget;f.id=e;f.pid=h;desknets.ajax.rest({url:c,data:f,type:"POST",success:d})}};desknets.page(desknets,"NoticeUnconfirmUserDialog",null,{_dialogId:"jco-view-notice-dialog",$dialog:null,_TMPL_DIALOG:null,_DIALOG_TITLE:null,_TMPL_USER:'<span class="co-selitem"><span class="co-selitem-text" title="{{name}}">{{name}}</span><a href="#" class="co-btn co-btn-close" title="'+desknets.Resource.deselectLabel+'">x</a><input type="hidden" name="uid" value="{{id}}" /></span>',id:null,subject:null,init:function(c){var b=this;b.destroy();b._TMPL_DIALOG=b.initSetupDialog();b._DIALOG_TITLE=b.initSetupTitle();b.id=desknets.paramanalyzer.getHashParam("id");b.subject=c},initSetupDialog:function(){return""},initSetupTitle:function(){return""},destroy:function(){var b=this;if(b.$dialog){desknets.dialog.deleteById(this._dialogId);this.$dialog=null}},open:function(){var b=this;if(b.$dialog==null){b.$dialog=desknets.dialog.make(b._dialogId,b._getDialogOptions());desknets.tmpl.load(b.$dialog,b._TMPL_DIALOG,function(){b._buildContents();b.$dialog.dialog("open");desknets.dialog.setFirstDialogOpen(b.$dialog)})}else{b._loadUnconfirmUsers();b.$dialog.dialog("open")}return b.$dialog},_getDialogOptions:function(){var b=this;var c=a.extend(desknets.dialog.getDialogOption(),{title:b._DIALOG_TITLE,dialogClass:"dn-dialog message confirm",buttons:{},width:600});c.buttons[desknets.Resource.OKButtonLabel]=function(){b._noticeSend()};c.buttons[desknets.Resource.CancelButtonLabel]=function(){b.$dialog.dialog("close")};return c},_buildContents:function(){var c=this;var d=c.$dialog.find('input[name="subject"]');var b=desknets.tmpl.replaceWordHtml(d.val(),"subject",c.subject);d.val(b);if(desknets.pageframe.getMailUse()!="1"){c.$dialog.find(".jco-notice-mail").remove();c.$dialog.find("#co-notice-memo").selected()}else{c.$dialog.find("#co-notice-mail").selected()}if(!desknets.pageframe.isShownMenu("memo")){c.$dialog.find(".jco-notice-memo").remove()}c.$dialog.find(".co-selmulti-items").on("click",".co-btn-close",function(e){e.preventDefault();a(this).parent().remove()});c._loadUnconfirmUsers()},_loadUnconfirmUsers:function(){var b=this;var c=function(h,d,i){var g=b.$dialog.find(".co-selmulti-items");g.html("");var e=h.list["item"];if(e==null){e=[]}if(!a.isArray(e)){e=[e]}var f=desknets.pageframe.getLoginUid();a.each(e,function(k,l){if(f!=l.uid){var j=b._TMPL_USER;j=desknets.tmpl.replaceWordHtml(j,"id",l.uid);j=desknets.tmpl.replaceWordChk(j,"name",l.uname);g.append(j)}})};desknets.ajax.rest({url:b._getUrl(),data:b._loadUnconfirmUsersPrm(),success:function(e,d,f){c(e,d,f)}})},_getUrl:function(){return""},_loadUnconfirmUsersPrm:function(){return{}},_noticeSend:function(){var c=this;desknets.submitform.setDialogDisabled(c.$dialog);var b=[];desknets.ajax.rest({url:c._getUrl(),data:c._noticeSendPrm(),error:function(g,e,i){var h=i;var d=a.parseJSON(g.responseText);if(!!d.errmsgadd){var f={};f.msg=d.errormessage;f.fieldid=d.errmsgadd;f.fieldname=desknets.getErrFieName(c.$dialog,d.errmsgadd);h=desknets.getErrConvMsg(f)}desknets.ajax.onError(g.status,h)},success:function(f,d,g){if(!!f.msg){var h={extraMessage:f.noticeerror,extraClass:"co-msg-r",type:"warn",close:function(){c.$dialog.dialog("close")}};var e=desknets.dialog.alert(f.msg,h);e.bind("dialogclose",function(i){desknets.dialog.deleteById("warn")})}else{var h={type:"message",close:function(){c.$dialog.dialog("close")}};desknets.dialog.alert(c._noticeSendMsg(),h)}},complete:function(f,d,e){desknets.submitform.clearDialogDisabled(c.$dialog)},traditional:true})},_noticeSendPrm:function(){return{}},_noticeSendMsg:function(){return""},_updateToContactWith:function(){var c=this;var b=0;c.$dialog.find("input[type=checkbox]:checked").each(function(){b+=Number(a(this).val())});if(b===0){return""}else{return b.toString()}}});desknets.creport={MODULE_API_CREPORT:"zrcreport",MODULE_MAIN_CREPORT:"zcreport",CMD_CREPORTINDEX:"creportcmdindex",CMD_CREPORTLISTREAD:"creportcmdnoticeread",CMD_CREPORTLISTUNREAD:"creportcmdnoticeunread",CMD_CREPORTLISTCHECK:"creportcmdnoticecheck",CMD_CREPORTLISTDEL:"creportcmdnoticedel",CMD_CREPORTROUTE:"creportcmdroute",CMD_CREPORTCOMMENTENTRY:"creportcmdcomment",CMD_CREPORTLISTMOVE:"creportcmdnoticemove",CMD_CREPORTDISP:"creportcmddisp",CMD_CREPORTFINISH:"creportcmdfinish",CMD_CREPORTCOMMENTENTRY:"creportcmdcomment",CMD_CREPORTTAG:"creportcmdtag",CMD_CREPORTREFATTACH:"creportcmddispattach",CMD_CREPORTCOMMENTATTACHREF:"creportcmdcommentattachdisp",CMD_CREPORTUSERFOLDERLISTCHILD:"creportcmduserfolderlistchild",CMD_CREPORT_RTEATTACH:"creportrteattach",CMD_CREPORT_RTEATTACHPRI:"creportprirteattach",CMD_CREPORTMSET_RTEATTACH:"creportmsetrteattach",RECV_FOLDER_ID:"-1",SEND_FOLDER_ID:"-2",DRAFT_FOLDER_ID:"-3",DUST_FOLDER_ID:"-4",MY_ROOT_FOLDER_ID:"-5"};a.extend(desknets.creport,{MODULE_API_CREPORT:"zrcreport",PAGE_CREPORTINDEX:"creportindex",CMD_CREPORT:"creport",CMD_CREPORTDRAFTINDEX:"creportcmddraftindex",CMD_CREPORTSEARCHLISTMOVE:"creportcmdnoticemovesearch",CMD_CREPORTDISPPAGE:"creportcmddisppage",CMD_CREPORTENTRYPAGE:"creportcmdentrypage",CMD_CREPORTENTRY:"creportcmdentry",CMD_CREPORTPRINTPAGE:"creportcmdprintpage",CMD_CREPORTCABINETPAGE:"creportcmdcabinetpage",CMD_CREPORTCONFIRMPAGE:"creportcmdconfirmpage",CMD_CREPORTDEL:"creportcmddel",CMD_CREPORTDELCONF:"creportcmddelconf",CMD_CREPORTFINISHCONF:"creportcmdfinishconf",CMD_CREPORTSEARCHPAGE:"creportcmdsearchpage",CMD_CREPORTSEARCHINDEX:"creportcmdsrchindex",CMD_CREPORTSEARCHDISPPAGE:"creportcmdsrchdisppage",CMD_CREPORTSTOPSEARCH:"creportcmdsrchstop",CMD_CREPORTCSVDOWNLOAD:"creportcmdcsvdownload",CMD_CREPORTUNCONFIRMNOTICE:"creportcmdnoticeunconf",CMD_CREPORTENTRYFORMATINFO:"creportcmdentryformatinfo",CMD_CREPORTCONNECTAPP:"creportcmdconnectapp",CMD_CREPORTRTEDISPATTACH:"creportrtedispattach",CMD_CREPORTDRAFTPAGE:"creportcmddraftpage",CMD_CREPORTDRAFTDEL:"creportcmddraftdel",CMD_CREPORTDRAFTENTRY:"creportcmddraft",CMD_CREPORTDRAFTSEND:"creportcmddraftsend",CMD_CREPORTREFATTACHWK:"creportcmddispattachwk",CMD_CREPORTADDATTACH:"creportcmdaddattach",CMD_CREPORTDELATTACH:"creportcmddelattach",CMD_CREPORTMSETREFATTACH:"creportmsetcmddispattach",CMD_CREPORTCABATTACHCOPY:"creportcmdcabattachcopy",CMD_CREPORTCOMMENTATTACHBEGIN:"creportcmdcommentattachbegin",CMD_CREPORTCOMMENTATTACHREFWK:"creportcmdcommentattachdispwk",CMD_CREPORTCOMMENTATTACHADD:"creportcmdcommentattachadd",CMD_CREPORTCOMMENTATTACHDEL:"creportcmdcommentattachdel",CMD_CREPORTMSETCOMMENTATTACHREF:"creportmsetcmdcommentattachdisp",CMD_CREPORTUSERFOLDERLIST:"creportcmduserfolderlist",CMD_CREPORTUSERFOLDERMOVEPARENT:"creportcmduserfolderpmove",CMD_CREPORTUSERFOLDERMOVE:"creportcmduserfoldermove",CMD_CREPORTUSERFOLDERENTRY:"creportcmduserfolderentry",CMD_CREPORTUSERFOLDERDEL:"creportcmduserfolderdel",CMD_CREPORTSUBJECTLIST:"creportcmdsubjectlist",CMD_CREPORTSUBJECTENTRYPAGE:"creportcmdsubjectentrypage",CMD_CREPORTSUBJECTENTRY:"creportcmdsubjectentry",CMD_CREPORTSUBJECTDEL:"creportcmdsubjectdel",CMD_CREPORTSUBJECTMOVE:"creportcmdsubjectmove",CMD_CREPORTFORMATINFO:"creportmsetcmdformatinfo",CMD_CREPORTFORMATLIST:"creportmsetcmdformatlist",CMD_CREPORTFORMATENTRYPAGE:"creportmsetcmdformatentrypage",CMD_CREPORTFORMATENTRY:"creportmsetcmdformatentry",CMD_CREPORTFORMATDEL:"creportmsetcmdformatdel",CMD_CREPORTFORMATMOVE:"creportmsetcmdformatmove",CMD_CREPORTFORMATEXPORT:"creportmsetcmdformatexport",CMD_CREPORTUSERFORMATLIST:"creportcmduserformatlist",CMD_CREPORTUSERFORMATENTRYPAGE:"creportcmduserformatentrypage",CMD_CREPORTUSERFORMATENTRY:"creportcmduserformatentry",CMD_CREPORTUSERFORMATDEL:"creportcmduserformatdel",CMD_CREPORTUSERFORMATMOVE:"creportcmduserformatmove",CMD_CREPORTUSERFORMATEXPORT:"creportcmduserformatexport",CMD_CREPORT_USERFORMATINFO:"creportcmduserformatinfo",CMD_CREPORTROUTEINFO:"creportcmdrouteinfo",CMD_CREPORTROUTELIST:"creportcmdroutelist",CMD_CREPORTROUTEENTRYPAGE:"creportcmdrouteentrypage",CMD_CREPORTROUTEENTRY:"creportcmdrouteentry",CMD_CREPORTROUTEDEL:"creportcmdroutedel",CMD_CREPORTROUTEMOVE:"creportcmdroutemove",CMD_CREPORTUSERROUTELIST:"creportcmduserroutelist",CMD_CREPORTUSERROUTEENTRYPAGE:"creportcmduserrouteentrypage",CMD_CREPORTUSERROUTEENTRY:"creportcmduserrouteentry",CMD_CREPORTUSERROUTEDEL:"creportcmduserroutedel",CMD_CREPORTUSERROUTEMOVE:"creportcmduserroutemove",CMD_CREPORTROUTESELECT:"creportcmdrouteselect",MAXNUM:"999999999",init:function(){var c=this;var b=a("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(b);if(b==desknets.creport.PAGE_CREPORTINDEX){desknets.hashobserver.init(desknets.creport);desknets.creport.creportindex.init();desknets.tags.item.setUpFuncAfterAjax(c.changeMainContent)}if(this.isCReport(b)&&b.indexOf("creportpset")!=0&&b.indexOf("creportmset")!=0){desknets.creport.subwin.init()}},isCReport:function(c){var b=this;if(c.indexOf(b.CMD_CREPORT)>=0){return true}return false},isNormalRunMode:function(){var b=!desknets.creportset;return b},ajaxFormatGet:function(e,f,b){var c=desknets.getUrl(desknets.creport.MODULE_API_CREPORT);var d={cmd:desknets.creport.CMD_CREPORTFORMATINFO,id:e,type:"pub"};desknets.ajax.rest({id:b,url:c,data:d,type:"POST",success:f})},ajaxUserFormatGet:function(e,f,b){var c=desknets.getUrl(desknets.creport.MODULE_API_CREPORT);var d={cmd:desknets.creport.CMD_CREPORT_USERFORMATINFO,id:e,type:"usr"};desknets.ajax.rest({id:b,url:c,data:d,type:"POST",success:f})},getFolderCmd:function(){var b=this;return{restAPI:b.MODULE_API_CREPORT,listCMD:b.CMD_CREPORTUSERFOLDERLIST,listchildCMD:b.CMD_CREPORTUSERFOLDERLISTCHILD,moveparentCMD:b.CMD_CREPORTUSERFOLDERMOVEPARENT,movebetweenCMD:b.CMD_CREPORTUSERFOLDERMOVE}},getCreportAttachDownloadUrlMap:function(){return{cmd:this.CMD_CREPORTREFATTACH}},replaceCreportListLine:function(b,i,e){var h,f;if(i==="important"){switch(e[i]){case"1":f="haste";h=desknets.Resource.importance_highest;break;case"2":f="high";h=desknets.Resource.importance_high;break;case"4":f="low";h=desknets.Resource.importance_low;break;default:f="";h=""}b=desknets.tmpl.replaceWordHtml(b,"importance-cls",f);b=desknets.tmpl.replaceWordHtml(b,"importance-text",h)}else{if(i==="attach"){f=e[i]==="1"?"on":"";b=desknets.tmpl.replaceWordHtml(b,"attach_cls",f)}else{if(i==="sts"){f=e[i]==="4"||e[i]==="6"?"finish":"";b=desknets.tmpl.replaceWordHtml(b,"status_cls",f);h=e[i]==="4"||e[i]==="6"?desknets.Resource.creport.finish:"";b=desknets.tmpl.replaceWordHtml(b,"status_text",h)}else{if(i==="cretime"||i==="entrydate"){b=desknets.tmpl.replaceWordHtml(b,i,desknets.dateTime.dispDateTime(e[i],{type:"list"}))}else{if(i==="period"){h="";if(neo.dateTime.parse(e[i])){h=desknets.dateTime.dispDateTime(e[i],{type:"list"})}var c=e.perioddays;var d=e.periodalert=="1";if(!neo.isSet(c,{blank:false})){}else{if(c=="0"){h+=" ";if(d){h+='<span class="creport-closedate-alert">'}h+="("+desknets.Resource.creport.byToday+")";if(d){h+="</span>"}}else{h+=" ";if(d){h+='<span class="creport-closedate-alert">'}h+="("+c+desknets.Resource.creport.daySymbol+")";if(d){h+="</span>"}}}b=desknets.tmpl.replaceWordHtml(b,i,h)}else{if(i==="agenda"){h="";if(!!e[i]){var g=desknets.Resource.creport.agenda;h='<span class="creport-ic-agenda" title="'+g+'">'+g+"</span>"}b=desknets.tmpl.replaceWordHtml(b,"agenda-icon",h)}else{if(i==="flow"){h="";if(!!e[i]){var g=desknets.Resource.creport.flow;h='<span class="creport-ic-flow" title="'+g+'">'+g+"</span>"}b=desknets.tmpl.replaceWordHtml(b,"flow-icon",h)}else{return null}}}}}}}return b},filterNewComments:function(c,d){var b;b=a.grep(d,function(e,f){return e.orgrev===c});return b},filterOldComments:function(c,d){var b;b=a.grep(d,function(e,f){return e.orgrev!==c});return b},confirmMoveTrash:function(i,e,c){var d=desknets.tmpl.escapeWord(desknets.Resource.creport.delConfTrash);var h=desknets.tmpl.escapeWord(desknets.Resource.creport.delConfDelete);var g='<div style="text-align:center;"><ul style="display:inline-block; text-align:left;"><li><input type="radio" name="deltype" id="jcreport-delconf-deltype1" value="1" checked="true"><label for="jcreport-delconf-deltype1">'+d+'</label></li><li><input type="radio" name="deltype" id="jcreport-delconf-deltype2" value="2"><label for="jcreport-delconf-deltype2">'+h+"</label></li></ul></div>";var b={extraMessage:g};var f=null;f=desknets.dialog.confirm(i,function(){var j=f.find(":radio[name=deltype]:checked").val();if(j=="1"){return e.call(f)}else{if(j=="2"){return c.call(f)}}},b);return f},changeMainContent:function(c,d){if(c.data("module")!="creport"){return true}var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(b.cmd)){b.cmd=""}if(b.cmd==desknets.creport.CMD_CREPORTDISPPAGE){if(b.id==a.trim(c.data("did"))){a(".co-select-menu-text").html(a(".tag-disp-options:first").find("a:first").html());a('input[name="tagcolor"]').val("0")}}return true},getAttExtListCmd:function(b){return"creport"+b},banpei:null});(function(b){desknets.page(desknets.creport,"subwin",desknets.PageSubwinSearch,{init:function(){var c=this;var d=b(".jco-subwindow-search");var e=desknets.paramanalyzer.getHashParams();if(e.sw_attach=="1"){d.find("input[name=sw_attach]").attr("checked","checked")}d.find("input[name=srch_key]").val(e.srch_key);if(!!e.sw_subject){d.find("select[name=sw_subject]").val(e.sw_subject)}if(!!e.sw_status){d.find("select[name=sw_status]").val(e.sw_status)}d.find("input[name=sw_entry]").val(e.sw_entry);if(!!e.sw_important){d.find("select[name=sw_important]").val(e.sw_important)}d.find("input[name=sdate]").val(e.sdate);d.find("input[name=edate]").val(e.edate);c.callBase("_initSearch");desknets.htmlparts.setUpForm(c.$_inputArea)},_getSearchPrm:function(e){var c=this;var d=c.$_inputArea;e.fldsort="entrydate";e.order="-1";e.row="0";e.sw_attach=d.find("input[name=sw_attach]").is(":checked")?"1":"";e.srch_key=d.find("input[name=srch_key]").val();e.sw_subject=d.find("select[name=sw_subject]").val();e.sw_status=d.find("select[name=sw_status]").val();e.sw_entry=d.find("input[name=sw_entry]").val();e.sw_important=d.find("select[name=sw_important]").val();e.sdate=d.find("input[name=sdate]").val();e.edate=d.find("input[name=edate]").val();return e},_execClear:function(){var c=this;c.callBase("_execClear");c.$_inputArea.find("input[name=sw_attach]").attr("checked",false);c.$_inputArea.find('select[name="sw_subject"]').val("");c.$_inputArea.find('select[name="sw_status"]').val("-1");c.$_inputArea.find('select[name="sw_important"]').val("0")},_chkInputSearchRequired:function(){var d=this.$_inputArea;var e="";var c=["[name=sw_attach]:checked","[name=srch_key][value!=]","[name=sw_subject][value!=]","[name=sw_status][value!=-1]","[name=sw_entry][value!=]","[name=sw_important][value!=0]","[name=sdate][value!=]","[name=edate][value!=]"];if(d.find(c.join(",")).length==0){e=desknets.Resource.Message.com_search_nokey;desknets.dialog.alert(e,{type:"warn"});return false}return this.callBase("_chkInputSearchRequired")},_getMainCmd:function(){return desknets.creport.CMD_CREPORTSEARCHINDEX},_getSearchCmd:function(){return desknets.creport.CMD_CREPORTSEARCHPAGE}})})(jQuery);(function(b){desknets.page(desknets.creport,"folderlist",desknets.folderlist,{_initfid:desknets.creport.RECV_FOLDER_ID,_getRequestParams:function(e){var c=this;var d=e.attr(c._itemid);if(d==desknets.creport.MY_ROOT_FOLDER_ID){d=""}return{cmd:this._getFolderListChildCmd(),pfolder:d}},_createFolderSetMenu:function(c){var e=this;var d=e.$_setMenu;var g=c.closest("li");var f=g.attr(this._itemid);d.empty();if(f!==desknets.creport.MY_ROOT_FOLDER_ID){d.prepend(b(e._tmpMenuDel));d.prepend(b(e._tmpMenuMod))}d.prepend(b(e._tmpMenuAdd))},_setButtonErea:function(c){var d=this;var f=d.$_root.find(".co-listview-left-subtitle");var e;this.callBase("_setButtonErea",c);var h=c.closest("li");var g=h.attr(this._itemid);if(g===desknets.creport.MY_ROOT_FOLDER_ID){f.find(":button.jco-litview-item-mod,:button.jco-litview-item-del").attr("disabled",true)}e=false;if(g==desknets.creport.RECV_FOLDER_ID||g==desknets.creport.SEND_FOLDER_ID||g==desknets.creport.DRAFT_FOLDER_ID||g==desknets.creport.DUST_FOLDER_ID){e=true}f.find(":button.jco-litview-item-add").attr("disabled",e)},banpei:null})})(jQuery);(function(b){desknets.page(desknets.creport,"folderdialog_entry",desknets.folderlist.dialog_entry,{_TMPLDIALOG:"creport/creport.folder.create.html",_getFolderEntryCmd:function(){return desknets.creport.CMD_CREPORTUSERFOLDERENTRY},_getRestModule:function(){return desknets.creport.MODULE_API_CREPORT},_get_folderid:function(d){var c;c=d.data("fid");if(c==desknets.creport.MY_ROOT_FOLDER_ID){return"0"}else{if(c){return c}}return"0"},})})(jQuery);(function(b){desknets.page(desknets.creport,"folderdialog_delete",desknets.folderlist.dialog_delete,{_getFolderDelCmd:function(){return desknets.creport.CMD_CREPORTUSERFOLDERDEL},_delConfAddMessage:function(){return desknets.Resource.Message.creport_folderDelConf},_getRestModule:function(){return desknets.creport.MODULE_API_CREPORT}})})(jQuery);(function(b){desknets.page(desknets.creport,"FormatPreviewDialog",null,{_dialogId:"jcreport-format-preview-dialog",_inputFieldName:"format-id",$dialog:null,options:{},_options:{onOk:null,onCancel:null},_htmlPreview:null,_flgPreview:"0",_TMPL_DIALOG:"creport/creport.formatPreviewDialog.html",_DIALOG_TITLE:desknets.Resource.preview,init:function(c){this.destroy();this.options=b.extend({},this._options,c)},destroy:function(){if(this.$dialog){this.$dialog.dialog("destroy");this.$dialog=null}b("#"+this._dialogId).remove();this._htmlPreview=null;this.options={}},open:function(c,d){this._htmlPreview=c;this._flgPreview=d;if(this.$dialog==null){this.$dialog=b("<div />").attr("id",this._dialogId).appendTo(document.body);desknets.tmpl.load(this.$dialog,this._TMPL_DIALOG,b.proxy(function(){desknets.dialog.setUp(this.$dialog,this._getDialogOptions());this._buildContents();this.$dialog.dialog("open");desknets.dialog.setFirstDialogOpen(this.$dialog)},this),{})}else{this.$dialog.dialog("open").find('input[type="button"]').blur()}return this.$dialog},_getDialogOptions:function(){var e={};e[desknets.Resource.CloseButtonLabel]=b.proxy(this._onClickCancel,this);var d=desknets.dialog.getDialogOption();var c={buttons:e,dialogClass:"dn-dialog",resizable:false,draggable:true,title:this._DIALOG_TITLE,width:"741",height:"auto",open:b.proxy(this._onOpen,this)};b.extend(d,c);return d},_buildContents:function(){},_updatePreview:function(c){if(this._flgPreview=="1"){this.$dialog.find(".creport-preview-main").html("").hide();this.$dialog.find(".form-format-preview-in").empty().html(c||"<BR>");this.$dialog.find(".form-preview-main").show()}else{this.$dialog.find(".creport-preview-main").empty().html(c||"<BR>").show();this.$dialog.find(".form-format-preview-in").html("");this.$dialog.find(".form-preview-main").hide()}},_onClickCancel:function(c){if(this.options.onCancel){this.options.onCancel(c)}this._htmlPreview=null;this._updatePreview(null);this.$dialog.dialog("close")},_onOpen:function(c){this._updatePreview(this._htmlPreview)},banpei:null})})(jQuery);desknets.page(desknets.creport,"NoticeUnconfirmUserDialog",desknets.NoticeUnconfirmUserDialog,{initSetupDialog:function(){return"creport/creport.noticeUnconfirmUserDialog.html"},initSetupTitle:function(){return desknets.Resource.creport.noticeUnconfirmUserDialogTitle},_getUrl:function(){var b=this;return desknets.getUrl(desknets.creport.MODULE_API_CREPORT)},_loadUnconfirmUsersPrm:function(){var b=this;var c={};c.cmd=desknets.creport.CMD_CREPORTROUTE;c.id=b.id;c.filter="nocheck";c.num=desknets.creport.MAXNUM;c.deluser="1";return c},_noticeSendPrm:function(){var c=this;var d={};var b=[];d.cmd=desknets.creport.CMD_CREPORTUNCONFIRMNOTICE;d.id=c.id;d.sendhowto=c._updateToContactWith();d.subject=c.$dialog.find('input[name="subject"]').val();d.memo=c.$dialog.find("textarea").val();c.$dialog.find(".co-selitem").each(function(){b[b.length]=a(this).find('input[name="uid"]').val()});d.uid=b;return d},_noticeSendMsg:function(){var b=this;return desknets.Resource.Message.creport_successNoticeSend}});desknets.page(desknets.creport,"CreportInputBase",desknets.PageInputBase,{format:desknets.form.FormEditor.prototype,_restUrl:"",mbomainpage:false,mModule:desknets.creport.MODULE_MAIN_CREPORT,mRstModule:desknets.creport.MODULE_API_CREPORT,mcmd:{cmdeditformatlist:"creportcmdeditformatlist",cmdeditformatsetsort:"creportcmdeditformatsetsort",cmdeditformatpreview:"creportcmdeditformatpreview",cmdeditformatadd:"creportcmdeditformatadd",cmdeditformatmod:"creportcmdeditformatmod",cmdeditformatdel:"creportcmdeditformatdel",cmdeditformataddattach:"creportcmdeditformataddattach",cmdeditformatdelattach:"creportcmdeditformatdelattach",editformatdispattach:"creporteditformatdispattach",editformattmpdispattach:"creporteditformattmpdispattach",cmdtmpfileaddattach:"creportcmdtmpfileaddattach",cmdtmpfiledelattach:"creportcmdtmpfiledelattach",},_initGetHtml:function(){var b=this;desknets.rte.loadRte();b.callBase("_initGetHtml")},getMultiRequest:function(){var c=this;var f={};var b=desknets.paramanalyzer.getHashParams();var e=b.id;if(!neo.isSet(e)){e=b.copyid}if(!neo.isSet(e)){e=""}b.tmpno=c.getTempName();f["0"]=b;f["1"]={cmd:c.getFormPartListCmd(),tmpno:c.getTempName(),};if(c.mbomainpage){f["2"]=c.getFormatPrm()}var d=desknets.attach.ext.getListParam();if(!!d){d.cmd=desknets.creport.getAttExtListCmd(d.cmd);if(c.mbomainpage){f["3"]=d}else{f["2"]=d}}return f},_initSet:function(d){var c=this;var b=[];if(d[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[1]["errorno"],d[1]["errormessage"]);return}if(c.mbomainpage){c._setUpFormatEditorSet(d["2"]);if(!!d&&d["3"]){desknets.attach.ext.saveList(d["3"])}}else{if(!!d&&d["2"]){desknets.attach.ext.saveList(d["2"])}}c._setTmpNm();c.$mjPage.find(".jform-input-add-submit").click(function(e){c._inputFormatSubmit(e,true)});c.$mjPage.find(".jform-input-mod-submit").click(function(e){c._inputFormatSubmit(e,false)});c.callBase("_initSet",d);c._initEditor();c._initSetCreport();if(!!d&&d["1"]){b=desknets.ajax.getJsonItems(d["1"]);c._setUpFormatEditor(b)}},_initSetCreport:function(d){var c=this;var f=c.$mjPage.find(".creport-content-chg-format");var b=c.$mjPage.find(".creport-content-chg-editor");var e=c.$mjPage.find('input[name="format_flg"]');f.click(function(g){desknets.dialog.confirm(desknets.Resource.Message.creport_confirm_format_chg,function(){setTimeout(function(){CKEDITOR.instances.ckeditor.setData("")},1000);e.val("1");c.setCreportChgHtml();if(c.boautosave){desknets.autosave.formatsave()}},{})});b.click(function(g){desknets.dialog.confirm(desknets.Resource.Message.creport_confirm_format_chg,function(){desknets.ajax.rest({url:c._getRestUrl(),data:{cmd:"creportcmdeditformattmpdel",tmpno:c.getTempName()},success:function(h){e.val("0");c.setCreportChgHtml();c._initSetCreportFormatClean();if(c.boautosave){desknets.autosave.formatsave()}}})},{})});c.setCreportChgHtml()},setCreportChgHtml:function(){var d=this;var g=d.$mjPage.find(".creport-content-chg-format");var c=d.$mjPage.find(".creport-content-chg-editor");var b=d.$mjPage.find(".creport-content-format");var e=d.$mjPage.find(".creport-content-editor");var f=d.$mjPage.find('input[name="format_flg"]');if(f.val()=="1"){g.hide();c.show();b.show();e.hide()}else{g.show();c.hide();b.hide();e.show()}},_initSetCreportFormatClean:function(){var b=this;a(".form-format-editor-inner").remove();b._setUpFormatEditor([])},_initEditor:function(){var b=this;b.borte=true;desknets.rte.init(b.$mjPage.find("#ckeditor"),{initFunc:function(){setTimeout(function(){if(typeof CKEDITOR=="object"&&!!CKEDITOR.instances.ckeditor){b.$mjPage.find("#ckeditor").val(CKEDITOR.instances.ckeditor.getData());b._inputFormSaveToObserver()}},2500)},})},_inputFormatSubmit:function(d,e){var b=this;if(b.$mjPage.find('input[name="format_flg"]').val()!="1"){b._inputFormatSubmitSetRte(d,e)}else{var c={cmd:b.mcmd.cmdeditformatsetsort,tmpno:b.getTempName(),values:b._getFormRequestParams()};desknets.ajax.rest({url:b._getRestUrl(),data:c,success:function(f){if(e){b._inputAddSubmit(d)}else{b._inputModSubmit(d)}b.$mjPage.find("form").submit()}})}},_inputFormatSubmitSetRte:function(c,d){var b=this;if(d){b._inputAddSubmit(c)}else{b._inputModSubmit(c)}desknets.rte.inputSubmitRte(c,b.$mjPage.find("form"))},_setTmpNm:function(){var b=this;b.$mjPage.find('input[name="tmpno"]').val(b.getTempName())},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.beforeSerialize=function(d,e){var f={format:b._getFormRequestParams(),};e.data=a.extend(f,e.data)};return c},_inputButton:function(){var b=this;b.callBase("_inputButton");b._inputButtonPreview()},_inputButtonPreview:function(){var b=this;b.$mjPage.find(".jform-preview").hide();b.$mjPage.find(".jform-input-preview").click(function(c){c.preventDefault();desknets.submitform.setDisabled(b.$mjPage);b._startPreview()});b.$mjPage.find(".jform-input-preview-end").click(function(c){c.preventDefault();b._endPreview()})},_getRestModule:function(){var b=this;return b.mRstModule},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()},getFormPartListCmd:function(){var b=this;return b.mcmd.cmdeditformatlist},getTempName:function(){return""},getFormatOptionsForParams:function(){var j=this;var h=desknets.paramanalyzer.getHashParams();var g=j.getTempName();var d=desknets.getUrl(j.mModule);var e=d+"?cmd="+j.mcmd.editformatdispattach;var c=d+"?cmd="+j.mcmd.editformattmpdispattach;var i=desknets.getUrl(j.mModule)+"?cmd="+j.mcmd.editformattmpdispattach+"&fno={{id}}&filename={{name}}";var f={uploadURL:j._getRestUrl(),uploadParams:{cmd:j.mcmd.cmdeditformataddattach},delURL:j._getRestUrl(),delParams:{cmd:j.mcmd.cmdeditformatdelattach},downloadURL:c+"&tmpnm={{tmpnm}}&fno={{id}}&filename={{name}}",};var b=j.gettotalSizeLimit();if(!!b){f.totalSizeLimit=Number(b)}return{attachOptions:f,paramsForSave:{tmpno:g,cmd:j.mcmd.cmdeditformatadd},paramsForRemove:{tmpno:g,cmd:j.mcmd.cmdeditformatdel},paramsForOpen:{tmpno:g,cmd:j.mcmd.cmdeditformatmod},attachDownloadURL:e+"&tmpno="+g+"&id={{id}}&fno={{fno}}&filename={{name}}"}},_setUpFormatEditor:function(d){var c=this;var b=a(c._setUpFormatEditorArea());var e=a.extend({restUrl:this._getRestUrl(),parts:d},this.getFormatOptionsForParams());this.format=new desknets.form.FormEditor(b,e)},_setUpFormatEditorSet:function(c){var b=this;if(b.mbomainpage){b.replacePreview(c.html)}},gettotalSizeLimit:function(){var b=this;return b.$mjPage.find('input[name="attach-totalSizeLimit"]').val()},_setUpFormatEditorArea:function(){return"#form-edit-format"},_getFormRequestParams:function(){var b=this;var c=[],d=b.format.getParts();a.each(d,function(g,e){if(!!e.id){var f=e.br||"0";c.push(e.id+":"+f)}});return c},replacePreview:function(d,b){var c=this;if(b!==true&&c.boautosave){desknets.autosave.formatsave()}var e=c.$mjPage.find(".form-main-view-detail-in");e.html(!!d?d:"");if(e.children().length<=0&&!e.text().match(/[^\x20]+/m)){e.html("<p>"+desknets.Resource.Message.creport_selectformat+"</p>")}else{c._initDnForm()}},_initDnForm:function(){var c=this;var e=c.$mjPage.find(".form-view-detail-in");var b=c.gettotalSizeLimit();var d=function(l){var h=l.attr("data-id");var f={cmd:c.mcmd.cmdtmpfileaddattach,id:h,tmpno:c.getTempName()};var k={cmd:c.mcmd.cmdtmpfiledelattach,id:h,tmpno:c.getTempName()};var g={cmd:c.mcmd.editformatdispattach,id:h,tmpno:c.getTempName()};var j=desknets.getUrl(desknets.creport.MODULE_MAIN_CREPORT)+"?"+a.param(g)+"&fno={{id}}&filename={{name}}";var i={uploadURL:desknets.getUrl(desknets.creport.MODULE_API_CREPORT),uploadParams:f,delURL:desknets.getUrl(desknets.creport.MODULE_API_CREPORT),delParams:k,downloadURL:j};return i};desknets.form.initForm(e,d,b)},_startPreview:function(){var c=this,e=[];if(c.$mjPage.find('input[name="format_flg"]').val()!="1"){var d=a("#jcreport-format-entry");var f=a("#creport-view-preview");var b=function(){var h=d.find(".jco-input-Name").val();var g=desknets.tmpl.escapeWord(h.replace(/ +$/g,""));var j=CKEDITOR.instances.ckeditor.getData();var i=desknets.convertToSafeHtml(j);f.find("#creport-detail-title").html(g);f.find("#creport-format-preview-body").html(i);c.$mjPage.find(".form-view-detail-in").html("");desknets.rte.readyForShow(f);c._showPreview()};desknets.rte.setEditorSourceOff(d);desknets.rte.execFuncEditorSourceEnd(d,b)}else{e.push({cmd:c.mcmd.cmdeditformatsetsort,tmpno:this.getTempName(),values:this._getFormRequestParams()});e.push({cmd:c.mcmd.cmdeditformatpreview,formType:"2",tmpno:this.getTempName()});desknets.ajax.rest({url:this._getRestUrl(),data:desknets.ajax.arrayToMultiCmdData(e),success:function(g){c._setPreview(g)},error:function(i,h,g){desknets.submitform.clearDisabled(c.$mjPage);desknets.ajax.onError(i.status,g)}})}},_setPreview:function(e){var d=this;var c="";var f=a("#jcreport-format-entry");var g=a("#creport-view-preview");var b=f.find(".jco-input-Name").val();if(!!b){c=desknets.tmpl.escapeWord(b.replace(/ +$/g,""))}g.find("#creport-detail-title").html(c);d.$mjPage.find(".form-view-detail-in").html(e["1"].html);g.find("#creport-format-preview-body").html("");d._showPreview()},_showPreview:function(){var c=this;c.$mjPage.find(".jform-editor").hide();c.$mjPage.find(".jform-preview").show();desknets.moveScroll();desknets.submitform.clearDisabled(c.$mjPage);var b=a("#form-m-title").text()+a("#jco-m-sub-title").text()+" > "+this.$mjPage.find(".jcreport-title-edit").val()+" > "+desknets.Resource.preview;a("#jco-m-sub-title").text(b)},_endPreview:function(){this.$mjPage.find(".jform-preview").hide();this.$mjPage.find(".jform-editor").show();desknets.moveScroll();this._setTitle(this._getAreaTitle(this.$mjPage))},getFormatPrm:function(){var b=this;var c={};c.cmd=b.mcmd.cmdeditformatpreview;c.formType="1";c.tmpno=b.getTempName();return c},_getRestUrl:function(){if(!this._restUrl){this._restUrl=desknets.getUrl(this._getRestModule())}return this._restUrl}});(function(b){desknets.page(desknets.creport,"creportindex",desknets.PagePaneListBase,{_folderCfg:[],_tmplTableHead:[],_tmplTableBody:[],$_elTmpls:b("#jcreport-list-table-tmpls").remove(),_arAllPageClass:["deleteable","finishable","moveable","readflag-changeable","report-recv","report-send","report-draft","report-other","dustable"],_cmdNo:null,_loginuid:null,init:function(){var c=this;c.mboHasMceEditor=true;c.callBase("init");c.$mjListPage.find(".jco-list-del-submit").unbind();c.$mjListPage.find(".jco-list-del-submit").click(function(d){c._onClickDel(d)});c.$mjListPage.find(".jco-list-check-submit").click(function(d){c._onClickCheck(d)});c.$mjListPage.find(".jco-list-read-submit").click(function(d){c._onClickRead(d)});c.$mjListPage.find(".jco-list-unread-submit").click(function(d){c._onClickUnread(d)});c.$mjListPage.find(".jco-list-finish-submit").click(function(d){c._onClickFinish(d)});c.$mjListPage.find(".jco-list-dust-submit").unbind();c.$mjListPage.find(".jco-list-dust-submit").click(function(d){c._onClickDust(d)})},changPage:function(){var c=this;c.callBase("changPage")},_isMoveListEnable:function(){if(this.$mjListPage.hasClass("moveable")==false){return false}return this.callBase("_isMoveListEnable")},_getListAjaxSuccess:function(e){var d=this;var f,c;var h=e.folder;this.$mjListPage.removeClass(this._arAllPageClass.join(" "));this.$mjListPage.addClass(this._getFolderCfg(h).pageClass.join(" "));this.$mjListPage.find(".co-actionarea>.line").each(function(j,l){var i=b(l);var k=function(){return b(this).css("display")!="none"};i.toggle(i.prevAll().filter(k).eq(0).is(":button")&&i.nextAll().filter(k).eq(0).is(":button"))});var g=this._getFolderCfg(h).listTableCssClass;this.$mjListPage.find(".co-table-list").removeClass("recv send draft other").addClass(g);f=this._getTmplTableHeadHtml(h);this.$mjListPage.find(".co-table-list thead").html(f);f=this._getTmplTableBodyHtml(h);this._mcListTemplate=f;this._resetInitWidthPrm();c=this.$mjListPage.find(".co-table-list>thead>tr>th.co-thd-handle").length>0;this.$mjListPage.find(".co-listview-listhead").toggleClass("co-chk-drag",c);this.callBase("_getListAjaxSuccess",e)},_listLine:function(e,f){var d=this;var c="";if(typeof f=="object"){var h;var g="";if(f.unread==="1"){g+="creport-tr-unread"}if(f.kind==="1"){g+=" creport-tr-myreport"}if(desknets.browser.msie8){g='"'+g+'"'}e=e.replace("{{creport-tr}}",g)}e=d.callBase("_listLine",e,f);return e},_replaceListLine:function(e,h,f){var d=this;var c;c=desknets.creport.replaceCreportListLine(e,h,f);if(c){return c}var g=d._getFolderId();if(g!=desknets.creport.RECV_FOLDER_ID&&g!=desknets.creport.SEND_FOLDER_ID&&g!=desknets.creport.DRAFT_FOLDER_ID){e=desknets.tmpl.replaceWord(e,"folder",g)}return d.callBase("_replaceListLine",e,h,f)},_initListStartModLink:function(){var c=this},_hashUpdatePageView:function(d){var c=this;if(d==desknets.creport.CMD_CREPORTSEARCHPAGE){desknets.creport.searchindex.initPage(desknets.creport.PAGE_CREPORTINDEX,"jco-m-list-container");c.mhashBackErrCmd=c.mhashBackCmd;c.mhashIdErrBack=c.mhashIdBack;c.mhashBackCmd=d;c.mhashIdBack="jco-m-search-container"}else{if(d==desknets.creport.CMD_CREPORTSEARCHDISPPAGE){desknets.creport.searchdisp.initPage(c.mhashBackCmd,c.mhashIdBack)}}},_getFolderTitleClass:function(){return"creport-title-folder"},_getSizeHideWidth:function(){return"100"},_getRestModule:function(){return desknets.creport.MODULE_API_CREPORT},_getListCmd:function(){return desknets.creport.PAGE_CREPORTINDEX},_getListExecCmd:function(){var c=this._getFolderId();if(c==desknets.creport.DRAFT_FOLDER_ID){return desknets.creport.CMD_CREPORTDRAFTINDEX}return desknets.creport.CMD_CREPORTINDEX},_getMoveListConfCmd:function(){return null},_getMoveListCmd:function(){return desknets.creport.CMD_CREPORTLISTMOVE},_getListDispCmd:function(){return desknets.creport.CMD_CREPORTDISPPAGE},_getDispPageParam:function(){var c=this._getFolderId();return{folder:c}},_getListAddCmd:function(){return desknets.creport.CMD_CREPORTENTRYPAGE},_getListModCmd:function(){return desknets.creport.CMD_CREPORTDRAFTPAGE},_getDelExecCmd:function(){return this._cmdNo},_getDelCmd:function(){if(this._cmdNo==desknets.creport.CMD_CREPORTFINISH){return desknets.creport.CMD_CREPORTFINISHCONF}return""},_getDelAddPrm:function(){if(this._cmdNo==desknets.creport.CMD_CREPORTLISTCHECK){return{}}else{if(this._cmdNo==desknets.creport.CMD_CREPORTFINISH){var e={};if(this.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){var c=this.getListParamToObj();e.lcmd=c.cmd;e.folder=this._getFolderId()}return e}else{if(this._cmdNo==desknets.creport.CMD_CREPORTLISTREAD){return{}}else{if(this._cmdNo==desknets.creport.CMD_CREPORTLISTUNREAD){return{}}else{if(this._cmdNo==desknets.creport.CMD_CREPORTDRAFTDEL){return{}}else{if(this._cmdNo==desknets.creport.CMD_CREPORTLISTDEL){var d=this._getFolderId();var e={};e.folder=d;return e}}}}}}},_setDelConfirm:function(f){if(this._cmdNo==desknets.creport.CMD_CREPORTDRAFTDEL||this._cmdNo==desknets.creport.CMD_CREPORTLISTDEL){var c=this;var d;var e=this._getFolderId();d=desknets.dialog.confirm(f,function(){c._listDel(true,d);return false});return}return this.callBase("_setDelConfirm",f)},_delNoChkMessage:function(){if(this._cmdNo==desknets.creport.CMD_CREPORTLISTCHECK){return desknets.Resource.Message.creport_check_nochecked}else{if(this._cmdNo==desknets.creport.CMD_CREPORTFINISH){return desknets.Resource.Message.creport_complete_nochecked}else{if(this._cmdNo==desknets.creport.CMD_CREPORTLISTREAD){return desknets.Resource.Message.creport_read_nochecked}else{if(this._cmdNo==desknets.creport.CMD_CREPORTLISTUNREAD){return desknets.Resource.Message.creport_unread_nochecked}else{return this.callBase("_delNoChkMessage")}}}}},_delConfMessage:function(){var d=this;var c="";if(this._cmdNo==desknets.creport.CMD_CREPORTLISTCHECK){if(d.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.creport_check_allconf}else{if(d.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){c=desknets.Resource.Message.creport_check_someconf}else{c=desknets.Resource.Message.creport_check_listconf}}return desknets.tmpl.replaceWordHtml(c,"count",d._getListCheckCount())}else{if(this._cmdNo==desknets.creport.CMD_CREPORTLISTREAD){return null}else{if(this._cmdNo==desknets.creport.CMD_CREPORTLISTUNREAD){return null}}}return this.callBase("_delConfMessage")},_getListEntryClass:function(){return desknets.creport.creportentry},_getListModClass:function(){return desknets.creport.creportentry},_getListDispClass:function(){return desknets.creport.creportdisp},_getSpliterAddOpt:function(){var c,d;c=this.callBase("_getSpliterAddOpt");d={initClosed:false};return b.extend({},c,d)},initLeftTree:function(){var c=this;desknets.creport.folderlist.init(c.$mjListPage,c._getOptionLeftTree(),c._optTreeGetCmd());c._treeClass=desknets.creport.folderlist},_optTreeInitFuncDialog:function(d,c){desknets.creport.folderdialog_entry.init(d,c);desknets.creport.folderdialog_delete.init()},_optTreeGetCmd:function(){return desknets.creport.getFolderCmd()},treeUpdateList:function(){desknets.creport.folderlist.updateTreeList()},treeUpdateListWidth:function(){desknets.creport.folderlist._updateItemsWidth()},_optTreeIsEdit:function(){return true},_optTreeSelectFunc:function(d){var c=d.data("fid");this.resetSortCondition(c);this.callBase("_optTreeSelectFunc",d)},_updateRightListWidth:function(){this.callBase("_updateRightListWidth");desknets.listviewframe.updateListScrollWidth(this.$mjListPage)},_resetInitWidthPrm:function(){var d,c;d=this.$mjListPage.find("table.co-table-list>thead").closest("table");d.css("width","auto");c=this.$mjListPage.find("table.co-table-list>thead>tr>th.jco-listview-widauto").css("width");d.css("width","");c=parseFloat(c);this._initWidthPrm.head=c;this._initWidthPrm.scroll=c},_onClickDel:function(c){var d=this._getFolderId();if(d==desknets.creport.DRAFT_FOLDER_ID){this._cmdNo=desknets.creport.CMD_CREPORTDRAFTDEL}else{this._cmdNo=desknets.creport.CMD_CREPORTLISTDEL}this._listDelSubmit(c)},_onClickFinish:function(c){this._cmdNo=desknets.creport.CMD_CREPORTFINISH;this._listDelSubmit(c)},_onClickCheck:function(c){this._cmdNo=desknets.creport.CMD_CREPORTLISTCHECK;this._listDelSubmit(c)},_onClickRead:function(c){this._cmdNo=desknets.creport.CMD_CREPORTLISTREAD;this._listDel(true,null)},_onClickUnread:function(c){this._cmdNo=desknets.creport.CMD_CREPORTLISTUNREAD;this._listDel(true,null)},_onClickDust:function(f){var d=this;var c=d.$mjListPage.find(".co-listview-tree li[data-fid="+desknets.creport.DUST_FOLDER_ID+"]");d._moveParams=d._getRequestMoveConfParams(c);d._inputMoveSubmit()},_getLoginUid:function(){if(this._loginuid==null){this._loginuid=desknets.pageframe.getLoginUid()}return this._loginuid},_getFolderId:function(){return this.$mjListPage.find(".jco-back-page-data").find(":hidden[name=folder]").val()},_getFolderCfg:function(h){if(this._folderCfg[h]){return this._folderCfg[h]}var g=null;var d=null,f=null;var c=null;var e=[];switch(String(h)){case desknets.creport.RECV_FOLDER_ID:g="recv";d="cretime";f="-1";c="jcreport-recv-list";e=["readflag-changeable","report-recv"];break;case desknets.creport.SEND_FOLDER_ID:g="send";d="entrydate";f="-1";c="jcreport-send-list";e=["moveable","dustable","finishable","report-send"];break;case desknets.creport.DRAFT_FOLDER_ID:g="draft";d="entrydate";f="-1";c="jcreport-draft-list";e=["deleteable","report-draft"];break;case desknets.creport.DUST_FOLDER_ID:g="other";d="entrydate";f="-1";c="jcreport-other-list";e=["moveable","deleteable","finishable","report-other"];break;default:g="other";d="entrydate";f="-1";c="jcreport-other-list";e=["moveable","dustable","finishable","report-other"];break}this._folderCfg[h]={listTableCssClass:g,defSortField:d,defSortOrder:f,tmplTableClass:c,pageClass:e};return this._folderCfg[h]},_getTmplTableHeadHtml:function(d){var c=this._tmplTableHead[d]||this.$_elTmpls.find("."+this._getFolderCfg(d).tmplTableClass+":first thead").html();return c},_getTmplTableBodyHtml:function(d){var c=this._tmplTableBody[d]||this.$_elTmpls.find("."+this._getFolderCfg(d).tmplTableClass+":first tbody").html();return c},resetSortCondition:function(d){var c=this._getFolderCfg(d).defSortField;var e=this._getFolderCfg(d).defSortOrder;this.$mjListPage.find(".jco-back-page-data").find(":hidden[name=fldsort]").val(c);this.$mjListPage.find(".jco-back-page-data").find(":hidden[name=order]").val(e)},_initListSetSort:function(){var c=this;c.$mjListPage.find(".co-list-sort-data").click(function(f){f.preventDefault();var e="";var d=b(this);if(d.hasClass("asc")){e=-1}else{if(d.hasClass("desc")){e=1}else{if(d.data("def")=="desc"){e=-1}else{e=1}}}c._listPageSort(d.data("sort"),e)})},banpei:null})})(jQuery);desknets.page(desknets.creport,"creportentry",desknets.creport.CreportInputBase,{_routeSelectDialog:desknets.creportutilroute,_routeUserChooser:null,initPage:function(d,c){var b=this;b.mbomainpage=true;b.callBase("initPage",d,c)},_initSet:function(c){var b=this;b.callBase("_initSet",c);desknets.creport.creportformatentry.mboInit=false;b.$mjPage.find(".jcreport-entry-main-area").show();b.$mjPage.find(".jcreport-entry-form-area").hide();b.$mjPage.find(".jcreport-preview").hide();b.$mjPage.find("#jcreport-format-edit-button").click(function(){b.$mjPage.find(".jcreport-entry-main-area").hide();b.$mjPage.find(".jcreport-entry-form-area").show();var d={autosave:false};if(b.boautosave){d.autosave=true}desknets.creport.creportformatentry.init(d)});desknets.htmlparts.setUpForm(b.$mjPage.find("#inputfrm"));b._initSubjectCombox();b._initRouteMenu();b._routeUserChooser=b._initRouteUserChooser();b._routeSelectDialog.init({onOk:a.proxy(this._onClickOkOfRouteChooserDialog,this)});b._initAttachList();if(b._idResendMode()){b.$mjPage.find("input.jco-input-mod-submit").hide()}b._setGSelectDialog();b.$mjPage.find(".jcreport-button.tmp").click(function(d){d.preventDefault();b._openAttachDialog();if(b.boautosave){desknets.autosave.save();desknets.autosave.restart()}});if(b.boautosave){b.$mjPage.find(".jcreport-attach-list").on("click",".jco-selfile-button",function(d){desknets.autosave.save();desknets.autosave.restart()})}b.$mjPage.find(".jcreport-input-confirm").click(function(f){var d=function(){b._pageConfirm()};desknets.rte.setEditorSourceOff(b.$mjPage.find("form"));desknets.rte.execFuncEditorSourceEnd(b.$mjPage.find("form"),d)});b.$mjPage.find('input[name="perm_comment"]').click(function(){b._checkboxDisable()});b._checkboxDisable();b._initWaterMark();b._initMessageArea()},_inputButtonPreview:function(){},active:function(){var c=this;desknets.submitform.clearDisabled(this.$mjPage.find("form"));this._setTitle(this._getAreaTitle(this.$mjPage));this.$mjPage.show();desknets.moveScroll();c._initBeforeUnload();var d=function(){return c.funcBeforeHashChange()};var b=a(window).data("hashobserver");if(b){b.beforeHashChangeFunc=d}},getTempName:function(){return"creportrpent"},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.beforeSerialize=function(d,e){var f={format:b._getFormRequestParams(),};if(b.$mjPage.find("input[name=cmd]").val()==b._getAddExecCmd()){if(b.$mjPage.find("[name=makename]").val()==""){f.makename=b.$mjPage.find(".co-watermark").text();b.$mjPage.find("[name=makename]").attr("disabled","disabled")}}e.data=a.extend(f,e.data)};c.success=function(f,d,g){if(b.mBackCmd==desknets.creport.CMD_CREPORTSEARCHPAGE){desknets.creport.searchindex._onSrchExec=true}if(!!f.noticeerror){var h={extraMessage:f.noticeerror,extraClass:"co-msg-r",type:"warn"};var e=desknets.dialog.alert(f.msg,h);e.bind("dialogclose",function(i){desknets.dialog.deleteById("warn");b._setLocationHashForm();desknets.creport.creportconfirm.destroy()})}else{b._setLocationHashForm();desknets.creport.creportconfirm.destroy()}};return c},_getRestModule:function(){return desknets.creport.MODULE_API_CREPORT},_getDelExecCmd:function(){return desknets.creport.CMD_CREPORTDEL},_getAddExecCmd:function(){if(this._isDraftMode()){return desknets.creport.CMD_CREPORTDRAFTSEND}else{return desknets.creport.CMD_CREPORTENTRY}},_getModExecCmd:function(){return desknets.creport.CMD_CREPORTDRAFTENTRY},_getErrorPlace:function(b){var c=this;if(b=="memo"){sMsg=desknets.Resource.creport.memo+desknets.merrMsgConnect;return sMsg}else{return c.callBase("_getErrorPlace",b)}},dispBackListPage:function(){if(this.$mjPage.is(":hidden")){this.resetFuncBeforeHashChange()}this.callBase("dispBackListPage")},active:function(){desknets.submitform.clearDisabled(this.$mjPage.find("form"));this._setTitle(this._getAreaTitle(this.$mjPage));this.$mjPage.show();desknets.moveScroll()},_isDraftMode:function(){var b=this.$mjPage.find(":hidden[name=mode]").val();return b=="draft"},_idResendMode:function(){var b=this.$mjPage.find(":hidden[name=id]").val();return b!=null&&b!=""&&!this._isDraftMode()},_initSetCreportFormatClean:function(){var b=this;b.replacePreview("",b.boautosave)},_initEditor:function(){var b=this;var c=function(){desknets.autosave.attachrtesave()};var d={pagurl:desknets.creport.MODULE_MAIN_CREPORT,resturl:desknets.creport.MODULE_API_CREPORT,dl:desknets.creport.CMD_CREPORTRTEDISPATTACH,add:"creportcmdaddrteattach",mod:"creportcmdmodrteattach",del:"creportcmddelrteattach"};if(b.boautosave){d.attachsave=c}b._mautosavestartok=false;b.borte=true;desknets.rte.init(b.$mjPage.find(".creport-rte>textarea[name=memo]"),{imgeditor:true,initFunc:function(){setTimeout(function(){if(typeof CKEDITOR=="object"&&!!CKEDITOR.instances.ckeditor){b.$mjPage.find("#ckeditor").val(CKEDITOR.instances.ckeditor.getData());b._inputFormSaveToObserver()}b._mautosavestartok=true},2500)},convertToLoad:function(e){return desknets.tmpl.replaceWordHtml(e,"cmd",b._getImageCmd())},convertToSave:function(e){var f=new RegExp("cmd="+b._getImageCmd(),"i");return e.replace(f,"cmd={{cmd}}")},rtfileopt:d,})},_getImageCmd:function(){return desknets.creport.CMD_CREPORT_RTEATTACH},_getSubjectCombo:function(){return this.$mjPage.find("#jcreport-subject-combox")},_initSubjectCombox:function(){var b=this;var d=b._getSubjectCombo();var c=d.find(".co-combox-item");if(c.length==0){d.find(".co-combox-list").hide()}var e=d.find("input");c.click(function(){var f=a(this);if(b._formObserveisChanged()){var g=desknets.Resource.Message.creport_confirm_subjectChange;desknets.dialog.confirm(g,function(){e.val(f.attr("title"));c.removeClass("on");f.addClass("on");b._ajaxFormatDetailGet(f.data("id"))},{});return}e.val(f.attr("title"));c.removeClass("on");f.addClass("on");desknets.popUp.hide(f);b._ajaxFormatDetailGet(f.data("id"))})},_ajaxFormatDetailGet:function(d){var b=this;var c={};c.cmd=desknets.creport.CMD_CREPORTENTRYFORMATINFO;c.tmpno=b.getTempName();if(d<0){c.id=(-1)*d;c.type="usr"}else{c.id=d;c.type="pub"}desknets.ajax.rest({url:desknets.getUrl(desknets.creport.MODULE_API_CREPORT),data:c,success:a.proxy(this._onLoadedFormat,this)})},_onLoadedFormat:function(c){var b=this;var d=b.$mjPage.find('input[name="format_flg"]');d.val(c.format_flg);if(b.boautosave){desknets.autosave.formatsave()}if(c.format_flg=="1"){CKEDITOR.instances.ckeditor.setData("");b.replacePreview(c.html,b.boautosave)}else{b._initSetCreportFormatClean();CKEDITOR.instances.ckeditor.setData(c.html)}b.setCreportChgHtml();b.$mjPage.find("#jcreport-route-sel-items-area").find('input[type="checkbox"]').each(function(){var e=a(this).attr("name");if(!!c[e]&&c[e]=="1"){a(this).selected(true)}else{a(this).selected(false)}});b._checkboxDisable()},_checkboxDisable:function(){var b=this.$mjPage.find('input[name="add_ntwi"]');var c=this.$mjPage.find('input[name="perm_comment"]');if(c.attr("checked")){b.attr("disabled",false)}else{b.attr("disabled",true)}},_getRouteMenu:function(){return this.$mjPage.find("#jcreport-route-sel-items-area")},_initRouteMenu:function(){var c=this;var d=this._getRouteMenu();var b=d.find(".co-select-menu");b.bind("change.selectMenu",function(f){return c._onChangeRouteMenu(f)})},_onChangeRouteMenu:function(c){var b=a(c.target);switch(b.data("value")){case"select":this._routeSelectDialog.open();break;case"edit":break;default:break}},_onClickOkOfRouteChooserDialog:function(c){var d,b=[],e=[];if(c==null){return}b=this._routeUserChooser.getItems();b=a.merge([],b);e=c.list.item;e=e==null?[]:e;e=a.isArray(e)?e:[e];a.each(e,function(g,f){for(var h=0;h<b.length;h++){if(b[h].id==f.id){return}}var k={};for(var j in desknets.chooser._displayFields){k[j]=f[j]}f.assign=neo.isSet(f.assigngrp)?desknets.chooser.convertAssignedGroups(f.assigngrp.Name):"";k.assign=f.assign;f.description=desknets.chooser.convertUserDescription(k);b.push({id:f.id,type:"user",name:f.Name,summary:neo.isSet(f.assigngrp)?desknets.chooser.convertAssignedGroups(f.assigngrp.Name):"",description:neo.isSet(f.description)?f.description:""})});b=desknets.chooser.Entry.sortLoginUserTop(b);this._routeUserChooser.replaceItems(b)},_initRouteUserChooser:function(){var c=this;var d;var f=this.$mjPage.find("#jcreport-route-sel-items-area");var e={chooseTarget:["user"],allGroup:"choosable",choosePrivateGroup:"choosable",unassignGroup:"choosable"};var b=desknets.chooser.getItemsFromElement(f);d=desknets.chooser.setUpEntry(f,b,{filter:function(g,h){g=desknets.chooser.Entry.sortLoginUserTop(g);h(g);return false},dialogID:"jcreport-route-user-sel",initCreate:true,dialogOptions:e,extraVars:{user:{keyName:"routeid"}}});return d},_getSelectedItems:function(){var c=this;var b=[];var d="";this.$mjPage.find(".jco-sel-items").children().each(function(){var e=a(this);d="user";b.push({id:e.find(":hidden[name=routeid]").val(),type:d,name:e.find(".co-selitem-text").text(),description:e.find(".co-sel-description").html()})});return b},_findRouteElementOf:function(b){return this.$mjPage.find(".jco-sel-items :hidden[name=routeid][value="+b+"]").closest(".co-selitem")},_setGSelectDialog:function(){var b=this;var c={mode:"single",selectable:false,chooseTarget:["group"]};desknets.chooser.setUpEntry(a("#creport-selgrp-area"),[],{dialogID:"jcreport-group-sel",initCreate:true,dialogOptions:c,filter:function(d){b.$mjPage.find(".jco-input-makename").val(d[0]["name"]).blur()}})},_initWaterMark:function(){var b=this;var c=b.$mjPage.find(".jco-input-makename");var d=b.$mjPage.find(".jcreport-defmakename").val();c.attr("title",d);desknets.watermark.set(c);c.removeAttr("title")},_initMessageArea:function(){var m=this;var h=m.$mjPage.find(".creport-edit-msgarea");var j=[];var e=[];var d="";var c=desknets.Resource.Message;a.each(h.find("input.jcreport-edit-msguser"),function(p,r){var o=a(this);var q=o.data("type");if(q=="suspension"){j.push(o)}else{if(q=="delete"){e.push(o)}}});if(j.length>0){d=c.creport_edit_suspensionuser+'<br /><ul class="creport-edit-delmsg">';for(var f=0;f<j.length;f++){d=d+"<li>"+desknets.tmpl.escapeWord(j[f].val())+"</li>"}d=d+"</ul>"}if(e.length>0){d=d+c.creport_edit_deleteuser+'<br /><ul class="creport-edit-delmsg">';for(var f=0;f<e.length;f++){d=d+"<li>"+desknets.tmpl.escapeWord(e[f].val())+"</li>"}d=d+"</ul>"}if(d.length!=""){var k="";var b=m.$mjPage.find(".jco-topmsgid").val();if(b){b=b.split(",");for(var l=0;l<b.length;l++){var g=desknets.Resource.Message[b[l]];var n=desknets.parseErrorInfo(g);if(k!=""){k+="<br />"}k=k+n.message}}if(k!=""){k=k+"<br />"+d}else{k=d}desknets.pageframe.viewTopMsg(k,"info")}h.empty()},_getAttachListElement:function(){return this.$mjPage.find(".jcreport-attach-list")},_getAttachFiles:function(){return this._getAttachListElement().data("dnAttachList").options.files},_initAttachList:function(j){var g=[],i=null,f=null;i=this._getAttachListElement();f=i.closest(".jcreport-row-attaches");g=[];var d,b={};d=desknets.getUrl(desknets.creport.MODULE_API_CREPORT);b.cmd=desknets.creport.CMD_CREPORTADDATTACH;var e,c={};e=desknets.getUrl(desknets.creport.MODULE_API_CREPORT);c.cmd=desknets.creport.CMD_CREPORTDELATTACH;var l,k={};k.cmd=desknets.creport.CMD_CREPORTREFATTACHWK;l=desknets.getUrl(desknets.creport.MODULE_MAIN_CREPORT)+"?"+a.param(k)+"&fno={{id}}";var h={files:g,hideElementOnEmpty:f,uploadURL:d,uploadParams:b,delURL:e,delParams:c,downloadURL:l,};if(this.boautosave){h.toggleTargetFunc=function(){desknets.autosave.attachsave()}}i.dnAttachList(h)},_openAttachDialog:function(){this._getAttachListElement().dnAttachList("openChooser")},_pageConfirm:function(){var b=this;b.$mjPage.find(".creport-rte>textarea[name=memo]").val(desknets.rte.getEditorData("ckeditor"));this._ajaxConfirmTmplGet()},_ajaxConfirmTmplGet:function(){var c=this;var b=c.$mjPage.find("#inputfrm");b.formSetUp("validate");if(b.find(".ui-invalid").length>0){return}var e=b.find(".jco-input-makename").val();if(!neo.isSet(e,{blank:false})){e=b.find(".co-watermark").text()}var f=b.formToArrayEx();f.cmd=desknets.creport.CMD_CREPORTCONFIRMPAGE;if(this._isDraftMode()){delete f.id}f.makename=e;var d=this._inputAjaxFormOption();a.extend(d,{dataType:desknets.ajax.RESTYPE_JSON,url:desknets.getUrl(this._getRestModule()),data:f,success:function(h,g,i){if(h.status=="ok"){c._buildConfirmPage(h,f)}else{desknets.dialog.alert(h.errormessage,{type:"warn"})}},complete:function(i,g,h){}});desknets.ajax.rest(d)},_buildConfirmPage:function(d,c){var b=this;c.routes=[];a.each(this.$mjPage.find("#jcreport-route-sel-items-area .co-selitem-text"),function(e,f){c.routes.push({uname:a(f).text()})});c.attachs=this._getAttachFiles();this.$mjPage.hide();desknets.creport.creportconfirm.init({tmpl:d.html,json:d,data:c,ok:function(g){var f=b.$mjPage.find("#inputfrm");f.find(":hidden[name=cmd]").val(b._getAddExecCmd());f.find(".jco-input-makename").val(c.makename);f.submit()},cancel:function(f){desknets.creport.creportconfirm.destroy();b.active()}})},AutoSaveOpt:function(c){var b=this;var e=desknets.paramanalyzer.getHashParams();var d=b.callBase("AutoSaveOpt",c);d.module="creport";if(e.cmd==desknets.creport.CMD_CREPORTDRAFTPAGE){d.mod=false}if(e.copy=="1"){d.mod=false}d.attachname="crentatt";d.rtename="crentrteatt";d.format=b.getTempName();return d},AutoSaveChkConfirm:function(f,c){var b=this;var e=desknets.paramanalyzer.getHashParams();var d=null;if(e.copy=="1"||e.link=="1"){desknets.autosave.del();desknets.autosave.start()}else{if(e.cmd==desknets.creport.CMD_CREPORTDRAFTPAGE){if(e.id==f.id){d=b.AutoSaveChkConfirmAdd(f,c)}else{desknets.autosave.del();desknets.autosave.start()}}else{if(!e.id){if(f.id=="0"){d=b.AutoSaveChkConfirmAdd(f,c)}else{desknets.autosave.del();desknets.autosave.start()}}else{d=b.AutoSaveChkConfirmMod(f,c)}}}if(d!=null){b.AutoSaveDialogLock(d)}},AutoSaveEntry:function(e){var d=this;e=d.callBase("AutoSaveEntry",e);if(typeof CKEDITOR=="object"&&!!CKEDITOR.instances.ckeditor){e.memo=CKEDITOR.instances.ckeditor.getData()}var c=d._routeUserChooser.getItems();if(!c){c=[]}else{if(!a.isArray(c)){c=[c]}}var b=[];var f=[];a.each(c,function(g,h){b[b.length]=h.name;f[f.length]=h.description});e.routeidname=b;e.routeiddes=f;return e},AutoSaveGetData:function(e){var c=this;c.$mjPage.find('input[name="format_flg"]').val(e.format_flg);c.setCreportChgHtml();c.$mjPage.find('input[name="subject"]').val(e.subject);c.$mjPage.find('select[name="important"]').val(e.important);e.routeid=c.arrayToData(e.routeid);e.routeidname=c.arrayToData(e.routeidname);e.routeiddes=c.arrayToData(e.routeiddes);var b=[];a.each(e.routeid,function(f,g){b.push({id:g,type:"user",name:e.routeidname[f],description:e.routeiddes[f]})});c._routeUserChooser.replaceItems(b);if(!!e.perm_comment){c.$mjPage.find('input[name="perm_comment"]').attr("checked",true)}else{c.$mjPage.find('input[name="perm_comment"]').attr("checked",false)}if(!!e.add_ntwi){c.$mjPage.find('input[name="add_ntwi"]').attr("checked",true)}else{c.$mjPage.find('input[name="add_ntwi"]').attr("checked",false)}c._checkboxDisable();c.$mjPage.find('input[name="makename"]').val(e.makename).blur();if(!!e.period){c.$mjPage.find(".jco-input-period").datepicker("setDate",neo.dateTime.parse(e.period.replace(/\u002D/g,"")))}else{c.$mjPage.find(".jco-input-period").datepicker("setDate","")}if(e.format_flg!="1"){var d=setInterval(function(){if(a(".cke_button.cke_button__table.cke_button_disabled").length==0){desknets.rte.setEditorData(CKEDITOR.instances.ckeditor,e.memo);clearInterval(d)}},200)}else{desknets.ajax.rest({url:c._getRestUrl(),data:c.getFormatPrm(),success:function(f){c.replacePreview(f.html)}})}},AutoSaveGetAttData:function(c){var b=this;b._getAttachListElement().dnAttachList("updateFile",c)},_inputButtonPreview:function(){var b=this},_getConnectToModuleName:function(){return"creport"},_setConnectData:function(b){var e=this;var c=[];var g={};var d={};e.$mjPage.find('input[name="subject"]').val(b.title);var f=b.content||"";if(!!b.rteatt&&!!b.rteatt.attach&&!!b.rteatt.attach.item){c=b.rteatt.attach.item;if(!a.isArray(c)){c=[c]}d.content=f;d.module=desknets.creport.MODULE_MAIN_CREPORT;d.cmd=desknets.creport.CMD_CREPORTRTEDISPATTACH;d.arAttach=b.rteatt.attach.item;f=desknets.rtfile.replaceDownloadUrlforConnectApp(d)}g.content=f;var h=function(){e.AutoSaveGetRteData(c)};g.funcSetAtt=h;desknets.rte.setDataForConnectApp(g)},_inputAddSubmit:function(c){var b=this;b.callBase("_inputAddSubmit",c);desknets.rte.inputSubmitRte(c,b.$mjPage.find("form"))},_inputModSubmit:function(c){var b=this;b.callBase("_inputModSubmit",c);desknets.rte.inputSubmitRte(c,b.$mjPage.find("form"))},banpei:null});(function(b){desknets.page(desknets.creport,"creportconfirm",null,{_$page:null,_options:{tmpl:null,data:null,ok:function(c){},cancel:function(c){}},options:{},init:function(c){this.destroy();this.options=b.extend({},this._options,c);this._$page=b("#jcreport-m-confirm-page");this._buildPage(this.options.tmpl,this.options.data,this.options.json)},destroy:function(){if(this._$page){this._$page.empty().unbind()}this._$page=null;this.options={}},_buildPage:function(j,e,l){var m=this;$page=this._$page;var k=e.attachs;var h=[];for(var f=0;f<k.length;f++){var c={};c.id=k[f].fno;c.size=k[f].size;c.attachdisp=k[f].attachdisp;h.push(c)}k.item=h;e.attachs=k;b(j).tmpl(e).appendTo($page);b("#jco-m-sub-title").text($page.find(".jco-title").val());$page.find(":button.jcreport-ok").click(function(i){if(m.options.ok){m.options.ok(i)}});$page.find(":button.jcreport-cancel").click(function(i){if(m.options.cancel){m.options.cancel(i)}});var d=$page.find(".form-format-preview");var g=$page.find(".co-mceview");if(!!l.formathtml){d.show();g.hide();d.html(l.formathtml)}else{d.hide();g.show()}desknets.rte.readyForShow($page.find("#creport-view-detail"));$page.show()},getCreportAttachDownloadParams:function(){var c={};c={cmd:desknets.creport.CMD_CREPORTREFATTACHWK};return c},banpei:null})})(jQuery);desknets.page(desknets.creport,"creportformatentry",desknets.creport.CreportInputBase,{mboInit:false,$mjMain:null,init:function(g){var c=this;c.boautosave=g.autosave;if(c.mboInit==false){c.mboInit=true;c.initGetPageId();c._initSet()}var i={};var d={};var f={};var b=c.$mjMain.find("#inputfrm");f=b.formToArrayEx();f.cmd="creportcmdeditformatsaveinput";f.tmpno=c.getTempNameEntry();var h={};h.cmd="creportcmdeditformatcopytemp";h.tmpno=c.getTempName();h.tmpfrom=c.getTempNameEntry();h.tmpto=c.getTempName();var e={};e.cmd="creportcmdeditformatlist";e.tmpno=c.getTempName();d["0"]=f;d["1"]=h;d["2"]=e;i.success=function(j){if(j[0]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(j[0]["errorno"],j[0]["errormessage"])}else{if(j[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(j[1]["errorno"],j[1]["errormessage"])}else{if(j[2]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(j[1]["errorno"],j[2]["errormessage"])}else{if(c.boautosave){desknets.autosave.formatsave()}c._initSetCreport(j)}}}};c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,d,i)},initGetPageId:function(){var b=this;b.$mjPage=a(".jcreport-entry-form-area");b.$mjMain=a(".jcreport-entry-main-area")},_initSet:function(){var b=this;desknets.moveScroll();b._initPageEnterKeysSubmitFormCancel();b._inputButton()},_initSetCreport:function(e){var d=this;var c=d.$mjPage.find(".co-setarea");c.empty();d.$mjPage.find(".jcreport-tmpl-preview-format").tmpl({}).appendTo(c);var b=[];if(!!e&&e["2"]){b=desknets.ajax.getJsonItems(e["2"])}d._setUpFormatEditor(b)},_inputButton:function(){var b=this;b.callBase("_inputButton");b.$mjPage.find(".jcreport-input-edit-ok").click(function(){desknets.creport.creportentry.boformChanged=true;desknets.submitform.setDisabled(b.$mjPage);b.setUpEntryPage()});b.$mjPage.find(".jcreport-input-edit-cal").click(function(){b.$mjMain.show();b.$mjPage.hide()})},setUpEntryPage:function(e){var c=this;var g={};var d={};var b={};b.cmd="creportcmdeditformatsetsort";b.tmpno=c.getTempName();b.values=c._getFormRequestParams();var f={};f.cmd="creportcmdeditformatsave";f.tmpno=c.getTempName();f.tmpfrom=c.getTempName();f.tmpto=c.getTempNameEntry();d["0"]=b;d["1"]=f;d["2"]=desknets.creport.creportentry.getFormatPrm();g.success=function(h){if(h[0]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(h[0]["errorno"],h[0]["errormessage"])}else{if(h[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(h[1]["errorno"],h[1]["errormessage"])}else{if(h[2]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(h[2]["errorno"],h[2]["errormessage"])}else{desknets.creport.creportentry.replacePreview(h[2]["html"]);c.$mjMain.show();c.$mjPage.hide()}}}desknets.submitform.clearDisabled(c.$mjPage)};g.error=function(j,i,h){desknets.submitform.clearDisabled(c.$mjPage);desknets.ajax.onError(j.status,h)};c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,d,g)},_startPreview:function(){var b=this,c=[];c.push({cmd:b.mcmd.cmdeditformatsetsort,tmpno:this.getTempName(),values:this._getFormRequestParams()});c.push({cmd:b.mcmd.cmdeditformatpreview,formType:"2",tmpno:this.getTempName()});desknets.ajax.rest({url:this._getRestUrl(),data:desknets.ajax.arrayToMultiCmdData(c),success:function(d){b._setPreview(d)},error:function(f,e,d){desknets.submitform.clearDisabled(b.$mjPage);desknets.ajax.onError(f.status,d)}})},getTempName:function(){return"creportupdent"},getTempNameEntry:function(){return desknets.creport.creportentry.getTempName()},gettotalSizeLimit:function(){var b=this;return b.$mjMain.find('input[name="attach-totalSizeLimit"]').val()},});(function(b){desknets.page(desknets.creport,"creportdisp",desknets.PagePaneDispBase,{_initGetHtml:function(){this._getDispComponent().init({"$page":this.$mjPage,onCreate:b.proxy(function(){this._initSet()},this),onResize:b.proxy(function(){this._setListviewHeight(this.$mjPage)},this),onExit:b.proxy(function(){this.dispBackListPage()},this),onEditorStart:b.proxy(this._onEditorStart,this),onEditorEnd:b.proxy(this._onEditorEnd,this),search:false,manage:false})},_initSet:function(f){var d=this;this.$_editorForm=null;var e=[];e[e.length++]='<div class="co-listview co-list-selfolder selmulti">';e[e.length++]='  <div class="co-listview-left ui-layout-west"><!-- 左ペイン --></div>';e[e.length++]='  <div class="co-listview-list ui-layout-center"><!-- 右ペイン --></div>';e[e.length++]="</div>";d.$mjPage.find(".jco-disp-disparea").append(b(e.join("")));var c=d.$mjPage.find(".co-listview-list.ui-layout-center");d.$mjPage.find(".jco-disp-disparea").children(":not(:last)").appendTo(c);b("#jco-m-disp-page").find(".ui-layout-west").html(b("#jco-m-list-container").find(".ui-layout-west").html());b("#jco-m-disp-page").find(".co-listview-left-subtitle, .jco-listview-pop").remove();d.initLeftTree();this.callBase("_initSet",null)},initLeftTree:function(){var c=b.extend({},desknets.folderdisp);this._treeClass=c;c.init(this.$mjPage,this._getOptionLeftTree(),this._optTreeGetCmd())},_optTreeSelectFunc:function(d){var c=d.data("fid");desknets.creport.creportindex.resetSortCondition(c);this.callBase("_optTreeSelectFunc",d)},_getSpliterAddOpt:function(){return{initClosed:true}},_optTreeGetCmd:function(){return desknets.creport.getFolderCmd()},_getRestModule:function(){return desknets.creport.MODULE_API_CREPORT},_getDispExecCmd:function(){return desknets.creport.CMD_CREPORTDISP},_initDispLeftPane:function(){desknets.creport.creportfolderdisp.init()},_getDispComponent:function(){return desknets.creport.creportdispCompo},$_editorForm:null,_formObserveisChanged:function(){return !!this.$_editorForm&&!!this._formObserve_isChanged(this.$_editorForm)},_onEditorStart:function(c){this.$_editorForm=c.find("form");this._defFormVals={};this._formObserveSave(this.$_editorForm,this._defFormVals)},_onEditorEnd:function(c){this.$_editorForm=null;this._defFormVals={}},banpein:null})})(jQuery);(function(b){desknets.page(desknets.creport,"creportdispCompo",null,{nUncheckedListPerPage:5,nUncheckedListNum:desknets.creport.MAXNUM,mcabtmpl:"creport.html",nSequence:0,loginUid:null,_options:{$page:null,onCreate:function(){},onResize:function(){},onUpdData:function(){},onExit:function(){},search:false,manage:false},options:{},_data:{creport:{id:null,rev:null,sts:null,entryid:null,ichecked:0,perm_comment:1,progress:-1,fid:null},tos:{allcnt:0,row:0,uids:[]},uncheckedTos:{uids:[]},toMap:{}},data:null,$tosTmpl:null,$uncheckedTosTmpl:null,$commentEditorTmpl:null,$commentViewTmpl:null,$tos:null,$tosTBody:null,$tosReloadBtn:null,$tosPager:null,$tosFilter:null,$tosAllToggle:null,$uncheckedTos:null,$uncheckedTosCnt:null,$uncheckedTosTBody:null,init:function(d){this.destroy();this.options=b.extend({},this._options,d);this.$mjPage=this.options["$page"];this.data=b.extend({},this._data);var c=this.getMultiRequest();var e=null;c=desknets.ajax.arrayToMultiCmdData(c);e=b.proxy(function(i,g,j){this._initSet(i);var h=this.options.onCreate;if(h){h()}setTimeout(b.proxy(function(f){this._updateListviewHeight()},this),0);if(i[0].format_flg=="1"){this.$mjPage.find(".creport-disp-body").addClass("form-view-detail-in").addClass("form-format-preview").removeClass("co-mceview")}else{this.$mjPage.find(".creport-disp-body").addClass("co-mceview").removeClass("form-view-detail-in").removeClass("form-format-preview")}},this);desknets.ajax.rest({detectMultiError:true,url:desknets.getUrl(this._getRestModule()),data:c,success:function(g,f,h){if(e){e(g,f,h)}},complete:function(h,f,g){}})},destroy:function(){if(this.options["$page"]){this.options["$page"].empty().unbind()}b("#"+this._dialogId).remove();this.nSequence=0;this.loginUid=null;this.data=null;this.$tosTmpl=null;this.$uncheckedTosTmpl=null;this.$commentEditorTmpl=null;this.$commentViewTmpl=null;this.$tos=null;this.$tosTBody=null;this.$tosReloadBtn=null;this.$tosPager=null;this.$tosFilter=null;this.$tosAllToggle=null;this.$uncheckedTos=null;this.$uncheckedTosCnt=null;this.$uncheckedTosTBody=null;this.options={}},isManageMode:function(){return this.options.manage},isSearchMode:function(){return this.options.search},_createObjectId:function(){return ++this.nSequence},_getLoginUid:function(){return this.loginUid||(this.loginUid=desknets.pageframe.getLoginUid())},_getResultsPerPage:function(){return this.$mjPage.find("input[name=num]").val()},_getCreportId:function(){return this.data.creport["id"]},_getAuthorUid:function(){return this.data.creport["entryid"]},_isFinishedCreport:function(){return this.data.creport["sts"]=="4"||this.data.creport["sts"]=="6"},_isICheckedCreport:function(){return this.data.creport["ichecked"]=="1"},_getFolderId:function(){if(!this.data.creport["fid"]){return desknets.creport.RECV_FOLDER_ID}if(this.data.creport["fid"]=="0"){return desknets.creport.MY_ROOT_FOLDER_ID}return this.data.creport["fid"]},_isPermComment:function(){return this.data.creport["perm_comment"]=="1"},_isAbleToSendNotice:function(){if(desknets.pageframe.isShownMenu("memo")||desknets.pageframe.getMailUse()=="1"){if(this.data.creport["progress"]=="0"||this.data.creport["progress"]=="2"){return !this.isManageMode()&&!this._isFinishedCreport()&&this._getFolderId()!=desknets.creport.DUST_FOLDER_ID&&this._getAuthorUid()==this._getLoginUid()}}return false},_isShowCopyConfirmDialog:function(){if(this._getAuthorUid()==this._getLoginUid()){return this.data.creport["progress"]=="0"}return false},_getUncheckedCount:function(){return this.data.uncheckedTos["uids"].length},_filterNewComments:function(e){var d=this._getRevision();var c=desknets.creport.filterNewComments(d,e);return c},_filterOldComments:function(e){var d=this._getRevision();var c=desknets.creport.filterOldComments(d,e);return c},_getRevision:function(){return this.data.creport["rev"]},_setCreportData:function(d){var c=this.data.creport;for(var e in c){c[e]=d[e]}if(!!d.memo){d.memo=desknets.tmpl.replaceWordHtml(d.memo,"cmd",this._getImageCmd());d.memo=desknets.rte.convertForShow(d.memo)}},_normalizeToData:function(d){if(d.comments==null){d.comments=[]}else{if(!b.isArray(d.comments)){d.comments=[d.comments]}for(var c=0;c<d.comments.length;c++){this._normalizeCommentData(d.comments[c])}}},_normalizeCommentData:function(d){if(d.attach==null){d.attach={item:[]}}else{var c=d.attach;if(!b.isArray(c.item)){c.item=[c.item]}}},_clrTos:function(){var f=this.data;var c={};for(var e=0;e<f.uncheckedTos["uids"].length;e++){var d=f.uncheckedTos["uids"][e];c[d]=f.toMap[d]}f.toMap=c;f.tos["allcnt"]=0;f.tos["row"]=0;f.tos["uids"]=[]},_setTos:function(f){var d=this;var e=this.data;var c;c=f.list["item"];if(c==null){c=[]}else{if(!b.isArray(c)){c=[c]}}e.tos["allcnt"]=f.allcnt;e.tos["row"]=f.row;b.each(c,function(h,j){var g=j.uid;e.tos["uids"].push(g);d._normalizeToData(j);e.toMap[g]=j})},_clrUncheckedTos:function(){var f=this.data;var c={};for(var e=0;e<f.tos["uids"].length;e++){var d=f.tos["uids"][e];c[d]=f.toMap[d]}f.toMap=c;f.uncheckedTos["uids"]=[]},_setUncheckedTos:function(f){var d=this;var e=this.data;var c;c=f.list["item"];if(c==null){c=[]}else{if(!b.isArray(c)){c=[c]}}b.each(c,function(h,j){var g=j.uid;e.uncheckedTos["uids"].push(g);d._normalizeToData(j);e.toMap[g]=j})},_setComment:function(c){var e=-1;this._normalizeCommentData(c);var f=c.uid;var h=c.id;var d=this.data.toMap[f];if(d==null){return}var g=d.comments;e=this._findCommentData(h,g);if(e!=-1){g[e]=c}else{g.push(c)}},_getCommentKey:function(c){var f=this._getCreportId();var d=c.closest("tr").find("[name=routeid]").val();var e=c.find("[name=commentid]").val();return{id:f,rid:d,nid:e}},_findCommentData:function(e,c){var d=-1;b.each(c,function(f,g){if(g.id==e){d=f;return false}});return d},_removeUncheckedTo:function(e){var c=-1;var f=this.data.uncheckedTos["uids"];for(var d=0;d<f.length;d++){if(f[d]==e){c=d;break}}if(c!=-1){f.splice(c,1)}this.$uncheckedTosTBody.find("input[name=routeid][value="+e+"]").closest("tr").remove();this._updateUncheckedTosTable();this._updateListviewHeight()},_pageOfTos:function(d){var c=this;var e=this._getResultsPerPage();var f=desknets.paramanalyzer.getHashParams();f.row=(d-1)*e;desknets.hashobserver.stopObserveHash();desknets.paramanalyzer.setLocationHash(f);setTimeout(function(g){desknets.hashobserver.startObserveHash()},100);c._ajaxGetTos(f.row)},_getTmplOptions:function(){var c={getLoginUid:b.proxy(this._getLoginUid,this),getCreportId:b.proxy(this._getCreportId,this),getAuthorUid:b.proxy(this._getAuthorUid,this),getRevision:b.proxy(this._getRevision,this),filterNewComments:b.proxy(this._filterNewComments,this),filterOldComments:b.proxy(this._filterOldComments,this),isFinishedCreport:b.proxy(this._isFinishedCreport,this),isICheckedCreport:b.proxy(this._isICheckedCreport,this),isManageMode:b.proxy(this.isManageMode,this),isSearchMode:b.proxy(this.isSearchMode,this),isPermComment:b.proxy(this._isPermComment,this),isAbleToSendNotice:b.proxy(this._isAbleToSendNotice,this),setConfTime:b.proxy(this._setConfTime,this)};c.options=c;return c},_setConfTime:function(e,c){var d="";if(!!c){d=c}return b.extend({},e,{conftime:d})},_replaceBrToLf:function(c){c=b.trim(c).replace(/(<br>|<br\x20\x2f>)/ig,"\n");return c},_commentEditorRestor:function(d){d.children(":not(.jcreport-editor-restore)").remove();d.children(".jcreport-editor-restore").children().unwrap();d.removeClass("comment-editing");if(d.length!=0){var c=this.options.onEditorEnd;if(!!c){c(d)}}},_commentEditorCommit:function(j,g){var c,i;this._normalizeCommentData(g.comments);this._setComment(g.comments);this._commentEditorRestor(j);var f=this._getTmplOptions();var h=this.$commentViewTmpl.tmpl(g.comments,f);desknets.htmlparts.convertHrefInText(h.find("pre.creport-comment-text"));c=g.comments["uid"];i=j.closest("table").hasClass("creport-unchecked-tos");if(j.hasClass("creport-comment")){j.replaceWith(h);this._updateComments(h.closest(".creport-comments"))}else{var e,d;if(i){this._removeUncheckedTo(g.comments["uid"]);e=this.$mjPage.find("table.creport-tos-table :hidden[name=routeid][value="+c+"]").closest("tr").find(".creport-comments").eq(0)}else{d=j.closest("tr");d.find(".creport-checked").remove();e=d.find(".creport-comments").eq(0)}h.appendTo(e);this._updateComments(e)}this._updateMyComment(true);this._updateListviewHeight()},_commentEditorEditing:function(d){var j=d.find("[name=commentid]").val();var h="";if(desknets.browser.msie8){var f=d.find(".creport-comment-text");if(f.length>0){h=f[0].innerText;h=h.replace(/(<br>|<br\x20\x2f>)/ig,"")}}else{h=d.find(".creport-comment-text").text()}var g=d.hasClass("secret");d.children().wrapAll("<div style=display:none class='jcreport-editor-restore'>");var c={};c.type=j?"mod":"add";c.memo=h;c.objectid=this._createObjectId();c.secret=g;this.$commentEditorTmpl.tmpl(c).appendTo(d);d.addClass("comment-editing");var i=d.find(".jcreport-attach-list");this._initAttachList(i);this._updateListviewHeight();var e=this.options.onEditorStart;if(!!e){e(d)}},_initAttachList:function(k){var i=[];var e=k.closest(".comment-editable");var p=this._getCommentKey(e);var h=null;if(p.nid){var n=this.data.toMap[p.rid];var j=this._findCommentData(p.nid,n.comments);if(j!=-1&&n.comments[j].attach){var m=n.comments[j].attach.item;if(!b.isArray(m)){m=[m]}b.each(m,function(q,r){var s={};s.attachdisp=r.attachdisp;s.fno=r.id;s.size=parseInt(r.size,10);i.push(s)})}}var f,c={};f=desknets.getUrl(desknets.creport.MODULE_API_CREPORT);c.cmd=desknets.creport.CMD_CREPORTCOMMENTATTACHADD;var g,d={};g=desknets.getUrl(desknets.creport.MODULE_API_CREPORT);d.cmd=desknets.creport.CMD_CREPORTCOMMENTATTACHDEL;var o,l={};l.cmd=desknets.creport.CMD_CREPORTCOMMENTATTACHREFWK;l.id=p.id;l.rid=p.rid;l.nid=p.nid;o=desknets.getUrl(desknets.creport.MODULE_MAIN_CREPORT)+"?"+b.param(l)+"&fno={{id}}";k.dnAttachList({files:i,hideElementOnEmpty:h,uploadURL:f,uploadParams:c,delURL:g,delParams:d,downloadURL:o,toggleTargetFunc:b.proxy(function(){this._updateListviewHeight()},this)})},_updateTosPager:function(e,f){var c=this;var d=this._getResultsPerPage();desknets.Pager.output(this.$tosPager,".jco-pager",{getCount:Math.min(f-e,d),allCount:f,pageMaxView:d,startRow:e,clickFunc:function(g){c._pageOfTos((g/d)+1)}})},_updateUncheckedCount:function(){var c=this;var d=0;c.$uncheckedTos.find(".creport-unchecked-tos tr").each(function(){var i=b(this);var f=i.find(".creport-comment-noconfcmt.otherto");var h=null;f.each(function(){var k=b(this);var j=k.data("updtime");if(!!j&&(h==null||j>h.data("updtime"))){h=k}});if(h!=null){h.addClass("last-noconfcmt")}var e=f.length;d=d+e;if(e>1){var g=desknets.tmpl.replaceWordHtml(desknets.Resource.creport.othercount,"count",e-1);i.find(".creport-comment-noconfcmt-count").html(g)}else{i.find(".creport-comment-noconfcmt-count").html("")}});c.$uncheckedTosCnt.text(d)},_updateUncheckedTosTable:function(){var j=this._getTmplOptions();var f=this.data.uncheckedTos["uids"];var c=this.$uncheckedTosTBody.find("tr").length;var l=Math.min(this.nUncheckedListPerPage-c,f.length);if(l>0){var d=[];f=f.slice(c,c+l);for(var e=0;e<f.length;e++){var g=f[e];d.push(this.data.toMap[g])}var h=this.$uncheckedTosTmpl.tmpl(d,j);h.appendTo(this.$uncheckedTosTBody);desknets.htmlparts.convertHrefInText(h.find("pre.creport-comment-text"));var k=this.$uncheckedTosTBody.find(".creport-comments");this._updateComments(k)}this._updateUncheckedCount()},_updateTosTable:function(){var j=this._getTmplOptions();var f=this.data.tos["allcnt"];var l=this.data.tos["row"];var g=this.data.tos["uids"];var c=desknets.paramanalyzer.getHashParam("filter");this.$tosFilter.val(c);if(g.length<=0){this.$tos.find(".co-table-list").hide();this.$tos.find(".co-nodata").show();this.$tosTBody.empty()}else{this.$tos.find(".co-table-list").show();this.$tos.find(".co-nodata").hide();var d=[];for(var e=0;e<g.length;e++){var h=g[e];d.push(this.data.toMap[h])}this.$tosTmpl.tmpl(d,j).appendTo(this.$tosTBody);desknets.htmlparts.convertHrefInText(this.$tosTBody.find("pre.creport-comment-text"));var k=this.$tosTBody.find(".creport-comments");this._updateComments(k);this._updateMyComment(false)}this.$tosReloadBtn.removeClass("on");this._updateTosPager(l,f)},_updateComments:function(c){b.each(c,function(f,g){var e=b(g);var d=e.children(".creport-comment").length<2;e.toggleClass("unexpandable",d)});b.each(c,function(e,f){var d=b(f);d.children(".creport-comment.last-child").removeClass("last-child");d.children(".creport-comment:last").addClass("last-child")})},_updateMyComment:function(h){var c=this;var g=c.$tosTBody.find(".creport-tr-myline .creport-comments");var i=g.find(".creport-comment-noconfcmt.author");g.find(".last-view").removeClass("last-view");var f=null;if(!h){i.each(function(){var k=b(this);var j=k.data("updtime");if(!!j&&(f==null||j>f.data("updtime"))){f=k}})}if(f!=null){f.addClass("last-view")}else{g.find(".last-child").addClass("last-view")}var d=i.length;if(d>1){var e=desknets.tmpl.replaceWordHtml(desknets.Resource.creport.othercount,"count",d-1);g.find(".creport-comment-noconfcmt-count").html(e)}else{g.find(".creport-comment-noconfcmt-count").html("")}},_showButtons:function(){var f={};var d=[];var g=desknets.paramanalyzer.getHashParams()["folder"];f[".jco-input-copy"]=this._isShowCopyBtn();f[".jco-input-resend"]=this._isShowResendBtn();f[".jcreport-del-button"]=this._isShowDelBtn();f[".jcreport-dust-button"]=this._isShowDustBtn();f[".jcreport-finish-button"]=this._isShowFinishBtn();for(var c in f){if(f[c]==false){d[d.length]=c}}var e=this.$mjPage.find(".co-actionarea :button");e.filter(d.join(",")).remove();this.$mjPage.find(".co-actionarea>.line").each(function(i,k){var h=b(k);var j=function(){return b(this).css("display")!="none"};h.toggle(h.prevAll().filter(j).eq(0).is(":button")&&h.nextAll().filter(j).eq(0).is(":button"))})},_isShowCopyBtn:function(){return !this.isManageMode()},_isShowResendBtn:function(){return !this.isManageMode()&&!this._isFinishedCreport()&&this._getAuthorUid()==this._getLoginUid()},_isShowDelBtn:function(){if(this.isManageMode()){return true}return this._getFolderId()==desknets.creport.DUST_FOLDER_ID},_isShowDustBtn:function(){return !this.isManageMode()&&this._getFolderId()!=desknets.creport.RECV_FOLDER_ID&&this._getFolderId()!=desknets.creport.DUST_FOLDER_ID},_isShowFinishBtn:function(){if(this.isManageMode()||this._getAuthorUid()==this._getLoginUid()){return !this._isFinishedCreport()}return false},_onClickDownload:function(d){var c;var f={};f.id=this._getCreportId();f.cmd=desknets.creport.CMD_CREPORTCSVDOWNLOAD;if(this.isManageMode()){f.cmd=desknets.creportset.CMD_CREPORTMSET_CSVDOWNLOAD}c=desknets.getUrl(desknets.creport.MODULE_MAIN_CREPORT)+"?"+desknets.getNeoParam(f);desknets.execLocation(c,"_blank")},_onClickPrint:function(d,c){d.preventDefault();desknets.print.setPrintHtmlFunc=b.proxy(function(e,g){var f=function(n){g.$("#jco-print-body").html(n);var j=g.$("#jco-print-body").find("img");var h=j.length;var m=0;j.each(function(){b("<img>").load(function(){m++}).attr("src",b(this).attr("src"))});var l=0;var k=0;var i=setInterval(function(){l++;if(h<=m||l>10){clearInterval(i);g.print()}},500);desknets.print.delAlink(g)};if(!!c){this._buildPrintHtmlBody(f)}else{this._buildPrintHtmlBodyContent(f)}return false},this);desknets.print.initPrintOpen({})},_onClickTosFilter:function(f){var c=this;var d=desknets.paramanalyzer.getHashParams();d.row=0;d.filter=this.$tosFilter.val();desknets.hashobserver.stopObserveHash();desknets.paramanalyzer.setLocationHash(d);setTimeout(function(g){desknets.hashobserver.startObserveHash()},100);c._ajaxGetTos(d.row)},_onClickTosReload:function(f){f.preventDefault();this.$tosReloadBtn.addClass("on");var d=desknets.paramanalyzer.getHashParams();var c=d.row;this._ajaxGetTos(c)},_onClickCommentsExpand:function(f){f.preventDefault();var c=b(f.target);var d=c.closest(".creport-comments");this._toggleComments(d,!c.hasClass("on"))},_onClickCommentsExpandAll:function(f){f.preventDefault();var d=b(f.target);d.toggleClass("on");if(d.hasClass("on")){var c=d.offset();b("html,body").scrollTop(c.top);d.text(desknets.Resource.creport.commentCloseAll)}else{d.text(desknets.Resource.creport.commentOpenAll)}this._toggleAllComments()},_toggleAllComments:function(){var d=this;var c=d.$tosAllToggle.hasClass("on");this.$tos.find(".creport-comments").each(function(){d._toggleComments(b(this),c)})},_toggleComments:function(e,c){if(e.hasClass(".unexpandable")){return}if(!c){e.removeClass("open");e.find(".creport-comments-toggle").removeClass("on");e.find(".creport-comments-toggle").text(desknets.Resource.creport.commentOpen);var d=e.find(".comment-editing");this._commentEditorRestor(d)}else{e.addClass("open");e.find(".creport-comments-toggle").addClass("on");e.find(".creport-comments-toggle").text(desknets.Resource.creport.commentClose)}this._updateComments(e);this._updateListviewHeight()},_onClickChecked:function(h){var i={};var f=null;var g=b(h.target);var d=g.closest("tr").find("[name=routeid]").val();var c=g.closest(".comment-editable");f=b.proxy(function(k,e,l){if(this._getAuthorUid()!=this._getLoginUid()){var j=this.options.onExit;if(j){j()}}this._commentEditorCommit(c,k)},this);i.rid=d;i.memo="";i.open="1";this._ajaxCommentEntry(i,f)},_onClickCommentEditBegin:function(f){f.preventDefault();this._commentEditorRestor(this.$tosTBody.find(".comment-editing"));this._commentEditorRestor(this.$uncheckedTosTBody.find(".comment-editing"));var c=b(f.target).closest(".comment-editable");var d=c.find(".creport-comment-fileicon").length>0?1:0;this._ajaxAttachEditBegin(c,b.proxy(function(){this._commentEditorEditing(c)},this))},_onClickCommentEditCommit:function(i){var g=null;i.preventDefault();var h=b(i.target).closest(".comment-editable");var f=h.closest("tr").find("[name=routeid]").val();var k=h.find("[name=commentid]").val();var c=h.find("textarea").val();var d=h.find("[name=open]:checked").length?"0":"1";var j={};j.rid=f;j.memo=c;j.open=d;if(k!=null){j.nid=k}g=b.proxy(function(l,e,m){this._commentEditorCommit(h,l)},this);this._ajaxCommentEntry(j,g)},_onClickCommentEditorClose:function(d){d.preventDefault();var c=b(d.target).closest(".comment-editable");this._commentEditorRestor(c);this._updateListviewHeight()},_onClickAttachChoice:function(f){var d=b(f.target).closest(".comment-editable");var c=d.find(".jcreport-attach-list");c.dnAttachList("openChooser")},_onClickFinish:function(f){var c=this;var d=desknets.Resource.Message.creport_complete_conf;$dialog=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled($dialog);c._ajaxFinish()})},_onClickDel:function(h){var c=this;var g=desknets.paramanalyzer.getHashParams();var d=desknets.Resource.Message.com_del_conf;var f=null;if(this.isManageMode()){f=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled(f);c._ajaxDel()})}else{f=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled(f);if(c._getAuthorUid()==c._getLoginUid()){c._ajaxDel()}else{c._ajaxDelNotice()}})}},_onClickDust:function(c){this._ajaxTrash()},_onClickCopyEntry:function(f){var g={};g.cmd=desknets.creport.CMD_CREPORTENTRYPAGE;g.id=desknets.paramanalyzer.getHashParam("id");g.copy="1";if(this._isShowCopyConfirmDialog()){var h='<div><ul><li><input type="radio" name="sendtype" value="1" id="jcreport-sendcopy-all" checked="true" /><label for="jcreport-sendcopy-all">&nbsp;'+desknets.Resource.creport.sendCopyAll+'</label></li><li><input type="radio" name="sendtype" id="jcreport-sendcopy-nocheck" value="2" /><label for="jcreport-sendcopy-nocheck">&nbsp;'+desknets.Resource.creport.sendCopyNoCheck+"</label></li></ul></div>";var c={title:desknets.Resource.creport.sendCopyDialogTitle,width:300,buttons:{}};var d=null;c.buttons[desknets.Resource.OKButtonLabel]=function(){var e={};var j=d.find(":radio[name=sendtype]:checked").val();e.id=desknets.paramanalyzer.getHashParam("id");if(j=="2"){e.filter="nocheck"}var i=b.extend({},g,e);desknets.paramanalyzer.setLocationHash(i);d.dialog("close")};c.buttons[desknets.Resource.CancelButtonLabel]=function(){d.dialog("close")};d=desknets.dialog.make("confirmcopy",c);d.html(h);d.dialog("open");desknets.dialog.setFirstDialogOpen(d);return}desknets.paramanalyzer.setLocationHash(g)},_onClickMail:function(g){g.preventDefault();var d=this;var f={};var c=desknets.paramanalyzer.getHashParams();f.connectid=c.id;f.restmodule=d._getRestModule();f.restcmd=d._getConnectAppCmd();desknets.connectapp.connectMail(f)},_getConnectAppCmd:function(){return desknets.creport.CMD_CREPORTCONNECTAPP},_ajaxFinish:function(){var c=this;var e=null;var d;var f=desknets.paramanalyzer.getHashParams();var g={};g.cmd=desknets.creport.CMD_CREPORTFINISH;g.id=f.id;if(this.isManageMode()){g.cmd=desknets.creportset.CMD_CREPORTMSET_FINISH}d=desknets.getUrl(c._getRestModule());desknets.ajax.rest({url:d,data:g,success:function(i,h,k){var j;j=c.options.onUpdData;if(!!j){j()}j=c.options.onExit;if(!!j){j()}},complete:function(){}})},_ajaxDelNotice:function(){var c=this;var f={};var d;var e=desknets.paramanalyzer.getHashParams();f.cmd=desknets.creport.CMD_CREPORTLISTDEL;f.id=e.id;f.folder=this._getFolderId();d=desknets.getUrl(c._getRestModule());desknets.ajax.rest({url:d,data:f,success:function(h,g,j){var i;i=c.options.onUpdData;if(!!i){i()}i=c.options.onExit;if(!!i){i()}},complete:function(){}})},_ajaxTrash:function(){var c=this;var f={};var d;var e=desknets.paramanalyzer.getHashParams();f.cmd=desknets.creport.CMD_CREPORTLISTMOVE;f.id=e.id;f.folder=this._getFolderId();f.destid=desknets.creport.DUST_FOLDER_ID;d=desknets.getUrl(c._getRestModule());desknets.ajax.rest({url:d,data:f,success:function(h,g,j){var i;i=c.options.onUpdData;if(!!i){i()}i=c.options.onExit;if(!!i){i()}},complete:function(){}})},_ajaxDel:function(){var c=this;var f={};var d;var e=desknets.paramanalyzer.getHashParams();f.cmd=desknets.creport.CMD_CREPORTDEL;f.id=e.id;if(this.isManageMode()){f.cmd=desknets.creportset.CMD_CREPORTMSET_DEL}d=desknets.getUrl(c._getRestModule());desknets.ajax.rest({url:d,data:f,success:function(h,g,j){var i;i=c.options.onUpdData;if(!!i){i()}i=c.options.onExit;if(!!i){i()}},complete:function(){}})},_getAjaxGetTosParam:function(){var c=desknets.paramanalyzer.getHashParams();var d={};d.cmd=this._getRouteExecCmd();d.id=c.id;d.row=c.row;if(c.filter!=="recv"){d.filter=c.filter}return d},_getAjaxGetUncheckedTosParam:function(){var c=desknets.paramanalyzer.getHashParams();var d={};d.cmd=this._getRouteExecCmd();d.filter="recv";d.id=c.id;d.num=this.nUncheckedListNum;return d},_ajaxGetTos:function(d){var e=desknets.paramanalyzer.getHashParams();var c=this._getAjaxGetTosParam();var f=null;c.id=e.id;c.row=d;f=b.proxy(function(h,g,i){this._clrTos();this._setTos(h);this.$tosTBody.empty();this._updateTosTable();this._toggleAllComments();this._updateListviewHeight()},this);desknets.ajax.rest({url:desknets.getUrl(this._getRestModule()),data:c,success:function(h,g,i){if(f){f(h,g,i)}},complete:function(i,g,h){}})},_getCommentEntryParam:function(f,h,c,e){var d={};var g=desknets.paramanalyzer.getHashParams();d.cmd=this._getCommentEntryExecCmd();d.id=g.id;d.rid=f;d.nid=h;d.memo=c;d.open=e;return d},_ajaxCommentEntry:function(f,e){var c=this;var d=this._getCommentEntryParam();d.rid=f.rid;d.nid=f.nid;d.memo=f.memo;d.open=f.open;desknets.ajax.rest({url:desknets.getUrl(this._getRestModule()),data:d,success:function(h,g,i){if(!d.nid&&d.rid==c._getLoginUid()){c.data.creport["ichecked"]="1"}if(e){e(h,g,i)}},complete:function(i,g,h){}})},_ajaxAttachEditBegin:function(e,f){var d={};var c=this._getCommentKey(e);d.cmd=desknets.creport.CMD_CREPORTCOMMENTATTACHBEGIN;d.id=c.id;d.rid=c.rid;d.nid=c.nid;desknets.ajax.rest({url:desknets.getUrl(this._getRestModule()),data:d,success:function(h,g,i){if(f){f(h,g,i)}},complete:function(i,g,h){}})},_getDispDataParam:function(){var c;c=desknets.paramanalyzer.getHashParams();c.cmd=this._getDispExecCmd();return c},_getDispHtmlParam:function(){return desknets.paramanalyzer.getHashParams()},_updateListviewHeight:function(){var c=this.options.onResize;if(c){c()}},getMultiRequest:function(){var d={};var c=0;d[String(c++)]=this._getDispDataParam();d[String(c++)]=this._getDispHtmlParam();d[String(c++)]=this._getAjaxGetTosParam();if(!this.isManageMode()){d[String(c++)]=this._getAjaxGetUncheckedTosParam()}var e=desknets.attach.ext.getListParam();if(!!e){e.cmd="creport"+e.cmd;d[String(c++)]=e}return d},_initSet:function(g){var e=this;this._setCreportData(g["0"]);this._clrTos();this._setTos(g["2"]);this._clrUncheckedTos();if(!this.isManageMode()){this._setUncheckedTos(g["3"])}if(!this.isManageMode()){if(!!g["4"]){desknets.attach.ext.saveList(g["4"])}}else{if(!!g["3"]){desknets.attach.ext.saveList(g["3"])}}this.$mjPage.empty();this.$mjPage.html(g["1"].html);var j=this._getTmplOptions();this.$mjPage.find(".jco-disp-tmplset").tmpl(g["0"],j).appendTo("#jco-m-disp-page");this._showButtons();this.$tosTmpl=this.$mjPage.find(".jcreport-tos-tmpl");this.$uncheckedTosTmpl=this.$mjPage.find(".jcreport-unchecked-to-tmpl");this.$commentViewTmpl=this.$mjPage.find(".jcreport-comment-tmpl");this.$commentEditorTmpl=this.$mjPage.find(".jcreport-comment-editor-tmpl");this.$uncheckedTosCnt=this.$mjPage.find("#creport-view-unchecked-cnt");this.$uncheckedTos=this.$mjPage.find("#creport-view-unchecked-comment");this.$uncheckedTosTBody=this.$mjPage.find("table.creport-unchecked-tos>tbody");this.$tos=this.$mjPage.find("#creport-view-comment");this.$tosTBody=this.$tos.find("table.creport-tos-table>tbody");this.$tosPager=this.$tos.find(".jco-pager").parent();this.$tosReloadBtn=this.$tos.find(".co-btn-update");this.$tosFilter=this.$tos.find(".jcreport-comments-filter");this.$tosAllToggle=this.$tos.find(".creport-toggle-all");desknets.rte.readyForShow(b("#creport-view-detail-in > .co-mceview"));this._updateUncheckedTosTable();this._updateTosTable();if(this._getAuthorUid()==this._getLoginUid()){this.$tos.addClass("creport-user-comments-entry");this.$tos.removeClass("creport-user-comments-otherto")}else{this.$tos.removeClass("creport-user-comments-entry");this.$tos.addClass("creport-user-comments-otherto")}this.$mjPage.toggleClass("mset",this.isManageMode());desknets.creport.NoticeUnconfirmUserDialog.init(this.$mjPage.find(".jcreport-title").text());var d=this.$mjPage.find(".co-actionwrap,.jco-disp-disparea");d.delegate(":button.jco-input-download-submit","click",b.proxy(this._onClickDownload,this));d.delegate(".jcreport-finish-button","click",b.proxy(this._onClickFinish,this));d.delegate(".jcreport-del-button","click",b.proxy(this._onClickDel,this));d.on("click",".jcreport-dust-button",b.proxy(this._onClickDust,this));d.on("change",".jcreport-comments-filter",b.proxy(this._onClickTosFilter,this));d.on("click",".creport-toggle-all",b.proxy(this._onClickCommentsExpandAll,this));d.on("click",".jcreport-unconfirm-notice",function(k){k.preventDefault();desknets.creport.NoticeUnconfirmUserDialog.open()});this.$tosReloadBtn.click(b.proxy(this._onClickTosReload,this));d.delegate(".creport-checked","click",b.proxy(this._onClickChecked,this));d.delegate(".creport-comments-toggle","click",b.proxy(this._onClickCommentsExpand,this));d.delegate(".creport-cmt-add,.creport-cmt-mod","click",b.proxy(this._onClickCommentEditBegin,this));d.delegate(".creport-comment-add-button,.creport-comment-mod-button","click",b.proxy(this._onClickCommentEditCommit,this));d.delegate(".creport-comment-close","click",b.proxy(this._onClickCommentEditorClose,this));d.delegate("input[type=button].creport-comment-attach-choice","click",b.proxy(this._onClickAttachChoice,this));var f=function(l,k){return""};var i=function(){var m={};var l=false;m=desknets.paramanalyzer.getHashParams();m.cmd=desknets.creport.CMD_CREPORTCABATTACHCOPY;var k=function(o){m.viewdata=desknets.tmpl.replaceWordChkHtml(desknets.cabinetregist.loadFiles[e.mcabtmpl],"body",o)};var n=function(){l=true;desknets.submitform.clearDialogDisabled(desknets.cabinetregist.$dialog.detail)};e._buildCabinetHtmlBody(k,n);if(l){return false}return m};var h={copymodule:this._getRestModule(),copycmd:desknets.creport.CMD_CREPORTCABATTACHCOPY,cabmaketemplate:f,copyprm:i,cabtemplatename:e.mcabtmpl};desknets.cabinetregist.geTemplate(f,e.mcabtmpl,"detail");desknets.cabinetregist.init(this.$mjPage,h,false);d.on("click",".jcreport-print",b.proxy(function(k){this._onClickPrint(k,false)},this));d.on("click",".jcreport-print-addmessage",b.proxy(function(k){this._onClickPrint(k,true)},this));var c={};c.cmd=desknets.creport.CMD_CREPORTTAG;c.id=this._getCreportId();desknets.tagDisp.initTagEvent(desknets.creport.MODULE_API_CREPORT,c);d.delegate(":button.jco-input-copy","click",b.proxy(this._onClickCopyEntry,this));d.delegate(":button.jco-input-resend","click",b.proxy(function(l){var k=desknets.paramanalyzer.getHashParams();var m={};m.cmd=desknets.creport.CMD_CREPORTENTRYPAGE;m.id=k.id;m.copy="0";desknets.paramanalyzer.setLocationHash(m)},this));d.on("click",".jco-connectmail",b.proxy(this._onClickMail,this));var e=this;desknets.rtfile.onHeightSizeChk(b("#creport-view-detail-in > .co-mceview"),function(){desknets.listviewframe.updateInputHeight(e.options["$page"].find(".co-listview"))})},_getRestModule:function(){return desknets.creport.MODULE_API_CREPORT},_getDispExecCmd:function(){if(this.isManageMode()){return desknets.creportset.CMD_CREPORTMSET_DISP}else{return desknets.creport.CMD_CREPORTDISP}},_getRouteExecCmd:function(){if(this.isManageMode()){return desknets.creportset.CMD_CREPORTMSET_ROUTE}else{return desknets.creport.CMD_CREPORTROUTE}},_getCommentEntryExecCmd:function(){if(this.isManageMode()){return desknets.creportset.CMD_CREPORTMSET_COMMENT}else{return desknets.creport.CMD_CREPORTCOMMENTENTRY}},_buildCabinetHtmlBody:function(c,d){desknets.creport.printpage.buildCabPageHtml(this._getCreportId(),c,d)},_buildPrintHtmlBody:function(c){var d=this.isManageMode();var e=this.$tosFilter.val();desknets.creport.printpage.buildPrintPageHtml(this._getCreportId(),d,c,e)},_buildPrintHtmlBodyContent:function(c){var d=this.isManageMode();desknets.creport.printpage.buildPrintPageHtmlContent(this._getCreportId(),d,c)},_getImageCmd:function(){if(this.isManageMode()){return desknets.creport.CMD_CREPORTMSET_RTEATTACH}return desknets.creport.CMD_CREPORT_RTEATTACH},banpei:null})})(jQuery);(function(b){desknets.page(desknets.creport,"printpage",null,{buildCabPageHtml:function(f,j,d){var k=this;var c=f;var h={},g={},e={};h.cmd=desknets.creport.CMD_CREPORTCABINETPAGE;g.cmd=desknets.creport.CMD_CREPORTDISP;g.cabinet="1";g.id=c;e.cmd=desknets.creport.CMD_CREPORTROUTE;e.id=c;e.num=desknets.creport.MAXNUM;params=desknets.ajax.arrayToMultiCmdData({"0":h,"1":g,"2":e});var i=function(m){var l;l=k._buildBody(m);j(l)};this._ajaxGetData(params,i,true,d)},buildPrintPageHtml:function(h,f,l,d){var m=this;var c=h;var j={},i={},g={};j.cmd=desknets.creport.CMD_CREPORTPRINTPAGE;i.cmd=desknets.creport.CMD_CREPORTDISP;i.id=c;g.cmd=desknets.creport.CMD_CREPORTROUTE;g.id=c;g.num=desknets.creport.MAXNUM;g.filter=d;if(!!f){i.cmd=desknets.creportset.CMD_CREPORTMSET_DISP;g.cmd=desknets.creportset.CMD_CREPORTMSET_ROUTE}params=desknets.ajax.arrayToMultiCmdData({"0":j,"1":i,"2":g});var k=function(o){var n;n=m._buildBody(o,f);l(n)};var e=!!desknets.browser.ipad;this._ajaxGetData(params,k,e)},buildPrintPageHtmlContent:function(f,e,j){var k=this;var c=f;var h={},g={};h.cmd=desknets.creport.CMD_CREPORTPRINTPAGE;g.cmd=desknets.creport.CMD_CREPORTDISP;g.id=c;if(!!e){g.cmd=desknets.creportset.CMD_CREPORTMSET_DISP}params=desknets.ajax.arrayToMultiCmdData({"0":h,"1":g});var i=function(m){var l;l=k._buildBodyContent(m,null,e);j(l)};var d=!!desknets.browser.ipad;this._ajaxGetData(params,i,d)},_ajaxGetData:function(f,e,c,d){desknets.ajax.rest({async:!c,detectMultiError:true,dataType:desknets.ajax.RESTYPE_JSON,url:desknets.getUrl(desknets.creport.MODULE_API_CREPORT),data:f,success:function(h,g,i){e(h)},error:function(i,g,h){if(b.isFunction(d)){d()}desknets.ajax.onError(i.status,h)}})},_buildBody:function(h,e){var g=null;var d=h[2].list.item;if(d==null){d=[]}if(!b.isArray(d)){d=[d]}var c,f;c=h[0].html;f=h[1];b.each(d,function(i,j){if(j.comments==null){j.comments=[]}if(b.isArray(j.comments)==false){j.comments=[j.comments]}j.newComments=desknets.creport.filterNewComments(f.rev,j.comments);j.oldComments=desknets.creport.filterOldComments(f.rev,j.comments)});return this._buildBodyContent(h,d,e)},_buildBodyContent:function(c,j,d){var k=this;var e=null;var i,g;i=c[0].html;g=c[1];if(!!j){g.routes=j}if(!!g.memo){g.memo=desknets.tmpl.replaceWordHtml(g.memo,"cmd",k._getImageCmd(d));g.memo=desknets.rte.convertForShow(g.memo)}e=b("<div>").append(i);b.each(e.children("script[type=text/x-jquery-tmpl]"),function(m,n){var l=b(n);l.template(l.attr("id"))});var f=b.tmpl("jcreport-printpage-tmpl",g);var h=f.wrapAll("<div>").parent().html();b.each(e.children("script[type=text/x-jquery-tmpl]"),function(l,m){delete b.template[b(m).attr("id")]});return h},_getImageCmd:function(c){if(!!c){return desknets.creport.CMD_CREPORTMSET_RTEATTACH}return desknets.creport.CMD_CREPORT_RTEATTACH},banpei:null})})(jQuery);desknets.page(desknets.creport,"searchindex",desknets.PageListBatSearchBase,{_cmdNo:null,_onClickFinish:function(b){this._cmdNo=desknets.creport.CMD_CREPORTFINISH;this._listDelSubmit(b)},_initListStartModLink:function(){var b=this;b.$mjTableList.dnclick(".jco-modlink",function(d){var c=a(this).parent().parent().find(".jco-id").val();b.inputDispPage(c)},function(d){var c=a(this).parent().parent().find(".jco-id").val();b.inputDispPage(c)})},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b._initListEndButtonOrg();this.$mjListPage.find(".jco-list-finish-submit").click(function(c){b._onClickFinish(c)});this.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()})},_initListEndButtonOrg:function(){var c=this;var b=c.$mjListPage.find(".jcreport-dust-submit");b.show();b.unbind();b.click(function(e){var d=0;c._cmdNo=desknets.creport.CMD_CREPORTSEARCHLISTMOVE;c.$mjTableList.find("input[type=checkbox]").each(function(){if(a(this).attr("checked")){d++;return false}});if(d<1){return}c._listDel(true,null)})},_replaceListLine:function(d,f,e){var c=this;var b;b=desknets.creport.replaceCreportListLine(d,f,e);if(b){return b}return c.callBase("_replaceListLine",d,f,e)},_getDelAddPrm:function(){var b={};if(this.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){b.lcmd=this._getListExecCmd()}if(this._cmdNo==desknets.creport.CMD_CREPORTFINISH){return b}else{if(this._cmdNo==desknets.creport.CMD_CREPORTDEL){return b}else{if(this._cmdNo==desknets.creport.CMD_CREPORTSEARCHLISTMOVE){b.destid=desknets.creport.DUST_FOLDER_ID;return b}}}},_getListAjaxSuccess:function(b){this.callBase("_getListAjaxSuccess",b)},_getRestModule:function(){return desknets.creport.MODULE_API_CREPORT},_getListCmd:function(){return desknets.creport.CMD_CREPORTSEARCHPAGE},_getListExecCmd:function(){return desknets.creport.CMD_CREPORTSEARCHINDEX},_getStopBatSearchCmd:function(){return desknets.creport.CMD_CREPORTSTOPSEARCH},_getListDispCmd:function(){return desknets.creport.CMD_CREPORTSEARCHDISPPAGE},_getDelCmd:function(){if(this._cmdNo==desknets.creport.CMD_CREPORTFINISH){return desknets.creport.CMD_CREPORTFINISHCONF}return""},_getDelExecCmd:function(){return this._cmdNo},_delNoChkMessage:function(){if(this._cmdNo==desknets.creport.CMD_CREPORTFINISH){return desknets.Resource.Message.creport_complete_nochecked}else{return this.callBase("_delNoChkMessage")}},banpei:null});(function(b){desknets.page(desknets.creport,"searchdisp",desknets.PagePaneDispBase,{_$editorForm:null,_initGetHtml:function(){this._getDispComponent().init({"$page":this.$mjPage,onCreate:b.proxy(function(){this._initSet()},this),onResize:b.proxy(function(){this._setListviewHeight(this.$mjPage)},this),onUpdData:b.proxy(function(){desknets.creport.searchindex._onSrchExec=true},this),onExit:b.proxy(function(){this.dispBackListPage()},this),onEditorStart:b.proxy(this._onEditorStart,this),onEditorEnd:b.proxy(this._onEditorEnd,this),search:true,manage:false})},_initSet:function(f){var d=this;var e=[];e[e.length++]='<div class="co-listview co-list-selfolder selmulti">';e[e.length++]='  <div class="co-listview-left ui-layout-west"><!-- 左ペイン --></div>';e[e.length++]='  <div class="co-listview-list ui-layout-center"><!-- 右ペイン --></div>';e[e.length++]="</div>";d.$mjPage.find(".jco-disp-disparea").append(b(e.join("")));var c=d.$mjPage.find(".co-listview-list.ui-layout-center");d.$mjPage.find(".jco-disp-disparea").children(":not(:last)").appendTo(c);b("#jco-m-disp-page").find(".ui-layout-west").html(b("#jco-m-list-container").find(".ui-layout-west").html());d.initLeftTree();this.callBase("_initSet",null)},initLeftTree:function(){var c=b.extend({},desknets.folderdisp);c.init(this.$mjPage,this._getOptionLeftTree(),this._optTreeGetCmd())},_optTreeSelectFunc:function(d){var c=d.data("fid");desknets.creport.creportindex.resetSortCondition(c);this.callBase("_optTreeSelectFunc",d)},_optTreeSelItemParams:function(){var c=this;if(c.mIdBack=="jco-m-list-container"){return c.callBase("_optTreeSelItemParams")}return{}},_getSpliterAddOpt:function(){return{initClosed:true}},_optTreeGetCmd:function(){return desknets.creport.getFolderCmd()},_getRestModule:function(){return desknets.creport.MODULE_API_CREPORT},_getDispExecCmd:function(){return desknets.creport.CMD_CREPORTDISP},_initDispLeftPane:function(){desknets.creport.creportfolderdisp.init()},_getDispComponent:function(){return desknets.creport.creportdispCompo},_formObserveisChanged:function(){return !!this._$editorForm&&!!this._formObserve_isChanged(this._$editorForm)},_onEditorStart:function(c){this._$editorForm=c.find("form");this._defFormVals={};this._formObserveSave(this._$editorForm,this._defFormVals)},_onEditorEnd:function(c){this._$editorForm=null;this._defFormVals={}},banpein:null})})(jQuery);app.addInitialAction(function(){desknets.creport.init()})})(jQuery);