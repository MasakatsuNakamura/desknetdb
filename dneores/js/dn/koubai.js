/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.koubai={MODULE_KOUBAI:"zkoubai",MODULE_API_KOUBAI:"zrkoubai",PAGE_KOUBAIINDEX:"koubaiindex",CMD_KOUBAIINDEX:"koubaicmdindex",PAGE_KOUBAIRVREFER:"koubairvrefer",CMD_KOUBAIRVREFER:"koubaicmdrvrefer",PAGE_KOUBAIRVSHOHINENTRY:"koubairvshohinentry",CMD_KOUBAIRVSHOHINENTRY:"koubaicmdrvshohinentry",PAGE_KOUBAIRVSHOHINREFER:"koubairvshohinrefer",CMD_KOUBAIRVSHOHINREFER:"koubaicmdrvshohinrefer",CMD_KOUBAIRVSHOHINDEL:"koubaicmdrvshohindel",CMD_KOUBAIRVORDERACCEPT:"koubaicmdrvorderaccept",PAGE_KOUBAIRVSEARCH:"koubairvsearch",CMD_KOUBAIRVSEARCH:"koubaicmdrvsearch",PAGE_KOUBAIORDERLIST:"koubaiorderlist",CMD_KOUBAIORDERLIST:"koubaicmdorderlist",PAGE_KOUBAIORDERREFER:"koubaiorderrefer",CMD_KOUBAIORDERREFER:"koubaicmdorderrefer",CMD_KOUBAIORDERDEL:"koubaicmdorderdel",CMD_KOUBAIORDERACCEPT:"koubaicmdorderaccept",PAGE_KOUBAIORDERSEARCH:"koubaiordersearch",CMD_KOUBAIORDERSEARCH:"koubaicmdordersearch",PAGE_KOUBAIMGLIST:"koubaimglist",CMD_KOUBAIMGLIST:"koubaicmdmglist",PAGE_KOUBAIMGENTRY:"koubaimgentry",CMD_KOUBAIMGENTRY:"koubaicmdmgentry",PAGE_KOUBAIMGREFER:"koubaimgrefer",CMD_KOUBAIMGREFER:"koubaicmdmgrefer",CMD_KOUBAIMGDEL:"koubaicmdmgdel",CMD_KOUBAIMGEND:"koubaicmdmgend",PAGE_KOUBAIMGORDER:"koubaimgorder",CMD_KOUBAIMGORDER:"koubaicmdmgorder",CMD_KOUBAIMGORDERENTRY:"koubaicmdmgorderentry",CMD_KOUBAIMGORDERDEL:"koubaicmdmgorderdel",PAGE_KOUBAIMGSHOHINENTRY:"koubaimgshohinentry",CMD_KOUBAIMGSHOHINENTRY:"koubaicmdmgshohinentry",PAGE_KOUBAIMGSHOHINREFER:"koubaimgshohinrefer",CMD_KOUBAIMGSHOHINREFER:"koubaicmdmgshohinrefer",CMD_KOUBAIMGSHOHINDEL:"koubaicmdmgshohindel",CMD_KOUBAIMGSHOHINSTS:"koubaicmdmgshohinsts",CMD_KOUBAIMGMVSHOHI:"koubaicmdmgmvshohin",PAGE_KOUBAIMGSEARCH:"koubaimgsearch",CMD_KOUBAIMGSEARCH:"koubaicmdmgsearch",PAGE_KOUBAIMGPRINT:"koubaimgprint",CMD_KOUBAIMGPRINT:"koubaicmdmgprint",PAGE_KOUBAIMSETINDEX:"koubaimsetindex",stsnot:"---",init:function(){var b=a("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(b);if(b===desknets.koubai.PAGE_KOUBAIINDEX){desknets.hashobserver.init(desknets.koubai);desknets.koubai.koubaiindex.init();desknets.koubai.subwin.init()}},getShohinMod:function(b,e,c){if(c=="1"){return false}var d=desknets.pageframe.getLoginUid();if(b!=d&&e!=d){var f=desknets.paramanalyzer.getHashParams();if(f.cmd==desknets.koubai.PAGE_KOUBAIRVSHOHINREFER){return false}}return true},leftSelectOn:function(b){var c=desknets.paramanalyzer.getHashParams();var d="yoyaku";b.find(".co-listview-item-inside.on").removeClass("on");if(c.cmd==desknets.koubai.PAGE_KOUBAIORDERLIST){if(c.status=="0"){d="koubai-obtaining"}else{if(c.status=="1"){d="koubai-obtaining-end"}else{d="koubai-order"}}}else{if(c.cmd==desknets.koubai.PAGE_KOUBAIMGLIST||c.cmd==desknets.koubai.PAGE_KOUBAIMSETINDEX){if(c.status=="0"){d="koubai-admin-reception"}else{if(c.status=="1"){d="koubai-admin-end"}else{d="koubai-admin"}}}else{if(c.status=="0"){d="koubai-tan"}else{if(c.status=="1"){d="koubai-teiki"}else{d=""}}}}if(d!=""){b.find("."+d).addClass("on")}else{b.find(".co-listview-item-inside").first().addClass("on")}},dispDateTime24:function(j,b,i,k){var l=0;var g=j.substr(0,8);var h=j.substr(8,4);var f=desknets.Resource.timeFormat;if(i==="1"){if(h.substr(0,2)=="00"){f=desknets.Resource.longSchTimeFormat24;if(f.indexOf("k")>=0){h="23"+h.substr(2,2);if(k!="2"){l=-1}}}else{if(k=="2"){l=1}}}var c=neo.dateTime.parse(g+h);if(l!=0){c=neo.dateTime.moveDate(c,l)}var e=neo.dateTime.format(f,c);if(b=="2"){var d=desknets.dateTime.dispDateTime(neo.dateTime.format("yyyyMMdd",c),{type:"list"})}else{var d=desknets.dateTime.dispDateTime(neo.dateTime.format("yyyyMMdd",c))}if(b==="1"){return d}if(b==="2"){return d}return d+" "+e},treeClickListEvent:function(b){b.find(".co-listview-tree").delegate("a.co-listview-item-inside","click.koubai",function(c){setTimeout(function(){var d=desknets.paramanalyzer.getHashParams();if(a.isEmptyObject(d)||(!!d&&d.cmd!=desknets.koubai.PAGE_KOUBAIINDEX)){desknets.scrollManager.clearScrollPosition(desknets.koubai.PAGE_KOUBAIINDEX)}if(!!d&&d.cmd!=desknets.koubai.PAGE_KOUBAIORDERLIST){desknets.scrollManager.clearScrollPosition(desknets.koubai.PAGE_KOUBAIORDERLIST)}if(!!d&&d.cmd!=desknets.koubai.PAGE_KOUBAIMGLIST){desknets.scrollManager.clearScrollPosition(desknets.koubai.PAGE_KOUBAIMGLIST)}},1)})}};desknets.page(desknets.koubai,"subwin",desknets.PageSubwinSearch,{init:function(){var b=this;b.callBase("_initSearch");var c=b.$_inputArea;var d=desknets.paramanalyzer.getHashParams();c.find('input[name="srch_key"]').val(d.srch_key);if(neo.isSet(d.srch_type,{blank:false})){c.find("#jkoubai-sh-sel").val(d.srch_type)}},_chkInputSearchRequired:function(){var b=this;if(b.$_inputArea.find('input[name="srch_key"]').val()==""){desknets.dialog.alert(desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",desknets.Resource.com_srch_keyword),{type:"warn"});return false}return b.callBase("_chkInputSearchRequired")},_getSearchPrm:function(d){var b=this;var c=b.$_inputArea;d.srch_key=c.find('input[name="srch_key"]').val();d.srch_type=c.find("#jkoubai-sh-sel").val();return d},_execClear:function(){var b=this;b.callBase("_execClear");var c=b.$_inputArea;c.find("#jkoubai-sh-sel").val("1")},_getMainCmd:function(){return desknets.koubai.PAGE_KOUBAIINDEX},_getSearchCmd:function(){var b=this;var c=b.$_inputArea;if(c.find("#jkoubai-sh-sel").val()=="1"){return desknets.koubai.PAGE_KOUBAIRVSEARCH}else{if(c.find("#jkoubai-sh-sel").val()=="2"){return desknets.koubai.PAGE_KOUBAIORDERSEARCH}else{return desknets.koubai.PAGE_KOUBAIMGSEARCH}}}});desknets.page(desknets.koubai,"listleft",desknets.tree,{init:function(c){var b=this;this.callBase("init",c,b._getOptionLeftTree())},_selectFirstItem:function(c){var b=this;if(c.find(".co-listview-item-inside.on").length>0){return}desknets.koubai.leftSelectOn(c)},_getOptionLeftTree:function(){var b=this;var d=function(e){b._optTreeSelectFunc(e)};var c={selFunc:d,isLag:false};return c},_optTreeSelectFunc:function(d){var b=this;var c={};$a=d.find(".co-listview-item-inside:first");if($a.hasClass("koubai-yoyaku")){c.cmd=desknets.koubai.PAGE_KOUBAIINDEX;c.status="-1"}else{if($a.hasClass("koubai-tan")){c.cmd=desknets.koubai.PAGE_KOUBAIINDEX;c.status="0"}else{if($a.hasClass("koubai-teiki")){c.cmd=desknets.koubai.PAGE_KOUBAIINDEX;c.status="1"}else{if($a.hasClass("koubai-order")){c.cmd=desknets.koubai.PAGE_KOUBAIORDERLIST;c.status="-1"}else{if($a.hasClass("koubai-obtaining")){c.cmd=desknets.koubai.PAGE_KOUBAIORDERLIST;c.status="0"}else{if($a.hasClass("koubai-obtaining-end")){c.cmd=desknets.koubai.PAGE_KOUBAIORDERLIST;c.status="1"}else{if($a.hasClass("koubai-admin")){c.cmd=desknets.koubai.PAGE_KOUBAIMGLIST;c.status="-1"}else{if($a.hasClass("koubai-admin-reception")){c.cmd=desknets.koubai.PAGE_KOUBAIMGLIST;c.status="0"}else{if($a.hasClass("koubai-admin-end")){c.cmd=desknets.koubai.PAGE_KOUBAIMGLIST;c.status="1"}}}}}}}}}desknets.paramanalyzer.setLocationHash(c);b._mboFirst=false}});desknets.page(desknets.koubai,"listleft_order",desknets.tree,{init:function(c){var b=this;b.$_tree=null;b.changeTreeHtml();a("#jkoubai-m-list-container").find("ins").find("a").remove();this.callBase("init",c,b._getOptionLeftTree())},_selectFirstItem:function(c){var b=this;if(c.find(".co-listview-item-inside.on").length>0){return}desknets.koubai.leftSelectOn(c)},_getOptionLeftTree:function(){var b=this;var d=function(e){b._optTreeSelectFunc(e)};var c={selFunc:d,isLag:false};return c},_optTreeSelectFunc:function(e){var c=this;a("#jco-m-list-container").find(".co-listview-items").html(a("#jkoubai-m-list-container").find(".co-listview-items").html());var b=e.find(".co-listview-item-inside:first").attr("href");var d={};$a=e.find(".co-listview-item-inside:first");if($a.hasClass("koubai-yoyaku")){d.cmd=desknets.koubai.PAGE_KOUBAIINDEX;d.status="-1"}else{if($a.hasClass("koubai-tan")){d.cmd=desknets.koubai.PAGE_KOUBAIINDEX;d.status="0"}else{if($a.hasClass("koubai-teiki")){d.cmd=desknets.koubai.PAGE_KOUBAIINDEX;d.status="1"}else{if($a.hasClass("koubai-order")){d.cmd=desknets.koubai.PAGE_KOUBAIORDERLIST;d.status="-1"}else{if($a.hasClass("koubai-obtaining")){d.cmd=desknets.koubai.PAGE_KOUBAIORDERLIST;d.status="0"}else{if($a.hasClass("koubai-obtaining-end")){d.cmd=desknets.koubai.PAGE_KOUBAIORDERLIST;d.status="1"}else{if($a.hasClass("koubai-admin")){d.cmd=desknets.koubai.PAGE_KOUBAIMGLIST;d.status="-1"}else{if($a.hasClass("koubai-admin-reception")){d.cmd=desknets.koubai.PAGE_KOUBAIMGLIST;d.status="0"}else{if($a.hasClass("koubai-admin-end")){d.cmd=desknets.koubai.PAGE_KOUBAIMGLIST;d.status="1"}}}}}}}}}desknets.paramanalyzer.setLocationHash(d)},changeTreeHtml:function(){var b=this;a("#jkoubai-m-list-container").find(".co-listview-items").html(a("#jco-m-list-container").find(".co-listview-items").html())}});desknets.page(desknets.koubai,"koubaiindex",desknets.PageListBase,{initParamsFromHash:function(c){var b=this;var d="";var e=null;d=c.cmd;if(!neo.isSet(d)||d==b._getListCmd()){b._hashUpdateListPage(c)}else{if(d==desknets.koubai.PAGE_KOUBAIRVREFER){e=a("#jco-m-disp-page").find('input[name="pv-funcid"]');if(e.length>0&&e.val()==d){desknets.koubai.koubairvrefer.mBackCmd=b.mhashBackCmd;desknets.koubai.koubairvrefer.mIdBack=b.mhashIdBack;desknets.koubai.koubairvrefer._getListAjax("0")}else{desknets.koubai.koubairvrefer.initPage(b.mhashBackCmd,b.mhashIdBack)}}else{if(d==desknets.koubai.PAGE_KOUBAIRVSHOHINENTRY){desknets.koubai.koubairvshohinentry.initPage(desknets.koubai.PAGE_KOUBAIRVREFER,"jco-m-disp-page")}else{if(d==desknets.koubai.PAGE_KOUBAIRVSHOHINREFER){desknets.koubai.koubairvshohinrefer.initPage(desknets.koubai.PAGE_KOUBAIRVREFER,"jco-m-disp-page")}else{if(d==desknets.koubai.PAGE_KOUBAIRVSEARCH){e=a("#jco-m-search-container").find('input[name="pv-funcid"]');if(e.length>0&&e.val()==d){desknets.koubai.koubairvsearch._getListAjax(c.row)}else{desknets.koubai.koubairvsearch.initPage(desknets.koubai.PAGE_KOUBAIINDEX,"jco-m-list-container")}b.mhashBackErrCmd=b.mhashBackCmd;b.mhashIdErrBack=b.mhashIdBack;b.mhashBackCmd=desknets.koubai.PAGE_KOUBAIRVSEARCH;b.mhashIdBack="jco-m-search-container"}else{if(d==desknets.koubai.PAGE_KOUBAIORDERLIST){e=a("#jkoubai-m-list-container").find('input[name="pv-funcid"]');if(e.length>0&&e.val()==d){desknets.koubai.koubaiorderlist._getListAjax(c.row)}else{desknets.koubai.koubaiorderlist.initPage(desknets.koubai.PAGE_KOUBAIINDEX,"jco-m-list-container")}b.mhashBackErrCmd=b.mhashBackCmd;b.mhashIdErrBack=b.mhashIdBack;b.mhashBackCmd=desknets.koubai.PAGE_KOUBAIORDERLIST;b.mhashIdBack="jkoubai-m-list-container"}else{if(d==desknets.koubai.PAGE_KOUBAIORDERREFER){if(b.mhashBackCmd!=desknets.koubai.PAGE_KOUBAIORDERLIST&&b.mhashBackCmd!=desknets.koubai.PAGE_KOUBAIORDERSEARCH){b.mhashBackErrCmd=b.mhashBackCmd;b.mhashIdErrBack=b.mhashIdBack;b.mhashBackCmd=desknets.koubai.PAGE_KOUBAIORDERLIST;b.mhashIdBack="jkoubai-m-list-container"}e=a("#jco-m-disp-page").find('input[name="pv-funcid"]');if(e.length>0&&e.val()==d){desknets.koubai.koubaiorderrefer.mBackCmd=b.mhashBackCmd;desknets.koubai.koubaiorderrefer.mIdBack=b.mhashIdBack;desknets.koubai.koubaiorderrefer._getListAjax("0")}else{desknets.koubai.koubaiorderrefer.initPage(b.mhashBackCmd,b.mhashIdBack)}}else{if(d==desknets.koubai.PAGE_KOUBAIORDERSEARCH){e=a("#jkoubai-srch-order").find('input[name="pv-funcid"]');if(e.length>0&&e.val()==d){desknets.koubai.koubaiordersearch._getListAjax(c.row)}else{desknets.koubai.koubaiordersearch.initPage(desknets.koubai.PAGE_KOUBAIINDEX,"jco-m-list-container")}b.mhashBackErrCmd=b.mhashBackCmd;b.mhashIdErrBack=b.mhashIdBack;b.mhashBackCmd=desknets.koubai.PAGE_KOUBAIORDERSEARCH;b.mhashIdBack="jkoubai-srch-order"}else{if(d==desknets.koubai.PAGE_KOUBAIMGLIST){e=a("#jkoubai-m-list-container").find('input[name="pv-funcid"]');if(e.length>0&&e.val()==d){desknets.koubai.koubaimglist._getListAjax(c.row)}else{desknets.koubai.koubaimglist.initPage(desknets.koubai.PAGE_KOUBAIINDEX,"jco-m-list-container")}b.mhashBackErrCmd=b.mhashBackCmd;b.mhashIdErrBack=b.mhashIdBack;b.mhashBackCmd=desknets.koubai.PAGE_KOUBAIMGLIST;b.mhashIdBack="jkoubai-m-list-container"}else{if(d==desknets.koubai.PAGE_KOUBAIMGENTRY){if(b.mhashBackCmd!=desknets.koubai.PAGE_KOUBAIMGLIST&&b.mhashBackCmd!=desknets.koubai.PAGE_KOUBAIMGSEARCH){b.mhashBackErrCmd=b.mhashBackCmd;b.mhashIdErrBack=b.mhashIdBack;b.mhashBackCmd=desknets.koubai.PAGE_KOUBAIMGLIST;b.mhashIdBack="jkoubai-m-list-container"}desknets.koubai.koubaimgentry.initPage(b.mhashBackCmd,b.mhashIdBack)}else{if(d==desknets.koubai.PAGE_KOUBAIMGREFER){if(b.mhashBackCmd!=desknets.koubai.PAGE_KOUBAIMGLIST&&b.mhashBackCmd!=desknets.koubai.PAGE_KOUBAIMGSEARCH){b.mhashBackErrCmd=b.mhashBackCmd;b.mhashIdErrBack=b.mhashIdBack;b.mhashBackCmd=desknets.koubai.PAGE_KOUBAIMGLIST;b.mhashIdBack="jkoubai-m-list-container"}e=a("#jco-m-disp-page").find('input[name="pv-funcid"]');if(e.length>0&&e.val()==d){desknets.koubai.koubaimgrefer.mBackCmd=b.mhashBackCmd;desknets.koubai.koubaimgrefer.mIdBack=b.mhashIdBack;desknets.koubai.koubaimgrefer._getListAjax(c.row)}else{desknets.koubai.koubaimgrefer.initPage(b.mhashBackCmd,b.mhashIdBack)}}else{if(d==desknets.koubai.PAGE_KOUBAIMGORDER){if(a("#jkoubai-m-order-container").find(".jco-title").length>0){desknets.koubai.koubaimgorder._getListAjax(c.row)}else{desknets.koubai.koubaimgorder.initPage(desknets.koubai.PAGE_KOUBAIMGREFER,"jco-m-disp-page")}}else{if(d==desknets.koubai.PAGE_KOUBAIMGSHOHINENTRY){desknets.koubai.koubaimgshohinentry.initPage(desknets.koubai.PAGE_KOUBAIMGREFER,"jco-m-disp-page")}else{if(d==desknets.koubai.PAGE_KOUBAIMGSHOHINREFER){desknets.koubai.koubaimgshohinrefer.initPage(desknets.koubai.PAGE_KOUBAIMGREFER,"jco-m-disp-page")}else{if(d==desknets.koubai.PAGE_KOUBAIMGSEARCH){e=a("#jkoubai-srch-mg").find('input[name="pv-funcid"]');if(e.length>0&&e.val()==d){desknets.koubai.koubaimgsearch._getListAjax(c.row)}else{desknets.koubai.koubaimgsearch.initPage(desknets.koubai.PAGE_KOUBAIINDEX,"jco-m-list-container")}b.mhashBackErrCmd=b.mhashBackCmd;b.mhashIdErrBack=b.mhashIdBack;b.mhashBackCmd=desknets.koubai.PAGE_KOUBAIMGSEARCH;b.mhashIdBack="jkoubai-srch-mg"}}}}}}}}}}}}}}}},init:function(){var b=this;setTimeout(function(){b.initLeftTree()},1);b.callBase("init");desknets.koubai.treeClickListEvent(b.$mjListPage)},initLeftTree:function(){desknets.koubai.listleft.init(this.$mjListPage.find(".co-listview-left"))},_initListEnd:function(){var b=this;b.callBase("_initListEnd");a(window).resize(function(){if(desknets.browser.tablet&&a(".co-pop-up-box.show").length>0){return}b._setListviewHeight(b.$mjListPage)})},_setListviewHeight:function(b){var c=this;desknets.listviewframe.updateListHeight(b.find(".co-listview"),false)},changPage:function(){var b=this;b.callBase("changPage");b._setListviewHeight(b.$mjListPage);desknets.koubai.leftSelectOn(b.$mjListPage.find(".co-listview-tree"));desknets.koubai.listleft._updateItemsWidth()},_initListStartModLink:function(){},_listMoveScroll:function(){var c=this._getListCmd();var b=this.$mjListPage.find(".co-listview-scroll");desknets.scrollManager.setScrollPosition(c,b,{y:0,delay:10})},_getRestModule:function(){return desknets.koubai.MODULE_API_KOUBAI},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIINDEX},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIINDEX}});desknets.page(desknets.koubai,"koubairvrefer",desknets.PageListBase,{msUserId:"",mboKoubaiEntry:false,initPage:function(d,c){var b=this;b.msUserId=desknets.pageframe.getLoginUid();b.boGetHtmlSingle=false;b.callBase("initPage",d,c)},_initListStart:function(){var b=this;b.callBase("_initListStart");b._initListStartNumInput()},_initListStartNumInput:function(){var b=this;b.$mjTableList.delegate(".jkoubai-amount","change",function(d){var k=a(this);var i=k.closest("tr");if(i.find(".jkoubai-status").val()!="2"){var j=i.find(".jkoubai-amount").val();var h=i.find(".jco-id").val();var e=i.find(".jkoubai-money").val();var f=Number(j);var c=Number(e);var g="";if(isNaN(f)||isNaN(c)||e===""){i.find(".jkoubai-sum").text("");i.find(".jkoubai-sum-h").val(0);i.find('input[name="shohinid"]').val(h+"_"+j)}else{g=f*c;i.find(".jkoubai-sum").text(desknets.numberFormat(g));i.find(".jkoubai-sum-h").val(g);i.find('input[name="shohinid"]').val(h+"_"+j)}b._getTotal()}})},_getTotal:function(){var b=this;var c=0;b.$mjTableList.find(".jkoubai-sum-h").each(function(){if(a(this).closest("tr").find(".jkoubai-status").val()!="2"){c=Number(a(this).val())+c}});b.$mjListPage.find(".jkoubai-total").text(desknets.numberFormat(parseInt(c,10)))},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".jco-input-list-page").click(function(c){c.preventDefault();b.dispBackListPage()});b._initSetAjaxFrom()},_initSetAjaxFrom:function(){var c=this;var d={};var b=desknets.koubai.MODULE_API_KOUBAI+"."+desknets._msExtension;a("#dispfrm").attr("action",b);d=c._getAjaxFormOption();a("#dispfrm").find('input[name="cmd"]').val(c._initSetAjaxFromCmd());c._initFormRequestAjax("#dispfrm",d)},_initSetAjaxFromCmd:function(){return desknets.koubai.CMD_KOUBAIRVORDERACCEPT},_getAjaxFormOption:function(){var b=this;var c={};c={success:function(e,d,f){b._onAjaxFormSuccess(e);desknets.submitform.clearDisabled(b.$mjListPage)},validation:function(d){var e=b.checkInput(d);if(neo.isSet(e,{blank:false})){desknets.dialog.alert(e);return false}return true}};return c},checkInput:function(c){var b=this;var e=null;var d=0;c.find(".jco-validation-number").each(function(){d++;if(!desknets.validation.isNumber(a(this).val())){var f={};f.msg=desknets.Resource.Message.com_invalid_number;f.fieldid="amount";f.fieldname=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.koubai_orderrv,"count",d)+desknets.merrMsgConnect;e=desknets.getErrConvMsg(f);return false}});return e},_onAjaxFormSuccess:function(c){var b=this;b.dispBackListPage()},_getListAjaxSuccess:function(c){var b=this;b.mboKoubaiEntry=false;if(c.entry==b.msUserId){b.mboKoubaiEntry=true}b.callBase("_getListAjaxSuccess",c)},_listLine:function(c,d){var b=this;c=b.callBase("_listLine",c,d);var f="";if(d.price!=""){f=Number(d.price)+Number(d.tax)}else{f='""'}c=desknets.tmpl.replaceWordHtml(c,"money",f);var e="";if(f!=='""'){e=f*Number(d.amount)}else{e='""'}c=desknets.tmpl.replaceWordHtml(c,"sum",e);var g="";if(e!=='""'){g=desknets.numberFormat(parseInt(e,10))}c=desknets.tmpl.replaceWordHtml(c,"sumview",g);return c},_replaceListLine:function(b,g,h){var k=this;var i;var e='""';if(g==="entry"){}else{if(g==="Name"){var j="jco-modlink";if(k.mboKoubaiEntry==false&&k.msUserId!=h.entry){j="jkoubai-displink"}var c=desknets.escape(h[g]);c=desknets.escapeValue(c);c=desknets.escapeSpace(c);var d=desknets.paramanalyzer.getHashParams();i='<a href="#id='+d.id+"&date="+d.date+"&cmd=koubairvshohinrefer&shohinid="+h.id+'" class="'+j+'" title="'+c+'">'+c+"</a>";b=desknets.tmpl.replaceWordHtml(b,g,i)}else{if(g==="status"){var f=a("#jco-m-disp-page").find('input[name="pv-funcid"]');if(h[g]=="2"){i=desknets.Resource.koubai.stscancel;e=h[g]}else{if(h[g]=="1"){i=desknets.Resource.koubai.stsordered;e=h[g]}else{if(f.val()==desknets.koubai.PAGE_KOUBAIRVREFER&&h.amount!="0"){i=desknets.Resource.koubai.preorder}else{i=desknets.koubai.stsnot}}}b=desknets.tmpl.replaceWordHtml(b,g,i);b=desknets.tmpl.replaceWordHtml(b,"statusflg",e)}else{if(g==="price"){if(h[g]!=""){i=desknets.numberFormat(parseInt(h[g],10))}else{i=""}b=desknets.tmpl.replaceWordHtml(b,g,i)}else{if(g==="tax"){if(h[g]!=""){i=desknets.numberFormat(parseInt(h[g],10))}else{i=""}b=desknets.tmpl.replaceWordHtml(b,g,i)}else{return k.callBase("_replaceListLine",b,g,h)}}}}}return b},_getListAjaxSuccessOtherSet:function(c){var b=this;a("#"+b._getIdListPageForm()+" .jco-disp-disparea").html(b.$mjListPage.find(".jco-disp-tmplset").tmpl(c));desknets.htmlparts.convertHrefInText(b.$mjListPage.find(".co-textarea-view"));if(c.addshohin!="1"||c.close=="1"){b.$mjListPage.find(".jco-list-add-page").hide()}else{b.$mjListPage.find(".jco-list-add-page").show()}if(c.close=="1"){b.$mjListPage.find(".jco-input-add-submit").hide();b.$mjListPage.find(".jkoubai-amount").each(function(){a(this).closest("td").find("span").text(a(this).val());a(this).hide()})}else{b.$mjListPage.find(".jco-input-add-submit").show()}var d=this._getListAjaxSuccessData(c);if(d.length<=0){b.$mjListPage.find("tfoot").hide()}else{b.$mjListPage.find("tfoot").show()}b._getPriceEmpty();b._setCalInputDis();b._getTotal()},_getPriceEmpty:function(){var b=this;var c=false;b.$mjListPage.find(".jkoubai-money").each(function(){if(a(this).val()===""){c=true;return false}});if(c){b.$mjListPage.find(".jkoubai-total-priceempty").text("* ")}else{b.$mjListPage.find(".jkoubai-total-priceempty").text(" ")}},_setCalInputDis:function(){var b=this;var c=false;b.$mjListPage.find(".jkoubai-status").each(function(){$status=a(this);if($status.val()=="2"){$status.closest("tr").find(".jkoubai-amount").attr("disabled",true)}});if(c){b.$mjListPage.find(".jkoubai-total-priceempty").text("* ")}else{b.$mjListPage.find(".jkoubai-total-priceempty").text(" ")}},_getKoubaiParam:function(){var c=desknets.paramanalyzer.getHashParams();var b={};b.id=c.id;b.date=c.date;return b},_getAddPageParam:function(){return this._getKoubaiParam()},_getModPageParam:function(){return this._getKoubaiParam()},_getDispPageParam:function(){return this._getKoubaiParam()},_getIDName:function(){return"shohinid"},_getIdListPage:function(){return"jco-m-disp-page"},_getIdListPageForm:function(){return"dispfrm"},_getRestModule:function(){return desknets.koubai.MODULE_API_KOUBAI},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIRVREFER},_getListAddCmd:function(){return desknets.koubai.PAGE_KOUBAIRVSHOHINENTRY},_getListModCmd:function(){return desknets.koubai.PAGE_KOUBAIRVSHOHINENTRY},_getListDispCmd:function(){return desknets.koubai.PAGE_KOUBAIRVSHOHINREFER},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIRVREFER}});desknets.page(desknets.koubai,"koubairvshohinentry",desknets.PageInputBase,{getLocationFormParam:function(){var b=this;var c={};var e={};if(!neo.isSet(b.mBackCmd)||!neo.isSet(b.mIdBack)){return null}var d=a("#"+b.mIdBack).find(".jco-back-page-data");if(d.length>0){c=desknets.getInputDataToObj(a("#"+b.mIdBack).find(".jco-back-page-data"))}else{e=desknets.paramanalyzer.getHashParams();c.date=e.date;c.id=e.id}c.cmd=b.mBackCmd;return c},_getRestModule:function(){return desknets.koubai.MODULE_API_KOUBAI},_getDelPrm:function(){var c=desknets.paramanalyzer.getHashParams();var b={shohinid:c.shohinid,date:c.date};return b},_getDelExecCmd:function(){return desknets.koubai.CMD_KOUBAIRVSHOHINDEL},_getAddExecCmd:function(){return desknets.koubai.CMD_KOUBAIRVSHOHINENTRY},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()},checkInput:function(c){var b=this;var f=null;var d=false;var e={};c.find(".jkoubai-validation-amount").each(function(){var h=a(this);var g=h.val();if(b._isMinus(g)){e.msg=desknets.Resource.Message.com_minus_data;d=true}else{if(!b._isAmount(g)){e.msg=desknets.Resource.Message.com_invalid_number;d=true}}if(d){e.fieldid=h.attr("name");e.fieldname=b._getErrorPlace(e.fieldid);f=desknets.getErrConvMsg(e);return false}});return f},_isMinus:function(b){if(b.charAt(0)=="-"){return true}return false},_isAmount:function(b){if(b.match(/[^0-9,.]/g)){return false}return true}});desknets.page(desknets.koubai,"koubairvshohinrefer",desknets.PageDispBase,{getLocationFormParam:function(){var b=this;var c={};var e={};if(!neo.isSet(b.mBackCmd)||!neo.isSet(b.mIdBack)){return null}var d=a("#"+b.mIdBack).find(".jco-back-page-data");if(d.length>0){c=desknets.getInputDataToObj(a("#"+b.mIdBack).find(".jco-back-page-data"))}else{e=desknets.paramanalyzer.getHashParams();c.date=e.date;c.id=e.id}c.cmd=b.mBackCmd;return c},_getDelPrm:function(){var c=desknets.paramanalyzer.getHashParams();var b={shohinid:c.shohinid,date:c.date};return b},_getIdPage:function(){return"jkoubai-m-disp-page"},_getRestModule:function(){return desknets.koubai.MODULE_API_KOUBAI},_getDispExecCmd:function(){return desknets.koubai.CMD_KOUBAIRVSHOHINREFER},_getDispModCmd:function(){return desknets.koubai.PAGE_KOUBAIRVSHOHINENTRY},_getDelExecCmd:function(){return desknets.koubai.CMD_KOUBAIRVSHOHINDEL}});desknets.page(desknets.koubai,"koubairvsearch",desknets.koubai.koubaiindex,{_listMoveScroll:function(){var c=this._getListCmd();var b=desknets.scrollManager.$scrollRoot;desknets.scrollManager.setScrollPosition(c,b,{y:0,delay:10})},initLeftTree:function(){},_setListviewHeight:function(b){},_getIdListPage:function(){return"jco-m-search-container"},_getIdListPageForm:function(){return"searchfrm"},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIRVSEARCH},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIRVSEARCH}});desknets.page(desknets.koubai,"koubaiorderlist",desknets.PageListBase,{_initListStart:function(){var b=this;b.initLeftTree();b.callBase("_initListStart");desknets.koubai.treeClickListEvent(b.$mjListPage)},initLeftTree:function(){desknets.koubai.listleft_order.init(this.$mjListPage.find(".co-listview-left"))},_initListEnd:function(){var b=this;b.callBase("_initListEnd");a(window).resize(function(){if(desknets.browser.tablet&&a(".co-pop-up-box.show").length>0){return}b._setListviewHeight(b.$mjListPage)})},_setListviewHeight:function(b){var c=this;desknets.listviewframe.updateListHeight(b.find(".co-listview"),false)},changPage:function(){var b=this;b.callBase("changPage");b._setListviewHeight(b.$mjListPage);desknets.koubai.leftSelectOn(b.$mjListPage.find(".co-listview-tree"));desknets.koubai.listleft_order._updateItemsWidth()},_initListStartModLink:function(){},_replaceListLine:function(c,g,e){var b=this;var f;if(g==="date"){f=e.date;c=desknets.tmpl.replaceWordHtml(c,g,f)}else{if(g==="entrydate"){f=desknets.dateTime.dispDateTime(e.entrydate,{type:"list"});c=desknets.tmpl.replaceWordHtml(c,"closedate",f)}else{if(g==="status"){var d="";if(e.status==="1"){f=desknets.Resource.koubai.end}else{f=desknets.Resource.koubai.reservation}c=desknets.tmpl.replaceWordHtml(c,g,f)}else{return b.callBase("_replaceListLine",c,g,e)}}}return c},_listMoveScroll:function(){var c=this._getListCmd();var b=this.$mjListPage.find(".co-listview-scroll");desknets.scrollManager.setScrollPosition(c,b,{y:0,delay:10})},_getIdListPage:function(){return"jkoubai-m-list-container"},_getIdListPageForm:function(){return"listkoubaifrm"},_getRestModule:function(){return desknets.koubai.MODULE_API_KOUBAI},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIORDERLIST},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIORDERLIST},_getListDispCmd:function(){return desknets.koubai.PAGE_KOUBAIORDERREFER},_getDelExecCmd:function(){return desknets.koubai.CMD_KOUBAIORDERDEL}});desknets.page(desknets.koubai,"koubaiorderrefer",desknets.koubai.koubairvrefer,{_getAreaTitle:function(b){return b.find(".jco-title-order").val()},_getListAjaxSuccessOtherSet:function(c){var b=this;b.callBase("_getListAjaxSuccessOtherSet",c);b.$mjListPage.find(".co-btnarea").hide()},_replaceListLine:function(c,e,d){var b=this;if(e==="entry"){}else{if(e==="Name"){c=desknets.tmpl.replaceWord(c,e,d[e])}else{return b.callBase("_replaceListLine",c,e,d)}}return c},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIORDERREFER},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIORDERREFER},_initSetAjaxFromCmd:function(){return desknets.koubai.CMD_KOUBAIORDERACCEPT}});desknets.page(desknets.koubai,"koubaiordersearch",desknets.koubai.koubaiorderlist,{initLeftTree:function(){},_setListviewHeight:function(b){var c=this},_listMoveScroll:function(){var c=this._getListCmd();var b=desknets.scrollManager.$scrollRoot;desknets.scrollManager.setScrollPosition(c,b,{y:0,delay:10})},_getIdListPage:function(){return"jkoubai-srch-order"},_getIdListPageForm:function(){return"searchfrmorder"},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIORDERSEARCH},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIORDERSEARCH}});desknets.page(desknets.koubai,"koubaimglist",desknets.PageListBase,{_initListStart:function(){var b=this;b.callBase("_initListStart");b.initLeftTree();desknets.koubai.treeClickListEvent(b.$mjListPage)},initLeftTree:function(){desknets.koubai.listleft_order.init(this.$mjListPage.find(".co-listview-left"))},_initListEnd:function(){var b=this;b.callBase("_initListEnd");a(window).resize(function(){if(desknets.browser.tablet&&a(".co-pop-up-box.show").length>0){return}b._setListviewHeight(b.$mjListPage)})},_setListviewHeight:function(b){var c=this;desknets.listviewframe.updateListHeight(b.find(".co-listview"),false)},changPage:function(){var b=this;b.callBase("changPage");b._setListviewHeight(b.$mjListPage);desknets.koubai.leftSelectOn(b.$mjListPage.find(".co-listview-tree"));desknets.koubai.listleft_order._updateItemsWidth()},_initListStartModLink:function(){var b=this;b.$mjTableList.dnclick(".jco-modlink",function(d){var c=a(this).parent().parent();b.inputDispPage(c.find(".jco-id").val(),c.find(".jkoubai-date").val())},function(d){var c=a(this).parent().parent();b.inputModPage(c.find(".jco-id").val(),c.find(".jkoubai-date").val())},{ignoreOnModifierKey:true})},inputModPage:function(f,c){var b=this;var e="";var d={};e=b._getListModCmd();d=b._getModPageParam();d.cmd=e;d[b._getIDName()]=f;d.date=c;b._inputPage(d)},inputDispPage:function(f,c){var b=this;var e="";var d={};e=b._getListDispCmd();d=b._getDispPageParam();d.cmd=e;d[b._getIDName()]=f;d.date=c;b._inputPage(d)},_listLine:function(c,d){var b=this;c=b.callBase("_listLine",c,d);return c},_replaceListLine:function(c,g,e){var b=this;var f;if(g==="date"){f=e.date;c=desknets.tmpl.replaceWordHtml(c,g,f)}else{if(g==="enddatelc"){f=desknets.koubai.dispDateTime24(e.enddatelc,"2",e.overday,e.reptype);c=desknets.tmpl.replaceWordHtml(c,"closedate",f)}else{if(g==="status"){var d="";if(e.status==="1"){f=desknets.Resource.koubai.end;d=""}else{if(e.status==="0"){f=desknets.Resource.koubai.reservation;d="jco-modlink"}else{f=desknets.koubai.stsnot;d="jco-modlink"}}c=desknets.tmpl.replaceWordHtml(c,g,f);c=desknets.tmpl.replaceWordHtml(c,"link",d)}else{if(g==="amount"){f=desknets.escape(e[g]);f=desknets.escapeValue(f);f=desknets.escapeSpace(f);if(f==""){f=0}c=desknets.tmpl.replaceWordHtml(c,g,f)}else{return b.callBase("_replaceListLine",c,g,e)}}}}return c},_getDelAddPrm:function(){var c={};var b=desknets.paramanalyzer.getHashParams();if(b.status=="0"||b.status=="1"){c.status=b.status}return b},_listMoveScroll:function(){var c=this._getListCmd();var b=this.$mjListPage.find(".co-listview-scroll");desknets.scrollManager.setScrollPosition(c,b,{y:0,delay:10})},_getIdListPage:function(){return"jkoubai-m-list-container"},_getIdListPageForm:function(){return"listkoubaifrm"},_getRestModule:function(){return desknets.koubai.MODULE_API_KOUBAI},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIMGLIST},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGLIST},_getListAddCmd:function(){return desknets.koubai.PAGE_KOUBAIMGENTRY},_getListModCmd:function(){return desknets.koubai.PAGE_KOUBAIMGENTRY},_getListDispCmd:function(){return desknets.koubai.PAGE_KOUBAIMGREFER},_getDelExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGDEL}});desknets.page(desknets.koubai,"koubaimgentry",desknets.PageInputBase,{_initSet:function(c){var b=this;var d={required:true};desknets.timePicker.create(b.$mjPage.find('input[name="starttime"]'),d);desknets.timePicker.create(b.$mjPage.find('input[name="endtime"]'),d);b.callBase("_initSet",c);b._initOtherToSetUp();a(".jkoubai-otherto-open").click(function(e){e.preventDefault();a(".jkoubai-otherto-area").find(".jco-sel-btn").click()});desknets.htmlparts.setUpForm(a(b._mIdPageForm))},_initOtherToSetUp:function(){var c=this;var b=desknets.chooser.getItemsFromElement(a(".jkoubai-otherto-area"));desknets.chooser.setUpEntry(a(".jkoubai-otherto-area"),b,{dialogID:"jkoubai-entry-other-to-dialog",dialogOptions:c._getChooserOptions(),extraVars:{user:{keyName:"otherto"}}})},_getChooserOptions:function(){return{allGroup:"readonly",unassignGroup:"readonly",choosePrivateGroup:"readonly",lockedItems:[{id:a(".jkoubai-entry-id").val(),type:"user"}]}},_inputDelSubmit:function(d){var b=this;var c={};var e=desknets.paramanalyzer.getHashParams();if(d!=null){desknets.submitform.setDialogDisabled(d)}c=b._getDelPrm();c.cmd=b._getDelExecCmd();c[b._getIDName()]=e[b._getIDName()]+"_"+e.date;desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),data:c,success:function(g,f,h){a(window).off("beforeunload.pageBase");b.resetFuncBeforeHashChange();b.dispBackListPage()},complete:function(h,f,g){if(d!=null){desknets.submitform.clearDialogDisabled(d);d.dialog("close")}}})},_getRestModule:function(){return desknets.koubai.MODULE_API_KOUBAI},_getDelExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGDEL},_getAddExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGENTRY},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()}});desknets.page(desknets.koubai,"koubaimgrefer",desknets.PageInputList,{mboEnd:false,msShohinSts:"0",_getFieldsCheckScroll:function(){return["id"]},_listMoveScroll:function(){this._setClearScrollPosition();this.callBase("_listMoveScroll")},initPage:function(d,c){var b=this;b.boGetHtmlSingle=true;b.callBase("initPage",d,c)},_initListEnd:function(){var b=this;b.callBase("_initListEnd");b._initListSortable()},_initListStart:function(){var c=this;c.callBase("_initListStart");c.$mjListPage.find("form").delegate(".jkoubai-modlink","click",function(f){f.preventDefault();c.koubaiModPage()});c.$mjListPage.find("form").delegate(".jkoubai-end","click",function(g){desknets.submitform.setDisabled(c.$mjListPage);var h=desknets.paramanalyzer.getHashParams();var f={};f.id=h.id;f.date=h.date;f.cmd=c._getKoubaiEndCmd();desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:f,error:function(k,i,j){desknets.submitform.clearDisabled(c.$mjListPage);desknets.ajax.onError(k.status,j)},success:function(j,i,k){c.koubaiBackListPage()},})});c.$mjListPage.find("form").delegate(".jkoubai-list-add-page","click",function(f){c.inputAddPage(f)});c.$mjListPage.find(".jkoubai-list-fin-submit").click(function(f){c.msShohinSts="1";c._listDelSubmit(f)});c.$mjListPage.find(".jkoubai-list-cancel-submit").click(function(f){c.msShohinSts="2";c._listDelSubmit(f)});c.$mjListPage.find(".jkoubai-list-other-submit").click(function(f){c.msShohinSts="0";c._listDelSubmit(f)});var b=c._getPrintCmd();var e=c._getPrintExecCmd();var d=function(g,i){var l=desknets.paramanalyzer.getHashParams();var f={};f.cmd=b;var h={};h.cmd=e;h.id=l.id;h.date=l.date;var j=desknets.ajax.arrayToMultiCmdData({"0":f,"1":h});var m="";var k=true;if(desknets.browser.ipad){k=false}desknets.ajax.rest({async:k,url:desknets.getUrl(desknets.koubai.MODULE_API_KOUBAI),data:j,success:function(s,K,u){var N=s[1];var D={};var n={};var w=[];var q=[];var o=null;var S="";var v="";var L=0;var F="";var C={};var I=0;var J="";var r=null;var H=0;var Q=false;var G=a("<div>"+s[0].html+"</div>");G.find("#jkoubai-detail").text(N.detail);G.find("#jkoubai-enddate").text(desknets.koubai.dispDateTime24(N.enddatelc,"0",N.overday,N.reptype));G.find("#jkoubai-entryname").html(desknets.tmpl.escapeWord(N.entryname));G.find("#jkoubai-memo").html(desknets.tmpl.dispStr(N.memo));if(!N||!N.list){w=[]}else{if(!N.list.item){w=[]}else{if(!a.isArray(N.list.item)){w=[N.list.item]}else{w=N.list.item}}}q=[];o=G.find("#jkoubai-shohin-list").find(".co-tbody-list");S=o.html();v="";if(w.length<=0){G.find("#jkoubai-shohin-list").hide()}else{L=w.length;for(I=0;I<L;I++){C=w[I];F=S;n={};J=desknets.escape(C.Name);J=desknets.escapeValue(J);J=desknets.escapeSpace(J);F=desknets.tmpl.replaceWordHtml(F,"Name",J);n.Name=J;J=desknets.escape(C.amount);J=desknets.escapeValue(J);J=desknets.escapeSpace(J);F=desknets.tmpl.replaceWordHtml(F,"amount",J);H=H+parseInt(C.amount,10);if(C.price!==""){J=desknets.numberFormat(parseInt(C.price,10))}else{J="";Q=true}F=desknets.tmpl.replaceWordHtml(F,"price",J);n.price=J;if(C.tax!=""){J=desknets.numberFormat(parseInt(C.tax,10))}else{J=""}F=desknets.tmpl.replaceWordHtml(F,"tax",J);n.tax=J;var B="";var p="";if(C.price!==""){B=Number(C.price)+Number(C.tax);p=B*Number(C.amount);p=desknets.numberFormat(parseInt(p,10))}F=desknets.tmpl.replaceWordHtml(F,"sum",p);n.money=B;if(C.status=="2"){J=desknets.Resource.koubai.stscancel}else{if(C.status=="1"){J=desknets.Resource.koubai.stsordered}else{if(C.amount!="0"){J=desknets.Resource.koubai.stsorder+'&nbsp;<span title="'+desknets.Resource.koubai.stsorder+'" class="koubai-unordered">'+desknets.Resource.koubai.stsordernot+"</span>"}else{J=desknets.koubai.stsnot}}}F=desknets.tmpl.replaceWordHtml(F,"status",J);n.status=J;D[C.id]=n;q[q.length]=F}}o.empty();o.html(q.join(""));G.find(".jkoubai-total-cnt").html(H);if(Q){G.find(".jkoubai-total-priceempty").text("* ")}else{G.find(".jkoubai-total-priceempty").text(" ")}if(!N||!N.userlist){w=[]}else{if(!N.userlist.item){w=[]}else{if(!a.isArray(N.userlist.item)){w=[N.userlist.item]}else{w=N.userlist.item}}}q=[];o=G.find("#jkoubai-user-list").find(".co-tbody-list");S=G.find("#jkoubai-userlist-tmplset").html();v="";var E=false;if(w.length<=0){G.find("#jkoubai-user-list").hide()}else{L=w.length;for(I=0;I<L;I++){Q=false;C=w[I];var z=[];if(!C.item){z=[]}else{if(!a.isArray(C.item)){z=[C.item]}else{z=C.item}}var y=0;var t=0;for(var P=0;P<C.countshohin;P++){F=S;var M=z[P];var x=Number(C.countshohin)+1;if(P==0){J=desknets.escape(C.Name);J=desknets.escapeValue(J);J='<td rowspan="'+x+'">'+desknets.escapeSpace(J)+"</td>"}else{J=""}F=desknets.tmpl.replaceWordHtml(F,"Name",J);F=desknets.tmpl.replaceWordHtml(F,"class","");F=desknets.tmpl.replaceWordHtml(F,"ShohinName",D[M.id]["Name"]);J=desknets.escape(M.amount);J=desknets.escapeValue(J);J=desknets.escapeSpace(J);F=desknets.tmpl.replaceWordHtml(F,"amount",J);F=desknets.tmpl.replaceWordHtml(F,"price",D[M.id]["price"]);if(D[M.id]["price"]===""){Q=true}F=desknets.tmpl.replaceWordHtml(F,"tax",D[M.id]["tax"]);var p="";var R=Number(M.amount);y=y+R;if(D[M.id]["money"]!==""){p=D[M.id]["money"]*R;t=t+p;p=desknets.numberFormat(parseInt(p,10))}F=desknets.tmpl.replaceWordHtml(F,"sum",p);F=desknets.tmpl.replaceWordHtml(F,"status",D[M.id]["status"]);q[q.length]=F}F=S;F=desknets.tmpl.replaceWordHtml(F,"class","co-tr-sum");F=desknets.tmpl.replaceWordHtml(F,"Name","");F=desknets.tmpl.replaceWordHtml(F,"ShohinName",desknets.Resource.koubai.sum);F=desknets.tmpl.replaceWordHtml(F,"amount",y);F=desknets.tmpl.replaceWordHtml(F,"price","");F=desknets.tmpl.replaceWordHtml(F,"tax","");var O="";if(Q){O="* ";E=true}F=desknets.tmpl.replaceWordHtml(F,"sum",O+desknets.numberFormat(parseInt(t,10)));F=desknets.tmpl.replaceWordHtml(F,"status","");q[q.length]=F}}o.empty();o.html(q.join(""));G.find("#jkoubai-date").text(desknets.dateTime.dispDateTime(s.servertime));var A="";if(E){A=" "+desknets.Resource.koubai.fixedamount}G.find(".jkoubai-total").html(desknets.numberFormat(parseInt(N.total,10)));G.find(".jkoubai-total:last").append(A);m=G.html();i.$("body").attr("id","koubai-list-preview");i.$("#jco-print-body").html(m);i.print()},});return false};desknets.print.init(this.$mjListPage,d)},_initListStartSetBack:function(){var b=this;b.$mjListPage.find("form").delegate(".jkoubai-input-list-page","click",function(c){c.preventDefault();b.koubaiBackListPage()})},koubaiModPage:function(){var b=this;var c=desknets.paramanalyzer.getHashParams();c.cmd=b.koubaiModCmd();b._setLocationHash(c)},koubaiBackListPage:function(){var b=this;var c={};if(!neo.isSet(b.mBackCmd)||!neo.isSet(b.mIdBack)){return null}c=desknets.getInputDataToObj(a("#"+b.mIdBack).find(".jco-back-page-data"));c.cmd=b.mBackCmd;if(neo.isSet(c)){b._setLocationHash(c)}return null},_delNoChkMessage:function(){var b=this;if(b.msShohinSts=="0"){if(b.mboEnd){return desknets.Resource.Message.koubai_defend_nochecked}else{return desknets.Resource.Message.koubai_def_nochecked}}else{if(b.msShohinSts=="1"){return desknets.Resource.Message.koubai_fin_nochecked}else{if(b.msShohinSts=="2"){return desknets.Resource.Message.koubai_cancel_nochecked}}}},_delConfMessage:function(){var c=this;var b="";if(c.msShohinSts=="0"){if(c.mboEnd){if(c.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.koubai_defend_allconf}else{if(c.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.koubai_defend_someconf}else{b=desknets.Resource.Message.koubai_defend_listconf}}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())}else{if(c.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.koubai_def_allconf}else{if(c.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.koubai_def_someconf}else{b=desknets.Resource.Message.koubai_def_listconf}}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())}}else{if(c.msShohinSts=="1"){if(c.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.koubai_fin_allconf}else{if(c.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.koubai_fin_someconf}else{b=desknets.Resource.Message.koubai_fin_listconf}}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())}else{if(c.msShohinSts=="2"){if(c.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.koubai_cancel_allconf}else{if(c.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.koubai_cancel_someconf}else{b=desknets.Resource.Message.koubai_cancel_listconf}}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())}}}},_getListAjaxSuccess:function(c){var b=this;if(c.close=="1"){b.mboEnd=true}else{b.mboEnd=false}desknets.submitform.clearDisabled(b.$mjListPage);b.$mjListPage.find(".jkoubai-list-fin-submit").attr("disabled",!b.mboEnd);if(c.reptype=="1"){b.$mjListPage.find(".jkoubai-rep").hide()}else{b.$mjListPage.find(".jkoubai-rep").show()}b.callBase("_getListAjaxSuccess",c)},_getListAjaxSuccessOtherSet:function(c){var b=this;a("#"+b._getIdListPageForm()+" .jkoubai-disp-disparea-button").html(b.$mjListPage.find(".jkoubai-disp-tmplset-button").tmpl(c));b.$mjListPage.find(".jkoubai-title").html(desknets.tmpl.dispStr(c.detail));b.$mjListPage.find(".jkoubai-enddate").html(desknets.koubai.dispDateTime24(c.enddatelc,"0",c.overday,c.reptype));if(c.close=="1"){b.$mjListPage.find(".jkoubai-viewclose").show();b.$mjListPage.find(".jkoubai-viewnoclose").hide()}else{b.$mjListPage.find(".jkoubai-viewclose").hide();b.$mjListPage.find(".jkoubai-viewnoclose").show()}b._getPriceEmpty(c);b._getTotal(c)},_getPriceEmpty:function(c){var b=this;if(c.priceempty=="1"){b.$mjListPage.find(".jkoubai-total-priceempty").text("* ")}else{b.$mjListPage.find(".jkoubai-total-priceempty").text(" ")}},_getTotal:function(c){var b=this;b.$mjListPage.find(".jkoubai-total").text(desknets.numberFormat(parseInt(c.total,10)))},_listLine:function(c,d){var b=this;c=b.callBase("_listLine",c,d);var e=desknets.paramanalyzer.getHashParams();c=desknets.tmpl.replaceWord(c,"date",e.date);c=desknets.tmpl.replaceWord(c,"koubaiid",e.id);c=desknets.tmpl.replaceWord(c,"cmdorder",b.koubaiOrderCmd());var h="jco-modlink";if(b.mboEnd){h="jkoubai-list-modlink"}c=desknets.tmpl.replaceWordHtml(c,"modlink",h);var g="";var f="";if(d.price!=""){g=Number(d.price)+Number(d.tax);f=g*Number(d.amount);f=desknets.numberFormat(parseInt(f,10))}c=desknets.tmpl.replaceWordHtml(c,"sum",f);return c},_replaceListLine:function(c,g,d){var b=this;var f;var e;if(g==="status"){if(d[g]=="2"){e=desknets.Resource.koubai.stscancel}else{if(d[g]=="1"){e=desknets.Resource.koubai.stsordered}else{if(d.amount!="0"){e=desknets.Resource.koubai.stsorder+'&nbsp;<span title="'+desknets.Resource.koubai.stsorder+'" class="koubai-unordered">'+desknets.Resource.koubai.stsordernot+"</span>"}else{e=desknets.koubai.stsnot}}}c=desknets.tmpl.replaceWordHtml(c,g,e)}else{if(g==="price"){if(d[g]!=""){e=desknets.numberFormat(parseInt(d[g],10))}else{e=""}c=desknets.tmpl.replaceWordHtml(c,g,e)}else{if(g==="tax"){if(d[g]!=""){e=desknets.numberFormat(parseInt(d[g],10))}else{e=""}c=desknets.tmpl.replaceWordHtml(c,g,e)}else{return b.callBase("_replaceListLine",c,g,d)}}}return c},_getKoubaiParam:function(){var c=desknets.paramanalyzer.getHashParams();var b={};b.id=c.id;b.date=c.date;return b},_getAddPageParam:function(){return this._getKoubaiParam()},_getModPageParam:function(){return this._getKoubaiParam()},_getDispPageParam:function(){return this._getKoubaiParam()},_getDelAddPrm:function(){var b=this;var c=b._getKoubaiParam();c.status=b.msShohinSts;return c},inputDispPage:function(e){var b=this;var d="";var c={};d=b._getListDispCmd();c=b._getDispPageParam();c.cmd=d;c[b._getIDName()]=e;b._inputPage(c)},_getMoveParam:function(){var b={};var c=desknets.paramanalyzer.getHashParams();b.koubaiid=c.id;return b},_getIDName:function(){return"shohinid"},_getIdListPage:function(){return"jco-m-disp-page"},_getIdListPageForm:function(){return"dispfrm"},_getRestModule:function(){return desknets.koubai.MODULE_API_KOUBAI},koubaiModCmd:function(){return desknets.koubai.PAGE_KOUBAIMGENTRY},koubaiOrderCmd:function(){return desknets.koubai.PAGE_KOUBAIMGORDER},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIMGREFER},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGREFER},_getListAddCmd:function(){return desknets.koubai.PAGE_KOUBAIMGSHOHINENTRY},_getListModCmd:function(){return desknets.koubai.PAGE_KOUBAIMGSHOHINENTRY},_getListDispCmd:function(){return desknets.koubai.PAGE_KOUBAIMGSHOHINREFER},_getDelExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGSHOHINSTS},_getKoubaiEndCmd:function(){return desknets.koubai.CMD_KOUBAIMGEND},_getMoveExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGMVSHOHI},_getPrintCmd:function(){return desknets.koubai.PAGE_KOUBAIMGPRINT},_getPrintExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGPRINT}});desknets.page(desknets.koubai,"koubaimgshohinentry",desknets.koubai.koubairvshohinentry,{_getAreaTitle:function(b){return b.find(".jco-title-mg").val()},_getDelExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGSHOHINDEL},_getAddExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGSHOHINENTRY}});desknets.page(desknets.koubai,"koubaimgshohinrefer",desknets.koubai.koubairvshohinrefer,{_getAreaTitle:function(b){return b.find(".jco-title-mg").val()},_getDispExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGSHOHINREFER},_getDispModCmd:function(){return desknets.koubai.PAGE_KOUBAIMGSHOHINENTRY},_getDelExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGSHOHINDEL}});desknets.page(desknets.koubai,"koubaimgorder",desknets.PageListBase,{_initListEndChk:function(){var b=this;b.$mjListPage.find(".co-table-list").find("thead").delegate(".jco-checkbox-all","click",function(d){var c=(a(this).attr("checked"))?true:false;b.$mjTableList.find("input[type=checkbox]").attr("checked",c);if(c){b.$mjTableList.find("tr").addClass("co-tr-selected")}else{b.$mjTableList.find("tr").removeClass("co-tr-selected")}if(b.$mjListPage.find(".jco-sort-change").css("display")!="block"){if(c){b.$mjListPage.find(".co-chk-cnt-some").hide();b.$mjListPage.find(".co-chk-cnt-all").show()}else{b.$mjListPage.find(".co-chk-cnt-some").hide();b.$mjListPage.find(".co-chk-cnt-all").hide()}}});b.$mjListPage.find(".co-chk-cnt-all").find("a").remove()},_listAllChkDataCnt:function(){var b=this;var d=b.$mjListPage.find(".jco-pv-cnt").val();var e=b.$mjListPage.find(".jco-pv-all-cnt").val();b.$mjListPage.find(".jco-span-chk-msg-page").html(d);var c=desknets.Resource.Message.com_listchk_cnt_all_disp;c=desknets.tmpl.replaceWordLF(c,"num",d+" ");b.$mjListPage.find(".jco-span-chk-msg-all").html(c);return},initPage:function(d,c){var b=this;b.boGetHtmlSingle=false;b.callBase("initPage",d,c)},_initListStart:function(){var b=this;b.callBase("_initListStart");b._initListStartNumInput()},_initListStartNumInput:function(){var b=this;b.$mjTableList.delegate(".jkoubai-amount","change",function(f){var g=a(this);var e=g.closest("tr");var d=e.find(".jkoubai-amount").val();var c=e.find(".jco-id").val();e.find('input[name="amount"]').val(c+"_"+d)})},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".jkoubai-disp-disparea-button").delegate(".jco-input-list-page","click",function(c){c.preventDefault();b.koubaiBackListPage()});b.$mjListPage.find(".jkoubai-disp-disparea-button").delegate(".jco-input-del-submit-conf","click",function(c){b._listDelSubmit(c)});b.$mjListPage.find(".jkoubai-order-submit").click(function(c){b.$mjListPage.find('input[name="cmd"]').val(b.getSubmitCmd())});b._initSetAjaxFrom()},_initSetAjaxFrom:function(){var c=this;var d={};var b=desknets.koubai.MODULE_API_KOUBAI+"."+desknets._msExtension;a("#referorderfrm").attr("action",b);d=c._getAjaxFormOption();c._initFormRequestAjax("#referorderfrm",d)},_getAjaxFormOption:function(){var b=this;var c={};c={success:function(e,d,f){b._onAjaxFormSuccess(e);desknets.submitform.clearDisabled(b.$mjListPage)},validation:function(d){var e=b.checkInput(d);if(neo.isSet(e,{blank:false})){desknets.dialog.alert(e);return false}return true}};return c},checkInput:function(c){var b=this;var e=null;var d=0;c.find(".jco-validation-number").each(function(){d++;if(!desknets.validation.isNumber(a(this).val())){var f={};f.msg=desknets.Resource.Message.com_invalid_number;f.fieldid="amount";f.fieldname=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.koubai_ordermg,"count",d)+desknets.merrMsgConnect;e=desknets.getErrConvMsg(f);return false}});return e},_onAjaxFormSuccess:function(c){var b=this;b.koubaiBackListPage()},koubaiBackListPage:function(){var b=this;var c={};if(!neo.isSet(b.mBackCmd)||!neo.isSet(b.mIdBack)){return null}var d=a("#"+b.mIdBack).find(".jco-back-page-data");if(d.length>0){c=desknets.getInputDataToObj(d)}else{arTmp=desknets.paramanalyzer.getHashParams();c.date=arTmp.date;c.id=arTmp.id}c.cmd=b.mBackCmd;if(neo.isSet(c)){b._setLocationHash(c)}return null},_getListAjaxSuccessOtherSet:function(c){var b=this;a("#"+b._getIdListPageForm()+" .jco-disp-disparea").html(b.$mjListPage.find(".jco-disp-tmplset").tmpl(c));a("#"+b._getIdListPageForm()+" .jkoubai-disp-disparea-button").html(b.$mjListPage.find(".jkoubai-disp-tmplset-button").tmpl(c));if(c.close=="1"){b.$mjListPage.find(".jkoubai-amount").each(function(){a(this).closest("tr").find("span").text(a(this).val());a(this).hide()})}else{b.$mjListPage.find(".jco-input-add-submit").show()}b.$mjListPage.find(".jkoubai-order-0").find(".jkoubai-amount").attr("disabled",true)},_getIDName:function(){return"userid"},_getIdListPage:function(){return"jkoubai-m-order-container"},_getIdListPageForm:function(){return"referorderfrm"},_getDelAddPrm:function(){var b={};var c=desknets.paramanalyzer.getHashParams();b.id=c.id;b.date=c.date;b.shohinid=c.shohinid;return b},_getRestModule:function(){return desknets.koubai.MODULE_API_KOUBAI},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIMGORDER},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGORDER},getSubmitCmd:function(){return desknets.koubai.CMD_KOUBAIMGORDERENTRY},_getDelExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGORDERDEL}});desknets.page(desknets.koubai,"koubaimgsearch",desknets.koubai.koubaimglist,{initLeftTree:function(){},_setListviewHeight:function(b){},_listMoveScroll:function(){var c=this._getListCmd();var b=desknets.scrollManager.$scrollRoot;desknets.scrollManager.setScrollPosition(c,b,{y:0,delay:10})},_getIdListPage:function(){return"jkoubai-srch-mg"},_getIdListPageForm:function(){return"searchfrmmg"},_getListCmd:function(){return desknets.koubai.PAGE_KOUBAIMGSEARCH},_getListExecCmd:function(){return desknets.koubai.CMD_KOUBAIMGSEARCH}});app.addInitialAction(function(){desknets.koubai.init()})})(jQuery);