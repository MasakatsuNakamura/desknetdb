/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.portalset={MODULE_MAIN:"zportalset",MODULE_API_MAIN:"zrportalset",PAGE_PORTALSETADMIN:"portalsetadmin",PAGE_GROUP_LIST:"portalmsetlist",CMD_GROUP_LIST:"portalmsetcmdlist",PAGE_GROUP_DESIGN:"portalmsetdesigngrp",CMD_DELETE_GROUP_PORTAL:"portalmsetdelgrp",PAGE_M_CONTENT_ENTRY:"portalmsetcontententry",CMDS_MSET_FOLDER:{listCMD:"portalmsetcmdfoldersroot",listchildCMD:"portalmsetcmdfolders",entryCMD:"portalmsetcmdfolderentry",moveparentCMD:"portalmsetcmdfolderpmove",movebetweenCMD:"portalmsetcmdfoldermove",delCMD:"portalmsetcmdfolderdel"},CMDS_PSET_FOLDER:{listCMD:"portalpsetcmdfoldersroot",listchildCMD:"portalpsetcmdfolders",entryCMD:"portalpsetcmdfolderentry",moveparentCMD:"portalpsetcmdfolderpmove",movebetweenCMD:"portalpsetcmdfoldermove",delCMD:"portalpsetcmdfolderdel"},CMDS_MSET_BOOKMARK:{listPage:"portalmsetbookmarklist",listCMD:"portalmsetcmdbookmarklist",searchListPage:"portalmsetbookmarksearchlist",searchListCMD:"portalmsetcmdbookmarksearchlist",entryPage:"portalmsetbookmarkentry",entryCMD:"portalmsetcmdbookmarkentry",moveCMD:"portalmsetcmdbookmarkmove",moveFolderCMD:"portalmsetcmdfoldermoveindex",delCMD:"portalmsetcmdbookmarkdel"},CMDS_PSET_BOOKMARK:{listPage:"portalpsetbookmarklist",listCMD:"portalpsetcmdbookmarklist",searchListPage:"portalpsetbookmarksearchlist",searchListCMD:"portalpsetcmdbookmarksearchlist",entryPage:"portalpsetbookmarkentry",entryCMD:"portalpsetcmdbookmarkentry",moveCMD:"portalpsetcmdbookmarkmove",moveFolderCMD:"portalpsetcmdfoldermoveindex",delCMD:"portalpsetcmdbookmarkdel"},init:function(){var c=a("#jco-pv-funcid").val();var b=desknets.portalset[c];desknets.portalset.contentUtil.init();desknets.pageframe.setFuncSel(c);if(a("#portalset-bookmark-search").length>0){desknets.portalset.bookmarkSearch.init()}desknets.hashobserver.init(desknets.portalset);if(!!b){desknets.portalset[c].init()}},replaceOffLabel:function(b,d){var c=!!Number(d)?"hideLabel":"showLabel";return desknets.tmpl.replaceWordHtml(b,"off_label",desknets.Resource[c])},getPagePrivilege:function(){var b=String(a("#jco-pv-funcid").val());if(b.indexOf("portalset")==0){return"set"}else{if(b.indexOf("portalmset")==0){return"mset"}else{return""}}}};desknets.portalset.contentUtil={_TMPL_CONTENT:'<div data-id="{{id}}" class="portalset-content portalset-draggable-content"><div class="portal-content-titlebar"><h3 class="portal-content-title">::::::::</h3><a href="#" class="portal-content-close" title="{{L_Remove}}">x</a></div><div class="portal-content-body"><a href="#" class="portal-content-delete" title="{{L_Delete}}">{{L_Delete}}</a><a href="#" class="portal-content-note co-drop-down-button" data-for="portal-content-memo-{{id}}" data-position="bottom">!</a><a href="#" class="portal-content-body-text"><span class="portal-content-name"></span></a></div><div class="co-pop-up-box co-baloon co-baloon-at-bottom-right" id="portal-content-memo-{{id}}"><div class="co-baloon-connecter"><div class="co-baloon-connecter-inner"></div></div><div class="co-baloon-body"></div></div></div>',init:function(){var c=desknets.Resource;var b=this._TMPL_CONTENT;b=desknets.tmpl.replaceWordHtml(b,"L_Delete",c.delLabel);b=desknets.tmpl.replaceWordHtml(b,"L_Remove",c.removeLabel);this._TMPL_CONTENT=b},set:function(g,e,b){var f=(g>0)?"shared":"private";var d=a("#jportalset-"+f+"-user-contents");var c=this.getById(d,g);if(c.length>0){this.modify(c,e,b)}else{this.add(d,g,e,b)}},add:function(e,g,d,b){var c,f;f=this._TMPL_CONTENT;f=desknets.tmpl.replaceWordHtml(f,"id",g);c=a(f).appendTo(e);this._setText(c,d,b);this.setUp(c)},modify:function(d,c,b){this._setText(d,c,b);this._updateNotePopUp(d)},confirmToDeleteData:function(e,c){var b=this;var d=desknets.Resource.Message.com_del_conf;desknets.dialog.confirm(d,function(){b._deleteData(e,function(){b.deleteById(e);if(typeof(c)=="function"){c()}})})},setColor:function(d,b){var e=d.data("color");var c=b.find("input:checked").val();if(!!e){d.removeClass("portal-content-color-"+e)}d.addClass("portal-content-color-"+c);d.data("color",c)},setUp:function(b){var c=b.find(".co-baloon");c.find(".co-baloon-body").text(c.data("memo"));b.closest(".co-m-content").append(c);this._setUpDraggable(b);this._updateNotePopUp(b)},tearDown:function(b){if(b.hasClass("ui-draggable")){b.draggable("destroy")}},getById:function(b,c){return b.find(".portalset-content").filter(function(){return a(this).data("id")==c})},deleteById:function(d){var c=a("#portalset-user-contents");var b=this.getById(c,d);if(b.length>0){this.tearDown(b);b.remove()}},getNote:function(b){var c=b.find(".portal-content-note").data("for");if(!c){return}return a("#"+c).data("memo")},_setUpDraggable:function(b){b.draggable({disabled:b.hasClass("portalset-in-portal"),appendTo:".sortable-container",connectToSortable:".portal-column",helper:"clone",scroll:false})},_setText:function(d,c,b){var f=d.find(".portal-content-note").data("for");d.find(".portal-content-name").text(desknets.escapeSpace(c,true));if(!!f){var e=a("#"+f);e.data("memo",b);e.find(".co-baloon-body").text(b)}},_updateNotePopUp:function(b){var c=this.getNote(b);if(!!c){b.removeClass("portalset-no-note")}else{b.addClass("portalset-no-note")}},_deleteData:function(d,c){var b=(d<0)?"portalpsetcontentdel":"portalmsetcontentdel";desknets.ajax.rest({url:desknets.getUrl(desknets.portalset.MODULE_API_MAIN),data:{cmd:b,id:Math.abs(d)},success:c})}};desknets.page(desknets.portalset,"bookmarkFolder",desknets.folderlist,{_tmplInitItem:'<li {{idName}}="{{id}}" class="co-listview-item"><a href="#" class="co-listview-item-inside {{MoveClass}}"><img src="{{iconUrl}}" />{{Name}}</a>{{F_Ul}}</li>',_tmplFItem:'<li {{idName}}="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside {{MoveClass}} {{Drag}}"><img src="{{iconUrl}}" />{{Name}}</a></li>',_initfid:0,init:function(e,c,b){this.callBase("init",e,c,b);var f=a.extend({},c,{entryCMD:b.entryCMD});var d=a.extend({},c,{delCMD:b.delCMD});desknets.portalset.bookmarkFolderEntry.init(e,f);desknets.portalset.bookmarkFolderDelete.init(e,d)},refresh:function(c,b){this.$_tree.off("refresh.jstree");this.$_tree.on("refresh.jstree",function(){if(a.isFunction(b)){b(c)}});this.$_tree.jstree("refresh",c)},_createSideTree:function(){var b=this;b.callBase("_createSideTree");b.$_tree.bind("loaded.jstree",function(){var c=b.$_tree.find("> ul > li");if(c.find("li").length<=0){c.removeClass("jstree-closed").addClass("jstree-leaf")}if(c.find("a.on").length<=0){c.children("a").addClass("on")}})},_selectFirstItem:function(b){},_createFolderSetMenu:function(b){var d=b.closest("li").data("fid")=="0";var c=this.$_setMenu;c.empty();if(!d){c.prepend(a(this._tmpMenuDel));c.prepend(a(this._tmpMenuMod))}c.prepend(a(this._tmpMenuAdd))},_setButtonErea:function(b){var c=this.$_root.find(".co-listview-left-subtitle>button");var d=b.closest("li").data("fid")=="0";c.each(function(){this.disabled=d&&this.className!="jco-litview-item-add"})},_getItemHtml:function(c,b){c=this.callBase("_getItemHtml",c,b);c=desknets.tmpl.replaceWordHtml(c,"iconUrl",String(b.filename));return c}});desknets.page(desknets.portalset,"bookmarkFolderEntry",desknets.folderlist.dialog_entry,{_TMPLDIALOG:"portalset/folder.html",$dialog:a(),_$form:a(),_$icon:a(),_$parentLi:a(),_modId:null,_blockToSubmit:true,_defIcon:"",create:function(f,d){var b=this;var c=b._getDialogOptions();var e=desknets.dialog.make("portalset-folder-entry",c);desknets.tmpl.load(e,this._TMPLDIALOG,function(){b.$dialog=e;b._setUp();b.show(f,d)})},show:function(d,c){var b="menuFolderAdd";d=d||desknets.portalset.bookmarkFolder.$_tree.find("li:first");this._resetEntries();if(c=="mod"){b="menuFolderMod";this._setEntriesToModify(d)}else{this._setEntriesToAdd(d)}this.$dialog.dialog("option","title",desknets.Resource.folderlist[b]);this.$dialog.dialog("open")},_createFolderDialog:function(){},_setEntryButton:function(d,c){var b=this._searchOnItem();this._onSuccess_Dlg(b,c)},_onSuccess_Dlg:function(c,b){if(this.$dialog.length<=0){this.create(c,b)}else{this.show(c,b)}},_getDialogOptions:function(){var b=this;var c=a.extend(desknets.dialog.getDialogOption(),{buttons:{},width:500});c.buttons[desknets.Resource.OKButtonLabel]=function(){b._blockToSubmit=false;b._$form.submit()};c.buttons[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};return c},_setUp:function(){var b=this;b._$form=b.$dialog.find("form");b._$icon=this._$form.find(".portalset-folder-icon-entry>.co-etd");b._defIcon=this._$form.find("#jportalset-folder-delete-icon").val();b._$form.attr("action",desknets.getUrl(desknets.portalset.MODULE_API_MAIN));desknets.ajax.submitForm(b._$form,{dataType:"xml",beforeSubmit:function(){if(b._blockToSubmit){return false}b._onBeforeSend()},success:function(d,c,e){b._onSuccess(a(d))},errorconvmsg:function(c,d){return b._convertErrorMessage(c,d)},complete:function(){b._onComplete();b._blockToSubmit=true}})},_resetEntries:function(){if(this._$form.length>0){this._$form.find('input[name="cmd"]').val(this._options.entryCMD);this._setValue('input[name="folder"]');this._setValue('input[name="Name"]',"");this._setValue('input[name="pfolder"]',"0");this._resetFileEntry();this._$form.find("img").attr("src",this._defIcon);this._$icon.removeClass("portalset-folder-has-icon")}},_resetFileEntry:function(){var b=this._$form.find('input[name="attach"]');a('<input type="file" name="attach" />').insertBefore(b);b.remove()},_setEntriesToAdd:function(c){var b=c.data("fid");this._$parentLi=c;this._modId=null;this._setValue('input[name="pfolder"]',b)},_setEntriesToModify:function(f){this._$parentLi=f.parent().closest("li");var e=f.data("fid");this._modId=e;var d=desknets.folderlist.getItemTitle(f);var c=this._$parentLi.data("fid");var b=f.find(">a>img").attr("src");this._setValue('input[name="folder"]',e);this._setValue('input[name="Name"]',d);this._setValue('input[name="pfolder"]',c);this._$form.find("img").attr("src",b);if(b.indexOf("/")!=0){this._$icon.addClass("portalset-folder-has-icon")}},_onBeforeSend:function(){desknets.submitform.setDialogDisabled(this.$dialog)},_onSuccess:function(c){var b=this,d=Number(c.find("folder").text());this.$dialog.dialog("close");desknets.portalset.bookmarkFolder.refresh(this._$parentLi,function(){if(b._$parentLi.closest("li").is(".jstree-open")){setTimeout(function(){b._selectTarget(d)},1)}else{b._$parentLi.closest(".jstree").jstree("open_node",b._$parentLi,function(){b._selectTarget(d)})}})},_selectTarget:function(d){var b=desknets.paramanalyzer.getHashParams();if(!b.folder||b.folder!=d){desknets.paramanalyzer.setLocationHash(a.extend(b,{folder:d}))}else{var c=desknets.portalset.bookmarkFolder.$_tree;desknets.portalset.bookmarkFolder.onSelectItemNoAjax(c,d)}},_convertErrorMessage:function(c,d){var b=desknets.getErrField(c,d);if(!!b.fieldid){b.fieldname=desknets.getErrFieName(this._$form,b.fieldid)}return desknets.getErrConvMsg(b)},_onComplete:function(){desknets.submitform.clearDialogDisabled(this.$dialog)},_setValue:function(b,c){var d=this._$form.find(b);if(typeof c=="undefined"){d.attr("disabled",true);d.val("")}else{d.attr("disabled",false);d.val(c)}}});desknets.page(desknets.portalset,"bookmarkFolderDelete",desknets.folderlist.dialog_delete,{_delConfAddMessage:function(){return desknets.Resource.Message.portalset_folder_delconfadd},_getRestModule:function(){return desknets.portalset.MODULE_API_MAIN},_getFolderDelCmd:function(){return this._options.delCMD}});desknets.page(desknets.portalset,"infoCategoryTree",desknets.tree,{TMPL_START:"<ul>",TMPL_ITEM:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside">{{name}}</a></li>',TMPL_END:"</ul>",_apiUrl:"",_priv:"",init:function(c,b){this._apiUrl=desknets.getUrl("zrinfo");this._priv=desknets.portalset.getPagePrivilege();a.extend(this._defOptions,{idName:"data-id",isLag:false});this.callBase("init",c,b)},_getSideTreeList:function(c){var b=this;desknets.ajax.rest({url:b._apiUrl,data:{cmd:"info"+b._priv+"catelist"},success:function(d){b._createTree(c,b._getHtmlFromJson(d))}})},_createTree:function(d,c){var b=this;d.jstree({plugins:["html_data"],html_data:{data:c,ajax:{dataType:"json",url:b._apiUrl,data:function(e){return b._getRequestParams(e)},success:function(e){if(!e||e.status=="ng"){desknets.ajax.onError(e.errorno,e.errormessage);return desknets.tree.TMPL_FOLDER_DUMY}return b._getHtmlFromJson(e)},error:function(g,e,f){desknets.ajax.onError(g.status,neo.ajax.getErrorMessage(g))}}}});d.bind("loaded.jstree",function(){desknets.tree.deleteDumyItem(d)});d.closest(".co-listview-tree").show();setTimeout(function(){b._updateItemsWidth()},0)},_getRequestParams:function(d){var b=a.cookie(desknets.COOKIENAME_STOKEN);var c={cmd:"info"+this._priv+"catelistchild",pfolder:d.data("id")};c[String(b)]="1";return c},_getHtmlFromJson:function(e){var c=this;var d=[c.TMPL_START];var b=desknets.ajax.getJsonItems(e);if(b.length<=0){return desknets.tree.TMPL_FOLDER_DUMY}a.each(b,function(f,g){var j=c.TMPL_ITEM;var h=Number(g.children)>0?"closed":"leaf";j=desknets.tmpl.replaceWordHtml(j,"id",g.id);j=desknets.tmpl.replaceWordHtml(j,"state",h);j=desknets.tmpl.replaceWord(j,"name",g.Name);d.push(j)});d.push(c.TMPL_END);return d.join("")}});desknets.page(desknets.portalset,"DesignBase",desknets.PageInputBase,{$leftMenu:a(),$centerPage:a(),$rightMenu:a(),cmdContentEntry:"portalmsetcontententry",defaultUserName:"",defaultGroupName:"",_$changedInput:a(),_pschContentIDs:[1,1011,1012,1014],_gschContentIDs:[1010,1013],_plantContentIDs:[3,1020,1021,1022],_scrollableContentIDs:[1030,7,1001],_initSet:function(){this.callBase("_initSet");this._setUp()},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.beforeSerialize=function(d,e){var f={block:b._getBlockParams(),content:b._getPortalContentParams()};e.data=a.extend(f,e.data)};return c},funcBeforeHashChange:function(){var b=desknets.paramanalyzer.getExecCmd();if(b==this.cmdContentEntry){return false}return this.callBase("funcBeforeHashChange")},activatePage:function(){var c=this;var b=a(window).data("hashobserver");this.changPage();this._setTitle(this._getAreaTitle(this.$mjPage));desknets.moveScroll();this._initBeforeUnload();if(b){b.beforeHashChangeFunc=function(){return c.funcBeforeHashChange()}}},setUpPortalContent:function(b){var c=b.data("id");if(a.inArray(c,this._pschContentIDs)>=0){this._setUpSchPortalContent(b,c,"psch",this.defaultUserName)}else{if(a.inArray(c,this._gschContentIDs)>=0){this._setUpSchPortalContent(b,c,"gsch",this.defaultGroupName)}}},_setUp:function(){this.$leftMenu=this.$mjPage.find(".portalset-left-menu");this.$centerPage=this.$mjPage.find(".portalset-center-pane");this.$rightMenu=this.$mjPage.find(".portalset-right-menu");this._$changedInput=this.$mjPage.find('input[name="changed"]');this._setUpLeftMenu();this._setUpCenterPanel();this._setUpRightMenu();desknets.portalset.PortalContent.init(this);desknets.portalset.PortalPschContent.init(this);desknets.portalset.PortalGschContent.init(this);desknets.portalset.PortalInfoCatContent.init(this);desknets.portalset.PortalPlantContent.init(this);desknets.portalset.PortalMenuContent.init(this)},_setUpLeftMenu:function(){var b=this;b.$leftMenu.find(".portal-block").draggable({appendTo:".sortable-container",connectToSortable:".portalset-pcontents",helper:"clone",start:function(){b.$centerPage.addClass("portalset-block-dragging")},stop:function(){b.$centerPage.removeClass("portalset-block-dragging")}});b.$leftMenu.find(".portalset-trash").droppable({accept:".portalset-sortable-block",activeClass:"ui-state-active",hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(c,d){b._removePortalBlock(d.draggable)}})},_setUpCenterPanel:function(){var b=this;b._showGuideBlockIfEmpty();b.$centerPage.find(".portalset-pcontents").sortable({connectWith:".portalset-trash",handle:".portalset-handle",placeholder:"portalset-block-placeholder",update:function(c,d){b._setToPortalBlock(d.item);b._markToChanged()}});b.$centerPage.find(".portal-column").each(function(){b._setUpPortalColumn(a(this))});b.$centerPage.bind("contentChanged",function(c){b._markToChanged()});b.$centerPage.delegate(".portal-content-close","click",function(c){c.preventDefault();b._removePortalContent(a(this).closest(".portal-content-pane"))});b.$centerPage.delegate(".portal-content-body-text","click",function(c){c.preventDefault();b._openPortalContent(a(this).closest(".portal-content-pane"))});b.$centerPage.find(".portal-content-pane").each(function(){b.setUpPortalContent(a(this))})},_setUpRightMenu:function(){var b=this;b.$rightMenu.find(".portalset-contents").tabs();b.$rightMenu.find(".portalset-content").each(function(){desknets.portalset.contentUtil.setUp(a(this))});b.$rightMenu.bind("dragstart",function(d){if(!a(d.target).draggable("option","disabled")){b.$centerPage.addClass("portalset-content-dragging")}});b.$rightMenu.bind("dragstop",function(d){b.$centerPage.removeClass("portalset-content-dragging")});b.$rightMenu.find(".portalset-contents").droppable({accept:".portal-content-pane",tolerance:"pointer",drop:function(d,e){b._removePortalContent(e.draggable)}});b.$rightMenu.find(".jportalset-add-content").click(function(d){b._goToContentEntryPage()});b.$rightMenu.delegate(".portal-content-body-text","click",function(d){d.preventDefault();b._goToContentEntryPage(a(this).closest(".portalset-content"))});b.$rightMenu.delegate(".portal-content-delete","click",function(d){d.preventDefault();var e=a(this).closest(".portalset-content").data("id");desknets.portalset.contentUtil.confirmToDeleteData(e)});if(a(document.documentElement).hasClass("co-browser-IE-10")){var c=b.$rightMenu.find(".portalset-content");a(window).on(desknets.EVENT_SCROLL,function(){c.css("position","static");setTimeout(function(){c.css("position","relative")},100)})}},_tearDown:function(){this.$leftMenu.find(".portal-block").draggable("destroy");this.$leftMenu.find(".portalset-trash").droppable("destroy");this.$centerPage.find(".portalset-pcontents").sortable("destroy");this.$centerPage.undelegate(".portal-content-close","click");this.$centerPage.undelegate(".portal-content-body-text","click");this.$centerPage.unbind("contentChanged");this.$centerPage.find(".portal-column").each(function(){a(this).sortable("destroy")});this.$rightMenu.unbind("dragstart");this.$rightMenu.unbind("dragstop");this.$rightMenu.find(".portalset-contents").droppable("destroy");this.$rightMenu.find(".jportalset-add-content").unbind("click");this.$rightMenu.undelegate(".portal-content-body-text","click");this.$rightMenu.undelegate(".portal-content-delete","click");this.$rightMenu.find(".portalset-content").each(function(){desknets.portalset.contentUtil.tearDown(a(this))})},_setToPortalBlock:function(e){var f,b;if(e.hasClass("portalset-draggable-block")){var d=Number(e.data("columns"));e.removeClass("portalset-draggable-block ui-draggable");e.removeAttr("title");e.children(".portalset-icon").remove();e.addClass("portalset-sortable-block portal-block-"+d+"-columns");b=a('<div class="portal-columns" />').appendTo(e);for(var c=1;c<=d;c++){f=a('<div class="portal-column portal-column-'+c+'" />');f.appendTo(b);this._setUpPortalColumn(f)}this._showGuideBlockIfEmpty()}},_removePortalBlock:function(d){var b=this;var c=d.find(".portalset-content");if(c.length<=0){setTimeout(function(){b._removePortalBlockElement(d)},1);return}desknets.dialog.confirm(desknets.Resource.Message.com_del_conf,function(){c.each(function(){b._removePortalContent(a(this))});b._removePortalBlockElement(d)})},_removePortalBlockElement:function(b){b.find(".portal-column").each(function(){a(this).sortable("destroy")});b.remove();this._showGuideBlockIfEmpty();this._markToChanged()},_showGuideBlockIfEmpty:function(){if(this.$centerPage.find(".portal-block").length>0){this.$centerPage.addClass("portalset-has-blocks")}else{this.$centerPage.removeClass("portalset-has-blocks")}},_setUpPortalColumn:function(c){var b=this;c.sortable({connectWith:".portal-column",handle:".portal-content-titlebar",appendTo:".portalset-center-pane",helper:"clone",placeholder:"portal-content-placeholder",scroll:false,receive:function(d,e){a(e.item).addClass("portalset-in-portal").draggable("option","disabled",true)},update:function(d,e){b._setToPortalContent(e.item);b._markToChanged()}})},_setToPortalContent:function(c){if(c.hasClass("portalset-draggable-content")){var f=c.data("id");var b=desknets.portalset.contentUtil.getNote(c);var e=c.find(".portal-content-name");var d=this.$mjPage.find(".jportalset-colors");c.removeClass("portalset-draggable-content ui-draggable");c.find(".portal-content-delete,.portal-content-note,.co-baloon").remove();c.addClass("portal-content-pane");e.attr("title",desknets.escapeSpace(String(e.text()),true));e.data("memo",b);desknets.portalset.contentUtil.setColor(c,d);if(a.inArray(f,this._plantContentIDs)>=0){this._openPortalContent(c)}}this.setUpPortalContent(c)},_setUpSchPortalContent:function(e,i,f,d){var g=e.find(".portal-content-body-text");var h=e.find("input.jportal-content-attr-value");var b=desknets.Resource.portalset["contentAttrFormat_"+f];var c=!!Number(h.val())?String(h.data("name")):d;if(!!c){b=desknets.tmpl.replaceWordHtml(b,"name",desknets.escapeSpace(c,true));g.children(".portal-content-subtext").remove();a('<span class="portal-content-subtext" />').text(b).attr("title",b).prepend("<br />").appendTo(g)}},_openPortalContent:function(b){var c=b.data("id");if(c==1000){desknets.portalset.PortalMenuContent.open(b)}else{if(c==6){desknets.portalset.PortalInfoCatContent.open(b)}else{if(a.inArray(c,this._plantContentIDs)>=0){desknets.portalset.PortalPlantContent.open(b)}else{if(a.inArray(c,this._pschContentIDs)>=0){desknets.portalset.PortalPschContent.open(b)}else{if(a.inArray(c,this._gschContentIDs)>=0){desknets.portalset.PortalGschContent.open(b)}else{if(a.inArray(c,this._scrollableContentIDs)>=0){desknets.portalset.PortalScrollableContent.open(b)}else{desknets.portalset.PortalContent.open(b)}}}}}}},_removePortalContent:function(c){var b=desknets.portalset.contentUtil.getById(this.$rightMenu,c.data("id"));b.removeClass("portalset-in-portal");b.draggable("option","disabled",false);c.remove();this._markToChanged()},_getPlantListParams:function(){return{}},_getInfoCatListParams:function(){return{}},_getMenuListParams:function(){return{}},_getMenuChoosableListParams:function(b){return{cmd:b=="optmenu"?"portalmsetoptwinlist":"portalmsetmodulelist"}},_goToContentEntryPage:function(b){var c={cmd:this.cmdContentEntry};if(!!b){if(b.hasClass("portalset-read-only")){return}c.id=Math.abs(b.data("id"))}this._setLocationHash(c)},_getBlockParams:function(){var b=[];this.$centerPage.find(".portal-block").each(function(){var c=a(this).attr("class")||"";var d=c.match(/portal-block-(\d)-(\d)/,"$1$2");if(!!d&&d.length>=3){b.push(d[1].concat(d[2]))}});return b},_getPortalContentParams:function(){var b=[];this.$centerPage.find(".portal-block").each(function(c){a(this).find(".portal-column").each(function(d){a(this).find(".portal-content-pane").each(function(f){var g=a(this);var h=g.data("id");var e=g.data("color");b.push([h,c,d,f,e].join(","))})})});return b},_markToChanged:function(){this._$changedInput.val((new Date()).getTime())}});desknets.portalset.DesignSetBase={mboHasMceEditor:true,initParamsFromHash:function(c){var b=c.cmd?c.cmd:"";this.callBase("initParamsFromHash",c);if(b==this.cmdContentEntry){desknets.portalset[b].initPage(this._getBaseHashCmd(),this._getIdPage())}else{this.activatePage()}},dispBackListPage:function(){desknets.execLocation(desknets.getUrl(desknets.MODULE_MAIN))},_initSet:function(){this.callBase("_initSet");var b=desknets.paramanalyzer.getHashParams();if(!!b&&!!b.cmd){this.$mjPage.hide();this.initParamsFromHash(b)}},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");var d=Number(this.$mjPage.data("save-default"))>0;c.success=function(){b._tearDown();desknets.portal.setShownPortal(b._getPortalTabKey(),d);desknets.execLocation(desknets.getUrl(desknets.MODULE_MAIN))};return c},_getPortalTabKey:function(){}};desknets.page(desknets.portalset,"PortalContent",null,{id:"portalset-pcontent-dialog",tmplFileName:"portalset/pcontent.html",page:null,isCreated:false,$root:null,$content:null,init:function(b){this.page=b},open:function(b){this.$content=b;if(!!this.isCreated){this.show()}else{this.create()}},create:function(){var b=this;b.$root=desknets.dialog.make(b.id,b.getDialogOption());desknets.tmpl.load(b.$root,b.tmplFileName,function(){b.setUp()})},setUp:function(){this.show()},show:function(){this.setDialogValues();this.$root.dialog("open");this.isCreated=true},getDialogOption:function(){var b=this,d=desknets.Resource;var c=a.extend(desknets.dialog.getDialogOption(),{title:d.portalset.pcontentDialogTitle,width:500,buttons:{}});c.buttons[d.OKButtonLabel]=function(){b.$root.dialog("close");b.setContentValues()};c.buttons[d.CancelButtonLabel]=function(){b.$root.dialog("close")};return c},setDialogValues:function(){var c=this.$content.find(".portal-content-name");var d=this.$content.data("color");var b=desknets.tmpl.escapeWordLF(String(c.data("memo")));this.$root.find(".jportalset-title").text(c.attr("title"));this.$root.find('input[name="contentcolor"][value="'+d+'"]').attr("checked",true);this.$root.find(".portalset-content-memo").html(b)},setContentValues:function(){var b=this.$root.find(".jportalset-colors");desknets.portalset.contentUtil.setColor(this.$content,b);this.$content.trigger("contentChanged")},getAttrInput:function(){var b=this.$content.find(".jportal-content-attr-value");if(b.length<=0){b=a('<input type="hidden" class="jportal-content-attr-value" />').attr("name","c"+this.$content.data("id")+"_attr").appendTo(this.$content)}return b}});desknets.page(desknets.portalset,"PortalInfoCatContent",desknets.portalset.PortalContent,{TMPL_CONTENT:'<input type="hidden" name="c{{cid}}_id" value="{{id}}" data-name="{{name}}" />',id:"portalset-pcontent-infocat-dialog",tmplFileName:"portalset/pcontentInfoCat.html",_apiUrl:"",_$noSelected:a(),_$selected:a(),_entries:{},setUp:function(){this._apiUrl=desknets.getUrl(desknets.portalset.MODULE_API_MAIN);this._$noSelected=this.$root.find(".portalset-no-selected");this._setUpSelected();this._setUpTree()},show:function(){this.setDialogValues()},setDialogValues:function(){this.callBase("setDialogValues");var b=this.$content.find(">.portal-content-body input");if(b.length>0){this._setSelectedFromElement(b);this.$root.dialog("open")}else{this._loadSelected()}},setContentValues:function(){this.callBase("setContentValues");this._saveInputToSend()},_setUpTree:function(){var b=this;var c=b.$root.find(".jportalset-info-cat-tree");c.find(".co-listview-items").bind("loaded.jstree",function(){b.show()});desknets.portalset.infoCategoryTree.init(c,{selFunc:function(e){var d=a.trim(e.children("a").text());b._toggleItem(e.data("id"),d)}})},_setUpSelected:function(){var b=this;b._$selected=b.$root.find(".jportalset-selected");b._$selected.delegate(".co-btn-close","click",function(c){c.preventDefault();b._removeItemByElement(a(this))})},_loadSelected:function(){var b=this;var c=b.page._getInfoCatListParams();if(!c){b._onLoadSelected({})}else{desknets.ajax.rest({url:b._apiUrl,data:c,success:function(d){b._onLoadSelected(d)}})}},_onLoadSelected:function(c){var b=desknets.ajax.getJsonItems(c);this._setSelected(b);this.$root.dialog("open");this.isCreated=true},_setSelectedFromElement:function(c){var b=[];c.each(function(){if(Number(this.value)>0){var d=a(this).data("name");b.push({id:this.value,Name:String(d)})}});this._setSelected(b)},_setSelected:function(c){var b={};for(var d=0;d<c.length;d++){b["_"+c[d].id]=c[d].Name}this._entries=b;this._replaceSelectedElement(c)},_replaceSelectedElement:function(b){var d=[];for(var c=0;c<b.length;c++){d.push(this._getItemHtml(b[c].id,b[c].Name))}this._$selected.html(d.join(""));this._fixSelectedElement()},_toggleItem:function(c,b){if(!!this._entries["_"+c]){this._removeItemById(c)}else{this._addItem(c,b)}},_removeItemById:function(c){var b=this._$selected.find('input[value="'+c+'"]').closest(".co-selitem");this._removeItem(c,b)},_removeItemByElement:function(b){var c=b.closest(".co-selitem");var d=c.find("input").val();this._removeItem(d,c)},_addItem:function(d,c){var b=a(this._getItemHtml(d,c));this._$selected.append(b);this._entries["_"+d]=c;this._fixSelectedElement()},_removeItem:function(f,c){var e={},b="_"+f;c.remove();for(var d in this._entries){if(d!=b){e[d]=this._entries[d]}}this._entries=e;this._fixSelectedElement()},_fixSelectedElement:function(){if(this._$selected.children().length>0){this._$noSelected.hide()}else{this._$noSelected.show()}},_getItemHtml:function(d,b){var c=desknets.selitem.getSelectedLabel();c=desknets.tmpl.replaceWordHtml(c,"idnm","id");c=desknets.tmpl.replaceWordHtml(c,"id",d);c=desknets.tmpl.replaceWord(c,"title",b);return c},_saveInputToSend:function(){var d=this.$content.data("id");var c=this.$content.children(".portal-content-body");var b=desknets.tmpl.replaceWordHtml(this.TMPL_CONTENT,"cid",d);c.find("input").remove();this._addInputsToSend(c,b)},_addInputsToSend:function(b,c){if(a.isEmptyObject(this._entries)){this._addInputToSend(b,c,0,"")}else{for(var d in this._entries){this._addInputToSend(b,c,d.replace("_",""),this._entries[d])}}},_addInputToSend:function(b,c,f,d){var e=c;e=desknets.tmpl.replaceWordHtml(e,"id",f);e=desknets.tmpl.replaceWord(e,"name",d);a(e).appendTo(b)}});desknets.page(desknets.portalset,"PortalScrollableContent",desknets.portalset.PortalContent,{id:"portalset-pcontent-scrollable-dialog",tmplFileName:"portalset/pcontentScrollable.html",$scrollable:a(),setUp:function(){this.$scrollable=this.$root.find(".jportalset-scroll");this.show()},setDialogValues:function(){this.callBase("setDialogValues");var b=this.$content.find(".jportal-content-attr-value").val();var c=String(b)=="0"?"0":"1";this.$scrollable.find('input[value="'+c+'"]').prop("checked",true)},setContentValues:function(){this.callBase("setContentValues");var c=this.getAttrInput();var b=this.$scrollable.find("input:checked").val();c.val(b)}});desknets.page(desknets.portalset,"PortalPlantContent",desknets.portalset.PortalContent,{id:"portalset-pcontent-plant-dialog",tmplFileName:"portalset/pcontentPlant.html",_plantApi:null,_tmplItem:null,_selectedIDs:{},_$groupSelect:null,_$list:null,_$pagers:null,_totalItems:0,_priv:"",setUp:function(){this._plantApi=desknets.getUrl(desknets.MODULE_API_MAIN);this._$groupSelect=this.$root.find(".portalset-plant-groups");this._$list=this.$root.find(".jportalset-plants");this._$pagers=this.$root.find(".co-actionwrap");this._tmplItem=this._$list.html();this._priv=desknets.portalset.getPagePrivilege();this._$list.empty();this._setUpEvents();this._loadPlantGroups()},show:function(){this.setDialogValues()},setDialogValues:function(){this.callBase("setDialogValues");var b=this.$content.find(">.portal-content-body input");if(b.length>0){this._setSelectedIDFromElement(b);this.$root.dialog("open")}else{this._loadSelectedPlants(this.$content.data("id"))}},setContentValues:function(){this.callBase("setContentValues");var d=this.$content.data("id");var c=this.$content.children(".portal-content-body");this.$content.find('input[name="c'+d+'_id"]').remove();for(var b in this._selectedIDs){a('<input type="hidden" name="c'+d+'_id" value="'+this._selectedIDs[b]+'" />').appendTo(c)}},_setUpEvents:function(){var b=this;this._$groupSelect.change(function(c){b._resetPlantList(function(){})});this._$list.delegate("input:checkbox","click",function(c){b._changeSelectedID(a(this))})},_loadPlantGroups:function(){var b=this;desknets.ajax.rest({url:this._plantApi,data:{cmd:"plant"+b._priv+"selpgroup"},success:function(c){b._setUpPlantGroups(c);b._resetPlantList(function(){b.show()})}})},_setUpPlantGroups:function(d){var b=desknets.ajax.getJsonItems(d);var c=this._$groupSelect.children(":first-child").text();b.unshift({id:"0",Name:c});desknets.htmlparts.setSelectOption(this._$groupSelect,b,"id","Name")},_setSelectedIDFromElement:function(c){var b=this;b._selectedIDs={};c.each(function(){if(this.value>0){b._selectedIDs["_"+String(this.value)]=this.value}});b._updatePlantSelection()},_loadSelectedPlants:function(d){var b=this;var c=b.page._getPlantListParams();if(!c){b._setUpSelectedPlants({})}else{desknets.ajax.rest({url:desknets.getUrl(desknets.portalset.MODULE_API_MAIN),data:a.extend(c,{id:d}),success:function(e){b._setUpSelectedPlants(e)}})}},_setUpSelectedPlants:function(d){var b=desknets.ajax.getJsonItems(d);this._selectedIDs={};for(var c=0;c<b.length;c++){this._selectedIDs["_"+String(b[c].id)]=b[c].id}this._updatePlantSelection();this.$root.dialog("open");this.isCreated=true},_resetPlantList:function(c){var b=this;b._loadPlantList(0,function(){c()})},_loadPlantList:function(e,d){var b=this;var f=b._$groupSelect.val();var c="plant"+b._priv+"selplant";desknets.ajax.rest({url:this._plantApi,data:{cmd:c,gid:f,row:e,num:10},success:function(g){b._replacePlantList(g);b._updatePlantSelection();b._updatePager(e);d()}})},_replacePlantList:function(e){var f=[];var b=desknets.ajax.getJsonItems(e);for(var d=0;d<b.length;d++){var c=this._tmplItem;c=desknets.tmpl.replaceWordHtml(c,"id",b[d].id);c=desknets.tmpl.replaceWord(c,"Name",b[d].Name);f.push(c)}this._$list.empty().html(f.join(""));this._totalItems=Number(e.allcnt)},_updatePager:function(c){var b=this;b._$pagers.each(function(){desknets.Pager.output(this,".co-page",{getCount:b._$list.children().length,allCount:b._totalItems,pageMaxView:10,startRow:c,clickFunc:function(d){b._loadPlantList(d,function(){})}})})},_updatePlantSelection:function(){var b=this;this._$list.find("input:checkbox").each(function(){this.checked=!!b._selectedIDs["_"+String(this.value)]})},_changeSelectedID:function(c){var d=c.attr("checked");var e=c.val(),b="_"+String(e);if(!!d&&!this._selectedIDs[b]){this._selectedIDs[b]=e}else{if(!d&&!!this._selectedIDs[b]){delete this._selectedIDs[b]}}}});desknets.page(desknets.portalset,"PortalSchContent",desknets.portalset.PortalContent,{$select:a(),setUp:function(){this.$select=this.$root.find(".jportalset-target");this.show()},show:function(){this.callBase("show");this.$select.blur()},setDialogValues:function(){this.callBase("setDialogValues");var b=this.$content.find(".jportal-content-attr-value");this._setUpTargetChooser(Number(b.val()),b.data("name"))},setContentValues:function(){this.callBase("setContentValues");var b=this.getAttrInput();b.val(this.$select.val());b.data("name",neo.form.getSelectedLabel(this.$select));this.page.setUpPortalContent(this.$content)},getSelectOptions:function(){},getDefaultName:function(){},_setUpTargetChooser:function(e,c){var b=this._getItemsToSelect(e,c);var d=a.extend({selected:e},this.getSelectOptions());this.$select.off(".selitem").empty();desknets.selitem.setUpDynamicSelect(this.$select,b,d)},_getItemsToSelect:function(e,d){var b=[],c=this.getDefaultName();if(!!c){b.push({value:"",label:c})}if(e>0&&!!d){b.push({value:e,label:d})}return b}});desknets.page(desknets.portalset,"PortalPschContent",desknets.portalset.PortalSchContent,{id:"portalset-pcontent-psch-dialog",tmplFileName:"portalset/pcontentPsch.html",getSelectOptions:function(){return{selectLabel:desknets.Resource.portalset.schContentChoose_user,chooserId:this.id+"-chooser",chooserOptions:{allGroup:"readonly",unassignGroup:"readonly",choosePrivateGroup:"readonly"}}},getDefaultName:function(){return this.page.defaultUserName}});desknets.page(desknets.portalset,"PortalGschContent",desknets.portalset.PortalSchContent,{id:"portalset-pcontent-gsch-dialog",tmplFileName:"portalset/pcontentGsch.html",getSelectOptions:function(){var b=Number(this.$select.val());return{selectLabel:desknets.Resource.portalset.schContentChoose_group,chooserId:this.id+"-chooser",chooserOptions:{chooseTarget:["group"],defaultGroupId:b}}},getDefaultName:function(){return this.page.defaultGroupName}});desknets.page(desknets.portalset,"PortalInfoCatContent",desknets.portalset.PortalScrollableContent,{TMPL_ITEM:'<tr data-id="{{id}}"><td class="co-thd-1em"><a href="#" class="co-btn co-btn-close" title="{{L_Deselect}}">{{L_Deselect}}</a></td><td class="portalset-pinfo-name">{{name}}</td></tr>',TMPL_CONTENT:'<input type="hidden" name="c{{cid}}_id" value="{{id}}" data-name="{{name}}" />',id:"portalset-pcontent-infocat-dialog",tmplFileName:"portalset/pcontentInfoCat.html",_apiUrl:"",_$tree:a(),_$selected:a(),setUp:function(){this._apiUrl=desknets.getUrl(desknets.portalset.MODULE_API_MAIN);this.$scrollable=this.$root.find(".jportalset-scroll");this._setUpSelected();this._setUpTree()},show:function(){this.setDialogValues()},getDialogOption:function(){var b=this.callBase("getDialogOption");b.width=750;return b},setDialogValues:function(){this.callBase("setDialogValues");var b=this.$content.find(">.portal-content-body input");if(b.length>0){this._setSelectedFromElement(b);this.$root.dialog("open")}else{this._loadSelected()}},setContentValues:function(){this.callBase("setContentValues");this._saveInputToSend()},_setUpTree:function(){var b=this;this._$tree=b.$root.find(".jportalset-info-cat-tree");var c=b._$tree.find(".co-listview-items");c.bind("loaded.jstree",function(){b.show();setTimeout(function(){desknets.portalset.infoCategoryTree._updateItemsWidth()},200)});c.bind("open_node.jstree",function(d,e){desknets.tree.deleteDumyItem(c);if(!!e&&!!e.rslt){b._updateTreeNodes(e.rslt.obj)}});desknets.portalset.infoCategoryTree.init(b._$tree,{selFunc:function(e){var d=a.trim(e.children("a").text());b._toggleItem(e.data("id"),d)}})},_setUpSelected:function(){var b=this;b._$selected=b.$root.find(".jportalset-selected");b._$selected.delegate(".co-btn-close","click",function(c){c.preventDefault();b._removeItemByElement(a(this))});this._$selected.tableDnD({onDragClass:"co-tr-selected"})},_loadSelected:function(){var b=this;var c=b.page._getInfoCatListParams();if(!c){b._onLoadSelected({})}else{desknets.ajax.rest({url:b._apiUrl,data:c,success:function(d){b._onLoadSelected(d)}})}},_onLoadSelected:function(c){var b=desknets.ajax.getJsonItems(c);this._setSelected(b);this.$root.dialog("open");this.isCreated=true},_setSelectedFromElement:function(c){var b=[];c.each(function(){if(Number(this.value)>0){var d=a(this).data("name");b.push({id:this.value,Name:String(d)})}});this._setSelected(b)},_setSelected:function(b){var d=[];for(var c=0;c<b.length;c++){d.push(this._getItemHtml(b[c].id,b[c].Name))}this._$selected.html(d.join(""));this._onChangeSelection()},_toggleItem:function(e,d){var b=this._$selected.find("tr").filter(function(){return a(this).data("id")==e});if(b.length>0){b.remove()}else{var c=a(this._getItemHtml(e,d));this._$selected.append(c)}this._onChangeSelection()},_removeItemByElement:function(b){var c=b.closest("tr").remove();this._onChangeSelection()},_onChangeSelection:function(){var b=this._$selected.closest("table").siblings(".portalset-no-selected");var c=this._$selected.children().length>0?"hide":"show";b[c]();this._$selected.tableDnDUpdate();desknets.portalset.infoCategoryTree._updateItemsWidth();this._updateTreeNodes(this._$tree)},_updateTreeNodes:function(b){var c={};this._$selected.find("tr").each(function(){c[a(this).data("id")]=true});b.find(".co-listview-item").each(function(){var e=a(this),d=!!c[e.data("id")]?"addClass":"removeClass";e.children(".co-listview-item-inside")[d]("on")})},_getItemHtml:function(e,b){var c=this.TMPL_ITEM,d=desknets.Resource;c=desknets.tmpl.replaceWordHtml(c,"L_Deselect",d.deselectLabel);c=desknets.tmpl.replaceWordHtml(c,"id",e);c=desknets.tmpl.replaceWord(c,"name",b);return c},_saveInputToSend:function(){var d=this.$content.data("id");var c=this.$content.children(".portal-content-body");var b=desknets.tmpl.replaceWordHtml(this.TMPL_CONTENT,"cid",d);c.find("input").remove();this._addInputsToSend(c,b)},_addInputsToSend:function(b,d){var c=this,e=this._$selected.find("tr");if(e.length<=0){this._addInputToSend(b,d,0,"")}else{e.each(function(){var g=a(this),f=g.find(".portalset-pinfo-name").text();c._addInputToSend(b,d,g.data("id"),f)})}},_addInputToSend:function(b,c,f,d){var e=c;e=desknets.tmpl.replaceWordHtml(e,"id",f);e=desknets.tmpl.replaceWord(e,"name",d);a(e).appendTo(b)}});desknets.page(desknets.portalset,"PortalMenuContent",desknets.portalset.PortalContent,{TMPL_CONTENT:'<input type="hidden" name="c{{cid}}_id" value="{{id}}" data-name="{{name}}" data-icon="{{icon}}" />',PER_PAGE:100,id:"portalset-pcontent-menu-dialog",tmplFileName:"portalset/pcontentMenu.html",_type:"",_tmplChoosen:"",_tmplLists:{},_defaultItems:null,_listSortable:null,_$choosen:a(),_$list:a(),_$listBody:a(),setUp:function(){var b=this;this._apiUrl=desknets.getUrl(desknets.portalset.MODULE_API_MAIN);this._type=this.$root.find(".portalset-menu-list-types").val();this._tmplChoosen=this.$root.find(".jportalset-menu-content-tmpl").remove().html();this.$root.find(".jportalset-menu-list-tmpl").each(function(){b._tmplLists[this.getAttribute("data-type")]=a(this).html()});this._$choosen=this.$root.find(".portalset-menu-chooser-contents ul");this._$list=this.$root.find(".portalset-menu-chooser-lists");this._$listBody=this._$list.find("tbody");this._setUpChoosen();this._setUpList();this._loadList(0,function(){b.show()})},show:function(){this.setDialogValues()},setDialogValues:function(){this.callBase("setDialogValues");var b=this,c=this.$content.find(">.portal-content-body input");if(c.length>0){this._setSelectedFromElement(c);this.$root.dialog("open")}else{this._loadSelected(function(){b.$root.dialog("open");b.isCreated=true})}this._updateChoosenContentsBar()},setContentValues:function(){this.callBase("setContentValues");var c=this.$content.children(".portal-content-body");var b=desknets.tmpl.replaceWordHtml(this.TMPL_CONTENT,"cid",this.$content.data("id"));c.find("input").remove();this._addInputsToSend(c,b)},getDialogOption:function(){var b=this,c=this.callBase("getDialogOption");c.width=750;c.buttons[desknets.Resource.OKButtonLabel]=function(){if(b.validate()){b.$root.dialog("close");b.setContentValues()}};return c},validate:function(){if(this._$choosen.find("li").length<=0){desknets.dialog.alert(desknets.Resource.Message.portalset_no_menu_contents);return false}return true},_setUpChoosen:function(){var b=this;this._$choosen.on("click",".co-btn-close",function(c){c.preventDefault();b._removeChoosenItems(a(this).closest("li"))});this.$root.find(".jportalset-colors input").click(function(c){b._updateChoosenContentsBar()});this.$root.find(".portalset-content-remove-all").click(function(c){c.preventDefault();b._removeChoosenItems(b._$choosen.find("li"))});this._$choosen.sortable({placeholder:"portalset-menu-placeholder",tolerance:"pointer",activate:function(c,d){b._$choosen.parent().addClass("active");b._$choosen.sortable("refresh")},deactivate:function(c,d){b._$choosen.parent().removeClass("active")},over:function(c,d){b._onHoverHelper(d.helper);b._onChangePlaceholder(d.placeholder,"over")},out:function(c,d){b._onChangePlaceholder(d.placeholder,"out")},receive:function(c,d){b._onDropFromList()}})},_setUpList:function(){var b=this;this.$root.find(".portalset-menu-list-types").change(function(){b._type=a(this).val();b._loadList(0)});this._checkControl=new neo.CheckControl(this._$list,{itemSelecter:"tr",checkClass:"co-tr-selected"});this._listSortable=new desknets.ListSortable(this._$list,{dragToExternal:true,draggableOptions:{cancel:"input, a, .portalset-menu-choosen",appendTo:this.$root.find(".portalset-menu-chooser"),connectToSortable:this._$choosen},stop:function(){b._updateCheckboxes()}});this._listSortable.setSortable(false)},_loadSelected:function(d){var b=this,c=this.page._getMenuListParams();if(!c){this._onLoadSelected({});d()}else{desknets.ajax.rest({url:b._apiUrl,data:c,success:function(e){b._onLoadSelected(e);d()}})}},_onLoadSelected:function(d){var c=this,e=[],b=desknets.ajax.getJsonItems(d);if(b.length>0){a.each(b,function(g,h){var f=c._createChoosenItemHtml(h);e.push(f)})}else{if(!!this._defaultItems){a.each(this._defaultItems,function(g,h){var f=c._createChoosenItemHtml({id:h.id,kind:"module",Name:h.Name,filename:"/dneores/images/topmenu/"+h.image});e.push(f)})}}this._$choosen.html(e.join(""));this._onChangeChoosenItem()},_setSelectedFromElement:function(d){var b=this,c=[];d.each(function(){var f=String(this.value).match(/^(module|optmenu)(\d+)$/);if(!!f&&f.length>2){var e=b._createChoosenItemHtml({id:f[2],kind:f[1],Name:String(a(this).data("name")),filename:a(this).data("icon")});c.push(e)}});this._$choosen.html(c.join(""));this._onChangeChoosenItem()},_createChoosenItemHtml:function(c){var b=this._tmplChoosen;b=desknets.tmpl.replaceWordHtml(b,"id","jportalset-menu-item-"+c.kind+c.id);b=desknets.tmpl.replaceWord(b,"name",c.Name);return desknets.tmpl.replaceWord(b,"icon",c.filename)},_updateChoosenContentsBar:function(){var b=this.$root.find(".jportalset-colors input:checked").val();var c=this.$root.find(".portalset-menu-chooser-contents .portal-content-pane");c.attr("class","portal-content-pane portal-content-color-"+b)},_loadList:function(e,d){var b=this,c=a.extend({},this.page._getMenuChoosableListParams(this._type),{row:e,num:this.PER_PAGE});desknets.ajax.rest({url:this._apiUrl,data:c,success:function(f){b._createList(f,e);if(!!d){d()}}})},_createList:function(d,e){var c=this,b=desknets.ajax.getJsonItems(d);this._updateListHeader();if(this._type=="module"){this._$listBody.html(this._createModuleListHtml(b));if(!this._defaultItems){this._defaultItems=b}}else{if(this._type=="optmenu"){this._$listBody.html(this._createOptionMenuListHtml(b))}}desknets.Pager.output(this._$list,".jco-pager",{allCount:d.allcnt||b.length,startRow:d.row||e,pageMaxView:this.PER_PAGE,clickFunc:function(f){c._loadList(f)}});this._updateCheckboxes()},_updateListHeader:function(){var b=this;this._$list.find("thead > tr").each(function(){var c=a(this),d=(c.data("type")==b._type)?"show":"hide";c[d]()})},_createModuleListHtml:function(c){var f=[],d,e=desknets.Resource.menu,b=this._tmplLists.module;a.each(c,function(g,h){var j=(h.window||h.target)=="1"?e.targetBlankLabel:e.targetSelfLabel;d=desknets.tmpl.replaceWordHtml(b,"id",h.id);d=desknets.tmpl.replaceWord(d,"Name",h.Name);d=desknets.tmpl.replaceWord(d,"image",h.image);d=desknets.tmpl.replaceWord(d,"target",j);f.push(d)});return f.join("")},_createOptionMenuListHtml:function(c){var e=[],d,b=this._tmplLists.optmenu;a.each(c,function(f,g){d=desknets.tmpl.replaceWordHtml(b,"id",g.id);d=desknets.tmpl.replaceWord(d,"Name",g.Name);d=desknets.tmpl.replaceWord(d,"Url",g.Url);d=desknets.tmpl.replaceWord(d,"portalfilename",g.portalfilename);e.push(d)});return e.join("")},_onHoverHelper:function(b){if(!b.is("li")){b.css({height:"auto",width:"auto"})}},_onChangePlaceholder:function(b,c){if(!b.is("li")){var d=this._$choosen.find("li.portalset-menu-placeholder");if(c=="over"){if(d.length<=0){d=a('<li class="portalset-menu-placeholder" />')}d.insertBefore(b)}else{if(c=="out"){d.remove()}}}},_onDropFromList:function(){var b=this,d=[];var c=b._$choosen.find("li.portalset-menu-placeholder");this._$listBody.find("input:checked").each(function(){var f=a(this).closest("tr");var e=b._createChoosenItemHtml({id:this.value,kind:b._type,Name:f.find(".jco-dragname").text(),filename:f.find("img").attr("src")});d.push(e)});a(d.join("")).insertBefore(c);this._$choosen.find("tbody").remove();c.remove();setTimeout(function(){b._onChangeChoosenItem()},0)},_removeChoosenItems:function(b){b.remove();this._onChangeChoosenItem()},_onChangeChoosenItem:function(){var b=this._$choosen.find("li").length>0?"removeClass":"addClass";this._$choosen.parent()[b]("empty");this._updateCheckboxes()},_updateCheckboxes:function(){var b=this;this._$listBody.find("input[type=checkbox]").each(function(){var c=a(this).closest("tr");if(a("#jportalset-menu-item-"+b._type+this.value).length>0){this.disabled=true;this.checked=false;c.removeClass("co-tr-selected").addClass("portalset-menu-choosen")}else{this.disabled=false;c.removeClass("portalset-menu-choosen")}});this._checkControl.restoreStates()},_addInputsToSend:function(b,d){var c=this,e=[],f=this._$choosen.find("li");if(f.length<=0){e.push(this._addInputToSend(b,d,{id:"0"}))}else{f.each(function(){var g=a(this);var h=String(g.attr("id")).match(/\w+$/);e.push(c._addInputToSend(b,d,{id:h[0],name:g.find(".portalset-menu-item").text(),icon:g.find("img").attr("src")}))})}b.append(e.join(""))},_addInputToSend:function(b,c,d){html=desknets.tmpl.replaceWordHtml(c,"id",d.id);html=desknets.tmpl.replaceWord(html,"name",d.name||"");return desknets.tmpl.replaceWord(html,"icon",d.icon||"")}});desknets.page(desknets.portalset,"ContentEntryBase",desknets.PageInputBase,{_$selectKind:null,_mbackpage:{},initPage:function(e,c){var b=this;var d={};if(e=="portalpsetdesign"){}else{if(e=="portalmsetdesign"){}else{if(e=="portalmsetdesigngrp"){d.cmd=e;d.id=a("#jco-m-input-page").find('input[name="id"]').val()}}}b._mbackpage=d;b.callBase("initPage",e,c)},_initSet:function(){this.callBase("_initSet");this._create()},_initGetHtml:function(){var b=this;desknets.rte.loadRte();this.callBase("_initGetHtml")},dispBackListPage:function(){var b=this;b._setLocationHash(b._mbackpage)},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.beforeSerialize=function(d,f){var e=b.$mjPage.find(".jco-input-Url").val();b.$mjPage.find('input[name="Url"]').val(e)};return c},onSuccessForm:function(c,b){this._setContentOfDesignEntry(c.id)},_getRestModule:function(){return desknets.portalset.MODULE_API_MAIN},_getIdPageForm:function(){return"frm"},_getIdPage:function(){return"jportalset-contententry"},_getAreaTitle:function(b){var d=a(".portalset-setdesign");var c=d.find(".co-setting-title").text();if(!!c){return d.find(".jco-title").val()+" &gt; "+c}else{return b.find(".jportalset-deftitle").val()}},_create:function(){var b=this;this._$selectKind=this.$mjPage.find('select[name="kindnum"]');this._$selectKind.change(function(c){b._updateWithKind(false)});this._updateWithKind(true);this.$mjPage.find(".jportalset-delete-content").click(function(c){b._confirmAndDeleteContent()});b.$mjPage.find(".portalset-submit-save").click(function(c){desknets.rte.inputSubmitRte(c,b.$mjPage.find("form"))})},_updateWithKind:function(c){var f=this._$selectKind.val();var h=this.$mjPage.find(".co-mce-editor");var b=this;this._updateRowWithKind(".portalset-content-entry-script",f=="1");this._updateRowWithKind(".portalset-content-entry-url",f=="2");this._updateRowWithKind(".portalset-content-entry-rte",f=="3");this._updateRowWithKind(".portalset-content-entry-non-rte",f!="3");if(f=="3"&&h.find("#cke_ckeditor").length<=0){var d=h.find(".portalset-content-entry-rte-input");var e=function(){desknets.autosave.attachrtesave()};var g={pagurl:desknets.portalset.MODULE_MAIN,resturl:desknets.portalset.MODULE_API_MAIN,dl:"portalcontenttedispattach",add:"portalcontentcmdaddrteattach",mod:"portalcontentcmdmodrteattach",del:"portalcontentcmddelrteattach"};if(b.boautosave){g.attachsave=e}if(c){b._mautosavestartok=false;b.borte=true}desknets.rte.init(d,{imgeditor:true,submitName:"Url",rtfileopt:g,initFunc:function(){if(c){setTimeout(function(){if(typeof CKEDITOR=="object"&&!!CKEDITOR.instances.ckeditor){b.$mjPage.find("#ckeditor").val(CKEDITOR.instances.ckeditor.getData());b._inputFormSaveToObserver()}b._mautosavestartok=true},2500)}},})}},_updateRowWithKind:function(d,b){var e=this.$mjPage.find(d);var f=b?"show":"hide";var c=b?"addClass":"removeClass";e[f]();e.find("input,select,textarea").attr("disabled",!b);e.find(".jportalset-entry-text")[c]("jco-input-Url");e.find('input[name="winh"]')[c]("jco-validation-number")},_setContentOfDesignEntry:function(d){var c=this.$mjPage.find('input[name="Name"]').val();var b=this.$mjPage.find('textarea[name="memo"]').val();desknets.portalset.contentUtil.set(d,c,b)},_confirmAndDeleteContent:function(){var b=this;var c=b.$mjPage.find('input[name="id"]').val();desknets.portalset.contentUtil.confirmToDeleteData(c,function(){b.resetFuncBeforeHashChange();if(b.boautosave===true){desknets.autosave.stop()}b.dispBackListPage()})},AutoSaveOpt:function(c){var b=this;var d=b.callBase("AutoSaveOpt",c);d.module="portal";d.rtename="portalcontentrteatt";return d},AutoSaveChkConfirm:function(f,c){var b=this;var e=desknets.paramanalyzer.getHashParams();var d=b.callBase("AutoSaveChkConfirm",f,c);b.AutoSaveDialogLock(d)},AutoSaveEntry:function(c){var b=this;c=b.callBase("AutoSaveEntry",c);c.Url=b.$mjPage.find(".jco-input-Url").val();if(c.kindnum=="3"){if(typeof CKEDITOR=="object"&&!!CKEDITOR.instances.ckeditor){c.Url=CKEDITOR.instances.ckeditor.getData()}}return c},AutoSaveGetData:function(e){var c=this;var b="";c.$mjPage.find('select[name="kindnum"]').val(e.kindnum);c._updateWithKind();c.$mjPage.find('input[name="Name"]').val(e.Name);if(e.kindnum=="3"){var d=setInterval(function(){if(a(".cke_button.cke_button__table.cke_button_disabled").length==0){desknets.rte.setEditorData(CKEDITOR.instances.ckeditor,e.Url);clearInterval(d)}},200)}else{c.$mjPage.find(".jco-input-Url").val(e.Url)}if(!!e.iframeuse){c.$mjPage.find('input[name="iframeuse"]').val([e.iframeuse])}if(!!e.winh){c.$mjPage.find('input[name="winh"]').val([e.winh])}if(!!e.sso){c.$mjPage.find('select[name="sso"]').val([e.sso])}c.$mjPage.find('textarea[name="memo"]').val(e.memo)},});desknets.page(desknets.portalset,"BookmarkListBase",desknets.PagePaneListBase,{_uid:null,_$data:a(),_$searchInput:a(),_folderCmds:{},_bookmarkCMDs:{},getFolderID:function(){var b=Number(this._$data.find('input[name="folder"]').val());return isNaN(b)?0:b},search:function(){if(!this.chkListSearchKeyLength(this._$searchInput.val())){return}var b=this.$mjListPage.find(".jco-back-page-data").find(".jportalset-keyword");if(b.val()!=this._$searchInput.val()){this.boChangePageNoHide=true;this._setLocationHash({folder:this.getFolderID(),srch_key:this._$searchInput.val()})}},_initSet:function(){this.callBase("_initSet");this._$data=this.$mjListPage.find(".jco-back-page-data")},changPage:function(){this.callBase("changPage");if(this._$searchInput.length<=0){this._initSearchBar()}},initLeftTree:function(){var c=this;var b=a.extend({restAPI:desknets.portalset.MODULE_API_MAIN},c._folderCmds);desknets.portalset.bookmarkFolder.init(c.$mjListPage,{userId:this._uid,selFunc:function(d){c._optTreeSelectFunc(d)}},b);c._treeClass=desknets.portalset.bookmarkFolder},_hashUpdatePageParams:function(){var d=this;this.callBase("_hashUpdatePageParams");var c=desknets.paramanalyzer.getHashParams();var e=this._$data.find(".jportalset-keyword");var b=c.srch_key||"";if(!neo.isSet(b,{blank:false})){e.removeAttr("name").val("")}else{e.attr("name","srch_key").val(b)}},initParamsFromHash:function(f){var d=f.cmd;var e=this._getListCmd();var b=a("#jco-pv-funcid").data("search");var c=desknets.portalset[d];if(!!c&&!!b&&d==b){this.mhashBackCmd=b;this.mhashIdBack=c._getIdListPage();c.initParamsFromHash(f)}else{if(d==e){this.mhashBackCmd=e;this.mhashIdBack=this._getIdListPage();this.callBase("initParamsFromHash",f)}else{this.callBase("initParamsFromHash",f)}}},treeUpdateList:function(){desknets.portalset.bookmarkFolder.updateTreeList()},treeUpdateListWidth:function(){desknets.portalset.bookmarkFolder._updateItemsWidth()},_listLine:function(b,c){b=this.callBase("_listLine",b,c);return desknets.portalset.replaceOffLabel(b,c.off)},_getListAjaxSuccessEnd:function(){this.callBase("_getListAjaxSuccessEnd");var c=desknets.paramanalyzer.getHashParams();var b=this._$searchInput.closest(".co-list-search-wrap");desknets.keysearch.fixListWatermark(b,c)},_getRestModule:function(){return desknets.portalset.MODULE_API_MAIN},_getListCmd:function(){return this._bookmarkCMDs.listPage},_getListExecCmd:function(){return this._bookmarkCMDs.listCMD},_getListAddCmd:function(){return this._bookmarkCMDs.entryPage},_getListDispCmd:function(){return this._getListAddCmd()},_getListModCmd:function(){return this._getListAddCmd()},_getMoveListCmd:function(){return this._bookmarkCMDs.moveFolderCMD},_getDelExecCmd:function(){return this._bookmarkCMDs.delCMD},_getListEntryClass:function(){return desknets.portalset[this._getListAddCmd()]},_getAddPageParam:function(){return{folder:this.getFolderID()}},_getModPageParam:function(){return this._getAddPageParam()},_getDispPageParam:function(){return this._getAddPageParam()},_getMoveAddPrm:function(){return this._getAdditionalParams()},_getDelAddPrm:function(){return this._getAdditionalParams()},_getSortableListCmd:function(){return this._bookmarkCMDs.moveCMD},_isMoveListSeqno:function(){return true},_initSearchBar:function(){var b=this;b._$searchInput=b.$mjListPage.find(".co-list-search-text");var c=b._$searchInput.siblings(".co-list-search-btn").children("a");c.click(function(d){d.preventDefault();b.search()});desknets.watermark.set(b._$searchInput);desknets.keysearch.setUp(b._getListExecCmd(),b._$searchInput,function(){b.search()})},_filterRestParams:function(b){if(!!b.folder_mode&&!!b.folder&&b.folder_mode=="none"){delete b.folder_mode;delete b.folder}},_getAdditionalParams:function(){var c={},b=this.getListParamToObj();a.each(["folder","srch_key"],function(d,e){if(typeof b[e]!="undefined"){c[e]=b[e]}else{if(typeof c[e]!="undefined"){delete c[e]}}});return c}});desknets.page(desknets.portalset,"BookmarkEntryBase",desknets.PagePaneInputBase,{_id:"",_uid:null,_$folderInput:a(),_folderCmds:{},_bookmarkCMDs:{},_initSet:function(){this.callBase("_initSet");this._id=this.$mjPage.find('input[name="id"]').val();this._initFolderEntry();this._initIconEntry()},_inputAjaxFormOption:function(){var b=this.callBase("_inputAjaxFormOption");b.dataType="xml";return b},initLeftTree:function(){var d=this;var c=this.$mjPage;var b=a.extend({restAPI:desknets.portalset.MODULE_API_MAIN},d._folderCmds);desknets.portalset.BookmarkEntryBase.folder.targetUID=this._uid;desknets.portalset.BookmarkEntryBase.folder.init(c,{selFunc:function(e){d._setFolder(e)}},b)},_getAddExecCmd:function(){return this._bookmarkCMDs.entryCMD},_getModExecCmd:function(){return this._getAddExecCmd()},_getDelExecCmd:function(){return this._bookmarkCMDs.delCMD},_getRestModule:function(){return desknets.portalset.MODULE_API_MAIN},_updatePageListId:function(){if(this.mIdBack=="jco-m-list-container"){this.callBase("_updatePageListId")}},_initFolderEntry:function(){var b=this;b._$folderInput=b.$mjPage.find('input[name="folder"]');b._updateFolder()},_setFolder:function(d){var c=0,b="";if(d.is("li")){c=d.data("fid");b=desknets.folderlist.getItemTitle(d)}this._$folderInput.val(c).data("name",b);this._updateFolder()},_updateFolder:function(){var d=this._$folderInput.closest("td");var b=this._$folderInput.siblings(".co-selitem-text");var e=Number(this._$folderInput.val());var c=String(this._$folderInput.data("name"));if(!c){c=desknets.Resource.portalset.bookmarkRootFolder}c=desknets.escapeSpace(c,true);b.text(c).attr("title",c)},_initIconEntry:function(){var c=this.$mjPage.find(".jportalset-portal-bookmark-icon-entry");var b=this.$mjPage.find(".jportalset-menu-bookmark-icon-entry");desknets.menu.icon.setUp(c);desknets.menu.icon.setUp(b)}});desknets.page(desknets.portalset.BookmarkEntryBase,"folder",desknets.folderinput,{targetUID:null,_tmplInitItem:'<li {{idName}}="{{id}}" class="co-listview-item"><a href="#" class="co-listview-item-inside"><img src="{{iconUrl}}" />{{Name}}</a>{{F_Ul}}</li>',_tmplFItem:'<li {{idName}}="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside"><img src="{{iconUrl}}" />{{Name}}</a></li>',selectItemById:function(c){var b=this.getItemObject_li(this.$_tree,c,this._options);b.children("a:first").trigger("click")},_getItemHtml:function(c,b){c=this.callBase("_getItemHtml",c,b);c=desknets.tmpl.replaceWordHtml(c,"iconUrl",String(b.filename));return c}});desknets.page(desknets.portalset,"bookmarkSearch",desknets.PageSubwinSearch,{init:function(){this.callBase("init");desknets.htmlparts.setUpForm(this.$_inputArea)},getViewArea:function(){return a("#jco-m-search-container")},getInputArea:function(){return a(".jco-subwindow-search")},_execClear:function(){var b=this.$_inputArea[0];if(!!b){b.reset()}this.callBase("_execClear")},_getSearchCmd:function(){return a("#jco-pv-funcid").data("search")},_chkInputSearch:function(){var b=this._getSearchPrm();if(!this._hasCondition(b)){desknets.dialog.alert(desknets.Resource.Message.com_search_nokey,{type:"warn"});return false}return this.callBase("_chkInputSearch")},_getSearchPrm:function(){var f={};var e=function(g){return String(g).replace(/-/g,"")};var d=a("#jco-m-list-container");var c=this.$_inputArea.find(".jportalset-folder-mode").val()!="none";var b=this.$_inputArea.find('input[name="loginoff"]');f.folder=c?d.find('input[name="folder"]').val():"";this._addParam(f,"srch_key");this._addParam(f,"sdate",e);this._addParam(f,"edate",e);if(b.length>0){f.loginoff=b.prop("checked")?"1":""}return f},_addParam:function(e,b,c){var d=this.$_inputArea.find("input").filter(function(){if(this.name!=b){return false}return true}).val();if(typeof d!="undefined"){if(!!c){d=c(d)}e[b]=d}},_hasCondition:function(c){for(var b in c){if(neo.isSet(c[b],{blank:false})){return true}}return false}});desknets.page(desknets.portalset,"BookmarkSearchListBase",desknets.PageListBase,{_bookmarkCMDs:{},_$data:a(),initParamsFromHash:function(b){if(!!this.$mjListPage&&this.$mjListPage.children().length>0){this._hashUpdateListPage(b)}else{this.initPage(this._bookmarkCMDs.listPage,"jco-m-list-container")}},_hashUpdatePageParams:function(){var b=desknets.paramanalyzer.getHashParams();this.callBase("_hashUpdatePageParams");this._setCondition("folder",b.folder);this._setCondition("srch_key",b.srch_key);this._setCondition("sdate",b.sdate);this._setCondition("edate",b.edate)},_initListStartSet:function(){var b=this;b.callBase("_initListStartSet");b._$data=b.$mjListPage.find(".jco-back-page-data");b.$mjListPage.find(".co-pageback").click(function(c){b.dispBackListPage()})},_listLine:function(b,c){if(!!c&&!c.foldername){c.foldername=desknets.Resource.portalset.bookmarkRootFolder}b=this.callBase("_listLine",b,c);b=desknets.portalset.replaceOffLabel(b,c.off);return b},_getDelAddPrm:function(){var b=this,d={},c=["folder","srch_key","sdate","edate"];b._$data.find("input").each(function(){var e=a.inArray(this.name,c);if(e>=0){d[c[e]]=this.value}});return d},_getIdListPage:function(){return"jco-m-search-container"},_getIdListPageForm:function(){return"searchfrm"},_getRestModule:function(){return desknets.portalset.MODULE_API_MAIN},_getListCmd:function(){return this._bookmarkCMDs.searchListPage},_getListExecCmd:function(){return this._bookmarkCMDs.searchListCMD},_getListAddCmd:function(){return this._bookmarkCMDs.entryPage},_getListDispCmd:function(){return this._getListAddCmd()},_getListModCmd:function(){return this._getListAddCmd()},_getDelExecCmd:function(){return this._bookmarkCMDs.delCMD},_getListEntryClass:function(){return desknets.portalset[this._getListAddCmd()]},_setCondition:function(b,c){var d=this._$data.find('input[name="'+b+'"]');d.val(neo.isSet(c,{blank:false})?c:"")}});desknets.page(desknets.portalset,"portalpsetdesign",desknets.portalset.DesignBase,a.extend({},desknets.portalset.DesignSetBase,{cmdContentEntry:"portalpsetcontententry",_$selectContent:a(),_getDelExecCmd:function(){return"portalpsetdel"},_getRestModule:function(){return desknets.portalset.MODULE_API_MAIN},_setUp:function(){var b=this.$mjPage.data("def-group");this.defaultUserName=desknets.pageframe.getLoginName();this.defaultGroupName=b||desknets.Resource.portalset.contentAttrUnselected_gsch;this.callBase("_setUp")},_setUpRightMenu:function(){var b=this;b.callBase("_setUpRightMenu");b._$selectContent=b.$rightMenu.find(".jportalset-content-types");if(b._$selectContent.closest(".portalset-actionwrap").is(".portalset-disabled")){b._$selectContent.val("jportalset-shared-user-contents")}b._$selectContent.change(function(c){b._updateContentList()});b._updateContentList()},_getPlantListParams:function(){return{cmd:"portalpsetplantlist"}},_getInfoCatListParams:function(){return{cmd:"portalpsetinfocatlist"}},_getMenuListParams:function(){return{cmd:"portalpsetmenulist",id:this._defaultGid}},_getMenuChoosableListParams:function(b){return{cmd:b=="optmenu"?"portalpsetoptwinlist":"portalpsetmodulelist"}},_getPortalTabKey:function(){return"P"},_updateContentList:function(){var c=this._$selectContent.val();var b=this.$rightMenu.find("#"+c);b.siblings(".portalset-user-content-list").hide();b.show()}}));desknets.page(desknets.portalset,"portalpsetcontententry",desknets.portalset.ContentEntryBase,{onSuccessForm:function(c,b){this._setContentOfDesignEntry(-c.id)},_confirmAndDeleteContent:function(){var b=this;var c=b.$mjPage.find('input[name="id"]').val();desknets.portalset.contentUtil.confirmToDeleteData(-c,function(){b.resetFuncBeforeHashChange();if(b.boautosave===true){desknets.autosave.stop()}b.dispBackListPage()})}});desknets.page(desknets.portalset,"portalpsetbookmarklist",desknets.portalset.BookmarkListBase,{_folderCmds:desknets.portalset.CMDS_PSET_FOLDER,_bookmarkCMDs:desknets.portalset.CMDS_PSET_BOOKMARK,_initSet:function(){this._uid=desknets.pageframe.getLoginUid();this.callBase("_initSet")}});desknets.page(desknets.portalset,"portalpsetbookmarkentry",desknets.portalset.BookmarkEntryBase,{_folderCmds:desknets.portalset.CMDS_PSET_FOLDER,_bookmarkCMDs:desknets.portalset.CMDS_PSET_BOOKMARK,_initSet:function(){this._uid=desknets.pageframe.getLoginUid();this.callBase("_initSet")}});desknets.page(desknets.portalset,"portalpsetbookmarksearchlist",desknets.portalset.BookmarkSearchListBase,{_bookmarkCMDs:desknets.portalset.CMDS_PSET_BOOKMARK});(function(b){desknets.page(desknets.portalset,"portalmsetgen",desknets.PageSet,{_getRestModule:function(){return desknets.MODULE_API_MAIN},_onAjaxFormSuccess:function(c){desknets.execLocation(desknets.getUrl(desknets.MODULE_MAIN))}})})(jQuery);desknets.page(desknets.portalset,"portalmsetdesign",desknets.portalset.DesignBase,a.extend({},desknets.portalset.DesignSetBase,{_setUp:function(){this.defaultUserName=desknets.Resource.portalset.contentAttrDefault_psch;this.defaultGroupName=desknets.Resource.portalset.contentAttrDefault_gsch;this.callBase("_setUp")},_getPlantListParams:function(){return{cmd:"portalmsetplantlist"}},_getInfoCatListParams:function(){return{cmd:"portalmsetinfocatlist"}},_getMenuListParams:function(){return{cmd:"portalmsetmenulist"}},_getPortalTabKey:function(){return"S"}}));desknets.page(desknets.portalset,"portalmsetcontententry",desknets.portalset.ContentEntryBase,{mchooser:null,_create:function(){this.callBase("_create");var b=this.$mjPage.find(".jportalset-chooser");this.mchooser=desknets.chooser.setUpEntry(b,this._getItemsToAccess(),{dialogID:"jportalset-content-chooser",dialogOptions:{chooseTarget:["group","user","role"],unassignGroup:"readonly"},extraVars:{group:{keyName:"g"},user:{keyName:"u"},role:{keyName:"r"}},template:'<span class="co-selitem"><span class="co-selitem-text" title="{{longName}}">{{name}}</span><input type="hidden" name="acc_id" value="{{keyName}}{{id}}" /><input type="hidden" name="accesskind" value="{{keyName}}{{id}}_1" /><input type="hidden" name="condition" value="{{keyName}}{{id}}_1" /></span>'})},_getItemsToAccess:function(){var b=[];b=desknets.chooser.getItemsFromElement(a(".jco-sel-items"));return b},AutoSaveEntry:function(e){var d=this;e=d.callBase("AutoSaveEntry",e);e.mset="1";var c=d.mchooser.getItems();c=d.arrayToData(c);var b=[];var f=[];a.each(c,function(g,h){b[b.length]=h.name;f[f.length]=h.description});e.acc_idname=b;e.acc_iddes=f;return e},AutoSaveGetData:function(e){var d=this;var b="";d.callBase("AutoSaveGetData",e);e.acc_id=d.arrayToData(e.acc_id);e.acc_idname=d.arrayToData(e.acc_idname);e.acc_iddes=d.arrayToData(e.acc_iddes);var c=[];a.each(e.acc_id,function(f,h){var g="user";if(h.charAt(0)=="g"){g="group"}else{if(h.charAt(0)=="r"){g="role"}}c.push({id:h.substring(1),type:g,name:e.acc_idname[f],description:e.acc_iddes[f]})});d.mchooser.replaceItems(c)},});desknets.page(desknets.portalset,"portalmsetbookmarklist",desknets.portalset.BookmarkListBase,{_folderCmds:desknets.portalset.CMDS_MSET_FOLDER,_bookmarkCMDs:desknets.portalset.CMDS_MSET_BOOKMARK});desknets.page(desknets.portalset,"portalmsetbookmarkentry",desknets.portalset.BookmarkEntryBase,{_folderCmds:desknets.portalset.CMDS_MSET_FOLDER,_bookmarkCMDs:desknets.portalset.CMDS_MSET_BOOKMARK});desknets.page(desknets.portalset,"portalmsetbookmarksearchlist",desknets.portalset.BookmarkSearchListBase,{_bookmarkCMDs:desknets.portalset.CMDS_MSET_BOOKMARK});desknets.page(desknets.portalset,"portalmsetlist",desknets.PageListBase,{mboHasMceEditor:true,_lastPageCmd:"",initParamsFromHash:function(e){var d=e.cmd?e.cmd:"";var b=desknets.portalset.PAGE_GROUP_DESIGN;var c=desknets.portalset.PAGE_M_CONTENT_ENTRY;if(d==c){this._pageInputRemoveMCEControl();desknets.portalset[d].initPage(desknets.portalset.PAGE_GROUP_DESIGN,"jco-m-input-page")}else{if(this._lastPageCmd==c&&d==b&&a(".portalset-setdesign").length>0){this._showSavedEntryPage()}else{this.callBase("initParamsFromHash",e)}}this._lastPageCmd=d},_getListCmd:function(){return desknets.portalset.PAGE_GROUP_LIST},_getListExecCmd:function(){return desknets.portalset.CMD_GROUP_LIST},_getListAddCmd:function(){return desknets.portalset.PAGE_GROUP_DESIGN},_getListDispCmd:function(){return this._getListAddCmd()},_getListModCmd:function(){return this._getListAddCmd()},_getDelExecCmd:function(){return desknets.portalset.CMD_DELETE_GROUP_PORTAL},_getRestModule:function(){return desknets.portalset.MODULE_API_MAIN},_getListEntryClass:function(){return desknets.portalset.portalmsetdesigngrp},_showSavedEntryPage:function(){var b=this._getListEntryClass();b.activatePage()}});desknets.page(desknets.portalset,"portalmsetdesigngrp",desknets.portalset.DesignBase,{_defaultGid:0,_$groupEntry:a(),_groupEntry:null,_isAllManager:false,_tmpl_item:'<span class="co-selitem"><span class="co-selitem-text" title="{{longName}}">{{name}}</span><a href="#" class="co-btn co-btn-close" title="{{L_Delete}}">x</a><input type="hidden" name="gid" value="{{inputValue}}" /></span>',_getDelExecCmd:function(){return desknets.portalset.CMD_DELETE_GROUP_PORTAL},_getRestModule:function(){return desknets.portalset.MODULE_API_MAIN},_setUp:function(){this.defaultUserName=desknets.Resource.portalset.contentAttrDefault_psch;this.defaultGroupName=desknets.Resource.portalset.contentAttrDefault_gsch;this.callBase("_setUp");this._defaultGid=this.$mjPage.find('input[name="id"]').val();this._$groupEntry=this.$mjPage.find(".jportalset-group-entry");this._tmpl_item=desknets.tmpl.replaceWordHtml(this._tmpl_item,"L_Delete",desknets.Resource.deselectLabel);this._isAllManager=this.$mjPage.find(".jportalset-add-content").length>0;this._setUpGroupEntry()},_getPlantListParams:function(){if(!!this._defaultGid){return{cmd:"portalmsetplantlistgrp",gid:this._defaultGid}}return null},_getInfoCatListParams:function(){if(!!this._defaultGid){return{cmd:"portalmsetinfocatlistgrp",id:this._defaultGid}}return null},_getMenuListParams:function(){if(!!this._defaultGid){return{cmd:"portalmsetmenulistgrp",id:this._defaultGid}}return null},_setUpGroupEntry:function(){var b=this;var c={};if(!b._isAllManager){c={chooseTarget:["group"],editDescendant:true,cmdgroups:"constructmsetugroups",cmdgrouptree:"constructmsetcmdgrouptree",moduletype:"portal",chooseAssignedGroup:true}}else{c={chooseTarget:["group"],editDescendant:true}}b._groupEntry=desknets.chooser.setUpEntry(this._$groupEntry,this._getTargetGroups(),{template:this._tmpl_item,filter:function(d){b._filterItems(d)},change:function(){b._onChangeGroups()},dialogID:"portalset-group-chooser",dialogOptions:c,extraKeys:{inputValue:"inputValue"}})},_getTargetGroups:function(){var b=desknets.chooser.getItemsFromElement(this._$groupEntry,{itemFilter:function(e,c){var d=a.extend({},e);d.descendant=String(c.val()).indexOf("_2")>=0?"all":"";return d}});this._filterItems(b);return b},_filterItems:function(b){for(var c=0;c<b.length;c++){var d=!!b[c].descendant?"2":"1";b[c].inputValue=b[c].id+"_"+d}},_onChangeGroups:function(){if(!!this._groupEntry){var b=this._groupEntry.getItems();var c=this.$mjPage.find(".jco-input-portal_name");if(c.val()==""&&b.length>0){c.val(b[0].name)}}}});(function(b){desknets.page(desknets.portalset,"portalsetmanager",desknets.PageAdmin,{_getSetCondition:function(){return true},_getNextCmd:function(){return desknets.portalset.PAGE_PORTALSETADMIN}})})(jQuery);desknets.page(desknets.portalset,"portalsetgen",desknets.PageSet,{_getRestModule:function(){return desknets.MODULE_API_MAIN},_getNextCmd:function(){return desknets.portalset.PAGE_PORTALSETADMIN}});app.addInitialAction(function(){desknets.portalset.init()})})(jQuery);