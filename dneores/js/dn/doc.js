/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){(function(b){desknets.doc={MODULE_DOC_MAIN:"zdoc",MODULE_DOC_API_MAIN:"zrdoc",MODULEID_DOC:"doc",CMD_DOCFOLDERLIST:"docfolderlist",CMD_DOCFOLDERLISTCHILD:"docfolderlistchild",CMD_DOCFOLDERENTRY:"doccmdfolderentry",CMD_DOCFOLDERDEL:"doccmdfolderdel",CMD_DOCFOLDERMOVE:"docfoldermove",CMD_DOCFOLDERMOVEPARENT:"docfolderpmove",CMD_DOCFOLDERACCESSAUTH:"docfolderaccessauth",CMD_DOCINDEXLIST:"docindexlist",CMD_DOCLISTMOVE:"docmove",CMD_DOCLISTCONFMOVE:"docconfmove",CMD_DOCLISTDEL:"doccmddelindex",CMD_DOCLISTCONFDEL:"docconfdel",CMD_DOCNOTICERRCLEAN:"docnoticeerrclean",CMD_DOCENTRY:"doccmdentry",CMD_DOCENTRYSTATUS:"doccmdentrystatus",CMD_DOCREFER:"doccmdrefer",CMD_DOCDEL:"doccmddel",CMD_DOCACCESSAUTHLIST:"docaccsauthlist",CMD_DOCACCESSAUTH:"docaccessauth",CMD_DOCEXTLIST:"docgetextlist",CMD_DOCCOPYATTACH:"doccopyattach",CMD_DOCUNDOEDIT:"doccmdundoedit",CMD_DOCRELATIONLIST:"doccmdrelationlist",CMD_DOCENTRYSURL:"doccmdentrysurl",CMD_DOCATTZIP:"doccmdattzip",CMD_DOCATTZIPDEL:"doccmdattzipdel",CMD_DOCATTZIPDOWN:"docattzipdown",CMD_DOCATTZIPCANCEL:"doccmdattzipcancel",CMD_DOCDISPATTACH:"docdispattach",CMD_DOCADDATTACH:"docattach",CMD_DOCDELATTACH:"docattachdel",CMD_DOCLISTATTACH:"docattachlist",CMD_DOCREVLIST:"docrevindexlist",CMD_DOCREVREFER:"doccmdrevrefer",CMD_DOCREVROLLBACK:"doccmdrevrollback",CMD_DOCSEARCH:"doccmdsearch",CMD_DOCSEARCHSTOP:"docsearchstop",CMD_DOCSEARCHLIST:"docsearchlist",CMD_DOCSEARCHLISTDEL:"doccmddelsearchindex",CMD_DOCSEARCHLISTCONFDEL:"docconfsearchdel",CMD_DOCMSETADDATTACH:"docmsetattach",CMD_DOCMSETDELATTACH:"docmsetattachdel",CMD_DOCMSETDISPATTACH:"docmsetdispattach",CMD_DOCMSETLISTATTACH:"docmsetattachlist",CMD_DOCMSETATTZIP:"docmsetcmdattzip",CMD_DOCMSETATTZIPDEL:"docmsetcmdattzipdel",CMD_DOCMSETATTZIPDOWN:"docmsetattzipdown",CMD_DOCMSETATTZIPCANCEL:"docmsetcmdattzipcancel",PAGE_DOCFOLDERACCESS:"docfolderaccess",PAGE_DOCINDEX:"docindex",PAGE_DOCNOTICEERRDETAIL:"docnoticeerror",PAGE_DOCENTRY:"docentry",PAGE_DOCREFER:"docrefer",PAGE_DOCACCESS:"docaccess",PAGE_DOCREVINDEX:"docrevindex",PAGE_DOCREVREFER:"docrevrefer",PAGE_DOCSEARCHINDEX:"docsearchindex",funcID:null,DOC_STATUS_COMPLETE:"1",DOC_STATUS_WORKING:"3",DOC_MSETINDEXID:"docmsetindex",DOC_FOLDER_EDITID:"-1",init:function(){var d=this;var c=b("#jco-pv-funcid").val();this.setFuncID(c);if(c==d.PAGE_DOCINDEX){desknets.hashobserver.init(desknets.doc);desknets.doc.subwin.init();desknets.doc.docindex.init()}},setFuncID:function(c){this.funcID=c},getFuncID:function(){return this.funcID},isDocMSetCmd:function(){var c=b("#jco-pv-funcid").val();if(c.substr(0,7)=="docmset"){return true}else{return false}},getDispAttachParam:function(e){var c=this;var d=desknets.paramanalyzer.getHashParams();d.cmd=c.getAttachCommand();d.folder=e;return d},getAttachCommand:function(){var c=this;var d;if(c.isDocMSetCmd()==true){d=c.CMD_DOCMSETDISPATTACH}else{d=c.CMD_DOCDISPATTACH}return d},getAddAttachCommand:function(){var c=this;var d;if(c.isDocMSetCmd()==true){d=c.CMD_DOCMSETADDATTACH}else{d=c.CMD_DOCADDATTACH}return d},getDelAttachCommand:function(){var c=this;var d;if(c.isDocMSetCmd()==true){d=c.CMD_DOCMSETDELATTACH}else{d=c.CMD_DOCDELATTACH}return d},getFolderCmd:function(){var c=this;return{restAPI:c.MODULE_DOC_API_MAIN,listCMD:c.CMD_DOCFOLDERLIST,listchildCMD:c.CMD_DOCFOLDERLISTCHILD,moveparentCMD:c.CMD_DOCFOLDERMOVEPARENT,movebetweenCMD:c.CMD_DOCFOLDERMOVE}}}})(jQuery);desknets.doc.edit={dispStodate:function(b){var c=this;if(b&&b.length>0){return desknets.dateTime.dispDateTime(b)}else{return desknets.Resource.unlimited}}};desknets.page(desknets.doc,"subwin",desknets.PageSubwinSearch,{VAL_SELALL:"",VAL_SELFOLDER:"1",VAL_SELFOLDERUNDER:"2",VAL_SELFOLDEREDIT:"3",init:function(){var b=this;var c=b.getInputArea();var e=desknets.paramanalyzer.getHashParams();var d=e.cmd;if(neo.isSet(d)&&d!=b._getMainCmd()){b.setSubWinSelectFolder(false)}if(neo.isSet(d)&&d==b._getSearchCmd()){c.find('input[name="srch_key"]').val(e.srch_key)}c.find('input[name="sdate"]').val(e.sdate);c.find('input[name="edate"]').val(e.edate);if(e.sfolder){c.find('select[name="sfolder"]').val(e.sfolder)}if(e.srch_filecontents=="1"){c.find('select[name="srch_filecontents"]').val(e.srch_filecontents)}else{c.find('select[name="srch_filecontents"]').val("0")}b.callBase("_initSearch");desknets.htmlparts.setUpForm(b.$_inputArea)},_execClear:function(){var b=this;b.callBase("_execClear");var c=b.getInputArea().find(".doc-search-sfolder");if(!c.attr("disabled")){c.val(b.VAL_SELFOLDERUNDER)}b.getInputArea().find('select[name="srch_filecontents"]').val("0")},_getSearchPrm:function(d){var b=this;var c=b.$_inputArea;var f="";d.fldsort="";d.order="";d.row="0";d.srch_key=c.find('input[name="srch_key"]').val();d.sdate=c.find('input[name="sdate"]').val();d.edate=c.find('input[name="edate"]').val();d.sfolder=c.find('select[name="sfolder"]').val();if(neo.isSet(d.sfolder,{blank:false})){var e=desknets.paramanalyzer.getHashParams();if(e.folder){f=e.folder}else{f=a(".jco-back-page-data:first").find('input[name="folder"]').val()}}d.folder=f;d.srch_filecontents=c.find('select[name="srch_filecontents"]').val();return d},_chkInputSearchRequired:function(){var c=this;var d=c.$_inputArea;var e="";var b=true;var g=d.find('select[name="sfolder"]').val();if(g!=""){var f=desknets.paramanalyzer.getHashParams();if(f.folder){fid=f.folder}else{fid=a(".jco-back-page-data").find('input[name="folder"]').val()}if(!neo.isSet(fid,{blank:false})){e=desknets.Resource.Message.doc_nofolder_search;b=false}}else{if(d.find('input[name="srch_key"]').val()==""&&d.find('input[name="sdate"]').val()==""&&d.find('input[name="edate"]').val()==""){e=desknets.Resource.Message.com_search_nokey;b=false}}if(!b){desknets.dialog.alert(e,{type:"warn"});return false}return c.callBase("_chkInputSearchRequired")},_getMainCmd:function(){return desknets.doc.PAGE_DOCINDEX},_getSearchCmd:function(){return desknets.doc.PAGE_DOCSEARCHINDEX},setSubWinSelectFolder:function(b){var c=this;var d=c.getInputArea();var h=d.find(".doc-search-sfolder");var e=c.VAL_SELALL;if(b){if(!h.attr("disabled")){return}var g=desknets.paramanalyzer.getHashParams();var f=g.cmd;if(!f||f==c._getMainCmd()){e=c.VAL_SELFOLDERUNDER}}if(f==c._getSearchCmd()){e=c.getViewArea().find(".jco-back-page-data").find('input[name="sfolder"]').val();if(!neo.isSet(e)){var g=desknets.paramanalyzer.getHashParams();e=g.sfolder}}h.val(e);h.attr("disabled",!b)},setSubWinSelectEditFolder:function(){var b=this;var c=b.getInputArea();var d=c.find(".doc-search-sfolder");d.val(b.VAL_SELFOLDEREDIT);d.attr("disabled",true)}});(function(b){desknets.page(desknets.doc,"docfolderlist",desknets.folderlist_access,{_boGetRoot:false,_getHtmlFromJson:function(f){var d=this;if(!!d._firstTime||!!d._boUpdate||!!d._boGetRoot){var e={Name:desknets.Resource.doc.editfolder,id:desknets.doc.DOC_FOLDER_EDITID,accesskind:"0"};if(!f.list||!f.list.item){var c={item:e};f.list=c}else{if(b.isPlainObject(f.list.item)){var c={item:[f.list.item]};c.item.push(e);f.list=c}else{f.list.item.push(e)}}if(!neo.isSet(f.folder)){f.folder=""}}d._boGetRoot=false;return d.callBase("_getHtmlFromJson",f)},_getRequestParams:function(e){var c=this;var d=c.callBase("_getRequestParams",e);if(d.pfolder=="0"){c._boGetRoot=true}return d},_setFolderOpenRoot:function(d){var c=this;if(!!d&&d==desknets.doc.DOC_FOLDER_EDITID){return}c.callBase("_setFolderOpenRoot",d)},_openNodeFirstTime:function(e){var d=this;var c=d.$_tree.find(".co-listview-tree-rootli-nosel").find("ul:first").children("li:last");c.addClass("doc-folder-edit");c.addClass("jco-tree-nodrop");d.callBase("_openNodeFirstTime",e)}})})(jQuery);(function(b){desknets.page(desknets.doc,"docfolderaccess",desknets.folderlist.AccessAuth,{_dialogId:"docsetaccess",_TMPL_ACCSELNOTICE:"doc/folderaccess.html",_notice:false,init:function(g){var f=this;var c=b("#jco-acc-list-container");if(c.find("th.doc-folder-notice").length>0){f._TMPL_ACCSEL=f._TMPL_ACCSELNOTICE;f._notice=true}else{f._TMPL_ACCSEL=desknets.PageAccess._TMPL_ACCSEL;f._notice=false}var h=false;var d=b("#"+f._dialogId);if(d.length>0){var e=d.find("#jco-access-notice");if((e.length>0&&!f._notice)||(e.length==0&&f._notice)){d.dialog("destroy").remove()}}f.callBase("init",g)},addClassListBody:function(){var d=this;var c=d._$listTable.find(".co-tbody-list");var e=c.find("tr");if(d._$listTable.find("th.doc-folder-notice").length<=0){return d.callBase("addClassListBody")}e.each(function(){var f=b(this).find("td");f.eq(1).addClass("co-td-acc-user-5");f.eq(2).addClass("co-td-acc-busyo-5");f.eq(3).addClass("co-td-gcond");f.eq(4).addClass("co-td-acc-access-5");f.eq(5).addClass("co-td-acc-access-5");f.eq(6).addClass("co-td-acc-access-5");f.eq(7).addClass("co-td-acc-access-5")})},_createAccessRow:function(i,j,c,e,h,d){var g;var f=this;g=f.callBase("_createAccessRow",i,j,c,e,h,d);if(f._notice==true){g=g+'<td class="co-tcenter doc-td-notice">&nbsp;<input type="hidden" value="'+e+i+'_0" name="notice"></td>'}return g},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN},_getRequestAccsAuthCmd:function(){return desknets.doc.CMD_DOCFOLDERACCESSAUTH},_onSetAccess:function(){var d=this;var f=b("#"+d._dialogId);var g=0;var c,e;if(d._notice==true){if(f.find("#jco-access-notice").attr("checked")){g=1}d._$listTable.find(".co-tbody-list").find("input[type=checkbox]").each(function(){var k=b(this);if(k.attr("checked")){var l=k.parent().parent();var j=l.find("input[name=id]").attr("value");var i=l.find("td.doc-td-notice");var h;if(j=="r2"){return true}if(g==1){i.html(desknets.Resource.doc.folderNoticeOn)}else{i.html("&nbsp;")}h='<input type="hidden" name="notice" value="'+j+"_"+g+'" />';i.append(h)}})}return d.callBase("_onSetAccess")},_setItemsAccessKind:function(){var c=this;var e=b("#"+c._dialogId);var d=1;c.callBase("_setItemsAccessKind");if(c._notice==true){c._$listTable.find(".co-tbody-list").find("input[type=checkbox]").filter(":checked").each(function(){var i=b(this).parent().parent();var h=i.find('input[name="id"]').val();var g=i.find(".doc-td-notice");if(g.find('input[name="notice"]').val()==h+"_0"){d=0}});var f=e.find('input[id="jco-access-notice"]');if(d==1){f.attr("checked","checked")}}},_getDialogSelfOptions:function(f){var d=this;var e=d.callBase("_getDialogSelfOptions",f);if(d._notice==true){var c={title:desknets.Resource.doc.folderAccTitle_Notice,width:500};b.extend(e,c)}return e},_isMSetCmd:function(){return desknets.doc.isDocMSetCmd()}})})(jQuery);(function(b){desknets.page(desknets.doc,"docfolderdialog_entry",desknets.folderlist.dialog_entry,{_getFolderEntryCmd:function(){return desknets.doc.CMD_DOCFOLDERENTRY},_delRootFolderAct:function(e){var d=this;var c=e.find(".co-listview-tree-rootli-nosel").find("ul:first").children("li:last");c.addClass("doc-folder-edit");c.addClass("jco-tree-nodrop");d.callBase("_delRootFolderAct",e)},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN}})})(jQuery);(function(b){desknets.page(desknets.doc,"docfolderdialog_access",desknets.folderlist.dialog_access_under,{_getRequestAccsCmd:function(){return desknets.doc.PAGE_DOCFOLDERACCESS},_getAccessConfMsg:function(){return desknets.Resource.Message.doc_folder_accsconf},_initFolderAccessDlg:function(){desknets.doc.docfolderaccess.init(this._getAjaxFormAccsDlgOption())},_delRootFolderAct:function(e){var d=this;var c=e.find(".co-listview-tree-rootli-nosel").find("ul:first").children("li:last");c.addClass("doc-folder-edit");c.addClass("jco-tree-nodrop");d.callBase("_delRootFolderAct",e)},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN}})})(jQuery);(function(b){desknets.page(desknets.doc,"docfolderdialog_delete",desknets.folderlist.dialog_delete,{_getFolderDelCmd:function(){return desknets.doc.CMD_DOCFOLDERDEL},_delConfAddMessage:function(){return desknets.Resource.Message.doc_folder_delconf},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN}})})(jQuery);(function(b){desknets.page(desknets.doc,"docfolderinput",desknets.folderinput_access,{})})(jQuery);(function(b){desknets.page(desknets.doc,"docfolderdisp",desknets.folderdisp,{})})(jQuery);(function(b){desknets.page(desknets.doc,"docindex",desknets.PagePaneListBase,{_firstDocFolder:"",_selFid:"",boSetwatermark:false,initLeftTree:function(){var c=this;desknets.doc.docfolderlist.init(c.$mjListPage,c._getOptionLeftTree(),c._optTreeGetCmd());c._treeClass=desknets.doc.docfolderlist},_optTreeInitFuncDialog:function(d,c){desknets.doc.docfolderdialog_access.init(d,c);desknets.doc.docfolderdialog_entry.init(d,c);desknets.doc.docfolderdialog_delete.init(d,c)},_optTreeGetCmd:function(){return desknets.doc.getFolderCmd()},treeUpdateList:function(){desknets.doc.docfolderlist.updateTreeList()},treeUpdateListWidth:function(){desknets.doc.docfolderlist._updateItemsWidth()},_optTreeIsEdit:function(){return true},_isAccessCtrl:function(){return true},_optTreeSelectFunc:function(d){var c=this;c._setDocEntryBtn(d);c.callBase("_optTreeSelectFunc",d)},_optTreeAddFolderFunc:function(e,d){var c=this;c._setDocEntryBtn(e);c.callBase("_optTreeAddFolderFunc",e,d)},_optTreeResetFunc:function(f){var e=this;var c=b("#doc-topmsg");var d=e.$mjListPage.find("a.co-listview-item-inside");if((!neo.isSet(d)||d.length==0)&&c.is(":hidden")){c.addClass("jdoc-topmsg-msgon");e._setUpMessage()}e._setDocEntryBtn(f);e.callBase("_optTreeResetFunc",f)},_setDocEntryBtn:function(g){var d=this;var f=false;var e=2;if(!g||g.length==0){f=true}else{var c=g.children("a:first").data("access");if(neo.isSet(c)&&(Number(c)&e)!=e){f=true}else{if(g.data("fid")==0){f=true}}}d.$mjListPage.find(".jco-list-add-page").attr("disabled",f)},_initListEnd:function(){var c=this;var g=c.$mjListPage.find(".jco-back-page-data");var f=c.getInputFieldName();c.callBase("_initListEnd");var e=c.$mjListPage.find(".co-list-search-text");var d=function(){var h=g.find('input[name="srch_key"]');if(g.find('input[name="'+f+'"]').val()==""){return}if(!c.chkListSearchKeyLength(e.val())){return}if(h.val()!=desknets.escape(e.val())){h.val(e.val());c.boChangePageNoHide=true;c._listPage("0")}};b(".co-list-search-btn").find("a").click(function(h){h.preventDefault();d()});desknets.keysearch.setUp("doccmdlist",e,d);c._firstDocFolder=c.$mjListPage.find(".jco-back-page-data").find('input[name="folder"]').val()},_setUpMessage:function(){var d=this;var c=b("#doc-topmsg");var e=false;if(c.hasClass("jdoc-topmsg-msgon")){if(c.hasClass("jdoc-topmsg-manager")){e=true}d._setUpNoFolderMessage(e)}},_setUpNoFolderMessage:function(e){var c=this;var d=desknets.Resource.doc.listnofolder_msg;var f="";if(!neo.isSet(e)||e==false){f=desknets.Resource.doc.listnofolder_user}if(e==true){param=b("#"+desknets.doc.DOC_MSETINDEXID).find("a:first").attr("href");f='<a href="'+param+'">'+desknets.Resource.doc.listnofolder_manage+"</a>"}desknets.pageframe.viewTopMsg(d+"<br />"+f,"alert")},initParamsFromHash:function(d){var c=this;var e="";e=d.cmd;if(!neo.isSet(e)||e==c._getListCmd()||(e==c._getSubWinSearchCmd()&&neo.isSet(d.folder,{blank:false}))){if(d.folder==desknets.doc.DOC_FOLDER_EDITID){c._getSubwinClass().setSubWinSelectEditFolder()}else{c._getSubwinClass().setSubWinSelectFolder(true)}}else{c._getSubwinClass().setSubWinSelectFolder(false)}c.callBase("initParamsFromHash",d)},changPage:function(){var c=this;c.callBase("changPage");if(!c.boSetwatermark){c.boSetwatermark=true;desknets.watermark.set(c.$mjListPage.find(".co-list-search-text"))}},_addOptDraggableList:function(){var c={cancel:"tr:not(.doc-listmod);tr:not(.co-tr-selected)"};return c},_listPageSort:function(d,e){var c=this;c.$mjListPage.find('input[name="fldsort"]').val(d);c.$mjListPage.find(".jco-back-page-data").find('input[name="order"]').val(e);c.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val("0");hash=desknets.getInputDataToUrl(c.$mjListPage.find(".jco-back-page-data"));hash=hash+"&cmd="+c._getListCmd();c._setLocationHash(hash)},_listPage:function(d){var c=this;var g=c.$mjListPage.find(".jco-back-page-data");var f=g.find('input[name="folder"]').val();var e=desknets.paramanalyzer.getHashParams();if(neo.isSet(e)&&e.folder!=f&&f!=desknets.doc.DOC_FOLDER_EDITID){g.find('input[name="fldsort"]').val("");g.find('input[name="order"]').val("");c._mobjParams.fldsort="";c._mobjParams.order=""}c.callBase("_listPage",d)},_hashUpdatePageParams:function(){var e=this;var h=e.$mjListPage.find(".jco-back-page-data");e.callBase("_hashUpdatePageParams");var d=desknets.paramanalyzer.getHashParams();var g=h.find('input[name="folder"]').val();if(!d.folder||d.folder.length==0&&g!=e._firstDocFolder){e._mobjParams.fldsort="";e._mobjParams.order=""}if(!d.fldsort||!d.order||d.fldsort.length==0||d.order.length==0){var f;var c;f=e._mobjParams.fldsort;c=e._mobjParams.order;h.find('input[name="fldsort"]').val(f);h.find('input[name="order"]').val(c)}},_getListAjaxSuccess:function(e){var c=this;var d=c._mcListTemplate;c._selFid=c._getSelectFolderId();c._mcListTemplate=desknets.tmpl.replaceWordHtml(c._mcListTemplate,"fid",c._selFid);c.callBase("_getListAjaxSuccess",e);c._mcListTemplate=d},_getSelectFolderId:function(){var c=this;var d=desknets.paramanalyzer.getHashParams();var e=d.folder;if(!neo.isSet(e,{blank:false})){if((typeof jsonRestFolder)!="undefined"&&jsonRestFolder.folder){e=jsonRestFolder.folder}else{e=c.$mjListPage.find(".jco-back-page-data").find('input[name="folder"]').val()}}return e},_getListAjaxSuccessOtherSet:function(d){var c=this;var g=c.$mjListPage.find(".jco-back-page-data");var f="";desknets.pageframe.closeTopMsg();c._setUpMessage();c.callBase("_getListAjaxSuccessOtherSet",d);if(d.fldsort){g.find('input[name="fldsort"]').val(d.fldsort);c._mobjParams.fldsort=d.fldsort}if(d.order){g.find('input[name="order"]').val(d.order);c._mobjParams.order=d.order}var e=d.noticeerror;if(neo.isSet(e)&&e=="1"){c._setUpNoticeErrorMessage()}},_setUpNoticeErrorMessage:function(f){var c=this;var e=desknets.Resource.Message.doc_notice_errormsg;desknets.pageframe.viewTopMsg(e,"alert doc-index-modfolder");var d=b(".doc-index-modfolder").find("a.doc-err-detail");d.off("click");d.on("click",function(h){h.preventDefault();desknets.pageframe.closeTopMsg();var g=b("#doc-noticeerr-detail");if(g.length>0){g.remove();g.dialog("destroy")}c._createErrDetailDlg()})},_createErrDetailDlg:function(){var d=this;var f;var g=b(".doc-notice-pop");var h={};var j;function c(l){var k=l[0].html;g.html(k);var m=g.find(".doc-notice-date");if(m.length>0){m.text(desknets.dateTime.dispDateTime(m.text()))}d._setErrResultDlg()}f=desknets.getUrl(d._getRestModule());j=d.$mjListPage.find(".jco-back-page-data").find('input[name="folder"]').val();var i={cmd:d._getErrResultCmd(),folder:j};h["0"]=i;var e=desknets.ajax.arrayToMultiCmdData(h);desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:f,data:e,success:function(l,k,m){c(l)},detectMultiError:true})},_setErrResultDlg:function(){var d=this;var c=b("#doc-noticeerr-detail");var e=desknets.dialog.getDialogOption();var f={buttons:{},dialogClass:"dn-dialog",title:desknets.Resource.doc.auto_error,width:600};f.buttons[desknets.Resource.OKButtonLabel]=function(){d._cleanNoticeError(c)};f.buttons[desknets.Resource.CancelButtonLabel]=function(){c.remove();c.dialog("destroy")};b.extend(e,f);desknets.dialog.setUp(c,e);c.dialog("open");c.next().find("button").blur();desknets.dialog.setFirstDialogOpen(c)},_cleanNoticeError:function(e){var c=this;desknets.submitform.setDialogDisabled(e);var d=desknets.getUrl(c._getRestModule());var g=c.$mjListPage.find(".jco-back-page-data").find('input[name="folder"]').val();var f={cmd:c._getNoticeErrCleanCmd(),folder:g};desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:d,data:f,success:function(i,h,j){desknets.submitform.clearDialogDisabled(e);e.remove();e.dialog("destroy")}})},_getListAjaxSuccessEnd:function(){var c=this;var d=desknets.paramanalyzer.getHashParams();c.callBase("_getListAjaxSuccessEnd");desknets.keysearch.fixListWatermark(c.$mjListPage,d)},_listSortLink:function(){var c=this;var d=b.extend({},c._mobjParams);var e=function(h){var g=null;h.removeClass("asc");h.removeClass("desc");h.each(function(){g=b(this);if(g.data("sort")==d.fldsort){if(d.order=="1"){g.addClass("asc")}else{g.addClass("desc")}return false}})};var f=c.$mjListPage.find(".co-list-sort-item").find(".co-list-sort-data");e(f);f=c.$mjListPage.find(".co-table-list").find(".co-list-sort-data");e(f)},_listLine:function(f,h){var e=this;var c="";var d=e._getRevCmd();if(typeof h=="object"){var i="";if(h.agenda&&h.agenda=="1"){var g=desknets.Resource.doc.listagenda;i='<span class="doc-ic-list agenda" title="'+g+'">'+g+"</span>"}f=desknets.tmpl.replaceWordHtml(f,"agenda",i);i="doc-listdisp";if(h.accessmod&&h.accessmod=="1"&&!desknets.browser.tablet){i="doc-listmod"}if(h.edit&&h.edit=="1"){f=desknets.tmpl.replaceWord(f,"cmd",this._getListModCmd())}f=desknets.tmpl.replaceWordHtml(f,"modClass",i);i="{{updtime}}";if(h.revision&&h.revision=="1"){i='<a href="#cmd='+d+"&id="+h.id+"&folder="+e._selFid+'">{{updtime}}</a>'}f=desknets.tmpl.replaceWordHtml(f,"revision",i)}f=e.callBase("_listLine",f,h);return f},_replaceListLine:function(d,i,g){var c=this;var h;if(i==="status"){var e="";h="";if(g.status&&g.status=="3"){var f=desknets.Resource.doc;e="co-tr-off";if(g.edit&&g.edit=="1"){h='<span class="doc-ic-list docedit" title="'+f.listedit+'">'+f.listedit+"</span>"}else{h='<span class="co-msg-r">'+f.listworking+"</span>"}}d=desknets.tmpl.replaceWordHtml(d,"status",h);d=desknets.tmpl.replaceWordHtml(d,"statusClass",e)}else{if(i==="updtime"){h=desknets.dateTime.dispDateTime(g.updtime,{type:"list"});d=desknets.tmpl.replaceWordHtml(d,"updtime",h)}else{return c.callBase("_replaceListLine",d,i,g)}}return d},inputAddPage:function(e){var c=this;var d=c.$mjListPage.find(".jco-back-page-data");var f=d.find('input[name="folder"]').val();if(!neo.isSet(f,{blank:false})){var g=desknets.Resource.Message.doc_nofolder_add;desknets.dialog.alert(g,{type:"warn"});return}else{c.callBase("inputAddPage",e)}},_getAddPageParam:function(){var c=this;var d=c.$mjListPage.find(".jco-back-page-data");var e=d.find('input[name="folder"]').val();return{folder:e}},_getModPageParam:function(){return this._getAddPageParam()},_getDispPageParam:function(){return this._getAddPageParam()},_inputPage:function(d){var c=this;c.callBase("_inputPage",d);desknets.pageframe.closeTopMsg()},_hashUpdatePageView:function(d){var c=this;if(d==desknets.doc.PAGE_DOCREVINDEX){if(c.mhashBackCmd==""||c.mhashIdBack==""){c.mhashBackErrCmd=c.mhashBackCmd;c.mhashIdErrBack=c.mhashIdBack;c.mhashBackCmd=c._getListCmd();c.mhashIdBack=c._getIdListPage()}if(b("#jco-m-revlist-container").find(".jco-title").length>0){desknets.doc.docrevindex.mBackCmd=c.mhashBackCmd;desknets.doc.docrevindex.mIdBack=c.mhashIdBack;desknets.doc.docrevindex._getListAjax("0")}else{desknets.doc.docrevindex.initPage(c.mhashBackCmd,c.mhashIdBack)}}else{if(d==desknets.doc.PAGE_DOCREVREFER){desknets.doc.docrevdisp.initPage(desknets.doc.PAGE_DOCREVINDEX,"jco-m-revlist-container")}else{if(d==desknets.doc.PAGE_DOCSEARCHINDEX){desknets.doc.docsearchindex.initPage(desknets.doc.PAGE_DOCINDEX,"jco-m-list-container");c.mhashBackErrCmd=c.mhashBackCmd;c.mhashIdErrBack=c.mhashIdBack;c.mhashBackCmd=d;c.mhashIdBack="jco-m-search-container"}}}},_getSearchParam:function(){var c=this;var f=desknets.paramanalyzer.getHashParams();var e=c.$mjListPage.find(".jco-back-page-data");var d=e.find('input[name="srch_key"]').val();var g={};if(f&&f.srch_key&&f.srch_key.length>0){g.srch_key=f.srch_key}else{if(d!=""){g.srch_key=d}}return g},_getRequestMoveConfParams:function(c){var d=this;var e=d.callBase("_getRequestMoveConfParams",c);d._moveParams=b.extend({},e);e.cmd=d._getMoveListConfCmd();return e},_getSizeHideWidth:function(){return"550"},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN},_getListCmd:function(){return desknets.doc.PAGE_DOCINDEX},_getListExecCmd:function(){return desknets.doc.CMD_DOCINDEXLIST},_getMoveAddPrm:function(){return this._getSearchParam()},_getMoveListConfCmd:function(){return desknets.doc.CMD_DOCLISTCONFMOVE},_getMoveListCmd:function(){return desknets.doc.CMD_DOCLISTMOVE},_getListDispCmd:function(){return desknets.doc.PAGE_DOCREFER},_getListAddCmd:function(){return desknets.doc.PAGE_DOCENTRY},_getListModCmd:function(){return this._getListAddCmd()},_getDelCmd:function(){return desknets.doc.CMD_DOCLISTCONFDEL},_getDelExecCmd:function(){return desknets.doc.CMD_DOCLISTDEL},_getDelAddPrm:function(){var c=this;var d=c._getSearchParam();b.extend(d,c._getAddPageParam());return d},_getRevCmd:function(){return desknets.doc.PAGE_DOCREVINDEX},_getSubWinSearchCmd:function(){return desknets.doc.PAGE_DOCSEARCHINDEX},_getErrResultCmd:function(){return desknets.doc.PAGE_DOCNOTICEERRDETAIL},_getNoticeErrCleanCmd:function(){return desknets.doc.CMD_DOCNOTICERRCLEAN},_getListEntryClass:function(){return desknets.doc.docentry},_getListModClass:function(){return this._getListEntryClass()},_getListDispClass:function(){return desknets.doc.docdisp},_getSubwinClass:function(){return desknets.doc.subwin}})})(jQuery);(function(b){desknets.page(desknets.doc,"docentry",desknets.PagePaneInputBase,{_modAttach:{},_boGetExt:false,_boCancel:false,_docstatus:"",initLeftTree:function(){var c=this;desknets.doc.docfolderinput.init(c.$mjPage,c._getOptionLeftTree(),c._optTreeGetCmd())},_optTreeGetCmd:function(){return desknets.doc.getFolderCmd()},treeUpdateListWidth:function(){desknets.doc.docfolderinput._updateItemsWidth()},_isAccessCtrl:function(){return true},_getOptionLeftTree:function(){var d=this;var e=d.callBase("_getOptionLeftTree");var f=desknets.paramanalyzer.getHashParams();if(f.folder==desknets.doc.DOC_FOLDER_EDITID){var c=function(){d._selectInputTree()};e.openFunc=c}return e},_initHtml:function(d){var c=this;if(neo.isSet(d[1])&&d[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[1]["errorno"],d[1]["errormessage"])}else{if(neo.isSet(d[2])&&d[2]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[2]["errorno"],d[2]["errormessage"])}else{c.callBase("_initHtml",d);b("#jco-m-disp-page").empty();b("#jco-m-revdisp-page").empty();c.$mjPage.find('input[name="Url"]').val(desknets.getUrl(desknets.doc.MODULE_DOC_MAIN));c._setAttachArea(d);c._createEventInput();c._inputFormSaveToObserver()}}},changPage:function(){var d=this;d._initPageDocument();d.callBase("changPage");var c=b(".doc-entryaccess");if(c.length>0){c.remove();c.dialog("destroy")}b("#docsetaccess").remove();if(d.$mjPage.find("#jco-add-folder").find(".co-selitem").length==0){desknets.pageframe.viewTopMsg(desknets.Resource.Message.com_entry_changeaccess,"alert")}},_getErrorPlace:function(c){var d=this;if(c=="attach"){var e=desknets.Resource.attachTitle+desknets.merrMsgConnect;return e}else{return d.callBase("_getErrorPlace",c)}},_setAttachArea:function(d){var c=this;var e={};var f={};if(neo.isSet(d["2"])){e=d["1"];f=d["2"]}else{if(c._boGetExt==true){e=d["1"]}else{if(neo.isSet(d["1"])){f=d["1"]}}}if(!b.isEmptyObject(e)){desknets.attach.ext.saveList(e)}c._boGetExt=false;c._modAttach=f;desknets.doc.docattach.init(this);c.$mjPage.find("textarea").trigger("mouseup")},_initPageDocument:function(){var d=this;var e=d.$mjPage.find(".doc-stodate");var c=d.$mjPage.find('input[name="stodate"]').val();if(c.length>0){b("#doc-sel-stodate").attr("value","0");e.show()}else{e.hide()}},_createEventInput:function(){var d=this;var f=desknets.paramanalyzer.getHashParams();if(neo.isSet(f.id,{blank:false})){d.$mjPage.find(".doc-input-back-page").click(function(g){g.preventDefault();d._inputModCancelSubmitBefore()});d.$mjPage.find(".jdoc-input-undoedit-conf").click(function(g){g.preventDefault();d._inputModUndoEditSubmitBefore()})}b("#doc-sel-stodate").change(function(){b("#doc-sel-stodate option:selected").each(function(){var h=d.$mjPage.find(".doc-stodate");var g=b(this).val();if(g=="1"){if(h.hasClass("ui-invalid")){b.datepicker._clearDate(h)}h.hide()}else{h.show()}});d._setListviewHeight(d.$mjPage)});d._setDocumentAccess();var c=d._getDocumentDialogCmds();var e={change:function(){d._setListviewHeight(d.$mjPage)}};desknets.doc.chooserDoc.init(b("#jdoc-docsel-area"),c,e);desknets.htmlparts.setUpForm(b(d._mIdPageForm))},_setDocumentAccess:function(){var c=this;var e=c.$mjPage;var d={idFldName:"aid",area:e.find(".jdoc-area-access"),module:c._getRestModule(),param:c._getAccsTmplParams(),dialoghtml:e.find("#jdoc-pop-access"),beforeopen:function(){c._beforeDialogAccess()},afteraccchg:function(){c._afterDialogAccess()},bosubmitcommit:false};desknets.doc.docaccess.setUp(d);e.find(".co-listview").delegate(".jdoc-access","click",function(f){f.preventDefault();desknets.doc.docaccess.openDialog()})},_inputModCancelSubmitBefore:function(){var c=this;c._boCancel=false;if(c._formObserveisChanged()){c._boCancel=true;c.dispBackListPage()}else{c._inputModCancelSubmit()}},_inputModUndoEditSubmitBefore:function(){var d=this;var e=desknets.Resource.Message.doc_undoedit_conf;var c=desknets.dialog.confirm(e,function(){desknets.submitform.setDialogDisabled(c);d.resetFuncBeforeHashChange();var f=desknets.getUrl(desknets.doc.MODULE_DOC_API_MAIN);var h=desknets.paramanalyzer.getHashParams();var g={};g.cmd=desknets.doc.CMD_DOCUNDOEDIT;g.id=h.id;desknets.ajax.rest({url:f,data:g,success:function(j,i,k){d.$mjPage.find('input[name="status"]').val(desknets.doc.DOC_STATUS_COMPLETE);d.dispBackListPage()},complete:function(){desknets.submitform.clearDialogDisabled(c);c.dialog("close")}});return false})},_inputModCancelSubmit:function(){var d=this;var f=desknets.paramanalyzer.getHashParams();var g={cmd:d._getModStatusCmd()};var c;desknets.submitform.setDisabled(b("#inputfrm"));desknets.attach.detachInput();g.id=d.$mjPage.find('input[name="id"]').val();g.folder=f.folder;g.status=d.$mjPage.find('input[name="status"]').val();if(g.status==desknets.doc.DOC_STATUS_WORKING){g.checkoutuid=d.$mjPage.find('input[name="checkoutuid"]').val()}if(d._boCancel){c=b(window).data("hashobserver");if(c){c.stopObserveHash()}}var e=function(){if(!d._boCancel){d.dispBackListPage()}else{if(c){c.startObserveHash();b(window).trigger("hashchange")}}d._boCancel=false;desknets.attach.attachInput()};if(g.folder==desknets.doc.DOC_FOLDER_EDITID){e();return}desknets.ajax.rest({url:desknets.getUrl(d._getRestModule()),data:g,success:function(h){},error:function(j,h,i){},complete:function(){e()}})},resetFuncBeforeHashChange:function(){var c=this;if(c._boCancel){c._inputModCancelSubmit()}c.callBase("resetFuncBeforeHashChange")},dispBackListPage:function(){var c=this;if(neo.isSet(c.mBackCmd)&&c.mBackCmd==c._getSearchCmd()){var d=b("#jco-m-search-container").find(".jco-back-page-data");if(d.find('input[name="sfolder"]').val()==""){d.find('input[name="folder"]').val("")}}c.callBase("dispBackListPage")},_inputAddSubmit:function(){var c=this;c._boCancel=false;desknets.attach.detachInput();c._docstatus=c.$mjPage.find('input[name="status"]').val();c.$mjPage.find('input[name="status"]').val(desknets.doc.DOC_STATUS_COMPLETE);c.callBase("_inputAddSubmit")},_inputModSubmit:function(){var c=this;c._boCancel=false;desknets.attach.detachInput();c._docstatus=c.$mjPage.find('input[name="status"]').val();c.$mjPage.find('input[name="status"]').val(desknets.doc.DOC_STATUS_WORKING);c.callBase("_inputModSubmit")},_inputDelSubmit:function(d){var c=this;c._boCancel=false;c.callBase("_inputDelSubmit",d)},_inputAjaxFormOption:function(){var c=this;var d=c.callBase("_inputAjaxFormOption");d.complete=function(g,e,f){if(b("#ifiles").length==0){desknets.attach.attachInput()}desknets.doc.docattach.clearDisableAttach(c.$mjPage);c._onCompleteForm()};d.success=function(g,e,h){if(!!g.noticeerror){var f=desknets.dialog.alert(g.noticeerror,{extraClass:"co-msg-r",type:"warn"});f.bind("dialogclose",function(i){desknets.dialog.deleteById("warn");c._setLocationHashForm()});return}c._setLocationHashForm()};return d},getMultiRequest:function(){var c=this;var h={};var e={};e=c.callBase("getMultiRequest");h=desknets.paramanalyzer.getHashParams();var g=desknets.attach.ext.getListParam();if(neo.isSet(g)){g.cmd=desknets.doc.CMD_DOCEXTLIST;e["1"]=g;c._boGetExt=true}if(neo.isSet(h.id,{blank:false})){var f={};var d="";var i=h.folder;d=c._getAttachListCmd();if(!i||i.length==0){i=c.$mjPage.find('input[name="folder"]').val()}f.cmd=d;f.id=h.id;f.folder=i;if(neo.isSet(g)){e["2"]=f}else{e["1"]=f}}return e},onErrorForm:function(d){var c=this;c.callBase("onErrorForm",d);c.$mjPage.find('input[name="status"]').val(c._docstatus);desknets.attach.attachInput();desknets.doc.docattach.clearDisableAttach(c.$mjPage)},_beforeDialogAccess:function(){var d=this;var e=d.$mjPage;var c=b(".doc-entryaccess");if(c.length>0){var f=e.find('input[name="folder"]').val();c.find('input[name="folder"]').val(f);c.find("div.jco-accessauth-msg").html("");d._changeAccessAuth(c,f)}},_changeAccessAuth:function(c,f){var d=this;var e={cmd:d._getAccessAuthListCmd()};if(f&&f.length>0){b.extend(e,{folder:f})}url=desknets.getUrl(d._getRestModule());desknets.ajax.rest({url:url,data:e,success:function(g){d._changeAccsAuthList(c,g);c.dialog("open");c.find("div.co-listview-accessauth").scrollTop(0);desknets.dialog.setFirstDialogOpen(c)}})},_changeAccsAuthList:function(c,h){var g=this;var f=c.find("div.co-listview-accessauth");var i="";f.empty();if(h.list&&h.list.item){var d=h.list.item;var e=[];if(d.length>1){e=d}else{e=[d]}b.each(e,function(j,k){if(j>0){i=i+","}var l=desknets.tmpl.escapeWord(k.Name);i=i+l})}f.html(i)},_afterDialogAccess:function(){var c=this;c._setListviewHeight(c.$mjPage)},_getAccsTmplParams:function(){var d=this;var e=d._getRequestAccsCmd();var g={cmd:e};var f=d.$mjPage.find('input[name="folder"]').val();if(f&&f.length>0){b.extend(g,{folder:f})}var c=d.$mjPage.find('input[name="id"]').val();if(c&&c.length>0){b.extend(g,{id:c})}return g},_getDocumentDialogCmds:function(){var c=this;var d={};d.module=desknets.doc.MODULE_DOC_API_MAIN;d.cmddef=desknets.doc.CMD_DOCFOLDERLIST;d.cmdchild=desknets.doc.CMD_DOCFOLDERLISTCHILD;d.cmddocs=desknets.doc.CMD_DOCINDEXLIST;d.cmddocref=desknets.doc.PAGE_DOCREFER;d.cmddocsearch=desknets.doc.CMD_DOCSEARCHLIST;return d},_getRequestAccsCmd:function(){return desknets.doc.PAGE_DOCACCESS},_initFolderAccessDlg:function(){desknets.doc.docaccess.init()},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN},_getAttachListCmd:function(){return desknets.doc.CMD_DOCLISTATTACH},_getAccessAuthListCmd:function(){return desknets.doc.CMD_DOCACCESSAUTHLIST},_getDelExecCmd:function(){return desknets.doc.CMD_DOCDEL},_getAddExecCmd:function(){return desknets.doc.CMD_DOCENTRY},_getModStatusCmd:function(){return desknets.doc.CMD_DOCENTRYSTATUS},_getModExecCmd:function(){var c=this;return c._getAddExecCmd()},_getSearchCmd:function(){return desknets.doc.PAGE_DOCSEARCHINDEX}})})(jQuery);desknets.page(desknets.doc,"docaccess",desknets.folderlist.AccessAuth,{_TMPL_ACCSEL:"doc/docaccess.html",_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN},_getRequestAccsAuthCmd:function(){return desknets.doc.CMD_DOCACCESSAUTH},_setItemsAccessKind:function(){var c=this;var h=a("#"+c._dialogId);var b=1;var g=1;var d=1;c._$listTable.find(".co-tbody-list").find("input[type=checkbox]").filter(":checked").each(function(){var i=a(this);var j=i.parent().parent().find(".comad-td-access");j.each(function(k){if(a(this).html()=="&nbsp;"){if(k+1==1){b=0}if(k+1==2){g=0}if(k+1==3){d=0}}})});var f=h.find("input[type=checkbox]");for(var e=0;e<f.length;e++){if((a(f[e]).attr("id")==c._ID_ACCESS_OPEN&&b==1)||(a(f[e]).attr("id")==c._ID_ACCESS_MOD&&g==1)||(a(f[e]).attr("id")==c._ID_ACCESS_DEL&&d==1)){a(f[e]).attr("checked","checked")}}},_setAccessTdText:function(d,b){var c=this;if(b.accsOpen&c._BIT_ACCESS_OPEN){a(d[0]).text(desknets.Resource.acceccOpen)}if(b.accsMod&c._BIT_ACCESS_MOD){a(d[1]).text(desknets.Resource.acceccMod)}if(b.accsDel&c._BIT_ACCESS_DEL){a(d[2]).text(desknets.Resource.acceccDel)}},addClassListHead:function(){var c=this;var b=c._$listTable.find("thead").find("th");b.eq(1).addClass("co-th-acc-user-3of4").removeClass("co-th-acc-user");b.eq(2).addClass("co-th-acc-busyo-3of4").removeClass("co-th-acc-busyo");b.eq(4).attr("colSpan",3)},addClassListBody:function(){var c=this;var b=c._$listTable.find(".co-tbody-list");var d=b.find("tr");d.each(function(){var e=a(this).find("td");e.eq(1).addClass("co-td-acc-user-3of4");e.eq(2).addClass("co-td-acc-busyo-3of4");e.eq(3).addClass("co-td-gcond")})},_getAccessListDefRow:function(){var b;b='<td class="comad-td-access">'+desknets.Resource.acceccOpen+"</td>";b=b+'<td class="comad-td-access">&nbsp;</td>';b=b+'<td class="comad-td-access">&nbsp;</td>';return b},_getTargetIDAccsAuth:function(){var b=this;var c=b.callBase("_getTargetIDAccsAuth");if(!neo.isSet(c,{blank:false})&&neo.isSet(b._options.area)){c=a("#jco-add-folder").find('input[name="folder"]').val()}return c},_getSelDialogID:function(){return"jco-sel-doc-access-items"},_initFolderAccessDlg:function(){var b=this;if(a.isFunction(b._options.beforeopen)){b._options.beforeopen()}b.init(null,false)},_isMSetCmd:function(){return desknets.doc.isDocMSetCmd()}});desknets.page(desknets.doc,"docattach",null,{id:"attach",page:null,files:{},$entry:null,$entryAttachList:null,$attach:null,init:function(c){var b=this;b.$attach=null;b.page=c;b.$entry=c.$mjPage;b.$entryAttachList=b.$entry.find(".jdoc-attachlist");b.files=a.extend({},c._modAttach);b._setUpEntry()},clearDisableAttach:function(b){b.find(".co-pop-tp-stop-btn").attr("disabled","disabled");if(b.find(".co-pop-tp-file-thumbs>li").length==0){b.find(".co-pop-tp-clear-btn").attr("disabled","disabled")}},_setUpEntry:function(){var c=this;var f=c.files;var h=Number(c.$entry.find('input[name="item_max_size"]').val());if(h<=0){h=2147483648}var d=function(){c._getafterUpload()};var e={fileDrop:c.$entryAttachList,totalSizeLimit:h,downloadURL:c._getDownLoadURL(),uploadURL:desknets.getUrl(desknets.doc.MODULE_DOC_API_MAIN),uploadParams:c._getAddParams(),delURL:desknets.getUrl(desknets.doc.MODULE_DOC_API_MAIN),delParams:c._getDelParams(),beforUpload:c._getbeforUpload,afterUpload:d};var g={};g=c._getFiles();e.file=g;var b=desknets.attach.ext.getIconList();if(b){e.icon=b}c.$attach=desknets.attach;c.$attach._destroy();c.$attach.totalFileNum=0;c.$attach.upload(e)},_getDownLoadURL:function(){var b=this;var c=b._getParams(desknets.doc.getAttachCommand());return desknets.getUrl(desknets.doc.MODULE_DOC_MAIN)+"?"+a.param(c)+"&fno={{id}}&tmpnm={{tmpnm}}"},_getAddParams:function(){var b=this;return b._getParams(desknets.doc.getAddAttachCommand())},_getDelParams:function(){var b=this;return b._getParams(desknets.doc.getDelAttachCommand())},_getParams:function(d){var b=this;var e={};var c=b.$entry.find('input[name="id"]').val();if(neo.isSet(c,{blank:false})){e={cmd:d,id:c}}else{e={cmd:d}}return e},_getFiles:function(){var d=this;var f={};var e=[];f.tmpnm=d.$entry.find('input[name="tmpnm"]').val();if(!d.files||!d.files.attach){f.files=[];return f}var b=d.files.attach.item;var c=[];if(b.length>1){c=b}else{c=[b]}a.each(c,function(g,h){var j={};j.attachdisp=h.attachdisp;j.fno=h.id;j.size=parseInt(h.size,10);e[g]=j});f.files=e;return f},_getbeforUpload:function(){var b=this;desknets.submitform.setDisabled(a("#inputfrm"))},_getafterUpload:function(){var b=this;var c=a("#inputfrm");desknets.submitform.clearDisabled(c);b.clearDisableAttach(c);b.$entryAttachList.addClass(desknets._CLSNAME_MODFILES)}});a.widget("desknets.dnChooserDoc",a.desknets.dnChooser,{_TMPL:"doc/chooserdoc.html",_setSelectedItemsInActiveTab:function(b){if(!!this._activeTab){this._activeTab.$itemList.dnChooserDocItemList("select",b)}},_createTabs:function(f,e){var d=this,b;var c;if(this.options.search){this._createTab(f,desknets.doc.chooserDoc.searchTabItem)}if(this.options.chooseGroup){this._createTab(f,desknets.doc.chooserDoc.folderTabItem)}if(this.options.chooseHistory){this._createTab(f,desknets.doc.chooserDoc.historyTabItem)}f.delegate("li","click",function(g){g.preventDefault();d._selectTab(a(this));d._saveTabSelection()});b=f.children("li:not(.co-sel-disabled)");if(b.length<=this.options.selectedTabIndex){this.options.selectedTabIndex=0}c="dnchooserdocitemlistload";this.element.on(c,function(g){d._updateSelectedItemsInActiveTab()});this.element.one(c,function(g){if(typeof e=="function"){e()}});this._selectTab(this._getDefaultTabSelection(b))},_getDefaultTabSelection:function(b){var c;c=b.filter("."+desknets.doc.chooserDoc.folderTabItem.rootClass);if(c.length==1){return c}return b.eq(0)},_saveTabSelection:function(){return},});desknets.doc.chooserDoc=a.extend({},desknets.chooser,{MODULE:"zrdoc",_defOptions:{dialogID:"doc-docsel-dialog",selectClass:"doc-selreldoc",funcDefSel:null,change:null,filter:null},_defDialogOptions:{search:true,chooseHistory:true,chooseGroup:true,chooseTarget:["user"],leafChoosable:true,keyName:"id",itemListPlugIn:"dnChooserDocItemList",choosenListPlugIn:"dnChooserChoosenDocList"},_ins:null,init:function(i,g,d,e){var b=this;var f={};a.extend(f,b._defOptions,d);var h={};a.extend(h,b._defDialogOptions);h.module=g.module;h.cmdgroups=g.cmdchild;h.cmdgrouptree=g.cmddef;h.cmdusers=g.cmddocs;h.cmddocref=g.cmddocref;h.cmddocsearch=g.cmddocsearch;h.dialogRoot=i;h.selectClass=f.selectClass;h.keyName=f.keyName;a.extend(h,e);if(!a.isFunction(f.funcDefSel)){f.funcDefSel=b._getTargets}var c={};c={dialogID:f.dialogID,dialogOptions:h,extraVars:{group:{keyName:f.keyName}}};if(a.isFunction(f.change)){c.change=f.change}b._ins=b.setUpEntry(i,f.funcDefSel(i,f),c)},setUpEntry:function(e,b,c){var d=a("#"+c.dialogID);if(d.length>0){desknets.chooser.destroyDialog(d)}return new desknets.doc.chooserDoc.Entry(e,b,c)},setUpDialog:function(f,d){var b=this,e={};var c=a("<div />").appendTo(f);if(!!d){a.extend(e,d);this._setUpChooseEvent(f,d.choose)}f.bind("dnchooserdocload",function(){var g="com_chooser_note";desknets.dialog.setUp(f,b._getChooserDialogOptions(d));a('<div class="co-msg co-sel-dialog-note" />').text(desknets.Resource.Message[g]).appendTo(f.closest(".ui-dialog"));f.dialog("open")});c.dnChooserDoc(e)},open:function(e,c){var b=this,d=a("#"+e);if(d.hasClass("ui-dialog-content")){desknets.pageframe.executeOnTipShown(function(){if(!!c&&!!c.items){d.children(".co-sel").dnChooserDoc("items",c.items)}d.dialog("open")});return d}else{if(d.length<=0){d=a("<div />").attr("id",e).appendTo(document.body);desknets.pageframe.executeOnTipShown(function(){b.setUpDialog(d,c)})}}return d},close:function(c,b){c.dialog("close");if(b){desknets.doc.chooserDoc.saveHistory(c.children().dnChooserDoc("items"))}},_setUpChooseEvent:function(b,c){if(a.isFunction(c)){b.bind("choose.dnChooserDoc",function(f,e){var d=c.apply(this,[e]);if(d===false){f.preventDefault()}})}},_onChooseItems:function(e,c){var b=e.children().dnChooserDoc("items");var d=a.Event("choose.dnChooserDoc");if(!this._validate(b,e)){return}e.trigger(d,[b]);if(!d.isDefaultPrevented()){this.close(e,true)}},_getTargets:function(d,c){var b=[];d.find("."+c.selectClass+">.doc-entry-relitem").each(function(){var e=a(this);var f=e.val();if(neo.isSet(f)&&f.length>0){b.push({id:f,type:"user",name:e.data("name"),fid:e.data("fid"),description:desknets.tmpl.escapeWord(e.data("fname"))})}a(this).remove()});return b},_ajaxRestPostfilterSingle:function(e,d,c){if(!neo.isSet(d.allcnt)){var b=desknets.ajax.getJsonItems(d);d.allcnt=b.length}this._ajaxRestPostfilterCommon(e,d,c)},convertUserItem:function(c){var b={id:c.id,type:"user",name:c.Name,description:this.convertUserDescription(c),hasChildren:false,edit:c.edit};if(!!c.fid){b.fid=c.fid;b.foldername=c.foldername}return b}});desknets.doc.chooserDoc.Entry=function(e,c,d){var b=this._SELTEMP;b=desknets.tmpl.replaceWordHtml(b,"L_Delete",desknets.Resource.deselectLabel);this._defaultOptions.template=b;this._defaultOptions.cmddocref=d.dialogOptions.cmddocref;this.init(e,c,d);return this};desknets.doc.chooserDoc.entry=a.extend({},desknets.chooser.entry,{_SELTEMP:'<tr><td class="co-selitem-text"><a href="#" class="co-btn co-btn-close" title="{{L_Delete}}">x</a><a target="_blank" href="{{url}}">{{name}}</a><input type="hidden" name="relid" value="{{id}}" /></td><td>{{fname}}</td></tr>',init:function(d,b,c){this._$root=d.addClass("co-sel-no-items");this._items=[];this._options=a.extend({},this._defaultOptions,c);this._$items=d.find(".doc-selreldoc").find(".doc-selreldoc-table").children("tbody");this._initEvents(d.find(".jco-sel-btn"));if(this._options.initCreate){this.replaceItems(b)}this._updateElement()},_initEvents:function(c){var b=this;b._options.dialogOptions.choose=function(d){b._onChooseItem(d)};c.click(function(d){d.preventDefault();b._options.dialogOptions.items=b._items;desknets.doc.chooserDoc.open(b._options.dialogID,b._options.dialogOptions)});b._$items.delegate(".co-btn-close","click",function(d){d.preventDefault();b.removeItems(b._closestItem(a(this)))})},_createItemElement:function(f){var e=this._options.template;var b=a.extend({},f);b.name=desknets.tmpl.escapeWord(b.name);b.fname=b.description;var c=desknets.getUrl(desknets.doc.MODULE_DOC_MAIN);b.url=c+"?cmd="+this._options.cmddocref+"&id="+f.id+"&folder="+f.fid;for(var d in b){e=desknets.tmpl.replaceWordHtml(e,d,b[d])}return a(e)},removeItems:function(e){var b={},d;e.each(function(){var f=a(this);d="user"+f.find('input[name="relid"]').val();b[d]=true});for(var c=this._items.length-1;c>=0;c--){d=this._items[c].type+this._items[c].id;if(!!b[d]){this._items.splice(c,1)}}e.remove();this._updateElement(true)}});desknets.doc.chooserDoc.Entry.prototype=desknets.doc.chooserDoc.entry;desknets.doc.chooserDoc.loadHistory=function(e,d,g){var b=this;var f=[],c=[];f.push({cmd:"doccmdhistorylist"});c.push("user");desknets.chooser._ajaxRest(desknets.getUrl(desknets.doc.chooserDoc.MODULE),f,function(h){g(b._getHistoriesFromMultiJson(h,c,d))},d)};desknets.doc.chooserDoc.saveHistory=function(c){var f=this._filterHistory(c);var e={cmd:"doccmdsavehistory"};for(var d=0;d<f.length;d++){var b=(d+1).toString();e["id"+b]=f[d].id;e["Name"+b]=f[d].name;e["fid"+b]=f[d].fid;e["foldername"+b]=f[d].foldername}desknets.ajax.rest({url:desknets.getUrl(desknets.doc.chooserDoc.MODULE),data:e})};desknets.doc.chooserDoc._filterHistory=function(d){var c=this,e=[];var b={num:0,id:{}};a.each(d,function(f,g){if(!b||b.num>=c._MAX_HISTORY||!!b.id[g.id]){return}e.push({id:g.id,name:g.name,fid:g.fid,foldername:g.foldername});b.num++;b.id[g.id]=true});return e};desknets.doc.chooserDoc._getHistoriesFromMultiJson=function(l,j,m){var g=0,f=[],c=[],h=[];for(g=0;!!l[String(g)];g++){c.push(desknets.ajax.getJsonItems(l[String(g)]));h.push(0)}for(;;){var b="",e=-1;var d,k;a.each(c,function(i,n){var o=n[h[i]];if(!!o&&b<String(o.updtime)){e=i;b=String(o.updtime)}});if(e<0){break}d=c[e][h[e]];k=j[e];f.push({id:d.id,type:"user",name:d.Name,fid:d.fid,foldername:d.foldername});h[e]++}return f};desknets.doc.chooserDoc.folderTabItem=a.extend({},desknets.chooserFolder.treeTabItem,{rootClass:"co-sel-groups",_createItemList:function(){var b=this;var c=a.extend({},b._options,{mode:"add",linkToChild:this._linkToChild,add:function(e,d){b._$choosenList[b._options.choosenListPlugIn]("add",d)},sourceChange:function(e){var d=b.$itemList.dnChooserDocItemList("getTotalPage");b._updatePager(1,d)},open:function(e,d){b._openGroup(d)}});c.leftArea=b.$sideMenu;this.$itemList.dnChooserDocItemList(c)},_createSideMenu:function(){var b=this;var c=b.$sideMenu;if(!c.hasClass("co-listview-left")){c.addClass("co-listview-left");c.append('<div class="co-listview-tree co-listview-left-data"><div class="co-listview-items"></div></div>')}b.created=false;b._createTree();b.$itemList.bind("dnchooserdocitemlistsourcechange",function(d){b._tree.openItemById(b._lastID)})},_getListItemsInGroup:function(d,c){var b={};d=neo.isSet(d)?String(d):"";this._lastID=d;if(d!=="all"&&d!=="0"&&c){b.group={cmd:this._options.cmdgroups,area:"2",pfolder:d}}if(a.inArray("user",this._options.chooseTarget)>=0&&d!==""){b.user={cmd:this._options.cmdusers,folder:d,num:"100"}}if(!a.isEmptyObject(b)){this.$itemList.dnChooserDocItemList("setDataSources",b)}else{this._tree.openItemById(this._lastID)}},_changePage:function(b){if(this.$itemList!=null){var c=this.$itemList.dnChooserDocItemList("getTotalPage");this.$itemList.dnChooserDocItemList("setPage",b);this._updatePager(b,c)}},_createOthers:function(){var b=this;var c;b._$parentButton=b.$itemList.siblings(".co-sel-groups.co-sel-parent-button");b._components.push(b._$parentButton);b._$parentButton.find(".jco-sel-go-parent").click(function(d){d.preventDefault();b._tree.selectParent()});c=b._options.dialogRoot.find("."+b._options.selectClass).find('input[name="'+b._options.keyName+'"]').val();if(!!c){b.$itemList.one("dnchooserdocitemlistsourcechange",function(d){b.$itemList.dnChooserDocItemList("select",c,"group")})}},destroy:function(){if(this.$itemList!=null){this.$itemList.dnChooserDocItemList("destroy")}}});desknets.doc.chooserDoc.searchTabItem=a.extend({},desknets.chooser.searchTabItem,{_createItemList:function(){var b=this;var c=a.extend({},b._options,{mode:"add",linkToChild:this._linkToChild,add:function(e,d){b._$choosenList[b._options.choosenListPlugIn]("add",d)},sourceChange:function(e){desknets.submitform.clearDisabled(b.$sideMenu);var d=b.$itemList.dnChooserDocItemList("getTotalPage");b._updatePager(1,d)},open:function(e,d){b._openGroup(d)}});this.$itemList.dnChooserDocItemList(c)},_changePage:function(b){if(this.$itemList!=null){var c=this.$itemList.dnChooserDocItemList("getTotalPage");this.$itemList.dnChooserDocItemList("setPage",b);this._updatePager(b,c)}},_beginToSearch:function(){var b=this,c={},e="user";var d=this.$sideMenu.find("dl.active");var f=b._getSearchParams();if(!b._checkSearchKey()){return}f.init="1";desknets.submitform.setDisabled(b.$sideMenu);c[e]=f;this.$itemList.dnChooserDocItemList("setDataSources",c);this._$explaination.addClass("searched")},_checkSearchKey:function(){var c=this;var e=c.$sideMenu.find(".co-sel-search-users").find("input").eq(0);var d="";var b=a.trim(e.val());e.val(b);if(b.length<=0){d=desknets.Resource.Message.com_search_nokey}else{if(b.length>desknets.SRCHKEY_MAXLENGTH){d=desknets.Resource.Message.com_search_keyword_toolarge}}if(d.length>0){desknets.dialog.alert(d,{type:"warn"});return false}return true},_getSearchParams:function(){var b=this;var c=b.$sideMenu.find(".co-sel-search-users").find("input").eq(0).val();return{cmd:b._options.cmddocsearch,num:b.perPage,srch_key:c}}});desknets.doc.chooserDoc.historyTabItem=a.extend({},desknets.chooser.historyTabItem,{_createItemList:function(){var b=this;var c=a.extend({},b._options,{mode:"add",linkToChild:this._linkToChild,add:function(e,d){b._$choosenList[b._options.choosenListPlugIn]("add",d)},sourceChange:function(e){var d=b.$itemList.dnChooserDocItemList("getTotalPage");b._updatePager(1,d)},open:function(e,d){b._openGroup(d)}});this.$itemList.dnChooserDocItemList(c)},_beginToGetFromHistory:function(e){var c=this;var d=e.data("area");var b=!!d?[d]:c._options.chooseTarget;desknets.doc.chooserDoc.loadHistory(b,c._options,function(f){c.$itemList.dnChooserDocItemList("setItems",f)});e.siblings().removeClass("on");e.addClass("on")}});a.widget("desknets.dnChooserDocItemList",a.desknets.dnChooserItemList,{_entryId:null,_interval:3000,_searching:false,_srchPrm:{},$dialogexec:null,setItems:function(c){var b=this;if(!b._loaded){b.element.bind("dnchooserdocitemlistload",function(){b.setItems(c)});return}b._totals={};b._sources=null;this._$tbody.empty();a.each(c,function(d,e){b._addItemElement(e)});this._onReplaceList();this._trigger("sourceChange")},_setUpClasses:function(){var b=this.element.find(".co-sel-table-list");a.each(this.options.chooseTarget,function(d,e){b.addClass(e+"-choosable")});var c=desknets.paramanalyzer.getHashParams();if(c&&neo.isSet(c.id,{blank:false})){this._entryId=c.id}},_addItemElement:function(h){var c=a("<tr />"),f=this._itemHtml;var e=h.type+" "+desknets.chooser._getSubType(h);var d=a.inArray("user",this.options.chooseTarget)>=0;if(h.type=="user"){var g=this.options.leftArea;if(!!g){var b=g.find(".co-listview-item-inside.on").closest("li");h.foldername=desknets.folderlist.getItemTitle(b);h.fid=b.data("id")}h.description=desknets.tmpl.escapeWord(h.foldername)}f=desknets.tmpl.replaceWord(f,"id",h.id);f=desknets.tmpl.replaceWord(f,"type","");f=desknets.tmpl.replaceWord(f,"name",h.name);f=desknets.tmpl.replaceWordHtml(f,"description",h.description);f=desknets.tmpl.replaceWordHtml(f,"linkClasses","name-text namelink");if(this.options.linkToChild&&h.type=="group"&&(!!h.hasChildren||d)){e+=" co-sel-has-children"}c.attr("class",e);c.data("item",h).html(f).appendTo(this._$tbody);if((neo.isSet(h.edit)&&h.edit=="1")||(!!this._entryId&&h.id==this._entryId)){c.find(".co-sel-button").addClass("co-sel-readonly");c.find("a.co-sel-icon").remove()}this._updateSpecialGroup(c,h)},_processResponse:function(g,f,j){var c=this;var b=f.list.item;var h={group:"convertGroupItem",role:"convertRoleItem",user:"convertUserItem"};this._totals[g]=f.allcnt;for(var e=0;e<j&&e<b.length;e++){var d=h[g];if(!!d){c._addItemElement(desknets.doc.chooserDoc[d](b[e]))}}return j-e},_getList:function(e,h,d,g){var b=this;var f=(h.length==1)?h[0]:h;var c=desknets.getUrl(this.options.module);b._searching=true;desknets.doc.chooserDoc._ajaxRest(c,f,function(j){if(typeof d=="function"){d()}var i=a.extend({},f);if(!!i.init){delete i.init}b._srchPrm=a.extend({},i);if(!!j.searching&&j.searching=="1"){b._setObserve();b._openSearchMessageDialog()}else{b._searching=false;var l=b.$dialogexec;if(!!l&&l.dialog("isOpen")){l.dialog("close")}var k=!!j["0"]?j:{"0":j};b._$tbody.empty();b._processResponses(e,k);if(typeof g=="function"){g()}}},b.options)},_setObserve:function(){var c=this;var d=c._srchPrm;var b=c._interval;if(!c._searching){return}setTimeout(function(){if(!!c._searching){var e={};e.user=d;c.setDataSources(e)}},b)},_getDialogSelfOptions:function(){var b=this;return{type:"message",extraMessage:desknets.Resource.Message.com_dialog_execaddmsg,extraClass:"co-loading-dialog",btnLabel:desknets.Resource.abortLabel,close:function(){if(!!b._searching){b.onSrchStop()}desknets.submitform.clearDisabled(b.$dialogexec);b.$dialogexec=null}}},_openSearchMessageDialog:function(){var b=this;var c=b._getDialogSelfOptions();if(neo.isSet(b.$dialogexec)){return}b.$dialogexec=desknets.dialog.alert(desknets.PageListBatSearchBase._searchExecMessage(),c);var d={};d[desknets.Resource.abortLabel]=function(){if(!!b._searching){b.onSrchStop()}else{b.$dialogexec.dialog("close")}};b.$dialogexec.dialog("option","buttons",d)},onSrchStop:function(){var b=this;var c={};b._searching=false;desknets.submitform.setDialogDisabled(b.$dialogexec);c.cmd=desknets.doc.CMD_DOCSEARCHSTOP;desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:desknets.getUrl(b.options.module),data:c,success:function(e,d,f){setTimeout(function(){var g={};g.user=b._srchPrm;b.setDataSources(g)},100)}})}});a.widget("desknets.dnChooserChoosenDocList",a.desknets.dnChooserChoosenList,{_updateItemElement:function(b,e){var g=b.find(".co-sel-name");var f=g.children(".name-text");var d=b.find(".co-sel-description");var c=this._convertText(e.name);g.attr("title",c);f.text(c).data("refid",e.type+e.id);d.html(e.description)}});(function(b){desknets.page(desknets.doc,"docdisp",desknets.PagePaneDispBase,{_cabTmplAttach:'<tr><th class="co-eth"><span class="co-colon">{{name}}</span></th><td class="co-etd">{{attach}}</td></tr>',_cabTmplBody:'<div><table class="co-etable"><body>{{top}}{{attach}}{{bottom}}</body></table></div>',_cabTmplTrList:'<tr><th class="co-eth"><span class="co-colon">{{title}}</span></th><td class="co-etd">{{value}}</td></tr>',_docTmplRelList:'<tr class="doc-disp-relname"><td><a target="_blank" href="{{url}}">{{dname}}</a></td><td>{{fname}}</td></tr>',_docTmplAttShare:'<div class="doc-tp-file-share"><a href="#" data-url="{{url}}" class="co-msg-share jco-disp-share">{{share}}</a></div>',initLeftTree:function(){var c=this;desknets.doc.docfolderdisp.init(c.$mjPage,c._getOptionLeftTree(),c._optTreeGetCmd());c._treeClass=desknets.doc.docfolderdisp},_optTreeGetCmd:function(){return desknets.doc.getFolderCmd()},_optTreeSelectFunc:function(e){var c=this;var d=b("#jco-m-list-container").find(".jco-back-page-data");d.find('input[name="fldsort"]').val("");d.find('input[name="order"]').val("");d.find('input[name="srch_key"]').val("");c.callBase("_optTreeSelectFunc",e)},_optTreeSelItemParams:function(){var c=this;if(c.mIdBack=="jco-m-list-container"){return c.callBase("_optTreeSelItemParams")}return{}},treeUpdateListWidth:function(){desknets.doc.docfolderdisp._updateItemsWidth()},getMultiRequest:function(){var d=this;var e={};e=d.callBase("getMultiRequest");var g=desknets.paramanalyzer.getHashParams();var c={};c.cmd=d._getDispRelationCmd();c.id=g.id;e["2"]=c;var f=desknets.attach.ext.getListParam();if(neo.isSet(f)){f.cmd=desknets.doc.CMD_DOCEXTLIST;e["3"]=f}return e},_initHtmlTmplSet:function(d){var c=this;var e={};if(neo.isSet(d[3])&&d[3]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[3]["errorno"],d[3]["errormessage"])}else{c.callBase("_initHtmlTmplSet",d);c._tmplSetRelationList(d[2]);if(neo.isSet(d[3])){e=d[3]}desknets.attachDisp.displistThumb(c.$mjPage.find(".doc-pop-tp-file-drop"),e);c._initHtmlShareLink();c._addAttachShareLink()}},_tmplSetRelationList:function(f){var d=this;var c=desknets.ajax.getJsonItems(f);var e="";if(c.length>0){b.each(c,function(j,k){var g=d._docTmplRelList;var h=desknets.getUrl(desknets.doc.MODULE_DOC_MAIN);h=h+"?cmd="+d._getDispPageCmd()+"&id="+k.id+"&folder="+k.fid;g=desknets.tmpl.replaceWordChkHtml(g,"url",h);g=desknets.tmpl.replaceWordChk(g,"dname",k.Name);g=desknets.tmpl.replaceWordChk(g,"fname",k.foldername);e=e+g})}if(e!=""){d.$mjPage.find("table.doc-selreldoc").find("tbody").html(e);d.$mjPage.find(".doc-disp-reldoc").show()}},_initHtmlShareLink:function(){},_addAttachShareLink:function(){var e=this;var c=e.$mjPage.find("a.jco-disp-share");if(c.length==0){return}var f=e.$mjPage.find(".co-pop-tp-file").find("li");var g=c.text();var d=e._docTmplAttShare;d=desknets.tmpl.replaceWordHtml(d,"share",desknets.Resource.com_share_title);b.each(f,function(k,j){var h=b(this);if(h.hasClass("title")){return true}var l=h.find(".co-pop-tp-file-name").children("a:first").attr("href");var m=desknets.tmpl.replaceWordHtml(d,"url",l);h.find(".co-pop-tp-file-size-in").append(m)})},_initSet:function(e){var c=this;var h="";c.callBase("_initSet",e);var g=function(j,k){return c._makeCabTemplate(j,k)};var f={copymodule:c._getRestModule(),copycmd:desknets.doc.CMD_DOCCOPYATTACH,cabmoduleid:desknets.doc.MODULEID_DOC,cabmaketemplate:g};if(neo.isSet(e[0].Name,{blank:false})){h=e[0].Name}else{var i=desknets.ajax.getItems(e[0].attach.item);if(i.length>0){var d=i[0];h=d.attachdisp}}f.cabtitle=h;desknets.cabinetregist.init(c.$mjPage,f)},_makeCabTemplate:function(g,n){var m=this;var e=m._cabTmplAttach;var h=m._cabTmplBody;var c=m.$mjPage.find(".jdoc-cab-temptop").html();h=desknets.tmpl.replaceWordHtml(h,"top",c);e=desknets.tmpl.replaceWordHtml(e,"name",desknets.Resource.attachTitle);var i="";var f=m.$mjPage.find(".co-pop-tp-file-dtl");b.each(f,function(q,r){var s=b("<div>"+b(r).html()+"</div>");s.find(".doc-tp-file-share").remove();var o=s.find(".co-pop-tp-file-name").text();var p=s.find(".co-pop-tp-file-size-in").text();if(q>0){i=i+", "}i=i+o+"("+p+")"});e=desknets.tmpl.replaceWordHtml(e,"attach",i);h=desknets.tmpl.replaceWordHtml(h,"attach",e);var k="";var j=m.$mjPage.find(".doc-disp-reldoc");if(j.css("display")=="none"){j.remove()}var d=m.$mjPage.find(".jdoc-cab-tempbottom").children("tr");b.each(d,function(q,s){var r=b(this);if(r.hasClass("doc-disp-reldoc")){var t="<table><tbody>{{rels}}</tbody></table>";var p="";var u=r.find(".doc-selreldoc").find("tr");b.each(u,function(w,v){var x=b(this);var y="<tr>";y=y+"<td>"+x.find("td").eq(0).text();y=y+" ("+x.find("td").eq(1).text()+")</td></tr>";p=p+y});t=desknets.tmpl.replaceWordHtml(t,"rels",p);r.find("td.co-etd").html(t)}var o=r.find("span.co-colon");b.each(o,function(w,x){var v=m._cabTmplTrList;v=desknets.tmpl.replaceWordHtml(v,"title",b(this).html());v=desknets.tmpl.replaceWordHtml(v,"value",r.find("td.co-etd").eq(w).html());k=k+v})});h=desknets.tmpl.replaceWordHtml(h,"bottom",k);var l=b(h);l.find(".jdoc-cabtmp-remove").remove();return desknets.tmpl.replaceWordHtml(n,"body",l.html())},_createEventDispPane:function(){var d=this;var e=d.$mjPage.find(".jco-disp-disparea");desknets.attachDisp.initDispList(e);e.delegate("div.co-pop-tp-meta-switch>a","click",function(){d._setListviewHeight(e)});e.delegate(".jdoc-input-undoedit-conf","click",function(f){f.preventDefault();d._inputModUndoEditSubmitBefore(b(this))});e.delegate(".jdoc-disp-editentry","click",function(f){f.preventDefault();d._locateEditDoc()});var c={getMailBodyFunc:function(g,f){return d._getMailBody(g,f)}};desknets.sharelink.init(e,c);e.delegate("div.co-pop-tp-meta-attzip>a","click",function(g){g.preventDefault();var h=desknets.paramanalyzer.getHashParams();var i=h.folder;if(!neo.isSet(i)){i=e.find('input[name="folder"]').val()}var f={url:desknets.getUrl(d._getRestModule()),execParam:{cmd:d._getAttZipCmd(),id:h.id,folder:i},delParam:{cmd:d._getAttZipDelCmd()},downLoadUrl:desknets.getUrl(desknets.doc.MODULE_DOC_MAIN),downParam:{cmd:d._getAttZipDownLoadCmd(),id:h.id},cancelParam:{cmd:d._getAttZipCancelCmd()}};desknets.attachDisp.zipDownLoad(f)})},_getMailBody:function(i,g){var k=this;var l="";var d="";var f=false;if(b.isEmptyObject(i)||b.isEmptyObject(g)){return""}if(g.data("url")!==""){f=true}var c=k.$mjPage.find(".jdoc-items-docname").children("td").text();if(b.trim(c).length==0){c=k.$mjPage.find(".doc-pop-tp-file-drop").find(".co-pop-tp-file-name").eq(0).text()}l=k.$mjPage.find(".jdoc-items-docname").children("th").children(".co-colon").text();d=d+desknets.tmpl.CreateNameDelimValueHtml(l,c);var h=k.$mjPage.find(".jdoc-items-docfolder").children("td").text();l=k.$mjPage.find(".jdoc-items-docfolder").children("th").children(".co-colon").text();d=d+"\n"+desknets.tmpl.CreateNameDelimValueHtml(l,h);if(f){var j=g.closest(".co-pop-tp-file-dtl").children(".co-pop-tp-file-name").text();l=desknets.Resource.attachTitle;d=d+"\n"+desknets.tmpl.CreateNameDelimValueHtml(l,j)}var e=i.find("input.co-share-urltext").val();l=desknets.Resource.com_share_url;d=d+"\n"+desknets.tmpl.CreateNameDelimValueHtml(l,e);return d},_inputModUndoEditSubmitBefore:function(f){var d=this;var e=desknets.Resource.Message.doc_undoedit_conf;var c=desknets.dialog.confirm(e,function(){desknets.submitform.setDialogDisabled(c);var g=desknets.getUrl(desknets.doc.MODULE_DOC_API_MAIN);var h={};h.cmd=d._getDispUndoCmd();h.id=f.data("id");desknets.ajax.rest({url:g,data:h,success:function(j,i,k){d.dispBackListPage()},complete:function(){desknets.submitform.clearDialogDisabled(c);c.dialog("close")}});return false})},_locateEditDoc:function(){var c=this;var d={};d=desknets.paramanalyzer.getHashParams();d.cmd=c._getDispModCmd();d.id=c.$mjPage.find(".jdoc-input-undoedit-conf:first").data("id");c._setLocationHash(d)},dispBackListPage:function(){var c=this;if(neo.isSet(c.mBackCmd)&&c.mBackCmd==c._getSearchCmd()){var d=b("#jco-m-search-container").find(".jco-back-page-data");if(d.find('input[name="sfolder"]').val()==""){d.find('input[name="folder"]').val("")}}c.callBase("dispBackListPage")},editDispFolderList:function(d){var c={};c.srch_key="";c.row="0";return desknets.folderdisp.editDispFolderList(d,null,c)},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN},_getDispExecCmd:function(){return desknets.doc.CMD_DOCREFER},_getDispModCmd:function(){return desknets.doc.PAGE_DOCENTRY},_getDelExecCmd:function(){return desknets.doc.CMD_DOCDEL},_getSearchCmd:function(){return desknets.doc.PAGE_DOCSEARCHINDEX},_getDispUndoCmd:function(){return desknets.doc.CMD_DOCUNDOEDIT},_getDispPageCmd:function(){return desknets.doc.PAGE_DOCREFER},_getDispRelationCmd:function(){return desknets.doc.CMD_DOCRELATIONLIST},_getAttZipCmd:function(){return desknets.doc.CMD_DOCATTZIP},_getAttZipDelCmd:function(){return desknets.doc.CMD_DOCATTZIPDEL},_getAttZipDownLoadCmd:function(){return desknets.doc.CMD_DOCATTZIPDOWN},_getAttZipCancelCmd:function(){return desknets.doc.CMD_DOCATTZIPCANCEL}})})(jQuery);desknets.page(desknets.doc,"docrevindex",desknets.PageListBase,{trCnt:0,initPage:function(d,c){var b=this;b.boGetHtmlSingle=false;b.callBase("initPage",d,c)},_getListAjaxSuccess:function(d){var b=this;b.trCnt=0;var e=desknets.paramanalyzer.getHashParams();var c=b._mcListTemplate;b._mcListTemplate=desknets.tmpl.replaceWordHtml(b._mcListTemplate,"docid",e.id);if(neo.isSet(e.folder,{blank:false})){a("#"+b.mIdBack).find(".jco-back-page-data").find('input[name="folder"]').val(e.folder)}b.callBase("_getListAjaxSuccess",d);b._mcListTemplate=c},getListParamToObj:function(){var b=this;var d=desknets.paramanalyzer.getHashParams();var e={};var c="";c=b._getListExecCmd();e.id=d.id;e.cmd=c;return e},dispBackListPage:function(){var b=this;if(neo.isSet(b.mBackCmd)&&b.mBackCmd==b._getSearchCmd()){var c=a("#jco-m-search-container").find(".jco-back-page-data");if(c.find('input[name="sfolder"]').val()==""){c.find('input[name="folder"]').val("")}}b.callBase("dispBackListPage")},_listLine:function(f,j){var l=this;var c="";if(typeof j=="object"){var i="";var g=[];var e=[];var k=[];var d="";if(l.trCnt==0){i="co-tr-selected";j.id="  ";l.trCnt=1}else{d="&revid="+j.id}f=desknets.tmpl.replaceWordHtml(f,"first",i);f=desknets.tmpl.replaceWordHtml(f,"revid",d);i="";if(j.attach){var b=j.attach.item;var h=[];if(b.length>1){h=b}else{h=[b]}a.each(h,function(m,n){var p=desknets.tmpl.escapeWord(n.Name);var o=n.action;if(o=="1"){g.push(p)}else{if(o=="3"){k.push(p)}else{e.push(p)}}})}i=l._editRevListMemo(g,e,k,j.revtime);f=desknets.tmpl.replaceWordHtml(f,"attachList",i)}f=l.callBase("_listLine",f,j);return f},_editRevListMemo:function(f,c,i,e){var g="";var h='<li title="{{fmemo}}">{{fmemo}}</li>';var j="";var d=function(l,m,k){l=l+desknets.tmpl.replaceWordHtml(h,"fmemo",m);l=l+'<ul class="doc-history-docs">';a.each(k,function(n,o){l=l+'<li title="'+o+'">'+o+"</li>"});l=l+"</ul>";return l};if(f.length>0){j=desknets.Resource.doc.rev_attach_add;g=d(g,j,f)}if(c.length>0){j=desknets.Resource.doc.rev_attach_mod;g=d(g,j,c)}if(i.length>0){j=desknets.Resource.doc.rev_attach_del;g=d(g,j,i)}if(g.length==0){j=desknets.Resource.doc.rev_attach_none;g=desknets.tmpl.replaceWordHtml(h,"fmemo",j)}if(neo.isSet(e,{blank:false})){var b=desknets.Resource.doc.rev_attach_rollback;b=desknets.tmpl.replaceWordHtml(b,"revTime",desknets.dateTime.dispDateTime(e,{type:"list"}));g=g+desknets.tmpl.replaceWordHtml(h,"fmemo",b)}return g},_replaceListLine:function(c,f,d){var b=this;var e;if(f==="attach"){return c}else{if(f==="updtime"){e=desknets.dateTime.dispDateTime(d.updtime,{type:"list"});c=desknets.tmpl.replaceWordHtml(c,"updtime",e)}else{return b.callBase("_replaceListLine",c,f,d)}}return c},_getListAjaxSuccessOtherSet:function(f){var d=this;var e=d.$mjListPage.find(".co-tbody-list");var c=e.find("tr");var b=f.accessmod&&f.accessmod=="1"&&f.list.item.length>1;a.each(c,function(j,l){var k=a(this);if(k.hasClass("co-tr-selected")){var h=d.$mjListPage.find("span.doc-tr-selected").text();k.find("td.doc-rev-num").text(h);k.find("td.doc-rev-num").attr("title",h);return true}else{k.find("td.doc-rev-num").text(c.length-j)}if(!!b){k.find("td:first").append('<input type="radio" name="r_id">')}});if(!!b){d.$mjListPage.find(".doc-rev-rollback").show()}else{d.$mjListPage.find(".doc-rev-rollback").hide()}if(f.folder){var g=d.$mjListPage.find('input[name="folder"]');g.val(f.folder)}},_initListEndButton:function(){var b=this;b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()});b.$mjListPage.find(".doc-rev-rollback").click(function(e){var d=0;var c="";var g="";b.$mjTableList.find("input[type=radio]").each(function(){var h=a(this);if(h.attr("checked")){d++;c=h.closest("tr").find(".jco-id").val();return false}});if(d<1){g=b._delNoChkMessage();desknets.dialog.alert(g,{type:"warn"})}else{var f=desknets.paramanalyzer.getHashParams();desknets.doc.revRollback.setRollBackConf(f.id,c,function(){b._getListAjax("0")})}})},_delNoChkMessage:function(){return desknets.Resource.Message.doc_rev_rollback_nochecked},_getListDispCmd:function(){return desknets.doc.PAGE_DOCREVREFER},inputDispPage:function(e){var b=this;var d="";var c={};var f=desknets.paramanalyzer.getHashParams();d=b._getListDispCmd();c.cmd=d;if(!!e&&desknets.validation.isNumber(e)){c.revid=e}c.id=f.id;b._inputPage(c)},_getIdListPage:function(){return"jco-m-revlist-container"},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN},_getListExecCmd:function(){return desknets.doc.CMD_DOCREVLIST},_getIdListPageForm:function(){return"revlistfrm"},_getListCmd:function(){return desknets.doc.PAGE_DOCREVINDEX},_getSearchCmd:function(){return desknets.doc.PAGE_DOCSEARCHINDEX},_getListDispClass:function(){return desknets.doc.docrevdisp}});desknets.doc.revRollback={cmd:"",setRollBackConf:function(e,d,g){var c=this;var h=desknets.Resource.Message.doc_rev_rollback_conf;var f={};var b=desknets.dialog.confirm(h,function(){desknets.submitform.setDialogDisabled(b);c._execRollback(b,e,d,g);return false},f);b.dialog("option","width",500);b.find("div.co-message").addClass("doc-rev-conf")},_execRollback:function(b,g,e,h){var c=this;var d=desknets.getUrl(desknets.doc.MODULE_DOC_API_MAIN);var f={};f.cmd=c.getRollbackCmd();f.id=g;f.revid=e;f.Url=desknets.getUrl(desknets.doc.MODULE_DOC_MAIN);desknets.ajax.rest({url:d,data:f,success:function(j,i,k){h()},complete:function(){desknets.submitform.clearDialogDisabled(b);b.dialog("close")}})},getRollbackCmd:function(){if(desknets.doc.isDocMSetCmd()){return desknets.docset.CMD_DOCMSETREVROLLBACK}return desknets.doc.CMD_DOCREVROLLBACK}};desknets.page(desknets.doc,"docrevdisp",desknets.PageDispBase,{changPage:function(){var c=this;var d=desknets.paramanalyzer.getHashParams();var b=c.$mjPage.find(".doc-rev-rollback");if(!d.revid){b.hide()}else{b.show()}c.callBase("changPage");desknets.attachDisp.initDispList(c.$mjPage)},getMultiRequest:function(){var b=this;var c={};c=b.callBase("getMultiRequest");var d=desknets.attach.ext.getListParam();if(neo.isSet(d)){d.cmd=desknets.doc.CMD_DOCEXTLIST;c["2"]=d}return c},_initHtmlTmplSet:function(c){var b=this;var d={};if(neo.isSet(c[2])&&c[2]["status"]!=desknets.RES_STATUS_SUCCESS){b.onError(c[2]["errorno"],c[2]["errormessage"])}else{b.callBase("_initHtmlTmplSet",c);if(neo.isSet(c[2])){d=c[2]}desknets.attachDisp.displistThumb(b.$mjPage.find(".doc-pop-tp-file-drop"),d)}},onError:function(c,d){var b=this;b._setRevErrorBack();b.callBase("onError",c,d)},_setRevErrorBack:function(){var b=this;b.mBackCmd=desknets.doc.PAGE_DOCINDEX;b.mIdBack="jco-m-list-container"},_inputButton:function(){var b=this;var c=desknets.paramanalyzer.getHashParams();b.callBase("_inputButton");b.$mjPage.find(".doc-rev-rollback").click(function(e){var d=0;var f="";desknets.doc.revRollback.setRollBackConf(c.id,c.revid,function(){b.dispBackListPage()})});b.$mjPage.find("div.co-pop-tp-meta-attzip>a").click(function(e){e.preventDefault();var f=b.$mjPage.find('input[name="folder"]').val();var d={url:desknets.getUrl(b._getRestModule()),execParam:{cmd:b._getAttZipCmd(),id:c.id,revid:c.revid,folder:f},delParam:{cmd:b._getAttZipDelCmd()},downLoadUrl:desknets.getUrl(desknets.doc.MODULE_DOC_MAIN),downParam:{cmd:b._getAttZipDownLoadCmd(),id:c.id,revid:c.revid},cancelParam:{cmd:b._getAttZipCancelCmd()}};desknets.attachDisp.zipDownLoad(d)})},_getDispExecCmd:function(){var b;b=desknets.paramanalyzer.getHashParams();if(b.revid){return desknets.doc.CMD_DOCREVREFER}else{return desknets.doc.CMD_DOCREFER}},getLocationFormParam:function(){var b=this;var c={};c=desknets.paramanalyzer.getHashParams();c.cmd=b.mBackCmd;return c},_getIdPage:function(){return"jco-m-revdisp-page"},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN},_getAttZipCmd:function(){return desknets.doc.CMD_DOCATTZIP},_getAttZipDelCmd:function(){return desknets.doc.CMD_DOCATTZIPDEL},_getAttZipDownLoadCmd:function(){return desknets.doc.CMD_DOCATTZIPDOWN},_getAttZipCancelCmd:function(){return desknets.doc.CMD_DOCATTZIPCANCEL}});desknets.page(desknets.doc,"docsearchindex",desknets.PageListBatSearchBase,{_dofSortPrm:{},_selFolder:"",_mboSearchInit:true,_initListStart:function(){var b=this;b.callBase("_initListStart");desknets.pageframe.closeTopMsg()},_getSearchConditionParams:function(){return["srch_key","sdate","edate","sfolder","folder","srch_filecontents"]},_listLine:function(b,c){return desknets.doc.docindex._listLine(b,c)},_replaceListLine:function(b,d,c){return desknets.doc.docindex._replaceListLine(b,d,c)},_getAddPageParam:function(){return{folder:this._selFolder}},_getModPageParam:function(){return this._getAddPageParam()},_getDispPageParam:function(){return this._getAddPageParam()},_getListAjaxSuccess:function(c){var b=this;if(c.fldsort){b._dofSortPrm.fldsort=c.fldsort}if(c.order){b._dofSortPrm.order=c.order}b.callBase("_getListAjaxSuccess",c)},_openSearchMessageDialog:function(){if(!neo.isSet(this.$dialogexec)){this._mboSearchInit=true}this.callBase("_openSearchMessageDialog")},_getListAjaxSuccessOtherSet:function(c){var b=this;b.callBase("_getListAjaxSuccessOtherSet",c);if(this._mboSearchInit&&neo.isSet(c[desknets.RES_TAG_MSGGETLIMIT])){this._mboSearchInit=false;desknets.pageframe.viewTopMsg(c[desknets.RES_TAG_MSGGETLIMIT],"info")}},_listSortLink:function(){var b=this;var c=a.extend({},b._dofSortPrm);var d=function(g){var f=null;g.removeClass("asc");g.removeClass("desc");g.each(function(){f=a(this);if(f.data("sort")==c.fldsort){if(c.order=="1"){f.addClass("asc")}else{f.addClass("desc")}return false}})};var e=b.$mjListPage.find(".co-list-sort-item").find(".co-list-sort-data");d(e);e=b.$mjListPage.find(".co-table-list").find(".co-list-sort-data");d(e)},_getRestModule:function(){return desknets.doc.MODULE_DOC_API_MAIN},_getListCmd:function(){return desknets.doc.PAGE_DOCSEARCHINDEX},_getListExecCmd:function(){return desknets.doc.CMD_DOCSEARCHLIST},_getStopBatSearchCmd:function(){return desknets.doc.CMD_DOCSEARCHSTOP},_getListDispCmd:function(){return desknets.doc.PAGE_DOCREFER},_getListAddCmd:function(){return desknets.doc.PAGE_DOCENTRY},_getListModCmd:function(){return this._getListAddCmd()},_getDelCmd:function(){return desknets.doc.CMD_DOCSEARCHLISTCONFDEL},_getDelExecCmd:function(){return desknets.doc.CMD_DOCSEARCHLISTDEL},_getRevCmd:function(){return desknets.doc.PAGE_DOCREVINDEX},_getListModClass:function(){return desknets.doc.docentry},_getListDispClass:function(){return desknets.doc.docdisp}});app.addInitialAction(function(){desknets.doc.init()})})(jQuery);