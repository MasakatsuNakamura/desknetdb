/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.prj={MODULE_PRJ:"zproject",MODULE_API_PRJ:"zrproject",MODULE_OFFICE:desknets.MODULE_MAIN,PAGE_PRJINDEX:"prjindex",PAGE_PRJSEARCH:"prjsearch",PAGE_PRJGANTTLIST:"prjganttlist",PAGE_PRJREPORTLIST:"prjreportindex",CMD_PRJLIST:"prjcmdlist",CMD_PRJTASKINFO:"prjcmdtaskinfo",CMD_PRJTASKLIST:"prjcmdtasklist",CMD_PRJTASKLISTGT:"prjcmdtasklistgt",CMD_PRJREPORTLIST:"prjcmdreportlist",CMD_PRJREPORTENTRY:"prjcmdreportentry",CMD_PRJREPORTDELCONF:"prjcmdreportdelconf",CMD_PRJREPORTDEL:"prjcmdreportdel",CMD_PRJCOMMENTLIST:"prjcmdcommentlist",CMD_PRJCOMMENTENTRY:"prjcmdcommententry",CMD_PRJCOMMENTDELCONF:"prjcmdcommentdelconf",CMD_PRJCOMMENTDEL:"prjcmdcommentdel",CMD_PRJPROJECTUSERS:"prjcmdprojectusers",CMD_PRJTASKUSERS:"prjcmdtaskusers",CMD_PRJHOLIDAYLIST:"prjcmdholidaylist",CMD_PRJTASKSEARCHINDEX:"prjcmdsrchindex",CMD_PRJTASKSEARCHSTOP:"prjcmdsrchstop",CMD_PRJTASKBATSEARCH:"prjtaskbatsrch",CMD_PRJSETTAG:"prjcmdsettag",CMD_PRJREFATTACH:"prjdispattach",CMD_PRJREFTASKATTACH:"prjdisptaskattach",CMD_PRJREFREPORTATTACH:"prjdispreportattach",CMD_PRJADDATTACH:"prjcmdaddattach",CMD_PRJADDTASKATTACH:"prjcmdaddtaskattach",CMD_PRJADDREPORTATTACH:"prjcmdaddreportattach",CMD_PRJDELATTACH:"prjcmddelattach",CMD_PRJDELTASKATTACH:"prjcmddeltaskattach",CMD_PRJDELREPORTATTACH:"prjcmddelreportattach",CMD_PRJATTACHDELTEMP:"prjcmdattachdeltemp",CMD_PRJVIEWATTACH:"prjviewattach",CMD_PRJVIEWTASKATTACH:"prjviewtaskattach",CMD_PRJVIEWREPORTATTACH:"prjviewreportattach",PRJ_MSETINDEXID:"prjmsetlist",DEF_INIT_NONE:"0",DEF_INIT_NOW:"1",DEF_INIT_GANT:"3",DEF_STSCLASS_BEFORE:"prj-status-before",DEF_STSCLASS_AHEAD:"prj-status-ahead",DEF_STSCLASS_BEHIND:"prj-status-behind",DEF_STSCLASS_FINISHED:"prj-status-finished",DEF_STSCLASS_STOP:"prj-status-stop",DEF_REPORTSTS_DOING:"1",DEF_REPORTSTS_LATE:"2",DEF_REPORTSTS_COMPLETE:"3",DEF_REPORTSTS_STOP:"4",init:function(){var c=this;var b=a("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(b);if(b==desknets.prj.PAGE_PRJINDEX){desknets.hashobserver.init(desknets.prj);desknets.prj.prjindex.init();desknets.prj.subwin.init();desknets.prj.TaskUser.init();desknets.tags.item.setUpFuncAfterAjax(c.changeMainContent)}else{if(b==desknets.prj.PAGE_PRJSEARCH){desknets.hashobserver.init(desknets.prj);desknets.prj.xxxxxxxxxxxxxxx.init();desknets.prj.subwin.init()}}},createTaskListLine:function(d,c,e){var b="";if(typeof e=="object"){for(b in e){if(b=="assign"){continue}c=d._replaceListLine(c,b,e)}}return c},getReportStatusName:function(c){var b="";if(c==desknets.prj.DEF_REPORTSTS_DOING){b=desknets.Resource.prj.ahead}else{if(c==desknets.prj.DEF_REPORTSTS_LATE){b=desknets.Resource.prj.behind}else{if(c==desknets.prj.DEF_REPORTSTS_COMPLETE){b=desknets.Resource.prj.finished}else{if(c==desknets.prj.DEF_REPORTSTS_STOP){b=desknets.Resource.prj.stop}else{b=desknets.Resource.prj.before}}}}return b},getReportStatusClass:function(c){var b="";if(c==desknets.prj.DEF_REPORTSTS_DOING){b=this.DEF_STSCLASS_AHEAD}else{if(c==desknets.prj.DEF_REPORTSTS_LATE){b=this.DEF_STSCLASS_BEHIND}else{if(c==desknets.prj.DEF_REPORTSTS_COMPLETE){b=this.DEF_STSCLASS_FINISHED}else{if(c==desknets.prj.DEF_REPORTSTS_STOP){b=this.DEF_STSCLASS_STOP}else{b=this.DEF_STSCLASS_BEFORE}}}}return b},changeLocationToInitTop:function(b,e,d,g){var f=[];var h=desknets.getUrl(desknets.prj.MODULE_PRJ);f.cmd=desknets.prj.PAGE_PRJINDEX;var c=desknets.getNeoParam(f);h=h+"?"+c;desknets.execLocation(h)},setListAttach:function(f,d){var c=this;if(!neo.isSet(f.attach)){return}var i=desknets.ajax.getItems(f.attach.item);var e=[];var b=[];var g=0;for(g=0;g<i.length;g++){e=i[g];var h='<input type="hidden" class="jco-attach-file" value='+e.id+" data-name="+e.attachdisp+" data-size="+e.size+">";b[b.length]=h}d.find(".jco-setup-attach-list").html(b.join(""))},changeMainContent:function(c,d){if(c.data("module")!="prj"){return true}var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(b.cmd)){b.cmd=""}if(b.cmd==""||b.cmd==desknets.prj.PAGE_PRJINDEX){a("#jco-m-list-container").find(".co-btn-update").click();return false}return true}};desknets.page(desknets.prj,"subwin",desknets.PageSubwinSearch,{init:function(){var c=a(".jco-subwindow-search");var g="";var f="";var d="1";var e=desknets.paramanalyzer.getHashParams();c.find('input[name="srch_key"]').val(e.srch_key);c.find('input[name="sdate"]').val(e.sdate);d=e.srch_sdaterange?e.srch_sdaterange:"2";c.find('select[name="srch_sdaterange"]').val(d);d=e.srch_edaterange?e.srch_edaterange:"1";c.find('input[name="edate"]').val(e.edate);c.find('select[name="srch_edaterange"]').val(d);if(e.srch_reportrange=="1"){c.find('input[name="srch_reportrange"]').attr("checked","checked")}g=e.complete;f=e.status;if(neo.isSet(g)&&g=="1"){if(f=="2"){c.find('select[name="complete"]').val("3")}else{if(f=="1"){c.find('select[name="complete"]').val("4")}else{c.find('select[name="complete"]').val("5")}}}else{if(neo.isSet(g)&&g=="2"){c.find('select[name="complete"]').val(g)}else{c.find('select[name="complete"]').val("0")}}var b=this;b.callBase("init");desknets.htmlparts.setUpForm(b.$_inputArea)},_getSearchPrm:function(d){var b=this;var c=b.$_inputArea;var f=c.find('select[name="complete"]').val();var e="";d.fldsort="startdate";d.order="1";d.row="0";d.srch_key=c.find('input[name="srch_key"]').val();d.sdate=c.find('input[name="sdate"]').val();d.srch_sdaterange=c.find('select[name="srch_sdaterange"]').val();d.edate=c.find('input[name="edate"]').val();d.srch_edaterange=c.find('select[name="srch_edaterange"]').val();if(c.find('input[name="srch_reportrange"]').attr("checked")=="checked"){d.srch_reportrange=c.find('input[name="srch_reportrange"]').val()}else{d.srch_reportrange="0"}if(f!="0"){if(f!="1"&&f!="2"){d.complete="1";if(f=="3"){e="2"}else{if(f=="4"){e="1"}else{e="0"}}d.status=e}else{d.complete=c.find('select[name="complete"]').val();d.status=e}}else{d.complete="";d.status=""}return d},_execClear:function(){var b=this;b.callBase("_execClear");var c=a(".jco-subwindow-search");c.find('input[name="srch_reportrange"]').val("1");c.find('input[name="srch_reportrange"]').attr("checked",false);c.find('select[name="srch_sdaterange"]').val("2");c.find('select[name="srch_edaterange"]').val("1");c.find('select[name="complete"]').val("0")},_chkInputSearchRequired:function(){var d=this;var e=d.$_inputArea;var f="";var c=true;if(e.find('input[name="srch_key"]').val()==""&&e.find('select[name="complete"]').val()=="0"&&e.find('input[name="sdate"]').val()==""&&e.find('input[name="edate"]').val()==""){c=false}if(!c){var b=desknets.Resource.searchcond;f=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",b);desknets.dialog.alert(f,{type:"warn"});return false}return d.callBase("_chkInputSearchRequired")},_getMainCmd:function(){return desknets.prj.PAGE_PRJINDEX},_getSearchCmd:function(){return desknets.prj.PAGE_PRJSEARCH}});desknets.page(desknets.prj,"TaskUser",null,{$mDialog:null,_TMPLDIALOG:"prj/taskuserdialog.html",mfunctUserSel:null,init:function(){var b=this;b._createDialogHtml()},openDialogTask:function(d,c){var b=this;b._getTaskUser(d,c)},openDialogPrj:function(d,b){var c=this;c.mfunctUserSel=b;c._getPrjUser(d)},_createDialogHtml:function(){var b=this;var c=function(){b._createDialog()};desknets.tmpl.load(a("#jprj-dialog-task-user"),b._TMPLDIALOG,c)},_createDialog:function(){var b=this;var c=desknets.dialog.getDialogOption();c.width=580;c.autoOpen=false;c.buttons={};c.buttons[desknets.Resource.CloseButtonLabel]=function(){a(this).dialog("close")};b.$mDialog=a("#jprj-dialog-task-user");b.$mDialog=desknets.dialog.setUp(b.$mDialog,c);b._initListDisp();b._initSetSelUser()},_initListDisp:function(){var d=this;var e=d.$mDialog.find("thead").find("tr");var b=e.length;for(var c=0;c<b;c++){desknets.htmlparts.addLastClass(a(e[c]),"last-child")}},_initSetSelUser:function(){var b=this;b.$mDialog.find(".co-tbody-list").delegate(".jprj-dialog-user-sel","click",function(c){c.preventDefault();if(a.isFunction(b.mfunctUserSel)){var f=a(this);var e=f.data("id");var d=f.html();b.mfunctUserSel(e,d)}b.$mDialog.dialog("close")})},_getTaskUser:function(f,e){var b=this;var d={};b.$mDialog.find(".jprj-dialog-task-selmsg").hide();d.title=desknets.Resource.prj.charge;b.$mDialog.dialog(d);var c={};c.cmd=b._getTaskCmd();c.pid=f;c.tid=e;desknets.ajax.rest({url:desknets.getUrl(desknets.prj.MODULE_API_PRJ),data:c,success:function(h,g,i){b._onTaskItems(h);b.$mDialog.dialog("open")},error:function(i,g,h){desknets.ajax.onError(i.status,h)}})},_onTaskItems:function(g){var b=this;var i=desknets.ajax.getJsonItems(g);var d;var e=[];var c=i.length;for(d=0;d<c;d++){var f=desknets.tmpl.escapeWord(i[d].Name);var h={};h.assigntitle="";h.assign="";if(neo.isSet(i[d].assigngrp)&&neo.isSet(i[d].assigngrp.Name)){h=desknets.user.getListAssignGroups(i[d].assigngrp.Name)}e[e.length]="<tr>";e[e.length]='<td class="co-td-dialog-user"><span title="'+f+'">'+f+"</span></td>";e[e.length]='<td class="co-busyo"><span title="'+h.assigntitle+'">'+h.assign+"</span></td>";e[e.length]="</tr>"}b.$mDialog.find(".co-tbody-list").html(e.join(""));b._listSet()},_getPrjUser:function(e){var b=this;var d={};b.$mDialog.find(".jprj-dialog-task-selmsg").show();d.title=desknets.Resource.prj.allmember;b.$mDialog.dialog(d);var c={};c.cmd=b._getPrjCmd();c.pid=e;desknets.ajax.rest({url:desknets.getUrl(desknets.prj.MODULE_API_PRJ),data:c,success:function(g,f,h){b._onPrjItems(g);b.$mDialog.dialog("open")},error:function(h,f,g){desknets.ajax.onError(h.status,g)}})},_onPrjItems:function(g){var b=this;var i=desknets.ajax.getJsonItems(g);var d;var e=[];var c=i.length;var f="";var h={};f=desknets.Resource.prj.all;e[e.length]="<tr>";e[e.length]='<td class="co-td-dialog-user"><a href="#" class="jprj-dialog-user-sel" title="'+f+'" data-id="">'+f+"</a></td>";e[e.length]='<td class="co-busyo">&nbsp;</td>';e[e.length]="</tr>";for(d=0;d<c;d++){f=desknets.tmpl.escapeWord(i[d].Name);h={};h.assigntitle="";h.assign="";if(neo.isSet(i[d].assigngrp)&&neo.isSet(i[d].assigngrp.Name)){h=desknets.user.getListAssignGroups(i[d].assigngrp.Name)}e[e.length]="<tr>";e[e.length]='<td class="co-td-dialog-user"><a href="#" class="jprj-dialog-user-sel" title="'+f+'" data-id="'+i[d].id+'">'+f+"</a></td>";e[e.length]='<td class="co-busyo"><span title="'+h.assigntitle+'">'+h.assign+"</span></td>";e[e.length]="</tr>"}b.$mDialog.find(".co-tbody-list").html(e.join(""));b._listSet()},_listSet:function(){var c=this;var b=c.$mDialog.find(".co-tbody-list");if(b.find("tr").length==0){c._listNodata()}else{c._listView()}},_listNodata:function(){var b=this;b.$mDialog.find(".jprj-dialog-task-user").hide();b.$mDialog.find(".co-nodata").show()},_listView:function(){var c=this;var b=c.$mDialog.find(".co-tbody-list");c.$mDialog.find(".jprj-dialog-task-user").show();c.$mDialog.find(".co-nodata").hide();desknets.htmlparts.addStripeClass(b,"co-tr-even")},_getTaskCmd:function(){return desknets.prj.CMD_PRJTASKUSERS},_getPrjCmd:function(){return desknets.prj.CMD_PRJPROJECTUSERS},});desknets.prj.tasklistUtil={createTaskListLine:function(d,c,e){var b="";if(typeof e=="object"){for(b in e){if(b=="reportstatus"){c=this._replaceStatus(d,c,e[b])}else{if(b=="reportrate"){c=this._replaceRate(d,c,e[b])}else{if(b=="assign"){c=this._replaceAssign(d,c,e.assignallcnt,e[b])}else{if(b=="startdate"){c=this._replaceDate(d,c,b,e[b])}else{if(b=="enddate"){c=this._replaceDate(d,c,b,e[b])}else{c=d._replaceListLine(c,b,e)}}}}}}}return c},_replaceStatus:function(c,b,g){var e=[];var d="namestatus";var f="classstatus";e[d]=desknets.prj.getReportStatusName(g);e[f]=desknets.prj.getReportStatusClass(g);b=c._replaceListLine(b,d,e);b=c._replaceListLine(b,f,e);return b},_replaceRate:function(c,b,f){var e=[];var d="reportrate";if(f==""){e[d]="0"}else{e[d]=f}b=c._replaceListLine(b,d,e);return b},_replaceAssign:function(d,c,e,g){var b=[];var f="assign";if(!g){b[f]=""}else{if(!a.isArray(g.Name)){b[f]=g.Name}else{b[f]=g.Name.join(",\n")}}c=d._replaceListLine(c,f,b);return c},_replaceDate:function(c,b,f,d){var e=[];if(d.length<=0){e[f]=""}else{e[f]=desknets.dateTime.dispDateTime(d.substring(0,8),{type:"list"})}b=c._replaceListLine(b,f,e);return b},};desknets.page(desknets.prj,"ReportDialog",null,{$mDialog:null,_TMPLDIALOG:"prj/reportdialog.html",mfuncAfterSave:null,_mcTemplateInputAttach:null,init:function(){var b=this;b._createDialogHtml()},openDialog:function(e,d,f,b){var c=this;c.mfuncAfterSave=b;c._getReport(e,d,f)},_createDialogHtml:function(){var b=this;var c=function(){b._createDialog()};desknets.tmpl.load(a("#jprj-dialog-report"),b._TMPLDIALOG,c)},_createDialog:function(){var b=this;var d=desknets.dialog.getDialogOption();d.width=785;d.autoOpen=false;d.title=desknets.Resource.prj.reportupdate;d.buttons={};d.buttons[desknets.Resource.OKButtonLabel]=function(){b._saveReport()};d.buttons[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};b.$mDialog=a("#jprj-dialog-report");b._mcTemplateInputAttach=b.$mDialog.find(".jprj-attach-list").html();var c=a('input[name="attach-totalSizeLimit"]').val();c=Number(c);if(!!c){b._mcTemplateInputAttach=desknets.tmpl.replaceWordHtml(b._mcTemplateInputAttach,"item_max_size",c)}b.$mDialog=desknets.dialog.setUp(b.$mDialog,d)},_getReport:function(e,d,f){var b=this;var c={};c.cmd=b._getGetReportCmd();c.pid=e;c.tid=d;c.rid=f;desknets.ajax.rest({url:desknets.getUrl(desknets.prj.MODULE_API_PRJ),data:c,success:function(h,g,i){if(b._onReportItems(h)){b.$mDialog.dialog("open")}else{desknets.dialog.alert(desknets.Resource.prj.ItemNothingReport,{type:"warn"})}},error:function(i,g,h){desknets.ajax.onError(i.status,h)}})},_onReportItems:function(d){var c=this;var e=desknets.ajax.getJsonItems(d);c.$mDialog.find(".jprj-dialog-prj-id").val("");c.$mDialog.find(".jprj-dialog-task-id").val("");c.$mDialog.find(".jprj-dialog-report-id").val("");c.$mDialog.find(".forum-article-post-text-dialog").val("");c.$mDialog.find(".jprj-post-rate").val("");c.$mDialog.find(".jprj-post-stop").attr("checked",false);c.$mDialog.find(".jprj-attach-list").empty();c.$mDialog.find(".jprj-attach-list").html(c._mcTemplateInputAttach);if(e.length!=1){return false}c.$mDialog.find(".jprj-dialog-prj-id").val(d.SID_PROJECT);c.$mDialog.find(".jprj-dialog-task-id").val(d.SID_TASK);c.$mDialog.find(".jprj-dialog-report-id").val(e[0].id);c.$mDialog.find(".forum-article-post-text-dialog").val(e[0].memo);c.$mDialog.find(".jprj-post-rate").val(e[0].rate);if(e[0].status==desknets.prj.DEF_REPORTSTS_STOP){c.$mDialog.find(".jprj-post-stop").attr("checked",true)}if(neo.isSet(e[0].attach)){desknets.prj.setListAttach(e[0],c.$mDialog.find(".jprj-attach-list"))}var b=c._getReportattach();b.init(c.$mDialog,true,c.$mDialog.find(".jprj-dialog-prj-id").val(),c.$mDialog.find(".jprj-dialog-task-id").val(),c.$mDialog.find(".jprj-dialog-report-id").val());return true},_saveReport:function(){var d=this;var f=d.$mDialog.find(".forum-article-post-text-dialog");var c=d.$mDialog.find(".jprj-post-rate");var b=d.$mDialog.find(".jprj-post-stop");var e={};e.cmd=d._getSaveReportCmd();e.pid=d.$mDialog.find(".jprj-dialog-prj-id").val();e.tid=d.$mDialog.find(".jprj-dialog-task-id").val();e.id=d.$mDialog.find(".jprj-dialog-report-id").val();e.memo=f.val();e.rate=c.val();if(b.attr("checked")){e.stop=desknets.prj.DEF_REPORTSTS_STOP}desknets.ajax.rest({url:desknets.getUrl(desknets.prj.MODULE_API_PRJ),data:e,success:function(h,g,i){d.$mDialog.dialog("close");if(a.isFunction(d.mfuncAfterSave)){d.mfuncAfterSave()}},error:function(i,g,h){desknets.ajax.onError(i.status,h)}})},_getGetReportCmd:function(){return desknets.prj.CMD_PRJREPORTLIST},_getSaveReportCmd:function(){return desknets.prj.CMD_PRJREPORTENTRY},_getReportattach:function(){return desknets.prj.reportattach},});desknets.page(desknets.prj,"TaskInfoDialog",null,{$mDialog:null,_TMPLDIALOG:"prj/taskinfodialog.html",init:function(){var b=this;b._createDialogHtml()},openDialog:function(d,c){var b=this;b._getTaskInfo(d,c)},_createDialogHtml:function(){var b=this;var c=function(){b._createDialog()};desknets.tmpl.load(a("#jprj-dialog-taskinfo"),b._TMPLDIALOG,c)},_createDialog:function(){var b=this;var c=desknets.dialog.getDialogOption();c.width=600;c.autoOpen=false;c.title=desknets.Resource.prj.taskinfo;c.buttons={};c.buttons[desknets.Resource.CloseButtonLabel]=function(){a(this).dialog("close")};b.$mDialog=a("#jprj-dialog-taskinfo");b.$mDialog=desknets.dialog.setUp(b.$mDialog,c)},_getTaskInfo:function(e,d){var b=this;var c={};c.cmd=b._getGetTaskInfoCmd();c.pid=e;c.tid=d;desknets.ajax.rest({url:desknets.getUrl(desknets.prj.MODULE_API_PRJ),data:c,success:function(g,f,h){if(b._onReportItems(g,e,d)){b.$mDialog.dialog("open")}else{desknets.dialog.alert(desknets.Resource.prj.ItemNothingTask,{type:"warn"})}},error:function(h,f,g){desknets.ajax.onError(h.status,g)}})},_onReportItems:function(e,i,c){var l=this;var f=desknets.ajax.getJsonItems(e);l.$mDialog.find(".jprj-task-memo").html("");l.$mDialog.find(".jprj-task-attach-list").empty();var k=desknets.tmpl.dispStr(e.memo);l.$mDialog.find(".jprj-task-memo").html(k);if(neo.isSet(e.attach)){var g=desknets.ajax.getItems(e.attach.item);var j=[];var b=[];var h=0;for(h=0;h<g.length;h++){j=g[h];var d='<tr><td><a href="{{downloadurl}}" target="attach">{{filename}}</a></td><td class="co-td-num">{{filesize}}</td></tr>';d=desknets.tmpl.replaceWord(d,"filename",j.attachdisp);var m=desknets.attachDisp.getSize(j.size);d=desknets.tmpl.replaceWord(d,"filesize",m);surl=desknets.getUrl(desknets.prj.MODULE_PRJ)+"?cmd="+l._getDownLoadCmd()+"&id="+i+"&tid="+c+"&fno="+j.id+"&filename="+desknets.tmpl.escapeWord(encodeURIComponent(j.attachdisp.replace(/'/g,"%27")));d=desknets.tmpl.replaceWord(d,"downloadurl",surl);b[b.length]=d}l.$mDialog.find(".jprj-task-attach-list").html(b.join(""))}return true},_getGetTaskInfoCmd:function(){return desknets.prj.CMD_PRJTASKINFO},_getDownLoadCmd:function(){return desknets.prj.CMD_PRJVIEWTASKATTACH},});desknets.page(desknets.prj,"attach",desknets.attachSetUp,{_getUploadURL:function(){return desknets.prj.MODULE_API_PRJ},_getUploadCmd:function(){return desknets.prj.CMD_PRJADDATTACH},_getDelCmd:function(){return desknets.prj.CMD_PRJDELATTACH},_getDownLoadURL:function(){return desknets.prj.MODULE_PRJ},_getDownLoadCmd:function(){return desknets.prj.CMD_PRJREFATTACH},_getHideArea:function(){return".jco-remove-all-button"},});desknets.page(desknets.prj,"taskattach",desknets.prj.attach,{_PrjId:null,_TaskId:null,init:function(d,e,c,f){var b=this;b._PrjId=null;b._TaskId=null;if(neo.isSet(c)){b._PrjId=c}if(neo.isSet(f)){b._TaskId=f}b.callBase("init",d,e)},_initSetDefPrm:function(){var b=this;b.callBase("_initSetDefPrm");if(neo.isSet(b._PrjId)){this._objDefPrm.id=b._PrjId}if(neo.isSet(b._TaskId)){this._objDefPrm.tid=b._TaskId}},_getUploadCmd:function(){return desknets.prj.CMD_PRJADDTASKATTACH},_getDelCmd:function(){return desknets.prj.CMD_PRJDELTASKATTACH},_getDownLoadCmd:function(){return desknets.prj.CMD_PRJREFTASKATTACH},});desknets.page(desknets.prj,"reportattach",desknets.prj.attach,{_PrjId:null,_TaskId:null,_ReportId:null,init:function(d,e,c,g,f){var b=this;b._PrjId=null;b._TaskId=null;b._ReportId=null;if(neo.isSet(c)){b._PrjId=c}if(neo.isSet(g)){b._TaskId=g}if(neo.isSet(f)){b._ReportId=f}b.callBase("init",d,e)},_initSetDefPrm:function(){var b=this;b.callBase("_initSetDefPrm");if(neo.isSet(b._PrjId)){this._objDefPrm.id=b._PrjId}if(neo.isSet(b._TaskId)){this._objDefPrm.tid=b._TaskId}if(neo.isSet(b._ReportId)){this._objDefPrm.rid=b._ReportId}},_getUploadCmd:function(){return desknets.prj.CMD_PRJADDREPORTATTACH},_getDelCmd:function(){return desknets.prj.CMD_PRJDELREPORTATTACH},_getDownLoadCmd:function(){return desknets.prj.CMD_PRJREFREPORTATTACH},});desknets.page(desknets.prj,"tagDispPrj",desknets.tagDisp,{$mjListPage:null,initTagEvent:function(e,f){var b=this;var d={};b.$mjListPage=f;if(e){var c=desknets.getUrl(e);a(".jco-tag-select-item").click(function(h){d.cmd=desknets.prj.CMD_PRJSETTAG;var g=b.$mjListPage.find(".jco-back-page-data");d.pid=g.find('input[name="pid"]').val();var i="";if(a(this).parent().data("mode")=="1"){i=g.find('input[name="tid"]').val()}d.tid=i;d.tagcolor=a(this).parent().data("value");desknets.ajax.rest({url:c,data:d})})}},initEntryPageTag:function(e,f){var g=e.prev();var c=g.find("input[name="+f+"]").val();var b=g.find(".co-tag-select-item");b.removeClass("none");b.removeClass(desknets.tagDisp.getTagColorClass("1"));b.removeClass(desknets.tagDisp.getTagColorClass("2"));b.removeClass(desknets.tagDisp.getTagColorClass("3"));b.removeClass(desknets.tagDisp.getTagColorClass("4"));b.removeClass(desknets.tagDisp.getTagColorClass("5"));b.removeClass(desknets.tagDisp.getTagColorClass("6"));b.addClass(desknets.tagDisp.getTagColorClass(c));var d=desknets.tagDisp.getTagColorTitle(c);b.attr("title",d);b.text(d)},});desknets.page(desknets.prj,"PagePrjListBase",desknets.PageMultiList,{_mcFolderListTemplate:null,msTmplSetLink:"",$mjListPageLeft:null,$mjListPageRight:null,_selName:"",_tmplLabelTitle:'<span class="overflow">{{labelname}}</span>',_getFieldsCheckScroll:function(){return["pid"]},_listMoveScroll:function(){var c=this._getListCmd();var b=this.$mjListPage.find("#prj-reports-pane-list");desknets.scrollManager.setScrollPosition(c,b,{y:0,delay:10});this._setClearScrollPosition();if(desknets.scrollManager._targets[this._getListCmd()]==null){this.$mjListPage.find("#prj-list-tasks").scrollTop(0)}},_initListEnd:function(){var b=this;b.callBase("_initListEnd");a(window).resize(function(){if(desknets.browser.tablet&&a(".co-pop-up-box.show").length>0){return}b.updateListHeight()})},changPage:function(){var b=this;b.boChangePageNoHide=true;b.callBase("changPage");b.updateListHeight();b.$mjListPage.find(".co-listview-scroll").scrollTop(0)},_listPageLinkFolder:function(){var c=this;var b=c._listPageLinkOptionFolder();desknets.Pager.output(c._mIdPageForm,".jprj-pager",b)},_listPageLinkOptionFolder:function(){var c=this;var d=c.$mjListPageLeft.find(".co-listview-folders");var f=c.$mjListPage.find(".jco-back-page-data");var e=d.attr("data-cnt");var g=d.attr("data-allcnt");var i=f.find('input[name="num"]').val();var h=f.find('input[name="prjrow"]').val();var b={};b={getCount:e,allCount:g,pageMaxView:i,startRow:h,clickFunc:function(j){c._listPageLinkAjaxFolder(j)}};return b},_listPageLinkAjaxFolder:function(c){var b=this;b.$mjListPage.find(".jco-back-page-data").find('input[name="prjrow"]').val(c);var d=desknets.getInputDataToUrl(b.$mjListPage.find(".jco-back-page-data"));d=d+"&cmd="+b._getListCmd();b._setLocationHash(d)},updateListHeight:function(){var b=this;desknets.listviewframe.updateListHeight(b.$mjListPage.find(".co-listview"),true,true,true)},_initListStart:function(){var b=this;b.$mjListPageLeft=b.$mjListPage.find(".co-listview-left");b.$mjListPageRight=b.$mjListPage.find(".co-listview-list");b.callBase("_initListStart")},_initListStartTemplate:function(){var b=this;var c=b.$mjListPageLeft.find(".co-listview-folders");b._mcFolderListTemplate=c.html();c.empty();this.callBase("_initListStartTemplate")},_initAddDataStart:function(){var b=this;b._setPrjFolderClickEvent();b._setPrjChartClickEvent()},_selectFolderItem:function(e){var b=this;var d=b.$mjListPageLeft.find(".co-listview-folders");var f=e.find(".jprj-folder").data("fid");var c=e.find(".jprj-folder");d.find(".jprj-folder").not(c).removeClass("on");c.addClass("on");b._closeFolder();b._openFolder(e);b._setFolderID(f)},_setFolderID:function(c){var b=this;b.onSetFolderID(c);b.$mjListPage.find('input[name="pid"]').val(c)},onSetFolderID:function(b){},_setPrjFolderClickEvent:function(){var b=this;var c=b.$mjListPageLeft.find(".co-listview-folders");c.delegate(".jprj-folder-open","click",function(d){d.preventDefault();var e=a(this).parents(".prj_folder_item");b._selectFolderItem(e);b._locationTasklistPage()});c.delegate(".jprj-folder-name","click",function(d){d.preventDefault()});c.delegate(".jprj-folder-title","click",function(d){d.preventDefault();var e=a(this).parents(".prj_folder_item");b._selectFolderItem(e);b._locationTasklistPage()})},_openFolder:function(e){var b=this;var f=b.$mjListPageLeft.find(".co-listview-folders");var c=null;var d=null;if(neo.isSet(e)){c=e.find(".jprj-folder");d=e.find(".co-listview-folder-inside")}else{c=f.find(".jprj-folder");d=f.find(".co-listview-folder-inside")}c.addClass("open");d.addClass("open")},_closeFolder:function(e){var b=this;var f=b.$mjListPageLeft.find(".co-listview-folders");var c=null;var d=null;if(neo.isSet(e)){c=e.find(".jprj-folder");d=e.find(".co-listview-folder-inside")}else{c=f.find(".jprj-folder");d=f.find(".co-listview-folder-inside")}c.removeClass("open");d.removeClass("open")},_setPrjChartClickEvent:function(){var b=this;var c=b.$mjListPageLeft.find(".co-listview-folders");c.delegate(".prj-folder-chart","click",function(d){d.preventDefault();b.$mjListPage.find(".jco-back-page-data").find('input[name="tid"]').val("");b._locationGantchartPage(desknets.prj.DEF_INIT_NOW)})},onSetSelectFolder:function(c){var b=this;if(c){b._setListViewRightBtnarea(false)}else{b._setListViewRightBtnarea(true)}},_setListViewRightBtnarea:function(c){var b=this;var d=b.$mjListPageRight.find(".co-btnarea");d.find(".jprj-charge-sel").attr("disabled",c);d.find(".prj-chart-filter").attr("disabled",c);if(!c){d.find(".jprj-prj-rate").show();d.find(".jprj-prj-tag").show();d.find(".co-msg-printer").show()}else{d.find(".jprj-prj-rate").hide();d.find(".jprj-prj-tag").hide();d.find(".co-msg-printer").hide()}},_getSelectFolderName:function(c){var b=this;var e="";var d=b.$mjListPageLeft.find(".co-listview-folders");d.find(".jprj-folder").each(function(){var f=a(this).data("fid");if(f==c){e=a(this).find(".jprj-folder-name").text()}});return e},_getSelectFolderNameTitle:function(){var b=this;var c="";c=a("#jco-m-sub-title").find("span.overflow").text();return c},_locationGantchartPage:function(e){var c=this;var d={};var b=c._getTargetFolderId();d=c._getGantchartPageParam();d.cmd=c._getGantchartPageCmd();d.pid=b;if(neo.isSet(e)&&e!=desknets.prj.DEF_INIT_NONE){d.init=e}c._setLocationHash(d)},_locationTasklistPage:function(){var c=this;var e={};var b=c._getTargetFolderId();e=c._getTasklistPageParam();e.cmd=c._getTasklistPageCmd();e.pid=b;e.tid="";var d=c.$mjListPage.find(".jco-back-page-data");e.prjrow=d.find('input[name="prjrow"]').val();c._setLocationHash(e)},_getListAjaxSuccessAddData:function(){var b=this;if(!b._boDelSingle()&&(typeof jsonRestFolder)!="undefined"){b._getAddDataAjaxSuccess(jsonRestFolder)}else{b._getAddDataAjax()}},_getAddDataAjaxSuccess:function(c){var b=this;b._getFolderAjaxSuccess(c);b._setTitleLabel();b._getAddDataAjaxSuccessOtherSet(c)},_getAddDataAjaxSuccessOtherSet:function(b){},_getFolderAjaxSuccess:function(l){var p=this;var k=desknets.ajax.getJsonItems(l);var o=[];var c=[];var d=p._mcFolderListTemplate;var e=0;var n=0;var h=p._getTargetFolderId();e=k.length;for(n=0;n<e;n++){o=k[n];if(o.id==h){o.fsel="on";o.fopen="open"}else{o.fsel="";o.fopen=""}var b=p._listLineFolder(d,o);var f=desknets.tmpl.replaceWordChkHtml(p.msTmplSetLink,"setting",desknets.Resource.prj.prjsetting);f=desknets.tmpl.replaceWordChkHtml(f,"update",desknets.Resource.prj.prjupdate);f=desknets.tmpl.replaceWordChkHtml(f,"delete",desknets.Resource.prj.prjdelete);b=desknets.tmpl.replaceWordChkHtml(b,"setlink",f);c[c.length]=b}var g=p.$mjListPageLeft.find(".co-listview-folders");g.empty();g.append(c.join(""));var m=0;var j=0;var i=0;if(neo.isSet(k)){m=k.length}if(neo.isSet(l.allcnt)){j=l.allcnt}if(neo.isSet(l.row)){i=l.row}g.attr("data-cnt",m);g.attr("data-allcnt",j);p.$mjListPage.find(".jco-back-page-data").find('input[name="prjrow"]').val(i);if(neo.isSet(h)&&parseInt(h)>0){p.onSetSelectFolder(true)}else{p.onSetSelectFolder(false)}p._listPageLinkFolder()},_listLineFolder:function(e,g){var d=this;var b="";if(typeof g=="object"){for(b in g){if(b=="complete"){var f="classcomplete";var c="ststitle";var h=[];h[f]=d._getCompleteClassName(g[b]);h[c]=d._getCompleteTitle(g[b]);e=d._replaceListLine(e,f,h);e=d._replaceListLine(e,c,h)}else{e=d._replaceListLine(e,b,g)}}}return e},_getCompleteClassName:function(c){var b=this;var d="";return d},_getCompleteTitle:function(c){var b=this;var d="";return d},_getTargetFolderId:function(){var b=this;var c=b.$mjListPage.find(".jco-back-page-data");return c.find('input[name="pid"]').val()},_getAddDataGetCmd:function(){return this._getFolderGetCmd()},getAddDataParam:function(){var b=this;var c={};var d=b.$mjListPage.find(".jco-back-page-data");c.row=d.find('input[name="prjrow"]').val();c.num=d.find('input[name="num"]').val();return c},_getAreaTitle:function(b){var d=this;var c=d._tmplLabelTitle;c=desknets.tmpl.replaceWordChk(c,"labelname",d._selName);if(neo.isSet(d._selName,{blank:false})){c=" > "+c}return d.callBase("_getAreaTitle",b)+c},_setTitleLabel:function(){var b=this;b._setTitle(b._getAreaTitle(b.$mjListPage))},_getGantchartPageParam:function(){var b=this;var c={};return c},_getTasklistPageParam:function(){var b=this;var c={};return c},_getGantchartPageCmd:function(){return desknets.prj.PAGE_PRJGANTTLIST},_getTasklistPageCmd:function(){return desknets.prj.PAGE_PRJINDEX},_getFolderGetCmd:function(){return desknets.prj.CMD_PRJLIST},});desknets.prj.PageReportListBase={_DEF_TEXTAREAHEIGHT_ARTICLE:57,_MAX_TEXTAREAHEIGHT_ARTICLE:108,_DEF_TEXTAREAHEIGHT_COMMENT:28,_MAX_TEXTAREAHEIGHT_COMMENT:108,mDispDefComment:2,mTaskStop:false,_mcTemplateInputAttach:null,_mcListTemplateComment:null,_mPrjName:"",_mbPageBreakMode:true,_rlistResize:function(){var b=this},_initInputAreaArticle:function(){var d=this;var f=d.$mjListPage.find(".jforum-article-post");var e=d.$mjListPage.find(".jprj-task-rate-input");var g=d.$mjListPage.find(".jprj-task-rateval").text();f.find(".forum-article-post-text").val("");e.find(".jprj-post-rate").val(g);e.find(".jprj-post-stop").attr("checked",d.mTaskStop);var h=f.find(".forum-article-post-text");if(desknets.browser.msie||desknets.browser.msie8){h.css({"overflow-y":"hidden","overflow-x":"hidden"})}else{h.css({overflow:"hidden"})}var c=f.find(".jforum-attach-list");c.empty();c.html(d._mcTemplateInputAttach);var b=d._getReportattach();b.init(d.$mjListPage,true);f.find(".jforum-attach-title").show();f.find(".jforum-attach-list").show()},_initInputAreaComment:function(d){var b=this;var c=d.find(".forum-article-replies-input");c.val("");if(desknets.browser.msie||desknets.browser.msie8){c.css({"overflow-y":"hidden","overflow-x":"hidden"})}else{c.css({overflow:"hidden"})}c.height(b._DEF_TEXTAREAHEIGHT_COMMENT)},_initListStartSet:function(){var d=this;var c=d.$mjListPage.find(".jforum-article-post").find(".jforum-attach-list");d._mcTemplateInputAttach=c.html();c.empty();var f=d.$mjListPage.find(".forum-article-replies");d._mcListTemplateComment=f.html();f.empty();var b=d._getReportDialog();b.init();var e=d._getTaskInfoDialog();e.init();this.callBase("_initListStartSet")},_initListEnd:function(){var b=this;b._initTitleEvent();b._initTaskforwardEvent();b._initArticleEvent();b._initRepInputEvent();b._initOtherEvent();this.callBase("_initListEnd")},_initTitleEvent:function(){var b=this;var c=b.$mjListPage.find("#prj-topic-title");c.delegate(".prj-taskinfo","click",function(i){i.preventDefault();var f=b.$mjListPage.find(".jco-back-page-data");var d=f.find('input[name="pid"]').val();var h=f.find('input[name="tid"]').val();var g=b._getTaskInfoDialog();g.openDialog(d,h)})},_initTaskforwardEvent:function(){var b=this;b.$mjListPage.find("#prj-list-taskforward").find("a").click(function(d){d.preventDefault();var c={"prj-msg-mail co-msg-mail":{message:desknets.Resource.prj.confirmation_movemail,funcOK:b._moveMailSend},"prj-msg-todo":{message:desknets.Resource.prj.confirmation_movetodo,funcOK:b._moveTodoEntry},"prj-msg-sch":{message:desknets.Resource.prj.confirmation_movesch,funcOK:b._moveSchEntry}};name=a(this).attr("class");if(name=="prj-msg-mail co-msg-mail"||name=="prj-msg-todo"||name=="prj-msg-sch"){desknets.dialog.confirm(c[name].message,function(){c[name].funcOK(b)})}})},_initArticleEvent:function(){var c=this;var b=c.$mjListPage.find(".jforum-article-post");b.delegate(".forum-article-post-link","click",function(f){f.preventDefault();var g=a(this).siblings(".forum-article-post-input");var d={};d.cmd=desknets.prj.CMD_PRJATTACHDELTEMP;desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,success:function(i,e,j){c._openArtilceInputArea(true);if(g.css("display")==="block"){c._initInputAreaArticle();var h=c.$mjListPage.find(".jprj-task-rate-input");h.find(".jprj-post-rate").focus()}},})});b.delegate("textarea.forum-article-post-text","keyup",function(d){if(desknets.browser.firefox){c._textareaResize(a(d.target),c._DEF_TEXTAREAHEIGHT_ARTICLE,c._MAX_TEXTAREAHEIGHT_ARTICLE,8)}else{c._textareaResize(a(d.target),c._DEF_TEXTAREAHEIGHT_ARTICLE,c._MAX_TEXTAREAHEIGHT_ARTICLE,2)}c._rlistResize()});b.delegate(".forum-article-post-submit","click",function(j){j.preventDefault();var g=a(this).parents(".forum-article-post-input");var f=a(this).parents("#prj-topic-post").find(".jprj-task-rate-input");var h=c.$mjListPage.find(".jco-back-page-data");var d=h.find('input[name="pid"]').val();var i=h.find('input[name="tid"]').val();c._entryArticle(d,i,g,f)});b.delegate(".forum-article-close-submit","click",function(d){d.preventDefault();c._openArtilceInputArea(false)})},_initRepInputEvent:function(){var b=this;var c=b.$mjListPage.find(".forum-article-list");c.delegate(".forum-msg-comment","click",function(f){f.preventDefault();a(this).closest("li.forum-article-item").find("textarea.forum-article-replies-input").focus()});var d=b.$mjListPage.find("textarea.forum-article-replies-input");c.delegate("textarea.forum-article-replies-input","focus",function(){var e=a(this).parents(".forum-article-replies-post");b._openCommentInputArea(e,true)});c.delegate("textarea.forum-article-replies-input","keypress",function(h){if((h.which&&h.which==13)||(h.keyCode&&h.keyCode==13)){if(!h.shiftKey){var g=a(this).parents(".forum-article-item").find(".jforum-article-id").val();var f=a(this).parents(".forum-article-replies-post");f.find(".forum-article-replies-input").blur();b._entryComment(g,f);return false}}});c.delegate("input.jforum-comment-entry-contr","keypress",function(h){if((h.which&&h.which==13)||(h.keyCode&&h.keyCode==13)){var g=a(this).parents(".forum-article-item").find(".jforum-article-id").val();var f=a(this).parents(".forum-article-replies-post");b._entryComment(g,f);return false}});c.delegate("textarea.forum-article-replies-input","keyup",function(f){if(desknets.browser.firefox){b._textareaResize(a(f.target),b._DEF_TEXTAREAHEIGHT_COMMENT,b._MAX_TEXTAREAHEIGHT_COMMENT,8)}else{b._textareaResize(a(f.target),b._DEF_TEXTAREAHEIGHT_COMMENT,b._MAX_TEXTAREAHEIGHT_COMMENT,2)}b._rlistResize()});c.delegate(".forum-article-replies-post-submit","click",function(h){h.preventDefault();var g=a(this).parents(".forum-article-item").find(".jforum-article-id").val();var f=a(this).parents(".forum-article-replies-post");b._entryComment(g,f)});c.delegate(".forum-article-replies-close-submit","click",function(g){g.preventDefault();var f=a(this).parents(".forum-article-replies-post");b._openCommentInputArea(f,false)})},_textareaResize:function(j,c,d,b){var l=this;var f=c;var i=d;var e=b;var k=0;var g=parseInt(j.css("maxHeight"));if(g>0&&g<i){i=g}var h=parseInt(j.get(0).clientHeight)+e;if(h>i){i=h}if(j.val().length==0){k=f}else{if(!desknets.browser.msie||desknets.browser.msie11){j.height(f)}k=parseInt(j.get(0).scrollHeight)+e}if(k<f){k=f}if(k>i){if(desknets.browser.msie||desknets.browser.msie8){j.css({"overflow-y":"scroll","overflow-x":"hidden"})}else{j.css({overflow:"auto"})}k=i}else{if(desknets.browser.msie||desknets.browser.msie8){j.css({"overflow-y":"hidden","overflow-x":"hidden"})}else{j.css({overflow:"hidden"})}}j.height(k)},_initOtherEvent:function(){var b=this;var c=b.$mjListPage.find(".forum-article-list");c.delegate(".forum-article-update","click",function(l){l.preventDefault();b._openArtilceInputArea(false);var j=a(this).parents(".forum-article-item");var h=b.$mjListPage.find(".jco-back-page-data");var f=h.find('input[name="pid"]').val();var k=h.find('input[name="tid"]').val();var i=j.find(".jforum-article-id").val();var d=function(){b._getListAjax(b._getListRow())};var g={};g.cmd=desknets.prj.CMD_PRJATTACHDELTEMP;desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),data:g,success:function(n,m,o){var e=b._getReportDialog();e.openDialog(f,k,i,d)},})});c.delegate(".forum-article-delete","click",function(j){j.preventDefault();var h=a(this).parents(".forum-article-item");var f=b.$mjListPage.find(".jco-back-page-data");var d=f.find('input[name="pid"]').val();var i=f.find('input[name="tid"]').val();var g=h.find(".jforum-article-id").val();b._deleteArticle(h,d,i,g)});c.delegate(".forum-comment-delete","click",function(k){k.preventDefault();var h=a(this).parents(".forum-article-item");var i=a(this).parents(".forum-article-reply");var f=b.$mjListPage.find(".jco-back-page-data");var d=f.find('input[name="pid"]').val();var j=f.find('input[name="tid"]').val();var g=h.find(".jforum-article-id").val();var l=i.find(".jforum-comment-id").val();b._deleteComment(h,i,d,j,g,l)});c.delegate(".forum-article-replies-showall","click",function(f){f.preventDefault();var d=a(this).parents(".forum-article-item");b._getListCommentAjax(d,true)});c.delegate(".forum-article-replies-hidecom","click",function(f){f.preventDefault();var d=a(this).parents(".forum-article-item");b._getListCommentAjax(d,false)})},_openArtilceInputArea:function(f){var d=this;var c=d.$mjListPage.find(".jforum-article-post");var b=d.$mjListPage.find(".jprj-task-rate-input");var e=d.$mjListPage.find(".jprj-task-rate");c.find(".forum-article-post-text").height(d._DEF_TEXTAREAHEIGHT_ARTICLE);if(f){c.find(".forum-article-post-input").show();b.show();e.hide()}else{c.find(".forum-article-post-input").hide();b.hide();e.show()}},_openCommentInputArea:function(c,d){var b=this;if(d){if(!b._isOpenCommentInputArea(c)){b._initInputAreaComment(c);c.find(".forum-article-replies-input-area").addClass("on")}}else{c.find(".forum-article-replies-input-area").removeClass("on");b._initInputAreaComment(c);c.find(".forum-article-replies-input").blur()}},_isOpenCommentInputArea:function(c){var b=this;return c.find(".forum-article-replies-input-area").hasClass("on")},_listLineReport:function(f,h){var e=this;var b="";var d=false;var g=false;var c=false;if(typeof h=="object"){for(b in h){if(b=="list"){g=true;continue}else{if(b=="attach"){d=true;continue}else{if(b=="photo"){c=true}}}f=e._replaceListLine(f,b,h)}f=e._setUserImg(f,c);var i=a("<ul />").html(f);e._setDeleteIcon(i.find(".forum-article-delete"),h);e._setUpdateIcon(i.find(".forum-article-update"),h);if(d){e._getListAttachAjaxSuccess(h,i)}if(g){e._getListCommentAjaxSuccess(h,i,e.mDispDefComment)}f=i.html()}return f},_setUserImg:function(d,b){var c=this;if(b){var e=new RegExp("{{userimgnone}}","ig");d=d.replace(e,"")}else{var e=new RegExp("{{userimg}}","ig");d=d.replace(e,"");e=new RegExp("{{userimgnone}}","ig");d=d.replace(e,"forum-article-userimg-none")}return d},_replaceListLine:function(d,i,f){if(i=="memo"){var g=desknets.tmpl.dispStr(f[i]);d=desknets.tmpl.replaceWordHtml(d,i,g)}else{if(i=="status"){var e=desknets.prj.getReportStatusClass(f[i]);var c=desknets.prj.getReportStatusName(f[i]);var h=new RegExp("{{classstatus}}","ig");d=d.replace(h,e);h=new RegExp("{{namestatus}}","ig");d=d.replace(h,c)}else{if(i=="photo"){var b='<img class="forum-article-userimg" src="{{photo}}" />';var h=new RegExp("{{photo}}","ig");b=b.replace(h,f[i]);h=new RegExp("{{userimg}}","ig");d=d.replace(h,b)}else{if(i=="cretime"){var g=desknets.dateTime.dispDateTime(f[i],{type:"list"});var h=new RegExp("{{"+i+"}}","ig");d=d.replace(h,g)}else{if(i=="updtime"){var g=desknets.dateTime.dispDateTime(f[i],{type:"list"});var h=new RegExp("{{"+i+"}}","ig");d=d.replace(h,g)}else{d=this.callBase("_replaceListLine",d,i,f)}}}}}return d},_getListAjaxSuccessReportOtherSet:function(k){var m=this;var g=m.$mjListPage.find("#prj-topic-title");var d=m.$mjListPage.find("#prj-topic-post");var l=m.$mjListPage.find("#prj-topic-header");m._mPrjName=k.prjname;var n=m._getTitleName(k);g.find(".prj-task-name").text(n);g.find(".prj-task-name").attr("title",n);g.attr("data-prjname",k.prjname);g.attr("data-tasktitle",k.tasktitle);var e=k.reportstatus;var f=desknets.prj.getReportStatusClass(e);var i=d.find(".jprj-task-rate");if(i.hasClass(desknets.prj.DEF_STSCLASS_BEFORE)){i.removeClass(desknets.prj.DEF_STSCLASS_BEFORE)}if(i.hasClass(desknets.prj.DEF_STSCLASS_AHEAD)){i.removeClass(desknets.prj.DEF_STSCLASS_AHEAD)}if(i.hasClass(desknets.prj.DEF_STSCLASS_BEHIND)){i.removeClass(desknets.prj.DEF_STSCLASS_BEHIND)}if(i.hasClass(desknets.prj.DEF_STSCLASS_FINISHED)){i.removeClass(desknets.prj.DEF_STSCLASS_FINISHED)}if(i.hasClass(desknets.prj.DEF_STSCLASS_STOP)){i.removeClass(desknets.prj.DEF_STSCLASS_STOP)}d.find(".jprj-task-rate").addClass(f);if(f==desknets.prj.DEF_STSCLASS_STOP){m.mTaskStop=true}else{m.mTaskStop=false}var h="";if(neo.isSet(k.reportrate)){h=k.reportrate}if(h.length==0){d.find(".jprj-task-rateval").text("0")}else{d.find(".jprj-task-rateval").text(h)}var j=k.startdate;var c=k.enddate;var b=desknets.dateTime.dispDateTime(j.substring(0,8),{type:"list"})+" - "+desknets.dateTime.dispDateTime(c.substring(0,8),{type:"list"});b=desknets.tmpl.escapeWord(b);d.find(".jprj-task-workperiod").html(b);l.attr("data-reportstatus",k.reportstatus);l.attr("data-taskcomplete",k.taskcomplete);l.attr("data-startdate",k.startdate);l.attr("data-enddate",k.enddate);m._openArtilceInputArea(false);desknets.htmlparts.convertHrefInText(m.$mjListPage.find(".forum-article-message"))},_getListAjaxSuccessEnd:function(){var b=this;b.callBase("_getListAjaxSuccessEnd");b._setTitlePrj()},_setTitlePrj:function(){var c=this;var b={};b.title=c._mPrjName;if(c._isSetTitlePrj()){c.callBase("_setTitle",c._getAreaTitle(c.$mjListPage),b)}},_isSetTitlePrj:function(){return false},_getTitleName:function(c){var b=this;return c.tasktitlefull},_getListAttachAjaxSuccess:function(h,b){var o=this;var f=desknets.ajax.getItems(h.attach.item);var l=[];var c=[];var j=0;var k=o.$mjListPage.find(".jco-back-page-data");var e=k.find('input[name="pid"]').val();var d=k.find('input[name="tid"]').val();var n=b.find(".jforum-article-id").val();var g=desknets.getUrl(o._getModule());var i={cmd:o._getRefAttachCmd(),id:e,tid:d,rid:n};var m=desknets.attachDisp.disp(h.attach,o._getModule(),i);b.find(".jforum-article-attach-list").html(m);if(f.length>0){b.find(".forum-article-attach").removeClass("none")}else{b.find(".forum-article-attach").addClass("none")}},_getListCommentAjax:function(b,c){var i=this;var f={};var j={};var g=i.$mjListPage.find(".jco-back-page-data");var e=g.find('input[name="pid"]').val();var d=g.find('input[name="tid"]').val();var h=b.find(".jforum-article-id").val();f.cmd=i._getListCommentExecCmd();f.pid=e;f.tid=d;f.rid=h;j={success:function(l,k,m){if(c){i._getListCommentAjaxSuccess(l,b,-1);b.find(".forum-article-replies-showall").addClass("none");b.find(".forum-article-replies-hidecom").removeClass("none")}else{i._getListCommentAjaxSuccess(l,b,i.mDispDefComment);b.find(".forum-article-replies-showall").removeClass("none");b.find(".forum-article-replies-hidecom").addClass("none")}}};i._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,f,j)},_getListCommentAjaxSuccess:function(h,b,d){var k=this;var g=desknets.ajax.getJsonItems(h);var j=[];var c=[];var e=k._mcListTemplateComment;var i=-1;var f=g.length;if(d>0&&d<f){i=d-1}else{i=f-1}for(;i>=0;i--){j=g[i];c[c.length]=k._listLineComment(e,j)}if(g.length>k.mDispDefComment){k._setListComment(b,c.join(""),g.length,true)}else{k._setListComment(b,c.join(""),g.length,false)}if(g.length>0){b.find(".forum-article-replies").removeClass("none")}else{b.find(".forum-article-replies").addClass("none")}desknets.htmlparts.convertHrefInText(b.find(".forum-article-message"))},_listLineComment:function(e,f){var d=this;var b="";var c=false;if(typeof f=="object"){for(b in f){if(b=="photo"){c=true}e=d._replaceListLine(e,b,f)}e=d._setUserImg(e,c);var g=a("<ul />").html(e);d._setDeleteIcon(g.find(".forum-comment-delete"),f);e=g.html()}return e},_setListComment:function(h,g,f,b){var c=this;h.find(".forum-article-replies").html(g);var e=desknets.tmpl.replaceWordChk(desknets.Resource.prj.comment_list_open,"count",f);h.find(".jforum-comment-list-open").text(e);var d=desknets.tmpl.replaceWordChk(desknets.Resource.prj.comment_list_close,"count",c.mDispDefComment);h.find(".jforum-comment-list-close").text(d);if(b){h.find(".forum-article-replies-showall").removeClass("off");h.find(".forum-article-replies-hidecom").removeClass("off")}else{h.find(".forum-article-replies-showall").addClass("off");h.find(".forum-article-replies-hidecom").addClass("off")}},_setDeleteIcon:function(e,c){var b=this;var d=c.isdelete;if(d==1){e.removeClass("off")}else{e.addClass("off")}},_setUpdateIcon:function(f,d){var b=this;var e=d.isdelete;var c=d.iscurrent;if(e==1&&c==1){f.removeClass("off")}else{f.addClass("off")}},_entryArticle:function(e,b,g,f){var i=this;var d=g.find(".forum-article-post-text");var j=f.find(".jprj-post-rate");var c=f.find(".jprj-post-stop");var h={};h.cmd=i._getArticleEntryCmd();h.pid=e;h.tid=b;h.memo=d.val();h.rate=j.val();if(c.attr("checked")){h.stop=desknets.prj.DEF_REPORTSTS_STOP}desknets.ajax.rest({url:desknets.getUrl(i._getRestModule()),data:h,success:function(m,k,n){if(i._mbPageBreakMode){if(i._getListRow()!="0"){i._listPage("0")}else{i._getListAjax(i._getListRow())}}else{i._getListAjax(i._getListRow());var l=i.$mjListPage.find("#prj-reports-pane-list");if(neo.isSet(l)){l.scrollTop(0)}}i._openArtilceInputArea(false)},})},_deleteArticle:function(f,h,d,b){var c=this;var g=null;var i={};var e=function(){if(g!=null){desknets.submitform.setDialogDisabled(g)}var j=c._getParamDeleteArticle(f,h,d,b);desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:j,success:function(l,k,m){c._getListAjax(c._getListRow());g.dialog("close")},})};g=desknets.dialog.confirm(c._getMessageDeleteArticle(f),e,i)},_getParamDeleteArticle:function(f,g,e,b){var d=this;var c={};c.cmd=d._getArticleDelCmd();c.pid=g;c.tid=e;c.id=b;return c},_getMessageDeleteArticle:function(b){return desknets.Resource.Message.com_del_conf},_entryComment:function(f,e){var j=this;var h=j.$mjListPage.find(".jco-back-page-data");var d=h.find('input[name="pid"]').val();var c=h.find('input[name="tid"]').val();var b=e.parents(".forum-article-item");var i=e.find(".forum-article-replies-input");var g={};g.cmd=j._getCommentEntryCmd();g.pid=d;g.tid=c;g.rid=f;g.memo=i.val();desknets.ajax.rest({url:desknets.getUrl(j._getRestModule()),data:g,success:function(l,k,m){if(b.find(".forum-article-replies-showall").hasClass("none")){j._getListCommentAjax(b,true)}else{j._getListCommentAjax(b,false)}j._openCommentInputArea(e,false)},})},_deleteComment:function(d,k,e,c,h,g){var j=this;var f=null;var b={};var i=function(){if(f!=null){desknets.submitform.setDialogDisabled(f)}var l=j._getParamDeleteComment(d,k,e,c,h,g);desknets.ajax.rest({url:desknets.getUrl(j._getRestModule()),data:l,success:function(n,m,o){if(d.find(".forum-article-replies-showall").hasClass("none")){j._getListCommentAjax(d,true)}else{j._getListCommentAjax(d,false)}f.dialog("close")},})};f=desknets.dialog.confirm(j._getMessageDeleteComment(d,k),i,b)},_getParamDeleteComment:function(g,h,i,e,b,f){var d=this;var c={};c.cmd=d._getCommentDelCmd();c.pid=i;c.tid=e;c.rid=b;c.id=f;return c},_getMessageDeleteComment:function(b,c){return desknets.Resource.Message.com_del_conf},getListReportExecParam:function(){var b=this;var c={};c.pid=b.$mjListPage.find('input[name="pid"]').val();c.tid=b.$mjListPage.find('input[name="tid"]').val();return c},_moveMailSend:function(b){var c={};c.cmd=b._getTaskCmd();c.pid=b.$mjListPage.find('input[name="pid"]').val();c.tid=b.$mjListPage.find('input[name="tid"]').val();desknets.ajax.rest({url:desknets.getUrl(desknets.prj.MODULE_API_PRJ),data:c,success:function(i,e,j){var k=[];var k=b._createSendAddress(i);if(k.length>256){desknets.dialog.alert(desknets.Resource.prj.message_addressover)}else{var h=b._createSendMessage();var g={};g.to=k.join(",");g.subject=h.title;g.body=h.content;var f="2";var d=desknets.pageframe.getLoginConnectMail();if(d=="2"){f="3"}desknets.webmail.openMailEditByMailLink(g,a("form#webmailtemp"),f)}},error:function(f,d,e){desknets.ajax.onError(f.status,e)}})},_moveTodoEntry:function(b){desknets.saveHashCmdCookie("todolist");var d=b._createSendMessage();desknets.inputUtil.presetFormValues("todotaskentry",{labelname:d.title,memo:d.content});var c=desknets.getUrl(desknets.prj.MODULE_OFFICE)+"?cmd=todolist#cmd=todotaskentry";desknets.execLocation(c)},_moveSchEntry:function(b){desknets.saveHashCmdCookie("schindex");var d=b._createSendMessage();desknets.inputUtil.presetFormValues("schadd",{detail:d.title,memo:d.content});var c=desknets.getUrl(desknets.prj.MODULE_OFFICE)+"?cmd=schindex#cmd=schadd";desknets.execLocation(c)},_createSendMessage:function(){var b=this;var h=b.$mjListPage.find("#prj-topic-title");var f=b.$mjListPage.find("#prj-topic-post");var g=b.$mjListPage.find("#prj-topic-header");var c={};var e="";if(neo.isSet(h.attr("data-tasktitle"))){e=h.attr("data-tasktitle")}c.title=e;var d="";if(neo.isSet(h.attr("data-prjname"))){d=d+desknets.tmpl.CreateNameDelimValueHtml(desknets.Resource.prj.prjname,h.attr("data-prjname"))+"\n"}d=d+desknets.tmpl.CreateNameDelimValueHtml(desknets.Resource.prj.taskname,h.find(".prj-task-name").text())+"\n";if(neo.isSet(g.attr("data-startdate"))){d=d+desknets.tmpl.CreateNameDelimValueHtml(desknets.Resource.prj.startdate,desknets.dateTime.dispDateTime(g.attr("data-startdate")))+"\n"}if(neo.isSet(g.attr("data-enddate"))){d=d+desknets.tmpl.CreateNameDelimValueHtml(desknets.Resource.prj.enddate,desknets.dateTime.dispDateTime(g.attr("data-enddate")))+"\n"}c.content=d;d=d+desknets.tmpl.CreateNameDelimValueHtml(desknets.Resource.prj.rate,f.find(".jprj-task-rateval").text())+"%\n";if(neo.isSet(g.attr("data-reportstatus"))){d=d+desknets.tmpl.CreateNameDelimValueHtml(desknets.Resource.prj.status,desknets.prj.getReportStatusName(g.attr("data-reportstatus")))+"\n"}c.content=d;return c},_createSendAddress:function(e){var l=this;var g=desknets.ajax.getJsonItems(e);var j;var i=[];var c=g.length;for(j=0;j<c;j++){var f=g[j].Name;var h=g[j].Mail;var b=g[j].mailmobile;var d=g[j].mailprivate;var k=g[j].mailother;if(neo.isSet(h)){i[i.length]=l._createMailAddress(f,h)}if(neo.isSet(b)){i[i.length]=l._createMailAddress(f,b)}if(neo.isSet(d)){i[i.length]=l._createMailAddress(f,d)}if(neo.isSet(k)){i[i.length]=l._createMailAddress(f,k)}}return i},_createMailAddress:function(c,b){return b},_getListReportExecCmd:function(){return desknets.prj.CMD_PRJREPORTLIST},_getListCommentExecCmd:function(){return desknets.prj.CMD_PRJCOMMENTLIST},_getRefAttachCmd:function(){return desknets.prj.CMD_PRJVIEWREPORTATTACH},_getArticleEntryCmd:function(){return desknets.prj.CMD_PRJREPORTENTRY},_getArticleDelCmd:function(){return desknets.prj.CMD_PRJREPORTDEL},_getCommentEntryCmd:function(){return desknets.prj.CMD_PRJCOMMENTENTRY},_getCommentDelCmd:function(){return desknets.prj.CMD_PRJCOMMENTDEL},_getTaskCmd:function(){return desknets.prj.CMD_PRJTASKUSERS},_getTaskInfoDialog:function(){return desknets.prj.TaskInfoDialog},_getReportDialog:function(){return desknets.prj.ReportDialog},_getReportattach:function(){return desknets.prj.reportattach},};desknets.prj.PageTopListBase={_mcListTemplateReport:null,_mSetSpliter:false,_mbSetProjectInfo:false,_getAddDataAjaxSuccessOtherSet:function(c){var b=this;var d=b.$mjListPageLeft.find(".prj_folder_item");if(d.length==0){b._setUpMessage()}},_setUpMessage:function(){var c=this;var b=a("#jprj-topmsg");var d=false;if(b.hasClass("jprj-topmsg-manager")){d=true}c._setUpNoFolderMessage(d)},_setUpNoFolderMessage:function(d){var b=this;var c=desknets.Resource.prj.listnoprj_msg;var e="";if(!neo.isSet(d)||d==false){e=desknets.Resource.prj.listnoprj_user}if(d==true){param=a("#"+desknets.prj.PRJ_MSETINDEXID).find("a:first").attr("href");e='<a href="'+param+'">'+desknets.Resource.prj.listnoprj_manage+"</a>"}desknets.pageframe.viewTopMsg(c+"<br />"+e,"alert")},_initListStartSet:function(){var b=this;this.callBase("_initListStartSet");var c=b.$mjListPage.find(".jprj-reports-list");b._mcListTemplateReport=c.html();c.empty()},_initListEnd:function(){var b=this;b._initPrintLink();b.$mjListPage.find("#prj-reports-pane-list-more").click(function(e){e.preventDefault();var d={};var c=b.$mjListPage.find(".jco-back-page-data").find('input[name="pid"]').val();var f=b.$mjListPage.find(".jco-back-page-data").find('input[name="tid"]').val();d.cmd=b._getReportListPageCmd();d.pid=c;d.tid=f;d.init=desknets.prj.DEF_INIT_NOW;b._inputPage(d)});b.$mjListPage.find(".co-pane-item").delegate(".jprj-list-tasks-item","click",function(c){c.preventDefault();if(!(c.target.nodeName=="A"||c.target.nodeName=="a")){b._clickTask(a(this))}});b.$mjListPage.find(".co-pane-item").delegate(".jprj-task-report-view","click",function(d){d.preventDefault();var c=a(this).parent().parent();b._clickTask(c)});b.$mjListPage.find(".prj-chart-filter").change(function(c){b.$mjListPage.find(".jco-back-page-data").find('input[name="tid"]').val("");a(c.target).blur();b.$mjListPage.find(".jco-back-page-data").find('input[name="status"]').val(a(this).val());b._listPage("0");return false});b._initListEndDialog();b._initArticleInputEvent();if(neo.isSet(jsonRestAttachExtList)){desknets.attach.ext.saveList(jsonRestAttachExtList)}b.callBase("_initListEnd")},_initArticleInputEvent:function(){var b=this;b.$mjListPage.find("#prj-topic-header").delegate("textarea","mouseup",function(){b._rlistResize()})},_clickTask:function(b){var c=this;var e=b.data("id");c.$mjListPage.find('input[name="tid"]').val(e);var d=desknets.getInputDataToUrl(c.$mjListPage.find(".jco-back-page-data"));c._setLocationHash(d)},changPage:function(){var c=this;var b=false;c.callBase("changPage");var e=c.$mjListPage.find('input[name="tid"]').val();if(e.length>0){c.$mjListPage.find("#jprj-project-info").hide();c.$mjListPage.find("#jprj-report-list").show();b=true}else{if(c._mbSetProjectInfo){c.$mjListPage.find("#jprj-project-info").show();c.$mjListPage.find("#jprj-report-list").hide();b=true}else{c.$mjListPage.find("#jprj-project-info").hide();c.$mjListPage.find("#jprj-report-list").hide()}}if(b){if(!c._mSetSpliter){var d={};desknets.listviewspliter.create(c.$mjListPage.find("#prj-list-pane"),function(){c._rlistResize()},null,d);c._mSetSpliter=true}}else{if(c._mSetSpliter){desknets.listviewspliter.destroy(c.$mjListPage.find("#prj-list-pane"));c._mSetSpliter=false}}},_rlistResize:function(){var o=this;var d=o.$mjListPage.find(".ui-layout-north");var j=d.height();var h=d.find(".co-table-list").outerHeight();var b=j-h;if(b<=0){d.find("#prj-list-tasks").height(0)}else{d.find("#prj-list-tasks").height(b)}var p=o.$mjListPage.find(".ui-layout-center");var i=p.height();var f=p.find("#prj-topic-title").outerHeight();var l=p.find("#prj-topic-header").outerHeight();var e=i-(f+l);p.find("#prj-reports-pane-list").height(e);var g=p.find(".forum-article-post-text");var n=g.height();var c=n+e;if(c<o._DEF_TEXTAREAHEIGHT_ARTICLE){c=o._DEF_TEXTAREAHEIGHT_ARTICLE}g.css("max-height",c);var k=p.find("#prj-project-title").outerHeight();var m=i-k;p.find("#jprj-project-sammary").height(m)},updateListHeight:function(e){var b=this;if(neo.isSet(e)){desknets.listviewframe.updateListHeight(b.$mjListPage.find(".co-listview"),false,true,true)}else{b.callBase("updateListHeight")}var d=b.$mjListPage.find(".co-listview").height();var c=b.$mjListPage.find(".co-btnarea").outerHeight();b.$mjListPage.find("#prj-list-pane").height(d-c)},_openArtilceInputArea:function(c){var b=this;this.callBase("_openArtilceInputArea",c);b._rlistResize()},_initListEndDialog:function(){var c=this;c.$mjListPage.find(".co-pane-item").delegate(".jprj-task-user-view","click",function(f){f.preventDefault();var e=a(this).parent().parent();var d=c.$mjListPage.find('input[name="pid"]').val();c._openDialogTask(d,e.data("id"))});var b=function(e,d){c.$mjListPage.find(".jco-back-page-data").find('input[name="tid"]').val("");c.$mjListPage.find(".jco-back-page-data").find('input[name="uid"]').val(e);c.$mjListPage.find(".jprj-sel-user-name").html('<span title="'+d+'">'+d+"</span>");c._listPage("0")};c.$mjListPage.find(".jprj-charge-sel").click(function(f){f.preventDefault();var e=a(this).parent().parent();var d=c.$mjListPage.find('input[name="pid"]').val();c._openDialogPrj(d,b)})},_openDialogTask:function(d,c){var b=this;desknets.prj.TaskUser.openDialogTask(d,c)},_openDialogPrj:function(d,b){var c=this;desknets.prj.TaskUser.openDialogPrj(d,b)},_hashUpdateListPage:function(d){var c=this;var e=d.cmd;var b=desknets.paramanalyzer.getHashParams();if(e==desknets.prj.PAGE_PRJINDEX){c._getListAjax(b.row)}c.callBase("_hashUpdateListPage",d)},_hashUpdatePageView:function(h){var e=this;var c=desknets.paramanalyzer.getHashParams();if(h==desknets.prj.PAGE_PRJGANTTLIST){var d="#"+desknets.prj.prjganttlist._getIdListPage();if(a(d).find(".jco-title").length>0&&!neo.isSet(c.init)){desknets.prj.prjganttlist._getListAjax(c.row)}else{desknets.prj.prjganttlist.initPage(e.mhashBackCmd,e.mhashIdBack)}}else{if(h==desknets.prj.PAGE_PRJSEARCH){desknets.prj.prjsearchindex.initPage(desknets.prj.PAGE_PRJINDEX,"jco-m-list-container");e.mhashBackErrCmd=e.mhashBackCmd;e.mhashIdErrBack=e.mhashIdBack;e.mhashBackCmd=desknets.prj.PAGE_PRJSEARCH;e.mhashIdBack="jco-m-search-container"}else{if(h==desknets.prj.PAGE_PRJREPORTLIST){var g="#"+desknets.prj.prjreportlist._getIdListPage();if(a(g).find(".jco-title").length>0&&!neo.isSet(c.init)){desknets.prj.prjreportlist._getListAjax(c.row)}else{var d="#"+desknets.prj.prjganttlist._getIdListPage();if(neo.isSet(c.init)&&c.init==desknets.prj.DEF_INIT_GANT&&a(d).find(".jco-title").length>0){var f=desknets.prj.PAGE_PRJGANTTLIST;var b="jprj-m-ganttchart-container";desknets.prj.prjreportlist.initPage(f,b)}else{desknets.prj.prjreportlist.initPage(e.mhashBackCmd,e.mhashIdBack)}}}else{e.callBase("_hashUpdatePageView",h)}}}},_listLine:function(c,d){var b=this;c=desknets.prj.tasklistUtil.createTaskListLine(b,c,d);return c},_getListAjaxParams:function(e){var b=this;var f={};var c={};var g={};var d={};c=b.getListParamToObj();c.row=e;g=b.getAddDataParam();g.cmd=b._getAddDataGetCmd();f["0"]=c;f["1"]=g;var h=b.$mjListPage.find('input[name="tid"]').val();if(h.length>0){d=b.getListReportExecParam();d.cmd=b._getListReportExecCmd();f["2"]=d}return f},_getListAjaxSuccessAdd:function(c){var b=this;b.callBase("_getListAjaxSuccessAdd",c);if(neo.isSet(c["2"])){if(c["2"]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(c["2"]["errorno"],c["2"]["errormessage"])}else{b._getListAjaxSuccessReport(c["2"])}}},_getListAjaxSuccessReport:function(f){var j=this;var e=this._getListAjaxSuccessData(f);var i=[];var b=[];var d=0;var h=0;var c=j._mcListTemplateReport;var g=j.$mjListPage.find(".jprj-reports-list");if(e.length<=0){g.empty();j.$mjListPage.find("#prj-reports-pane-list-more").hide()}else{d=e.length;for(h=0;h<d;h++){i=e[h];b[b.length]=j._listLineReport(c,i)}g.empty();g.html(b.join(""));if(f.allcnt>h){j.$mjListPage.find("#prj-reports-pane-list-more").show()}else{j.$mjListPage.find("#prj-reports-pane-list-more").hide()}}j._getListAjaxSuccessReportOtherSet(f)},_getListAjaxSuccessOtherSet:function(d){var c=this;var b=desknets.paramanalyzer.getHashParams();if(neo.isSet(b.status)&&b.status.length>0){c.$mjListPage.find(".prj-chart-filter").val([b.status])}else{c.$mjListPage.find(".prj-chart-filter").val(["2"])}var e=desknets.Resource.prj.all;if(neo.isSet(d.tuname)&&d.tuname!=""){e=desknets.tmpl.dispStr(d.tuname)}c.$mjListPage.find(".jprj-sel-user-name").html('<span title="'+e+'">'+e+"</span>");c._setTaskOpen();c._selName=d.prjname;var f="";if(neo.isSet(d.prjrate)){f=d.prjrate}c.$mjListPage.find(".jprj-prj-rateval").text(f);c._setProjectInfo(d);c.callBase("_getListAjaxSuccessOtherSet",d)},_setProjectInfo:function(e){var k=this;var f=desknets.ajax.getJsonItems(e);if(neo.isSet(e.SID_PROJECT)){k._mbSetProjectInfo=true}else{k._mbSetProjectInfo=false}var d=k.$mjListPage.find("#jprj-project-info");d.find(".jprj-project-memo").html("");d.find(".jprj-project-attach-list").empty();if(neo.isSet(e.memo)&&e.memo.length>0){var j=desknets.tmpl.dispStr(e.memo);d.find(".jprj-project-memo").html(j);d.find(".jprj-project-memo").show()}else{d.find(".jprj-project-memo").hide()}if(neo.isSet(e.attach)){var g=desknets.ajax.getItems(e.attach.item);var i=[];var b=[];var h=0;for(h=0;h<g.length;h++){i=g[h];var c='<tr><td><a href="{{downloadurl}}" target="attach">{{filename}}</a></td><td class="co-td-num">{{filesize}}</td></tr>';c=desknets.tmpl.replaceWord(c,"filename",i.attachdisp);var l=desknets.attachDisp.getSize(i.size);c=desknets.tmpl.replaceWord(c,"filesize",l);surl=desknets.getUrl(desknets.prj.MODULE_PRJ)+"?cmd="+k._getPrjDownLoadCmd()+"&id="+e.SID_PROJECT+"&fno="+i.id+"&filename="+desknets.tmpl.escapeWord(encodeURIComponent(i.attachdisp.replace(/'/g,"%27")));c=desknets.tmpl.replaceWord(c,"downloadurl",surl);b[b.length]=c}d.find(".jprj-project-attach-list").html(b.join(""));d.find(".jprj-project-attach-list").show()}else{d.find(".jprj-project-attach-list").hide()}return true},_setTaskOpen:function(){var b=this;var d=b.$mjListPage.find('input[name="tid"]').val();var c=b.$mjListPage.find("#prj-list-tasks");c.find(".jprj-list-tasks-item").each(function(){var e=a(this).data("id");if(e==d){a(this).addClass("on")}else{a(this).removeClass("on")}})},_getGantchartPageParam:function(){var b=this;var c={};c.uid=b.$mjListPage.find(".jco-back-page-data").find('input[name="uid"]').val();c.status=b.$mjListPage.find(".jco-back-page-data").find('input[name="status"]').val();return c},_getTasklistPageParam:function(){var b=this;var c={};c.uid=b.$mjListPage.find(".jco-back-page-data").find('input[name="uid"]').val();c.status=b.$mjListPage.find(".jco-back-page-data").find('input[name="status"]').val();return c},_initPrintLink:function(){var b=this;var c={};c.cgiurl="zhtml";c.cgiprm={cmd:"printhtml",fldlang:desknets.Resource.code,execcmd:"prjprint",};var d=a.proxy(function(e,f){var g=this._buildPrintHtmlBody(e,f);f.$("#jco-print-body").html(g);f.$("a").each(function(){var i=a(this);var j=i.attr("class");var h=i.html();i.replaceWith('<span class="'+j+'">'+h+"</span>")});f.$("#jco-print-body").find(".prj-list-taskname").each(function(){var h=a(this);h.removeClass("prj-list-taskname")});f.$("#jco-print-body").find(".prj-list-username").each(function(){var h=a(this);h.removeClass("prj-list-username")});f.$("#jco-print-body").find(".prj-list-edate").each(function(){var h=a(this);h.addClass("prj-list-edate-print")});return true},this);desknets.print.init(b.$mjListPage,d,c)},_buildPrintHtmlBody:function(q,b){var p=this;var o=false;var m=[];var d=p._getTargetFolderId();var l=p._getSelectFolderNameTitle();if(l.length>0){o=true}var g='<div class="dn-preview-header"><h1 class="dn-preview-title">{{Name}}&nbsp;</h1></div>';if(o){m[m.length]=desknets.tmpl.replaceWord(g,"Name",l)}else{m[m.length]=desknets.tmpl.replaceWordHtml(g,"Name",desknets.Resource.prj.message_notselectprj)}if(p._isOpenRightList()&&o){var e='<div class="ui-layout-north"><table class="co-table-list">{{Head}}{{Datail}}</table></div>';var h=q.find(".jprj-print-list-head").html();e=desknets.tmpl.replaceWordHtml(e,"Head",h);var n=q.find(".jprj-print-list-datail").html();m[m.length]=desknets.tmpl.replaceWordHtml(e,"Datail",n)}else{var e='<div class="co-nodata">{{Msg}}</table></div>';var k=q.find(".co-nodata").html();m[m.length]=desknets.tmpl.replaceWordHtml(e,"Msg",k)}var f='<div class="dn-preview-footer">{{credate}}</div>';var c=desknets.dateTime.current;var i=neo.dateTime.format(desknets.Resource.dateTimeFormat,c);i=i+desknets.Resource.prj.create;var j=new RegExp("{{credate}}","ig");m[m.length]=f.replace(j,i);return m.join("")},_isOpenRightList:function(){var b=this;if(b.$mjListPage.find(".jprj-print-list-head").is(":hidden")){return false}else{return true}},onSetFolderID:function(c){var b=this;b.$mjListPage.find('input[name="tid"]').val("")},_getRestModule:function(){return desknets.prj.MODULE_API_PRJ},_getListCmd:function(){return desknets.prj.PAGE_PRJINDEX},_getListExecCmd:function(){return desknets.prj.CMD_PRJTASKLIST},_getReportListPageCmd:function(){return desknets.prj.PAGE_PRJREPORTLIST},_getPrjDownLoadCmd:function(){return desknets.prj.CMD_PRJVIEWATTACH},};desknets.page(desknets.prj,"baseprjlist",desknets.prj.PagePrjListBase,desknets.prj.PageReportListBase);desknets.page(desknets.prj,"baseprjtoplist",desknets.prj.baseprjlist,desknets.prj.PageTopListBase);desknets.page(desknets.prj,"prjindex",desknets.prj.baseprjtoplist,{init:function(){var b=this;b._mbPageBreakMode=false;b.callBase("init");desknets.prj.tagDispPrj.initTagEvent(desknets.prj.MODULE_API_PRJ,b.$mjListPage)},updateListHeight:function(){var b=this;b.callBase("updateListHeight",true)},dispBackListPage:function(){var b=this;if(neo.isSet(b.mBackCmd)&&b.mBackCmd.length>0){b.callBase("dispBackListPage")}else{desknets.prj.changeLocationToInitTop()}},_getListAjaxSuccessOtherSet:function(d){var c=this;c.callBase("_getListAjaxSuccessOtherSet",d);var f="";if(neo.isSet(d.tagcolor)){f=d.tagcolor}var b=c.$mjListPage.find("#jprj-ref-tag-options-prj");var e=b.prev();e.find('input[name="tagcolor-prj"]').val(f);desknets.prj.tagDispPrj.initEntryPageTag(b,"tagcolor-prj")},_getListAjaxSuccessReportOtherSet:function(d){var c=this;c.callBase("_getListAjaxSuccessReportOtherSet",d);var f="";if(neo.isSet(d.tagcolor)){f=d.tagcolor}var b=c.$mjListPage.find("#jprj-ref-tag-options-task");var e=b.prev();e.find('input[name="tagcolor-task"]').val(f);desknets.prj.tagDispPrj.initEntryPageTag(b,"tagcolor-task")},});desknets.prj.PageReportList={_getFieldsCheckScroll:function(){return["pid","tid"]},_listMoveScroll:function(){this._setClearScrollPosition();this.callBase("_listMoveScroll")},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()})},_listLine:function(c,d){var b=this;c=b._listLineReport(c,d);return c},_getListAjaxSuccessOtherSet:function(c){var b=this;b._getListAjaxSuccessReportOtherSet(c)},_isSetTitlePrj:function(){return true},_getIdListPage:function(){return"jprj-m-reportlist-container"},_getIdListPageForm:function(){return"reportlistfrm"},_getRestModule:function(){return desknets.prj.MODULE_API_PRJ},_getListCmd:function(){return desknets.prj.PAGE_PRJREPORTLIST},_getListExecCmd:function(){return desknets.prj.CMD_PRJREPORTLIST},};desknets.page(desknets.prj,"baseprjreportlist1",desknets.PageListBase,desknets.prj.PageReportListBase);desknets.page(desknets.prj,"baseprjreportlist2",desknets.prj.baseprjreportlist1,desknets.prj.PageReportList);desknets.page(desknets.prj,"prjreportlist",desknets.prj.baseprjreportlist2,{});desknets.page(desknets.prj,"prjsearchindex",desknets.PageListBatSearchBase,{_replaceListLine:function(b,d,c){return desknets.prj.prjindex._replaceListLine(b,d,c)},_listLine:function(c,d){var b=this;c=desknets.tmpl.replaceWord(c,"cmdg",b._getListGunttCmd());c=desknets.tmpl.replaceWord(c,"cmdr",b._getReportListPageCmd());c=desknets.prj.tasklistUtil.createTaskListLine(b,c,d);return c},_initListEnd:function(){var b=this;b.callBase("_initListEnd");b._initListEndAssignLink()},_initListEndAssignLink:function(){var b=this;b.$mjListPage.find(".co-tbody-list").delegate(".jprj-task-user-view","click",function(e){e.preventDefault();var d=a(this).parent().parent();var c=d.find(".jprj-prjid").val();desknets.prj.TaskUser.openDialogTask(c,d.data("id"))})},_initListStartModLink:function(){var b=this},_getRestModule:function(){return desknets.prj.MODULE_API_PRJ},_getListCmd:function(){return desknets.prj.PAGE_PRJSEARCH},_getListExecCmd:function(){return desknets.prj.CMD_PRJTASKSEARCHINDEX},_getStopBatSearchCmd:function(){return desknets.prj.CMD_PRJTASKSEARCHSTOP},_getSearchConditionParams:function(){var b=[];b.push("srch_key");b.push("sdate");b.push("srch_sdaterange");b.push("edate");b.push("srch_edaterange");b.push("srch_reportrange");b.push("complete");b.push("status");return b},_getListDispCmd:function(){return desknets.prj.PAGE_PRJREPORTLIST},_getListGunttCmd:function(){return desknets.prj.PAGE_PRJGANTTLIST},_getReportListPageCmd:function(){return desknets.prj.PAGE_PRJREPORTLIST},});desknets.page(desknets.prj,"prjganttlist",desknets.PageListBase,{mobjToggleOpen:{},mbDispPositionToday:true,mbDispPositionStartday:false,msPrjName:null,msPrjStartDate:null,msPrjEndDate:null,mdateToday:null,mdateStartDate:null,mobjHoliday:{},mobjGetHoliday:{},msPrmMonth:"",miYear:0,miMonth:0,miTodayX:0,msTmplClass:'<div class="prj-listview-folder co-listview-item-inside {{class}} {{classlevel}} {{opensts}}" data-id="{{id}}" data-startdate="{{startdate}}" data-enddate="{{enddate}}" data-reportrate="{{reportrate}}" data-reportstatus="{{reportstatus}}">{{open}}<span class="folder" title="{{name}}">{{name}}</span>{{setlink}}</div>',msTmplClassOpen:'<a class="toggle" href="#">+</a>',msTmplTask:'<div class="prj-listview-folder co-listview-item-inside prj-class-task {{classlevel}} {{sts}}" data-id="{{id}}" data-startdate="{{startdate}}" data-enddate="{{enddate}}" data-reportrate="{{reportrate}}" data-reportstatus="{{reportstatus}}"><span class="folder" title="{{ststitle}}"><a class="jprj-task-name" href="#cmd={{cmd}}&pid={{pid}}&tid={{id}}&init={{init}}" title="{{name}}">{{name}}</a></span>{{user}}{{setlink}}</div>',msTmplTaskUser:'&nbsp;<a href="#" class="jprj-task-user-view"><span class="co-gicon-mygroup">&nbsp;</span></a>',msTmplSetLink:"",msTmplRClass:'<div class="prj-chart-folder {{class}}" title="{{name}}"><div class="prj-chart-bar" data-id="{{id}}" style="left: {{left}}px;width: {{width}}px;"><div class="prj-chart-arrow"></div><div class="prj-chart-label">{{name}}</div><div class="prj-chart-end">{{date}}</div></div><div class="prj-chart-line"><div class="prj-chart-line-top" style="{{csst}}"></div><div class="prj-chart-line-middle" style="{{cssm}}"></div><div class="prj-chart-line-bottom" style="{{cssb}}"></div></div></div>',msTmplRTask:'<div class="prj-chart-folder prj-class-task" title="{{name}}"><div class="prj-chart-bar" data-id="{{id}}" style="left: {{left}}px; width: {{width}}px;"><div class="prj-chart-label">{{name}}({{rate}}%)</div><div class="prj-chart-end">{{date}}</div><div class="prj-chart-percent" style="width: {{rate}}%;"></div></div><div class="prj-chart-line"><div class="prj-chart-line-top" style="{{csst}}"></div><div class="prj-chart-line-middle" style="{{cssm}}"></div><div class="prj-chart-line-bottom" style="{{cssb}}"></div></div></div>',_getFieldsCheckScroll:function(){return["pid"]},_listMoveScroll:function(){this._setClearScrollPosition();this.callBase("_listMoveScroll")},initPage:function(d,c){var b=this;b.mdateToday=desknets.dateTime.current;b.mbDispPositionToday=true;this.mobjHoliday={};this.mobjGetHoliday={};b.callBase("initPage",d,c)},_initGetHtml:function(){var c=this;var e={};var d={};var f={};c.getViewMonth();var b=desknets.paramanalyzer.getHashParams();f=c._getSearchPageParam();f.cmd=b.cmd;d["0"]=f;d["1"]=c.getHolidayPrm(c.msPrmMonth);e.success=function(g){if(g[0]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(g[0]["errorno"],g[0]["errormessage"])}else{if(g[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(g[1]["errorno"],g[1]["errormessage"])}else{c.setHoliday(c.msPrmMonth,g[1]);c._initHtml(g)}}};c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,d,e)},getViewMonth:function(){var d=this;var b="";var e=0;var f=0;var c=desknets.paramanalyzer.getHashParams();if(neo.isSet(c.date)){b=c.date}if(b.length==6){e=Number(b.substring(0,4));f=Number(b.substring(4,6))}if(e==0||f==0||isNaN(e)||isNaN(f)){e=d.mdateToday.getFullYear();f=d.mdateToday.getMonth()+1}d.miYear=e;d.miMonth=f;d.msPrmMonth=desknets.zeroPadding(e,4)+desknets.zeroPadding(f,2)},_initListEnd:function(){var b=this;var c=b.$mjListPage.find('input[name="line"]');b.$mjListPage.find("#prj-chart-action-span").neoDateNav({date:new Date(b.miYear,b.miMonth-1,1),change:function(e,d){b.changeMonth(d.date);desknets.scrollManager.clearScrollPosition(b._getListCmd())}});b.$mjListPage.find(".jprj-chart-action-jump").click(function(h){h.preventDefault();var e=0;var i=0;var d=0;var g=null;var f=a(this).data("mode");if(f=="start"){if(!neo.isSet(b.msPrjStartDate)){return}e=Number(b.msPrjStartDate.substring(0,4));i=Number(b.msPrjStartDate.substring(4,6));d=Number(b.msPrjStartDate.substring(6,8));g=new Date(e,i-1,d);b.mbDispPositionStartday=true}else{if(f=="today"){if(neo.isSet(b.mdateToday)){e=b.mdateToday.getFullYear();i=b.mdateToday.getMonth()+1;d=b.mdateToday.getDate()}g=b.mdateToday;b.mbDispPositionToday=true}}if(b.miYear==e&&b.miMonth==i){b._getListAjax(b._getListRow())}else{b.changeMonth(g)}b.$mjListPage.find("#prj-chart-action-span").neoDateNav("date",g);desknets.scrollManager.clearScrollPosition(b._getListCmd())});b.$mjListPage.find(".jco-input-list-page").click(function(d){d.preventDefault();b.dispBackListPage()});b.$mjListPage.find(".co-listview-left-data").delegate(".toggle","click",function(g){g.preventDefault();var e=a(this).parent();var f=e.next();var i=f.attr("class").split(" ");var h=a("#prj-chart-folders").find("."+i[0]);e.toggleClass("open");f.animate({height:"toggle"},"slow");h.animate({height:"toggle"},"slow");var d=desknets.paramanalyzer.getHashParams();b._changeToggleOpen(d.pid,e.data("id")+"")});b.$mjListPage.find("#prj-chart-action-progress").click(function(d){d.preventDefault();if(c.val()=="1"){c.val("")}else{c.val("1")}b._setLocationHashGantt();b.$mjListPage.find(".prj-chart-line-top").toggle();b.$mjListPage.find(".prj-chart-line-middle").toggle();b.$mjListPage.find(".prj-chart-line-bottom").toggle()});b.$mjListPage.find(".co-btn-update").click(function(d){d.preventDefault();a(this).addClass("on");b._getListAjax(b._getListRow());desknets.scrollManager.clearScrollPosition(b._getListCmd())});b.$mjListPage.find(".prj-chart-filter").change(function(d){a(d.target).blur();b.$mjListPage.find(".jco-back-page-data").find('input[name="status"]').val(a(this).val());b._listPage("0")});b._initListEndDialog();b._initListEndDragScroll()},_setLocationHashGantt:function(){var c=this;var b=desknets.getInputDataToUrl(c.$mjListPage.find(".jco-back-page-data"));b=b+"&cmd="+c._getListCmd();c._setLocationHash(b,true)},_initListEndDragScroll:function(){var c=this;var f=10;var d=100;var b=c.$mjListPage.find("#prj-chart-list-scroll");var e;a("#prj-chart-scroll-prev").click(function(){b.scrollLeft(b.scrollLeft()-f);return false}).mousedown(function(){b.scrollLeft(b.scrollLeft()-f);e=setInterval(function(){b.scrollLeft(b.scrollLeft()-f)},d);return false}).bind("mouseup mouseout",function(){clearInterval(e);return false});a("#prj-chart-scroll-next").click(function(){b.scrollLeft(b.scrollLeft()+f);return false}).mousedown(function(){e=setInterval(function(){b.scrollLeft(b.scrollLeft()+f)},d);return false}).bind("mouseup mouseout",function(){clearInterval(e);return false});b.dndscroll()},_initListEndDialog:function(){var c=this;c.$mjListPage.find(".co-listview-left-data").delegate(".jprj-task-user-view","click",function(f){f.preventDefault();var e=a(this).parent();var d=desknets.paramanalyzer.getHashParams();desknets.prj.TaskUser.openDialogTask(d.pid,e.data("id"))});var b=function(e,d){c.$mjListPage.find(".jco-back-page-data").find('input[name="uid"]').val(e);c.$mjListPage.find(".jprj-sel-user-name").html('<span title="'+d+'">'+d+"</span>");c._listPage("0")};c.$mjListPage.find(".jprj-charge-sel").click(function(e){e.preventDefault();if(c.isSelectedProject()){var d=desknets.paramanalyzer.getHashParams();desknets.prj.TaskUser.openDialogPrj(d.pid,b)}})},isSelectedProject:function(){var c=desknets.paramanalyzer.getHashParams();if(neo.isSet(c.pid)&&c.pid.length>0){return true}var b=desknets.Resource.prj.unselectedProject;desknets.dialog.alert(b,{type:"warn"});return false},changeMonth:function(d){var c=this;var b=neo.dateTime.format("yyyyMM",d);if(c.mobjGetHoliday[b]===true){c.changeMonthView(b)}else{c.getHoliday(b)}},changeMonthView:function(b){var c=this;c.$mjListPage.find('input[name="date"]').val(b);c._setLocationHashGantt();c.getViewMonth();c._getListAjaxSuccessCal();c._getListAjaxSuccessToday();c._getListAjaxSuccessListPrjMove();c._getListAjaxSuccessEnd()},getHoliday:function(b){var c=this;var d=c.getHolidayPrm(b);desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,success:function(f,e,g){c.setHoliday(b,f);c.changeMonthView(b)}})},getHolidayPrm:function(b){var d=desknets.paramanalyzer.getHashParams();var c={};c.cmd=desknets.prj.CMD_PRJHOLIDAYLIST;c.smonth=b+"01";c.pid=d.pid;return c},setHoliday:function(b,h){var d=this;var i=desknets.ajax.getJsonItems(h);var f;var e=i.length;d.mobjGetHoliday[b]=true;for(f=0;f<e;f++){var c=i[f];var g=c.year+desknets.zeroPadding(c.id,4);d.mobjHoliday[g]=c.Name}},_setTitle:function(d){var c=this;var b={};b.title=c.msPrjName;c.callBase("_setTitle",d,b)},_getListAjaxSuccess:function(d){var c=this;var b=desknets.paramanalyzer.getHashParams();if(neo.isSet(b.status)&&b.status.length>0){c.$mjListPage.find(".prj-chart-filter").val([b.status])}else{c.$mjListPage.find(".prj-chart-filter").val(["2"])}var e=desknets.Resource.prj.all;if(d.tuname!=""){e=desknets.tmpl.dispStr(d.tuname)}c.$mjListPage.find(".jprj-sel-user-name").html('<span title="'+e+'">'+e+"</span>");c.msPrjName=d.prjname;if(neo.isSet(d.startdate)){c.msPrjStartDate=d.startdate}else{c.msPrjStartDate=null}if(neo.isSet(d.enddate)){c.msPrjEndDate=d.enddate}else{c.msPrjEndDate=null}var f="";if(neo.isSet(d.prjrate)){f=d.prjrate}c.$mjListPage.find(".jprj-prj-rateval").text(f);c.getViewMonth();c._getListAjaxSuccessCal();c._getListAjaxSuccessToday();c._getListAjaxSuccessPrj(d);c._getListAjaxSuccessEnd()},_getListAjaxSuccessPrj:function(c){var b=this;var e=b._getListAjaxSuccessData(c);var d="";if(e.length<=0){b.$mjListPage.find(".co-listview-left-data > ul").empty();b.$mjListPage.find("#prj-chart-folders").empty();b.$mjListPage.find("#prj-chart").hide();b.$mjListPage.find(".co-nodata").show();d="0"}else{b.$mjListPage.find("#prj-chart").show();b.$mjListPage.find(".co-nodata").hide();b._getListAjaxSuccessListPrj(c);d=c.row}b.$mjListPage.find(".jco-pv-all-cnt").val(c.allcnt);b.$mjListPage.find(".jco-back-page-data").find('input[name="row"]').val(d)},_getListAjaxSuccessListPrj:function(i){var s=this;var m=s._getListAjaxSuccessData(i);var z=0;var y=0;var D=0;var H=[];var B=[];var o={};var t="";var u={};var x=[];x[0]=false;x[1]=false;x[2]=false;var e=0;var h=0;var E=0;var w=false;var p="";var k="";var l="";var f="";var G="";var j=s.miTodayX+50;var v={top:"",mid:"",btm:""};var d=0;var r="left";var n=j;var c="";var q=desknets.paramanalyzer.getHashParams();var b=true;z=m.length;for(y=0;y<z;y++){o=m[y];if(y<z-1){u=m[y+1]}else{u={HIERARCHY:"111"}}e=Number(o.HIERARCHY.length)/3-1;if(isNaN(e)){e=0}h=Number(u.HIERARCHY.length)/3-1;if(isNaN(h)){h=0}w=false;for(D=0;D<e;D++){if(!x[D]){if(w){H[H.length]="<li>";B[B.length]="<li>"}p="";if(D==e-1){p=' class="jprj-ul-'+k+'"'}x[D]=true;if(b){H[H.length]="<ul"+p+">";B[B.length]="<ul"+p+">"}else{H[H.length]="<ul"+p+' style="display: none;">';B[B.length]="<ul"+p+' style="display: none;">'}w=true}}w=false;if(E>e){for(D=E-1;D>=e;D--){H[H.length]="</ul>";H[H.length]="</li>";B[B.length]="</ul>";B[B.length]="</li>";x[D]=false}}d=0;r="left";n=j;v={top:"",mid:"",btm:""};var J=neo.dateTime.parse(o.startdate);var g=neo.dateTime.parse(o.enddate);var A=s._getDays(J,s.mdateStartDate)*50;var F=(s._getDays(g,J)+1)*50-3;if(o.type=="0"){t=s.msTmplClass;f=s.msTmplRClass;b=true;if(e<h){t=desknets.tmpl.replaceWordChkHtml(t,"open",s.msTmplClassOpen);b=s._isToggleOpen(i.SID_PROJECT,o.id);if(b){t=desknets.tmpl.replaceWordChkHtml(t,"opensts","open");s._setToggleOpen(i.SID_PROJECT,o.id,true)}else{t=desknets.tmpl.replaceWordChkHtml(t,"opensts","");s._setToggleOpen(i.SID_PROJECT,o.id,false)}}else{t=desknets.tmpl.replaceWordChkHtml(t,"open","");t=desknets.tmpl.replaceWordChkHtml(t,"opensts","")}if(e==0){t=desknets.tmpl.replaceWordChkHtml(t,"class","prj-class-class");f=desknets.tmpl.replaceWordChkHtml(f,"class","prj-class-class")}else{if(e==1){t=desknets.tmpl.replaceWordChkHtml(t,"class","prj-class-subclass");f=desknets.tmpl.replaceWordChkHtml(f,"class","prj-class-subclass")}}}else{t=s.msTmplTask;f=s.msTmplRTask;l="";if(o.reportstatus==desknets.prj.DEF_REPORTSTS_DOING){l="ahead"}else{if(o.reportstatus==desknets.prj.DEF_REPORTSTS_LATE){l="behind"}else{if(o.reportstatus==desknets.prj.DEF_REPORTSTS_COMPLETE){l="finished"}else{if(o.reportstatus==desknets.prj.DEF_REPORTSTS_STOP){l="abort"}else{l="before"}}}}t=desknets.tmpl.replaceWordChkHtml(t,"sts",l);t=desknets.tmpl.replaceWordChkHtml(t,"user",s.msTmplTaskUser);f=desknets.tmpl.replaceWordChkHtml(f,"rate",o.reportrate);G=desknets.prj.getReportStatusName(o.reportstatus);t=desknets.tmpl.replaceWordChkHtml(t,"ststitle",G);var C=A+(F*o.reportrate/100);d=C-j;if(d<0){if(o.reportstatus==desknets.prj.DEF_REPORTSTS_COMPLETE||o.reportstatus==desknets.prj.DEF_REPORTSTS_STOP){d=0}else{d=-d;n=C;r="right"}}else{if(o.reportrate=="0"||o.reportrate==""){d=0}else{if(o.reportstatus==desknets.prj.DEF_REPORTSTS_STOP){d=0}}}t=desknets.tmpl.replaceWord(t,"cmd",s._getTaskCmd());t=desknets.tmpl.replaceWord(t,"pid",q.pid);t=desknets.tmpl.replaceWord(t,"init",desknets.prj.DEF_INIT_GANT)}t=desknets.tmpl.replaceWordChkHtml(t,"id",o.id);f=desknets.tmpl.replaceWordChkHtml(f,"id",o.id);t=desknets.tmpl.replaceWordChkHtml(t,"startdate",o.startdate);t=desknets.tmpl.replaceWordChkHtml(t,"enddate",o.enddate);t=desknets.tmpl.replaceWordChkHtml(t,"reportrate",o.reportrate);t=desknets.tmpl.replaceWordChkHtml(t,"reportstatus",o.reportstatus);c=desknets.tmpl.replaceWordChkHtml(s.msTmplSetLink,"setting",desknets.Resource.prj.prjsetting);t=desknets.tmpl.replaceWordChkHtml(t,"setlink",c);if(e==0){t=desknets.tmpl.replaceWordChkHtml(t,"classlevel","prj-levelt")}else{if(e==1){t=desknets.tmpl.replaceWordChkHtml(t,"classlevel","prj-levelm")}else{if(e==2){t=desknets.tmpl.replaceWordChkHtml(t,"classlevel","prj-levell")}}}f=desknets.tmpl.replaceWordChkHtml(f,"left",A);f=desknets.tmpl.replaceWordChkHtml(f,"width",F);f=desknets.tmpl.replaceWordChkHtml(f,"date",neo.dateTime.format(desknets.Resource.shortDateFormat,g));t=desknets.tmpl.replaceWordChk(t,"name",o.Name);f=desknets.tmpl.replaceWordChk(f,"name",o.Name);var I="";if(q.line==="1"){I="none"}else{I="block"}v.top="left:"+n+"px;width:"+d+"px;border-"+r+"-width:2px;display:"+I+";";v.mid="left:"+n+"px;margin-"+r+":"+d+"px;display:"+I+";";v.btm="left:"+n+"px;width:"+d+"px;border-"+r+"-width:2px;display:"+I+";";f=desknets.tmpl.replaceWordChkHtml(f,"csst",v.top);f=desknets.tmpl.replaceWordChkHtml(f,"cssm",v.mid);f=desknets.tmpl.replaceWordChkHtml(f,"cssb",v.btm);H[H.length]="<li>";H[H.length]=t;B[B.length]="<li>";B[B.length]=f;if(e>=h){H[H.length]="</li>";B[B.length]="</li>"}E=e;k=o.id}for(D=e;D>0;D--){H[H.length]="</ul>";H[H.length]="</li>";B[B.length]="</ul>";B[B.length]="</li>";x[D]=false}s.$mjListPage.find(".co-listview-left-data > ul").html(H.join(""));s.$mjListPage.find("#prj-chart-folders").html(B.join(""));s.$mjListPage.find(".jco-pv-cnt").val(y)},_getListAjaxSuccessListPrjMove:function(){var b=this;b.$mjListPage.find("#prj-chart-folders").find(".prj-chart-folder").each(function(){b._getListAjaxSuccessListPrjMoveRow(a(this))})},_getListAjaxSuccessListPrjMoveRow:function(k){var p=this;var e=p.miTodayX+50;var m=0;var d="left";var l=e;var h={top:{},mid:{},btm:{}};var f=k.find(".prj-chart-bar").data("id");var g=p.$mjListPage.find('.prj-listview-folder[data-id="'+f+'"]');var o={};o.startdate=g.data("startdate");o.enddate=g.data("enddate");o.reportrate=g.data("reportrate");o.reportstatus=g.data("reportstatus");var i=neo.dateTime.parse(o.startdate);var c=neo.dateTime.parse(o.enddate);var j=p._getDays(i,p.mdateStartDate)*50;k.find(".prj-chart-bar").css("left",j+"px");if(k.hasClass("prj-class-task")){var n=(p._getDays(c,i)+1)*50-3;var b=j+(n*o.reportrate/100);m=b-e;if(m<0){if(o.reportstatus==desknets.prj.DEF_REPORTSTS_COMPLETE||o.reportstatus==desknets.prj.DEF_REPORTSTS_STOP){m=0}else{m=-m;l=b;d="right"}}else{if(o.reportrate=="0"||o.reportrate==""){m=0}else{if(o.reportstatus==desknets.prj.DEF_REPORTSTS_STOP){m=0}}}h.top.left=l+"px";h.top.width=m+"px";h.top["border-left-width"]="0px";h.top["border-right-width"]="0px";h.top["border-"+d+"-width"]="2px";h.mid.left=l+"px";h.mid["margin-left"]="0px";h.mid["margin-right"]="0px";h.mid["margin-"+d]=m+"px";h.btm.left=l+"px";h.btm.width=m+"px";h.btm["border-left-width"]="0px";h.btm["border-right-width"]="0px";h.btm["border-"+d+"-width"]="2px";k.find(".prj-chart-line-top").css(h.top);k.find(".prj-chart-line-middle").css(h.mid);k.find(".prj-chart-line-bottom").css(h.btm)}else{k.find(".prj-chart-line-top").css("left",l+"px");k.find(".prj-chart-line-middle").css("left",l+"px");k.find(".prj-chart-line-bottom").css("left",l+"px")}},_getListAjaxSuccessCal:function(){var p=this;var j=p.mdateToday.getDate();var o=0;var e=[];var m=0;var n=false;var r;var h="";var q="";var d="";p.mdateToday=desknets.dateTime.current;var c=new Date(p.miYear,p.miMonth-1,1);var g=c.getDay();r=neo.dateTime.getMonthEndDay(p.miYear,p.miMonth-1);var i=p.miYear;var k=p.miMonth-1;var l=r-6;if(k==12){i--}p.mdateStartDate=new Date(i,k-1,l);n=false;if(j>=l&&p.mdateToday.getMonth()+1==k&&p.mdateToday.getFullYear()==i){n=true}for(o=l;o<=r;o++){if(g>=7){g=g-7}d=desknets.Resource.prj.ganttday;h='class="prj-chart-date-prev';if(g==0){h=h+" co-sunday"}else{if(g==6){h=h+" co-saturday"}}if(n&&o==j){h=h+" jprj-ganttchart-today"}h=h+'"';d=desknets.tmpl.replaceWordChkHtml(d,"class",h);d=desknets.tmpl.replaceWordChkHtml(d,"day",o);d=desknets.tmpl.replaceWordChkHtml(d,"week",neo.Resource.dateTime.shortWeeks[g]);e[e.length]=d;g++}m=7;r=neo.dateTime.getMonthEndDay(p.miYear,p.miMonth);n=false;if(p.mdateToday.getMonth()+1==p.miMonth&&p.mdateToday.getFullYear()==p.miYear){n=true}for(o=1;o<=r;o++){if(g>=7){g=g-7}d=desknets.Resource.prj.ganttday;h='class="';if(g==0){h=h+" co-sunday"}else{if(g==6){h=h+" co-saturday"}}if(n&&o==j){h=h+" jprj-ganttchart-today"}q=p.msPrmMonth+desknets.zeroPadding(o,2);if(neo.isSet(p.mobjHoliday[q])){h=h+" co-holiday"}h=h+'"';d=desknets.tmpl.replaceWordChkHtml(d,"class",h);d=desknets.tmpl.replaceWordChkHtml(d,"day",o);d=desknets.tmpl.replaceWordChkHtml(d,"week",neo.Resource.dateTime.shortWeeks[g]);e[e.length]=d;g++}m=m+r;r=7;n=false;var b=p.miMonth+1;var f=p.miYear;if(b==13){b=1;f++}if(j<=r&&p.mdateToday.getMonth()+1==b&&p.mdateToday.getFullYear()==f){n=true}for(o=1;o<=r;o++){if(g>=7){g=g-7}d=desknets.Resource.prj.ganttday;h='class="prj-chart-date-next';if(g==0){h=h+" co-sunday"}else{if(g==6){h=h+" co-saturday"}}if(n&&o==j){h=h+" jprj-ganttchart-today"}h=h+'"';d=desknets.tmpl.replaceWordChkHtml(d,"class",h);d=desknets.tmpl.replaceWordChkHtml(d,"day",o);d=desknets.tmpl.replaceWordChkHtml(d,"week",neo.Resource.dateTime.shortWeeks[g]);e[e.length]=d;g++}m=m+7;p.$mjListPage.find("#prj-chart-date").html(e.join(""));p.$mjListPage.find("#prj-chart-size").css("width",m*50-1+"px")},_getListAjaxSuccessToday:function(){var b=this;var c=b.$mjListPage.find("#prj-chart-today");b.miTodayX=50*b._getDays(b.mdateToday,b.mdateStartDate);if(b.$mjListPage.find(".jprj-ganttchart-today").length>0){c.show();c.css("left",b.miTodayX+"px")}else{c.hide()}},_getListAjaxSuccessEnd:function(){var k=this;k.callBase("_getListAjaxSuccessEnd");if(k.mbDispPositionToday){var e=k.$mjListPage.find(".jprj-ganttchart-today");if(e.length>0){var b=k.miTodayX;var h=k._getChartPositionCenter();var i=b-50*h;k.$mjListPage.find("#prj-chart-list-scroll").scrollLeft(i)}}else{if(k.mbDispPositionStartday){var j=Number(k.msPrjStartDate.substring(0,4));var d=Number(k.msPrjStartDate.substring(4,6));var c=Number(k.msPrjStartDate.substring(6,8));if(k.miYear==j&&k.miMonth==d){var g=new Date(j,d-1,c);var f=50*k._getDays(g,k.mdateStartDate);var h=k._getChartPositionCenter();var i=f-50*h;k.$mjListPage.find("#prj-chart-list-scroll").scrollLeft(i)}}}k.mbDispPositionToday=false;k.mbDispPositionStartday=false},_isToggleOpen:function(d,c){var b=this;if(!neo.isSet(b.mobjToggleOpen[d])){return true}if(!neo.isSet(b.mobjToggleOpen[d][c])){return true}return b.mobjToggleOpen[d][c]},_setToggleOpen:function(d,c,e){var b=this;if(!neo.isSet(d)||!neo.isSet(c)||!neo.isSet(e)){return}if(!neo.isSet(b.mobjToggleOpen[d])){b.mobjToggleOpen[d]={}}b.mobjToggleOpen[d][c]=e},_changeToggleOpen:function(d,c){var b=this;if(!neo.isSet(d)||!neo.isSet(c)){return}if(b._isToggleOpen(d,c)){b._setToggleOpen(d,c,false)}else{b._setToggleOpen(d,c,true)}},_getChartPositionCenter:function(){var c=a(document.documentElement);var b=7;if(c.hasClass("dn-size-m")){b=10}else{if(c.hasClass("dn-size-l")){b=13}}return b},_getDays:function(d,c){var b=neo.dateTime.getDaysGap(c,d);return parseInt(b,10)},_getRestModule:function(){return desknets.prj.MODULE_API_PRJ},_getIdListPage:function(){return"jprj-m-ganttchart-container"},_getIdListPageForm:function(){return"ganttchartfrm"},_getListCmd:function(){return desknets.prj.PAGE_PRJGANTTLIST},_getListExecCmd:function(){return desknets.prj.CMD_PRJTASKLISTGT},_getTaskCmd:function(){return desknets.prj.PAGE_PRJREPORTLIST}});app.addInitialAction(function(){desknets.prj.init()})})(jQuery);