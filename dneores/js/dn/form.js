/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.form={init:function(){},initForm:function(c,d,b){c.find(".jco-setup-attach-list").each(function(){var e=a(this);var f=d(e);var g=f.toggleTargetFunc;f.toggleTargetFunc=function(){var h=e.find(".jco-remove-all-button");var i=e.dnAttachList("option","files");h.toggle(i.length>0);if(!!g){g()}};if(!!b){f.totalSizeLimit=Number(b)}e.dnAttachList(f)});c.find(".co-datepicker").each(function(){var e=a(this);var f=e.attr("data-ytype");var g="";if(f&&f=="2"){g=desknets.Resource.dateFormat2}else{g=desknets.Resource.dateFormat4}e.datepicker({dateFormat:g})})},};(function(b){desknets.page(desknets.form,"formatentrycom",desknets.PageInputBase,{_mIdListPage:null,_mCmdListPage:null,_options:{onOk:null,onCancel:null},_HTML_MUST_MARK:'<font color="#FF0000">*</font>',initPage:function(h,g,e,f,d){var c=this;c._mIdListPage=e;c._mCmdListPage=f;c._options=d;c.callBase("initPage",h,g)},getMultiRequest:function(){var d=this;var i={};var h={};var g={};var f={};var c={};var e={};i=d._getCopyToTemporaryParam();e["0"]=i;h=d._getEditHtmlParam();e["1"]=h;g=d._getEditDataParam();e["2"]=g;f=d._getEditDataParam();f.hidden="1";e["3"]=f;c=desknets.attach.ext.getListParam();if(c){c.cmd=d._getAttExtListCmd(c.cmd);e["4"]=c}return e},_getCopyToTemporaryParam:function(){var c=this;var d={};d.cmd=c._getFormatCopyTempCmd();d.tmpnm=this._getInputTmpnm();return d},_getEditDataParam:function(){var c=this;var d;d=desknets.paramanalyzer.getHashParams();d.cmd=this._getEditExecCmd();d.tmpnm=this._getInputTmpnm();return d},_getEditHtmlParam:function(){var c=this;var d;d=desknets.paramanalyzer.getHashParams();d.cmd=c._getFormatEntryPageCmd();return d},_getInputTmpnm:function(){return""},_initHtml:function(d){var c=this;if(d[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[1]["errorno"],d[1]["errormessage"]);return}c._setPageContents(d[1].html);if(d[4]){desknets.attach.ext.saveList(d[4])}c._initSet(d)},_setPageContents:function(c){this.$mjPage.empty();this.$mjPage.html(c)},_initSet:function(d){var c=this;c.callBase("_initSet",d);if(d[2]&&d[2].list){c._setEditFormatToScreen(d[2].list)}if(d[3]&&d[3].list){c._setEditFormatToScreen(d[3].list)}c._inputAjaxForm()},_inputButton:function(){var c=this;c.$mjPage.find(".jform-edit-format-cancel-page").click(function(d){d.preventDefault();c.$mjPage.hide().empty();if(!!c._options.onCancel){c._options.onCancel()}});c.$mjPage.find(".jform-edit-format-save-submit").click(function(d){d.preventDefault();c._onClickSaveButton(d)});c.$mjPage.find(".jform-edit-format-tab-edit-format").click(function(d){d.preventDefault();c._onClickEditFormatButton(d)});c.$mjPage.find(".jform-edit-format-tab-pre-view").click(function(d){d.preventDefault();c._onClickPreViewButton(d)});c.$mjPage.find(".form-edit-format-edit-parts").click(function(d){d.preventDefault();c._onClickAddPartButton(d)});c.$mjPage.find(".form-edit-format-edit-content").delegate(".form-edit-format-edit-part","click",function(d){d.preventDefault();c._onClickEditPartButton(d)});c._bindSotableToElement(c.$mjPage.find(".form-edit-format-edit-sortable_cellbox"));c.$mjPage.find(".form-edit-format-edit-content").delegate('.form-edit-format-edit-cell-del-btn:not(".disable")',"click",function(d){c._onClickDelPartButton(d)});c.$mjPage.find(".form-edit-format-hidden-pane-content").delegate(".form-edit-format-edit-part","click",function(d){d.preventDefault();c._onClickEditPartButton(d)});c.$mjPage.find(".form-edit-format-hidden-pane-content").delegate('.form-edit-format-edit-cell-del-btn:not(".disable")',"click",function(d){c._onClickDelPartButton(d)})},_onClickDelPartButton:function(f){var e=this;var i=b(f.target);var d=i.siblings(".form-edit-format-edit-part");var j=d.attr("data-id");var c=d.attr("data-type");i.addClass("disable");var h={};var g=e._getFormatPartDelCmd();h.cmd=g;h.id=j;h.tmpno=e._getInputTmpnm();h.ptype=e._getPTypeByDataType(c);desknets.ajax.rest({url:desknets.getUrl(e._getRestModule()),data:h,success:function(m,k,n){var l=d.closest(".form-edit-format-edit-cell");if(j<0){e._delPartHideItemByElement(l)}else{e._delPartItemByElement(l)}},complete:function(m,k,l){i.removeClass("disable")},traditional:true})},_delPartItemByElement:function(f){var e=this;var d=f.closest(".form-edit-format-edit-row");f.remove();if(d.find(".form-edit-format-edit-cell").length==0){d.remove()}var h=e.$mjPage.find(".form-edit-format-edit-content");var c=h.find(".form-edit-format-edit-cell");if(c.length==0){h.removeClass("on");var g=e.$mjPage.find(".form-edit-format-edit-content-empty");g.addClass("on")}},_showHideList:function(){var d=this;var e=d.$mjPage.find(".form-edit-format-hidden-pane");var c=e.find(".form-edit-format-edit-cell");if(c.length>0){e.show()}},_delPartHideItemByElement:function(e){var d=this;e.remove();var f=d.$mjPage.find(".form-edit-format-hidden-pane");var c=f.find(".form-edit-format-edit-cell");if(c.length==0){f.hide()}},_bindSotableToElement:function(d,e){var c=this;var f=".form-edit-format-edit-sortable_cellbox";if(e&&e!=""){f=e}d.sortable({items:"> .form-edit-format-edit-cell",update:function(g,h){c._onSortableFormatEditTableUpdate(g,h)},change:function(j,i){var h=b(i.placeholder);var g=h.closest("ul");hsz=g.children(".form-edit-format-edit-cell:last").outerHeight({margin:true});h.height(hsz-4)},tolerance:"pointer",cursor:"move",opacity:0.8,placeholder:"form-edit-format-sortable-placeholder",connectWith:f,handle:".form-edit-format-edit-sortable-handle",revert:false})},_bindSotableToElementForStretchCell:function(d){var c=this;var e=".row-separetor";c._bindSotableToElement(d,e)},_onSortableFormatEditTableUpdate:function(g,h){var e=this;var i=b(g.target);var c=h.item;var d=i.closest(".form-edit-format-edit-row");if(i.get(0)==c.parent().get(0)){if(i.hasClass("row-separetor")){var f=e._buildRowElement();e._setElItemToElRow(f,c);d.before(f);if(c.hasClass("form-cell-stretch_w")){e._bindSotableToElementForStretchCell(f.find(".form-edit-format-edit-sortable_cellbox"));e._setClassForceBreakPartRow(f)}else{e._bindSotableToElement(f.find(".form-edit-format-edit-sortable_cellbox"))}}}if(d.find(".form-edit-format-edit-cell").length==0){if(!d.hasClass("last")){d.remove()}}},_onClickSaveButton:function(){var c=this;var d=c._getRequestForSetSort();desknets.submitform.setDisabled(b("#inputfrm"));desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,success:function(e){c._execSaveCmd()},complete:function(g,e,f){},traditional:true})},_execSaveCmd:function(){var c=this;var d={};d.cmd=c._getFormatSaveCmd();d.tmpno=c._getInputTmpnm();desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,success:function(f,e,g){c.$mjPage.hide().empty();if(!!c._options.onOk){c._options.onOk()}},complete:function(g,e,f){},traditional:true})},_onClickEditFormatButton:function(){var c=this;c._showTabPage("editFormat")},_setEditFormatToScreen:function(f){var d=this;if(!f.item){return}var c=d._getArrayFromObject(f.item);for(var e=0;e<c.length;e++){d._addPartByParamToScreen(c[e])}},_onClickPreViewButton:function(){var c=this;c._showTabPage("preView");c._loadPreView()},_loadPreView:function(){var c=this;var d=c._getRequestForSetSort();desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,success:function(e){c._loadPreViewSub()},complete:function(g,e,f){},traditional:true})},_loadPreViewSub:function(){var c=this;var d=c._geRequestForLoadPreView();desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,success:function(e){c._replacePreView(e)},complete:function(g,e,f){},traditional:true})},_getRequestForSetSort:function(){var c=this;var d={};d.cmd=c._getFormatSetSortCmd();d.tmpno=c._getInputTmpnm();d.values=c._getValuesForSetSort();return d},_getValuesForSetSort:function(){var n=this;var k=[];var e=n.$mjPage.find(".form-edit-format-edit-content");var m=e.children(".form-edit-format-edit-row");for(var g=0;g<m.length;g++){var d=m.eq(g).find(".form-edit-format-edit-part");for(var f=0;f<d.length;f++){var c=d.eq(f).attr("data-id");if(c<0){continue}var l=false;if(f==0){l=true}var h=c+":"+(l?"1":"0");k.push(h)}}return k},_geRequestForLoadPreView:function(){var c=this;var d={};d.cmd=c._getFormatPreviewCmd();d.tmpno=c._getInputTmpnm();d.formType="1";return d},_replacePreView:function(f){var e=b(".form-edit-format-view-content-empty");var c=b(".form-edit-format-view-content");var d=b(".form-edit-format-preview");d.empty();if(f.html&&f.html!=""){d.html(f.html);e.hide();c.show()}else{e.show();c.hide()}},_showTabPage:function(i){var d=this;var g=b(".form-edit-format-main-tab");g.removeClass("on");var f=b(".form-edit-format-edit-pane");var c=b(".form-edit-format-view-pane");var j=d.$mjPage.find(".form-edit-format-hidden-pane");switch(i){case"editFormat":var g=b(".jform-edit-format-tab-edit-format");g=g.parent(".form-edit-format-main-tab");g.addClass("on");d._visiblitiyPartsArea(true);f.show();c.hide();d._showHideList();break;case"preView":var g=b(".jform-edit-format-tab-pre-view");g=g.parent(".form-edit-format-main-tab");g.addClass("on");d._visiblitiyPartsArea(false);var h=b(".form-edit-format-view-content-empty");var e=b(".form-edit-format-view-content");h.hide();e.hide();f.hide();c.show();j.hide();break;default:break}},_visiblitiyPartsArea:function(c){var d=b(".form-edit-format-edit-parts");if(c){d.css("visibility","visible")}else{d.css("visibility","hidden")}},_partInitFlg:{},_onClickAddPartButton:function(e){var d=this;var f=b(e.target);var c=f.attr("data-type");if(c){d.openPartDialog(f,c)}},openPartDialog:function(f,e,g){var d=this;var c=false;if(e=="pulldown"){c=true;e="list"}if(!d._partInitFlg[e]){d._partInitFlg[e]=true;desknets.form.part[e].init(d)}if(e=="list"){if(f.hasClass("form-edit-format-edit-part")){desknets.form.part[e]["isListBox"]=f.hasClass("lb")}else{desknets.form.part[e]["isListBox"]=!c}}if(g){desknets.form.part[e].openByParams(g)}else{desknets.form.part[e].open()}},_onClickEditPartButton:function(e){var d=this;var g=b(e.target);var c=g.attr("data-type");if(c=="list"){desknets.form.part[c]["isListBox"]=g.hasClass("lb")}if(!d._partInitFlg[c]){d._partInitFlg[c]=true;desknets.form.part[c].init(d)}var i=g.attr("data-id");var h={};var f=d._getFormatPartCmd();h.cmd=f;h.id=i;h.tmpno=this._getInputTmpnm();h.ptype=d._getPTypeByDataType(c);desknets.ajax.rest({url:desknets.getUrl(d._getRestModule()),data:h,success:function(k,j,l){k.id=i;desknets.form.part[c].openByParams(k)},complete:function(l,j,k){},traditional:true})},replacePartByParam:function(e){var c=this;var d=c._getFormatPartEntryCmd();e.cmd=d;e.tmpno=this._getInputTmpnm();desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:e,success:function(g,f,h){c._addParamByResponse(e,g);c._replacePartByParamToScreen(e,g.id);c._closePartDialogByParam(e)},complete:function(h,f,g){},traditional:true})},_addParamByResponse:function(e,d){var c=this;if(e.ptype=="10"&&d.attach){e.attach=d.attach}},_replacePartByParamToScreen:function(h,e){var d=this;var g=h.id;var c=d._getItemElement(h);h.id=e;var f=d._buildItemElement(h);if(h.partshide){if(g!=h.id){if(h.partshide=="1"){d._delPartItemByElement(c);f.find(".form-edit-format-edit-sortable-handle").remove();d._addRowToHideList(f)}else{c=d._getHideItemElement(g);d._delPartHideItemByElement(c);d._addPartByParamToScreen(h)}}else{if(h.partshide=="1"){c=d._getHideItemElement(g);f.find(".form-edit-format-edit-sortable-handle").remove();c.replaceWith(f)}else{d._replacePartAdjustRow(h,c,f)}}}else{d._replacePartAdjustRow(h,c,f)}},_getItemElement:function(g){var d=this;var h=g.id;var e=b(".form-edit-format-edit-content");var f=e.find(".form-edit-format-edit-cell a[data-id="+h+"]");var c=f.parent(".form-edit-format-edit-cell");return c},_getHideItemElement:function(g){var d=this;var e=b(".form-edit-format-hidden-pane-content");var f=e.find(".form-edit-format-edit-cell a[data-id="+g+"]");var c=f.parent(".form-edit-format-edit-cell");return c},_replacePartAdjustRow:function(d,n,k){var o=this;var m=n.closest(".form-edit-format-edit-row");var c=n.hasClass("form-cell-stretch_w");var j=k.hasClass("form-cell-stretch_w");var e=false;if((c&&!j)||(!c&&j)){e=true}if(j==false){n.replaceWith(k);if(e){o._setBackClassForceBreakPartRow(m);m.find(".form-edit-format-edit-sortable_cellbox").sortable("option","connectWith",".form-edit-format-edit-sortable_cellbox")}return}var h=n.prevAll(".form-edit-format-edit-cell");var l=n.nextAll(".form-edit-format-edit-cell");if(h.length==0&&l.length==0){n.replaceWith(k);o._setClassForceBreakPartRow(m);if(e){m.find(".jform-force_br").sortable("option","connectWith",".row-separetor")}return}if(l.length>0){var g=o._buildRowElement();for(var f=0;f<l.length;f++){o._setElItemToElRow(g,l[f])}m.after(g);o._bindSotableToElement(g.find(".form-edit-format-edit-sortable_cellbox"))}if(h.length>0){n.remove();var g=o._buildRowElement();o._setElItemToElRow(g,k);m.after(g);o._bindSotableToElementForStretchCell(g.find(".form-edit-format-edit-sortable_cellbox"));o._setClassForceBreakPartRow(g)}else{n.replaceWith(k);o._setClassForceBreakPartRow(m);if(e){m.find(".jform-force_br").sortable("option","connectWith",".row-separetor")}}},_setClassForceBreakPartRow:function(c){var d=c.find(".row-items");d.removeClass("form-edit-format-edit-sortable_cellbox").addClass("jform-force_br")},_setBackClassForceBreakPartRow:function(c){var d=c.find(".row-items");d.removeClass("jform-force_br").addClass("form-edit-format-edit-sortable_cellbox")},addPartByParam:function(f,e){var c=this;var d=c._getFormatPartEntryCmd();f.cmd=d;f.tmpno=this._getInputTmpnm();desknets.submitform.setDialogDisabled(e);desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:f,success:function(h,g,i){f.id=h.id;c._addParamByResponse(f,h);c._addPartByParamToScreen(f);c._closePartDialogByParam(f)},complete:function(i,g,h){desknets.submitform.clearDialogDisabled(e)},traditional:true})},_closePartDialogByParam:function(e){var c=this;var d=c._getDataTypeByParams(e);desknets.form.part[d].close()},_addPartByParamToScreen:function(h){var f=this;if(h.partshide&&h.partshide=="1"){var e=f._buildItemElement(h);e.find(".form-edit-format-edit-sortable-handle").remove();f._addRowToHideList(e);return}var e=f._buildItemElement(h);var d=e.hasClass("form-cell-stretch_w");var g=f.$mjPage.find(".form-edit-format-edit-content");if(h.br=="0"&&d==false&&g.children(".form-edit-format-edit-row.last").prev().length>0){var c=g.children(".form-edit-format-edit-row.last").prev();f._setElItemToElRow(c,e)}else{var c=f._buildRowElement();f._setElItemToElRow(c,e);f._addRowToScreen(c);if(d){f._bindSotableToElementForStretchCell(c.find(".form-edit-format-edit-sortable_cellbox"));f._setClassForceBreakPartRow(c)}else{f._bindSotableToElement(c.find(".form-edit-format-edit-sortable_cellbox"))}}},_addRowToScreen:function(c){var d=this;var g=d.$mjPage.find(".form-edit-format-edit-content");var e=g.children(".form-edit-format-edit-row.last");e.before(c);var f=d.$mjPage.find(".form-edit-format-edit-content-empty");f.removeClass("on");g.addClass("on")},_addRowToHideList:function(d){var c=this;var e=c.$mjPage.find(".form-edit-format-hidden-pane");var f=e.find(".form-edit-format-edit-cellbox");f.append(d);e.show()},_setElItemToElRow:function(c,e){var d=this;c.find("ul").eq(1).append(e);return c},_buildRowElement:function(){var d=this;var c=b('<div class="form-edit-format-edit-row"><ul class="form-edit-format-edit-sortable_cellbox row-separetor"></ul><ul class="form-edit-format-edit-sortable_cellbox row-items"></ul></div>');return c},_buildItemElement:function(j){var f=this;if(j.ptype=="9"){if(j.seltype=="1"){desknets.form.part.list["isListBox"]=true}else{desknets.form.part.list["isListBox"]=false}}var i=desknets.Resource.form.part_edit;var h=f._getTypeClassByParam(j);var e;var g=j.ptype;switch(g){case"1":e=f._buildItemElementShowRow(j);break;case"2":e=f._buildItemElementShowRows(j);break;case"3":e=f._buildItemElementInputRow(j);break;case"4":e=f._buildItemElementInputRows(j);break;case"5":e=f._buildItemElementNum(j);break;case"6":e=f._buildItemElementDate(j);break;case"7":e=f._buildItemElementCheckBox(j);break;case"8":e=f._buildItemElementRadio(j);break;case"9":e=f._buildItemElementList(j);break;case"10":e=f._buildItemElementAttach(j);break;case"11":e=f._buildItemElementAutoCal(j);break;case"13":e=f._buildItemElementHorizon(j);break;default:break}e.addClass("form-edit-format-edit-cell");e.addClass("form-format-preview");e.prepend('<a href="#" class="form-edit-format-edit-part"></a>');e.prepend('<span class="form-edit-format-edit-cell-del-btn" title="'+desknets.Resource.form.part_del+'"></span>');e.prepend('<span class="form-edit-format-edit-sortable-handle"></span>');var d=e.find("a.form-edit-format-edit-part");d.attr("title",i);d.text(i);d.addClass(h);var c=f._getDataTypeByParams(j);d.attr("data-type",c);d.attr("data-id",j.id);return e},_buildItemElementShowRow:function(e){var d=this;var c;c=b('<li><div class="form-edit-format-edit-cell-view"><font>'+desknets.tmpl.escapeWord(e.Name)+"</font></div></li>");d._buildItemElementShowStyle(e,c);return c},_buildItemElementShowRows:function(j){var e=this;var d;d=b('<li><div class="form-edit-format-edit-cell-view"><font></font></div></li>');var h=j.Name.replace(/\r\n/g,"\n");h=h.replace(/\r/g,"\n");var c=h.split("\n");var g=d.find("font");for(var f=0;f<c.length;f++){if(f>0){g.append("<br />")}g.append(document.createTextNode(c[f]))}e._buildItemElementShowStyle(j,d);return d},_buildItemElementShowStyle:function(f,d){var c=d.find("div");var e=c.find("font");if(f.fcolor){e.attr("color",f.fcolor)}if(f.fsize){e.attr("size",f.fsize)}if(f.bold&&f.bold=="1"){e.wrapInner("<b />")}if(f.italic&&f.italic=="1"){e.wrapInner("<i />")}if(f.underline&&f.underline=="1"){e.wrapInner("<u />")}if(f.arrange&&f.arrange=="center"){c.css("text-align","center");d.addClass("form-cell-stretch_w")}else{if(f.arrange&&f.arrange=="right"){c.css("text-align","right");d.addClass("form-cell-stretch_w")}}},_buildItemElementInputRow:function(g){var d=this;var c;c=b('<li><div class="form-edit-format-edit-cell-view"><font></font><input type="text" readonly class="input-focus" size="3" maxlength="127" value="" name=""></div></li>');var e=c.find("font");if(g.namehide=="0"){e.text(g.Name)}if(g.hissuchk=="1"){e.after(d._HTML_MUST_MARK)}e=c.find("input");var f=g.preval;e.val(f);e.attr("size",g.maxlen);return c},_buildItemElementInputRows:function(g){var d=this;var c;c=b('<li><div class="form-edit-format-edit-cell-view"><font></font><textarea readonly class="input-focus" /></div></li>');var e=c.find("font");if(g.namehide=="0"){e.text(g.Name)}if(e.text().length>0||g.hissuchk=="1"){e.after("<br />")}if(g.hissuchk=="1"){e.after(d._HTML_MUST_MARK)}e=c.find("textarea");var f=g.preval;e.val(f);e.attr("rows",g.rows);e.attr("cols",g.maxlen);return c},_buildItemElementNum:function(h){var e=this;var d;d=b('<li><div class="form-edit-format-edit-cell-view"><font></font><input type="text" readonly class="input-focus" size="3" maxlength="127" value="" name=""></div></li>');var f=d.find("font");if(h.namehide=="0"){f.text(h.Name)}if(h.hissuchk=="1"){f.after(e._HTML_MUST_MARK)}f=d.find("input");if(h.unit!=""){var c=b("<span />");c.text(h.unit);if(h.unitarrange=="left"){f.before(c)}else{f.after(c)}}var g=h.preval;d.find("input").val(g);return d},_buildItemElementDate:function(f){var d=this;var c;c=b('<li><div class="form-edit-format-edit-cell-view"><font></font><input readonly type="text" class="co-datepicker" value="" /></div></li>');var e=c.find("font");if(f.namehide=="0"){e.text(f.Name)}if(f.hissuchk=="1"){e.after(d._HTML_MUST_MARK)}switch(f.prevaltype){case"0":c.find("input").val(f.date);break;case"1":c.find("input").val(desknets.Resource.form.datePrevalToday);break;default:break}return c},_buildItemElementCheckBox:function(h){var e=this;var d;d=b('<li><div class="form-edit-format-edit-cell-view"><font></font><input type="checkbox" /></div></li>');var f=d.find("font");if(h.namehide=="0"){f.text(h.Name)}var f=d.find("input");if(h.selval!=""){var c=b("<span />");c.text(h.selval);f.after(c)}var g=h.preval;f.attr("checked",(!!g?true:false));f.click(function(i){i.preventDefault()});return d},_buildItemElementRadio:function(f){var o=this;var m;m=b('<li><div class="form-edit-format-edit-cell-view"><font></font></div></li>');var d=m.find("font");if(f.namehide=="0"){d.text(f.Name)}var g=b("<span />");d.after(g);var c="r"+f.id;var j=(f.selval.list?o._getArrayFromObject(f.selval.list.item):f.selval);for(var h=0;h<j.length;h++){var l=j[h]["value"]||j[h];var n=b('<input type="radio" value="" name="" />');n.attr("value",l);n.attr("name",c);g.append(n);var k=b("<span />");k.text(l);g.append(k)}var e=g.find('[name="'+c+'"]');if(f.hissuchk=="1"){d.after(o._HTML_MUST_MARK)}if(f.preval!=""){var l=f.preval;e.filter('[value="'+l+'"]').attr("checked",true)}e.click(function(i){i.preventDefault()});return m},_buildItemElementList:function(e){var l=this;var k;k=b('<li><div class="form-edit-format-edit-cell-view"><font></font></div></li>');var d=k.find("font");if(e.namehide=="0"){d.text(e.Name)}var f=b('<select class="form-edit-format-part-sel" />');d.after(f);var h=(e.selval.list?l._getArrayFromObject(e.selval.list.item):e.selval);for(var g=0;g<h.length;g++){var j=h[g]["value"]||h[g];var c=b("<option />");c.attr("value",j);c.text(j);f.append(c)}if(e.seltype=="1"&&e.rows!=""){f.attr("size",e.rows)}if((d.text().length>0||e.hissuchk=="1")&&(e.seltype=="1"&&parseInt(e.rows)>1)){d.after("<br />")}if(e.hissuchk=="1"){d.after(l._HTML_MUST_MARK)}if(e.preval!=""){var j=e.preval;f.val(j)}f.change(function(i){f.val(e.preval)});return k},_buildItemElementAttach:function(i){var e=this;var d;d=b('<li><div class="form-edit-format-edit-cell-view"><font></font></div></li>');var h=d.find("font");if(i.namehide=="0"){h.text(i.Name)}var c=b("<div />");h.after(c);var f=b('<button type="button" />');f.text(desknets.Resource.selectLabel);h.after(f);var g=e._buildItemElementAttachList(i);c.html(g);if(i.hissuchk=="1"){h.after(e._HTML_MUST_MARK)}return d},_buildItemElementAttachList:function(g){var o=this;if(!g.attach||!g.attach.item){return desknets.Resource.form.no_filelist}var j=desknets.ajax.getItems(g.attach.item);var h=j.length;if(h==0){return desknets.Resource.form.no_filelist}var e=desknets.getUrl(o._getModule());var c={};c.cmd=o.getFormatDownloadAttachCmd();c.tmpno=o._getInputTmpnm();c.id=g.id;var k=desknets.paramanalyzer.joinParam(c);var i="";var m;for(m=0;m<h;m++){var n="",d,p="";var l=j[m];var f=desknets.tmpl.escapeWord(l.attachdisp);if(l.size){p=desknets.attachDisp.getSize(l.size)}else{p=desknets.Resource.attachInvSize}d=e+"?"+k+"&fno="+l.id+"&filename="+f;n=n+'<tr><td><a target="attach" href="'+d+'">'+f+'</a></td><td class="co-td-num form-td-att-size">'+p+"</td></tr>";i=i+n}if(m>0){i='<table class="co-selfile"><tbody>'+i+"</tbody></table>"}return i},_buildItemElementAutoCal:function(g){var e=this;var d;d=b('<li><div class="form-edit-format-edit-cell-view"><font></font></div></li>');var f=d.find("font");if(g.namehide=="0"||g.partshide=="1"){f.text(g.Name)}f=d.find("font");if(g.unit!=""){var c=b("<span />");c.text(g.unit);f.after(c)}var h=g.id;if(g.partshide=="1"){g.id="-"+Math.abs(h)}else{g.id=""+Math.abs(h)}return d},_buildItemElementHorizon:function(g){var d=this;var c;c=b('<li class="form-cell-stretch_w"><div class="form-edit-format-edit-cell-view"><hr style="height: 1px;" /></div></li>');var e=c.find("hr");if(g.linetype){var f=g.linetype;switch(f){case"0":f="solid";break;case"1":f="dotted";break;case"2":f="dashed";break}e.css("border-style",f)}if(g.linesize){var f=g.linesize;e.css("border-width",""+f+"px 0px 0px 0px")}if(g.fcolor){e.css("border-color",g.fcolor)}return c},_getTilteByParam:function(g){var c=this;var e="";var d=g.ptype;var f={"1":desknets.Resource.form.partname_showrow,"2":desknets.Resource.form.partname_showrows,"3":desknets.Resource.form.partname_inputrow,"4":desknets.Resource.form.partname_inputrows,"5":desknets.Resource.form.partname_num,"6":desknets.Resource.form.partname_date,"7":desknets.Resource.form.partname_checkbox,"8":desknets.Resource.form.partname_radiobutton,"9":desknets.Resource.form.partname_list,"10":desknets.Resource.form.partname_attach,"11":desknets.Resource.form.partname_autocal,"13":desknets.Resource.form.partname_horizon};var e=f[d];return e},_getTypeClassByParam:function(g){var c=this;var e="";var d=g.ptype;var f={"1":"ts","2":"tm","3":"is","4":"im","5":"nm","6":"dt","7":"cb","8":"rb","9":"pd","10":"fl","11":"cl","13":"hr"};if(d=="9"){if(desknets.form.part.list["isListBox"]){return"lb"}}var e=f[d];return e},_getDataTypeByParams:function(g){var c=this;var e="";var d=g.ptype;var f={"1":"showrow","2":"showrows","3":"inputrow","4":"inputrows","5":"num","6":"date","7":"checkbox","8":"radiobutton","9":"list","10":"attach","11":"autocal","13":"horizon"};var e=f[d];return e},_getPTypeByDataType:function(d){var c=this;if(d=="pulldown"){d="list"}var f={"1":"showrow","2":"showrows","3":"inputrow","4":"inputrows","5":"num","6":"date","7":"checkbox","8":"radiobutton","9":"list","10":"attach","11":"autocal","13":"horizon"};var e="";b.each(f,function(g,h){if(h==d){e=g}});return e},_getArrayFromObject:function(d){var c=[];if(d){if(b.isArray(d)){b.each(d,function(e,f){c.push(f)})}else{c.push(d)}}else{c=[]}return c},_inputAjaxForm:function(){var c=this;var d={};d=c._inputAjaxFormOption();c._initFormRequestAjax(c._mIdPageForm,d)},getLocationFormParam:function(){var c=this;var d={};d=desknets.getInputDataToObj(b("#"+c._mIdListPage).find(".jco-back-page-data"));d.cmd=c._mCmdListPage;if(neo.isSet(d._)){d._=desknets.createRandomId()}return d},_getIdPageForm:function(){return"editformatfrm"},_getRestModule:function(){return""},_getFormatSaveCmd:function(){return""},_getFormatEntryPageCmd:function(){return""},_getFormatPreviewCmd:function(){return""},_getFormatCopyTempCmd:function(){return""},_getFormatSetSortCmd:function(){return""},_getEditExecCmd:function(){return""},_getFormatPartCmd:function(){return""},_getFormatPartEntryCmd:function(){return""},_getFormatPartDelCmd:function(){return""},getFormatNumListCmd:function(){return""},getFormatUploadAttachCmd:function(){return""},getFormatUploadAttachSizeLimit:function(){return this.$mjPage.find(":hidden[name=attach-totalSizeLimit]").val()},getFormatDelAttachCmd:function(){return""},getFormatDownloadTempAttachCmd:function(){return""},getFormatDownloadAttachCmd:function(){return""},_getAttExtListCmd:function(c){return c},"":{}})})(jQuery);(function(b){desknets.page(desknets.form,"ImpHelpDialog",null,{_dialogId:"form-imp-help-dialog",$dialog:null,_loadedTemplate:{},open:function(f){var c=this;if(this.$dialog==null){var d=this._getDialogOptions();c.$dialog=desknets.dialog.make(c._dialogId,d)}var e=c._getTilteById(f);c.$dialog.dialog("option","title",e);c._openDialog(f);return c.$dialog},_openDialog:function(f){var c=this;var e=c._loadedTemplate[f];if(e){c.$dialog.empty().html(e||"<BR>");c.$dialog.dialog("open");c.$dialog.find(".co-table-list-scroll").scrollTop(0)}else{var d=c._getTemplateById(f);var e="form/"+d;$elem=b("<div />");desknets.tmpl.load($elem,e,function(){c._loadedTemplate[f]=$elem;c.$dialog.empty().html($elem||"<BR>");c.$dialog.dialog("open");desknets.htmlparts.addStripeClass(c.$dialog.find(".co-table-list").find("tbody"),"co-tr-even");c.$dialog.find(".co-table-list-scroll").scrollTop(0)})}},_getDialogOptions:function(){var d={};d[desknets.Resource.CloseButtonLabel]=function(){b(this).dialog("close")};var c={dialogClass:"dn-dialog",modal:true,resizable:false,draggable:true,buttons:d,width:"700",height:"575"};return c},_getTilteById:function(f){var c=this;var e={"1":desknets.Resource.form.partname_showrow,"2":desknets.Resource.form.partname_showrows,"3":desknets.Resource.form.partname_inputrow,"4":desknets.Resource.form.partname_inputrows,"5":desknets.Resource.form.partname_num,"6":desknets.Resource.form.partname_date,"7":desknets.Resource.form.partname_checkbox,"8":desknets.Resource.form.partname_radiobutton,"9":desknets.Resource.form.partname_list,"10":desknets.Resource.form.partname_attach,"11":desknets.Resource.form.partname_autocalnormal,"12":desknets.Resource.form.partname_autocalsum,"13":desknets.Resource.form.partname_horizon,s1:desknets.Resource.form.title_sample1,s2:desknets.Resource.form.title_sample2,s3:desknets.Resource.form.title_sample3,s4:desknets.Resource.form.title_sample4};var d=e[f];return d},_getTemplateById:function(f){var c=this;var e={"1":"form.imp.help.showrow.html","2":"form.imp.help.showrows.html","3":"form.imp.help.inputrow.html","4":"form.imp.help.inputrows.html","5":"form.imp.help.num.html","6":"form.imp.help.date.html","7":"form.imp.help.checkbox.html","8":"form.imp.help.radiobutton.html","9":"form.imp.help.list.html","10":"form.imp.help.attach.html","11":"form.imp.help.autocalnormal.html","12":"form.imp.help.autocalsum.html","13":"form.imp.help.horizon.html",s1:"form.imp.help.sample1.html",s2:"form.imp.help.sample2.html",s3:"form.imp.help.sample3.html",s4:"form.imp.help.sample4.html"};var d=e[f];return d},banpei:null})})(jQuery);desknets.form.part={_parts:{},_tmpls:null,loadPartsTemplate:function(b,d){var c=this;desknets.tmpl.load(b,"form/form.part.html",function(){var e=b.find("script").remove();if(!c._tmpls){c._tmpls={};e.each(function(){var f=this.getAttribute("data-type");c._tmpls["_"+f]=a(this).html()})}d()},{cache:true})},getPartTemplate:function(b){return this._tmpls["_"+b]||""},getItem:function(b){return this._parts["part"+b]||this._base},replaceFormLabel:function(d,c,e){var b=!!e.Name&&Number(e.namehide)<=0?e.Name:"";return desknets.tmpl.replaceWord(d,c,b)},replaceFormLabelClass:function(c,b,e){var d="";if(!e.Name||Number(e.namehide)>0){d="form-empty-label"}return desknets.tmpl.replaceWordHtml(c,b,d)},replaceFormLabelHissuchk:function(e,d,f){var c="";if(Number(f.hissuchk)>0){var b="";if(!!f.Name&&Number(f.namehide)==0){b="&nbsp;"}c=b+'<font size="2" color="#FF0000">*</font>'}return desknets.tmpl.replaceWordHtml(e,d,c)}};desknets.form.FormEditor=function(c,b){this.init(c,b);return this};desknets.form._formEditorInst={_$root:a(),_$rowList:a(),_options:null,bModify:false,init:function(d,c){var b=this;b._$root=d.addClass("form-format-editor");b._options=a.extend({},c);b._initElement()},getParts:function(){var b=[];this._$rowList.find(".form-format-row-part").each(function(){var d=a(this);var c=a.extend({},d.data("params"));c.br=d.prev().hasClass("form-format-row-part")?"0":"1";b.push(c)});return b},_initElement:function(){var b=this;var e=document.createDocumentFragment();var d=document.createElement("DIV"),c;e.appendChild(d);c=a(d).addClass("form-format-editor-inner");desknets.form.part.loadPartsTemplate(c,function(){b._initSide(c.children(".form-format-editor-menu"));b._initMain(c.children(".form-format-editor-main"));b._$root.append(e);b._$rowList=c.find(".jflow-route-row-list");if(typeof b._options.load=="function"){setTimeout(b._options.load,0)}})},_initSide:function(b){var c=b.children();c.neoFollowScroll({offsetTop:24,cacheContainerTop:false,cacheContainerHeight:false});c.children().each(function(){a(this).draggable({handle:".form-part-handle",cursor:"move",helper:"clone",connectToSortable:".jform-part-container"})})},_initMain:function(c){var b=this;c.on("click",".form-part-remove",function(d){d.preventDefault();b._onClickRemoveButton(a(this).closest(".form-format-part"))});c.on("click",".form-part-modify",function(d){d.preventDefault();b._onClickModifyButton(a(this).closest(".form-format-part"))});this._createParts(c,this._options.parts)},_createParts:function(e,d){var c=this,b=a();var f=e.children(".jflow-route-row-list");a.each(d,function(g,j){var h=desknets.form.part.getItem(j.ptype);if(b.length<=0||Number(j.br)>0){b=c._insertRow(f)}b.append(h.createElementForEdit(j,c._options));c._updateRowSettings(b)});this._insertInsertTarget(f);this._onUpdateRow(f)},_onDropPartFromMenuToRow:function(d){var c=this;var b=d.parent();var e=d.next(".form-format-row-part");this._openEditorDialog(d,function(g,h){var f=g.createElementForEdit(h,c._options);c._insertItem(b,f,e)});d.remove()},_onDropPartFromRowToRow:function(c,b){this._removeRowIfEmpty(c);this._splitRowWithBlockPart(b)},_onDropPartFromMenuToInsertTarget:function(d){var c=this,b=d.parent();this._openEditorDialog(d,function(f,g){var e=c._insertRow(c._$rowList,b);e.append(f.createElementForEdit(g,c._options));c._updateRowSettings(e)});d.remove()},_onDropPartFromRowToInsertTarget:function(e,d){var c=d.parent();var b=this._insertRow(this._$rowList,c);b.append(d);this._removeRowIfEmpty(e)},_onClickModifyButton:function(c){var b=this;b.bModify=true;this._openEditorDialog(c,function(d,e){d.updateElementForEdit(c,e,b._options);b._splitRowWithBlockPart(c.parent())})},_onClickRemoveButton:function(d){var c=this,b=d.parent();var e=desknets.form.part.getItem(d.data("type"));e.removePart(d,{url:this._options.restUrl,params:this._options.paramsForRemove,success:function(){c._removeRowIfEmpty(b)}})},_openEditorDialog:function(b,c){var d=desknets.form.part.getItem(b.data("type"));var e=a.extend({},b.data("params"));d.openEditorDialog(e,{url:this._options.restUrl,params:this._options.paramsForSave,paramsForOpen:this._options.paramsForOpen,attachOptions:this._options.attachOptions,editor:this,title:this.bModify?desknets.Resource.form.part_edit:desknets.Resource.form.partDialogTitle,save:function(f){c(d,f)}});if(neo.isSet(d.$root)){if(this.bModify==true){d.$root.parent("div").find(".ui-dialog-title").text(desknets.Resource.form.part_edit)}else{d.$root.parent("div").find(".ui-dialog-title").text(desknets.Resource.form.partDialogTitle)}}this.bModify=false},_insertRow:function(h,f){var c=this,b=a("<div />");this._insertInsertTarget(h,f);this._insertItem(h,b,f);b.addClass("form-row jform-part-container");var e=a(window);var d=1000;var g=30;var i=10;b.sortable({handle:".form-part-handle",connectWith:".jform-part-container",placeholder:"form-format-row-placeholder",tolerance:"pointer",update:function(j,k){if(k.item.hasClass("form-format-box-part")){c._onDropPartFromMenuToRow(k.item)}},receive:function(j,k){if(k.item.hasClass("form-format-row-part")){c._onDropPartFromRowToRow(k.sender,a(this))}},start:function(j,k){d=e.height()-g},sort:function(j,k){if(j.clientY<g){e.scrollTop(e.scrollTop()-i)}if(j.clientY>d){e.scrollTop(e.scrollTop()+i)}}});this._onUpdateRow(this._$rowList);return b},_insertInsertTarget:function(e,d){var c=this,b=a("<div />");this._insertItem(e,b,d);b.addClass("form-insert-target jform-part-container");b.sortable({placeholder:"form-format-row-placeholder",tolerance:"pointer",activate:function(f,g){c._$rowList.parent().addClass("active")},deactivate:function(f,g){c._$rowList.parent().removeClass("active")},update:function(f,g){if(g.item.hasClass("form-format-box-part")){c._onDropPartFromMenuToInsertTarget(g.item)}},receive:function(f,g){if(g.item.hasClass("form-format-row-part")){c._onDropPartFromRowToInsertTarget(g.sender,g.item)}}});return b},_insertItem:function(d,b,c){if(!c||c.length<=0){b.appendTo(d)}else{b.insertBefore(c)}this._splitRowWithBlockPart(b.parent())},_removeRowIfEmpty:function(b){if(b.children().length<=0){this._removeInsertTarget(b.prev());this._removeRow(b);this._onUpdateRow(this._$rowList)}},_removeRow:function(b){b.sortable("destroy").remove()},_removeInsertTarget:function(b){b.droppable("destroy").remove()},_onUpdateRow:function(b){if(b.children(".form-row").length<=0){b.parent().addClass("empty")}else{b.parent().removeClass("empty")}},_splitRowWithBlockPart:function(b){var d=b.children(".form-format-block-part").eq(0);if(d.length>0){var f,e=b.parent(),g=b.children();var c=d.prevAll().length;if(c>0){f=this._insertRow(e,b.prev());f.append(g.slice(0,c))}if(c<g.length-1){f=this._insertRow(e,b.next());f.append(g.slice(c+1));this._splitRowWithBlockPart(f)}}this._updateRowSettings(b)},_updateRowSettings:function(b){var c=b.children(".form-format-block-part").length;if(c>0&&b.hasClass("jform-part-container")){b.removeClass("jform-part-container").addClass("jform-part-container-block")}else{if(c<=0&&b.hasClass("jform-part-container-block")){b.removeClass("jform-part-container-block").addClass("jform-part-container")}}}};desknets.form.FormEditor.prototype=desknets.form._formEditorInst;desknets.page(desknets.form.part,"_base",null,{id:"base",partNo:0,$root:null,openEditorDialog:function(d,c){var b=this;if(this.$root==null){this._createEditorDialog(function(){b._showEditorDialog(d,c)},neo.isSet(c.title,{blank:false})?c.title:null)}else{this._showEditorDialog(d,c)}},removePart:function(b,c){var d=b.data("params");var e=!!d&&!!d.id?d.id:0;this._requestForRemove(e,c,function(){b.remove();if(typeof c.success=="function"){c.success()}})},createElementForEdit:function(d,c){var b=a("<div />");b.addClass("form-format-part form-format-row-part "+this.getIconClass(d));b.data("type",this.partNo).html(desknets.form.part.getPartTemplate(0));this.updateElementForEdit(b,d,c);return b},updateElementForEdit:function(b,e,c){var d=desknets.form.part.getPartTemplate(this.partNo);d=this.createViewHtml(d,e);b.children(".form-part-view").html(d);b.data("params",e);if(!!c){this.updateElementWithOptions(b,c)}},createViewHtml:function(b,c){return b},getIconClass:function(b){return""},setUpEditorDialog:function(){},getEditorDialogOptions:function(){var b={};b[desknets.Resource.OKButtonLabel]=function(){a(this).trigger("choose.fromPart")};b[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};return{title:desknets.Resource.form.partDialogTitle,buttons:b,width:500}},setEditorDialogValues:function(d,c){var b=this.$root.find("form");if(b.length>0){b[0].reset()}this.$root.data("id",d.id);neo.form.setFormValues(b,d)},getEditorDialogValues:function(){var c={ptype:String(this.partNo)};var d=this.$root.data("id");if(!!d){c.id=d}var b=this.$root.find("form").serializeArray();a.each(b,function(e,f){c[f.name]=f.value});return c},getSaveRequestExtraParams:function(b){return b},updateElementWithOptions:function(b,c){},_createEditorDialog:function(f,b){var c=this;var d=this.getEditorDialogOptions();if(neo.isSet(b,{blank:false})){a.extend(d,{title:b})}var e=desknets.dialog.make("form-entry-part-"+this.id,d);desknets.tmpl.load(e,"form/form.part."+this.id+".html",function(){c.$root=e;c.setUpEditorDialog();f()})},_showEditorDialog:function(d,c){var b=this;this.$root.off("choose.fromPart");this.$root.on("choose.fromPart",function(){b._onSave(d.id,c)});this.setEditorDialogValues(d,c);this.$root.dialog("open")},_onSave:function(e,c){var b=this,d=this.getEditorDialogValues();this._requestForSave(e,c,function(f){b._updateParamsWithResponse(d,f);if(typeof c.save=="function"){c.save(d)}b.$root.dialog("close")})},_updateParamsWithResponse:function(d,b){var c=a(b);a.each(["id","partskey"],function(g,f){var e=c.find(f);if(e.length>0){d[f]=e.text()}})},_requestForSave:function(f,c,e){var b=this.$root.find("form");var d=!!f?{id:f}:{};d.ptype=this.partNo;d.resformat="xml";a.extend(d,c.params);d=this.getSaveRequestExtraParams(d);b.ajaxFormUnbind();desknets.ajax.submitForm(b,{url:c.url,data:d,dataType:"xml",success:e,error:function(j,h,l){var g="";var i="";var k=desknets.parseErrorInfo(l,j.status);if(k.level!="error"){i=a(j.responseXML).find("errmsgadd").text();g=desknets.getErrFieName(b,i)}var l=g+k.message;desknets.dialog.alert(l,{type:k.level})}});b.submit()},_requestForRemove:function(e,c,d){var b=a.extend({},c.params);b.id=e;b.ptype=this.partNo;desknets.ajax.rest({url:c.url,data:b,success:d})}});desknets.page(desknets.form.part,"_baseText",desknets.form.part._base,{createViewHtml:function(b,e){var d=desknets.tmpl.escapeWordLF(e.Name||"");var c=Number(e.fsize);if(0<c&&c<=7){d='<font size="'+c+'">'+d+"</font>"}b=desknets.tmpl.replaceWordHtml(b,"style",this._getStyleText(e));return desknets.tmpl.replaceWordHtml(b,"text",d)},_getStyleText:function(d){var b=[],c;c=Number(d.bold)>0;if(c){b.push("font-weight:bold")}c=Number(d.italic)>0;if(c){b.push("font-style:italic")}c=Number(d.underline)>0;if(c){b.push("text-decoration:underline")}c=d.arrange||"left";if(c=="center"||c=="right"){b.push("text-align:"+c)}c=d.fcolor||"";if(!!c&&c!="#000000"){b.push("color:"+d.fcolor)}return b.join(";")},updateElementWithOptions:function(b,c){var d=b.data("params");if(d.arrange=="center"||d.arrange=="right"){b.addClass("form-format-block-part")}else{b.removeClass("form-format-block-part")}}});desknets.page(desknets.form.part._parts,"part2",desknets.form.part._baseText,{id:"showrows",partNo:2,getIconClass:function(b){return"tm"}});desknets.page(desknets.form.part._parts,"part1",desknets.form.part._baseText,{id:"showrow",partNo:1,getIconClass:function(b){return"ts"}});desknets.page(desknets.form.part._parts,"part3",desknets.form.part._base,{id:"inputrow",partNo:3,createViewHtml:function(b,c){b=desknets.form.part.replaceFormLabelClass(b,"labelClasses",c);b=desknets.form.part.replaceFormLabelHissuchk(b,"hissuchk",c);b=desknets.form.part.replaceFormLabel(b,"label",c);b=desknets.tmpl.replaceWord(b,"value",c.preval||"");return desknets.tmpl.replaceWordHtml(b,"size",c.maxlen||"")},getIconClass:function(b){return"is"}});desknets.page(desknets.form.part._parts,"part4",desknets.form.part._base,{id:"inputrows",partNo:4,createViewHtml:function(b,c){b=desknets.form.part.replaceFormLabelClass(b,"labelClasses",c);b=desknets.form.part.replaceFormLabelHissuchk(b,"hissuchk",c);b=desknets.form.part.replaceFormLabel(b,"label",c);b=desknets.tmpl.replaceWord(b,"value",c.preval||"");b=desknets.tmpl.replaceWordHtml(b,"cols",c.maxlen||"");return desknets.tmpl.replaceWordHtml(b,"rows",c.rows||"")},getIconClass:function(b){return"im"}});desknets.page(desknets.form.part._parts,"part7",desknets.form.part._base,{id:"checkbox",partNo:7,setEditorDialogValues:function(d,b){var c="";if(d.preval!=""){c="1"}d.preval=c;this.callBase("setEditorDialogValues",d,b)},createViewHtml:function(b,d){var c="";if(d.preval!=""){c='checked="checked"'}b=desknets.form.part.replaceFormLabelClass(b,"labelClasses",d);b=desknets.form.part.replaceFormLabelHissuchk(b,"hissuchk",d);b=desknets.form.part.replaceFormLabel(b,"label",d);b=desknets.tmpl.replaceWord(b,"value",d.selval||"");return desknets.tmpl.replaceWordHtml(b,"checked",c)},getIconClass:function(b){return"cb"}});desknets.page(desknets.form.part,"_baseSelection",desknets.form.part._base,{_$inputNew:a(),_$selection:a(),_$extraSelection:a(),createViewHtml:function(c,f){var b=this,e=[];var d=desknets.form.part.getPartTemplate(this.partNo+".1");a.each(this.getSelections(f),function(g,h){e.push(b.createViewItemHtml(d,h.value,f))});return desknets.tmpl.replaceWordHtml(c,"itemsHtml",e.join(""))},createViewItemHtml:function(b,c,d){return""},setUpEditorDialog:function(){var b=this;this._$inputNew=this.$root.find(".jform-list-new-item");this._$selection=this.$root.find("ul.form-list-selection");this._$extraSelection=this.$root.find("select.form-list-selection");this.$root.find(".jform-list-add-btn").click(function(c){c.preventDefault();b._onAddButtonClicked()});this.$root.find(".jform-list-replace-btn").click(function(c){c.preventDefault();b._onReplaceButtonClicked()});this.$root.find(".jform-list-delete-btn").click(function(c){c.preventDefault();b._onDeleteButtonClicked()});this._$selection.sortable({axis:"y"});this._$selection.on("click","li",function(c){a(this).toggleClass("on")})},getEditorDialogOptions:function(){var b=this.callBase("getEditorDialogOptions");b.width=700;return b},setEditorDialogValues:function(d,c){var b=this;this._clearSelection();a.each(this.getSelections(d),function(e,f){b._addSelection(f.value)});this.callBase("setEditorDialogValues",d,c)},getEditorDialogValues:function(){var b=[];var c=this.callBase("getEditorDialogValues");this._$selection.children().each(function(){b.push({value:this.title})});c.selval={list:{item:b}};return c},getSaveRequestExtraParams:function(c){var b=[];this._$selection.children().each(function(){b.push(this.title)});c.selval=b;return c},getSelections:function(b){return desknets.ajax.getJsonItems(b.selval)},_onAddButtonClicked:function(){var b=this._getLabelToAdd();if(this._canAddToSelection(b)){this._addSelection(b);this._clearLabelToAdd()}},_onReplaceButtonClicked:function(){var b=this._getLabelToAdd();if(this._canAddToSelection(b)){var c=this._$selection.children(".on");this._insertSelection(b,c.eq(0));this._deleteSelections(c);this._clearLabelToAdd()}},_onDeleteButtonClicked:function(){var b=this._$selection.children(".on");this._deleteSelections(b)},_getLabelToAdd:function(){var b=String(this._$inputNew.val());return b.replace(/[\x20\t]+$/,"")},_clearLabelToAdd:function(){this._$inputNew.val("")},_canAddToSelection:function(b){if(b.length<=0){return false}return this._$selection.children().filter(function(){return this.title==b}).length<=0},_addSelection:function(c){var b=this,d=this._createItemElement("LI","title",c);d.appendTo(this._$selection);this._$extraSelection.each(function(){var e=b._createItemElement("OPTION","value",c);e.appendTo(this)})},_insertSelection:function(e,d){var c=this,b=d.attr("title");var f=this._createItemElement("LI","title",e);f.insertBefore(d);this._$extraSelection.each(function(){var h=c._createItemElement("OPTION","value",e);var g=a(this).children().filter(function(){return this.value==b});h.insertBefore(g)})},_deleteSelections:function(c){var b={};c.each(function(){b[this.title]=true});c.remove();this._$extraSelection.children().filter(function(){return !!this.value&&!!b[this.value]}).remove()},_clearSelection:function(){this._$selection.empty();this._$extraSelection.children(":not(.jform-default)").remove()},_createItemElement:function(e,b,c){var d=document.createElement(e);d[b]=c;if(c==""){c=" "}return a(d).html(desknets.tmpl.escapeWord(c))}});desknets.page(desknets.form.part._parts,"part8",desknets.form.part._baseSelection,{id:"radiobutton",partNo:8,createViewHtml:function(b,c){b=this.callBase("createViewHtml",b,c);b=desknets.form.part.replaceFormLabelClass(b,"labelClasses",c);b=desknets.form.part.replaceFormLabelHissuchk(b,"hissuchk",c);return desknets.form.part.replaceFormLabel(b,"label",c)},createViewItemHtml:function(b,d,e){var c=(e.preval==d)?'checked="checked"':"";b=desknets.tmpl.replaceWordHtml(b,"id",e.id||"");b=desknets.tmpl.replaceWordHtml(b,"checked",c);return desknets.tmpl.replaceWord(b,"value",d)},getIconClass:function(b){return"rb"}});desknets.page(desknets.form.part._parts,"part9",desknets.form.part._baseSelection,{id:"list",partNo:9,updateElementForEdit:function(b,c){this.callBase("updateElementForEdit",b,c);b.removeClass("lb pd").addClass(this.getIconClass(c))},createViewHtml:function(c,d){var b=this._isListBox(d)?'size="'+d.rows+'"':"";c=this.callBase("createViewHtml",c,d);c=desknets.form.part.replaceFormLabelClass(c,"labelClasses",d);c=desknets.form.part.replaceFormLabelHissuchk(c,"hissuchk",d);c=desknets.form.part.replaceFormLabel(c,"label",d);return desknets.tmpl.replaceWordHtml(c,"sizeAttr",b)},createViewItemHtml:function(b,d,e){var c=(e.preval==d)?'selected="selected"':"";b=desknets.tmpl.replaceWordHtml(b,"selected",c);return desknets.tmpl.replaceWord(b,"value",d)},getIconClass:function(b){return this._isListBox(b)?"lb":"pd"},setEditorDialogValues:function(c,b){this.callBase("setEditorDialogValues",c,b);this.$root.find(".form-dialog-list-subtitle").removeClass("lb pd").addClass(this.getIconClass(c))},_isListBox:function(b){return Number(b.seltype)>0&&Number(b.rows)>1}});desknets.page(desknets.form.part._parts,"part5",desknets.form.part._base,{id:"num",partNo:5,createViewHtml:function(c,e){var d=e.unit||"";var b=e.unitarrange=="right";c=desknets.form.part.replaceFormLabelClass(c,"labelClasses",e);c=desknets.form.part.replaceFormLabelHissuchk(c,"hissuchk",e);c=desknets.form.part.replaceFormLabel(c,"label",e);c=desknets.tmpl.replaceWord(c,"value",e.preval||"");c=desknets.tmpl.replaceWord(c,"prefix",b?"":d);return desknets.tmpl.replaceWord(c,"postfix",b?d:"")},getIconClass:function(b){return"nm"}});desknets.page(desknets.form.part._parts,"part6",desknets.form.part._base,{id:"date",partNo:6,_$date:a(),createViewHtml:function(b,c){b=desknets.form.part.replaceFormLabelClass(b,"labelClasses",c);b=desknets.form.part.replaceFormLabelHissuchk(b,"hissuchk",c);b=desknets.form.part.replaceFormLabel(b,"label",c);return desknets.tmpl.replaceWord(b,"value",this._getDateValue(c))},getIconClass:function(b){return"dt"},setUpEditorDialog:function(){var b=this;this._$date=this.$root.find("input.co-datepicker").datepicker();this.$root.find("form").on("click",'input[name="yeartype"]',function(){b._updateDateFormat(a(this).val())})},setEditorDialogValues:function(c,b){this._updateDateFormat(c.yeartype);this.callBase("setEditorDialogValues",c,b)},getEditorDialogValues:function(){var b=this.callBase("getEditorDialogValues");if(!!b.prevaltype){if(b.prevaltype=="1"){if(!!b.date){b.date=""}this.$root.find('input[name="date"]').val("")}}return b},_updateDateFormat:function(b){var d=desknets.Resource,c=this.$root.find('input[name="yeartype"]:checked');var e=b==2?d.dateFormat2:d.dateFormat4;this._$date.datepicker("option","dateFormat",e)},_getDateValue:function(b){if(Number(b.prevaltype)>0){return desknets.Resource.form.datePrevalToday}else{return b.date||""}},_requestForSave:function(h,c,f){var b=this.$root.find("form");var g=b.find('input[name="date"]');if(g.val().match(/[^0-9\u002f]/g)){var e=desknets.Resource.Message.com_invalid_date;var d=desknets.getErrFieName(b,"date");e=desknets.getErrConvMsg({msg:e,fieldid:"date",fieldname:d});desknets.dialog.alert(e,{type:"warn"});return}this.callBase("_requestForSave",h,c,f)}});desknets.page(desknets.form.part._parts,"part10",desknets.form.part._base,{id:"attach",partNo:10,$fileList:a(),createViewHtml:function(c,f){var b=this,e=[];var d=desknets.form.part.getPartTemplate(this.partNo+".1");c=desknets.form.part.replaceFormLabelClass(c,"labelClasses",f);c=desknets.form.part.replaceFormLabelHissuchk(c,"hissuchk",f);c=desknets.form.part.replaceFormLabel(c,"label",f);a.each(this._getAttachListItems(f),function(g,h){e.push(b._createViewItemHtml(d,h,f))});return desknets.tmpl.replaceWordHtml(c,"files",e.join(""))},getIconClass:function(b){return"fl"},setEditorDialogValues:function(c,b){this.callBase("setEditorDialogValues",c);if(this.$fileList.length>0){this._tearDownAttachList()}else{this.$fileList=this.$root.find(".form-part-attach-list")}this._beginToSetUpAttachList(c,b)},getEditorDialogValues:function(){var b=[];var d=this.callBase("getEditorDialogValues");var c=this.$fileList.dnAttachList("option","files");a.each(c,function(f,e){b.push({id:e.fno,attachdisp:e.attachdisp,size:Number(e.size)})});d.attach={item:b};return d},updateElementWithOptions:function(b,c){if(!!c.attachDownloadURL){var d=b.data("params");b.find("a.form-part-download").each(function(){var g=a(this);var f=c.attachDownloadURL;f=desknets.tmpl.replaceWordHtml(f,"id",d.id);f=desknets.tmpl.replaceWordHtml(f,"fno",g.data("fno"));var e=g.text();f=desknets.tmpl.replaceWordHtml(f,"name",encodeURIComponent(e.replace(/'/g,"%27")));g.attr("href",f);g.text(e)})}},_createViewItemHtml:function(c,d,e){var b=Math.ceil(Number(d.size)/1024);c=desknets.tmpl.replaceWordHtml(c,"fno",d.fno);c=desknets.tmpl.replaceWord(c,"filename",d.attachdisp);return desknets.tmpl.replaceWordHtml(c,"size",b)},_beginToSetUpAttachList:function(e,d){var c=this;if(!!e.id){var b=a.extend({},d.paramsForOpen,{id:e.id,ptype:this.partNo});desknets.ajax.rest({url:d.url,data:b,success:function(f){c._setUpAttachList(e,d,f.tmpnm)}})}else{this._setUpAttachList(e,d,"")}},_setUpAttachList:function(g,c,f){if(!f){f="00000000"+Math.floor(new Date().getTime()%86400000)}desknets.attach.tmpnm=f;c.attachOptions.delParams.tmpnm=f;var d=a.extend({downloadURL:"#"},c.attachOptions,{files:this._getAttachListItems(g),tmpnm:f});var e=d.toggleTargetFunc;var b=this;d.toggleTargetFunc=function(){var h=b.$root.find(".jco-remove-all-button");var i=b.$fileList.dnAttachList("option","files");h.toggle(i.length>0);if(!!e){e()}};this.$fileList.dnAttachList(d)},_tearDownAttachList:function(){this.$fileList.dnAttachList("destroy");this.$fileList.empty()},_getAttachListItems:function(d){var b=[];var c=!!d.attach?desknets.ajax.getItems(d.attach.item):[];a.each(c,function(e,f){b.push({fno:f.id,attachdisp:f.attachdisp,size:Number(f.size)})});return b},_updateParamsWithResponse:function(e,c){var b=[];var d=a(c);this.callBase("_updateParamsWithResponse",e,c);d.find("item").each(function(){var f=a(this);b.push({id:f.attr("id"),attachdisp:f.find("attachdisp").text(),size:Number(f.find("size").text())})});e.attach={item:b}}});desknets.page(desknets.form.part._parts,"part11",desknets.form.part._base,{id:"autocal",partNo:11,_$variables:a(),_$selection:a(),createViewHtml:function(b,c){b=desknets.form.part.replaceFormLabel(b,"label",c);return desknets.tmpl.replaceWordLF(b,"unit",c.unit)},getIconClass:function(b){return"cl"},setUpEditorDialog:function(){var b=this;this._$variables=this.$root.find(".jform-variable");this._$selection=this.$root.find("ul.form-list-selection");this.$root.find(".jform-list-add-btn").click(function(c){c.preventDefault();b._moveItem(".jform-from",".jform-to")});this.$root.find(".jform-list-delete-btn").click(function(c){c.preventDefault();b._moveItem(".jform-to",".jform-from")});this._$selection.on("click","li",function(c){a(this).toggleClass("on")})},getEditorDialogOptions:function(){var b=this.callBase("getEditorDialogOptions");b.width=700;return b},setEditorDialogValues:function(e,c){var b=this;if(!!c.editor&&!!c.editor.getParts){var d=this._getVariables(c.editor.getParts());this._clearSelection();this._createSelection(d,e)}this.callBase("setEditorDialogValues",e,c)},getEditorDialogValues:function(){var b=[];var c=this.callBase("getEditorDialogValues");this._$selection.filter(".jform-to").children().each(function(){b.push({value:this.getAttribute("data-id")})});c.sumlist={list:{item:b}};return c},getSaveRequestExtraParams:function(c){var b=[];this._$selection.filter(".jform-to").children().each(function(){b.push(this.getAttribute("data-id"))});c.sumlist=b;return c},_createSelection:function(f,e){var c=this,b;var d=this._getSelectedItem(e);this._$variables.each(function(){var g=a(this);for(var h in f){if(c._isItemToAdd(g,h,e,d)){if(this.tagName=="SELECT"){b=c._createSelectItem(h,f[h],"OPTION","value")}else{b=c._createSelectItem(h,f[h],"LI","data-id")}g.append(b)}}})},_getSelectedItem:function(d){var b={};var c=desknets.ajax.getJsonItems(d.sumlist);a.each(c,function(e,f){b[f.value]=f.value});return b},_isItemToAdd:function(b,e,d,c){if(!!d.id&&d.id==e){return false}if(b.hasClass("jform-from")&&!!c[e]){return false}if(b.hasClass("jform-to")&&!c[e]){return false}return true},_createSelectItem:function(f,c,e,d){var b=a(document.createElement(e));b.attr(d,f);b.text(c);return b},_clearSelection:function(){this._$variables.children(":not(.jform-default)").remove()},_getVariables:function(c){var b={};a.each(c,function(e,d){if(d.ptype=="5"||d.ptype=="11"){b[d.id]=d.Name}});return b},_moveItem:function(d,b){var c=this._$selection.filter(d);var e=this._$selection.filter(b);c.children(".on").appendTo(e)},_requestForSave:function(f,c,e){var b=this.$root.find("form");var d=!!f?{id:f}:{};d.ptype=this.partNo;d.resformat="xml";a.extend(d,c.params);d=this.getSaveRequestExtraParams(d);b.ajaxFormUnbind();desknets.ajax.submitForm(b,{url:c.url,data:d,dataType:"xml",success:e,error:function(k,j,m){var i="";var h="";var l=desknets.parseErrorInfo(m,k.status);var g="";if(l.level!="error"){g=a(k.responseXML).find("errmsgadd").text();if(g=="constval1"){i=b.find(".jco-input-"+g).closest("table").closest("td").prev().find(".co-colon").eq(0).text();h=b.find(".jco-input-"+g).closest("p").find("label").html();if(neo.isSet(i)&&i.length>0){i=i+" - "+h}}else{if(g=="Name"){i=desknets.getErrFieName(b,g)}}}var m=i+l.message;desknets.dialog.alert(m,{type:l.level})}});b.submit()}});desknets.page(desknets.form.part._parts,"part13",desknets.form.part._base,{id:"horizon",partNo:13,createViewHtml:function(d,e){var c=["solid","dotted","dashed"];var b=c[e.linetype]||c[0];d=desknets.tmpl.replaceWordHtml(d,"style",b);d=desknets.tmpl.replaceWordHtml(d,"height",e.linesize||"1");return desknets.tmpl.replaceWordHtml(d,"color",e.fcolor||"#000000")},getEditorDialogOptions:function(){var b=this.callBase("getEditorDialogOptions");b.width=400;return b},getIconClass:function(b){return"hr"},updateElementWithOptions:function(b,c){b.addClass("form-format-block-part")},_showEditorDialog:function(d,c){var b=this;b.callBase("_showEditorDialog",d,c);b.$root.find("select").blur()}});desknets.page(desknets.form.part._parts,"part14",desknets.form.part._base,{id:"image",partNo:14,getIconClass:function(b){return"pc"},updateElementWithOptions:function(c,e){if(!!e.attachDownloadURL){var g=c.data("params"),d=e.attachDownloadURL;var b=!!g.attach&&!!g.attach.item?g.attach.item:{};d=desknets.tmpl.replaceWordHtml(d,"id",g.id);d=desknets.tmpl.replaceWordHtml(d,"fno",b.id);d=desknets.tmpl.replaceWordHtml(d,"name",encodeURIComponent(b.attachdisp.replace(/'/g,"%27")));var f=c.find(".form-part-view img");if(f.length>0){f.attr("src",d)}else{if(!desknets.browser.msie){a("<img />").attr("src",d).appendTo(c.find(".form-part-view"))}else{c.find(".form-part-view").append(a("<img />"));c.find(".form-part-view").find("img").attr("src",d)}}}},_updateParamsWithResponse:function(d,b){var c=a(b);this.callBase("_updateParamsWithResponse",d,b);d.attach={item:{id:1,attachdisp:c.find("item").eq(0).find("attachdisp").text()}}},setEditorDialogValues:function(e,d){var c=this;var b=c.$root.find("form");if(b.length>0){b.find(".jform-attach-input").html('<input type="file" name="attach">')}c.callBase("setEditorDialogValues",e,d)},});app.addInitialAction(function(){desknets.form.init()})})(jQuery);