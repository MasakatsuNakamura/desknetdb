/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.memp={MODULE_API_MEMP:"zrmemp",CMD_MEMPPSETLABELENTRY:"memppsetcmdlabelentry",CMD_MEMPPSETDELLABEL:"memppsetdellabel",CMD_MEMPLIST:"mempcmdindex",CMD_MEMPENTRY:"mempcmdentry",CMD_MEMPDEL:"mempdel",CMD_MEMPSEARCH:"mempcmdsearch",CMD_MEMPDISP:"mempcmddisp",CMD_MEMPREFSETTAG:"mempcmdsettag",CMD_MEMPLABEL:"mempcmdlabel",CMD_MEMPREFATTACH:"mempdispattach",};a.extend(desknets.memp,{MODULE_MEMP:"zmemp",PAGE_MEMPLIST:"mempindex",PAGE_MEMPENTRY:"mempentry",PAGE_MEMPDISP:"mempdisp",PAGE_MEMPSEARCH:"mempsearch",CMD_MEMPLABELASSIGN:"mempcmdlabelassign",CMD_MEMPLABELASSIGNDEL:"mempdellabelassign",CMD_MEMPADDATTACH:"mempcmdaddattach",CMD_MEMPDELATTACH:"mempcmddelattach",CMD_MEMPCOPYATTACH:"mempcmdcopyattach",init:function(){var c=this;var b=a("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(b);if(b==desknets.memp.PAGE_MEMPLIST){desknets.hashobserver.init(desknets.memp);desknets.memp.mempindex.init();desknets.memp.subwin.init();desknets.tags.memopad.setUpFuncAfterAjax(c.changeMainContent)}},defListPrm:function(){var b={};b.fldsort="updtime";b.order="-1";b.row="0";b.labelid="";return b},changeMainContent:function(c,d){if(c.data("module")!="memp"){return true}var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(b.cmd)){b.cmd=""}if(b.cmd==""||b.cmd==desknets.memp.PAGE_MEMPLIST){a("#jco-m-list-container").find(".co-btn-update").click()}else{if(b.cmd==desknets.memp.PAGE_MEMPSEARCH){a("#jco-m-search-container").find(".co-btn-update").click()}else{if(b.cmd==desknets.memp.PAGE_MEMPDISP||b.cmd==desknets.memp.PAGE_MEMPENTRY){if(!!c.data("id")){if(b.id==a.trim(c.data("did"))){if(d===null){a(".co-select-menu-text").html(a(".tag-disp-options:first").find("a:first").html());a('input[name="tagcolor"]').val("0")}else{location.reload()}}}}}}return true}});desknets.page(desknets.memp,"subwin",desknets.PageSubwinSearch,{init:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();c.callBase("init");c.$_inputArea.find('input[name="srch_key"]').val(b.srch_key);c.$_inputArea.find('input[name="sdate"]').val(b.sdate);c.$_inputArea.find('input[name="edate"]').val(b.edate);c.$_inputArea.find('input[name="updsdate"]').val(b.updsdate);c.$_inputArea.find('input[name="updedate"]').val(b.updedate);desknets.htmlparts.setUpForm(c.$_inputArea)},_getSearchPrm:function(d){var b=this;var c=b.$_inputArea;d=desknets.memp.defListPrm();d.srch_key=c.find('input[name="srch_key"]').val();d.sdate=c.find('input[name="sdate"]').val();d.edate=c.find('input[name="edate"]').val();d.updsdate=c.find('input[name="updsdate"]').val();d.updedate=c.find('input[name="updedate"]').val();return d},_chkInputSearchRequired:function(){var b=this;if(b.$_inputArea.find('input[name="srch_key"]').val()==""&&b.$_inputArea.find('input[name="sdate"]').val()==""&&b.$_inputArea.find('input[name="edate"]').val()==""&&b.$_inputArea.find('input[name="updsdate"]').val()==""&&b.$_inputArea.find('input[name="updedate"]').val()==""){desknets.dialog.alert(desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",desknets.Resource.com_srch_noset),{type:"warn"});return false}return b.callBase("_chkInputSearchRequired")},_getMainCmd:function(){return desknets.memp.PAGE_MEMPLIST},_getSearchCmd:function(){return desknets.memp.PAGE_MEMPSEARCH}});desknets.page(desknets.memp,"attach",desknets.attachSetUp,{_getUploadURL:function(){return desknets.memp.MODULE_API_MEMP},_getDownLoadURL:function(){return desknets.memp.MODULE_MEMP},_getUploadCmd:function(){return desknets.memp.CMD_MEMPADDATTACH},_getDelCmd:function(){return desknets.memp.CMD_MEMPDELATTACH},_getDownLoadCmd:function(){return desknets.memp.CMD_MEMPREFATTACH}});desknets.page(desknets.memp,"mempindex",desknets.PageLabelList,{init:function(){var b=this;b._mboAddPageLabelId=true;b.callBase("init")},_hashUpdatePageView:function(d){var c=this;var b=desknets.paramanalyzer.getHashParams();if(d==desknets.memp.PAGE_MEMPSEARCH){if(a("#jco-m-search-container").find(".jco-title").length>0){desknets.memp.mempsearch._getListAjax(b.row)}else{desknets.memp.mempsearch.initPage(desknets.memp.PAGE_MEMPLIST,"jco-m-list-container")}c.mhashBackErrCmd=c.mhashBackCmd;c.mhashIdErrBack=c.mhashIdBack;c.mhashBackCmd=desknets.memp.PAGE_MEMPSEARCH;c.mhashIdBack="jco-m-search-container"}},_listLine:function(e,b){var d=this;var c=false;var f="";e=d._listLineCmd(e);if(typeof b=="object"){e=desknets.tmpl.replaceWord(e,"id",b.id);f=desknets.escapeSpace(desknets.escapeValue(desknets.escape(b.attachcnt)));if(f!==""&&parseInt(f,10)>0){c=true}else{c=false}if(c){e=desknets.tmpl.replaceWord(e,"attachcnt","on");e=desknets.tmpl.replaceWord(e,"attachcnton",desknets.Resource.attachLabel)}else{e=desknets.tmpl.replaceWord(e,"attachcnt"," ");e=desknets.tmpl.replaceWord(e,"attachcnton"," ")}f=desknets.escapeSpace(desknets.escapeValue(desknets.escape(b.labelid)));if(f!==""&&parseInt(f,10)>0){c=true}else{c=false}if(c){e=desknets.tmpl.replaceWordHtml(e,"label",desknets.label.getLabelHtml(b.labelid,b.labelname))}else{e=desknets.tmpl.replaceWord(e,"label"," ")}e=desknets.tmpl.replaceWord(e,"Name",b.Name);e=desknets.tmpl.replaceWord(e,"updtime",desknets.dateTime.dispDateTime(b.updtime,{type:"list"}));e=desknets.tmpl.replaceWord(e,"size",desknets.numberFormatByte(parseInt(b.size,10),0,0,2))}return e},_getListAjaxSuccess:function(d){var b=this;var e=0;var c=0;b.callBase("_getListAjaxSuccess",d);if(typeof(d[0])=="object"){e=d[0]["capalimit"];c=d[0]["totaluse"]}else{e=d.capalimit;c=d.totaluse}e=Number(e);if(isNaN(e)){e=0}c=Number(c);if(isNaN(c)){c=0}desknets.capacity.makeHtml(a("#co-capacity"),e,c)},_getRestModule:function(){return desknets.memp.MODULE_API_MEMP},_getListCmd:function(){return desknets.memp.PAGE_MEMPLIST},_getListExecCmd:function(){return desknets.memp.CMD_MEMPLIST},_getListDispCmd:function(){return desknets.memp.PAGE_MEMPDISP},_getListAddCmd:function(){return desknets.memp.PAGE_MEMPENTRY},_getListModCmd:function(){return desknets.memp.PAGE_MEMPENTRY},_getDelExecCmd:function(){return desknets.memp.CMD_MEMPDEL},_getListDispClass:function(){return desknets.memp.mempdisp},_getListEntryClass:function(){return desknets.memp.mempentry},_getListModClass:function(){return desknets.memp.mempentry},_getLabelGetCmd:function(){return desknets.memp.CMD_MEMPLABEL},_getLabelEntryCmd:function(){return desknets.memp.CMD_MEMPPSETLABELENTRY},_getLabelDelCmd:function(){return desknets.memp.CMD_MEMPPSETDELLABEL},_getDataLabelEntryCmd:function(){return desknets.memp.CMD_MEMPLABELASSIGN},_getDataLabelDelCmd:function(){return desknets.memp.CMD_MEMPLABELASSIGNDEL}});desknets.page(desknets.memp,"mempentry",desknets.PageLabelInput,{getMultiRequest:function(){var b=this.callBase("getMultiRequest");var c=desknets.attach.ext.getListParam();if(!!c){c.cmd="memp"+c.cmd;b["1"]=c}return b},_initSet:function(c){var b=this;if(!!c["1"]){desknets.attach.ext.saveList(c["1"])}b.callBase("_initSet");b._initSetTag();b._setUpAttach()},_initSetTag:function(){var b=this;desknets.tagDisp.initEntryPageTag(a("#co-entry-tag-options"))},_setUpAttach:function(){var b=this;desknets.memp.attach.init(b.$mjPage,true);b.$mjPage.find(".jmemp-attach-button").click(function(c){c.preventDefault();desknets.memp.attach.open()})},_getRestModule:function(){return desknets.memp.MODULE_API_MEMP},_getDelExecCmd:function(){return desknets.memp.CMD_MEMPDEL},_getAddExecCmd:function(){return desknets.memp.CMD_MEMPENTRY},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()}});desknets.page(desknets.memp,"mempdisp",desknets.PageDispBase,{_initSet:function(d){var c=this;c.callBase("_initSet",d);c._initSetTag();var e={copymodule:desknets.memp.MODULE_API_MEMP,copycmd:desknets.memp.CMD_MEMPCOPYATTACH};e.cabtitle=d[0]["Name"];var b=false;if(!neo.isSet(d[0]["attach"])){b=true}desknets.cabinetregist.init(this.$mjPage,e,b)},_initSetTag:function(){var b=this;var c={};c=desknets.paramanalyzer.getHashParams();c.cmd=desknets.memp.CMD_MEMPREFSETTAG;desknets.tagDisp.initTagEvent(desknets.memp.MODULE_API_MEMP,c)},getAttachDownloadParams:function(){var c=this;var d={};var b=desknets.paramanalyzer.getHashParams();d={cmd:desknets.memp.CMD_MEMPREFATTACH,id:b.id};return d},_getRestModule:function(){return desknets.memp.MODULE_API_MEMP},_getDispExecCmd:function(){return desknets.memp.CMD_MEMPDISP},_getDispModCmd:function(){return desknets.memp.PAGE_MEMPENTRY},_getDelExecCmd:function(){return desknets.memp.CMD_MEMPDEL}});desknets.page(desknets.memp,"mempsearch",desknets.memp.mempindex,{_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.defBackListPage()})},defBackListPage:function(){var b=this;var c={};c=desknets.memp.defListPrm();c.cmd=desknets.memp.PAGE_MEMPLIST;b._setLocationHash(c)},_getIdListPage:function(){return"jco-m-search-container"},_getIdListPageForm:function(){return"searchfrm"},_getDelAddPrm:function(){var b=this;var c={};if(b.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){c.srch_key=b.$mjListPage.find('input[name="srch_key"]').val();c.sdate=b.$mjListPage.find('input[name="sdate"]').val();c.edate=b.$mjListPage.find('input[name="edate"]').val();c.updsdate=b.$mjListPage.find('input[name="updsdate"]').val();c.updedate=b.$mjListPage.find('input[name="updedate"]').val()}return c},_getListCmd:function(){return desknets.memp.PAGE_MEMPSEARCH},_getListExecCmd:function(){return desknets.memp.CMD_MEMPSEARCH}});app.addInitialAction(function(){desknets.memp.init()})})(jQuery);