/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.pay={MODULE_PAY:"zpay",MODULE_API_PAY:"zrpay",PAGE_PAYLIST:"payindex",PAGE_PAYENTRY:"payentry",PAGE_PAYDISP:"paydisp",PAGE_PAYSEARCH:"paysearch",CMD_PAYLIST:"paycmdindex",CMD_PAYENTRY:"paycmdentry",CMD_PAYDEL:"paydel",CMD_PAYSEARCH:"paycmdsearch",CMD_PAYDISP:"paycmddisp",CMD_PAYDEMAND:"paydemand",CMD_PAYCONFREPORT:"payconfreport",CMD_PAYREPORT:"payreport",CMD_PAYDOWNLOAD:"paydownload",init:function(){var b=a("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(b);if(b==desknets.pay.PAGE_PAYLIST){desknets.hashobserver.init(desknets.pay);desknets.pay.payindex.init();desknets.pay.subwin.init()}},defListPrm:function(){var b={};b.demand="1";b.report="1";b.fldsort="date";b.order="1";b.row="0";return b},checkInputAmount:function(d){var b=this;var c=null;if(b._isMinus(d)){c=desknets.Resource.Message.com_minus_data}else{if(!b._isAmount(d)){c=desknets.Resource.Message.com_invalid_number}}return c},_isMinus:function(b){if(b.charAt(0)=="-"){return true}return false},_isAmount:function(b){if(b.match(/[^0-9,.]/g)){return false}return true}};desknets.page(desknets.pay,"subwin",desknets.PageSubwinSearch,{init:function(){var b=this;b.callBase("init");b.inputSet();desknets.htmlparts.setUpForm(b.$_inputArea)},inputSet:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();c.$_inputArea.find('input[name="srch_key"]').val(b.srch_key);c.$_inputArea.find('input[name="sdate"]').val(b.sdate);c.$_inputArea.find('input[name="edate"]').val(b.edate)},_getSearchPrm:function(d){var c=this;var b={};b=desknets.pay.defListPrm();b.fldsort="procdate";b.demand="0";b.report="0";b.srch_key=c.$_inputArea.find('input[name="srch_key"]').val();b.sdate=c.$_inputArea.find('input[name="sdate"]').val();b.edate=c.$_inputArea.find('input[name="edate"]').val();a.extend(d,b);return d},_chkInputSearchRequired:function(){var b=this;if(b.$_inputArea.find('input[name="srch_key"]').val()==""&&b.$_inputArea.find('input[name="sdate"]').val()==""&&b.$_inputArea.find('input[name="edate"]').val()==""){desknets.dialog.alert(desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",desknets.Resource.com_srch_noset),{type:"warn"});return false}return b.callBase("_chkInputSearchRequired")},_getMainCmd:function(){return desknets.pay.PAGE_PAYLIST},_getSearchCmd:function(){return desknets.pay.PAGE_PAYSEARCH}});desknets.page(desknets.pay,"payindex",desknets.PageListBase,{_mcSumTemplate:null,_sDelFlg:"0",_hashUpdatePageView:function(d){var c=this;var b=desknets.paramanalyzer.getHashParams();if(d==desknets.pay.PAGE_PAYSEARCH){if(a("#jco-m-search-container").find(".jco-title").length>0){desknets.pay.paysearch._getListAjax(b.row)}else{desknets.pay.paysearch.initPage(desknets.pay.PAGE_PAYLIST,"jco-m-list-container")}c.mhashBackErrCmd=c.mhashBackCmd;c.mhashIdErrBack=c.mhashIdBack;c.mhashBackCmd=desknets.pay.PAGE_PAYSEARCH;c.mhashIdBack="jco-m-search-container"}},init:function(){var b=this;b.callBase("init");b.initItemNotMsg()},initItemNotMsg:function(){var d=this;if(a("#jpay-item-set").val()=="1"){var c=desknets.Resource.Message.pay_item_not;var e=a("#paymsetitem");if(e.length>0){var b="";var f=e.find("a:first").attr("href");f=f+"#cmd=paymsetitementry";c=c+'<br /><a href="'+f+'">'+desknets.Resource.Message.pay_item_notlink+"</a>"}else{c=c+"<br />"+desknets.Resource.Message.pay_item_notmanager}desknets.pageframe.viewTopMsg(c,"alert");d.$mjListPage.find(".jco-list-add-page").attr("disabled",true)}else{d.$mjListPage.find(".jco-list-add-page").attr("disabled",false)}},_initListStartTemplate:function(){var b=this;b.callBase("_initListStartTemplate");var c=b.$mjListPage.find("tfoot");b._mcSumTemplate=c.html();c.remove()},_getListAjaxSuccessOtherSet:function(c){var b=this;var e=b._mcSumTemplate;var d;if(neo.isSet(c.total)&&c.total!==""){d="&yen;&nbsp;"+desknets.numberFormat(parseInt(c.total,10))}else{d="0"}e=desknets.tmpl.replaceWordHtml(e,"total",d);if(neo.isSet(c.total)&&c.total!==""){d="&yen;&nbsp;"+desknets.numberFormat(parseInt(c.demand,10))}else{d="0"}e=desknets.tmpl.replaceWordHtml(e,"demandtotal",d);b.$mjTableList.append(e)},_getListAjaxSuccessEnd:function(){var c=this;var d="";var b=desknets.paramanalyzer.getHashParams();c.callBase("_getListAjaxSuccessEnd");d=b.demand;if(d!="0"&&d!="2"){d="1"}c.$mjListPage.find(".jpay-demand-sel").val(d);d=b.report;if(d!="0"&&d!="2"){d="1"}c.$mjListPage.find(".jpay-report-sel").val(d)},_initListEnd:function(){var b=this;b.callBase("_initListEnd");b.$mjListPage.find(".jpay-demand-sel").change(function(c){a(c.target).blur();b.$mjListPage.find(".jco-back-page-data").find('input[name="demand"]').val(a(this).val());b._listPage("0")});b.$mjListPage.find(".jpay-report-sel").change(function(c){a(c.target).blur();b.$mjListPage.find(".jco-back-page-data").find('input[name="report"]').val(a(this).val());b._listPage("0")})},_replaceListLine:function(c,g,d){var b=this;var f;var e;if(g==="demand"){if(d.demand==="2"){e=desknets.Resource.pay.end}else{e="-"}c=desknets.tmpl.replaceWordHtml(c,g,e)}else{if(g==="report"){if(d.report==="2"){e=desknets.Resource.pay.end}else{e="-"}c=desknets.tmpl.replaceWordHtml(c,g,e)}else{if(g==="amount"){if(d.amount!==""){e=desknets.numberFormat(parseInt(d.amount,10))}else{e=""}c=desknets.tmpl.replaceWordHtml(c,g,e)}else{if(g==="date"){e=desknets.dateTime.dispDateTime(d.date,{type:"list"});c=desknets.tmpl.replaceWordHtml(c,g,e)}else{return b.callBase("_replaceListLine",c,g,d)}}}}return c},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".jpay-list-del-submit").click(function(c){b._sDelFlg="0";b._listDelSubmit(c)});b.$mjListPage.find(".jpay-list-demand-on-submit").click(function(c){b._sDelFlg="1";b._listDelSubmit(c)});b.$mjListPage.find(".jpay-list-demand-off-submit").click(function(c){b._sDelFlg="2";b._listDelSubmit(c)});b.$mjListPage.find(".jpay-list-report-submit").click(function(c){b._sDelFlg="3";b._listDelSubmit(c)});b.$mjListPage.find(".jpay-list-dl-submit").click(function(e){var d=0;b.$mjTableList.find("input[type=checkbox]").each(function(){if(a(this).attr("checked")){d++;return false}});if(d<1){e.preventDefault();desknets.dialog.alert(desknets.Resource.Message.pay_dl_nochecked,{type:"warn"});return}var c=desknets.pay.MODULE_PAY+"."+desknets._msExtension;b.$mjListPage.find("form").attr("action",c);b.$mjListPage.find('input[name="cmd"]').val(b._getDownloadExecCmd());if(b.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){b.$mjListPage.find(".jpay-dl-id").attr("disabled",false)}else{b.$mjListPage.find(".jpay-dl-id").attr("disabled",true)}})},_delNoChkMessage:function(){var b=this;if(b._sDelFlg=="1"){return desknets.Resource.Message.pay_demand_on_nochecked}else{if(b._sDelFlg=="2"){return desknets.Resource.Message.pay_demand_off_nochecked}else{if(b._sDelFlg=="3"){return desknets.Resource.Message.pay_report_nochecked}}}return b.callBase("_delNoChkMessage")},_delConfMessage:function(){var c=this;var b="";if(c._sDelFlg=="1"){if(c.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.pay_demand_on_allconf}else{if(c.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.pay_demand_on_someconf}else{b=desknets.Resource.Message.pay_demand_on_listconf}}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())}else{if(c._sDelFlg=="2"){if(c.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.pay_demand_off_allconf}else{if(c.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.pay_demand_off_someconf}else{b=desknets.Resource.Message.pay_demand_off_listconf}}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())}else{if(c._sDelFlg=="3"){if(c.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.pay_report_allconf}else{if(c.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.pay_report_someconf}else{b=desknets.Resource.Message.pay_report_listconf}}return desknets.tmpl.replaceWordHtml(b,"count",c._getListCheckCount())}}}return c.callBase("_delConfMessage")},_listDel:function(h,g){var d=this;var c=[];if(g!=null){desknets.submitform.setDialogDisabled(g)}if(d.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){c=desknets.PRM_VAL_ALLDEL}else{d.$mjListPage.find('input[name="'+d._getIDName()+'"]:checked').each(function(){c[c.length]=a(this).val()})}if(h){var f={};var b={};b=d._getDelAddPrm();b[d._getIDName()]=c;b.cmd=d._getDelExecCmd();d._mchkIDs=d._getListAjaxGetId();desknets.ajax.rest({url:desknets.getUrl(d._getRestModule()),data:b,success:function(k,i,l){if(!!k.noticeerror){var j=desknets.dialog.alert(k.noticeerror,{extraMessage:k.msgadd,extraClass:"co-msg-r",type:"warn"});j.bind("dialogclose",function(m){desknets.dialog.deleteById("warn");d._getListAjax(d._getListRow())})}else{d._getListAjax(d._getListRow())}},complete:function(k,i,j){if(g!=null){desknets.submitform.clearDialogDisabled(g);g.dialog("close")}},traditional:true})}else{var e={};e=d._getDelAddPrm();e[d._getIDName()]=c;e.cmd=d._getDelCmd();desknets.ajax.rest({url:desknets.getUrl(d._getRestModule()),data:e,success:function(j,i,k){d._setDelConfirm(j.message)},complete:function(k,i,j){if(g!=null){desknets.submitform.clearDialogDisabled(g);g.dialog("close")}},traditional:true})}return},_getDelAddPrm:function(){var b=this;var c={};if(b._sDelFlg=="1"){c.setdemand="2"}else{if(b._sDelFlg=="2"){c.setdemand="1"}}c.demand=b.$mjListPage.find('input[name="demand"]').val();c.report=b.$mjListPage.find('input[name="report"]').val();return c},_getRestModule:function(){return desknets.pay.MODULE_API_PAY},_getListCmd:function(){return desknets.pay.PAGE_PAYLIST},_getListExecCmd:function(){return desknets.pay.CMD_PAYLIST},_getListDispCmd:function(){return desknets.pay.PAGE_PAYDISP},_getListAddCmd:function(){return desknets.pay.PAGE_PAYENTRY},_getListModCmd:function(){return desknets.pay.PAGE_PAYENTRY},_getDelCmd:function(){var b=this;if(b._sDelFlg=="3"){return desknets.pay.CMD_PAYCONFREPORT}return""},_getDelExecCmd:function(){var b=this;if(b._sDelFlg=="1"){return desknets.pay.CMD_PAYDEMAND}else{if(b._sDelFlg=="2"){return desknets.pay.CMD_PAYDEMAND}else{if(b._sDelFlg=="3"){return desknets.pay.CMD_PAYREPORT}}}return desknets.pay.CMD_PAYDEL},_getDownloadExecCmd:function(){return desknets.pay.CMD_PAYDOWNLOAD},_getListDispClass:function(){return desknets.pay.paydisp},_getListEntryClass:function(){return desknets.pay.payentry},_getListModClass:function(){return desknets.pay.payentry}});desknets.page(desknets.pay,"payentry",desknets.PageInputBase,{_initSet:function(){var b=this;b.callBase("_initSet");desknets.htmlparts.setUpForm(a(b._mIdPageForm))},_getRestModule:function(){return desknets.pay.MODULE_API_PAY},_getDelExecCmd:function(){return desknets.pay.CMD_PAYDEL},_getAddExecCmd:function(){return desknets.pay.CMD_PAYENTRY},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.success=function(i,d,j){if(!!i.reporter){var k=desknets.ajax.getItems(i.reporter);var e=k.length;var g="";for(var h=0;h<e;h++){if(h>0){g=g+", "}g=g+desknets.tmpl.replaceWordChk(desknets.Resource.Message.pay_repuser,"name",k[h])}g=desknets.tmpl.replaceWordChkHtml(desknets.Resource.Message.pay_rep_msg,"namelist",g);f=desknets.dialog.confirm(g,function(){b.$mjPage.find('input[name="execflg"]').val("1");a("#inputfrm").trigger("submit")});desknets.submitform.clearDisabled(a("#inputfrm"))}else{if(!!i.noticeerror){var f=desknets.dialog.alert(i.noticeerror,{extraMessage:i.msgadd,extraClass:"co-msg-r",type:"warn"});f.bind("dialogclose",function(l){desknets.dialog.deleteById("warn");b._setLocationHashForm()})}else{b._setLocationHashForm()}}};return c},checkInput:function(c){var b=this;var e=null;var d={};c.find(".jpay-validation-amount").each(function(){var g=a(this);var f=g.val();d.msg=desknets.pay.checkInputAmount(f);if(d.msg){d.fieldid=g.attr("name");d.fieldname=b._getErrorPlace(d.fieldid);e=desknets.getErrConvMsg(d);return false}});return e}});desknets.page(desknets.pay,"paydisp",desknets.PageDispBase,{_sDelFlg:"0",_initSet:function(c){var b=this;b.callBase("_initSet",c);if(c[0]["demand"]=="2"){b.$mjPage.find(".jpay-demand-on-submit").hide()}else{b.$mjPage.find(".jpay-demand-off-submit").hide()}if(c[0]["report"]=="2"){b.$mjPage.find(".jpay-report-submit").hide()}if(c[0]["reporter"]=="0"){b.$mjPage.find(".jpay-report-submit").hide()}},_inputButton:function(){var b=this;b.callBase("_inputButton");b.$mjPage.find(".jpay-input-add-page").click(function(d){d.preventDefault();var c=desknets.paramanalyzer.getHashParams();c.copyid=c.id;delete c.id;c.cmd=desknets.pay.PAGE_PAYENTRY;b._setLocationHash(c)});b.$mjPage.find(".jpay-input-del-submit-conf").click(function(c){b._sDelFlg="0";b._inputDelConfSubmit(c)});b.$mjPage.find(".jpay-demand-on-submit").click(function(c){b._sDelFlg="1";b._inputDelConfSubmit(c)});b.$mjPage.find(".jpay-demand-off-submit").click(function(c){b._sDelFlg="2";b._inputDelConfSubmit(c)});b.$mjPage.find(".jpay-report-submit").click(function(c){b._sDelFlg="3";b._inputDelConfSubmit(c)})},_inputDelSubmit:function(e){var c=this;var d={};var b=desknets.paramanalyzer.getHashParams();if(e!=null){desknets.submitform.setDialogDisabled(e)}d=c._getDelPrm();d.cmd=c._getDelExecCmd();d[c._getIDName()]=b[c._getIDName()];desknets.ajax.rest({url:desknets.getUrl(c._getRestModule()),data:d,success:function(h,f,i){if(!!h.noticeerror){var g=desknets.dialog.alert(h.noticeerror,{extraMessage:h.msgadd,extraClass:"co-msg-r",type:"warn"});g.bind("dialogclose",function(j){desknets.dialog.deleteById("warn");c.dispBackListPage()})}else{c.dispBackListPage()}},complete:function(h,f,g){if(e!=null){desknets.submitform.clearDialogDisabled(e);e.dialog("close")}}})},_getRestModule:function(){var b=this;return desknets.pay.MODULE_API_PAY},_delConfMessage:function(){var b=this;if(b._sDelFlg=="1"){return desknets.Resource.Message.pay_demand_on_conf}else{if(b._sDelFlg=="2"){return desknets.Resource.Message.pay_demand_off_conf}}return desknets.Resource.Message.com_del_conf},_inputDelConfAjaxSuccess:function(g,b,h){var c=this;var i=desknets.ajax.getItems(g.reporter);var d=i.length;var e="";for(var f=0;f<d;f++){if(f>0){e=e+", "}e=e+desknets.tmpl.replaceWordChk(desknets.Resource.Message.pay_repuser,"name",i[f])}e=desknets.tmpl.replaceWordChkHtml(desknets.Resource.Message.pay_rep_msg,"namelist",e);$dialog=desknets.dialog.confirm(e,function(){c._inputDelSubmit($dialog);return false})},_getDelPrm:function(){var b=this;var c={};if(b._sDelFlg=="1"){c.setdemand="2"}else{if(b._sDelFlg=="2"){c.setdemand="1"}else{if(b._sDelFlg=="3"){c.report="2"}}}return c},_getDispExecCmd:function(){var b=this;return desknets.pay.CMD_PAYDISP},_getDispModCmd:function(){var b=this;return desknets.pay.PAGE_PAYENTRY},_getDelCmd:function(){var b=this;if(b._sDelFlg=="1"){return""}else{if(b._sDelFlg=="2"){return""}else{if(b._sDelFlg=="3"){return desknets.pay.CMD_PAYENTRY}}}return""},_getDelExecCmd:function(){var b=this;if(b._sDelFlg=="1"){return desknets.pay.CMD_PAYDEMAND}else{if(b._sDelFlg=="2"){return desknets.pay.CMD_PAYDEMAND}else{if(b._sDelFlg=="3"){return desknets.pay.CMD_PAYREPORT}}}return desknets.pay.CMD_PAYDEL}});desknets.page(desknets.pay,"paysearch",desknets.pay.payindex,{_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()})},_getDelAddPrm:function(){var b=this;var c={};c=b.callBase("_getDelAddPrm");if(b.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){c.srch_key=b.$mjListPage.find('input[name="srch_key"]').val();c.sdate=b.$mjListPage.find('input[name="sdate"]').val();c.edate=b.$mjListPage.find('input[name="edate"]').val()}return c},_getIdListPage:function(){return"jco-m-search-container"},_getIdListPageForm:function(){return"searchfrm"},_getListCmd:function(){return desknets.pay.PAGE_PAYSEARCH},_getListExecCmd:function(){return desknets.pay.CMD_PAYSEARCH}});app.addInitialAction(function(){desknets.pay.init()})})(jQuery);