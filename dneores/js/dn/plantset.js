/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.plantset={PAGE_PLANTPSETPGROUP:"plantpsetpgroup",CMD_PLANTPSETPGROUP:"plantpsetcmdpgroup",PAGE_PLANTPSETPGROUPENTRY:"plantpsetpgroupentry",CMD_PLANTPSETPGROUPENTRY:"plantpsetcmdpgroupentry",CMD_PLANTPSETPGROUPDEL:"plantpsetcmdpgroupdel",CMD_PLANTPSETPGROUPMOVE:"plantpsetcmdpgroupmove",CMD_PLANTSETEVENT:"plantmsetevent",PAGE_PLANTSETEVENTENTRY:"plantmsetevententry",CMD_PLANTSETEVENTENTRY:"plantmsetcmdevententry",CMD_PLANTSETDELEVENT:"plantmsetdelevent",CMD_PLANTSETMVEVENT:"plantmsetmvevent",PAGE_PLANTSETPGROUP:"plantmsetpgroup",CMD_PLANTMSETPGROUP:"plantmsetcmdpgroup",PAGE_PLANTSETPGROUPENTRY:"plantmsetpgroupentry",CMD_PLANTSETPGROUPENTRY:"plantmsetcmdpgroupentry",CMD_PLANTSETPGROUPDEL:"plantmsetcmdpgroupdel",CMD_PLANTSETPGROUPMOVE:"plantmsetcmdpgroupmove",CMD_PLANTSETPGROUPINFO:"plantmsetcmdpgroupinfo",PAGE_PLANTSETPLANT:"plantmsetplant",CMD_PLANTMSETPLANT:"plantmsetcmdplant",PAGE_PLANTSETPLANTENTRY:"plantmsetentry",CMD_PLANTSETPLANTENTRY:"plantmsetcmdentry",CMD_PLANTSETPLANTDEL:"plantmsetcmddel",CMD_PLANTSETPLANTDELCONF:"plantmsetcmddelconf",CMD_PLANTSETPLANTMOVE:"plantmsetcmdmove",PAGE_PLANTSETACCESS:"plantmsetaccess",CMD_PLANTSETACCESS:"plantmsetcmdaccess",PAGE_PLANTSETENTRYMULTI:"plantmsetentrymulti",CMD_PLANTSETENTRYMULTI:"plantmsetcmdentrymulti",PAGE_PLANTSETDISPSELPLANT:"plantmsetdispselplant",PAGE_PLANTSETPSELDLG:"plantmsetpseldlg",PAGE_PLANTSETADMIN:"plantsetadmin",init:function(){var b=a("#jco-pv-funcid").val();if(!(b in desknets.plantset)){return}desknets.pageframe.setFuncSel(b);desknets.hashobserver.init(desknets.plantset);if(b=="plantpsetgen"){desknets.plantset.plantpsetgen.init();desknets.plant.subwinpset.init()}else{if(b=="plantpsetschimport"){desknets.plantset.plantpsetschimport.init();desknets.plant.subwinpset.init()}else{if(b=="plantpsetschexport"){desknets.plantset.plantpsetschexport.init();desknets.plant.subwinpset.init()}else{if(b==this.PAGE_PLANTPSETPGROUP){desknets.plantset.plantpsetpgroup.init();desknets.plant.subwinpset.init()}else{if(b=="plantmsetschimport"){desknets.plantset.plantmsetschimport.init();desknets.plant.subwinmset.init()}else{if(b=="plantmsetschexport"){desknets.plantset.plantmsetschexport.init();desknets.plant.subwinmset.init()}else{if(b=="plantmsetevent"){desknets.plantset.plantmsetevent.init();desknets.plant.subwinmset.init()}else{if(b==this.PAGE_PLANTSETPGROUP){desknets.plantset.plantmsetpgroup.init();desknets.plant.subwinmset.init()}else{if(b==this.PAGE_PLANTSETPLANT){desknets.plantset.plantmsetplant.init();desknets.plant.subwinmset.init()}else{if(b=="plantmsetimport"){desknets.plantset.plantmsetimport.init();desknets.plant.subwinmset.init()}else{if(b=="plantmsetexport"){desknets.plantset.plantmsetexport.init();desknets.plant.subwinmset.init()}else{if(b==this.PAGE_PLANTSETADMIN){desknets.plantset.plantsetadmin.init()}else{if(b=="plantsetgen"){desknets.plantset.plantsetgen.init()}else{if(b=="plantsetmanager"){desknets.plantset.plantsetmanager.init()}}}}}}}}}}}}}}},_initSchSetRegistryEvent:function(){var b=this;a("#co-m-h-tabs").find("a").click(function(d){d.preventDefault();var c=a(this).attr("href");var e=a("#jco-pv-funcid").val();if(b.isSchMSetCmd(e)){desknets.execLocation(c)}})},choicePlantLimited:function(b,c){var e=b.next();var d=true;b.change(function(){var f=desknets.getDataAttr(b.find("option:selected"),"value");var g="jsch-selectdisp-sub-"+f;e.children().each(function(){var h=a(this);if(h.hasClass(g)){h.show();if(c&&!d){if(h.is("input")){h.focus()}else{h.find("input:first").focus()}}}else{h.hide();if(c&&!d){var i=null;if(h.is("input")){i=h}else{i=h.find("input:first")}if(i.hasClass("co-datepicker")){a.datepicker._clearDate(i)}else{i.val("")}}}});d=false}).trigger("change")},inputSetLimitTime:function(k){var b=k.find('input[name="starttime"]');var h=k.find('input[name="endtime"]');var d=k.find("#jplant-set-input-all-day");var e=b.val()=="0000"&&h.val()=="2400";var c=k.find('input[name="start"]');var f=k.find('input[name="unit"]');var j=k.find(".jplant-set-input-time");var g=this;var i={minuteStep:Number(f.val()),baseHour:Number(c.val())};desknets.timePicker.create(b,i);desknets.timePicker.create(h,i);d.click(function(){g._setAllDay(a(this).prop("checked"),j)});if(e){d.prop("checked",true);g._setAllDay(true,j)}},_setAllDay:function(f,d){var c="";var b=d.find(".co-timepicker select").prop("disabled",f);var e=d.find('input[name="endtime"] + select > [value="0"]');function g(h){var i=desknets.Resource.timePickerHourFormat;var j=desknets.tmpl.replaceWordHtml(i,"hour",h);return neo.dateTime.format(j,new Date(1970,0,1,h,0,0))}if(f){b.val("0");c=g(24);e.text(g(24));d.find('input[name="starttime"]').val("0000");d.find('input[name="endtime"]').val("2400")}else{b.val("").change();e.text(g(0));c=g(0)}e.text(c).prop("label",c)}};desknets.page(desknets.plantset,"plantmultientrydlg",desknets.sch.schpselalldlg,{_DIALOG_ID:"jplantset-select-dialog-m",_GROUP_DIALOG_ID:"jplant-selmulti-chooser-dialog",_manageGid:"",_selGroup:null,mboassign:false,_getSchPSelAjaxReq:function(){var c;var b={};var d=0;if(this._$dialog==null){c=desknets.paramanalyzer.getHashParams();this._pselGid=c.assigngroup;this._manageGid=c.managegroup;c.cmd=desknets.plantset.PAGE_PLANTSETPSELDLG;b[d]=c;d++;c={};c.cmd=desknets.plantset.CMD_PLANTMSETPGROUP;b[d]=c;d++}c={};c.cmd=desknets.plantset.CMD_PLANTMSETPLANT;c.assigngroup=this._pselGid;c.managegroup=this._manageGid;c.fetchall="1";b[d]=c;d++;return b},_initSchPSelDlgRegistryEvent:function(){var b=this;b.callBase("_initSchPSelDlgRegistryEvent");this._initPlantSelDlgGroupSelect()},_initPlantSelDlgGroupSelect:function(){var b=this;b._$dialog.find('input[name="managegroup"]').val(b._manageGid);var c={assign:true,pageID:desknets.dialog._idPrefix+b._DIALOG_ID,fldName:"managegroup",dialogID:b._GROUP_DIALOG_ID,defaultGroupId:b._$dialog.find('input[name="managegroup"]').val(),onSelectGroup:function(f){b._manageGid=f;b._setSelectDisabled(true);b._saveSchPSelPlantID();b._sendSchPSelAjax()}};var d={};var e=b._$dialog.find(".jco-sel-btn");if(e.data("type")=="assign"){b.mboassign=true;d={allGroup:"choosable",allGroupLabel:desknets.Resource.plant.commonassignGroupName,cmdgroups:"constructmsetugroups",cmdgrouptree:"constructmsetcmdgrouptree",moduletype:e.data("module")}}else{d={allGroup:"choosable",unassignGroupLabel:desknets.Resource.plant.commonGroupName,unassignGroup:"choosable"}}b._selGroup=new desknets.page.GroupSelect;b._selGroup.init(c,d)},_setSelectDisabled:function(b){this._$dialog.find(".jplant-pseldlg-selgroup").attr("disabled",b)},_setSchPSelDlgPlant:function(d){var b=this;var f=[];var c=[];var e;if(!!this._selGroup){if(b.mboassign&&d.managegroup=="all"){d.evgname=desknets.Resource.plant.commonassignGroupName;d.tgname=desknets.Resource.plant.commonassignGroupName}this._selGroup.editSelectedAssignGroup(this._$dialog,this._$dialog.find(".jco-sel-items"),d,"managegroup")}b.callBase("_setSchPSelDlgPlant",d)},});desknets.page(desknets.plantset,"plantcpydlg",desknets.plantset.plantmultientrydlg,{_DIALOG_ID:"jplantset-select-dialog-s",_GROUP_DIALOG_ID:"jplant-selcopy-chooser-dialog",_initSchPSelTemplate:function(){this._templateSelectPlant=desknets.tmpl.replaceWordHtml(this._TMPL_SELECTPLANT,"type","radio");this._templateSelectPlant=desknets.tmpl.replaceWordHtml(this._templateSelectPlant,"dialogId",this._DIALOG_ID)},_initSchPSelUnCheck:function(){},_initSchPSelCheck:function(){},_setSchPSelDlgHtml:function(c){var b=c.html;if(!neo.isSet(b)){return false}this._$dialog=desknets.dialog.make(this._DIALOG_ID,this._getDialogOption());b=desknets.tmpl.replaceWordHtml(b,"Guide_chk",desknets.Resource.plant.pselGuide_chk_copy);b=desknets.tmpl.replaceWordHtml(b,"Guide",this._options.guide);b=desknets.tmpl.replaceWordHtml(b,"dialogId",this._DIALOG_ID);this._$dialog.append(b);this._noDataToSelectHtml=this._$dialog.find("#plant-pop-sel-list").html();return true},_initPlantSelDlgAllSelectEvent:function(){this._$dialog.find(".plantmg-pop-msel-allchk").hide()},_saveSchPSelPlantID:function(){var b=this;this._clearPSelDlgID();var c=this._$dialog.find(".jsch-pseldlg-item").find("input:checked");c.each(function(){var e=a(this).val();var d=a(this).next().text();b._savePSelDlgID(e,d)})}});desknets.page(desknets.plantset,"plantpsetgen",desknets.PageSet,{init:function(){desknets.sch.util.plant.setGroupSelect(jsonRestPGroup,desknets.Resource.sch.plantg_sel_allref,a("#frm").find("[name=Group]"));this.callBase("init")},_getNextCmd:function(){return desknets.plant.PAGE_PLANTWEEKGRP}});desknets.page(desknets.plantset,"plantpsetpgroup",desknets.PageInputList,{_getListCmd:function(){return desknets.plantset.PAGE_PLANTPSETPGROUP},_getListExecCmd:function(){return desknets.plantset.CMD_PLANTPSETPGROUP},_getListAddCmd:function(){return desknets.plantset.PAGE_PLANTPSETPGROUPENTRY},_getListModCmd:function(){return desknets.plantset.PAGE_PLANTPSETPGROUPENTRY},_getDelExecCmd:function(){return desknets.plantset.CMD_PLANTPSETPGROUPDEL},_getMoveExecCmd:function(){return desknets.plantset.CMD_PLANTPSETPGROUPMOVE},_getListEntryClass:function(){return desknets.plantset.plantpsetpgroupentry},_getListModClass:function(){return desknets.plantset.plantpsetpgroupentry}});desknets.page(desknets.plantset,"plantpsetpgroupentry",desknets.PageInputBase,{_inputButton:function(){var c=this;var e=this.$mjPage.find(".co-sel-items-entry").parent();var d=e.find("tbody");this.callBase("_inputButton");var b={change:function(){d.tableDnD()},guide_chk:desknets.Resource.sch.pselGuide_chk_pgroup,template:desknets.sch.schpseldlg.TMPL_ITEMLIST};desknets.sch.schpseldlg.setUp(e,b);desknets.sch.schpseldlg.transPSelPlantFromCaller();d.show().tableDnD()},_getAddExecCmd:function(){return desknets.plantset.CMD_PLANTPSETPGROUPENTRY},_getDelExecCmd:function(){return desknets.plantset.CMD_PLANTPSETPGROUPDEL}});desknets.page(desknets.plantset,"plantpsetschimport",desknets.PageImport,{init:function(){this.callBase("init");this._initPlantSelectDialog()},_initPlantSelectDialog:function(){var b=a("#jplant-m-import-page").find(".jco-sel-items").parent();desknets.plantset.schimportpseldlg.setUp(b,this._getSchPlantDlgOptions())},_getSchPlantDlgOptions:function(){return{guide_chk:desknets.Resource.sch.pselGuide_chk_import,guide:desknets.Resource.sch.pselGuide_add,pgrouptop:desknets.Resource.sch.plantg_sel_alladd,access:desknets.sch.ACCESS_ADD+desknets.sch.ACCESS_MOD,template:desknets.plantset.schimportpseldlg.TMPL_ITEMONE}},_getRestModule:function(){return desknets.MODULE_API_MAIN}});desknets.plantset.schimportpseldlg=a.extend({},desknets.sch.schpseldlg,{_initSchPSelTemplate:function(){this._templateSelectPlant=desknets.tmpl.replaceWordHtml(this._TMPL_SELECTPLANT,"type","radio");this._templateSelectPlant=desknets.tmpl.replaceWordHtml(this._templateSelectPlant,"dialogId",this._DIALOG_ID)},_initSchPSelUnCheck:function(){},_initSchPSelCheck:function(){},_saveSchPSelPlantID:function(){var b=this;this._clearPSelDlgID();var c=this._$dialog.find(".jsch-pseldlg-item").find("input:checked");c.each(function(){var e=a(this).val();var d=a(this).next().text();b._savePSelDlgID(e,d)})}});desknets.page(desknets.plantset,"plantpsetschexport",desknets.PageExport,{init:function(){this.callBase("init");desknets.htmlparts.setUpForm(a("#frm"));this._initPlantSelectDialog()},checkExport:function(){var d=a(".jplant-export-date");var b=d.find(".ui-invalid");if(b.length>0){return null}if(!desknets.validation.isRequiredDateFromTo(d)){return desknets.Resource.Message.com_datechk_fromto_required}if(!desknets.validation.isInputDateFromTo(d)){return desknets.Resource.Message.com_datechk_fromto}var c=a(".jco-sel-items").find('input[name="pid"]');if(c.length==0){return desknets.Resource.Message.com_exportnoselect}return null},_initPlantSelectDialog:function(){var c=a("#jplant-m-export-page").find(".co-sel-items-entry").parent();var b=c.find("tbody");desknets.sch.schpselalldlg.setUp(c,this._getSchPlantDlgOptions());desknets.sch.schpselalldlg.transPSelPlantFromCaller();b.show()},_getSchPlantDlgOptions:function(){return{guide_chk:desknets.Resource.sch.pselGuide_chk_export,template:desknets.sch.schpseldlg.TMPL_ITEMLIST,change:this._onChangeSelectPlant}},_onChangeSelectPlant:function(){var b=this;var c=a(".co-sel-items-entry").find("table").find("tr");if(c.length>0){a(".co-sel-items-entry").show()}else{a(".co-sel-items-entry").hide()}}});(function(b){desknets.page(desknets.plantset,"plantmsetevent",desknets.PageInputList,{_getListCmd:function(){var c=this;return c._getListExecCmd()},_getListExecCmd:function(){return desknets.plantset.CMD_PLANTSETEVENT},_getListAddCmd:function(){return desknets.plantset.PAGE_PLANTSETEVENTENTRY},_getListModCmd:function(){return desknets.plantset.PAGE_PLANTSETEVENTENTRY},_getDelExecCmd:function(){return desknets.plantset.CMD_PLANTSETDELEVENT},_getMoveExecCmd:function(){return desknets.plantset.CMD_PLANTSETMVEVENT},_getListEntryClass:function(){return desknets.plantset.plantmsetevententry},_getListModClass:function(){return desknets.plantset.plantmsetevententry}})})(jQuery);desknets.page(desknets.plantset,"plantmsetevententry",desknets.PageInputBase,{_initSet:function(b){this.callBase("_initSet");desknets.schset.setEventSchColor(a("#inputfrm"))},_getDelExecCmd:function(){return desknets.plantset.CMD_PLANTSETDELEVENT},_getAddExecCmd:function(){return desknets.plantset.CMD_PLANTSETEVENTENTRY}});desknets.page(desknets.plantset,"plantmsetpgroup",desknets.PageInputList,{_getListCmd:function(){return desknets.plantset.PAGE_PLANTSETPGROUP},_getListExecCmd:function(){return desknets.plantset.CMD_PLANTMSETPGROUP},_getListAddCmd:function(){return desknets.plantset.PAGE_PLANTSETPGROUPENTRY},_getListModCmd:function(){return desknets.plantset.PAGE_PLANTSETPGROUPENTRY},_getDelExecCmd:function(){return desknets.plantset.CMD_PLANTSETPGROUPDEL},_getMoveExecCmd:function(){return desknets.plantset.CMD_PLANTSETPGROUPMOVE},_getListEntryClass:function(){return desknets.plantset.plantmsetpgroupentry},_getListModClass:function(){return desknets.plantset.plantmsetpgroupentry}});desknets.page(desknets.plantset,"plantmsetpgroupentry",desknets.PageInputBase,{_initSet:function(c){var b=this;this.callBase("_initSet",c);desknets.htmlparts.setUpForm(b.$mjPage.find("#inputfrm"))},_inputButton:function(){this.callBase("_inputButton");desknets.plantset.inputSetLimitTime(this.$mjPage);desknets.plantset.choicePlantLimited(this.$mjPage.find("[name=startendtimeuse]"),false);desknets.plantset.choicePlantLimited(this.$mjPage.find("[name=reserve_limit_use]"),true)},_getDelExecCmd:function(){return desknets.plantset.CMD_PLANTSETPGROUPDEL},_getAddExecCmd:function(){return desknets.plantset.CMD_PLANTSETPGROUPENTRY}});desknets.page(desknets.plantset,"plantmsetplant",desknets.PageInputList,{GSEL_DIALOG_ID:"jplant-listsel-chooser-dialog",mboassign:false,_initListStart:function(){var b=this;b.callBase("_initListStart");var c={assign:true,fldName:"managegroup",dialogID:b.GSEL_DIALOG_ID};var d={};var e=b.$mjListPage.find(".jco-sel-btn");if(e.data("type")=="assign"){b.mboassign=true;d={allGroup:"choosable",allGroupLabel:desknets.Resource.plant.commonassignGroupName,cmdgroups:"constructmsetugroups",cmdgrouptree:"constructmsetcmdgrouptree",moduletype:e.data("module")}}else{d={allGroup:"choosable",unassignGroupLabel:desknets.Resource.plant.commonGroupName,unassignGroup:"choosable"}}desknets.page.groupSelect.init(c,d);b._setUpPlantGroup()},_setUpPlantGroup:function(){var b=this;desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:{cmd:desknets.plantset.CMD_PLANTMSETPGROUP},success:function(c){var f=b.$mjListPage.find('select[name="assigngroup"]');var d="("+desknets.Resource.plant.selectPGroupAll+")";desknets.sch.util.plant.setGroupSelect(c,d,f);var e=b.$mjListPage.find(".jco-back-page-data").find('input[name="assigngroup"]').val();f.val(e)}})},_getListAjaxSuccess:function(c){var b=this;this.callBase("_getListAjaxSuccess",c);if(b.mboassign&&c.managegroup=="all"){c.evgname=desknets.Resource.plant.commonassignGroupName;c.tgname=desknets.Resource.plant.commonassignGroupName}desknets.page.groupSelect.editSelectedAssignGroup(this.$mjListPage,this.$mjListPage.find(".jco-sel-items"),c,"managegroup");var d=this.$mjListPage.find(".jco-back-page-data").find('input[name="assigngroup"]').val();this.$mjListPage.find('select[name="assigngroup"]').val(d);this._setMoveMode()},_initListEnd:function(){var b=this;b.callBase("_initListEnd");b.$mjListPage.find(".jco-list-mod-page").click(function(c){b.inputModPlantMultiPage(c)});b.$mjListPage.find('select[name="assigngroup"]').change(function(c){a(c.target).blur();b.$mjListPage.find(".jco-back-page-data").find('input[name="assigngroup"]').val(a(this).val());b._listPage("0")})},inputModPlantMultiPage:function(c){var b=this;var e="";var d={};c.preventDefault();e=b._getListModMultiPlantCmd();d=b._getAddPageParam();d.cmd=e;b._inputPage(d)},_canSort:function(){var c=this.$mjListPage.find('[name="managegroup"]').val();var d=this.$mjListPage.find('[name="assigngroup"]').val();var b=this.$mjListPage.find(".jco-list-move");return c=="all"&&d=="0"&&b.length>0},_listToggleViewMove:function(c){var b=this;if(c){b.$mjListPage.find(".jco-sel-btn").attr("disabled","disabled");b.$mjListPage.find("select").attr("disabled","disabled")}else{b.$mjListPage.find(".jco-sel-btn").attr("disabled",false);b.$mjListPage.find("select").attr("disabled",false)}b.callBase("_listToggleViewMove",c)},_getListCmd:function(){return desknets.plantset.PAGE_PLANTSETPLANT},_getListExecCmd:function(){return desknets.plantset.CMD_PLANTMSETPLANT},_getListAddCmd:function(){return desknets.plantset.PAGE_PLANTSETPLANTENTRY},_getAddPageParam:function(){var b=this.$mjListPage.find(".jco-back-page-data");var c=b.find('input[name="managegroup"]').val();var d=b.find('input[name="assigngroup"]').val();return{managegroup:c,assigngroup:d}},_getListModCmd:function(){return desknets.plantset.PAGE_PLANTSETPLANTENTRY},_getDelCmd:function(){return desknets.plantset.CMD_PLANTSETPLANTDELCONF},_getDelExecCmd:function(){return desknets.plantset.CMD_PLANTSETPLANTDEL},_getDelAddPrm:function(){var b;b=desknets.getInputDataToObj(this.$mjListPage.find(".jco-back-page-data"));return b},_getListModMultiPlantCmd:function(){return desknets.plantset.PAGE_PLANTSETENTRYMULTI},_getMoveExecCmd:function(){return desknets.plantset.CMD_PLANTSETPLANTMOVE},_getListEntryClass:function(){return desknets.plantset.plantmsetentry},_getListModClass:function(){return desknets.plantset.plantmsetentry},_getListModMultiPlantClass:function(){return desknets.plantset.plantmsetentrymulti},_hashUpdatePageView:function(c){var b=this;if(c==b._getListModMultiPlantCmd()){b._hashUpdateModMultiPlantPage()}else{b.callBase("_hashUpdatePageView")}},_hashUpdateModMultiPlantPage:function(){var c=this;var d;var b;d=c._getListModMultiPlantClass();if(neo.isSet(d)){d.initPage(c.mhashBackCmd,c.mhashIdBack)}}});desknets.page(desknets.plantset,"plantmsetentry",desknets.PageInputBase,{_paramPlantGroup:0,_selGroup:null,_initSet:function(c){var b=this;this.callBase("_initSet",c);desknets.htmlparts.setUpForm(b.$mjPage.find("#inputfrm"));b.$mjPage.find(".jplant-fileset").html('<input type="file" name="attach" size="40" />')},getMultiRequest:function(){var d;var c=0;var b=this.callBase("getMultiRequest");c++;d={};d.cmd=desknets.plantset.CMD_PLANTMSETPGROUP;b[c]=d;this._paramPlantGroup=c;return b},_inputAjaxFormOption:function(){var c={};var b=this;var c=b.callBase("_inputAjaxFormOption");c.dataType="xml";c.success=function(e,d,f){b._updatePlantListId(e);b._setLocationHashForm()};return c},_initHtml:function(d){var b;var c=this;var e=true;this.callBase("_initHtml",d);b=this.$mjPage.find("[name=assigngroup]");desknets.sch.util.plant.setGroupSelect(d[this._paramPlantGroup],desknets.Resource.optionSelect,b);b.change(function(){c._onChangePlantEntryPGroup(a(this).find("option:selected").val());if(e){c._inputFormSaveToObserver();e=false}}).trigger("change")},_inputButton:function(){var b=this;b.callBase("_inputButton");desknets.plantset.inputSetLimitTime(this.$mjPage);desknets.plantset.choicePlantLimited(this.$mjPage.find("[name=startendtimeuse]"),false);desknets.plantset.choicePlantLimited(this.$mjPage.find("[name=reserve_limit_use]"),true);var e={};var f=b.$mjPage.find(".jco-sel-btn.plant-grp-sel-btn");if(f.data("type")=="assign"){e={cmdgroups:"constructmsetugroups",cmdgrouptree:"constructmsetcmdgrouptree",moduletype:f.data("module")}}else{e={unassignGroupLabel:desknets.Resource.plant.commonGroupName,unassignGroup:"choosable"}}b._selGroup=new desknets.page.GroupSelect;b._selGroup.init(b._getPlantManageGrpOptions(),e,true);var c={cmd:desknets.plantset.PAGE_PLANTSETACCESS,id:this.$mjPage.find("[name=id]").val()};var d={area:a("#jplant-entry-access"),module:this._getRestModule(),param:c,idFldName:"aid",dialoghtml:a("#jplant-entry-access-items"),msetcmd:true,bosubmitcommit:false};desknets.DialogAccess.setUp(d)},_getPlantManageGrpOptions:function(){var c=this.$mjPage.find('input[name="managegroup"]');var b={assign:true,pageID:"jco-m-input-page",dialogID:"jplant-sel-chooser-dialog",fldName:"managegroup"};if(!!c){b.defaultGroupId=c.val()}return b},_getDelExecCmd:function(){return desknets.plantset.CMD_PLANTSETPLANTDEL},_getAddExecCmd:function(){return desknets.plantset.CMD_PLANTSETPLANTENTRY},_onChangePlantEntryPGroup:function(e,d){var b=this;var c;var f;c=desknets.getUrl(desknets.MODULE_API_MAIN);f={};f.cmd=desknets.plantset.CMD_PLANTSETPGROUPINFO;f.id=e;desknets.ajax.rest({url:c,data:f,success:function(h,g,i){b._onSuccessPlantGetPGroup(h,d)}})},_onSuccessPlantGetPGroup:function(c,b){if(!b){b=this.$mjPage}var d=b.find("#jplant-disp-disparea");d.empty();b.find(".jplant-disp-tmplset").tmpl(c).appendTo(d)},_updatePlantListId:function(c){var d=this.$mjPage.find("[name=managegroup]").val();var b=this.$mjPage.find("[name=assigngroup]").val();this._setPlantBackPageId(d,b)},_setPlantBackPageId:function(c,f){var e=a("#"+this.mIdBack).find(".jco-back-page-data");var d=e.find('input[name="managegroup"]').val();var b=e.find('input[name="assigngroup"]').val();if(c!=d&&d!="all"){e.find('input[name="managegroup"]').val(c);desknets.chooser.singleGroup.destroy(desknets.plantset.plantmsetplant.GSEL_DIALOG_ID)}if(f!=b&&b!="0"){e.find('input[name="assigngroup"]').val(f)}}});desknets.page(desknets.plantset,"plantmsetentrymulti",desknets.plantset.plantmsetentry,{TMPL_ITEMMULTI:'<span class="co-selitem"><span title="{{Name}}">{{Name}}</span><a title="{{L_Delete}}" href="#" class="co-btn co-btn-close">{{L_Delete}}</a><input type="hidden" name="pid" value="{{id}}"/></span>',TMPL_ITEMONE:'<input type="hidden" name="id" value="{{id}}" /><span class="co-btnarea-gname" title="{{Name}}">{{Name}}</span>',_selPlantMulti:null,_selPlant:null,_refPid:"",_initSet:function(c){var b=this;b.callBase("_initSet",c);b._initPlantChgSelect()},_inputButton:function(){var e=true;var d=true;var f;var b=this;var c;b.callBase("_inputButton");b._refPid="";c=b.$mjPage.find("#jplant-entry-multi");desknets.plantset.plantmultientrydlg.resetPlantDlgHtml();desknets.plantset.plantmultientrydlg.setUp(c,b._getPlantDlgOptions());c=b.$mjPage.find("#plantmg-chgpkg-selplant");desknets.plantset.plantcpydlg.resetPlantDlgHtml();desknets.plantset.plantcpydlg.setUp(c,b._getPlantCopyDlgOptions());b._initPlantChgCheckBox()},_getPlantManageGrpOptions:function(){var b=this.callBase("_getPlantManageGrpOptions");a.extend(b,{pageID:"jplant-chgpkg-type-1"});return b},_initPlantChgSelect:function(){var b=this;b.$mjPage.find(".jplant-chgpkg-type").change(function(){var c=a(this).val();b.$mjPage.find("[id^=jplant-chgpkg-type-]").hide();b.$mjPage.find("#jplant-chgpkg-type-"+c).show();if(c=="2"){b.$mjPage.find("#plantmg-chgpkg-selplant").show();b.$mjPage.find("#jplant-chgpkg-type-1").find("tr").each(function(){b._togglePlantImputElem(a(this),false)});b.$mjPage.find("#jplant-chgpkg-type-2").find("input").each(function(){a(this).removeAttr("disabled")})}else{b.$mjPage.find("#plantmg-chgpkg-selplant").hide();b.$mjPage.find("#jplant-chgpkg-type-1").find("tr").each(function(){b._togglePlantImputElem(a(this),true)});b.$mjPage.find("#jplant-chgpkg-type-2").find("input").each(function(){a(this).attr("disabled","disabled")})}}).trigger("change")},_initPlantChgCheckBox:function(){var b=this;b.$mjPage.find("#jplant-chgpkg-type-1").find(".plantmg-chgpkg-check").click(function(){var d=a(this);var c=d.closest("tr");c.toggleClass("checked",d.is(":checked"));b._togglePlantImputElem(c,true)})},_togglePlantImputElem:function(d,c){if(c&&d.hasClass("checked")){d.find("td").find("input,select").removeAttr("disabled");var b=d.find("td").find(".jplant-set-input-time");if(b.length>0&&b.find("#jplant-set-input-all-day").is(":checked")){b.find("select").attr("disabled","disabled")}}else{d.find("td").find("input,select").attr("disabled","disabled");d.find("td").find(".jco-validation-number").val("")}},_getPlantDlgOptions:function(){var b=this;return{guide_chk:desknets.Resource.plant.pselGuide_chk,guide:desknets.Resource.plant.pselGuide_list,pgrouptop:desknets.Resource.chooser.allGroupName,template:b.TMPL_ITEMMULTI}},_getPlantCopyDlgOptions:function(){var b=this;return{template:b.TMPL_ITEMONE,change:function(){b._getPlantTemplateSelected()}}},_getPlantTemplateSelected:function(){var b=this;var c;var d;var e=b.$mjPage.find("#plantmg-chgpkg-selplant").find('input[name="id"]').val();if(!e||e==b._refPid){return}c=desknets.getUrl(desknets.MODULE_API_MAIN);b._refPid=e;d={};d.cmd=desknets.plantset.PAGE_PLANTSETDISPSELPLANT;d.id=b._refPid;desknets.ajax.rest({url:c,data:d,dataType:desknets.ajax.RESTYPE_HTML,success:function(f){b._setPlantLimit(f)}})},_setPlantLimit:function(d){var b=this;var c=a("<div>").html(d);b._dispPlantLimitTime(c.find(".jplant-disp-startendtime"));b._dispPlantLimitUseTime(c.find(".jplant-disp-usetime"));b._dispPlantLimitHolidayUse(c.find(".jplant-disp-holidayuse"));b._dispPlantLimitReserv(c.find(".jplant-disp-reservlimit"));b._dispPlantLimitReservSch(c.find(".jplant-disp-reservschlimit"));b._onChangePlantEntryPGroup(c.find('input[name="assigngroup"]').val(),c)},_onSuccessPlantGetPGroup:function(d,c){var b=this;if(!c){b.callBase("_onSuccessPlantGetPGroup",d,b.$mjPage.find("#jplant-chgpkg-type-1"))}else{b.callBase("_onSuccessPlantGetPGroup",d,c);b.$mjPage.find("#jplant-chgpkg-type-2").html(c.html())}},_getAddExecCmd:function(){return desknets.plantset.CMD_PLANTSETENTRYMULTI},_dispPlantLimitTime:function(c){var f;var b=c.find('input[name="startendtimeuse"]').val();if(b=="2"){f=desknets.Resource.plant.inheritPGroup}else{var e=c.find('input[name="starttime"]').val();var d=c.find('input[name="endtime"]').val();f=desknets.sch.util.plant.limitTime(e,d)}c.find("td").html(f)},_dispPlantLimitUseTime:function(b){var d;var c=b.find('input[name="usetime"]').val();if(!c||c=="0"){d=desknets.Resource.plant.inheritPGroup}else{d=desknets.sch.util.plant.limitUseTime(c)}b.find("td").html(d)},_dispPlantLimitHolidayUse:function(c){var d;var b=c.find('input[name="holidayuse"]').val();if(!b){d=desknets.Resource.plant.inheritPGroup}else{d=desknets.sch.util.plant.limitHolidayUse(b)}c.find("td").html(d)},_dispPlantLimitReserv:function(e){var f;var b=e.find('input[name="reserve_limit_use"]').val();if(b==""){f=desknets.Resource.plant.inheritPGroup}else{var d=e.find('input[name="reserve_limited_num"]').val();var c=e.find('input[name="reserve_limited_date"]').val();f=desknets.sch.util.plant.limitReserv(b,d,c)}e.find("td").html(f)},_dispPlantLimitReservSch:function(b){var c;var d=b.find('input[name="reservschlimit"]').val();if(!d){c=desknets.Resource.plant.inheritPGroup}else{c=desknets.sch.util.plant.limitReservSch(d)}b.find("td").html(c)},_inputAjaxFormOption:function(){var c={};var b=this;var c=b.callBase("_inputAjaxFormOption");c.dataType=desknets.ajax.RESTYPE_JSON;return c},_updatePlantListId:function(c){var d=c.managegroup;var b=c.assigngroup;if(!d){d="all"}if(!b){b="0"}this._setPlantBackPageId(d,b)}});desknets.page(desknets.plantset,"plantmsetschimport",desknets.plantset.plantpsetschimport,{_getSchPlantDlgOptions:function(){var b=this.callBase("_getSchPlantDlgOptions");a.extend(b,{cmd:desknets.plant.CMD_PLANTMSETSELPLANT,cmdgrp:desknets.plant.CMD_PLANTMSETSELPGROUP});return b}});desknets.page(desknets.plantset,"plantmsetschexport",desknets.plantset.plantpsetschexport,{_getSchPlantDlgOptions:function(){var b=this.callBase("_getSchPlantDlgOptions");a.extend(b,{cmd:desknets.plant.CMD_PLANTMSETSELPLANT,cmdgrp:desknets.plant.CMD_PLANTMSETSELPGROUP});return b}});desknets.page(desknets.plantset,"plantmsetexport",desknets.PageExport,{init:function(){var b=this;b.callBase("init");var c={assign:true,pageID:"jplant-export",fldName:"managegroup"};var d={};var e=a(".jco-sel-btn");if(e.data("type")=="assign"){d={allGroup:"choosable",allGroupLabel:desknets.Resource.plant.commonassignGroupName,cmdgroups:"constructmsetugroups",cmdgrouptree:"constructmsetcmdgrouptree",moduletype:e.data("module")}}else{d={allGroup:"choosable",unassignGroupLabel:desknets.Resource.plant.commonGroupName,unassignGroup:"choosable"}}desknets.page.groupSelect.init(c,d,true)}});desknets.page(desknets.plantset,"plantmsetimport",desknets.PageImport,{});desknets.page(desknets.plantset,"plantsetadmin",desknets.PageBase,{});desknets.page(desknets.plantset,"plantsetgen",desknets.PageSet,{init:function(){var d=a("#frm");var c=true;var b={chooseMinute:false,maxHour:12,required:true};desknets.timePicker.create(a('input[name="start"]'),b);desknets.sch.util.plant.setGroupSelect(jsonRest,desknets.Resource.sch.plantg_sel_allref,d.find("[name=Group]"));desknets.plantset.choicePlantLimited(d.find("[name=reservlimituse]"),true);desknets.schset.dispRokuyou(a("#frm"),a(".jplant-rokuyou-disp"));this.callBase("init")},_getNextCmd:function(){return desknets.plantset.PAGE_PLANTSETADMIN}});desknets.page(desknets.plantset,"plantsetmanager",desknets.PageAdmin,{_getSetCondition:function(){return true},_getNextCmd:function(){return desknets.plantset.PAGE_PLANTSETADMIN}});app.addInitialAction(function(){desknets.plantset.init()})})(jQuery);