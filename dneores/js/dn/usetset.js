/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.usetset={PAGE_USETPSETGEN:"usetpsetgen",PAGE_USETMSETUSERS:"usetmsetusers",PAGE_USETMSETUSERENTRY:"usetmsetuserentry",PAGE_USETMSETIMPORT:"usetmsetimport",PAGE_USETMSETEXPORT:"usetmsetexport",CMD_USETUSERPHOTODEL:"usetcmduserphotodelete",CMD_USETMSETUSERS:"usetmsetcmdusers",CMD_USETMSETUSERENTRY:"usetmsetcmduserentry",CMD_USETMSETUSERDEL:"usetmsetcmduserdelete",CMD_USETMSETUSERDELCONF:"usetmsetcmduserdelconf",CMD_USETMSETSEARCHDEL:"usetmsetcmdsearchdelete",CMD_USETMSETSEARCHDELCONF:"usetmsetcmdsearchdelconf",CMD_USETMSETMVUSERS:"usetmsetcmdmvusers",CMD_USETMSETGROUPASSIGNENTRY:"usetmsetcmdgroupassignentry",CMD_USETMSETSORTPOST:"usetmsetcmdsortpost",CMD_USETMSETIMPORT:"usetmsetcmdimport",CMD_USETMSETGROUPTREE:"usetmsetcmdgrouptree",CMD_USETMSETGROUPS:"usetmsetcmdgroups",CMD_USETMSETALLGROUPTREE:"usetmsetcmdallgrouptree",PAGE_USETMSETIMPORTGUIDE:"usetmsetimportguide",PAGE_USETMSETIMPORTGUIDELANGLIST:"usetmsetimportguidelanglist",PAGE_USETMSETIMPORTGUIDETZLIST:"usetmsetimportguidetzlist",PAGE_USETMSETSEARCH:"usetmsetsearch",CMD_USETMSETSEARCH:"usetmsetcmdsearch",CMD_USETMSETUSERSUSPENSION:"usetmsetcmdusersuspension",CMD_USETMSETUSERDELCANCEL:"usetmsetcmduserdelcancel",CMD_USETMSETUSERLOGINRESET:"usetmsetcmduserloginreset",PAGE_USETMSETGROUPS:"usetmsetgroups",PAGE_USETMSETGROUPENTRY:"usetmsetgroupentry",PAGE_USETMSETGROUPIMPORT:"usetmsetgroupimport",PAGE_USETMSETGROUPEXPORT:"usetmsetgroupexport",CMD_USETMSETGROUPLIST:"usetmsetcmdgrouplist",CMD_USETMSETGROUPDELETE:"usetmsetcmdgroupdel",CMD_USETMSETGROUPENTRY:"usetmsetcmdgroupentry",CMD_USETMSETGROUPMVSEQNO:"usetmsetcmdgroupmovseq",CMD_USETMSETGROUPMVLEVEL:"usetmsetcmdgroupmovlevel",CMD_USETMSETGROUPIMPORT:"usetmsetcmdgroupimport",PAGE_USETSETADMIN:"usetsetadmin",PAGE_USETSETGEN:"usetsetgen",PAGE_USETSETMANAGER:"usetsetmanager",KEY_GROUP:"Group",KEY_ASSIGNGROUP:"assigngrp",KEY_NAME:"Name",KEY_SUSPENSION:"suspended",KEY_LOGINLOCK:"loginlock",KEY_DELETED:"deleted",VAL_DEFGROUP:"1",DATA_CMD:"cmd",init:function(){var b=this;var c=a("#jco-pv-funcid").val();if(desknets.uset.isLoadOnly(c)){return}desknets.pageframe.setFuncSel(c);if(c==b.PAGE_USETPSETGEN){desknets.uset.subwin.init();desknets.usetset.usetpsetgen.init()}if(c==b.PAGE_USETMSETUSERS){desknets.hashobserver.init(desknets.usetset);desknets.usetset.msubwin.init();desknets.usetset.usetmsetusers.init()}else{if(c==b.PAGE_USETMSETGROUPS){desknets.hashobserver.init(desknets.usetset);desknets.usetset.msubwin.init();desknets.usetset.usetmsetgroups.init()}else{if(c==b.PAGE_USETMSETIMPORT){desknets.usetset.msubwin.init();desknets.usetset.usetmsetimport.init()}else{if(c==b.PAGE_USETMSETEXPORT){desknets.usetset.msubwin.init();desknets.usetset.usetmsetexport.init()}else{if(c==b.PAGE_USETMSETGROUPIMPORT){desknets.usetset.msubwin.init();desknets.usetset.usetmsetgroupimport.init()}else{if(c==b.PAGE_USETMSETGROUPEXPORT){desknets.usetset.msubwin.init();desknets.usetset.usetmsetgroupexport.init()}else{if(c==b.PAGE_USETSETADMIN){desknets.usetset.usetsetadmin.init()}else{if(c==b.PAGE_USETSETGEN){desknets.usetset.usetsetgen.init()}else{if(c==b.PAGE_USETSETMANAGER){desknets.usetset.usetsetmanager.init()}}}}}}}}}}};desknets.page(desknets.usetset,"usetpsetgen",desknets.PageSet,{_getNextCmd:function(){return desknets.uset.PAGE_USETINDEX}});desknets.page(desknets.usetset,"usetmsetusers",desknets.PagePaneListBase,{_tree:null,_optTreeId:"data-id",$_postSortDlg:null,_initSetLeftTree:function(){},initLeftTree:function(){var b=this;b._tree=a.extend({},desknets.usetset.usetgroupTree);b._tree.options=b._getOptionLeftTree();b._tree.init(b.$mjListPage,b._getOptionLeftTree())},_getOptionLeftTree:function(){var b=this;var d=b.callBase("_getOptionLeftTree");d.module=desknets.MODULE_API_MAIN;d.cmdgroups=desknets.usetset.CMD_USETMSETGROUPS;d.cmdgrouptree=desknets.usetset.CMD_USETMSETGROUPTREE;d.chooseTarget=["user"];d.moduletype="uset";var c=b.$mjListPage.find(".jco-back-page-data").find('input[name="gid"]').val();d.defaultGroupId=c;return d},_getSortableOptions:function(){var b=this;var c;c=a.extend({},b.callBase("_getSortableOptions"),{sortParamFilter:function(e){var d=b.$mjListPage.find(".jco-back-page-data").find('input[name="gid"]').val();e.gid=d}});return c},_addOptDraggableList:function(){var b=this;return{stop:function(f,d){var c=b.$mjListPage.find(".co-listview-tree");b.$mjListPage.find(".ui-layout-resizer").css({"z-index":1});setTimeout(function(){c.find("a.co-listview-item-inside").removeClass("stdrag");c.find("a.co-listview-item-inside").removeClass("co-tree-noselect")},100);c.css("background","#ffffff")}}},_getMoveSubmitParams:function(){var c=this;var b={success:function(e,d,f){if(c._checkChangeLoginDefGroup()){c._locationPageTop();return}c.$mjListPage.find(".co-btn-update").addClass("on");c._getListAjax(c._getListRow());c._moveSuccessAddFunc()}};return b},_isMoveListSeqno:function(){return true},treeUpdateListWidth:function(){this._tree.resize()},treeUpdateList:function(){this._tree.updateTreeList()},_initSet:function(){var b=this;b._initListSortPost();if(desknets.pageframe.getTopMsg().hasClass("alert")||desknets.pageframe.getTopMsg().hasClass("info")){desknets.pageframe.viewTopMsg("","")}b.initLeftTree();b.callBase("_initSet")},getInputFieldName:function(){return"gid"},_getListAjaxSuccess:function(d){var c=this;var b=c.$mjListPage.find(".juset-mset-listcount").text("0");b.text(d.allcnt);c.callBase("_getListAjaxSuccess",d);a.each(c.$mjListPage.find(".uset-maillink"),function(e,f){desknets.htmlparts.setUpMailLink(a(this))});c._switchDragEnabledUsers();c._setOtherFuncButton()},_switchDragEnabledUsers:function(){if(this._isCheckSelectedSuspensionUsers()||this._isCheckSelectedLoginLockUsers()||this._isCheckSelectedLogicalDeleteUsers()){this.setlistSortableDisabled()}else{this.setlistSortableEnabled()}},_isCheckSelectedSuspensionUsers:function(){var b=desknets.paramanalyzer.getHashParams();if(b.gid==desknets.usetset.KEY_SUSPENSION){return true}return false},_isCheckSelectedLoginLockUsers:function(){var b=desknets.paramanalyzer.getHashParams();if(b.gid==desknets.usetset.KEY_LOGINLOCK){return true}return false},_isCheckSelectedLogicalDeleteUsers:function(){var b=desknets.paramanalyzer.getHashParams();if(b.gid==desknets.usetset.KEY_DELETED){return true}return false},_setOtherFuncButton:function(){var b=this.$mjListPage.find(".jco-back-page-data");var i=b.find('input[name="gid"]').val();var f=a("#uset-msetusers-otherfunc-btn").find(".juset-msetlist-sortpost");var e=a("#uset-msetusers-otherfunc-btn").find(".juset-msetlist-suspension");var h=a("#uset-msetusers-otherfunc-btn").find(".juset-msetlist-loginreset");var c=this.$mjListPage.find("input.jco-list-move");var g=b.find('input[name="fldsort"]').val();var d=b.find('input[name="order"]').val();if(i==desknets.usetset.KEY_SUSPENSION||i==desknets.usetset.KEY_LOGINLOCK||i==desknets.usetset.KEY_DELETED){f.attr("disabled",true);f.find("a").attr("disabled",true);c.attr("disabled",true);if(i==desknets.usetset.KEY_DELETED){e.attr("disabled",true);e.find("a").attr("disabled",true);h.attr("disabled",true);h.find("a").attr("disabled",true)}else{e.attr("disabled",false);e.find("a").attr("disabled",false);h.attr("disabled",false);h.find("a").attr("disabled",false)}}else{f.attr("disabled",false);f.find("a").attr("disabled",false);if(g=="SEQNO"&&d=="1"){c.attr("disabled",false)}else{c.attr("disabled",true)}e.attr("disabled",false);e.find("a").attr("disabled",false);h.attr("disabled",false);h.find("a").attr("disabled",false)}var j=a("#juset-msetusers").find(".juset-set-loginfailures").val();if(!j||j==0){a(".juset-loginlock-norequire").remove()}},changPage:function(){var b=this;if(b._tree){var c=b.$mjListPage.find(".jco-back-page-data").find('input[name="gid"]').val();if(c=="suspended"){c="all"}if(c=="loginlock"){c="all"}b._tree.options.defaultGroupId=c}b.callBase("changPage")},_listDelSubmit:function(e){var b=this;e.preventDefault();if(b.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){var c=b.$mjListPage.find(".jco-back-page-data").find('input[name="gid"]').val();if(neo.isSet(c)&&c=="all"){var d=desknets.Resource.Message.uset_del_alluser;desknets.dialog.alert(d,{type:"warn"});return}}b.callBase("_listDelSubmit",e)},_getDelAddPrm:function(){var b=this;var c=b.$mjListPage.find(".jco-back-page-data").find('input[name="gid"]').val();var d={gid:c};return d},_initListSortPost:function(){var b=this;var c=b.$mjListPage.find(".uset-mset-pop-psort");var d=a("#uset-msetusers-otherfunc-btn");d.find(".juset-msetlist-sortpost").click(function(g){if(a(this).attr("disabled")=="disabled"){return false}d.removeClass("show");g.preventDefault();var h=b.$mjListPage.find(".co-listview");var f=b.$mjListPage.find(".jco-back-page-data").find('input[name="gid"]').val();var e=desknets.usetset.usetgroupTree.getItemObject_li(h,f,b._getOptionLeftTree());var i=a.trim(e.children("a.co-listview-item-inside").text());c.find("span.juset-msetlist-gtitle").text(i);c.find("input.juset-mset-pop-gid").val(f);if(b.$_postSortDlg==null){b._setDialogSortPost()}else{b.$_postSortDlg.dialog("open").find('input[type="button"]').blur()}});c.delegate("input.juset-mset-psort-asc","click",function(e){c.find("input.juset-mset-pop-order").val("1");b._listSortPostCode(c)});c.delegate("input.juset-mset-psort-desc","click",function(e){c.find("input.juset-mset-pop-order").val("-1");b._listSortPostCode(c)})},_setDialogSortPost:function(){var c=this;var b=a(".uset-mset-pop-psort");var d=desknets.dialog.getDialogOption();var e={buttons:{},dialogClass:"dn-dialog",title:desknets.Resource.confirmDefaultTitle,width:500};e.buttons[desknets.Resource.CancelButtonLabel]=function(){b.dialog("close")};a.extend(d,e);desknets.dialog.setUp(b,d);b.dialog("open").find('input[type="button"]').blur();c.$_postSortDlg=b;desknets.dialog.setFirstDialogOpen(b)},_listSortPostCode:function(b){var c=this;var f={};var h={};var e={};if(!neo.isSet(b)){return}desknets.submitform.setDialogDisabled(b);var g=desknets.paramanalyzer.getHashParams();g.fldsort="SEQNO";g.order="1";c._setLocationHash(g);h.cmd=c._getSortPostListCmd();h.postorder=b.find("input.juset-mset-pop-order").val();h.gid=b.find("input.juset-mset-pop-gid").val();var d=c.getListParamToObj();f["0"]=h;f["1"]=d;e=a.extend({},c._getListAjaxOptionsExec(b));c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,f,e)},_listLine:function(b,c){b=this._listLineCmd(b);b=desknets.uset.edit.editIndexListLine(b,c,this._replaceListLine);return b},_getListDispCmd:function(){return this._getListAddCmd()},_getRequestMoveConfParams:function(b){var d=this;var c={};var e={};c=d.callBase("_getRequestMoveConfParams",b);e.gidold=c.gid;d._moveParams=a.extend({},c,e);return e},_checkChangeLoginDefGroup:function(){var c=this;var d;var b=[];var h=desknets.pageframe.getLoginUid();var e=desknets.pageframe.getLoginDefGroup();if(!neo.isSet(h)||!neo.isSet(e)){return false}if(!neo.isSet(c._moveParams)){return false}var f=c._moveParams.destid;var g=c._moveParams.gidold;var b=c._moveParams.id;if(e.length==0){return false}if(neo.isSet(g)&&e!=g&&e!="all"){return false}if((neo.isSet(f)&&f!="0")&&(neo.isSet(g)&&g=="all")){return false}if(neo.isSet(b)&a.isArray(b)){for(d=0;d<b.length;d++){if(b[d]==h){break}}if(d>=b.length){return false}}return true},_locationPageTop:function(){var d=this;var c=a("#dn-main").find("#co-m-h-setting-menus");var b=c.find("#"+d._getListCmd()).find("a");desknets.clickAlink(b)},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b._setEventOtherFuncButton()},_setEventOtherFuncButton:function(){var b=this;var d;var c=a("#uset-msetusers-otherfunc-btn");c.find(".juset-msetlist-suspension").click(function(e){e.preventDefault();b._eventOtherFuncButton(a(this),"suspended");c.removeClass("show")});c.find(".juset-msetlist-loginreset").click(function(e){e.preventDefault();b._eventOtherFuncButton(a(this),"loginreset");c.removeClass("show")})},_eventOtherFuncButton:function(d,b){var i=this;var h=0;var e=[];var f;var c={};var j={};var g={};if(!d||!b){return}if(b=="suspended"){f=i._getMessageNoChkSuspension(d.hasClass("on"));if(d.hasClass("on")){g[desknets.usetset.KEY_SUSPENSION]="on"}else{g[desknets.usetset.KEY_SUSPENSION]="off"}g.cmd=i._getSuspensionCmd()}else{if(b=="loginreset"){f=i._getMessageNoChkLoginReset();g.cmd=i._getLoginResetCmd()}}i.$mjListPage.find("input[type=checkbox]").each(function(){if(a(this).attr("checked")){h++;return false}});if(h<1){desknets.dialog.alert(f,{type:"warn"});return}if(i.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){e=desknets.PRM_VAL_ALLDEL}else{i.$mjListPage.find('input[name="'+i._getIDName()+'"]:checked').each(function(){e[e.length]=a(this).val()})}g=a.extend(g,i._getAddPageParam());g[i._getIDName()]=e;i._mchkIDs=i._getListAjaxGetId();c=i.getListParamToObj();j=a.extend({url:desknets.getUrl(i._getRestModule()),data:desknets.ajax.arrayToMultiCmdData([g,c])},i._getListAjaxOptionsExec(null));desknets.ajax.rest(j)},_getMessageNoChkSuspension:function(b){var c="";if(b){c=desknets.Resource.Message.uset_suspension_nochecked_on}else{c=desknets.Resource.Message.uset_suspension_nochecked_off}return c},_getMessageNoChkLoginReset:function(){var b="";b=desknets.Resource.Message.uset_loginreset_nochecked;return b},_getSuspensionCmd:function(){return desknets.usetset.CMD_USETMSETUSERSUSPENSION},_getLoginResetCmd:function(){return desknets.usetset.CMD_USETMSETUSERLOGINRESET},_getAddPageParam:function(){var b=this;var c=b.$mjListPage.find(".jco-back-page-data");var d=c.find('input[name="gid"]').val();desknets.pageframe.closeTopMsg();return{gid:d}},_getModPageParam:function(){return this._getAddPageParam()},_getListCmd:function(){return desknets.usetset.PAGE_USETMSETUSERS},_getListExecCmd:function(){return desknets.usetset.CMD_USETMSETUSERS},_getListAddCmd:function(){return desknets.usetset.PAGE_USETMSETUSERENTRY},_getListModCmd:function(){return this._getListAddCmd()},_getDelCmd:function(){desknets.pageframe.closeTopMsg();return desknets.usetset.CMD_USETMSETUSERDELCONF},_getDelExecCmd:function(){return desknets.usetset.CMD_USETMSETUSERDEL},_getSortableListCmd:function(){return desknets.usetset.CMD_USETMSETMVUSERS},_getSortPostListCmd:function(){return desknets.usetset.CMD_USETMSETSORTPOST},_getMoveListCmd:function(){return desknets.usetset.CMD_USETMSETGROUPASSIGNENTRY},_getListEntryClass:function(){return desknets.usetset.usetmsetuserentry},_getListModClass:function(){return this._getListEntryClass()},initParamsFromHash:function(c){var b=this;b.changeSubWin();b.callBase("initParamsFromHash",c)},changeSubWin:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(b.cmd)||(b.cmd==c._getListCmd()&&b.gid!="all")||(b.cmd=="usetmsetsearch"&&b.descendant!="all")){desknets.usetset.msubwin.setSubWinSelectDescendant(true)}else{desknets.usetset.msubwin.setSubWinSelectDescendant(false)}},_hashUpdatePageView:function(d){var c=this;var e=desknets.paramanalyzer.getHashParams();var b="#"+c._getIdListSearchPage();if(a(b).find(".jco-title").length>0){desknets.usetset.usetmsetsearch._getListAjax(e.row)}else{desknets.usetset.usetmsetsearch.initPage(c._getListCmd(),c._getIdListPage())}c.mhashBackCmd=c._getListSearchCmd();c.mhashIdBack=c._getIdListSearchPage()},_getIdListSearchPage:function(){return desknets.usetset.usetmsetsearch._getIdListPage()},_getListSearchCmd:function(){return desknets.usetset.PAGE_USETMSETSEARCH}});desknets.page(desknets.usetset,"usetgroupTree",desknets.groupTree,{TMPL_ROOT_START:'<ul><li data-id="" class="jstree-open co-listview-item"><a class="root-group no-link">{{name}}</a>',TMPL_ITEM_ALL:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item jco-tree-nodrop"><a href="#" class="co-listview-item-inside {{classes}} {{subType}}">{{name}}</a>',_boGetRoot:false,_boUpdate:false,_isAssignManager:false,_getSideTreeList:function(c){var b=this;if((typeof jsonRestGroup)!="undefined"&&b._boUpdate==false){b._createTree(c,b._getFirstHtmlFromJson(jsonRestGroup))}else{b.loadTree(c)}c.bind("loaded.jstree",function(d,e){var g=b.options.defaultGroupId;var f=desknets.paramanalyzer.getHashParams();if(f.gid){g=f.gid}var h=b.getItemObject_li(c,g);b._delRootFolderAct(c);b._onSelectItem(null,h.children("a:first"));setTimeout(function(){b._updateItemsWidth();b.onSelectItemNoAjax(c,g);b._updateScrollTopValue(h)},100)})},_getFirstHtmlFromJson:function(c){var b=this;b._boGetRoot=true;if(neo.isSet(c)&&neo.isSet(c.Group)){b.options.defaultGroupId=c.Group}if(neo.isSet(c)&&neo.isSet(c.flgmanagegrp)&&c.flgmanagegrp=="1"){b._isAssignManager=true}return b.callBase("_getFirstHtmlFromJson",c)},_getItemHtmlFromItemData:function(d){var c=this;var b;var e="";if(c._isAssignManager){}else{if(d.id=="all"){b=c.TMPL_ITEM;c.TMPL_ITEM=c.TMPL_ITEM_ALL}else{if(d.id=="suspended"){b=c.TMPL_ITEM;c.TMPL_ITEM=c.TMPL_ITEM_ALL}else{if(d.id=="loginlock"){b=c.TMPL_ITEM;c.TMPL_ITEM=c.TMPL_ITEM_ALL}else{if(d.id=="deleted"){b=c.TMPL_ITEM;c.TMPL_ITEM=c.TMPL_ITEM_ALL}}}}}e=c.callBase("_getItemHtmlFromItemData",d);if(c._isAssignManager){e=desknets.tmpl.replaceWord(e,"title",d.title)}else{if(d.id=="all"){c.TMPL_ITEM=b}else{if(d.id=="suspended"){c.TMPL_ITEM=b}else{if(d.id=="loginlock"){c.TMPL_ITEM=b}else{if(d.id=="deleted"){c.TMPL_ITEM=b}}}}}return e},_delRootFolderAct:function(c){var b=c.find(".co-listview-tree-rootli-nosel");if(b.length==0){return}b.removeClass("jstree-last");b.removeClass("jstree-open");b.removeClass("jstree-closed")},getHtmlFromJson:function(d){var c=this;var b=desknets.ajax.getJsonItems(d);if(c._boGetRoot==true&&c._isAssignManager==false){d.allcnt++;b.unshift({id:"all",children:"0",parent:"",Name:desknets.Resource.chooser.allUserName});d.allcnt++;b.push({id:"0",children:"0",parent:"",Name:desknets.Resource.chooser.unassignGroupName});d.allcnt++;b.push({id:"suspended",children:"0",parent:"",Name:desknets.Resource.chooser.suspensionGroupName});var e=a("#juset-msetusers").find(".juset-set-loginfailures").val();if(!!e&&e>0){d.allcnt++;b.push({id:"loginlock",children:"0",parent:"",Name:desknets.Resource.chooser.loginlockGroupName})}d.allcnt++;b.push({id:"deleted",children:"0",parent:"",Name:desknets.Resource.chooser.deletedUsersGroupName});if(!d.list){d.list={};d.list.item=[]}d.list.item=b}c._boGetRoot=false;c._boUpdate=false;return c.callBase("getHtmlFromJson",d)},_selectOnLoaded:function(b){},updateTreeList:function(){var b=this;var d=b.$_tree;var c=a.jstree._reference(b.$_tree);if(a.isEmptyObject(c)){return}d.closest(".co-listview-tree").hide();b._boGetRoot=true;b._boUpdate=true;c.destroy();b._getSideTreeList(d)}});desknets.page(desknets.usetset,"usetmsetuserentry",desknets.PageInputBase,{MODULE_SREFER:"zsrefer",_tmplChooserGroup:'<tr class="juset-entry-selgroup"><td class="uset-entry-selgroup-td"><a title="{{L_Delete}}" href="#" class="co-btn co-btn-close">x</a><span class="juset-entry-selgroup-text" title="{{longName}}">{{name}}</span><input type="hidden" name="assigngroup" value="{{id}}" /></td><td class="co-tright"><input type="radio" id="juset-entry-defbtn{{id}}" name="Group" class="co-user-edit-maingroup" value="{{id}}"/>&nbsp;<label for="juset-entry-defbtn{{id}}" >{{L_DefGroup}}</label></td></tr>',_defGroup:"",_boUserPhoto:false,mlinehtml:"",_initSet:function(c){var b=this;b._tmplChooserGroup=desknets.tmpl.replaceWordHtml(b._tmplChooserGroup,"L_Delete",desknets.Resource.deselectLabel);b._tmplChooserGroup=desknets.tmpl.replaceWordHtml(b._tmplChooserGroup,"L_DefGroup",desknets.Resource.uset.defGroup);b.callBase("_initSet",c);if(!desknets.pageframe.isCost()){b.$mjPage.find("#juset-profile-cost-data").remove()}else{b._initSetCost()}},_initSetCost:function(){var b=this;b.mlinehtml='<li><input type="hidden" name="dep_st_name" value="{{dep_st_name}}"><input type="hidden" name="arv_st_name" value="{{arv_st_name}}"><input type="hidden" name="line_name" value="{{line_name}}"><a href="#" class="del" title="'+desknets.Resource.deselectLabel+'"></a><dl><dt>'+desknets.Resource.cost.section+'<span class="co-colon-span">:</span></dt><dd><div class="start">{{dep_st_nameview}}</div><div class="goal">{{arv_st_nameview}}</div><div class="line"></div></dd></dl></li>';var d=null;var c={type:"teiki",oncomplete:function(e){if(d!=null){$this.remove()}b.makeTransportationOk(e)},};b.$mjPage.find(".cost-btn").click(function(e){e.preventDefault();d=null;c.data={dep_st_name:"",arv_st_name:""};c.title=desknets.Resource.cost.title_routine_add;c.mod=false;desknets.cost.search.open(c)});b.$mjPage.find("#uset-profile-cost .list-pass").on("click","li",function(e){e.preventDefault();$this=a(this);if(a(e.target).hasClass("del")){$this.remove();b.makeTransportationClass()}else{d=$this;c.data={dep_st_name:$this.find('input[name="dep_st_name"]').val(),arv_st_name:$this.find('input[name="arv_st_name"]').val()};c.title=desknets.Resource.cost.title_routine_mod;c.mod=true;desknets.cost.search.open(c)}});b.makeTransportationClass()},makeTransportationOk:function(b){var d=this;var c="";a.each(b,function(e,g){var f=d.mlinehtml;f=desknets.tmpl.replaceWordHtml(f,"dep_st_name",desknets.escapeValue(g.dep_st_name));f=desknets.tmpl.replaceWordHtml(f,"arv_st_name",desknets.escapeValue(g.arv_st_name));f=desknets.tmpl.replaceWordHtml(f,"line_name",desknets.escapeValue(g.line_name));f=desknets.tmpl.replaceWordHtml(f,"dep_st_nameview",desknets.tmpl.dispStr(g.dep_st_name));f=desknets.tmpl.replaceWordHtml(f,"arv_st_nameview",desknets.tmpl.dispStr(g.arv_st_name));c=c+f});d.$mjPage.find("#uset-profile-cost .list-pass").append(c);d.makeTransportationClass()},makeTransportationClass:function(){var b=this;var c=b.$mjPage.find("#uset-profile-cost .list-pass");c.find("li").removeClass("last");c.find("li:last").addClass("last");if(c.find("li").length==0){b.$mjPage.find(".cost-pr-nodata").show()}else{b.$mjPage.find(".cost-pr-nodata").hide()}},changPage:function(){var b=this;b.callBase("changPage");b._dispSwitchSuspension();b._dispSwitchLoginReset();b._dispSwitchDeleteButton();var c=b.$mjPage.find("img.co-prof-img").attr("src");if(c.indexOf(b.MODULE_SREFER)==0){b._boUserPhoto=true}else{b._boUserPhoto=false;b.$mjPage.find('input[name="delphotoflg"]').attr("disabled",true)}if(b.$mjPage.find("#uset-table-grp").length>0){b._initUserAssignGroup()}else{b._initUserSelectDialog()}b._usetEntryAddEvent();desknets.htmlparts.setUpForm(b.$mjPage.find("#inputfrm"));setTimeout(function(){b._inputFormSaveToObserver()},1)},_inputAjaxFormOption:function(){var b=this;var c={};c=b.callBase("_inputAjaxFormOption");c.dataType="xml";c.success=function(e,d,f){b._onSuccessUserEntry(e)};return c},_onSuccessUserEntry:function(d){var c=this;var b=c.$mjPage.find('input[name="delphotoflg"]');var e=c.$mjPage.find('input[name="photo"]').val();var f="";var g=c.$mjPage.find("input.co-user-edit-maingroup").filter(":checked");if(g.length>0){f=g.closest("tr.juset-entry-selgroup").find('input[name="assigngroup"]').val()}if(neo.isSet(f,{blank:false})&&neo.isSet(c._defFormVals)&&!neo.isSet(c._defFormVals.id,{blank:false})){a("#jco-m-list-container").find(".jco-back-page-data").find('input[name="gid"]').val(f)}if(c._boUserPhoto&&b.attr("checked")&&!neo.isSet(e,{blank:false})){c._inputDelIconConfDialog()}else{c._setLocationHashForm()}},_inputDelIconConfDialog:function(){var b=this;var e=desknets.Resource.Message.uset_del_usericon;var d={cancel:function(){b._setLocationHashForm()}};var c=desknets.dialog.confirm(e,function(){desknets.submitform.setDialogDisabled(c);b._inputDelIconAjax(c);return false},d)},_inputDelIconAjax:function(d){var b=this;var e={};var c=desknets.getUrl(b._getRestModule());e.cmd=b._getDelIconExecCmd();e.id=b.$mjPage.find('input[name="id"]').val();desknets.ajax.rest({url:c,data:e,success:function(){b._setLocationHashForm()},complete:function(){desknets.submitform.clearDialogDisabled(d);d.dialog("close")}})},_initUserAssignGroup:function(){var c=this;var b=c.$mjPage.find("input.uset-entry-btn-defgroup");b.show();c._setUserEntryOnTr(c.$mjPage.find('input[name="assigngroup"]'))},_setUserEntryOnTr:function(c){var b=this;a.each(c,function(d,f){var g=a(f);var e=g.closest("tr");if(!g.attr("checked")){e.removeClass("co-tr-selected");e.find("input.co-user-edit-maingroup").attr("disabled",true)}else{e.addClass("co-tr-selected");e.find("input.co-user-edit-maingroup").attr("disabled",false)}})},_initUserSelectDialog:function(){var d=this;var c=d._tmplChooserGroup;var b=function(){var g=d.$mjPage.find("input.uset-entry-btn-defgroup");if(neo.isSet(d._defGroup,{blank:false})){setTimeout(function(){d.$mjPage.find("#juset-entry-defbtn"+d._defGroup).trigger("click")},1)}if(d.$mjPage.find(".juset-entry-selgroup").length>0){g.show()}else{g.hide()}};d._defGroup="";var f=d.$mjPage.find("input.co-user-edit-maingroup").filter(":checked");if(f.length>0){d._defGroup=f.closest("tr.juset-entry-selgroup").find('input[name="assigngroup"]').val()}var e={chooseTarget:["group"],selectedTabIndex:1};if(d.$mjPage.find('input[name="userseladmin"]').val()=="1"){e.cmdgroups="constructmsetugroups";e.cmdgrouptree="constructmsetcmdgrouptree";e.moduletype="uset";e.adminchild=true}desknets.chooser.setUpEntry(d.$mjPage,d._getSetGroups(),{dialogID:"juset-entry-chooser-dialog",initCreate:true,dialogOptions:e,template:c,change:function(){b()}})},_getSetGroups:function(){var c=this;var b=[];c.$mjPage.find(".co-selgroup").find("tr.juset-entry-selgroup").each(function(){var d=a(this);b.push({type:"group",fldName:"assigngroup",id:d.find('input[name="assigngroup"]').val(),name:d.find("span.juset-entry-selgroup-text").text(),description:desknets.tmpl.escapeWord(d.find('input[name="description"]').val())})});return b},_usetEntryAddEvent:function(){var b=this;b._usetEntryEventAssignGroup();b._usetEntryEventDispToggle()},_usetEntryEventAssignGroup:function(){var b=this;var d=b.$mjPage.find(".co-setarea");var c=b.$mjPage.find("input.co-user-edit-maingroup");c.filter(":checked").next().css("visibility","visible");d.delegate("input.co-user-edit-maingroup","click",function(g){var e=a(this);var f=b.$mjPage.find("input.co-user-edit-maingroup");b._defGroup=e.closest("tr.juset-entry-selgroup").find('input[name="assigngroup"]').val();f.next().css("visibility","hidden");e.next().css("visibility","visible")});d.delegate("input.uset-entry-btn-defgroup","click",function(){var e=b.$mjPage.find("input.co-user-edit-maingroup");e.attr("checked",false).next().css("visibility","hidden");b._defGroup=""});if(b.$mjPage.find("#uset-table-grp").length>0){d.delegate("input.juset-entry-assigngroup","change",function(){b._setUserEntryOnTr(a(this))})}},_usetEntryEventDispToggle:function(){var b=this;b.$mjPage.find(".co-user-edit-toggle").click(function(d){d.preventDefault();var c=a(this).toggleClass("on").attr("href");a(c).toggleClass("show")})},_checkChangeLoginDefGroup:function(){var b=this;var d=desknets.pageframe.getLoginUid();var c=desknets.pageframe.getLoginDefGroup();if(!neo.isSet(d)||!neo.isSet(c)){return false}if(!neo.isSet(b._defFormVals)||!neo.isSet(b._defFormVals.id)||!neo.isSet(b._defGroup)){return false}if(b._defFormVals.id!=d){return false}if(b._defGroup!=c){return true}return false},_locationPageTop:function(){var d=this;var c=a("#dn-main").find("#co-m-h-setting-menus");var b=c.find("#"+d.mBackCmd).find("a");desknets.clickAlink(b)},_setLocationHashForm:function(){var b=this;if(b._checkChangeLoginDefGroup()){b._locationPageTop();return}b.callBase("_setLocationHashForm")},_dispSwitchSuspension:function(){var c=this;var b=desknets.usetset.KEY_SUSPENSION;var d=c.$mjPage.find("#inputfrm").find('input[name="'+b+'"]').val();c.$mjPage.find(".juset-input-suspension."+d).hide()},_dispSwitchLoginReset:function(){var c=this;var b=desknets.usetset.KEY_LOGINLOCK;var d=c.$mjPage.find("#inputfrm").find('input[name="'+b+'"]').val();if(!(!!d&&d>0)){c.$mjPage.find(".juset-input-loginreset").hide()}},_dispSwitchDeleteButton:function(){var c=this;var b=desknets.usetset.KEY_DELETED;var d=c.$mjPage.find("#inputfrm").find('input[name="'+b+'"]').val();if(!(!!d&&d>0)){c.$mjPage.find(".juset-input-del-database-conf").hide();c.$mjPage.find(".juset-input-del-cancel").hide()}else{c.$mjPage.find(".jco-input-del-submit-conf").hide();c.$mjPage.find(".jco-input-mod-submit").hide();c.$mjPage.find(".juset-input-suspension.on").hide();c.$mjPage.find(".juset-input-suspension.line").hide()}},_inputButton:function(){var b=this;var c;b.callBase("_inputButton");b.$mjPage.find(".juset-input-suspension").click(function(d){c=a(this);var e=desknets.dialog.confirm(b._getMessageSuspension(c),function(){b._inputButtonUserEntry(c,"suspended")})});b.$mjPage.find(".juset-input-loginreset").click(function(d){var f=a(this);var e=desknets.dialog.confirm(b._getMessageLoginReset(),function(){b._inputButtonUserEntry(f,"loginreset")})});b.$mjPage.find(".juset-input-del-database-conf").click(function(e){var g=a(this);var d={};d.extraMessage=b._getMessageExtraDeleteDatabase();d.extraClass="co-msg-rs co-tcenter-in";var f=desknets.dialog.confirm(b._getMessageDeleteDatabase(),function(){b._inputButtonUserEntry(g,"userdeldatabase")},d)});b.$mjPage.find(".juset-input-del-cancel").click(function(e){var g=a(this);var d={};d.extraMessage=b._getMessageExtraDeleteCancel();d.extraClass="co-msg-rs co-tcenter-in";var f=desknets.dialog.confirm(b._getMessageDeleteCancel(),function(){b._inputButtonUserEntry(g,"userdelcancel")},d)})},_inputButtonUserEntry:function(c,f){var b=this;var e={};if(!c||!f){return}var g=desknets.paramanalyzer.getHashParams();if(f=="suspended"){var d="";if(c.hasClass("on")){d="on"}else{d="off"}e[desknets.usetset.KEY_SUSPENSION]=d;e.cmd=b._getSuspensionCmd()}else{if(f=="loginreset"){e.cmd=b._getLoginResetCmd()}else{if(f=="userdeldatabase"){e.cmd=b._getDelExecCmd();e[desknets.usetset.KEY_DELETED]="on"}else{if(f=="userdelcancel"){e[desknets.usetset.KEY_SUSPENSION]="on";e.cmd=b._getUserDelCancelCmd()}}}}e[b._getIDName()]=g[b._getIDName()];desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),data:e,success:function(i,h,j){a(window).off("beforeunload.pageBase");b.resetFuncBeforeHashChange();b.dispBackListPage()}})},_getMessageSuspension:function(b){var c="";if(b.hasClass("on")){c=desknets.Resource.Message.uset_conf_suspension_on}else{c=desknets.Resource.Message.uset_conf_suspension_off}return c},_getMessageLoginReset:function(){var b="";b=desknets.Resource.Message.uset_conf_loginreset;return b},_getMessageDeleteDatabase:function(){var b="";b=desknets.Resource.Message.uset_conf_deletedatabase;return b},_getMessageExtraDeleteDatabase:function(){var b="";b=desknets.Resource.Message.uset_conf_addmsg_deletedatabase;return b},_getMessageDeleteCancel:function(){var b="";b=desknets.Resource.Message.uset_conf_deletecancel;return b},_getMessageExtraDeleteCancel:function(){var b="";b=desknets.Resource.Message.uset_conf_addmsg_deletecancel;return b},_getSuspensionCmd:function(){return desknets.usetset.CMD_USETMSETUSERSUSPENSION},_getUserDelCancelCmd:function(){return desknets.usetset.CMD_USETMSETUSERDELCANCEL},_getLoginResetCmd:function(){return desknets.usetset.CMD_USETMSETUSERLOGINRESET},_getAddExecCmd:function(){return desknets.usetset.CMD_USETMSETUSERENTRY},_getDelIconExecCmd:function(){return desknets.usetset.CMD_USETUSERPHOTODEL},_getModExecCmd:function(){return this._getAddExecCmd()},_getDelCmd:function(){return desknets.usetset.CMD_USETMSETUSERDELCONF},_getDelExecCmd:function(){return desknets.usetset.CMD_USETMSETUSERDEL}});desknets.page(desknets.usetset,"usetmsetimport",desknets.PageImport,{_initButton:function(){this.callBase("_initButton");a(".juset-import-guide").click(function(b){b.preventDefault();var c=a(b.target).data(desknets.usetset.DATA_CMD);var e=desknets.Resource.uset[c+"Title"];var d=c;if(c=="usetmsetlanglist"){c=desknets.usetset.PAGE_USETMSETIMPORTGUIDELANGLIST}else{c=desknets.usetset.PAGE_USETMSETIMPORTGUIDETZLIST}desknets.DialogGuideList.setUp(c,d,e)})},_chkImport:function(){var c=this;var g="";var b="";var e={};var d=[];g=c._getRestModule();b=c._getChkCmd();var f=desknets.getUrl(g);e.cmd=b;e.execcheck="1";d.success=function(i,h,j){c._makeImport(i)};c._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,e,d)},_getRestModule:function(){return desknets.MODULE_API_MAIN},_getChkCmd:function(){return desknets.usetset.CMD_USETMSETIMPORT}});desknets.page(desknets.usetset,"usetmsetexport",desknets.PageExport,{init:function(){var b=this;b.callBase("init");var c={pageID:"juset-m-export-page"};var d={};var e=a(".jco-sel-btn");if(e.data("type")!="assign"){d={allGroup:"choosable",unassignGroup:"choosable"}}else{d={cmdgroups:"constructmsetugroups",cmdgrouptree:"constructmsetcmdgrouptree",moduletype:e.data("module")}}desknets.page.groupSelect.init(c,d,true)},_getRestModule:function(){return desknets.MODULE_API_MAIN}});desknets.page(desknets.usetset,"msubwin",desknets.uset.subwin,{_initUsetSubWin:function(){},_setInit:function(){var d=this;var b=desknets.paramanalyzer.getHashParams();var c=a("#jco-pv-funcid").val();if(c==desknets.usetset.PAGE_USETMSETUSERS&&b.cmd!=d._getMainCmd()){d.setSubWinSelectDescendant(true)}else{d.setSubWinSelectDescendant(false)}},_getMainCmd:function(){return desknets.usetset.PAGE_USETMSETUSERS},_getSearchCmd:function(){return desknets.usetset.PAGE_USETMSETSEARCH}});desknets.page(desknets.usetset,"usetmsetsearch",desknets.uset.usetsearch,{_getDelAddPrm:function(){var b=this;var d={};var c=desknets.paramanalyzer.getHashParams();if(c==null){return d}d.descendant=c.descendant;d.gid=c.gid;d.Name=c.Name;d.Tel=c.Tel;d.Post=c.Post;d.Mail=c.Mail;return d},_listLine:function(b,c){b=this._listLineCmd(b);return this.callBase("_listLine",b,c)},_getListModCmd:function(){return desknets.usetset.usetmsetusers._getListAddCmd()},_getListDispCmd:function(){return this._getListModCmd()},_getListCmd:function(){return desknets.usetset.PAGE_USETMSETSEARCH},_getListExecCmd:function(){return desknets.usetset.CMD_USETMSETSEARCH},_getDelCmd:function(){return desknets.usetset.CMD_USETMSETSEARCHDELCONF},_getDelExecCmd:function(){return desknets.usetset.CMD_USETMSETSEARCHDEL}});desknets.page(desknets.usetset,"usetsetadmin",desknets.PageBase,{});desknets.page(desknets.usetset,"usetsetgen",desknets.PageSet,{_getNextCmd:function(){return desknets.usetset.PAGE_USETSETADMIN}});desknets.page(desknets.usetset,"usetsetmanager",desknets.PageAdmin,{_getSetCondition:function(){return true},_getNextCmd:function(){return desknets.usetset.PAGE_USETSETADMIN}});desknets.page(desknets.usetset,"usetmsetgroups",desknets.PagePaneListBase,{_tree:null,_optTreeId:"data-id",_boFirst:true,_boUpdateTree:false,_beforeGid:null,_initSet:function(){var b=this;b.initLeftTree();b.callBase("_initSet")},_initSetLeftTree:function(){},initLeftTree:function(){var c=this;c._tree=a.extend({},desknets.usetset.usetmsetgroupsgroupTree);c._tree.options=c._getOptionLeftTree();var b={module:c._getRestModule(),moveCMD:c._getMoveListCmd()};c._tree.init(c.$mjListPage,c._getOptionLeftTree(),b)},_optTreeSelectFunc:function(h){var b=this;var f=h.attr(b._optTreeId);var g=b.$mjListPage.find(".jco-back-page-data");var d=b.getInputFieldName();g.find('input[name="'+d+'"]').val(f);if(b._boFirst==true){var c=desknets.paramanalyzer.getLocationHash();var d=b.getInputFieldName();b._boFirst=false;var e=desknets.paramanalyzer.getHashParams();if(!neo.isSet(e.cmd)||e.cmd==b._getListCmd()){b._setTitlePane(h)}b._firstFolder=f;b._mobjParams[d]=f;if((typeof jsonRest)!="undefined"||(neo.isSet(c)&&c.length>0)){return}b._getListAjax("0")}else{if(!neo.isSet(b._beforeGid)||b._beforeGid!=f){b._listPage("0")}}b._beforeGid=f},_isMoveListSeqno:function(){return true},treeUpdateListWidth:function(){this._tree.resize()},treeUpdateList:function(){this._tree.updateTreeList();this._boUpdateTree=false},getInputFieldName:function(){return"pgid"},_getOptionLeftTree:function(){var b=this;var e=b.callBase("_getOptionLeftTree");var d=function(){b._getListAjax("0")};e.module=desknets.MODULE_API_MAIN;e.cmdgroups=desknets.usetset.CMD_USETMSETGROUPS;e.cmdgrouptree=desknets.usetset.CMD_USETMSETALLGROUPTREE;e.chooseTarget=["user"];e.moduletype="uset";e.adminchild=true;var c=b.$mjListPage.find(".jco-back-page-data").find('input[name="pgid"]').val();e.defaultGroupId=c;e.moveFunc=d;return e},_getSortableOptions:function(){var b=this;var c=b.callBase("_getSortableOptions");c.change=function(d){if(d==null){desknets.dialog.alert(desknets.Resource.Message.set_group_notaccs,{type:"warn"})}else{b._boUpdateTree=true;b._getListAjaxSuccess(d)}};return c},_initListMain:function(){var b=this;var c=desknets.paramanalyzer.getLocationHash();if((typeof jsonRest)=="undefined"&&c==""&&b._boFirst==true){return}b.callBase("_initListMain")},changPage:function(){var b=this;if(b._boUpdateTree){b._firstFolder="";b.treeUpdateList()}b.callBase("changPage");if(neo.isSet(b._firstFolder,{blank:false})){var c=b.$mjListPage.find(".jco-back-page-data");b._firstFolder=c.find('input[name="pgid"]').val()}},_hashUpdateListPage:function(c){var b=this;var d=b.getInputFieldName();var e=c[d];if(!neo.isSet(e,{blank:false})){b._firstFolder=""}b.callBase("_hashUpdateListPage",c)},_getListAjax:function(c){var b=this;if(b._boUpdateTree){b.treeUpdateList()}b.callBase("_getListAjax",c)},_getListAjaxSuccessOtherSet:function(c){var b=this;b.callBase("_getListAjaxSuccessOtherSet",c);if(c.adminflg=="1"){b.$mjListPage.find(".jco-list-add-page").attr("disabled",false);b.$mjListPage.find(".jco-list-del-submit").attr("disabled",false);b.setlistSortableEnabled()}else{b.$mjListPage.find(".jco-list-add-page").attr("disabled",true);b.$mjListPage.find(".jco-list-del-submit").attr("disabled",true);b.setlistSortableDisabled()}},_listDel:function(d,c){var b=this;if(d){b._boUpdateTree=true}b.callBase("_listDel",d,c)},_inputMoveSubmit:function(c){var b=this;b._boUpdateTree=true;b.callBase("_inputMoveSubmit",c)},_startLeftMove:function(){var b=this;var d=b.$mjListPage.find(".co-listview-tree");var g=d.find("a.co-listview-item-inside.on").parent();d.css("background","#f5faff");g.children("a:first").addClass("co-tree-noselect");if(b.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){var f=g.find("li.co-listview-item");f.each(function(){var i=a(this).children("a:first");i.addClass("co-tree-noselect")})}else{var c=b.$mjListPage.find(".co-listview-scroll");var h=c.find("tr.co-tr-selected");var e=[];h.each(function(j,k){e[e.length]=a(this).find(".jco-id").val()});var f=d.find("li.co-listview-item");f.each(function(k,l){var j=a(this);if(a.inArray(j.attr(b._optTreeId),e)>=0){j.children("a:first").addClass("co-tree-noselect");var m=j.find("li.co-listview-item");m.each(function(){var i=a(this).children("a:first");i.addClass("co-tree-noselect")})}})}},_addOptDraggableList:function(){var b=this;return{stop:function(f,d){var c=b.$mjListPage.find(".co-listview-tree");b.$mjListPage.find(".ui-layout-resizer").css({"z-index":1});setTimeout(function(){c.find("a.co-listview-item-inside").removeClass("stdrag");c.find("a.co-listview-item-inside").removeClass("co-tree-noselect")},100);c.css("background","#ffffff")}}},_initLeftItemDrop:function(){var b=this;var c=b.$mjListPage.find("div.co-listview-tree:not(.ui-droppable)");if(!neo.isSet(c)||c.length==0){return}c.droppable({accept:".co-tbody-list",hoverClass:"co-listview-dropover",tolerance:"pointer",drop:function(h,g){var f=a(this);if(!!b._isMoveListSeqno()){f.addClass("jco-tree-dropend")}var d=f.find("li:not(.jco-tree-nodrop)>a").filter(function(){return a(this).hasClass("co-tree-dropactive")});f.find("a.co-listview-item-inside").removeClass("co-tree-dropactive");if(d.length==0||d.hasClass("co-tree-noselect")){return}else{if(a("#co-dragtip").length==0&&a("#co-dragtip-ie8").length==0){return}else{b._dropMoveConf(d.eq(0))}}},activate:function(f,d){a(this).delegate("a.co-listview-item-inside","hover.paneDrop",function(e){if(e.type=="mouseenter"){if(!a(this).hasClass("notunder")&&!a(this).hasClass("under")){a(this).addClass("co-tree-dropactive")}}else{a(this).removeClass("co-tree-dropactive")}})},deactivate:function(f,d){a(this).undelegate("a.co-listview-item-inside","hover.paneDrop")}})},_setDelConfirm:function(f){var c=this;var d=null;var f=c._delConfMessage();var e=c._delConfAddMessage();var b={};b.extraMessage=e;b.extraClass="co-msg-rs";d=desknets.dialog.confirm(f,function(){c._listDel(true,d);return false},b)},_delConfAddMessage:function(){return desknets.Resource.Message.set_group_delconf},_initListStartModLink:function(){var b=this;b.$mjTableList.delegate(".jco-modlink","click",function(d){d.preventDefault();var c=a(this).parent().parent().find(".jco-id").val();b.inputModPage(c)})},_getAddPageParam:function(){var b=this;var c=b.$mjListPage.find(".jco-back-page-data");var d=c.find('input[name="pgid"]').val();b._beforeGid=d;return{pgid:d}},_getDelAddPrm:function(){return this._getAddPageParam()},_getModPageParam:function(){return this._getAddPageParam()},_getListCmd:function(){return desknets.usetset.PAGE_USETMSETGROUPS},_getListExecCmd:function(){return desknets.usetset.CMD_USETMSETGROUPLIST},_getListAddCmd:function(){return desknets.usetset.PAGE_USETMSETGROUPENTRY},_getListModCmd:function(){return this._getListAddCmd()},_getDelExecCmd:function(){return desknets.usetset.CMD_USETMSETGROUPDELETE},_getSortableListCmd:function(){return desknets.usetset.CMD_USETMSETGROUPMVSEQNO},_getMoveListCmd:function(){return desknets.usetset.CMD_USETMSETGROUPMVLEVEL},_getListEntryClass:function(){return desknets.usetset.usetmsetgroupentry},_getListModClass:function(){return this._getListEntryClass()}});desknets.page(desknets.usetset,"usetmsetgroupsgroupTree",desknets.groupTree,{$_moveObj:null,$_dragli:null,_boUpdate:false,_backHtml:"",_cmds:{module:"",moveCMD:""},TMPL_ROOT_START_DEF:'<ul><li data-id="" class="jstree-open co-listview-item"><a href="#" class="co-listview-item-inside root-group">{{name}}</a>',TMPL_ROOT_START_NOLINK:'<ul><li data-id="" class="jstree-open co-listview-item"><a class="root-group no-link">{{name}}</a>',TMPL_ITEM:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside {{classes}} {{subType}} {{Drag}} {{notunder}} jco-listview-draggable jstree-drop">{{name}}</a>',TMPL_ITEM_NOLINK:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item nolink"><a class="uset-grplistview-item-inside-nolink {{adminunserclasse}} {{classes}} {{subType}} {{notunder}} jco-listview-draggable">{{name}}</a>',init:function(e,d,b){var c=this;a.extend(c._cmds,{},b);c.callBase("init",e,d);c._createEventFolderMove(c._getListParent())},_getRootItemName:function(){return desknets.Resource.folderselect.folderRoot},changeFolderMoveCss:function(d){var b=this;var c=b._getListParent();if(d){setTimeout(function(){c.find("a.co-listview-item-inside").addClass("stdrag")},100);c.css("background","#f5faff")}else{setTimeout(function(){c.find("a.co-listview-item-inside").removeClass("stdrag");c.find("a.co-listview-item-inside").removeClass("co-tree-noselect")},100);c.css("background","#ffffff")}},updateTreeList:function(){var b=this;var c=b.$_tree;b._boUpdate=true;c.closest(".co-listview-tree").hide();b._getSideTreeList(c)},_getItemHtmlFromItemData:function(d){var b=this;var e="";var f=a.vakata.dnd.is_drag;e=b.callBase("_getItemHtmlFromItemData",d);e=desknets.tmpl.replaceWordHtml(e,"Drag",f?"stdrag":"");var c="notunder";if(!d.admin||d.admin=="1"){c=""}if(!!d.admin&&d.admin=="2"){c="under"}e=desknets.tmpl.replaceWordHtml(e,"notunder",c);return e},_createEventFolderMove:function(d){var c=this;var e=c.$_tree;var b=false;e.delegate("a.co-listview-item-inside","hover",function(f){if(a("#co-dragtip").length>0||a("#co-dragtip-ie8").length>0){return}if(a.vakata.dnd.is_drag){if(!b){c.changeFolderMoveCss(true);b=true}return}c.changeFolderMoveCss(false);b=false});e.delegate("a.jco-listview-draggable","mousedown mouseup",function(g){var f=a(this);if(g.type=="mousedown"){a("body").focus();e.delegate("a.co-listview-item-inside","mousemove",function(i){if(a.vakata.dnd.is_drag){c.$_moveObj=f.parent();c.changeFolderMoveCss(true);c._backHtml=e.html();var h=desknets.listviewframe.getScrollBarWidth();c._objMove.treeOff=d.offset();c._objMove.treeWidth=d.width()-h;c._objMove.treeHeight=d.height()-h;e.undelegate("a.co-listview-item-inside","mousemove")}})}else{c.$_moveObj=null;e.undelegate("a.co-listview-item-inside","mousemove")}});e.delegate("li.co-listview-item","mouseup",function(f){return});c._setUpScrollDraggable(d);a("body").bind("mouseup",function(f){c.changeFolderMoveCss(false)})},_getSideTreeList:function(d){var b=this;var c=desknets.paramanalyzer.getHashParams();if(neo.isSet(c)&&neo.isSet(c.pgid)){b.options.defaultGroupId=c.pgid}if((typeof jsonRestGroup)!="undefined"&&b._boUpdate==false){b._createTree(d,b._getFirstHtmlFromJson(jsonRestGroup))}else{b.loadTree(d)}},_createTree:function(e,d){var b=this;var c=desknets.getUrl(this.options.module);e.jstree({plugins:["html_data","dnd","crrm"],crrm:{move:{check_move:function(f){if(f.o==-1||f.r==-1){return false}if(f.p=="before"||f.p=="after"){return false}if(!f.r.children("a:first").hasClass("stdrag")){return false}if(f.r.children("a:first").hasClass("notunder")){return false}if(f.r.children("a:first").hasClass("under")){return false}if(f.r.hasClass("jstree-closed")&&!f.r.find("li.co-listview-item").length==0){return false}var h=f.o.attr(b._itemid);var g=f.r.attr(b._itemid);if(!neo.isSet(h,{blank:false})||!neo.isSet(g,{blank:false})){return false}if(g==f.o.parent().parent().attr(b._itemid)){return false}if(b.$_dragli==null){if(b.$_moveObj==null){b.$_dragli=f.o}else{b.$_dragli=b.$_moveObj}}return true}}},dnd:{drop_finish:function(f){if(b.$_dragli!=null){b._inputMoveConfSubmit(b.$_dragli,f.r.closest("li"))}else{b._moveRollbackHtml()}b.$_dragli=null},open_timeout:1000,copy_modifier:""},html_data:{data:d,ajax:{type:"POST",dataType:"json",url:c,data:function(h){var g=b.getRequestParams(h);var f=a.cookie(desknets.COOKIENAME_STOKEN);if(neo.isSet(f)&&!neo.isSet(g[f])){g[f]="1"}return g},success:function(f){if(!f||f.status=="ng"){desknets.ajax.onError(f.errorno,f.errormessage);return'<li class="folder_dumy"></li>'}return b.getHtmlFromJson(f)},error:function(h,f,g){desknets.ajax.onError(h.status,neo.ajax.getErrorMessage(h))}}}});e.bind("loaded.jstree",function(g,h){var f=b._options.resetFunc;var i="";if(neo.isSet(b.options.defaultGroupId)){i=b.options.defaultGroupId}e.closest(".co-listview-tree").show();var j=b.getItemObject_li(e,i);b._updateItemsWidth();b.onSelectItemNoAjax(e,i);b._onSelectItem(null,j.children("a:first"));setTimeout(function(){b._updateScrollTopValue(j)},100);if(b._boUpdate==true&&neo.isSet(f)&&a.isFunction(f)){setTimeout(function(){f(j)},500)}b._boUpdate=false})},_moveRollbackHtml:function(){var b=this;var c=b.$_tree;if(b._backHtml.length>0){c.html(b._backHtml)}},_inputMoveConfSubmit:function(f,e){var c=this;var d=c._getListParent();var h=c._moveConfMessage(f);var g={cancel:function(){c._moveRollbackHtml();c._updateItemsWidth()}};var b=desknets.dialog.confirm(h,function(){desknets.submitform.setDialogDisabled(b);c._dropFinishAjax(b,f,e);return false},g)},_moveConfMessage:function(c){var b=desknets.Resource.Message.com_folder_move;return desknets.tmpl.replaceWord(b,"FolderName",a.trim(c.children("a:first").text()))},_dropFinishAjax:function(b,g,f){var c=this;var d;var e=c._getListParent();d=desknets.getUrl(c._cmds.module);desknets.ajax.rest({url:d,data:c._getRequestMoveParams(g,f),success:function(){c._backHtml="";if(neo.isSet(c.options.moveFunc)&&a.isFunction(c.options.moveFunc)){c.options.moveFunc()}},error:function(i,h,j){desknets.ajax.onError(i.status,j);c._moveRollbackHtml()},complete:function(){desknets.submitform.clearDialogDisabled(b);c._updateItemsWidth();b.dialog("close")}})},_getRequestMoveParams:function(d,c){var b=this;return{cmd:b._cmds.moveCMD,id:d.attr(b._itemid),destid:c.attr(b._itemid)}},_getFirstHtmlFromJson:function(e){var b=this;var d=false;var g=desknets.ajax.getJsonItems(e);var c=g.length;for(var h=0;h<c;h++){var f=g[h];if(!f.admin||f.admin=="1"||f.admin=="2"){d=true;break}}if(d){b.TMPL_ROOT_START=b.TMPL_ROOT_START_DEF}else{b.TMPL_ROOT_START=b.TMPL_ROOT_START_NOLINK}return b.callBase("_getFirstHtmlFromJson",e)},});desknets.page(desknets.usetset,"usetmsetgroupentry",desknets.PagePaneInputBase,{_tree:null,_tmpSelItem:'<div class="set-grp-parent-grp-wrap"><span class="co-selitem"><span title="{{Name}}">{{Name}}</span><input type="hidden" name="{{fField}}"  value="{{fId}}"/></span></div>',_optTreeId:"data-id",_initSet:function(c){var b=this;if(b.$mjPage.find('input[name="adminflg"]').val()!="1"){b.$mjPage.find(".uset-grpentry-selng").show();b.$mjPage.find(".uset-grpentry-selok").hide()}b.callBase("_initSet",c)},_optTreeSelectFunc:function(d){var b=this;var c=b.$mjPage.find("#jco-add-folder");if(b._isMultiSelect()==false){c.find(".set-grp-parent-grp-wrap").remove()}b.callBase("_optTreeSelectFunc",d)},initLeftTree:function(){var b=this;b._tree=a.extend({},desknets.usetset.usetmsetgroupentrygroupTree);b._tree.options=b._getOptionLeftTree();b._tree.init(b.$mjPage,b._getOptionLeftTree())},getInputFieldName:function(){return"pgid"},_getOptionLeftTree:function(){var b=this;var c=b.callBase("_getOptionLeftTree");c.module=desknets.MODULE_API_MAIN;c.cmdgroups=desknets.usetset.CMD_USETMSETGROUPS;c.cmdgrouptree=desknets.usetset.CMD_USETMSETALLGROUPTREE;c.chooseTarget=["user"];c.moduletype="uset";c.isLag=false;return c},treeUpdateListWidth:function(){if(this._tree){this._tree.resize()}},_setListviewHeight:function(b,h){var d=this;var c=b.find(".co-listview");var i=c.find(".co-setarea");c.height("auto");i.height("auto");var g=i.outerHeight();var f=c.find(".co-listview-left-title").height();var e=desknets.listviewframe.VAL_LISTVIEWFRAME_MINHEIGHT;if(g<e){g=e}c.height(g);c.find(".co-listview-left").height(g);i.height(g);c.find(".co-listview-left-data").height(g-f);if(!neo.isSet(h)||h==true){d.treeUpdateListWidth()}},_inputDelSubmit:function(d){var b=this;var c={};var e=desknets.paramanalyzer.getHashParams();if(d!=null){desknets.submitform.setDialogDisabled(d)}c=b._getDelPrm();c.cmd=b._getDelExecCmd();c[b._getIDName()]=e[b._getIDName()];desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),data:c,success:function(g,f,h){desknets.usetset.usetmsetgroups.treeUpdateList();a(window).off("beforeunload.pageBase");b.resetFuncBeforeHashChange();b.dispBackListPage()},complete:function(h,f,g){if(d!=null){desknets.submitform.clearDialogDisabled(d);d.dialog("close")}}})},_inputDelConfSubmit:function(g){var c=this;var d=null;var f=c._delConfMessage();var e=c._delConfAddMessage();var b={};b.extraMessage=e;b.extraClass="co-msg-rs";d=desknets.dialog.confirm(f,function(){c._inputDelSubmit(d);return false},b)},_delConfAddMessage:function(){return desknets.Resource.Message.set_group_delconf},_updatePageListId:function(){desknets.usetset.usetmsetgroups._boUpdateTree=true;this.callBase("_updatePageListId")},_getDelExecCmd:function(){return desknets.usetset.CMD_USETMSETGROUPDELETE},_getAddExecCmd:function(){return desknets.usetset.CMD_USETMSETGROUPENTRY},_getModExecCmd:function(){return this._getAddExecCmd()}});desknets.page(desknets.usetset,"usetmsetgroupentrygroupTree",desknets.groupTree,{mforcenolink:"0",TMPL_ITEM:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside {{classes}} {{subType}} {{notunder}}">{{name}}</a>',TMPL_ITEM_NOLINK:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item nolink"><a class="uset-grplistview-item-inside-nolink {{adminunserclasse}} {{classes}} {{subType}} {{notunder}}">{{name}}</a>',loadTree:function(c){var b=this;var f=a("#jco-m-list-container").find("div.co-listview-items");var e=a("#jco-m-input-page").find("div.co-listview-items");b.mforcenolink="0";if(a("#jco-m-input-page").find('input[name="adminflg"]').val()!="1"){b.mforcenolink="1"}if(f.length>0){e.html(f.html());if(b.mforcenolink=="1"){e.find(".co-listview-item-inside").addClass("under").addClass("uset-grplistview-item-inside-nolink").removeClass("co-listview-item-inside").removeAttr("href")}else{e.find(".co-listview-item-inside.notunder").addClass("under").addClass("uset-grplistview-item-inside-nolink").removeClass("co-listview-item-inside").removeAttr("href");e.find(".co-listview-item-inside.under").addClass("uset-grplistview-item-inside-nolink").removeClass("co-listview-item-inside").removeAttr("href")}}var d=desknets.paramanalyzer.getHashParams();if(neo.isSet(d)&&d.pgid){b.options.defaultGroupId=d.pgid}if(e.find("ins").length>0){e.find("ins").remove();b._createTree(c,e.html());return}b.callBase("loadTree",c)},_createTree:function(d,c){var b=this;b.callBase("_createTree",d,c);d.bind("loaded.jstree",function(f,g){b._updateItemsWidth();var e=d.find("a.co-listview-item-inside");e.removeClass("jstree-draggable");e.removeClass("jstree-drop");setTimeout(function(){var h=null;var i=d.find("li");a.each(i,function(j,k){if(a(k).children("a.co-listview-item-inside").hasClass("on")){h=a(k);return false}});if(h&&h.length>0){b._updateScrollTopValue(h)}else{b.onSelectItemNoAjax(d,b.options.defaultGroupId)}b._updateItemsWidth()},100)})},_getItemHtmlFromItemData:function(j){var k=this;var f=this.TMPL_ITEM,b="leaf";var i=desknets.chooser._getSubType({id:j.id,type:"group"});var d=Number(j.children)>0;var h=this.options.leafChoosable!==false||d;var e=h?"":"co-tree-noselect";var c="";if(!j.admin||j.admin=="1"){f=this.TMPL_ITEM}else{f=this.TMPL_ITEM_NOLINK}if(k.mforcenolink!="0"){f=this.TMPL_ITEM_NOLINK}if(!!j.adminunder&&j.adminunder=="1"){c="under"}var g="notunder";if(!j.admin||j.admin=="1"){g=""}if(!!j.admin&&j.admin=="2"){g="under"}if(d){b=!!j.list&&!!j.list.item?"open":"closed"}f=desknets.tmpl.replaceWordHtml(f,"id",j.id);f=desknets.tmpl.replaceWordHtml(f,"state",b);f=desknets.tmpl.replaceWordHtml(f,"classes",e);f=desknets.tmpl.replaceWord(f,"name",j.Name);f=desknets.tmpl.replaceWordHtml(f,"subType",i);f=desknets.tmpl.replaceWordHtml(f,"adminunserclasse",c);f=desknets.tmpl.replaceWordHtml(f,"notunder",g);return f},_selectOnLoaded:function(b){var d=this.options.defaultGroupId||"";var c=this.getItemObject_li(b,d,this._options);if(c.length<=0){c=b.find("li").eq(0)}c.children("a:first").trigger("click")}});desknets.page(desknets.usetset,"usetmsetgroupimport",desknets.PageImport,{_chkImport:function(){var c=this;var g="";var b="";var e={};var d=[];g=c._getRestModule();b=c._getChkCmd();var f=desknets.getUrl(g);e.cmd=b;e.execcheck="1";d.success=function(i,h,j){c._makeImport(i)};c._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,e,d)},_getRestModule:function(){return desknets.MODULE_API_MAIN},_getChkCmd:function(){return desknets.usetset.CMD_USETMSETGROUPIMPORT}});desknets.page(desknets.usetset,"usetmsetgroupexport",desknets.PageExport,{_getRestModule:function(){return desknets.MODULE_API_MAIN}});app.addInitialAction(function(){desknets.usetset.init()})})(jQuery);