/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.memoutil={_tmplManu:'<span title="{{title}}">{{value}}</span>',_tmplAuto:'<div title="{{title}}" class="memo-sch">{{value}}</div>',_tmplAutoEvent:'<div title="{{title}}" class="memo-sch">{{icon}}{{value}}</div>',_editArray:["event","place","date","memo"],_tmplOpts:{sameDateDisp:false,dateTimeDisp:true},_$dialog:null,_otherto:null,_DIALOG_ID:"memo-entry-dialog",PAGE_MEMOENTRY:"memoentrytarget",CMD_MEMOENTRY:"memocmdentry",getWhereContactClass:function(d){var b="memo-tel-other";var c={"1":"memo-tel-company","2":"memo-tel-naisen","3":"memo-tel-phone"};if(neo.isSet(d)&&neo.isSet(c[d])){b=c[d]}return b},editWhereListLine:function(d,i,b){var j=this;var g;if(!!b){g=b}else{g=j._editArray}i.contactClass=j.getWhereContactClass(i.contactflg);if(neo.isSet(i.allcnt)){if(i.allcnt!="0"){var e=desknets.ajax.getItems(i.list.item);a.each(e,function(l,m){a.each(g,function(n,o){if(o=="event"){i[o]=j._replaceWhereSchEvent(i[o],m)}else{if(o=="place"){i[o]=j._replaceWhereSchPlace(i[o],m)}else{if(o=="date"){i[o]=j._replaceWhereSchDate(i[o],m)}else{if(o=="memo"){i[o]=j._replaceWhereSchMemo(i[o],m)}}}}})});var c=Number(i.allcnt)-e.length;if(c>0){var k=desknets.tmpl.replaceWordChk(desknets.Resource.Message.com_memo_where_schmore,"morecnt",c);var h=desknets.tmpl.replaceWordChk(j._tmplAuto,"title",k);h=desknets.tmpl.replaceWordChk(h,"value",k);var f=desknets.tmpl.replaceWordChk(j._tmplAuto,"title","");f=desknets.tmpl.replaceWordChkHtml(f,"value","&nbsp;");a.each(g,function(l,m){if(l==0){i[m]=i[m]+h}else{i[m]=i[m]+f}})}delete i.list}else{a.each(g,function(l,m){i[m]="&nbsp;"})}}else{if(neo.isSet(i.where,{blank:false})){i.place="["+i.where+"]"+i.place}a.each(g,function(m,n){var l=j._tmplManu;l=desknets.tmpl.replaceWordChk(l,"title",i[n]);l=desknets.tmpl.replaceWordChk(l,"value",i[n]);i[n]=l})}return i},setWhereListStyle:function(c){if(desknets.browser.msie8&&!!c){var b=0;var d=c.find("tr");a.each(d,function(e,g){var f=a(this).find("td").eq(2).find(".memo-sch");if(neo.isSet(f)&&f.length>2){f.eq(2).addClass("memo-sch-more")}b=e});d.eq(b).addClass("memo-list-lasttr")}},entryDialogInit:function(c,b,d){if(!!d){this._DIALOG_ID=d}this.entryDialogDestroy();this._otherto={id:c,name:b};this._sendSchMemoAjaxGetHtml()},entryDialogDestroy:function(){if(this._$dialog){desknets.dialog.deleteById(this._DIALOG_ID);this._$dialog=null}},_replaceWhereSchEvent:function(c,e){var b=this;var f="";var g=b._tmplAutoEvent;var d=desknets.cal.getSubject(e.event,e.detail);if(!neo.isSet(c)){c=""}f=desknets.cal.tmpl.getIconsAsText(e)+d;g=desknets.tmpl.replaceWordChk(g,"title",f);g=desknets.tmpl.replaceWordChk(g,"value",d.length>0?d:" ");g=desknets.tmpl.replaceWordChkHtml(g,"icon",desknets.cal.tmpl.getIconsAsHtml(e));return c+g},_replaceWhereSchPlace:function(d,e){var c=this;var f=c._tmplAuto;var b=desknets.cal.getSubject(e.place,e.other);if(!neo.isSet(d)){d=""}f=desknets.tmpl.replaceWordChk(f,"title",b);f=desknets.tmpl.replaceWordChk(f,"value",b.length>0?b:" ");return d+f},_replaceWhereSchDate:function(d,e){var b=this;var f=b._tmplAuto;var c=desknets.cal.tmplList.getRowHtml("{{date}}",e,b._tmplOpts);if(!neo.isSet(d)){d=""}f=desknets.tmpl.replaceWordChkHtml(f,"title",c);f=desknets.tmpl.replaceWordChkHtml(f,"value",c.length>0?c:"&nbsp;");return d+f},_replaceWhereSchMemo:function(d,e){var c=this;var f=c._tmplAuto;var b=e.memo;if(!neo.isSet(d)){d=""}f=desknets.tmpl.replaceWordChk(f,"title",neo.isSet(b)?b:"");f=desknets.tmpl.replaceWordChk(f,"value",neo.isSet(b,{blank:false})?b:" ");return d+f},_sendSchMemoAjaxGetHtml:function(){var b=this;var c=desknets.getUrl(desknets.MODULE_API_MAIN);var d=desknets.ajax.arrayToMultiCmdData(this._getSchMemoAjaxParamGetHtml());desknets.ajax.rest({id:this._DIALOG_ID,url:c,data:d,type:"POST",success:function(f,e,g){b._onSuccessSchMemoGetHtml(f)},error:function(g,f,e){if(f!="abort"){desknets.ajax.onError(g.status,e)}}})},_getSchMemoAjaxParamGetHtml:function(){var c;var b={};var d=0;c={};c.cmd=this.PAGE_MEMOENTRY;c.uid=this._otherto.id;b[d]=c;d++;return b},_onSuccessSchMemoGetHtml:function(c){var b=0;var d;d=this._setSchMemoDlgHtml(c[b]);if(!d){return}b++;this._$dialog.dialog("open");var e=this._$dialog.find(".jco-input-whom");desknets.watermark.set(e);e.removeAttr("title");e.blur()},_setSchMemoDlgHtml:function(e){var d=e.html;if(!neo.isSet(d)){return false}var c=a(d).find(".co-mainarea").find(".co-etable");var b=a("<form></form>").append(c);b.find(".jsch-memo-dlg-target").text(this._otherto.name);this._$dialog=desknets.dialog.make(this._DIALOG_ID,this._getDialogOption());this._$dialog.append(b);desknets.comMemo.setTagColorVal(this._$dialog);return true},_getDialogOption:function(){var b=this;var e={};e[desknets.Resource.OKButtonLabel]=function(){desknets.submitform.setDialogDisabled(b._$dialog);b._sendSchMemoAjaxAddMemo()};e[desknets.Resource.CancelButtonLabel]=function(){b._$dialog.dialog("close")};var d=desknets.dialog.getDialogOption();var c={title:desknets.Resource.Message.com_memo_dialogtitle,width:600,buttons:e,close:function(){neo.ajax.abort(b._DIALOG_ID,true)}};a.extend(d,c);return d},_sendSchMemoAjaxAddMemo:function(){var b=this;var c=desknets.getUrl(desknets.MODULE_API_MAIN);var d=this._getSchMemoAjaxParamAddMemo();desknets.ajax.rest({id:this._DIALOG_ID,url:c,data:d,type:"POST",success:function(f,e,g){b._$dialog.dialog("close");desknets.submitform.clearDialogDisabled(b._$dialog)},error:function(g,f,e){if(f!="abort"){desknets.ajax.onError(g.status,e);desknets.submitform.clearDialogDisabled(b._$dialog)}},errorconvmsg:function(e,f){var g=desknets.getErrField(e,f);g.fieldname=desknets.getErrFieName(b._$dialog,g.fieldid);return desknets.getErrConvMsg(g)}})},_getSchMemoAjaxParamAddMemo:function(){var b;b={};b.cmd=this.CMD_MEMOENTRY;b.otherto=this._otherto.id;form=this._$dialog.find("form").formToArrayEx();a.extend(b,form);if(!b.tag){b.tag=desknets.comMemo.VAL_MEMO_TAGOFF}return b}};desknets.todoutil={SetDispDateTimeToDoTop:function(b){b.find(".jtodo-limdate").each(function(){var d;if(a(this).text().length==0){return true}if(a(this).hasClass("today")||a(this).hasClass("tmrw")){d="shortTimeFormat"}else{d={type:"list"}}var c=desknets.dateTime.dispDateTime(a(this).text(),d);a(this).text(c);a(this).attr("title",c)})}};desknets.webClip={SCRIPT:'javascript:(function(c,a){c=document,a=window;function b(){var f="{{host}}",i="{{lang}}",d=1,h=c.URL.match(/^https:/)&&f.match(/^http:/)?"{{L_SECURE_ERROR}}":"{{L_ERROR}}";if(!c.getElementsByClassName||!c.querySelectorAll||!a.postMessage){alert("{{L_UNSUPPORTED_ERROR}}")}else{function g(){if(d){alert(h)}d=0}function e(m,k,j){j=c.createElement("script");j.setAttribute("type","text/javascript");j.setAttribute("charset","UTF-8");j.setAttribute("src",m);j.onerror=g;j.onload=k;try{c.body.appendChild(j)}catch(l){g()}}e(f+"dneores/lang/"+i+"/js/pubwclip.js",function(){e(f+"dneores/js/dnpub/wclipmain.js?url="+f+"&cgipath={{path}}&lang="+i+"&cmd={{type}}&mod={{ext}}",null)})}}c.readyState=="complete"?b():a.addEventListener("load",b)})()',TMPL_VIDEO:'<video width="320" height="180" controls=""><source src="/dneores/images/webclip/webclip-guide_{{target}}.mp4" type="video/mp4"></video>',init:function(c){var b=this;b._initScript(c);b._initTutorial(c);b._initHelp(c);c.find(".co-webclip-buttons > a").click(function(d){d.preventDefault()});if(desknets.browser.ipad){c.find(".co-webclip-paste-me textarea").click(function(d){if(typeof this.setSelectionRange=="function"){this.setSelectionRange(0,this.value.length)}})}},_initScript:function(f){var e=this;var d=this.SCRIPT,c,b;var g=location.protocol+"//"+location.host+"/";var h=location.pathname.replace(/[.\w]*$/,"");d=desknets.tmpl.replaceWord(d,"host",g);d=desknets.tmpl.replaceWord(d,"path",h);d=desknets.tmpl.replaceWordHtml(d,"lang",desknets.Resource.code);d=desknets.tmpl.replaceWordHtml(d,"ext",desknets.getExtension());d=desknets.tmpl.replaceWord(d,"L_ERROR",desknets.Resource.Message.com_webclip_error);d=desknets.tmpl.replaceWord(d,"L_SECURE_ERROR",desknets.Resource.Message.com_webclip_secure_error);d=desknets.tmpl.replaceWord(d,"L_UNSUPPORTED_ERROR",desknets.Resource.Message.com_webclip_unsupported_error);c=desknets.tmpl.replaceWordHtml(d,"type","img");f.find(".co-webclip-clip-image").attr("href",c);a("#jco-webclip-textarea-image").val(c);b=desknets.tmpl.replaceWordHtml(d,"type","html");f.find(".co-webclip-clip-page").attr("href",b);a("#jco-webclip-textarea-page").val(b)},_initTutorial:function(c){var b=this;var d=c.find("video > source");if(desknets.browser.msie){this._setUpGuide(c,"msie")}else{if(desknets.browser.firefox){this._setUpGuide(c,"firefox")}else{if(desknets.browser.chrome){this._setUpGuide(c,"chrome")}else{if(desknets.browser.safari){this._setUpGuide(c,"safari")}}}}},_initHelp:function(c){var b=this;var d=a(".co-m-h-setting-menu.hplink > a").attr("href");d=String(d).replace(/\w+\.html$/,"webclip.html");c.find(".co-webclip-link > a").attr("href",d)},_setUpGuide:function(c,e){var b=this;var d=this.TMPL_VIDEO;d=desknets.tmpl.replaceWordHtml(d,"target",e);c.find(".co-webclip-guides").html(d)}};desknets.portal={PORTAL_TYPE:0,BOOKMARK_TYPE:1,COOKIE_SEP:"~",restURL:"",_bprocUrl:null,_cookieValues:null,init:function(){var b=this;var c=a(".portal-container");this.restURL=desknets.getUrl("zrportal");desknets.portal.bookmarkUtil.init();if(c.length>0){desknets.portal.tabs.init(a(".portal-m-header"));desknets.portal.home.init(c)}},createBody:function(){desknets.portal.home.create()},destroyBody:function(){desknets.portal.home.destroy()},getBProcUrl:function(){if(!this._bprocUrl){var c=String(location.pathname);var b=c.lastIndexOf("/");if(b>=0){c=c.substring(b+1)}this._bprocUrl=encodeURIComponent(c)}return this._bprocUrl},setShownPortal:function(b,c){if(c){desknets.saveCookieToDisk(desknets.COOKIENAME_PORTAL_TAB,b)}else{desknets.saveCookie(desknets.COOKIENAME_PORTAL_TAB,b)}},};desknets.portal.bookmarkUtil={DEFAULT_FOLDER_IMAGE:"/"+desknets.DIR_RESHOME+"/images/com/co-bookmark_f.gif",DEFAULT_BOOKMARK_IMAGE:"/"+desknets.DIR_RESHOME+"/images/com/co-bookmark.png",_TMPL_URL:"{{referUrl}}?cmd=referdownload&item1={{userPath}}portal/bookmark/{{type}}&filename={{id}}.{{fileext}}&mimetype={{mimetype}}&realname={{filename}}",init:function(){var b=desknets.getUrl(desknets.MODULE_REFER);this._TMPL_URL=desknets.tmpl.replaceWordHtml(this._TMPL_URL,"referUrl",b)},getIconUrl:function(d,f,b,e,c){if(!!b){return this._getStoredIconUrl(d,f,b,e,c)}else{return d=="bookmark"?this.DEFAULT_BOOKMARK_IMAGE:this.DEFAULT_FOLDER_IMAGE}},_getStoredIconUrl:function(f,h,b,g,e){var d=b.replace(/^.+\./,"");var c=this._TMPL_URL;c=desknets.tmpl.replaceWordHtml(c,"type",f);c=desknets.tmpl.replaceWordHtml(c,"userPath",this._getBaseFilePath(e));c=desknets.tmpl.replaceWordHtml(c,"id",h);c=desknets.tmpl.replaceWordHtml(c,"filename",encodeURIComponent(b));c=desknets.tmpl.replaceWordHtml(c,"mimetype",encodeURIComponent(g));c=desknets.tmpl.replaceWordHtml(c,"fileext",encodeURIComponent(d));return c},_getBaseFilePath:function(b){if(!b){return""}var c="user/{{part}}/{{id}}/";c=desknets.tmpl.replaceWordHtml(c,"part",Math.ceil(b/1000));return desknets.tmpl.replaceWordHtml(c,"id",b)}};desknets.page(desknets.portal,"tabs",desknets.PageBase,{_$root:null,_saveDefault:false,init:function(b){this._$root=b;this._saveDefault=Number(this._$root.data("save-default"))>0;this._initTab();this._initSlideable()},selectTab:function(b){this._updateCookie(b.data("type"),b.data("id"));location.href=location.href},_initTab:function(){var b=this;var c=b._$root.find(".portal-tab > li.on");b._updateCookie(c.data("type"),c.data("id"));b._$root.delegate(".portal-tab a","click",function(d){b.selectTab(a(this).parent());d.preventDefault()})},_initSlideable:function(){var c=this;var b=c._$root.children(".portal-tabs");var d=b[0];if(!!d&&d.clientWidth<d.scrollWidth){this._$root.addClass("portal-slidable");b.dndscroll({moveToDrag:false,leftButton:this._$root.children(".left"),rightButton:this._$root.children(".right")})}},_updateCookie:function(d,b){var c=!!b?d+b:d;desknets.portal.setShownPortal(c,this._saveDefault)}});desknets.page(desknets.portal,"home",desknets.PageBase,{$root:null,cmdPostFix:"",contents:null,contentClasses:null,_postFixes:{G:"grp",P:"pri"},init:function(b){this.$root=b;a("#dn-main").addClass("sortable-container");this._initRefresh();this.create(b)},create:function(){var b=a(".portal-tab .on").data("type");this.cmdPostFix=!!this._postFixes[b]?this._postFixes[b]:"";this.contents={};this.contentClasses={"8":desknets.portal.timecard,"1012":desknets.portal.schDay,"1":desknets.portal.schWeekH,"1014":desknets.portal.schWeekV,"1011":desknets.portal.schMonth,"1010":desknets.portal.schWeekHG,"1013":desknets.portal.schWeekVG,"1021":desknets.portal.plantDay,"3":desknets.portal.plantWeekH,"1020":desknets.portal.plantWeekV,"1022":desknets.portal.plantMonth,"10":desknets.portal.mailPrivate,"7":desknets.portal.todo,"1001":desknets.portal.bookmark,"1000":desknets.portal.menu,"1030":desknets.portal.memowhere,"1040":desknets.portal.webClip,"1050":desknets.portal.mailShare,"16":desknets.portal.koubai,"28":desknets.portal.mailimap,};this._createContents()},destroy:function(){for(var b in this.contents){this.contents[b].destroy()}},getID:function(b){var c=b.closest(desknets.portal.content.SELECTER).attr("id");if(typeof(c)!="string"){return}c=Number(c.replace("portal-content-",""));return isNaN(c)?undefined:c},getContent:function(b){if(b<0||b>=10000){this.contents[b]=a.extend({},desknets.portal.custom)}else{if(this.contentClasses[b]){this.contents[b]=a.extend({},this.contentClasses[b])}else{this.contents[b]=a.extend({},desknets.portal.content)}}return this.contents[b]},_initRefresh:function(){var b=Number(this.$root.data("refresh-interval"));if(b>0){setInterval(function(){if(desknets.ntwi.content.isShown()){return}if(!!desknets.cost&&desknets.cost.isShown()){return}location.reload()},b*60000)}},_createContents:function(){var b=this;a(desknets.portal.content.SELECTER).each(function(){var c=a(this);var e=b.getID(c);var d=b.getContent(e);d.init(c,e)})}});desknets.page(desknets.portal,"content",null,{$root:null,id:0,SELECTER:".portal-content-pane",SELECTER_HASHCMD:".jportal-content-hashcmd",init:function(c,d){var b=this;this.id=d;this.$root=c;this.$root.find(b.SELECTER_HASHCMD).click(function(e){b._setHashCmd(a(e.target).closest("a"))})},destroy:function(){},_setHashCmd:function(b){var c=b.data("hashcmd");if(!!c){desknets.saveHashCmdCookie(c)}}});(function(b){desknets.page(desknets.portal,"timecard",desknets.portal.content,{_timecardURL:null,_$table:null,_TABLE_CLASSES:"co-table-list portal-timecard",init:function(d,e){var c=this;c.callBase("init",d,e);c._timecardURL=desknets.getUrl("zrtcard");c._$table=c.$root.find(".portal-timecard");c._$table.delegate(".portal-timecard-btn","click",function(f){c._stampTime(b(this))})},destroy:function(){this._$table.undelegate();this.callBase("destroy")},_stampTime:function(d){var c=this;var e=desknets.ajax.arrayToMultiCmdData([{cmd:"tcardcmdstamp",mode:d.data("mode")},{cmd:"tcardcmdtick"}]);desknets.submitform.setButton(c.$root,true);desknets.ajax.rest({url:c._timecardURL,data:e,success:function(f){c._updateWithJson(f["1"])},complete:function(){desknets.submitform.setButton(c.$root,false)},})},_updateWithJson:function(c){this._updateTime(c.stime,"start");this._updateTime(c.outtime,"out");this._updateTime(c.intime,"in");this._updateTime(c.etime,"end");this._updateSituation(c.late,"start");this._updateSituation(c.leaveearly,"end");this._updateStateWithJson(c)},_updateTime:function(f,e){var d="td.portal-timecard-"+e+" > .portal-timecard-time";var c=!!f?f:"---";this.$root.find(d).text(c)},_updateSituation:function(e,d){var c="td.portal-timecard-"+d;if(!!Number(e)){this.$root.find(c).addClass("portal-timecard-ng")}else{this.$root.find(c).removeClass("portal-timecard-ng")}},_updateStateWithJson:function(c){if(!!c.etime){this._$table.attr("class",this._TABLE_CLASSES+" portal-timecard-leave")}else{if(!this._$table.hasClass("portal-timecard-come")){this._$table.attr("class",this._TABLE_CLASSES+" portal-timecard-come")}}}})})(jQuery);desknets.page(desknets.portal,"cal",desknets.portal.content,{contentURL:null,contentRefURL:null,cmdToIndex:"",cmdToAdd:"",cmdToRefer:"",cmdToModify:"",date:new Date(),showHoliday:false,_module:"",_settingKeys:[],init:function(b,c){this.callBase("init",b,c);this.date=desknets.pageframe.getServerDate();this.initCalendar()},getContentParamArray:function(){var b=[];var c=this.getHolidayContentParams();if(this.showHoliday&&!!c){b.push(c)}return b},getHolidayContentParams:function(){return null},replaceItems:function(c,b){},setHashCmd:function(b){},initCalendar:function(){var c=this;var b=c.$root.find(".portal-cal-date-header");c._initSettings();c._initEvents();b.find(".cal-date").show();desknets.htmlparts.setUpDateNav(b,{date:c.date,change:function(e,d){c.date=d.date;c.onDateChanged()}});setTimeout(function(){c._getCalData()},0)},refreshCalendar:function(){this._getCalData()},onDateChanged:function(){this._getCalData()},getPreloadedData:function(b){var d,c={};d="jsonContentHoliday"+this.id;if(this.showHoliday&&!!window[d]){c[b.index.toString()]=window[d];window[d]=null;b.index++}d="jsonContent"+this.id;if(!!window[d]){c[b.index.toString()]=window[d];window[d]=null;b.index++}return c},openPopUp:function(b){var c=this._getBProcUrl(this.date);desknets.cal.refPopUp.open(b,{bproc:c})},getUrlToCal:function(d,c){var b="{{cgi}}?cmd={{indexCmd}}#cmd={{cmd}}&{{idField}}={{idValue}}&date={{date}}";var e=neo.dateTime.format("yyyyMMdd",c);b=desknets.tmpl.replaceWordHtml(b,"cmd",d);b=desknets.tmpl.replaceWordHtml(b,"date",e);return this._getUrl(b)},getUrlToAdd:function(b,e,d){var c="{{cgi}}?cmd={{indexCmd}}#cmd={{cmd}}&{{idField}}={{idValue}}&date={{startDate}}&enddate={{endDate}}&bproc={{cgi_enc}}";c=desknets.tmpl.replaceWordHtml(c,"cmd",this.cmdToAdd);c=desknets.tmpl.replaceWordHtml(c,"startDate",neo.dateTime.format("yyyyMMdd",b));c=desknets.tmpl.replaceWordHtml(c,"endDate",neo.dateTime.format("yyyyMMdd",e));return this._getUrl(c,this.date)},getUrlToRefer:function(b){var c="{{cgi}}?cmd={{indexCmd}}#cmd={{cmd}}&seldate={{seldate}}&sid={{sid}}&mydata=0&bproc={{cgi_enc}}";c=desknets.tmpl.replaceWordHtml(c,"cmd",this.cmdToRefer);c=desknets.tmpl.replaceWordHtml(c,"sid",desknets.getDataAttr(b,"id"));c=desknets.tmpl.replaceWordHtml(c,"seldate",b.data("date"));return this._getUrl(c,this.date)},getUrlToModify:function(b){var c="{{cgi}}?cmd={{indexCmd}}#cmd={{cmd}}&seldate={{seldate}}&sid={{sid}}&bproc={{cgi_enc}}";c=desknets.tmpl.replaceWordHtml(c,"cmd",this.cmdToModify);c=desknets.tmpl.replaceWordHtml(c,"sid",desknets.getDataAttr(b,"id"));c=desknets.tmpl.replaceWordHtml(c,"seldate",b.data("date"));return this._getUrl(c,this.date)},extendMonthRange:function(g,d,c){var e=desknets.cal.settings.of(this._module);var b=desknets.cal.MonthCalendar.getLeftTopDate(this.date,e.sunday);var f=desknets.cal.MonthCalendar.getRightBottomDate(this.date,e.sunday);g[d]=neo.dateTime.format("yyyyMMdd",b);g[c]=neo.dateTime.format("yyyyMMdd",f)},_initSettings:function(){var b=this;var e=b.$root.find(".portal-cal");var d=desknets.cal.settings.of(b._module);var c=neo.dateTime.parse(e.data("date"));if(!!c){this.date=c}a.each(b._settingKeys,function(f,g){d[g]=e.data(g)})},_initEvents:function(){var b=this;this.$root.bind("navigate.cal",function(d,c){var e=c.type=="week"?b._cmdWeekCal:b._cmdDayCal;b.setHashCmd(a(d.target));location.href=b.getUrlToCal(e,c.date)});this.$root.bind("add.cal",function(e,d){var c=a(e.target);setTimeout(function(){desknets.cal.selection.unselect()},0);b.setHashCmd(c);location.href=b.getUrlToAdd(d.date,d.endDate,c)});this.$root.bind("refer.cal",function(d,e){var c=a(d.target);if(!!e&&e.mode=="page"){b.setHashCmd(c);location.href=b.getUrlToRefer(c)}else{b.openPopUp(c)}});this.$root.bind("modify.cal",function(d){var c=a(d.target);b.setHashCmd(c);location.href=b.getUrlToModify(c)});this.$root.bind("refresh.cal",function(c,d){b._onCalRefreshed(!!d?d.action:"")})},_onCalRefreshed:function(c){if(c=="delete"){for(var d in desknets.portal.home.contents){var b=desknets.portal.home.contents[d];if(!!b&&typeof b.refreshCalendar=="function"){b.refreshCalendar()}}}else{this._getCalData()}},_getCalData:function(){var c=this,b,d={index:0};var e=c.getContentParamArray();if(!!window["jsonContent"+this.id]){b=this.getPreloadedData(d);d.index=0;c.replaceItems(b,d)}else{if(e.length>0){var f=(e.length==1)?e[0]:desknets.ajax.arrayToMultiCmdData(e);desknets.ajax.rest({url:c.contentURL,data:f,success:function(g){b=!!g["0"]?g:{"0":g};c.replaceItems(b,d)}})}}},_getUrl:function(c,b){var d=this._getBProcUrl(b);c=desknets.tmpl.replaceWordHtml(c,"cgi",location.pathname);c=desknets.tmpl.replaceWordHtml(c,"cgi_enc",d);c=desknets.tmpl.replaceWordHtml(c,"indexCmd",this.cmdToIndex);c=desknets.tmpl.replaceWordHtml(c,"idField",this._idField);c=desknets.tmpl.replaceWordHtml(c,"idValue",this._idValue);return c},_getBProcUrl:function(c){var d=desknets.portal.getBProcUrl();if(a.type(c)=="date"){var b=neo.dateTime.format("yyyyMMdd",c);d+=desknets.encodeURIComponentNeo("?date"+this.id+"="+b)}return d}});desknets.page(desknets.portal,"sch",desknets.portal.cal,{cmdToIndex:"schindex",cmdToAdd:"schadd",cmdToRefer:"schreferdtl",cmdToModify:"schmod",showToDo:false,_module:"sch",_idField:"id",_idValue:"",_cmdDayCal:"schday",_cmdWeekCal:"schweek",init:function(b,c){this.callBase("init",b,c);this.showHoliday=Number(desknets.cal.settings.of("sch").holiday)>0;this.showToDo=Number(b.find(".portal-cal").data("cal-todo"))>0;this.contentURL=desknets.getUrl(desknets.MODULE_API_MAIN);this.contentRefURL=desknets.getUrl(desknets.MODULE_MAIN)},openPopUp:function(b){var c=b.closest(".portal-cal");if(!c.data("gid")&&(!c.data("uid")||c.data("uid")==desknets.pageframe.getLoginUid())){b.data("mydata","1")}else{b.data("mydata","0")}this.callBase("openPopUp",b)},getSchContentParams:function(){return{}},getToDoContentParams:function(){return null},updateCalendar:function(b){},replaceCalItems:function(b){},getContentParamArray:function(){var c=this.callBase("getContentParamArray");var b=this.getToDoContentParams();if(this.showToDo&&!!b){c.push(b)}c.push(this.getSchContentParams());return c},replaceItems:function(e,c){var d,b,f=[];if(this.showHoliday){d=e[c.index.toString()];b=desknets.ajax.getJsonItems(d);a.merge(f,desknets.cal.item.getItemsFromHoliday(b));c.index++}if(this.showToDo){d=e[c.index.toString()];b=desknets.ajax.getJsonItems(d);a.merge(f,desknets.cal.item.getItemsFromToDo(b));c.index++}d=e[c.index.toString()];this.updateCalendar({add:!!d.accessadd});b=!!d.slist?desknets.ajax.getItems(d.slist.item):[];a.merge(f,desknets.cal.item.getItemsFromSch(b));c.index++;this.replaceCalItems(f)},setHashCmd:function(b){if(b.hasClass("todo")){desknets.saveHashCmdCookie("todolist")}else{desknets.saveHashCmdCookie("schindex")}},getPreloadedData:function(b){var d=this.callBase("getPreloadedData",b);var c="jsonContentToDo"+this.id;if(this.showToDo&&!!window[c]){d[b.index.toString()]=d[(b.index-1).toString()];d[(b.index-1).toString()]=window[c];window[c]=null;b.index++}return d},getUrlToModify:function(b){var c;if(b.hasClass("todo")){c="{{cgi}}?cmd=todolist#cmd=todotaskentry&id={{id}}&bproc={{cgi_enc}}";c=desknets.tmpl.replaceWordHtml(c,"id",desknets.getDataAttr(b,"id"))}else{c="{{cgi}}?cmd={{indexCmd}}#cmd={{cmd}}&sid={{sid}}&seldate={{seldate}}&bproc={{cgi_enc}}";c=desknets.tmpl.replaceWordHtml(c,"cmd",this.cmdToModify);c=desknets.tmpl.replaceWordHtml(c,"sid",desknets.getDataAttr(b,"id"));c=desknets.tmpl.replaceWordHtml(c,"seldate",b.data("date"))}return this._getUrl(c,this.date)}});desknets.page(desknets.portal,"schDay",desknets.portal.sch,{fullTimeList:null,timeLine:null,_settingKeys:["disptotime","start","othercolor","toppage","delnotice"],init:function(b,c){this.callBase("init",b,c);this._idValue=Number(this.$root.find(".portal-cal").data("uid"))||"";this.showHoliday=false;this.showToDo=this.showToDo&!this._idValue;this._initCals()},getSchContentParams:function(){var b=!!this._idValue?{id:this._idValue}:{};return a.extend({cmd:"schprivate",date:neo.dateTime.format("yyyyMMdd",this.date),proc:"d"},b)},getToDoContentParams:function(){var b=neo.dateTime.format("yyyyMMdd",this.date);return{cmd:"todocmdlistsearch",srch_limdate_s:b,srch_limdate_e:b}},updateCalendar:function(b){this.fullTimeList.setSelectable(!!b.add);this.timeLine.setSelectable(!!b.add)},replaceCalItems:function(b){this._updateCal(this.fullTimeList,b);this._updateCal(this.timeLine,b)},getUrlToAdd:function(b,g,f){var c=this.callBase("getUrlToAdd",b,g,f);if(f[0]==this.timeLine.$root[0]){var d=neo.dateTime.format("HHmm",b);var e=neo.dateTime.format("HHmm",g);c+="&starttime="+d+"&endtime="+e}else{c+="&starttime=0000&endtime=2400"}return c},_initCals:function(){var c=new Date();var b=this.$root.find(".cal-timebar-allday");var d=this.$root.find(".cal-v-meter");this.fullTimeList=new desknets.cal.FullTimeList(b,this._module,{date:this.date});this.timeLine=new desknets.cal.TimeVertical(d,this._module,{date:this.date,maxLines:6});this.timeLine.$root.scrollTop(c.getHours()*this.timeLine.pixelPerUnit)},_updateCal:function(c,b){c.setDate(this.date);c.extractItems(b)}});desknets.page(desknets.portal,"schWeekH",desknets.portal.sch,{calendar:null,calendarNext:null,_settingKeys:["disptotime","holiday","othercolor","toppage","delnotice"],init:function(b,c){this.callBase("init",b,c);this._idValue=Number(this.$root.find(".portal-cal").data("uid"))||"";this.showToDo=this.showToDo&!this._idValue;this._initCals()},getSchContentParams:function(){var b=!!this._idValue?{id:this._idValue}:{};return a.extend({cmd:"schprivate",date:neo.dateTime.format("yyyyMMdd",this.date),proc:"2w"},b)},getHolidayContentParams:function(){var b=!!this._idValue?{id:this._idValue}:{};var c=neo.dateTime.moveDate(this.date,13);return a.extend({cmd:"schholidaylist",startdate:neo.dateTime.format("yyyyMMdd",this.date),enddate:neo.dateTime.format("yyyyMMdd",c)},b)},getToDoContentParams:function(){var b=neo.dateTime.moveDate(this.date,13);return{cmd:"todocmdlistsearch",srch_limdate_s:neo.dateTime.format("yyyyMMdd",this.date),srch_limdate_e:neo.dateTime.format("yyyyMMdd",b)}},updateCalendar:function(b){this.calendar.setSelectable(!!b.add);this.calendarNext.setSelectable(!!b.add)},replaceCalItems:function(b){var c=neo.dateTime.moveDate(this.date,7);this.calendar.setDate(this.date);this.calendar.replaceItems(b);this.calendarNext.setDate(c);this.calendarNext.replaceItems(b)},_initCals:function(){var c=neo.dateTime.moveDate(this.date,7);var b=this.$root.find(".cal-h-week");this.calendar=new desknets.cal.DateHorizontal(b.eq(0),this._module,{date:this.date});this.calendarNext=new desknets.cal.DateHorizontal(b.eq(1),this._module,{date:c})}});desknets.page(desknets.portal,"schWeekV",desknets.portal.sch,{calendar:null,_settingKeys:["disptotime","holiday","othercolor","toppage","delnotice"],init:function(b,c){this.callBase("init",b,c);this._idValue=Number(this.$root.find(".portal-cal").data("uid"))||"";this.showToDo=this.showToDo&!this._idValue;this._initCals()},getSchContentParams:function(){var b=!!this._idValue?{id:this._idValue}:{};return a.extend({cmd:"schprivate",date:neo.dateTime.format("yyyyMMdd",this.date),proc:"w"},b)},getHolidayContentParams:function(){var b=!!this._idValue?{id:this._idValue}:{};var c=neo.dateTime.moveDate(this.date,6);return a.extend({cmd:"schholidaylist",startdate:neo.dateTime.format("yyyyMMdd",this.date),enddate:neo.dateTime.format("yyyyMMdd",c)},b)},getToDoContentParams:function(){var b=neo.dateTime.moveDate(this.date,6);return{cmd:"todocmdlistsearch",srch_limdate_s:neo.dateTime.format("yyyyMMdd",this.date),srch_limdate_e:neo.dateTime.format("yyyyMMdd",b)}},updateCalendar:function(b){this.calendar.setSelectable(!!b.add)},replaceCalItems:function(b){this.calendar.setDate(this.date);this.calendar.extractItems(b)},_initCals:function(){var b=this.$root.find(".cal-v-meter");this.calendar=new desknets.cal.DateVertical(b,this._module,{date:this.date,maxLines:6})}});desknets.page(desknets.portal,"schMonth",desknets.portal.sch,{calendar:null,_settingKeys:["disptotime","holiday","othercolor","sunday","rokuyou","toppage","delnotice"],_show6Weeks:false,init:function(b,e){this.callBase("init",b,e);var c=desknets.cal.settings.of(this._module);var d=b.find(".cal-month");this._idValue=Number(this.$root.find(".portal-cal").data("uid"))||"";this.showToDo=this.showToDo&!this._idValue;this._show6Weeks=!!Number(c.rokuyou);this.calendar=new desknets.cal.MonthCalendar(d,this._module,{date:this.date})},getContentParamArray:function(){var c,b=this.callBase("getContentParamArray");if(this._show6Weeks){c={cmd:"schrokuyoulist"};this.extendMonthRange(c,"smonth","emonth");b.push(c)}return b},replaceItems:function(e,d){this.callBase("replaceItems",e,d);if(this._show6Weeks){var c=e[d.index.toString()];var b=desknets.ajax.getJsonItems(c);this.calendar.set6WeekContents(b);d.index++}},getPreloadedData:function(b){var c=this.callBase("getPreloadedData",b);if(this._show6Weeks){c[b.index.toString()]=window.jsonRestRokuyou;b.index++}return c},getSchContentParams:function(){var b=!!this._idValue?{id:this._idValue}:{};return a.extend({cmd:"schprivate",date:neo.dateTime.format("yyyyMM",this.date),proc:"m"},b)},getHolidayContentParams:function(){var b=!!this._idValue?{id:this._idValue}:{};var c={cmd:"schholidaylist"};this.extendMonthRange(c,"startdate","enddate");return a.extend(c,b)},getToDoContentParams:function(){var b={cmd:"todocmdlistsearch"};this.extendMonthRange(b,"srch_limdate_s","srch_limdate_e");return b},updateCalendar:function(b){this.calendar.setSelectable(!!b.add)},replaceCalItems:function(b){this.calendar.setDate(this.date);this.calendar.replaceItems(b)}});desknets.page(desknets.portal,"schWeekHG",desknets.portal.sch,{calendar:null,calendarNext:null,_settingKeys:["disptotime","holiday","othercolor","toppage","delnotice"],init:function(b,c){this.callBase("init",b,c);this._idField="gid";this._idValue=b.find(".portal-cal").data("gid");this._cmdDayCal="schdaygrp";this._cmdWeelCal="schweekgrp";this._initCals()},getSchContentParams:function(){return{cmd:"schprivate",gid:this._idValue,date:neo.dateTime.format("yyyyMMdd",this.date),proc:"2w"}},getHolidayContentParams:function(){var b=neo.dateTime.moveDate(this.date,13);return{cmd:"schholidaylist",gid:this._idValue,startdate:neo.dateTime.format("yyyyMMdd",this.date),enddate:neo.dateTime.format("yyyyMMdd",b)}},replaceCalItems:function(b){var c=neo.dateTime.moveDate(this.date,7);this.calendar.setDate(this.date);this.calendar.replaceItems(b);this.calendarNext.setDate(c);this.calendarNext.replaceItems(b)},_initCals:function(){var c=neo.dateTime.moveDate(this.date,7);var b=this.$root.find(".cal-h-week");this.calendar=new desknets.cal.DateHorizontal(b.eq(0),this._module,{date:this.date});this.calendarNext=new desknets.cal.DateHorizontal(b.eq(1),this._module,{date:c})}});desknets.page(desknets.portal,"schWeekVG",desknets.portal.sch,{calendar:null,_settingKeys:["disptotime","holiday","othercolor","toppage","delnotice"],init:function(b,c){this.callBase("init",b,c);this._idField="gid";this._idValue=b.find(".portal-cal").data("gid");this._cmdDayCal="schdaygrp";this._cmdWeelCal="schweekgrp";this._initCals()},getSchContentParams:function(){return{cmd:"schprivate",gid:this._idValue,date:neo.dateTime.format("yyyyMMdd",this.date),proc:"w"}},getHolidayContentParams:function(){var b=neo.dateTime.moveDate(this.date,6);return{cmd:"schholidaylist",gid:this._idValue,startdate:neo.dateTime.format("yyyyMMdd",this.date),enddate:neo.dateTime.format("yyyyMMdd",b)}},replaceCalItems:function(b){this.calendar.setDate(this.date);this.calendar.extractItems(b)},_initCals:function(){var b=this.$root.find(".cal-v-meter");this.calendar=new desknets.cal.DateVertical(b,this._module,{date:this.date,maxLines:6})}});desknets.page(desknets.portal,"plant",desknets.portal.cal,{cmdToIndex:"plantweekgrp",cmdToCalendar:"",cmdToAdd:"plantadd",cmdToRefer:"plantreferdtl",cmdToModify:"plantmod",_module:"plant",_idField:"id",_idValue:"",_cmdDayCal:"plantday",_cmdWeekCal:"plantweek",init:function(b,c){this.contentURL=desknets.getUrl(desknets.MODULE_API_MAIN);this.contentRefURL=desknets.getUrl(desknets.MODULE_MAIN);this.callBase("init",b,c);this.showHoliday=Number(desknets.cal.settings.of("plant").holiday)>0},getPlantContentParams:function(){return{}},updateCalendar:function(b){},replaceCalItems:function(b){},initCalendar:function(){var b=this;var c=this.$root.find(".portal-cal-plant-header>select");if(c.length>0){b.callBase("initCalendar");b._idValue=b.getPlantID();c.change(function(d){b._idValue=b.getPlantID();b._getCalData();b._saveSelectedPlant()});b.$root.find(".portal-content-title > a").click(function(d){d.preventDefault();location.href=b.getUrlToPlant()})}},getContentParamArray:function(){var b=this.callBase("getContentParamArray");b.push(this.getPlantContentParams());return b},replaceItems:function(e,c){var d,b,h=[],g=[],f=null;if(this.showHoliday){d=e[c.index.toString()];b=desknets.ajax.getJsonItems(d);a.merge(h,desknets.cal.item.getItemsFromHoliday(b));c.index++}d=e[c.index.toString()];this.updateCalendar({add:!!d.accessadd});b=!!d.slist?desknets.ajax.getItems(d.slist.item):[];a.merge(h,desknets.cal.item.getItemsFromPlant(b));c.index++;this.replaceCalItems(h)},setHashCmd:function(b){desknets.saveHashCmdCookie("plantweekgrp")},getUrlToPlant:function(){var b="{{cgi}}?cmd={{indexCmd}}#cmd={{cmd}}&id={{idValue}}";b=desknets.tmpl.replaceWordHtml(b,"cmd",this.cmdToCalendar);return this._getUrl(b)},getPlantID:function(){return this.$root.find(".portal-cal-plant-header>select").val()},_saveSelectedPlant:function(){desknets.ajax.rest({url:desknets.portal.restURL,data:{cmd:"portalcmdselplant",id:this.id,pid:this._idValue}})}});desknets.page(desknets.portal,"plantDay",desknets.portal.plant,{cmdToCalendar:"plantday",fullTimeList:null,timeLine:null,_settingKeys:["disptotime","start","delnotice"],init:function(b,c){this.callBase("init",b,c);this.showHoliday=false;this._initCals()},getPlantContentParams:function(){return{cmd:"plantprivate",id:this.getPlantID(),date:neo.dateTime.format("yyyyMMdd",this.date),proc:"d"}},updateCalendar:function(b){this.fullTimeList.setSelectable(!!b.add);this.timeLine.setSelectable(!!b.add)},replaceCalItems:function(b){this._updateCal(this.fullTimeList,b);this._updateCal(this.timeLine,b)},getUrlToAdd:function(b,g,f){var c=this.callBase("getUrlToAdd",b,g,f);if(f[0]==this.timeLine.$root[0]){var d=neo.dateTime.format("HHmm",b);var e=neo.dateTime.format("HHmm",g);c+="&starttime="+d+"&endtime="+e}else{c+="&starttime=0000&endtime=2400"}return c},_initCals:function(){var c=new Date();var b=this.$root.find(".cal-timebar-allday");var d=this.$root.find(".cal-v-meter");if(b.length>0&&d.length>0){this.fullTimeList=new desknets.cal.FullTimeList(b,this._module,{date:this.date});this.timeLine=new desknets.cal.TimeVertical(d,this._module,{date:this.date});this.timeLine.$root.scrollTop(c.getHours()*this.timeLine.pixelPerUnit)}},_updateCal:function(c,b){c.setDate(this.date);c.extractItems(b)}});desknets.page(desknets.portal,"plantWeekH",desknets.portal.plant,{cmdToCalendar:"plantweek",calendar:null,calendarNext:null,_settingKeys:["disptotime","holiday","delnotice"],init:function(b,c){this.callBase("init",b,c);this._initCals()},getPlantContentParams:function(){return{cmd:"plantprivate",id:this.getPlantID(),date:neo.dateTime.format("yyyyMMdd",this.date),proc:"2w"}},getHolidayContentParams:function(){var b=neo.dateTime.moveDate(this.date,13);return{cmd:"plantholidaylist",id:this.getPlantID(),startdate:neo.dateTime.format("yyyyMMdd",this.date),enddate:neo.dateTime.format("yyyyMMdd",b)}},updateCalendar:function(b){this.calendar.setSelectable(!!b.add);this.calendarNext.setSelectable(!!b.add)},replaceItems:function(c,b){this.calendar.setSelectable(!!c[b.index.toString()].accessadd);this.calendarNext.setSelectable(!!c[b.index.toString()].accessadd);this.callBase("replaceItems",c,b)},replaceCalItems:function(b){var c=neo.dateTime.moveDate(this.date,7);this.calendar.setDate(this.date);this.calendar.replaceItems(b);this.calendarNext.setDate(c);this.calendarNext.replaceItems(b)},_initCals:function(){var c=neo.dateTime.moveDate(this.date,7);var b=this.$root.find(".cal-h-week");if(b.length>0){this.calendar=new desknets.cal.DateHorizontal(b.eq(0),this._module,{date:this.date});this.calendarNext=new desknets.cal.DateHorizontal(b.eq(1),this._module,{date:c})}}});desknets.page(desknets.portal,"plantWeekV",desknets.portal.plant,{cmdToCalendar:"plantweek",calendar:null,_settingKeys:["disptotime","holiday","delnotice"],init:function(b,c){this.callBase("init",b,c);this._initCals()},getPlantContentParams:function(){return{cmd:"plantprivate",id:this.getPlantID(),date:neo.dateTime.format("yyyyMMdd",this.date),proc:"w"}},getHolidayContentParams:function(){var b=neo.dateTime.moveDate(this.date,6);return{cmd:"plantholidaylist",id:this.getPlantID(),startdate:neo.dateTime.format("yyyyMMdd",this.date),enddate:neo.dateTime.format("yyyyMMdd",b)}},updateCalendar:function(b){this.calendar.setSelectable(!!b.add)},replaceCalItems:function(b){this.calendar.setDate(this.date);this.calendar.extractItems(b)},_initCals:function(){var b=this.$root.find(".cal-v-meter");if(b.length>0){this.calendar=new desknets.cal.DateVertical(b,this._module,{date:this.date})}}});desknets.page(desknets.portal,"plantMonth",desknets.portal.plant,{cmdToCalendar:"plantmonth",calendar:null,_settingKeys:["disptotime","holiday","sunday","rokuyou","delnotice"],_show6Weeks:false,init:function(b,d){this.callBase("init",b,d);var c=desknets.cal.settings.of("plant");this._show6Weeks=!!Number(c.rokuyou);this._initCals()},getPlantContentParams:function(){return{cmd:"plantprivate",id:this.getPlantID(),date:neo.dateTime.format("yyyyMMdd",this.date),proc:"m"}},getHolidayContentParams:function(){var b={cmd:"plantholidaylist",id:this.getPlantID()};this.extendMonthRange(b,"startdate","enddate");return b},updateCalendar:function(b){this.calendar.setSelectable(!!b.add)},getContentParamArray:function(){var b=this.callBase("getContentParamArray");if(!!this.getPlantID()&&this._show6Weeks){var c={cmd:"schrokuyoulist"};this.extendMonthRange(c,"smonth","emonth");b.push(c)}return b},replaceItems:function(e,d){this.callBase("replaceItems",e,d);if(this._show6Weeks){var c=e[d.index.toString()];var b=desknets.ajax.getJsonItems(c);this.calendar.set6WeekContents(b);d.index++}},replaceCalItems:function(b){this.calendar.setDate(this.date);this.calendar.replaceItems(b)},getPreloadedData:function(b){var c=this.callBase("getPreloadedData",b);if(this._show6Weeks){c[b.index.toString()]=window.jsonRestRokuyou;b.index++}return c},_initCals:function(){var b=this.$root.find(".cal-month");if(b.length>0){this.calendar=new desknets.cal.MonthCalendar(b,this._module,{date:this.date})}}});desknets.page(desknets.portal,"todo",desknets.portal.content,{_todoURL:null,_$labelSelect:a(),_$list:a(),init:function(c,d){var b=this;b.callBase("init",c,d);b._todoURL=desknets.getUrl(desknets.MODULE_API_MAIN);b._$labelSelect=b.$root.find(".portal-todo-labels");b._$list=b.$root.find(".portal-todo-list");b._updateListHtml();b._$labelSelect.val("0").change(function(e){b._reloadList()});b.$root.find(".jportal-todo-btn-complete").click(function(e){b._completeChecked()});b.$root.dnclick(".jco-modlink",function(e){desknets.clickAlink(a(this))},function(f){var e=a(this).attr("href");e=e.replace("cmd=todotaskref","cmd=todotaskentry");desknets.execLocation(e)},{ignoreOnModifierKey:true})},destroy:function(){this._$labelSelect.unbind("change");this.$root.find(".portal-todo-btn-complete").unbind("click");this.callBase("destroy")},_reloadList:function(){var b=this;desknets.ajax.rest({url:b._todoURL,data:b._getListParams(),dataType:"html",success:function(c){b._updateLoadedListHtml(c)}})},_getListParams:function(){return{cmd:"todocmdlistportal",labelid:this._$labelSelect.val(),num:this._$list.data("num")}},_updateLoadedListHtml:function(c){var b=a(c);this._$list.empty().append(b);this._updateListHtml()},_updateListHtml:function(){var c=this;var b=c._$list.find("#todo-list-whens").find("a");desknets.clickAlinkExecEvent(b,function(e,d){desknets.saveHashCmdCookie("todolist")});desknets.todoutil.SetDispDateTimeToDoTop(this._$list.find("#todo-list-whens"))},_completeChecked:function(){var b=this;var c=[b._getCompleteParams(),b._getListParams()];desknets.ajax.rest({url:b._todoURL,data:desknets.ajax.arrayToMultiCmdData(c),success:function(d){if(!!d["1"]&&!!d["1"].html){b._updateLoadedListHtml(d["1"].html)}}})},_getCompleteParams:function(){var b=[];this._$list.find("input:checked").each(function(){b.push(this.value)});return{cmd:"todocmdtaskcomplete",id:b}}});desknets.page(desknets.portal,"bookmark",desknets.portal.content,{_TREE_SELECTER:".jportal-bookmark-tree-body",_FOLDER_SELECTER:".portal-bookmark-folder-node > a",_TMPL_FOLDER_S:'<li class="co-listview-item jstree-{{status}} portal-bookmark-folder-node" data-status="{{status}}"><a href="#{{id}}" class="co-listview-item-inside"><img src="{{filename}}" alt="{{name}}" />{{name}}</a>',_TMPL_FOLDER_E:"</li>",_TMPL_BOOKMARK:'<li class="co-listview-item jstree-leaf portal-bookmark-bookmark-node"><a href="{{url}}" class="co-listview-item-inside" target="_blank"><img src="{{filename}}" alt="{{name}}" />{{name}}</a></li>',_trees:{S:a(),P:a()},_$tabs:a(),init:function(c,d){var b=this;this.callBase("init",c,d);this._initBookmarkTabs()},destroy:function(){for(var b in this._trees){if(this._trees[b].length>=0){this._trees[b].jstree("destroy");this._trees[b]=a()}}this._$tabs.find(this._TREE_SELECTER).off("open_node.jstree close_node.jstree");this._$tabs.off("click",this._FOLDER_SELECTER).tabs("destroy");this.callBase("destroy")},_initBookmarkTabs:function(){var b=this;this._$tabs=a(".portal-bookmark");this._initTreeEvent();var c=this._$tabs.data("area")=="P"?1:0;this._$tabs.tabs({selected:c,select:function(d,e){b._onShowTree(e.index,true)}});b._onShowTree(c,false)},_initTreeEvent:function(){var c=this;var b=this._$tabs.find(this._TREE_SELECTER);this._$tabs.on("click",this._FOLDER_SELECTER,function(d){d.preventDefault();var f=a(this).parent();var e=f.closest(c._TREE_SELECTER);e.jstree("toggle_node",f)});b.on("open_node.jstree",function(d,e){desknets.tree.deleteDumyItem(b);c._saveBookmarkStateByElement(e.args[0],"open")});b.on("close_node.jstree",function(d,e){c._saveBookmarkStateByElement(e.args[0],"closed")});b.on("load_node.jstree",function(d,e){a(e.args[0]).data("status","open")})},_onShowTree:function(b,d){var c=(b==1)?"P":"S";this._$tabs.data("area",c);if(this._trees[c].length<=0){this._trees[c]=this._createTree(b,d)}else{if(d){this._saveBookmarkState(c)}}},_createTree:function(c,f){var b=this;var d=(c==0)?"S":"P";var e=b._$tabs.find(b._TREE_SELECTER).eq(c);this._loadInitData(d,f,function(g){e.data("area",d);b._listSet(d,g);e.jstree({plugins:["html_data"],html_data:{data:g,ajax:{type:"POST",dataType:"json",url:desknets.portal.restURL,data:function(h){return b._getParamsForChildren(h)},success:function(h){if(!h||h.status=="ng"){desknets.ajax.onError(h.errorno,h.errormessage);return desknets.tree.TMPL_FOLDER_DUMY}return b._createChildListHtml(e,h)},error:function(j,h,i){desknets.ajax.onError(j.status,neo.ajax.getErrorMessage(j))}}}});e.bind("loaded.jstree",function(){desknets.tree.deleteDumyItem(e)})});return e},_loadInitData:function(e,f,g){var d=this;var b=this._getRequestForFolder(e);var c=neo.array.getValueArray(b);if(f){c.push(this._getSaveRequestParams(e))}desknets.ajax.rest({url:desknets.portal.restURL,data:desknets.ajax.arrayToMultiCmdData(c),success:function(i){var j=d._getResponseForFolder(b,i);var h=d._createInitHtml(e,j);g(h)}})},_getRequestForFolder:function(d){var c=this;var e=this._$tabs.data("open-folders");var b={"0":this._getListRequestParams(d,0)};if(a.type(e)=="array"){a.each(e,function(f,g){g=Number(g);if(g>0&&d=="S"){b[g.toString()]=c._getListRequestParams(d,g)}else{if(g<0&&d=="P"){b[(-g).toString()]=c._getListRequestParams(d,-g)}}})}return b},_getResponseForFolder:function(c,e){var d=0;var b={};for(var g in c){var f=e[d];b[g]=!!f?this._getFoldersAndBookmarks(f):{};d++}return b},_createInitHtml:function(c,e){var b=this;function d(f){if(!!e[f]){return b._createListHtml(e[f],c,d)}else{return""}}return d(0)},_saveBookmarkStateByElement:function(f,d){if(f.data("status")!=d){f.data("status",d);var c=f.closest(this._TREE_SELECTER);var e=String(f.children("a").attr("href")).substring(1);var b=c.data("area");this._saveBookmarkState(b,d,e)}},_saveBookmarkState:function(b,c,d){desknets.ajax.rest({url:desknets.portal.restURL,data:this._getSaveRequestParams(b,c,d)})},_getParamsForChildren:function(f){var e=this._getIdByListItem(f);var b=f.closest(this._TREE_SELECTER).data("area");var d={},c=[];c.push(this._getListRequestParams(b,e));c.push(this._getSaveRequestParams(b,"open",e));d=desknets.ajax.arrayToMultiCmdData(c);desknets.ajax.addParamForCsrf(d);desknets.ajax.addParamForNoCache(d);return d},_createChildListHtml:function(e,c){var f=!!c["0"]?c["0"]:c;var b=this._getFoldersAndBookmarks(f);var d=e.closest(this._TREE_SELECTER).data("area");return this._createListHtml(b,d)},_getListRequestParams:function(b,c){return{cmd:"portalcmdbookmarks",area:b,pfolder:c}},_getSaveRequestParams:function(b,c,e){var d={cmd:"portalcmdselbookmark",area:b};if(typeof c=="string"&&Number(e)>0){d.action=c;d.id=e}return d},_getFoldersAndBookmarks:function(c){var b=desknets.ajax.getJsonItems(c);var d=!!c.bookmarks?desknets.ajax.getItems(c.bookmarks.item):[];return{folders:b,bookmarks:d}},_createListHtml:function(b,d,f){var c,e=["<ul>"];if(b.folders.length<=0&&b.bookmarks.length<=0){return"<ul>"+desknets.tree.TMPL_FOLDER_DUMY+"</ul>"}for(c=0;c<b.folders.length;c++){e.push(this._createFolderHtml(b.folders[c],d,f))}for(c=0;c<b.bookmarks.length;c++){e.push(this._createBookmarkHtml(b.bookmarks[c],d))}e.push("</ul>");return e.join("")},_createFolderHtml:function(f,e,h){var c="leaf";var d=this._TMPL_FOLDER_S,b="",g=this._TMPL_FOLDER_E;if(a.type(h)=="function"){b+=h(f.id)}if(!!f.bookmarks||!!f.children){c=!!b?"open":"closed"}d=this._createItemHtml(f,d,{type:"folder",area:e});d=desknets.tmpl.replaceWordHtml(d,"status",c);d=desknets.tmpl.replaceWord(d,"id",f.id);return[d,b,g].join("")},_createBookmarkHtml:function(d,c){var b=this._TMPL_BOOKMARK;b=this._createItemHtml(d,b,{type:"bookmark",area:c});b=desknets.tmpl.replaceWordHtml(b,"url",d.Url);return b},_createItemHtml:function(d,c,b){c=desknets.tmpl.replaceWord(c,"filename",String(d.filename));c=desknets.tmpl.replaceWord(c,"name",String(d.Name));return c},_listSet:function(b,c){if(c=="<ul>"+desknets.tree.TMPL_FOLDER_DUMY+"</ul>"){a(this._trees[b]).next(".co-nodata").show()}else{a(this._trees[b]).next(".co-nodata").hide()}},_getIdByListItem:function(b){return String(b.children("a").attr("href")).substring(1)}});desknets.page(desknets.portal,"mail",desknets.portal.content,{_tmpls:null,connectionID:"portalMail",init:function(c,d){var b=this;b.callBase("init",c,d);b._initTemplate();b.$root.delegate(".jportal-mail-link","click",function(e){e.preventDefault();b._onClickMailLink(a(this))});b.$root.find(".portal-content-title > a").click(function(f){f.preventDefault();var e=a(this).attr("href");var g=(e&&e.indexOf("log=on")>=0)?true:false;desknets.webmail.openMailList(g)});b.loadMails()},destroy:function(){this.$root.undelegate(".jportal-mail-link","click");this.callBase("destroy")},getMailRequestParams:function(){return{}},processMailResponse:function(b){},getClearRequestParams:function(b){return{}},openAccountSetting:function(d,b,c){},openMail:function(d,b,c){},loadMails:function(){var b=this;b.setStatus("loading");desknets.ajax.rest({url:desknets.getUrl("zrweml"),data:this.getMailRequestParams(),dataType:"xml",id:this.connectionID,success:function(c){b.setStatus("loaded");b.processMailResponse(a(c.documentElement))},error:function(e,c,d){b.setStatus("error");b._updateRestError(d,e.status)}})},getErrorInfoHtml:function(c){var b=this,d=[];var e=(c.find("accsetting").text()=="1");c.find("recverr").each(function(){d.push(b._getReceiveErrorHtml(a(this),e))});c.find("filtererr").each(function(){d.push(b._getFilterErrorHtml(a(this)))});return d.join("")},getListHtml:function(c){var b=this,e=[],d="";c.find("list > item").each(function(){e.push(b._getListHtml(a(this)))});if(e.length>0){d=this._tmpls.list;d=desknets.tmpl.replaceWordHtml(d,"list",e.join(""));if(!!Number(c.find("more").text())){d+=this._tmpls.more}}else{if(!!Number(c.find("noacc").text())){d=this._tmpls.noAccounts}else{d=this._tmpls.noItems}}return d},setStatus:function(c){var b=this.$root.children(".portal-content-body");b.removeClass("portal-mail-loaded portal-mail-error");if(c=="loading"){this.$root.find(".portal-mail-errors").remove();this.$root.find(".portal-mail-list-body").empty()}else{b.addClass("portal-mail-"+c)}},_initTemplate:function(){var c={},b=this.$root.find("script.jportal-tmpl");b.each(function(){var d=a(this);c[d.data("name")]=d.html()});b.remove();this._tmpls=c},_getReceiveErrorHtml:function(b,e){var d=this._tmpls.receiveError||"";var c=b.attr("recverracc");var f="{{name}}";if(e&&desknets.webmail.isDispAccountSettingLink(b.attr("errorno"))){f='<a class="jportal-mail-link" href="#account-{{id}}">{{name}}</a>';f=desknets.tmpl.replaceWordHtml(f,"id",b.attr("id"))}f=desknets.tmpl.replaceWord(f,"name",c);d=desknets.tmpl.replaceWordHtml(d,"accname",f);d=desknets.tmpl.replaceWord(d,"name",c);d=desknets.tmpl.replaceWord(d,"message",b.text());return d},_getFilterErrorHtml:function(b){var c=this._tmpls.filterError||"";c=desknets.tmpl.replaceWord(c,"message",b.text());return c},_getListHtml:function(b){var c=this._tmpls.item,d=b.children("date").text();c=desknets.tmpl.replaceWord(c,"id",b.attr("id"));c=desknets.tmpl.replaceWord(c,"date",desknets.dateTime.dispDateTime(d,{type:"list"}));c=desknets.tmpl.replaceWord(c,"subject",b.children("subject").text());c=desknets.tmpl.replaceWord(c,"from",b.children("from").text());return c},_updateRestError:function(f,e){var c=this._messageColonCheck(f,e);var b=a("<li />").addClass("portal-app-error "+c.level).text(c.message);var d=a("<ul />").addClass("portal-mail-errors").append(b);this.$root.find(".portal-content-body").append(d)},_messageColonCheck:function(c,b){if(c.charAt(0)==":"){c=c.substring(1)}return desknets.parseErrorInfo(c,b)},_removeMailLink:function(b){var c=b.closest(".portal-mail-list-body");b.closest("tr").remove();if(c.find("tbody>tr").length<=0&&c.find(".portal-more-link").length<=0){c.find("table").remove();a(this._tmpls.noItems).appendTo(c)}},_onClickMailLink:function(b){var d=this;var f=d.$root.find(".portal-content-title > a").attr("href");var e=(f&&f.indexOf("log=on")>=0)?true:false;var c=String(b.attr("href"));if(c.indexOf("#account-")==0){this.openAccountSetting(c.substring(9),e,b)}else{if(c.indexOf("#mail-")==0){this.openMail(c.substring(6),e,b);this._removeMailLink(b)}else{if(c=="#erase"){this._eraseMessage(b)}else{desknets.webmail.openMailList(e)}}}},_eraseMessage:function(d){var b=this;var c=d.closest(".portal-mail-list-body");desknets.ajax.rest({url:desknets.getUrl("zrweml"),data:this.getClearRequestParams(d),dataType:"xml",success:function(e){c.find(".portal-mail-filter-error").remove()}})}});desknets.page(desknets.portal,"menu",desknets.portal.content,{init:function(c,d){this.callBase("init",c,d);var b=this;c.on("click","a",function(e){if(b._navigateToPage(a(this))){e.preventDefault()}})},_navigateToPage:function(c){var b=String(c.attr("href")).match(/cmd=optmenuwin&id=(\d+)/);if(!!b&&b.length>=2){this._authOptMenu(c,b[1]);return true}return false},_authOptMenu:function(b,c){desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_OPT),data:{cmd:"optauth",id:c},async:false,success:function(d){desknets.execLocation(b.attr("href"),b.attr("target"))}})},});desknets.page(desknets.portal,"memowhere",desknets.portal.content,{_tblTemplate:null,_selGroup:null,_init:true,_editArr:["event","place"],_defOption:{fldsort:"SEQNO",order:"1",num:"100",row:"0"},_opts:{},$tblList:a(),init:function(c,e,d){var b=this;b.callBase("init",c,e);if(!a.isEmptyObject(d)){a.extend(b._opts,b._defOption,d)}else{b._opts=b._defOption}b.$tblList=b.$root.find(".co-tbody-list");b._initListEvent();b._initListTemplate();b._setUpGroupSel();b._init=false},_initListEvent:function(){var b=this;b.$root.delegate(".jportal-memo-entry","click",function(e){e.preventDefault();var d=a(this).closest("tr");var c=d.find(".jmemo-entry-uname").val();var f=d.find("input.jco-id").val();desknets.memoutil.entryDialogInit(f,c)})},_initListTemplate:function(){var b=this;b._initListSetSort();b._tblTemplate=b.$tblList.html();b.$tblList.empty()},_setUpGroupSel:function(){var c=this;var b=c._getPreloadedData();var d={pageID:"jportal-memowhere",assign:true,onSelectGroup:function(g){if(!!c._init){return}if(neo.isSet(g)){c._opts.gid=g}c._getListData(g)}};var e={allGroup:"choosable",choosePrivateGroup:true,unassignGroup:"choosable"};c._selGroup=new desknets.page.GroupSelect;if(!!b&&typeof b.gid!="undefined"){var f=b.gid;if(!!f){d.defaultGroupId=f;c._opts.gid=f}c._selGroup.init(d,e);c._setListGroupSelect(b);c._setWhereList(b);c._listSortLink()}else{this._selGroup.init(d,e);this._getListData()}},_initListSetSort:function(){var b=this;b.$root.find(".co-btnarea").find(".co-list-sort-data").click(function(e){e.preventDefault();var d="";var c=a(this);if(c.hasClass("asc")){d=-1}else{if(c.hasClass("desc")){d=1}else{if(c.data("def")=="desc"){d=-1}else{d=1}}}b._listPageSort(c.data("sort"),d);desknets.popUp.hideAll()})},_getPreloadedData:function(){var c="jsonContent"+this.id;var b=window[c];window[c]=null;return b},_setListGroupSelect:function(c){var b=this;var d=b.$root.find(".jco-sel-items");b._selGroup.editSelectedGroup(d,c);if(!!c&&c.evgname){d.find("span").text(c.evgname)}},_setWhereList:function(f){var j=this;var g=desknets.ajax.getJsonItems(f);var i=[];var c=[];var e=0;var h=0;var b="";if(g.length<=0){j.$root.find(".co-table-list-scroll").hide();j.$root.find(".co-list-sort").hide();j.$tblList.empty();j.$root.find(".co-nodata").show();j.$root.find(".portal-more-link").hide()}else{j.$root.find(".co-table-list-scroll").show();j.$root.find(".co-list-sort").show();j.$root.find(".co-nodata").hide();e=g.length;for(h=0;h<e;h++){var d=j._tblTemplate;i=g[h];desknets.memoutil.editWhereListLine(d,i,j._editArr);for(b in i){d=j._replaceListLine(d,b,i)}c[c.length]=d}j.$tblList.empty();j.$tblList.html(c.join(""));desknets.htmlparts.addStripeClass(j.$tblList,"co-tr-even");if(e<f.allcnt){j.$root.find(".portal-more-link").show()}else{j.$root.find(".portal-more-link").hide()}}desknets.memoutil.setWhereListStyle(j.$tblList)},_replaceListLine:function(c,e,d){var b=this;if(a.inArray(e,b._editArr)>=0){c=desknets.tmpl.replaceWordChkHtml(c,e,d[e])}else{c=desknets.tmpl.replaceWord(c,e,d[e])}return c},_listSortLink:function(){var c=this;var d={};var b=null;a.extend(d,c._opts);var e=function(h){var g=null;h.removeClass("asc");h.removeClass("desc");h.each(function(){g=a(this);if(g.data("sort")==d.fldsort){if(d.order=="1"){g.addClass("asc")}else{g.addClass("desc")}return false}})};var f=c.$root.find(".co-list-sort-item").find(".co-list-sort-data");e(f);f=c.$root.find(".co-table-list").find(".co-list-sort-data");e(f)},_listPageSort:function(c,d){var b=this;b._opts.fldsort=c;b._opts.order=d;b._getListData(b._opts.gid,true)},_getListData:function(f,g){var d=this;var c=neo.isSet(f,{blank:false})?f:d._opts.gid;var b=d._getListParams(c);d._listSortLink();desknets.ajax.rest({url:desknets.getUrl(desknets.MODULE_API_MAIN),data:b,success:function(i,h,j){d._setListGroupSelect(i);d._setWhereList(i)}});if(!!f&&!neo.isSet(g)){var e=d._getSaveGidParams(f);desknets.ajax.rest({url:desknets.portal.restURL,data:e})}},_getListParams:function(c){var b=this;var d={cmd:"memowhereindex",order:b._opts.order,fldsort:b._opts.fldsort,num:b._opts.num,row:b._opts.row};if(!!c){d.gid=c}return d},_getSaveGidParams:function(b){return{cmd:"portalcmdselmemowhere",id:this.id,gid:b}}});desknets.page(desknets.portal,"custom",desknets.portal.content,{init:function(d,f){this.callBase("init",d,f);var c=d.find("script.jportal-content");if(c.length>0){var e=desknets.rte.convertForShow(c.html());var b=d.find(".portal-content-frame").html(e);desknets.rte.readyForShow(b);d.find(".portal-content-body").addClass("portal-content-rich-text")}}});desknets.page(desknets.portal,"webClip",desknets.portal.content,{init:function(b,c){this.callBase("init",b,c);desknets.webClip.init(this.$root)}});desknets.page(desknets.portal,"mailPrivate",desknets.portal.mail,{getMailRequestParams:function(){return{cmd:"mailportal"}},processMailResponse:function(c){var e=this.$root.find(".portal-mail-list-body");var d=this.getErrorInfoHtml(c);e.html(this.getListHtml(c));if(!!d){var b=a("<ul />").addClass("portal-mail-errors");b.html(d).prependTo(e)}},getClearRequestParams:function(b){return{cmd:"mailfiltererrclear"}},openAccountSetting:function(d,b,c){desknets.webmail.openSettingAccount(d,b)},openMail:function(d,b,c){desknets.webmail.openMailView(d,b)}});desknets.page(desknets.portal,"mailShare",desknets.portal.mail,{connectionID:"portalMailShared",init:function(c,d){var b=this;b.callBase("init",c,d);this.$root.find(".portal-content-setting-button").click(function(e){e.preventDefault();b._openSettingDialog()})},getMailRequestParams:function(){var b=[];this.$root.find(".portal-mail-list").each(function(){b.push(a(this).data("id"))});return{cmd:"mailshareaccportal",saids:b.join(",")}},processMailResponse:function(d){var b=this,e=[];var c=this.$root.find(".portal-mail-body");d.find(">list>item").each(function(){var f=a(this);e[f.attr("id")]=f});c.children().each(function(){var f=a(this),g=f.data("id");if(e[g]){b._processMailItem(f,e[g])}});c.show()},getClearRequestParams:function(c){var b=c.closest(".portal-mail-list").data("id");return{cmd:"mailfiltererrclear",said:b}},openAccountSetting:function(e,c,d){var b=d.closest(".portal-mail-list").data("id");desknets.webmail.openSettingAccountShare(b,c)},openMail:function(e,c,d){var b=d.closest(".portal-mail-list").data("id");desknets.webmail.openMailViewShare(e,b,c)},loadMails:function(){var b=this.$root.find(".portal-content-body");if(this.$root.find(".portal-mail-list").length>0){b.removeClass("portal-mail-no-accounts");this.callBase("loadMails")}else{this.setStatus("loading");b.addClass("portal-mail-no-accounts")}},_processMailItem:function(g,d){var h=g.find(".portal-mail-list-body");if(d.find("status").text()=="ng"){var c=this._messageColonCheck(d.find("errormessage").text(),d.find("errorno").text());var b=a("<li />").addClass("portal-app-error "+c.level).text(c.message);var e=a("<ul />").addClass("portal-mail-errors").append(b);g.append(e);return}var f=this.getErrorInfoHtml(d);h.html(this.getListHtml(d));if(!!f){var e=a("<ul />").addClass("portal-mail-errors");e.html(f).prependTo(h)}},_openSettingDialog:function(){neo.ajax.abort(this.connectionID);var c=this,b=this._getChoosenAccount();desknets.portal.shareAccountChooser.open(b,function(d){c._saveChoosenAccount(d,function(){c._setChoosenAccount(d);c.loadMails()})})},_getChoosenAccount:function(){var b=[];this.$root.find(".portal-mail-list").each(function(){var d=a(this);var c=String(d.find(".portal-content-subtitle").text());b.push({id:d.data("id"),name:c.substring(1,c.length-1)})});return b},_setChoosenAccount:function(b){var c=this.$root.find(".portal-mail-body").empty();a.each(b,function(f,g){var d=a('<div class="portal-mail-list" />').data("id",g.id);var e="["+desknets.escapeSpace(g.name,true)+"]";a('<h4 class="portal-content-subtitle" />').text(e).appendTo(d);a('<div class="portal-mail-list-body" />').appendTo(d);c.append(d)})},_saveChoosenAccount:function(b,d){var c=[];a.each(b,function(e,f){c.push(f.id)});desknets.ajax.rest({url:desknets.portal.restURL,data:{cmd:"portalcmdselshareaccount",id:c},success:d})}});desknets.page(desknets.portal,"koubai",desknets.portal.content,{init:function(b,c){this.callBase("init",b,c);this._initSetUpCloseDate(b)},_initSetUpCloseDate:function(c){var b=this;c.find("tbody").find(".portal-listitem-koubai-datetime").each(function(){var d=a(this);var e=b.dispDateTime24(String(d.data("closedate")),String(d.data("overday")),String(d.data("reptype")));d.find("span").html(e);d.attr("title",d.text())})},dispDateTime24:function(i,h,j){var k=0;var f=i.substr(0,8);var g=i.substr(8,4);var e=desknets.Resource.timeFormat;if(h==="1"){if(g.substr(0,2)=="00"){e=desknets.Resource.longSchTimeFormat24;if(e.indexOf("k")>=0){g="23"+g.substr(2,2);if(j!="2"){k=-1}}}else{if(j=="2"){k=1}}}var b=neo.dateTime.parse(f+g);if(k!=0){b=neo.dateTime.moveDate(b,k)}var d=neo.dateTime.format(e,b);var c=desknets.dateTime.dispDateTime(neo.dateTime.format("yyyyMMdd",b),{type:"list"});return c+" "+d}});desknets.page(desknets.portal,"mailimap",desknets.portal.content,{_tmpls:null,_sFolderID:"",connectionID:"portalMailImap",init:function(c,d){var b=this;b.callBase("init",c,d);b._initTemplate();b.$root.delegate(".jportal-mailimap-link","click",function(e){e.preventDefault();b._onClickMailLink(a(this))});b.$root.find(".portal-content-title > a").click(function(f){f.preventDefault();var e=a(this).attr("href");var g=(e&&e.indexOf("log=on")>=0)?true:false;desknets.webmailimap.openMailList(g)});b.loadMails()},destroy:function(){this.$root.undelegate(".jportal-mailimap-link","click");this.callBase("destroy")},getMailRequestParams:function(){return{cmd:"mailportal"}},processMailResponse:function(c){var e=this.$root.find(".portal-mailimap-list-body");var d=this.getErrorInfoHtml(c);e.html(this.getListHtml(c));this._sFolderID=c.find("fid").text();if(!!d){var b=a("<ul />").addClass("portal-mailimap-errors");b.html(d).prependTo(e)}},openMail:function(d,b,c){desknets.webmailimap.openMailView(d,this._sFolderID,b)},loadMails:function(){var b=this;b.setStatus("loading");desknets.ajax.rest({url:desknets.getUrl("zrwimapeml"),data:this.getMailRequestParams(),dataType:"xml",id:this.connectionID,success:function(c){b.setStatus("loaded");b.processMailResponse(a(c.documentElement))},error:function(e,c,d){b.setStatus("error");b._updateRestError(d,e.status)}})},getErrorInfoHtml:function(c){var b=this,d=[];c.find("filtererr").each(function(){d.push(b._getReceiveErrorHtml(a(this)))});return d.join("")},getListHtml:function(c){var b=this,e=[],d="";c.find("list > item").each(function(){e.push(b._getListHtml(a(this)))});if(e.length>0){d=this._tmpls.list;d=desknets.tmpl.replaceWordHtml(d,"list",e.join(""));if(!!Number(c.find("more").text())){d+=this._tmpls.more}}else{if(!!Number(c.find("noacc").text())){d=this._tmpls.noAccounts}else{d=this._tmpls.noItems}}return d},setStatus:function(c){var b=this.$root.children(".portal-content-body");b.removeClass("portal-mailimap-loaded portal-mailimap-error");if(c=="loading"){this.$root.find(".portal-mailimap-errors").remove();this.$root.find(".portal-mailimap-list-body").empty()}else{b.addClass("portal-mailimap-"+c)}},_initTemplate:function(){var c={},b=this.$root.find("script.jportal-tmpl");b.each(function(){var d=a(this);c[d.data("name")]=d.html()});b.remove();this._tmpls=c},_getReceiveErrorHtml:function(b){var c=this._tmpls.receiveError||"";c=desknets.tmpl.replaceWord(c,"message",b.text());return c},_getListHtml:function(b){var c=this._tmpls.item,d=b.children("date").text();c=desknets.tmpl.replaceWord(c,"id",b.attr("id"));c=desknets.tmpl.replaceWord(c,"date",desknets.dateTime.dispDateTime(d,{type:"list"}));c=desknets.tmpl.replaceWord(c,"subject",b.children("subject").text());c=desknets.tmpl.replaceWord(c,"from",b.children("from").text());return c},_updateRestError:function(f,e){var c=this._messageColonCheck(f,e);var b=a("<li />").addClass("portal-app-error "+c.level).text(c.message);var d=a("<ul />").addClass("portal-mailimap-errors").append(b);this.$root.find(".portal-content-body").append(d)},_messageColonCheck:function(c,b){if(c.charAt(0)==":"){c=c.substring(1)}return desknets.parseErrorInfo(c,b)},_removeMailLink:function(b){var c=b.closest(".portal-mailimap-list-body");b.closest("tr").remove();if(c.find("tbody>tr").length<=0&&c.find(".portal-more-link").length<=0){c.find("table").remove();a(this._tmpls.noItems).appendTo(c)}},_onClickMailLink:function(b){var d=this;var f=d.$root.find(".portal-content-title > a").attr("href");var e=(f&&f.indexOf("log=on")>=0)?true:false;var c=String(b.attr("href"));if(c.indexOf("#mailimap-")==0){this.openMail(c.substring(10),e,b);this._removeMailLink(b)}else{desknets.webmailimap.openMailList(e)}}});desknets.portal.shareAccountChooser={EVENT_ID:"chooseShareAccount.dnPortal",$dialog:a(),_tmplItem:"",_$toChoose:a(),_$choosen:a(),open:function(d,c){var b=this;if(this.$dialog.length<=0){this._create(function(){b._show(d,c)})}this._show(d,c)},_create:function(d){var b=this;var c=desknets.dialog.make("jportal-share-account-chooser",this._getDialogOptions());c.html(a("#jportal-share-account-chooser-tmpl").html());this._tmplItem=a("#jportal-share-account-chooser-item-tmpl").html();this._$toChoose=c.find(".jportal-to-choose");this._$choosen=c.find(".jportal-choosen");this._loadShareAccounts(c,function(){b._setUpDialog(c);b.$dialog=c;d()})},_getDialogOptions:function(){var b=this,c={};c[desknets.Resource.OKButtonLabel]=function(d){a(this).dialog("close");b._onClickOk()};c[desknets.Resource.CancelButtonLabel]=function(d){a(this).dialog("close")};return{title:desknets.Resource.portal.shareAccountChooserTitle,width:680,buttons:c}},_loadShareAccounts:function(c,d){var b=this;desknets.ajax.rest({url:desknets.getUrl("zrweml"),data:{cmd:"mailaccounts",proc:"2"},dataType:"xml",success:function(e){b._$toChoose.html(b._createListToChoose(a(e)));b._onUpdateList(b._$toChoose);d()}})},_createListToChoose:function(c){var b=this,d=[];c.find("item").each(function(){var e=a(this),g=e.attr("id"),f=e.find("account").text();d.push(b._createListItem(g,f))});return d.join("")},_setUpDialog:function(c){var b=this;b._$toChoose.on("click","tr",function(d){d.preventDefault();b._toggleToChoosen(a(this))});b._$choosen.on("click",".co-btn-close",function(d){d.preventDefault();b._removeFromChoosen(a(this).closest("tr"))});b._$choosen.tableDnD({onDragClass:"co-tr-selected"})},_show:function(c,b){this._$choosen.html(this._createChoosenList(c));this.$dialog.off(this.EVENT_ID).on(this.EVENT_ID,function(e,d){b(d)});this.$dialog.dialog("open")},_createChoosenList:function(c){var b=this;this._onUpdateList(this._$choosen.empty());this._$toChoose.find(".co-tr-selected").removeClass("co-tr-selected");a.each(c,function(e,f){var d=b._findItemToChoose(f.id,b._$toChoose);if(d.length>0){b._appendToChoosen(d)}})},_toggleToChoosen:function(b){if(b.hasClass("co-tr-selected")){var c=this._findItemToChoose(b.data("id"),this._$choosen);this._removeFromChoosen(c)}else{this._appendToChoosen(b)}},_appendToChoosen:function(b){var e=this._findItemToChoose(b.data("id"),this._$choosen);if(e.length<=0){var d=this._getDataFromElement(b);var c=this._createListItem(d.id,d.name);b.addClass("co-tr-selected");this._$choosen.append(a(c)).tableDnDUpdate();this._onUpdateList(this._$choosen)}},_removeFromChoosen:function(c){var b=this._findItemToChoose(c.data("id"),this._$toChoose);b.removeClass("co-tr-selected");c.remove();this._onUpdateList(this._$choosen)},_onClickOk:function(){var c=this,b=[];this._$choosen.find("tr").each(function(){b.push(c._getDataFromElement(a(this)))});this.$dialog.trigger(this.EVENT_ID,[b])},_getDataFromElement:function(b){return{id:b.data("id"),name:b.find(".portal-chooser-text").text()}},_createListItem:function(d,b){var c=this._tmplItem;c=desknets.tmpl.replaceWordHtml(c,"id",d);c=desknets.tmpl.replaceWord(c,"name",b);return c},_onUpdateList:function(d){var b=d.find("tr").length>0;var c=d.closest(".co-table-list-scroll");if(b&&c.hasClass("empty")){c.removeClass("empty")}else{if(!b&&!c.hasClass("empty")){c.addClass("empty")}}},_findItemToChoose:function(c,b){return b.children().filter(function(){return a(this).data("id")==c})}};app.addInitialAction(function(){desknets.portal.init()})})(jQuery);