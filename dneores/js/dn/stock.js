/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){(function(b){desknets.stock={MODULE_API_STOCK:"zrstock",MODULE_MAIN_STOCK:"zstock",CMD_STOCKINDEX:"stockcmdindex",PAGE_STOCKINDEX:"stockindex",CMD_STOCKHISTORY:"stockcmdhistory",PAGE_STOCKHISTORY:"stockhistory",CMD_STOCKDETAIL:"stockcmddetail",PAGE_STOCKDETAIL:"stockdetail",CMD_STOCKSENDMESSAGE:"stocksendmsg",PAGE_STOCKTRADE:"stocktrade",CMD_STOCKTRADE:"stockcmdtrade",PAGE_STOCKSEARCH:"stocksearchlist",CMD_STOCKSEARCH:"stockcmdsearchlist",CMS_STOCKSENDMSG:"stockcmdsendmsg",PAGE_STOCKMSETLIST:"stockmsetindex",PAGE_STOCKMSETENTRY:"stockmsetentry",KEY_PREVRSV1:"prevrsv1",KEY_PREVRSV2:"prevrsv2",ID_STOCKINDEXHISTORY:"jstock-stockhistory-list",ID_STOCKINDEXHISTORYFORM:"stkidxhistoryform",ID_STOCKINDEXSEARCH:"jco-m-search-container",ID_STOCKINDEXSRCHFORM:"searchfrm",init:function(){var c=b("#jco-pv-funcid").val();if(this.isStock(c)){desknets.hashobserver.init(desknets.stock)}if(c=="stockindex"){desknets.stock.stockindex.init();desknets.stock.subwin.init()}if(c=="stockindexinit"){desknets.stock.stockindexinit.init();desknets.stock.subwin.init()}},isStock:function(d){var c=this;if(d.indexOf("stock")>=0&&d.indexOf("pset")==-1&&d.indexOf("mset")==-1){return true}return false}}})(jQuery);(function(b){desknets.page(desknets.stock,"subwin",desknets.PageSubwinSearch,{_initSearch:function(){var e=b(".jco-subwindow-search");var f=desknets.paramanalyzer.getHashParams();e.find('input[name="srch_key"]').val(f.srch_key);e.find('input[name="min"]').val(f.min);e.find('input[name="max"]').val(f.max);var c=this;c.callBase("_initSearch");c._initGroupSelect();var d={assign:true};desknets.page.groupSelect.init(d)},_getSearchPrm:function(e){var c=this;var d=c.$_inputArea;e.fldsort="Group";e.order="1";e.row="0";e.srch_key=d.find('input[name="srch_key"]').val();e.min=d.find('input[name="min"]').val();e.max=d.find('input[name="max"]').val();e.gid=d.find('select[name="gid"]').val();return e},_execClear:function(){var c=this;c.$_inputArea.find("input").not(".co-guide-searchbtn").not(".jco-sel-btn").val("");c.$_inputArea.find("select[name=gid]").val("all")},_execInitSearch:function(){var c=this;var d={};d=c._getSearchPrm(d);d.cmd=c._getSearchCmd();d._=desknets.createRandomId();d.init="1";c._setLocationHash(d)},_initGroupSelect:function(){var c=this;if(desknets.pageframe.isSubWinOpen()){c._getSelectedGroupInfo()}desknets.menu.$root.on("menuChanged.side",function(d,e){if(desknets.pageframe.isSubWinOpen()){c._getSelectedGroupInfo()}})},_getSelectedGroupInfo:function(){var d=this;var e=d.$_inputArea;var c=desknets.paramanalyzer.getHashParam("gid");var g=desknets.paramanalyzer.getHashParam("cmd");var f=e.find('select[name="gid"]').val();if(f!=c&&g==desknets.stock.PAGE_STOCKSEARCH){e.find('select[name="gid"]').val(c)}},_chkInputSearchRequired:function(){var e=this;var f=e.$_inputArea;var h="";var d=true;var g=f.find('input[name="min"]').val();var c=f.find('input[name="max"]').val();if((neo.isSet(g,{blank:false})&&neo.isSet(c,{blank:false})&&Number(g)>Number(c))||(neo.isSet(g,{blank:false})&&isNaN(g))||(neo.isSet(c,{blank:false})&&isNaN(c))){h=desknets.Resource.Message.stock_warnsearchstocknuminvalid;d=false}if(!d){desknets.dialog.alert(h,{type:"warn"});return false}return e.callBase("_chkInputSearchRequired")},_getMainCmd:function(){return desknets.stock.PAGE_STOCKINDEX},_getSearchCmd:function(){return desknets.stock.PAGE_STOCKSEARCH},_getRestModule:function(){return desknets.stock.MODULE_API_STOCK},_getConstModule:function(){return"zrconst"},_getGroupInfoCmd:function(){return"constructgroupinfo"}})})(jQuery);(function(b){desknets.page(desknets.stock,"stockindex",desknets.PageListBase,{sAllGroupName:"allTradeGroupName",boSetTopMessage:false,_initListStart:function(){var c=this;c.callBase("_initListStart");var e=c._getGroupSelectDialogOpt();var d=c._getGroupSelectOpt();desknets.page.groupSelect.init(d,e)},_getGroupSelectDialogOpt:function(){var c=this;var d={allGroup:"choosable",unassignGroupLabel:desknets.Resource.stock.commonGroupName,allGroupLabel:desknets.Resource.stock[c.sAllGroupName],unassignGroup:"choosable"};return d},_getGroupSelectOpt:function(){var c=this;var d={assign:true,onSelectGroupHide:true};return d},_getListAjaxSuccess:function(d){var c=this;c.callBase("_getListAjaxSuccess",d);desknets.page.groupSelect._selTmpl=desknets.page.groupSelect._defTmpl;desknets.page.groupSelect.editSelectedAssignGroup(c.$mjListPage,c.$mjListPage.find(".jco-sel-items"),d);if(!c.boSetTopMessage){c._setUpMessage()}},_replaceListLine:function(d,i,g){var c=this;if(i===desknets.stock.KEY_PREVRSV1||i===desknets.stock.KEY_PREVRSV2){var e=parseInt(g[i],10);if(g[i]!=null){var f='<a href="#cmd='+c._getHistoryCmd()+"&id="+g.id+'" class="jstock-link-tradehistory">'+e+"</a>";var h=new RegExp("{{"+i+"}}","ig");d=d.replace(h,f);return d}}return c.callBase("_replaceListLine",d,i,g)},_tradeHistoryPage:function(e){var c=this;var d={};d.cmd=c._getHistoryCmd();d.id=e;c._setLocationHash(d)},_hashUpdatePageView:function(d){var c=this;var e=desknets.paramanalyzer.getHashParams();if(d==desknets.stock.stockhistory._getListCmd()){var c=this;desknets.stock.stockhistory.initPage(c.mhashBackCmd,c.mhashIdBack)}else{if(d==desknets.stock.PAGE_STOCKSEARCH){if(b("#jco-m-search-container").find(".jco-title").length>0){desknets.stock.stocksearch._getListAjax(e.row)}else{desknets.stock.stocksearch.initPage(desknets.stock.PAGE_STOCKINDEX,"jco-m-list-container")}c.mhashBackErrCmd=c.mhashBackCmd;c.mhashIdErrBack=c.mhashIdBack;c.mhashBackCmd=desknets.stock.PAGE_STOCKSEARCH;c.mhashIdBack="jco-m-search-container"}}},_isSaveHashCmd:function(){var c=this;var d=desknets.paramanalyzer.getHashParam("cmd");if(d==desknets.stock.stocksearch._getListCmd()){return true}return c.callBase("_isSaveHashCmd")},_getDelAddPrm:function(){var d=this;var c={};var e="";e=d.$mjListPage.find(".jco-sel-items").find("input").val();c.gid=e;return c},_setUpMessage:function(){var f=this;var e=f.$mjTableList.find("tr");var d=b("#jco-pv-funcid").val();var c=desknets.paramanalyzer.getHashParam("cmd");var g=f.$mjListPage.find(".jco-back-page-data").find('input[name="gid"]').val();if(e.length==0&&d==desknets.stock.stockindex._getListCmd()&&g==desknets.PRM_VAL_ALLDEL&&c!=desknets.stock.PAGE_STOCKSEARCH){f._setUpNoStockMessage()}f.boSetTopMessage=true},_setUpNoStockMessage:function(){var c=this;var e="";var g="";var f=b("#co-m-h-setting-menus").find(".co-m-h-setting-menu");e=desknets.Resource.stock.noStockMessage;if(f.hasClass("mglink")){var d=desknets.getUrl(desknets.stock.MODULE_MAIN_STOCK)+"?cmd="+desknets.stock.PAGE_STOCKMSETLIST+"#gid="+desknets.PRM_VAL_ALLDEL+"&cmd="+desknets.stock.PAGE_STOCKMSETENTRY;g='<a href="'+d+'">'+desknets.Resource.stock.noStockMessage_manager+"</a>"}else{g=desknets.Resource.stock.noStockMessage_user}desknets.pageframe.viewTopMsg(e+"<br />"+g,"alert")},_getRestModule:function(){return desknets.stock.MODULE_API_STOCK},_getListCmd:function(){return desknets.stock.PAGE_STOCKINDEX},_getListExecCmd:function(){return desknets.stock.CMD_STOCKINDEX},_getListDispCmd:function(){return desknets.stock.PAGE_STOCKTRADE},_getListModCmd:function(){return desknets.stock.PAGE_STOCKTRADE},_getHistoryCmd:function(){return desknets.stock.PAGE_STOCKHISTORY},_getListDispClass:function(){return desknets.stock.stocktrade},_getListEntryClass:function(){return desknets.stock.stocktrade},_getListModClass:function(){return desknets.stock.stocktrade}})})(jQuery);(function(b){desknets.page(desknets.stock,"stocktrade",desknets.PageInputBase,{getMultiRequest:function(){var c=this;var f={};var e={};var d={};f=desknets.paramanalyzer.getHashParams();f.cmd=c._getDispExecCmd();d["0"]=f;e=desknets.paramanalyzer.getHashParams();d["1"]=e;return d},_initHtml:function(d){var c=this;if(d[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[1]["errorno"],d[1]["errormessage"]);return}c.$mjPage.empty();c.$mjPage.html(d[1].html);b("#jstock-trade-tmplset").tmpl(d[0]).appendTo("#jstock-trade-disparea");desknets.htmlparts.convertHrefInText(c.$mjPage.find(".co-textarea-view"));var e=b("#jstock-stocknum");var f=e.html();if(neo.isSet(f)&&isNaN(f)!=true&&f<0){e.addClass("stock-minus")}c._initSet()},_inputButton:function(){var c=this;b(".jstock-trade-save").click(function(){return c._inputTradeSubmit()});b("#jco-m-input-page").find(".co-pageback").click(function(){c.dispBackListPage()});b(".jstock-trade-sendmsg").click(function(d){d.preventDefault();c._inputPageDetailSendMsg()});b("#jstock-stockdelnum").keyup(function(d){var f=b(d.target).val();if(!isNaN(f)&&f!=""&&f.indexOf("-")==-1){b("#jstock-stocknum").text(parseInt(b("#jstock-stocknownum").text(),10)-parseInt(f,10));f=b("#jstock-stocknum").text();if(neo.isSet(f)&&isNaN(f)!=true&&f<0){b("#jstock-stocknum").addClass("stock-minus")}if(neo.isSet(f)&&isNaN(f)!=true&&f>=0){b("#jstock-stocknum").removeClass("stock-minus")}}else{b("#jstock-stocknum").text(b("#jstock-stocknownum").text());b("#jstock-stocknum").removeClass("stock-minus")}})},_inputTradeSubmit:function(){var c=this;var d="";d=c._getTradeExecCmd();b('input[name="cmd"]').val(d);b('input[name="id"]').val(b("#jco-m-input-page").find('input[name="id"]').val())},_inputPageDetailSendMsg:function(){var c=this;var d=b("#jstock-uidialog-send");if(d.length>0){d.find("textarea").val("");return d.dialog("open")}d=b("<div />").attr("id","jstock-uidialog-send").appendTo(document.body);d.addClass("co-editarea");c._initSendMsgDialog(d);return d},_initSendMsgDialog:function(d){var c=this;var e=function(){d=desknets.dialog.setUp(d,c._getDialogOptions());d.dialog("open")};desknets.tmpl.load(d,"stock/sendmsg.html",e,{cache:true})},_getDialogOptions:function(){var c=this,f={};f[desknets.Resource.OKButtonLabel]=function(){c._sendMsgDialogSend(b(this).find("textarea").val())};f[desknets.Resource.CancelButtonLabel]=function(){b(this).dialog("close")};var e=desknets.dialog.getDialogOption();var d={buttons:f,title:desknets.Resource.stock.pageDetailSendMsgTitle,width:400};b.extend(e,d);return e},_sendMsgDialogSend:function(){var c=this;var d=b("#jstock-uidialog-send");var e="";var e=d.find("textarea").val();if(e==""){desknets.dialog.alert(desknets.Resource.Message.stock_warnsendmsgbodyempty,{type:"warn"});return false}c._pageDetailSendAjax(e)},_pageDetailSendAjax:function(e){var c=this;var d={};var f={};d.success=function(g){c._onSuccessSendMsg(g)};f.memo=e;f.cmd=desknets.stock.CMS_STOCKSENDMSG;f.id=desknets.paramanalyzer.getHashParam("id");c._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,f,d)},_onSuccessSendMsg:function(c){var d=b("#jstock-uidialog-send");if(!!c.noticeerror){var d=desknets.dialog.alert(c.noticeerror,{extraMessage:c.errsendeml,extraClass:"co-msg-r",type:"warn"});d.bind("dialogclose",function(f){desknets.dialog.deleteById("warn")});return}else{d.dialog("close")}},_inputAjaxForm:function(){var c=this;var d={};d=c._inputAjaxFormOption();c._initFormRequestAjax(c._mIdPageForm,d)},_inputAjaxFormOption:function(){var c=this;var d=c.callBase("_inputAjaxFormOption");d.success=function(g,e,h){if(!!g.noticeerror){var f=desknets.dialog.alert(g.noticeerror,{extraMessage:g.errsendeml,extraClass:"co-msg-r",type:"warn"});f.bind("dialogclose",function(i){desknets.dialog.deleteById("warn");c._setLocationHashForm()});return}if(c.mBackCmd==desknets.stock.PAGE_STOCKSEARCH){desknets.stock.stocksearch.boAddTrade=true}c._setLocationHashForm()};return d},_getErrorPlace:function(c){var d=this;if(c=="trade"){var e=b("span.co-required").html()+desknets.merrMsgConnect;return e}else{return d.callBase("_getErrorPlace",c)}},_getRestModule:function(){return desknets.stock.MODULE_API_STOCK},_getDispExecCmd:function(){return desknets.stock.CMD_STOCKDETAIL},_getSendExecCmd:function(){return desknets.stock.CMD_STOCKSENDMESSAGE},_getTradeExecCmd:function(){return desknets.stock.CMD_STOCKTRADE}})})(jQuery);desknets.page(desknets.stock,"stockhistory",desknets.PageListBase,{_getFieldsCheckScroll:function(){return["id"]},_listMoveScroll:function(){this._setClearScrollPosition();this.callBase("_listMoveScroll")},initPage:function(d,c){var b=this;b.boGetHtmlSingle=false;b.callBase("initPage",d,c)},_initListStart:function(){var b=this;b.callBase("_initListStart");b._initListStartPageBack()},_getListAjaxSuccessEnd:function(){var b=this;a("#jstock-stockhistory-list").show();desknets.htmlparts.convertHrefInText(b.$mjListPage.find(".co-textarea-view"));b.callBase("_getListAjaxSuccessEnd")},_initListStartPageBack:function(){var b=this;a("#jstock-stockhistory-list").find(".co-pageback").click(function(c){c.preventDefault();b._stockListPage()})},_stockListPage:function(){var b=this;var c={};if(!neo.isSet(b.mBackCmd)||!neo.isSet(b.mIdBack)){return null}c=desknets.getInputDataToObj(a("#"+b.mIdBack).find(".jco-back-page-data"));c.cmd=b.mBackCmd;if(neo.isSet(c)){b._setLocationHash(c)}},_replaceListLine:function(c,f,d){var b=this;if(f=="date"){var e=desknets.dateTime.dispDateTime(d[f],{type:"list"});c=desknets.tmpl.replaceWord(c,f,e);return c}return b.callBase("_replaceListLine",c,f,d)},_getIdListPage:function(){return desknets.stock.ID_STOCKINDEXHISTORY},_getIdListPageForm:function(){return desknets.stock.ID_STOCKINDEXHISTORYFORM},_getRestModule:function(){return desknets.stock.MODULE_API_STOCK},_getListCmd:function(){return desknets.stock.PAGE_STOCKHISTORY},_getListExecCmd:function(){return desknets.stock.CMD_STOCKHISTORY}});(function(b){desknets.page(desknets.stock,"stocksearch",desknets.stock.stockindex,{boAddTrade:false,getMultiRequest:function(){var c=this;var f={};var e={};var d={};f=desknets.paramanalyzer.getHashParams();f.cmd=c._getListExecCmd();f.num=b("#jco-m-list-container").find(".jco-back-page-data").find('input[name="num"]').val();f.init="1";d["0"]=f;e=desknets.paramanalyzer.getHashParams();d["1"]=e;return d},getListParamToObj:function(){var c=this;var f={};var e="";var d=desknets.paramanalyzer.getHashParam("init");e=c._getListExecCmd();f=desknets.getInputDataToObj(c.$mjListPage.find(".jco-back-page-data"));f.cmd=e;f.srch_key=desknets.paramanalyzer.getHashParam("srch_key");f.min=desknets.paramanalyzer.getHashParam("min");f.max=desknets.paramanalyzer.getHashParam("max");f.gid=desknets.paramanalyzer.getHashParam("gid");if(d!=""||c.boAddTrade){f.init="1";c.boAddTrade=false}return f},_initListStart:function(){var c=this;var c=this;c._initListStartSet();c._initListStartTemplate();c._initListStartChk();c._initListStartModLink();c._initListSetSort();var d=c.$mjListPage;var e=desknets.paramanalyzer.getHashParams();d.find('input[name="srch_key"]').val(e.srch_key);d.find('input[name="min"]').val(e.min);d.find('input[name="max"]').val(e.max);d.find('input[name="gid"]').val(e.gid)},_initListEndButton:function(){var c=this;c.callBase("_initListEndButton");c.$mjListPage.find(".co-pageback").click(function(d){d.preventDefault();c.dispBackListPage()});c.$mjListPage.find(".co-btn-update").unbind("click");c.$mjListPage.find(".co-btn-update").click(function(d){d.preventDefault();b(this).addClass("on");desknets.scrollManager.clearScrollPosition(c._getListCmd());c._getListAjaxUpdate(c._getListRow())})},_getListAjaxUpdate:function(e){var c=this;var f={};var d={};c._hashUpdatePageParams();f=c.getListParamToObj();f.row=e;f.init="1";c._mchkIDs=c._getListAjaxGetId();d=c._getListAjaxOptions();c._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,f,d)},_getRestModule:function(){return desknets.stock.MODULE_API_STOCK},_getListCmd:function(){return desknets.stock.PAGE_STOCKSEARCH},_getListExecCmd:function(){return desknets.stock.CMD_STOCKSEARCH},_getIdListPage:function(){return desknets.stock.ID_STOCKINDEXSEARCH},_getIdListPageForm:function(){return desknets.stock.ID_STOCKINDEXSRCHFORM}})})(jQuery);app.addInitialAction(function(){desknets.stock.init()})})(jQuery);