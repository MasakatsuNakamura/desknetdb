/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.agent={MODULE_AGENT_MAIN:"zagent",MODULE_AGENT_API_MAIN:"zragent",PAGE_AGENTINDEX:"agentindex",CMD_AGENTRLIST:"agentrlist",CMD_AGENTRDEL:"agentrdel",init:function(){var c=this;var b=a("#jco-pv-funcid").val();if(b==c.PAGE_AGENTINDEX){desknets.hashobserver.init(desknets.agent);desknets.agent.agentindex.init()}}};desknets.page(desknets.agent,"agentindex",desknets.PageListBase,{init:function(){this.callBase("init");if(desknets.pageframe.getTopMsg().hasClass("alert")){desknets.pageframe.viewTopMsg("","")}},_initListEnd:function(){var b=this;b.callBase("_initListEnd");var d=b.$mjListPage.find(".co-list-search-text");var c=function(){var e=b.$mjListPage.find(".jco-back-page-data").find('input[name="srch_key"]');if(!b.chkListSearchKeyLength(d.val())){return}if(e.val()!=desknets.escape(d.val())){e.val(d.val());b.boChangePageNoHide=true;b._listPage("0")}};a(".co-list-search-btn").find("a").click(function(e){e.preventDefault();c()});desknets.keysearch.setUp(desknets.agent.CMD_AGENTRLIST,d,c)},changPage:function(){var b=this;b.callBase("changPage");if(!b.boSetwatermark){b.boSetwatermark=true;desknets.watermark.set(b.$mjListPage.find(".co-list-search-text"))}},_replaceListLine:function(c,f,g){var j=this;var h;var i;if(f==="sendtime"){i=desknets.dateTime.dispDateTime(g[f],{type:"list"});c=desknets.tmpl.replaceWordHtml(c,f,i)}else{if(f=="contents"){c=desknets.tmpl.replaceWordLF(c,f,g[f])}else{if(f=="Url"){var d=desknets.getNeoParam(desknets.paramanalyzer.getHashParams());if(d.length>0){d="#"+d}var b=desknets.getUrl(desknets.agent.MODULE_AGENT_MAIN)+"?cmd="+j._getListCmd()+d;var e=b.lastIndexOf("/");if(e>=0){b=b.substring(e+1)}b=encodeURIComponent(b);i=desknets.tmpl.replaceWordHtml(g[f],"ext",desknets.getExtension());i=i+"&bproc="+encodeURIComponent(b);c=c.replace('href="Url"','href="'+i+'"')}else{if(f=="status"){c=desknets.tmpl.replaceWordLF(c,f,g[f]+"\n"+g.sendstsmsg)}else{return j.callBase("_replaceListLine",c,f,g)}}}}return c},_getListAjaxSuccessEnd:function(){var b=desknets.paramanalyzer.getHashParams();this.callBase("_getListAjaxSuccessEnd");desknets.keysearch.fixListWatermark(this.$mjListPage,b)},_initListStartModLink:function(){var b=this;this.$mjTableList.dnclick(".jco-modlink",function(c){b._setHashCmdLinkAgent(a(this));desknets.clickAlink(a(this))},function(d){b._setHashCmdLinkAgent(a(this));var c=a(this).attr("href");var e=a(this).attr("target");c=c.replace("cmd=schreferdtl","cmd=schmod");c=c.replace("cmd=todotaskref","cmd=todotaskentry");desknets.execLocation(c,e)})},_setHashCmdLinkAgent:function(b){if(!b){return}var d=b.attr("href");if(!d){return}var c="todolist";if(d.indexOf("cmd=sch")>0){c="schindex"}desknets.saveHashCmdCookie(c)},_getSearchParam:function(){var b=this;var e=desknets.paramanalyzer.getHashParams();var d=b.$mjListPage.find(".jco-back-page-data");var c=d.find('input[name="srch_key"]').val();var f={};if(e&&e.srch_key&&e.srch_key.length>0){f.srch_key=e.srch_key}else{if(c!=""){f.srch_key=c}}return f},_getRestModule:function(){return desknets.agent.MODULE_AGENT_API_MAIN},_getListCmd:function(){return desknets.agent.PAGE_AGENTINDEX},_getListExecCmd:function(){return desknets.agent.CMD_AGENTRLIST},_getDelExecCmd:function(){return desknets.agent.CMD_AGENTRDEL},_getDelAddPrm:function(){return this._getSearchParam()}});app.addInitialAction(function(){desknets.agent.init()})})(jQuery);