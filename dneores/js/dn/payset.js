/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.payset={MODULE_PAY:"zpay",MODULE_API_PAY:"zrpay",PAGE_PAYLIST:"payindex",PAGE_PAYPSETGEN:"paypsetgen",CMD_PAYPSETGEN:"paypsetcmdgen",PAGE_PAYPSETIMPORT:"paypsetimport",PAGE_PAYPSETEXPORT:"paypsetexport",PAGE_PAYPSETREPSEL:"paypsetrepsel",PAGE_PAYMSETINDEX:"paymsetindex",CMD_PAYMSETINDEX:"paymsetcmdindex",PAGE_PAYMSETENTRY:"paymsetentry",CMD_PAYMSETENTRY:"paymsetcmdentry",PAGE_PAYMSETDISP:"paymsetdisp",CMD_PAYMSETDISP:"paymsetcmddisp",CMD_PAYMSETDEL:"paymsetdel",CMD_PAYMSETDEMAND:"paymsetdemand",CMD_PAYMSETDOWNLOAD:"paymsetdownload",PAGE_PAYMSETREPENTRY:"paymsetrepentry",PAGE_PAYMSETREPSEL:"paymsetrepsel",CMD_PAYMSETREPSEL:"paymsetcmdrepsel",PAGE_PAYMSETREPSELENTRY:"paymsetrepselentry",CMD_PAYMSETREPSELENTRY:"paymsetcmdrepselentry",PAGE_PAYMSETITEM:"paymsetitem",CMD_PAYMSETITEM:"paymsetcmditem",PAGE_PAYMSETITEMENTRY:"paymsetitementry",CMD_PAYMSETITEMENTRY:"paymsetcmditementry",CMD_PAYMSETDELITEM:"paymsetdelitem",CMD_PAYMSETMVITEM:"paymsetmvitem",PAGE_PAYSETADMIN:"paysetadmin",PAGE_PAYSETGEN:"paysetgen",CMD_PAYSETGEN:"paysetcmdgen",PAGE_PAYSETMANAGER:"paysetmanager",init:function(){var b=a("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(b);if(b==desknets.payset.PAGE_PAYPSETGEN){desknets.payset.paypsetgen.init();desknets.payset.subwin.init()}else{if(b==desknets.payset.PAGE_PAYPSETIMPORT){desknets.payset.paypsetimport.init();desknets.payset.subwin.init()}else{if(b==desknets.payset.PAGE_PAYPSETEXPORT){desknets.payset.paypsetexport.init();desknets.payset.subwin.init()}else{if(b==desknets.payset.PAGE_PAYPSETREPSEL){desknets.payset.paypsetrepsel.init();desknets.payset.subwin.init()}else{if(b==desknets.payset.PAGE_PAYMSETINDEX){desknets.hashobserver.init(desknets.payset);desknets.payset.paymsetindex.init()}else{if(b==desknets.payset.PAGE_PAYMSETREPENTRY){desknets.payset.paymsetrepentry.init()}else{if(b==desknets.payset.PAGE_PAYMSETREPSEL){desknets.hashobserver.init(desknets.payset);desknets.payset.paymsetrepsel.init()}else{if(b==desknets.payset.PAGE_PAYMSETITEM){desknets.hashobserver.init(desknets.payset);desknets.payset.paymsetitem.init()}else{if(b==desknets.payset.PAGE_PAYSETGEN){desknets.payset.paysetgen.init()}else{if(b==desknets.payset.PAGE_PAYSETMANAGER){desknets.payset.paysetmanager.init()}}}}}}}}}}}};desknets.page(desknets.payset,"subwin",desknets.pay.subwin,{inputSet:function(){},});desknets.page(desknets.payset,"paypsetgen",desknets.PageSet,{_getNextCmd:function(){return desknets.payset.PAGE_PAYLIST}});desknets.page(desknets.payset,"paypsetimport",desknets.PageImport,{_getRestModule:function(){return desknets.payset.MODULE_API_PAY}});desknets.page(desknets.payset,"paypsetexport",desknets.PageExport,{init:function(){var b=this;b.callBase("init");desknets.htmlparts.setUpForm(a("#frm"))},checkExport:function(){var c=a(".jpay-date-fromto");var b=c.find(".ui-invalid");if(b.length>0){return null}if(!desknets.validation.isRequiredDateFromTo(c)){return desknets.Resource.Message.com_datechk_fromto_required}if(!desknets.validation.isInputDateFromTo(c)){return desknets.Resource.Message.com_datechk_fromto}return null}});desknets.page(desknets.payset,"paypsetrepsel",desknets.PageSet,{init:function(){var b=this;b._initUserSelectDialog();b.callBase("init")},_initUserSelectDialog:function(){var q=this;var l=true;var m=a("#jpay-sel-items-area");m.on("mouseenter","tr",function(r){var s=a(this);setTimeout(function(){s.addClass("hover")},0)});m.on("mouseleave","tr",function(r){var s=a(this);setTimeout(function(){s.removeClass("hover")},0)});var e=a("#jpay-report-dialog");var b=m.find("table").find("thead").remove().html();var i=e.find(".jco-checkbox-all");var g=e.find(".co-chk-cnt");var f=e.find(".co-chk-cnt-all");var d=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_listchk_cnt_all_disp,"num",f.text());f.text(d);var k=function(r){if(r===true){g.show();f.show()}else{g.hide();f.hide()}};$item=m.find(".jco-sel-items");var p=m.find(".co-sel-no-items-message");var o=m.find(".co-sel-items-entry");var c=function(){if($item.children().length<=0){p.show();o.hide()}else{p.hide();o.show()}};c();var h=desknets.dialog.getDialogOption();h.width=600;h.autoOpen=false;h.title=desknets.Resource.pay.reportertitle;h.open=function(){e.find('input:checkbox[name="repid"]').attr("checked",false);e.find(".co-tr-selected").removeClass("co-tr-selected");$item.children().each(function(){var r=a(this);e.find('input:checkbox[name="repid"][value="'+r.find(".jpay-rep-id").val()+'"]').attr("checked",true).parent().parent().addClass("co-tr-selected")});i.attr("checked",false);k(false)};h.buttons={};h.buttons[desknets.Resource.OKButtonLabel]=function(){$item.find("tr").remove();e.find('input:checkbox[name="repid"]:checked').each(function(){var t=a(this).closest("tr");var s=b;s=desknets.tmpl.replaceWord(s,"id",a(this).val());s=desknets.tmpl.replaceWord(s,"name",t.find(".co-td-dialog-user").text());var r=t.find(".co-busyo");s=desknets.tmpl.replaceWordHtml(s,"summary",r.html());s=desknets.tmpl.replaceWord(s,"summaryAsText",r.html());$item.append(s)});c();a(this).dialog("close")};h.buttons[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};e=desknets.dialog.setUp(e,h);e.find(".co-table-list-scroll").find("input[type=checkbox]").click(function(r){k(false);i.attr("checked",false);if(a(this).attr("checked")){a(this).closest("tr").addClass("co-tr-selected")}else{a(this).closest("tr").removeClass("co-tr-selected")}});i.click(function(){var r=(a(this).attr("checked"))?true:false;e.find("input[type=checkbox]").attr("checked",r);if(r){k(true);e.find(".co-table-list-scroll").find("tr").addClass("co-tr-selected")}else{k(false);e.find(".co-table-list-scroll").find("tr").removeClass("co-tr-selected")}});m.delegate(".co-btn-close","click",function(r){r.preventDefault();a(this).closest("tr").remove();c()});var n=e.find(".co-table-list").find("thead").find("tr");for(var j=0;j<n.length;j++){desknets.htmlparts.addLastClass(a(n[j]),"last-child")}a(".jco-sel-btn").click(function(){e.dialog("open");if(l){desknets.dialog.setFirstDialogOpen(e);l=false}})},_getNextCmd:function(){return desknets.payset.PAGE_PAYLIST}});desknets.page(desknets.payset,"paymsetindex",desknets.pay.payindex,{_initListStartModLink:function(){var b=this;b.$mjTableList.dnclick(".jco-modlink",function(d){var c=a(this).parent().parent().find(".jco-id").val();var e=a(this).parent().parent().find(".jco-userid").val();b.inputDispPage(c,e)},function(d){var c=a(this).parent().parent().find(".jco-id").val();var e=a(this).parent().parent().find(".jco-userid").val();b.inputModPage(c,e)},{ignoreOnModifierKey:true})},inputModPage:function(f,d){var b=this;var e="";var c={};e=b._getListModCmd();c=b._getModPageParam();c.cmd=e;c.userid=d;c.id=f;b._inputPage(c)},inputDispPage:function(f,d){var b=this;var e="";var c={};e=b._getListDispCmd();c=b._getDispPageParam();c.cmd=e;c.userid=d;c.id=f;b._inputPage(c)},_getRestModule:function(){return desknets.payset.MODULE_API_PAY},_getListCmd:function(){return desknets.payset.PAGE_PAYMSETINDEX},_getListExecCmd:function(){return desknets.payset.CMD_PAYMSETINDEX},_getListDispCmd:function(){return desknets.payset.PAGE_PAYMSETDISP},_getListAddCmd:function(){return desknets.pay.PAGE_PAYENTRY},_getListModCmd:function(){return desknets.payset.PAGE_PAYMSETENTRY},_getDelCmd:function(){var b=this;if(b._sDelFlg=="3"){return desknets.pay.CMD_PAYCONFREPORT}return""},_getDelExecCmd:function(){var b=this;if(b._sDelFlg=="1"){return desknets.payset.CMD_PAYMSETDEMAND}else{if(b._sDelFlg=="2"){return desknets.payset.CMD_PAYMSETDEMAND}}return desknets.payset.CMD_PAYMSETDEL},_getDownloadExecCmd:function(){return desknets.payset.CMD_PAYMSETDOWNLOAD},_getListDispClass:function(){return desknets.payset.paymsetdisp},_getListModClass:function(){return desknets.payset.paymsetentry}});desknets.page(desknets.payset,"paymsetentry",desknets.PageInputBase,{_initSet:function(){var b=this;b.callBase("_initSet");desknets.htmlparts.setUpForm(a(b._mIdPageForm))},_getRestModule:function(){return desknets.payset.MODULE_API_PAY},_getDelExecCmd:function(){return desknets.payset.CMD_PAYMSETDEL},_getAddExecCmd:function(){return desknets.payset.CMD_PAYMSETENTRY},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()},checkInput:function(c){var b=this;var e=null;var d={};c.find(".jpay-validation-amount").each(function(){var g=a(this);var f=g.val();d.msg=desknets.pay.checkInputAmount(f);if(d.msg){d.fieldid=g.attr("name");d.fieldname=b._getErrorPlace(d.fieldid);e=desknets.getErrConvMsg(d);return false}});return e},_getDelPrm:function(){var c={};var b=desknets.paramanalyzer.getHashParams();c.id=b.id+"_"+b.userid;return c},_getIDName:function(){return"pay"}});desknets.page(desknets.payset,"paymsetdisp",desknets.PageDispBase,{_getRestModule:function(){return desknets.payset.MODULE_API_PAY},_getDispExecCmd:function(){return desknets.payset.CMD_PAYMSETDISP},_getDispModCmd:function(){return desknets.payset.PAGE_PAYMSETENTRY},_getDelExecCmd:function(){return desknets.payset.CMD_PAYMSETDEL},_getDelPrm:function(){var c={};var b=desknets.paramanalyzer.getHashParams();c.id=b.id+"_"+b.userid;return c},_getIDName:function(){return"pay"}});desknets.page(desknets.payset,"paymsetrepentry",desknets.PageSet,{init:function(){var b=this;b._initUserSelectDialog();b.callBase("init")},_initUserSelectDialog:function(){var b=this;var e=a("#jpay-sel-items-area");var d=e.find("table").find("thead").remove().html();var f={chooseTarget:["user"],allGroup:"choosable",unassignGroup:"choosable",cmdusers:desknets.CMD_CHOOSERMSETUSERSEL};var c=desknets.chooser.getItemsFromElement(e,{itemFilter:function(i,g){var h=g.closest("tr").find(".jpay-rep-grp").html();cGroupTitle=desknets.stripTags(g.closest("tr").find(".jpay-rep-grp").html());cGroupTitle=desknets.escapeValue(cGroupTitle);i.summary=h;i.summaryAsText=cGroupTitle;return i}});desknets.chooser.setUpEntry(e,c,{dialogID:"jpay-user-sel",initCreate:true,template:d,dialogOptions:f,extraVars:{user:{keyName:"id"}}})},_getSelectedItems:function(){var b=this;var d=[];var c="";a(".jco-sel-items").children().each(function(){var e=a(this);c="user";d.push({id:e.find(".jpay-rep-id").val(),type:c,name:e.find(".jpay-rep-name").text(),description:e.find(".jpay-rep-grp").html()})});return d},_getNextCmd:function(){return desknets.payset.PAGE_PAYLIST}});desknets.page(desknets.payset,"paymsetrepsel",desknets.PageListBase,{_initListStart:function(){var b=this;b.callBase("_initListStart");desknets.page.groupSelect.init({},{allGroup:"choosable",unassignGroup:"choosable"})},_initListStartChk:function(){},_getListAjaxSuccess:function(c){var b=this;b.callBase("_getListAjaxSuccess",c);desknets.page.groupSelect.editSelectedGroup(a(".jco-sel-items"),c)},_listLine:function(d,e){var c=this;var b="";if(typeof e=="object"){d=c._replaceListLine(d,"id",e);d=c._replaceListLine(d,"Name",e);d=c._replaceGrpLine(d,"assigngrp",e);d=c._replaceReporterLine(d,"reporter",e)}return d},_replaceGrpLine:function(c,f,e){var d={};var b="";if(typeof e[f]=="object"){d=desknets.user.getListAssignGroups(e[f].Name);if(d.assigntitle!==""){b='<span title="'+d.assigntitle+'">'+d.assign+"</span>"}}c=desknets.tmpl.replaceWordHtml(c,f,b);return c},_replaceReporterLine:function(b,d,c){sSetRep="";if(typeof c[d]=="object"){sSetRep=c[d].join(",\n")}else{if(typeof c[d]=="string"){sSetRep=c[d]}}b=desknets.tmpl.replaceWord(b,d,sSetRep);return b},_getRestModule:function(){return desknets.payset.MODULE_API_PAY},_getListCmd:function(){return desknets.payset.PAGE_PAYMSETREPSEL},_getListExecCmd:function(){return desknets.payset.CMD_PAYMSETREPSEL},_getListDispCmd:function(){return desknets.payset.PAGE_PAYMSETREPSELENTRY},_getListAddCmd:function(){return desknets.pay.PAGE_PAYENTRY},_getListModCmd:function(){return desknets.payset.PAGE_PAYMSETREPSELENTRY},_getListModClass:function(){return desknets.payset.paymsetrepselentry}});desknets.page(desknets.payset,"paymsetrepselentry",desknets.PageInputBase,{initPage:function(e,d){var b=this;var c=a("#jpay-report-dialog");if(c.length>0){c.dialog("destroy").remove()}b.callBase("initPage",e,d)},_initSet:function(){var b=this;a(".co-sel-no-items-message.co-nodata").remove();b._initUserSelectDialog();b.callBase("_initSet")},_initUserSelectDialog:function(){var n=this;var j=a("#jpay-sel-items-area");j.on("mouseenter","tr",function(o){var p=a(this);setTimeout(function(){p.addClass("hover")},0)});j.on("mouseleave","tr",function(o){var p=a(this);setTimeout(function(){p.removeClass("hover")},0)});var c=a("#jpay-report-dialog");var m=j.find("table").find("thead").remove().html();var h=c.find(".jco-checkbox-all");var f=c.find(".co-chk-cnt");var e=c.find(".co-chk-cnt-all");var d=desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_listchk_cnt_all_disp,"num",e.text());e.text(d);var i=function(o){if(o===true){f.show();e.show()}else{f.hide();e.hide()}};$item=j.find(".jco-sel-items");var l=j.find(".co-sel-no-items-message");var k=j.find(".co-sel-items-entry");var b=function(){if($item.children().length<=0){l.show();k.hide()}else{l.hide();k.show()}};b();var g=desknets.dialog.getDialogOption();g.width=600;g.autoOpen=false;g.title=desknets.Resource.pay.reportertitle;g.open=function(){c.find('input:checkbox[name="repid"]').attr("checked",false);c.find(".co-tr-selected").removeClass("co-tr-selected");$item.children().each(function(){var o=a(this);c.find('input:checkbox[name="repid"][value="'+o.find(".jpay-rep-id").val()+'"]').attr("checked",true).parent().parent().addClass("co-tr-selected")});h.attr("checked",false);i(false)};g.buttons={};g.buttons[desknets.Resource.OKButtonLabel]=function(){$item.find("tr").remove();c.find('input:checkbox[name="repid"]:checked').each(function(){var q=a(this).closest("tr");var p=m;var r=null;p=desknets.tmpl.replaceWord(p,"id",a(this).val());p=desknets.tmpl.replaceWord(p,"name",q.find(".co-td-dialog-user").text());var o=q.find(".co-busyo");p=desknets.tmpl.replaceWordHtml(p,"summary",o.html());p=desknets.tmpl.replaceWord(p,"summaryAsText",o.html());$item.append(p)});b();a(this).dialog("close")};g.buttons[desknets.Resource.CancelButtonLabel]=function(){a(this).dialog("close")};c=desknets.dialog.setUp(c,g);c.find(".co-table-list-scroll").find("input[type=checkbox]").click(function(o){i(false);h.attr("checked",false);if(a(this).attr("checked")){a(this).closest("tr").addClass("co-tr-selected")}else{a(this).closest("tr").removeClass("co-tr-selected")}});h.click(function(){var o=(a(this).attr("checked"))?true:false;c.find("input[type=checkbox]").attr("checked",o);if(o){i(true);c.find(".co-table-list-scroll").find("tr").addClass("co-tr-selected")}else{i(false);c.find(".co-table-list-scroll").find("tr").removeClass("co-tr-selected")}});j.delegate(".co-btn-close","click",function(o){o.preventDefault();a(this).closest("tr").remove();b()});j.find(".jco-sel-btn").click(function(){c.dialog("open")})},_getIdPageForm:function(){return"frm"},_getRestModule:function(){return desknets.payset.MODULE_API_PAY},_getModExecCmd:function(){return desknets.payset.CMD_PAYMSETREPSELENTRY}});desknets.page(desknets.payset,"paymsetitem",desknets.PageInputList,{_getRestModule:function(){return desknets.payset.MODULE_API_PAY},_getListCmd:function(){return desknets.payset.PAGE_PAYMSETITEM},_getListExecCmd:function(){return desknets.payset.CMD_PAYMSETITEM},_getListAddCmd:function(){return desknets.payset.PAGE_PAYMSETITEMENTRY},_getListModCmd:function(){return desknets.payset.PAGE_PAYMSETITEMENTRY},_getDelExecCmd:function(){return desknets.payset.CMD_PAYMSETDELITEM},_getMoveExecCmd:function(){return desknets.payset.CMD_PAYMSETMVITEM},_getListEntryClass:function(){return desknets.payset.paymsetitementry},_getListModClass:function(){return desknets.payset.paymsetitementry}});desknets.page(desknets.payset,"paymsetitementry",desknets.PageInputBase,{_getRestModule:function(){return desknets.payset.MODULE_API_PAY},_getDelExecCmd:function(){return desknets.payset.CMD_PAYMSETDELITEM},_getAddExecCmd:function(){return desknets.payset.CMD_PAYMSETITEMENTRY},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()}});desknets.page(desknets.payset,"paysetgen",desknets.PageSet,{_getNextCmd:function(){return desknets.payset.PAGE_PAYSETADMIN}});desknets.page(desknets.payset,"paysetmanager",desknets.PageAdmin,{_getSetCondition:function(){return false},_getNextCmd:function(){return desknets.payset.PAGE_PAYSETADMIN}});app.addInitialAction(function(){desknets.payset.init()})})(jQuery);