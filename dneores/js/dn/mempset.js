/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.mempset={CMD_MEMPPSETLABEL:"memppsetcmdlabel",};a.extend(desknets.mempset,{MODULE_MEMP:"zmemp",MODULE_API_MEMP:"zrmemp",PAGE_MEMPLIST:"mempindex",PAGE_MEMPSEARCH:"mempsearch",PAGE_MEMPPSETGEN:"memppsetgen",CMD_MEMPPSETGEN:"memppsetcmdgen",PAGE_MEMPPSETLABEL:"memppsetlabel",PAGE_MEMPPSETLABELENTRY:"memppsetlabelentry",CMD_MEMPPSETLABELENTRY:"memppsetcmdlabelentry",CMD_MEMPPSETDELLABEL:"memppsetdellabel",CMD_MEMPPSETMVLABEL:"memppsetmvlabel",PAGE_MEMPMSETINDEX:"mempmsetindex",CMD_MEMPMSETINDEX:"mempmsetcmdindex",PAGE_MEMPMSETLIST:"mempmsetlist",CMD_MEMPMSETLIST:"mempmsetcmdlist",PAGE_MEMPMSETENTRY:"mempmsetentry",PAGE_MEMPMSETDISP:"mempmsetdisp",CMD_MEMPMSETDISP:"mempmsetcmddisp",CMD_MEMPMSETENTRY:"mempmsetcmdentry",CMD_MEMPMSETDEL:"mempmsetdel",CMD_MEMPMSETREFATTACH:"mempmsetdispattach",CMD_MEMPMSETADDATTACH:"mempmsetcmdaddattach",CMD_MEMPMSETDELATTACH:"mempmsetcmddelattach",PAGE_MEMPSETADMIN:"mempsetadmin",PAGE_MEMPSETGEN:"mempsetgen",CMD_MEMPSETGEN:"mempsetcmdgen",PAGE_MEMPSETMANAGER:"mempsetmanager",PAGE_MEMPSETCAPACITY:"mempsetcapacity",CMD_MEMPSETCAPACITY:"mempsetcmdcapacity",PAGE_MEMPSETCAPACITYENTRY:"mempsetcapacityentry",CMD_MEMPSETCAPACITYENTRY:"mempsetcmdcapacityentry",CMD_MEMPSETCAPACITYENTRYS:"mempsetcmdcapacityentrys",init:function(){var c=this;var b=a("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(b);if(b==desknets.mempset.PAGE_MEMPPSETGEN){desknets.mempset.memppsetgen.init()}else{if(b==desknets.mempset.PAGE_MEMPPSETLABEL){desknets.hashobserver.init(desknets.mempset);desknets.mempset.memppsetlabel.init()}else{if(b==desknets.mempset.PAGE_MEMPMSETINDEX){desknets.hashobserver.init(desknets.mempset);desknets.mempset.mempmsetindex.init();desknets.tags.memopad.setUpFuncAfterAjax(c.changeMainContentMset)}else{if(b==desknets.mempset.PAGE_MEMPSETGEN){desknets.mempset.mempsetgen.init()}else{if(b==desknets.mempset.PAGE_MEMPSETMANAGER){desknets.mempset.mempsetmanager.init()}else{if(b==desknets.mempset.PAGE_MEMPSETCAPACITY){desknets.hashobserver.init(desknets.mempset);desknets.mempset.mempsetcapacity.init()}}}}}}desknets.mempset.subwin.init()},defListPrm:function(){var b={};b.fldsort="memo";b.order="1";b.row="0";b.labelid="";return b},changeMainContentMset:function(c,d){if(c.data("module")!="memp"){return true}var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(b.cmd)){b.cmd=""}if(!neo.isSet(b.userid)){b.userid=""}if(b.userid==desknets.pageframe.getLoginUid()){if(b.cmd==desknets.mempset.PAGE_MEMPMSETLIST){a("#jco-m-memo-container").find(".co-btn-update").click()}else{if(b.cmd==desknets.mempset.PAGE_MEMPMSETDISP||b.cmd==desknets.mempset.PAGE_MEMPMSETENTRY){if(!!c.data("id")){if(d!==null){if(b.id==a.trim(c.data("did"))){location.reload()}}}}}}return true}});desknets.page(desknets.mempset,"subwin",desknets.PageSubwinSearch,{init:function(){var c=this;var b=desknets.paramanalyzer.getHashParams();c.callBase("init");c.$_inputArea.find('input[name="srch_key"]').val(b.srch_key);c.$_inputArea.find('input[name="sdate"]').val(b.sdate);c.$_inputArea.find('input[name="edate"]').val(b.edate);c.$_inputArea.find('input[name="updsdate"]').val(b.updsdate);c.$_inputArea.find('input[name="updedate"]').val(b.updedate);desknets.htmlparts.setUpForm(c.$_inputArea)},_getSearchPrm:function(d){var b=this;var c=b.$_inputArea;d=desknets.mempset.defListPrm();d.srch_key=c.find('input[name="srch_key"]').val();d.sdate=c.find('input[name="sdate"]').val();d.edate=c.find('input[name="edate"]').val();d.updsdate=c.find('input[name="updsdate"]').val();d.updedate=c.find('input[name="updedate"]').val();return d},_chkInputSearchRequired:function(){var b=this;if(b.$_inputArea.find('input[name="srch_key"]').val()==""&&b.$_inputArea.find('input[name="sdate"]').val()==""&&b.$_inputArea.find('input[name="edate"]').val()==""){desknets.dialog.alert(desknets.tmpl.replaceWordHtml(desknets.Resource.Message.com_search_required,"item",desknets.Resource.com_srch_noset),{type:"warn"});return false}return b.callBase("_chkInputSearchRequired")},_getMainCmd:function(){return desknets.mempset.PAGE_MEMPLIST},_getSearchCmd:function(){return desknets.mempset.PAGE_MEMPSEARCH}});desknets.page(desknets.mempset,"attach",desknets.attachSetUp,{_initSetDefPrm:function(){var c=this;this._objDefPrm={};var b=desknets.paramanalyzer.getHashParams();$id=this._$pageEntry.find('input[name="'+this._sDefIdName+'"]');if($id.length>0&&$id.val()!==""){this._objDefPrm[this._sDefIdName]=$id.val()}this._objDefPrm.userid=b.userid},_getDownLoadURL:function(){return desknets.mempset.MODULE_MEMP},_getUploadURL:function(){return desknets.mempset.MODULE_API_MEMP},_getUploadCmd:function(){return desknets.mempset.CMD_MEMPMSETADDATTACH},_getDelCmd:function(){return desknets.mempset.CMD_MEMPMSETDELATTACH},_getDownLoadCmd:function(){return desknets.mempset.CMD_MEMPMSETREFATTACH}});desknets.page(desknets.mempset,"memppsetgen",desknets.PageSet,{_getNextCmd:function(){return desknets.mempset.PAGE_MEMPLIST}});desknets.page(desknets.mempset,"memppsetlabel",desknets.PageInputList,{_replaceListLine:function(c,e,d){var b=this;if(e=="labelassigncnt"){c=b._replaceLabelAssignCntLine(c,e,d)}else{c=b.callBase("_replaceListLine",c,e,d)}return c},_replaceLabelAssignCntLine:function(c,e,d){var b="";if(d[e]!==""){b=desknets.numberFormat(parseInt(d[e],10))}c=desknets.tmpl.replaceWord(c,e,b);return c},_getRestModule:function(){return desknets.mempset.MODULE_API_MEMP},_getListCmd:function(){return desknets.mempset.PAGE_MEMPPSETLABEL},_getListExecCmd:function(){return desknets.mempset.CMD_MEMPPSETLABEL},_getListAddCmd:function(){return desknets.mempset.PAGE_MEMPPSETLABELENTRY},_getListModCmd:function(){return desknets.mempset.PAGE_MEMPPSETLABELENTRY},_getDelExecCmd:function(){return desknets.mempset.CMD_MEMPPSETDELLABEL},_getMoveExecCmd:function(){return desknets.mempset.CMD_MEMPPSETMVLABEL},_getListEntryClass:function(){return desknets.mempset.memppsetlabelentry},_getListModClass:function(){return desknets.mempset.memppsetlabelentry}});desknets.page(desknets.mempset,"memppsetlabelentry",desknets.PageInputBase,{_getRestModule:function(){return desknets.mempset.MODULE_API_MEMP},_getDelExecCmd:function(){return desknets.mempset.CMD_MEMPPSETDELLABEL},_getAddExecCmd:function(){return desknets.mempset.CMD_MEMPPSETLABELENTRY},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()}});desknets.page(desknets.mempset,"mempmsetindex",desknets.PageListBase,{_hashUpdatePageView:function(c){var b=this;var e=desknets.paramanalyzer.getHashParams();if(c==desknets.mempset.PAGE_MEMPMSETLIST){var d=a("#jco-m-memo-container").find(".jco-back-page-data");if(d.length>0&&!neo.isSet(e.init)){desknets.mempset.mempmsetlist._getListAjax(e.row)}else{desknets.mempset.mempmsetlist.initPage(desknets.mempset.PAGE_MEMPMSETINDEX,"jco-m-list-container")}}else{if(c==desknets.mempset.PAGE_MEMPMSETDISP){desknets.mempset.mempmsetdisp.initPage(desknets.mempset.PAGE_MEMPMSETLIST,"jco-m-memo-container")}else{if(c==desknets.mempset.PAGE_MEMPMSETENTRY){desknets.mempset.mempmsetentry.initPage(desknets.mempset.PAGE_MEMPMSETLIST,"jco-m-memo-container")}}}},_initListStart:function(){var b=this;b.callBase("_initListStart");var c={allGroup:"choosable",unassignGroup:"choosable"};desknets.page.groupSelect.init({},c)},_initListStartChk:function(){},_initListStartModLink:function(){},_getListAjaxSuccess:function(c){var b=this;b.callBase("_getListAjaxSuccess",c);desknets.page.groupSelect.editSelectedGroup(b.$mjListPage.find(".jco-sel-items"),c)},_listLine:function(c,d){var b=this;c=b.callBase("_listLine",c,d);if(!neo.isSet(d[desknets.user.KEY_ASSIGNGROUP])){c=desknets.tmpl.replaceWordHtml(c,desknets.user.KEY_ASSIGNGROUP,"&nbsp;");c=desknets.tmpl.replaceWordHtml(c,"assigntitle","&nbsp;")}return c},_replaceListLine:function(c,e,d){var b=this;if(e=="assigngrp"){c=b._replaceGrpLine(c,e,d)}else{if(e=="size"){c=b._replaceSizeLine(c,e,d)}else{if(e=="capa"){c=b._replaceCapaLine(c,e,d)}else{c=b.callBase("_replaceListLine",c,e,d)}}}return c},_replaceGrpLine:function(c,f,e){var d=[];d=desknets.user.getListAssignGroups(e[f].Name);var b="";if(d.assigntitle!==""){b='<span title="'+d.assigntitle+'">'+d.assign+"</span>"}c=desknets.tmpl.replaceWordHtml(c,f,b);return c},_replaceSizeLine:function(c,e,d){var b="";if(d[e]===""){b=desknets.Resource.setnot}else{b=desknets.numberFormatByte(parseInt(d[e],10),0,2,2)}c=desknets.tmpl.replaceWordHtml(c,e,b);return c},_replaceCapaLine:function(c,h,f){var b=parseInt(f[h]||"0",10);var e=desknets.numberFormatByte(b,0,0,2);var d="";if(f.size!==""){var g=parseInt(f.size,10)*1024*1024;d=" ("+desknets.capacity.formatPercentage(b,g)+")"}c=desknets.tmpl.replaceWordHtml(c,h,e);c=desknets.tmpl.replaceWordHtml(c,"rate",d);return c},_getIdListPageForm:function(){return"topfrm"},_getRestModule:function(){return desknets.mempset.MODULE_API_MEMP},_getListCmd:function(){return desknets.mempset.PAGE_MEMPMSETINDEX},_getListExecCmd:function(){return desknets.mempset.CMD_MEMPMSETINDEX}});desknets.page(desknets.mempset,"mempmsetlist",desknets.PageListBase,{_getFieldsCheckScroll:function(){return["userid"]},_listMoveScroll:function(){this._setClearScrollPosition();this.callBase("_listMoveScroll")},_setTitle:function(d){var c=this;var b={};b.username=c.$mjListPage.find(".jmemp-title-username").val();c.callBase("_setTitle",d,b)},initGetPageId:function(){var b=this;b.boGetHtmlSingle=false;b.callBase("initGetPageId")},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()});a("#co-capacity").click(function(c){})},_getListAjaxSuccess:function(d){var b=this;var e=0;var c=0;b.callBase("_getListAjaxSuccess",d);e=d.capalimit;c=d.totaluse;e=Number(e);if(isNaN(e)){e=0}c=Number(c);if(isNaN(c)){c=0}desknets.capacity.makeHtml(a("#co-capacity"),e,c)},_listLine:function(e,f){var d=this;var c=false;var g="";var b=desknets.paramanalyzer.getHashParams();e=d._listLineCmd(e);e=desknets.tmpl.replaceWord(e,"userid",b.userid);if(typeof f=="object"){e=desknets.tmpl.replaceWord(e,"id",f.id);g=desknets.escapeSpace(desknets.escapeValue(desknets.escape(f.attachcnt)));if(g!==""&&parseInt(g,10)>0){c=true}else{c=false}if(c){e=desknets.tmpl.replaceWord(e,"attachcnt","on");e=desknets.tmpl.replaceWord(e,"attachcnton",desknets.Resource.attachLabel)}else{e=desknets.tmpl.replaceWord(e,"attachcnt"," ");e=desknets.tmpl.replaceWord(e,"attachcnton"," ")}e=desknets.tmpl.replaceWord(e,"Name",f.Name);e=desknets.tmpl.replaceWord(e,"updtime",desknets.dateTime.dispDateTime(f.updtime,{type:"list"}));e=desknets.tmpl.replaceWord(e,"size",desknets.numberFormatByte(parseInt(f.size,10),0,0,2))}return e},_getModPageParam:function(){var c={};var b=desknets.paramanalyzer.getHashParams();c.userid=b.userid;return c},_getDispPageParam:function(){var c={};var b=desknets.paramanalyzer.getHashParams();c.userid=b.userid;return c},_getDelAddPrm:function(){var c={};var b=desknets.paramanalyzer.getHashParams();c.userid=b.userid;return c},_listPageLinkOption:function(){var c=this;var b={};var d=a("#jco-m-list-container").find('input[name="mempnum"]').val();b=c.callBase("_listPageLinkOption");b.pageMaxView=d;return b},_getSearchExecParam:function(){var b=this;var d=desknets.paramanalyzer.getHashParams();var c=b.callBase("_getSearchExecParam");if(!neo.isSet(d.num,{blank:false})){c.num=a("#jco-m-list-container").find('input[name="mempnum"]').val()}return c},_getIdListPage:function(){return"jco-m-memo-container"},_getRestModule:function(){return desknets.mempset.MODULE_API_MEMP},_getListCmd:function(){return desknets.mempset.PAGE_MEMPMSETLIST},_getListExecCmd:function(){return desknets.mempset.CMD_MEMPMSETLIST},_getListDispCmd:function(){return desknets.mempset.PAGE_MEMPMSETDISP},_getListModCmd:function(){return desknets.mempset.PAGE_MEMPMSETENTRY},_getDelExecCmd:function(){return desknets.mempset.CMD_MEMPMSETDEL}});desknets.page(desknets.mempset,"mempmsetentry",desknets.memp.mempentry,{_setTitle:function(d){var c=this;var b={};b.username=c.$mjPage.find(".jmemp-title-username").val();c.callBase("_setTitle",d,b)},_initSetLabel:function(){},_initSetTag:function(){},_setUpAttach:function(){var b=this;desknets.mempset.attach.init(b.$mjPage,true);b.$mjPage.find(".jmemp-attach-button").click(function(c){c.preventDefault();desknets.mempset.attach.open()})},getLocationFormParam:function(){var c=this;var d={};var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(c.mBackCmd)||!neo.isSet(c.mIdBack)){return null}var e=a("#"+c.mIdBack).find(".jco-back-page-data");if(e.length>0){d=desknets.getInputDataToObj(e);d.cmd=c.mBackCmd}else{d.userid=b.userid;d.cmd=c.mBackCmd}return d},_getDelPrm:function(){var c={};var b=desknets.paramanalyzer.getHashParams();c.userid=b.userid;return c},_getDelExecCmd:function(){return desknets.mempset.CMD_MEMPMSETDEL},_getModExecCmd:function(){return desknets.mempset.CMD_MEMPMSETENTRY}});desknets.page(desknets.mempset,"mempmsetdisp",desknets.PageDispBase,{_setTitle:function(d){var c=this;var b={};b.username=c.$mjPage.find(".jmemp-title-username").val();c.callBase("_setTitle",d,b)},getAttachDownloadParams:function(){var c=this;var d={};var b=desknets.paramanalyzer.getHashParams();d={cmd:desknets.mempset.CMD_MEMPMSETREFATTACH,id:b.id,userid:b.userid};return d},getLocationFormParam:function(){var c=this;var d={};var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(c.mBackCmd)||!neo.isSet(c.mIdBack)){return null}var e=a("#"+c.mIdBack).find(".jco-back-page-data");if(e.length>0){d=desknets.getInputDataToObj(e);d.cmd=c.mBackCmd}else{d.userid=b.userid;d.cmd=c.mBackCmd}return d},_getDelPrm:function(){var c={};var b=desknets.paramanalyzer.getHashParams();c.userid=b.userid;return c},_getRestModule:function(){return desknets.mempset.MODULE_API_MEMP},_getDispExecCmd:function(){return desknets.mempset.CMD_MEMPMSETDISP},_getDispModCmd:function(){return desknets.mempset.PAGE_MEMPMSETENTRY},_getDelExecCmd:function(){return desknets.mempset.CMD_MEMPMSETDEL}});desknets.page(desknets.mempset,"mempsetgen",desknets.PageSet,{_getNextCmd:function(){return desknets.mempset.PAGE_MEMPSETADMIN}});desknets.page(desknets.mempset,"mempsetmanager",desknets.PageAdmin,{_getSetCondition:function(){return false},_getNextCmd:function(){return desknets.mempset.PAGE_MEMPSETADMIN}});desknets.page(desknets.mempset,"mempsetcapacity",desknets.PageCapacityList,{_getRestModule:function(){return desknets.mempset.MODULE_API_MEMP},_getListCmd:function(){return desknets.mempset.PAGE_MEMPSETCAPACITY},_getListExecCmd:function(){return desknets.mempset.CMD_MEMPSETCAPACITY},_getListAddCmd:function(){return desknets.mempset.PAGE_MEMPSETCAPACITYENTRY},_getListModCmd:function(){return desknets.mempset.PAGE_MEMPSETCAPACITYENTRY},_getDelExecCmd:function(){return desknets.mempset.CMD_MEMPSETCAPACITYENTRYS},_getBackCmd:function(){return desknets.mempset.PAGE_MEMPSETADMIN},_getListEntryClass:function(){return desknets.mempset.mempsetcapacityentry},_getListModClass:function(){return desknets.mempset.mempsetcapacityentry}});desknets.page(desknets.mempset,"mempsetcapacityentry",desknets.PageCapacityInput,{_getRestModule:function(){return desknets.mempset.MODULE_API_MEMP},_getAddExecCmd:function(){return desknets.mempset.CMD_MEMPSETCAPACITYENTRYS},_getModExecCmd:function(){return desknets.mempset.CMD_MEMPSETCAPACITYENTRY}});app.addInitialAction(function(){desknets.mempset.init()})})(jQuery);