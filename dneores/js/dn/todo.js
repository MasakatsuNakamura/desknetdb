/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.todoutil={SetDispDateTimeToDoTop:function(b){b.find(".jtodo-limdate").each(function(){var d;if(a(this).text().length==0){return true}if(a(this).hasClass("today")||a(this).hasClass("tmrw")){d="shortTimeFormat"}else{d={type:"list"}}var c=desknets.dateTime.dispDateTime(a(this).text(),d);a(this).text(c);a(this).attr("title",c)})}};desknets.todo={CMD_TODOLIST:"todocmdlist",CMD_TODOTASKREF:"todocmdtaskref",CMD_TODOTASKENTRY:"todocmdtaskentry",CMD_TODOTASKDEL:"todocmdtaskdelete",CMD_TODOTASKCOMPLETE:"todocmdtaskcomplete",CMD_TODODISPATTACH:"tododispattach",CMD_TODOTAGENTRY:"todocmdtagentry",CMD_TODOLISTSEARCH:"todocmdlistsearch",CMD_TODOLISTLIMIT:"todocmdlistlimit",CMD_TODOLABELLIST:"todocmdlabellist",CMD_TODOFILTARGET:"todocmdfiltarget",VALUE_TODOALARMEVERY:1,VALUE_TODOALARMONCE:2,form_sts:"{{sts}}",TaskRefSetAlarmInfo:function(f,i,k){var l=this;var j="";var g="";var b="";if(f&&i&&k){var c=parseInt(f);var e=parseInt(i);var m=parseInt(k);var d=c/1440;if((d>=1&&d<=7)&&(m===desknets.todo.VALUE_TODOALARMEVERY||m===desknets.todo.VALUE_TODOALARMONCE)){var h=desknets.Resource.todo.alarmform;b=desknets.tmpl.replaceWordHtml(h,"alarmtime",d)}}return b},dispItems:function(j,p,e,f){var h="";var k=[];var i=[];if(!j||!j.item){return"&nbsp;"}k=desknets.ajax.getItems(j.item);var d=k.length;if(d==0){return"&nbsp;"}if(p!=undefined){if(!(!p||!p.item)){i=desknets.ajax.getItems(p.item)}}var m=i.length;for(var o=0;o<d;o++){var q="";var n="";var c=k[o];if(o!=0){q=",&#x0A;"}if(c.val!=undefined){n=desknets.tmpl.escapeWord(c.val)}q=q+n;if(m>o&&(c.user_state!=1&&c.user_state!=2)){var g="";var b=i[o];if(b.val){g=desknets.tmpl.escapeWord(b.val)}if(g.length>0){if(e){var l=desknets.tmpl.replaceWordChkHtml(e,f,g);q=q+l}else{q=q+"("+g+")"}}}h=h+q}return h},};a.extend(desknets.todo,{PAGE_TODOLIST:"todolist",PAGE_TODOLISTOTHER:"todolistother",PAGE_TODOLISTLIMIT:"todolistlimit",PAGE_TODOLISTLIMOTHER:"todolistlimother",PAGE_TODOLISTSEARCH:"todolistsearch",PAGE_TODOTASKREF:"todotaskref",PAGE_TODOTASKENTRY:"todotaskentry",CMD_TODOLISTOTHER:"todocmdlistother",CMD_TODOLISTLIMOTHER:"todocmdlistlimother",CMD_TODOLABELLIST:"todocmdlabellist",CMD_TODOPSETLABELENTRY:"todopsetcmdlabelentry",CMD_TODOPSETLABELDEL:"todopsetcmdlabeldelete",CMD_TODOLABELASSIGNENTRY:"todocmdlabelassignentry",CMD_TODOLABELASSIGNDEL:"todocmdlabelassigndelete",CMD_TODOATTACH:"todoattach",CMD_TODOATTACHDEL:"todoattachdel",CMD_TODOATTACHCOPY:"todocmdattachcopy",VALUESTR_TODOMYTASK:"0",VALUESTR_TODOREQTASK:"1",VALUESTR_TODOALLTASK:"2",VALUESTR_TODOLABELADDALL:"0",VALUESTR_TODOLABELADDOWN:"-2",VALUESTR_TODOLABELADDOTHER:"-3",VALUESTR_TODOLIM:"1",VALUESTR_TODOTODAY:"2",VALUESTR_TODOTMRW:"3",VALUESTR_TODOTMRWLAT:"4",VALUESTR_TODOEND:"5",VALUESTR_TODOSRCHCOMP_ALL:"2",VALUESTR_TODOPARENT:"1",VALUESTR_TODOLIMITDATEON:"-1",VALUESTR_TODOLIMITNONE:"-2",VALUESTR_TODOALARMON:"1",VALUESTR_TODOALARMOFF:"0",VALUEACC_TODOADD:2,VALUESTR_TODOTASKCOMPLETE:"1",VALUESTR_TODOFLGON:"1",VALUE_TODOIMPLEVL_URGENT:"1",VALUE_TODOIMPLEVL_HIGH:"2",VALUE_TODOIMPLEVL_LOW:"4",VAL_CLASS_TODOIMP_URGENT:"haste",VAL_CLASS_TODOIMP_HIGH:"high",VAL_CLASS_TODOIMP_LOW:"low",FIELD_TODOSORTNAME:"Name",FIELD_TODOTASKSTS:"sts",mFormTitle:' > <span class="overflow-auto co-title-size">{{uname}}</span>',init:function(){var b=this;var d=a("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(d);var c=this.PAGE_TODOLIST;if(d.substr(0,c.length)==c){desknets.hashobserver.init(desknets.todo);if(d==this.PAGE_TODOLIST){desknets.todo.todolist.init()}if(d==this.PAGE_TODOLISTOTHER){desknets.todo.todolistother.init()}desknets.todo.subwin.init();desknets.todo.subwinuser.init();desknets.tags.item.setUpFuncAfterAjax(b.changeMainContent)}},_getIdToDoTopPage:function(){return"jco-m-todotop-container"},_getUserIdSetId:function(d){var c=this;var b="";if(d==null){return""}var b=a("#"+d).find(".jtodo-userid").val();if(b==undefined){b=""}return b},_deleteParamTopPageToDo:function(c){if(!neo.isSet(c)){return}for(var b in c){if(c[b]){if(b=="num"){delete c[b]}}}},_switchDisableItemToDo:function(d,c){if(!neo.isSet(d)||!neo.isSet(c)){return}var b=d.find("."+c);if(!neo.isSet(b)){return}b.attr("disabled",true)},_setToDoCountItemAssignLabelDefault:function(b,e){var d=b.$mjListPage.find(".co-listview-left").find(".count.jtodo-label-cntitem-fromown");var c=b.$mjListPage.find(".co-listview-left").find(".count.jtodo-label-cntitem-fromother");d.text(e.lblassigncntfromown);c.text(e.lblassigncntfromother)},CheckHashMyTask:function(){var b=desknets.todo.VALUESTR_TODOMYTASK;var c=desknets.todo.VALUESTR_TODOREQTASK;var d=desknets.paramanalyzer.getHashParams();if(d.mytask==c){b=c}return b},CheckParamSetHash:function(c){var b="";if(c==undefined){return}var d=desknets.paramanalyzer.getHashParams();for(b in d){if(b=="cmd"||b=="id"){continue}if((c[b]==undefined||c[b].length==0)&&d[b]){c[b]=d[b]}}},CheckParamSetCmd:function(c){if(c==undefined){return}var b=c.cmd;if(c.limit&&(c.cmd==desknets.todo.todolist._getListCmd()||c.cmd==desknets.todo.todolistother._getListCmd())){if(b==desknets.todo.todolistother._getListCmd()){c.cmd=desknets.todo.todolistlimother._getListCmd()}else{c.cmd=desknets.todo.todolistlimit._getListCmd()}}},ListLimComCreateNameList:function(h){var b=this;var i=[];var c=[];var f=0;var e="";if(!neo.isSet(h)){return"&nbsp;"}if(a.isArray(h)){i=h}else{i[0]=h}for(var d=0;d<i.length;d++){c=i[d];if(typeof c!="object"){continue}e=desknets.tmpl.dispItems(c.name,c.defgroup,"[{{name}}]","name")}if(c.othertoallcnt){f=c.othertoallcnt}var g=desknets.ajax.getItems(c.name.item);if(f>g.length){e=e+desknets.Resource.com_overitemcnt}return e},ListLimComCreateStringTitle:function(f){var b="";if(f!==desknets.todo.VALUESTR_TODOLIM&&f!==desknets.todo.VALUESTR_TODOTODAY&&f!==desknets.todo.VALUESTR_TODOTMRW&&f!==desknets.todo.VALUESTR_TODOTMRWLAT&&f!==desknets.todo.VALUESTR_TODOEND){return"&nbsp;"}if(f===desknets.todo.VALUESTR_TODOLIM){b=b+desknets.Resource.todo.title_listlim}else{if(f===desknets.todo.VALUESTR_TODOTMRWLAT){b=b+desknets.Resource.todo.title_listtmrwlat}else{if(f===desknets.todo.VALUESTR_TODOEND){b=b+desknets.Resource.todo.title_listend}else{var e="";var d="";var c=desknets.pageframe.getServerDate();if(f===desknets.todo.VALUESTR_TODOTODAY){e=desknets.Resource.todo.title_listtoday}else{c=neo.dateTime.moveDate(c,1);e=desknets.Resource.todo.title_listtmrw}d=desknets.dateTime.dispDateTime(neo.dateTime.format("yyyyMMdd",c),"longMDFormat");b=b+desknets.tmpl.replaceWordChk(e,"dateform",d)}}}return b},ListComChangeClassName:function(b){var d=this;var c;var f;c="";f="";var h=desknets.paramanalyzer.getHashParams();var e=b.find(".co-table-list.co-nozebra");var g=b.find(".jtodo-add-class-task");e.removeClass("todo-table-list todo-table-list-over todo-table-list-end");g.removeClass("jtodo-add-class-task");if(h.limit===desknets.todo.VALUESTR_TODOLIM){c="todo-table-list-over"}else{if(h.limit===desknets.todo.VALUESTR_TODOEND){c="todo-table-list-end";f="todo-tr-end"}else{c="todo-table-list"}}e.addClass(c);g.addClass(f)},MyTaskComLocationAddParam:function(c){var b=this;if(c.labelid==desknets.todo.VALUESTR_TODOLABELADDOWN||c.labelid==desknets.todo.VALUESTR_TODOLABELADDOTHER){c.labelid=desknets.todo.VALUESTR_TODOLABELADDALL}if(c.fldsort==desknets.todo.FIELD_TODOSORTNAME){c.fldsort="limdate";c.order="1"}},ListComTaskEnd:function(g,e){var d=this;var b={};var f=0;var c=[];var h;var i="";g.preventDefault();e.$mjTableList.find("input[type=checkbox]").each(function(){if(a(this).attr("checked")){f++;return false}});if(f<1){i=d._endTaskNoChkMessage();desknets.dialog.alert(i,{type:"warn"});return}i=d._endTaskConfMessage(e);d._setEndTaskConfirm(i,e);return},_setEndTaskConfirm:function(e,c){var b=this;var d;d=desknets.dialog.confirm(e,function(){b._listEndTask(true,d,c);return false})},_listEndTask:function(g,f,e){var d=this;var c=[];var b;if(f!=null){desknets.submitform.setDialogDisabled(f)}if(e.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){c=desknets.PRM_VAL_ALLDEL}else{e.$mjListPage.find('input[name="id"]:checked').each(function(){c[c.length]=a(this).val()})}b=e._getEndAddPrm();b.cmd=e._getEndExecCmd();b.id=c;if(e._boDelSingle()){desknets.ajax.rest({url:desknets.getUrl(e._getRestModule()),data:b,success:function(i,h,j){e._getListAjax(e._getListRow())},complete:function(j,h,i){if(f!=null){desknets.submitform.clearDialogDisabled(f);f.dialog("close")}},traditional:true})}else{desknets.todo.ListComTaskEndMulti(b,f,e)}},ListComTaskEndMulti:function(b,i,d){var c=this;var g={};var f={};var e={};var h={};f=d.getListParamToObj();h=d.getAddDataParam();h.cmd=d._getAddDataGetCmd();g["0"]=b;g["1"]=f;g["2"]=h;e=a.extend({},d._getListAjaxOptionsExec(i));d._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,g,e);return},_endTaskConfMessage:function(c){var d=c;var b="";if(d.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){return desknets.Resource.Message.todo_end_allconf}else{if(d.$mjListPage.find(".co-chk-cnt-some").css("display")=="block"){b=desknets.Resource.Message.todo_end_someconf}else{b=desknets.Resource.Message.todo_end_listconf}}return desknets.tmpl.replaceWordHtml(b,"count",d._getListCheckCount())},_endTaskNoChkMessage:function(){return desknets.Resource.Message.todo_end_nochecked},TaskRefGetAttachParams:function(e){var d={};var b="";var f=desknets.paramanalyzer.getHashParams();var c=desknets.ajax.getItems(e.item);if(c[0].id){b=c[0].id}d={id:f.id,uid:b};return d},_replaceListLineToDoComTaskList:function(c,g,h){var k=this;var d="";var i=null;if(g=="name"){d=desknets.todo.ListLimComCreateNameList(h);i=desknets.tmpl.replaceWordHtml(c,g,d)}else{if(g=="defgroup"){i=c}else{if(g=="limdate"){d=h[g];if(d.length==0){return i}var j=h.limtime;if(neo.isSet(j)&&j.length>0){d=d+j}d=desknets.dateTime.dispDateTime(d,{type:"list"});i=desknets.tmpl.replaceWordHtml(c,g,d)}else{if(g=="limtime"){return i}else{if(g=="important"){var b="";var f="";var e={};desknets.todo._getImportantDispLevelToDoCom(h[g],e,false);if(neo.isSet(e)){if(neo.isSet(e.important_level)){f=e.important_level}if(neo.isSet(e.important)){b=e.important}}i=desknets.tmpl.replaceWordHtml(c,"important_level",f);i=desknets.tmpl.replaceWordHtml(i,g,b)}else{i=null}}}}}return i},_getImportantDispLevelToDoCom:function(c,e){var b="";var d="";e.important="";e.important_level="";if(!neo.isSet(c)){return}if(c==desknets.todo.VALUE_TODOIMPLEVL_URGENT){b=desknets.Resource.importance_highest;d=desknets.todo.VAL_CLASS_TODOIMP_URGENT}else{if(c==desknets.todo.VALUE_TODOIMPLEVL_HIGH){b=desknets.Resource.importance_high;d=desknets.todo.VAL_CLASS_TODOIMP_HIGH}else{if(c==desknets.todo.VALUE_TODOIMPLEVL_LOW){b=desknets.Resource.importance_low;d=desknets.todo.VAL_CLASS_TODOIMP_LOW}}}e.important=b;e.important_level=d},changeMainContent:function(c,d){if(c.data("module")!="todo"){return true}var b=desknets.paramanalyzer.getHashParams();if(!neo.isSet(b.cmd)){b.cmd=""}if(b.cmd==desknets.todo.PAGE_TODOTASKREF||b.cmd==desknets.todo.PAGE_TODOTASKENTRY){if(b.id==a.trim(c.data("did"))){a(".co-select-menu-text").html(a(".tag-disp-options:first").find("a:first").html());a('input[name="tagcolor"]').val("0")}}return true}});(function(b){desknets.page(desknets.todo,"listcom",desknets.PageListBase,{initPage:function(e,d){var c=this;c.boGetHtmlSingle=false;c.callBase("initPage",e,d)},_getListAjaxSuccessEnd:function(){var c=this;c.ListDispSwitch();c.ListChangeClassName();c.callBase("_getListAjaxSuccessEnd")},ListDispSwitch:function(){},ListChangeClassName:function(){},_initListEndButton:function(){var c=this;c.$mjListPage.find(".co-btn-update").click(function(d){d.preventDefault();b(this).addClass("on");desknets.scrollManager.clearScrollPosition(c._getListCmd());c._initGetHtml()});c.$mjListPage.find(".jco-input-list-page").click(function(d){d.preventDefault();c.dispBackListPage()});c.$mjListPage.find(".jco-list-add-page").click(function(d){c.inputAddPage(d)})},inputModPage:function(c){this.inputDispPage(c)},_getAddPageParam:function(){var c=desknets.paramanalyzer.getHashParams();return c},_getDispPageParam:function(){var c=this;return this._getAddPageParam()},_replaceListLine:function(d,g,f){var c=this;var e=desknets.todo._replaceListLineToDoComTaskList(d,g,f);if(neo.isSet(e)){return e}return c.callBase("_replaceListLine",d,g,f)},})})(jQuery);desknets.page(desknets.todo,"listcomlabel",desknets.PageLabelList,{init:function(){var b=this;b._mboAddPageLabelId=true;b.callBase("init")},initPage:function(d,c){var b=this;b.boGetHtmlSingle=false;b.callBase("initPage",d,c)},_initGetHtml:function(){var b=this;var d={};var g={};var f={};var c={};if(b._boDelSingle()){b.callBase("_initGetHtml")}else{g=desknets.paramanalyzer.getHashParams();g.cmd=b._getListExecCmd();var h=desknets.paramanalyzer.getHashParams();f=b._getSearchPageParam();f.cmd=h.cmd;c["0"]=g;c["1"]=f;var e={};e=b._getSearchPageParam();b._setParamCondLabelList(e);e.cmd=b._getLabelGetCmd();c["2"]=e;d.success=function(i){if(i[0]["status"]!=desknets.RES_STATUS_SUCCESS){b.onError(i[0]["errorno"],i[0]["errormessage"])}else{if(i[1]["status"]!=desknets.RES_STATUS_SUCCESS){b.onError(i[1]["errorno"],i[1]["errormessage"])}else{if(i[2]["status"]!=desknets.RES_STATUS_SUCCESS){b.onError(i[1]["errorno"],i[2]["errormessage"])}else{b._initMultiHtml(i)}}}};b._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,c,d)}},_initMultiHtml:function(c){var b=this;b.$mjListPage.empty();b.$mjListPage.html(c[1].html);b._initListStart();b._mobjParams=b.getListParamToObj();var d=[];d[0]=c[0];d[1]=c[2];b._getListAjaxSuccess(d);b._initListEnd()},_initHtml:function(d){var b=this;var c=[];if(b._boDelSingle()){b.callBase("_initHtml",d)}else{b.$mjListPage.empty();b.$mjListPage.html(d[1].html);b._initListStart();b._mobjParams=b.getListParamToObj();c[0]=d[0];c[1]=d[2];b._getListAjaxSuccess(c);b._initListEnd()}},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");b.$mjListPage.find(".jco-input-list-page").click(function(c){c.preventDefault();b.dispBackListPage()});b.$mjListPage.find(".jco-list-end-submit").click(function(c){desknets.todo.ListComTaskEnd(c,b)})},getLocationFormParam:function(){var b=this;var c={};var d=desknets.paramanalyzer.getHashParams();c=b.callBase("getLocationFormParam");if(c==null){return null}if(d.labelid){c.labelid=d.labelid}if(d.mytask){c.mytask=d.mytask}c.cmd=b.mBackCmd;return c},_getLabelAjaxSuccess:function(c){var b=this;b.ListChangeClassName();b.callBase("_getLabelAjaxSuccess",c);b.ListDispSwitch()},ListDispSwitch:function(){var b=this;var c;var d=desknets.todo.VALUESTR_TODOMYTASK;var e=desknets.todo.VALUESTR_TODOREQTASK;c=d;var f=desknets.paramanalyzer.getHashParams();if(f.mytask==e){c=e}if(c===e){b.$mjListPage.find(".jtodo-list-mytask").hide();b.$mjListPage.find(".jtodo-list-reqtask").show()}else{b.$mjListPage.find(".jtodo-list-mytask").show();b.$mjListPage.find(".jtodo-list-reqtask").hide()}b._switchDispSortFldName(c===d)},_switchDispSortFldName:function(e){var d=this;var g=d.$mjListPage.find(".jtodo-list-limit-name");if(!neo.isSet(g)||g.length==0){return}var f=g.find(".jtodo-sort-name-mytask");var b=g.find(".jtodo-sort-name-reqtask");g.removeClass("co-th-sort-def-asc");f.hide();b.hide();var c=d.$mjListPage.find("#jco-list-sort-item").find(".jtodo-sort-name-mytask");c.hide();if(e){g.addClass("co-th-sort-def-asc");g.attr("title",f.html());f.show();c.show()}else{g.attr("title",b.html());b.show();c.hide()}},ListChangeClassName:function(){},_getAddPageParam:function(){var d=desknets.paramanalyzer.getHashParams();var b=this;var c=d.bproc;if(neo.isSet(c)&&c!=""){delete d.bproc}return d},_getModPageParam:function(){var b=this;return this._getAddPageParam()},_getDispPageParam:function(){var b=this;return this._getAddPageParam()},_getDelExecCmd:function(){return desknets.todo.CMD_TODOTASKDEL},_getDelAddPrm:function(){var b=this;var c={};var d=desknets.paramanalyzer.getHashParams();c.mytask=d.mytask;c.limit=d.limit;c.labelid=d.labelid;return c},_getEndExecCmd:function(){return desknets.todo.CMD_TODOTASKCOMPLETE},_getEndAddPrm:function(){var b=this;return b._getDelAddPrm()},_replaceListLine:function(c,f,e){var b=this;var d="";var d=desknets.todo._replaceListLineToDoComTaskList(c,f,e);if(neo.isSet(d)){return d}if(f=="labelid"){c=b._CreateLabelHtml(c,e);return c}return b.callBase("_replaceListLine",c,f,e)},_CreateLabelHtml:function(c,e){var f="";var d="";var b=false;f=desknets.escapeSpace(desknets.escapeValue(desknets.escape(e.labelid)));if(f!==""&&parseInt(f,10)>0){b=true}else{f="";b=false}if(b){d=desknets.label.getLabelHtml(e.labelid,e.labelname);c=desknets.tmpl.replaceWordHtml(c,"label",d)}else{c=desknets.tmpl.replaceWordHtml(c,"label","")}return c},_setCountItemAssignLabelDefault:function(c){var b=this;b.callBase("_setCountItemAssignLabelDefault",c);desknets.todo._setToDoCountItemAssignLabelDefault(b,c)},_getListAddCmd:function(){return desknets.todo.PAGE_TODOTASKENTRY},_getListModCmd:function(){var b=this;return b._getListAddCmd()},_getListDispCmd:function(){return desknets.todo.PAGE_TODOTASKREF},_getListEntryClass:function(){return desknets.todo.todotaskentry},_getListModClass:function(){var b=this;return b._getListEntryClass()},_getListDispClass:function(){return desknets.todo.todotaskref},_getLabelGetCmd:function(){return desknets.todo.CMD_TODOLABELLIST},_getLabelEntryCmd:function(){return desknets.todo.CMD_TODOPSETLABELENTRY},_getLabelDelCmd:function(){return desknets.todo.CMD_TODOPSETLABELDEL},_getDataLabelEntryCmd:function(){return desknets.todo.CMD_TODOLABELASSIGNENTRY},_getDataLabelDelCmd:function(){return desknets.todo.CMD_TODOLABELASSIGNDEL}});desknets.todo.input={};desknets.page(desknets.todo.input,"attach",desknets.attachSetUp,{_getUploadURL:function(){return desknets.MODULE_API_MAIN},_getUploadCmd:function(){return desknets.todo.CMD_TODOATTACH},_getDelCmd:function(){return desknets.todo.CMD_TODOATTACHDEL},_getDownLoadURL:function(){return desknets.MODULE_MAIN},_getDownLoadCmd:function(){return desknets.todo.CMD_TODODISPATTACH},_getHideArea:function(){return a(".jtodo-attachs")},_getUploadPrm:function(){var d=this;var e=a.extend({},this._objDefPrm);var c=d._$pageEntry.find("input[name=id]").val();var b=desknets.todo._getUserIdSetId("jtodo-user-entry");e.uid=b;e.id=c;return e},_getDownLoadPrm:function(){var b=this;var c=this._getUploadPrm();return c}});(function(b){desknets.page(desknets.todo,"subwin",desknets.PageSubwinSearch,{init:function(){var c=this;var d=b(".jco-subwindow-search");var e=desknets.paramanalyzer.getHashParams();d.find('input[name="srch_key"]').val(e.srch_key);d.find('input[name="srch_limdate_s"]').val(e.srch_limdate_s);d.find('input[name="srch_limdate_e"]').val(e.srch_limdate_e);d.find('input[name="complete"]').val(e.complete);d.find('input[name="mytask"]').val(e.mytask);c.callBase("_initSearch");desknets.htmlparts.setUpForm(c.$_inputArea)},_getSearchPrm:function(e){var c=this;var f={};var d=c.$_inputArea;f=desknets.paramanalyzer.getHashParams();e.row="0";e.srch_key=d.find('input[name="srch_key"]').val();e.srch_limdate_s=d.find('input[name="srch_limdate_s"]').val();e.srch_limdate_e=d.find('input[name="srch_limdate_e"]').val();e.complete=d.find('select[name="complete"]').val();e.mytask=d.find('select[name="mytask"]').val();e.labelid="";e.fldsort="limdate";e.order="1";return e},_chkInputSearchRequired:function(){var c=this;if(!c._boCheckCondSrchToDo()){var d=c._getMsgNoCondSrchToDo();desknets.dialog.alert(d,{type:"warn"});return false}return c.callBase("_chkInputSearchRequired")},_boCheckCondSrchToDo:function(){var f=this;if(!neo.isSet(f.$_inputArea)){return false}var e=f.$_inputArea.find('input[name="srch_key"]');var h=f.$_inputArea.find('input[name="srch_limdate_s"]');var d=f.$_inputArea.find('input[name="srch_limdate_e"]');var g=f.$_inputArea.find('select[name="complete"]');var c=f.$_inputArea.find('select[name="mytask"]');if(neo.isSet(e)&&e.val().length>0){return true}if(neo.isSet(h)&&h.val().length>0){return true}if(neo.isSet(d)&&d.val().length>0){return true}if(neo.isSet(g)&&g.val()!=desknets.todo.VALUESTR_TODOSRCHCOMP_ALL){return true}if(neo.isSet(c)&&c.val()!=desknets.todo.VALUESTR_TODOALLTASK){return true}return false},_getMsgNoCondSrchToDo:function(){var c=desknets.Resource.com_srch_noset;var d=desknets.Resource.Message.com_search_required;return desknets.tmpl.replaceWordHtml(d,"item",c)},_execClear:function(){var c=this;c.callBase("_execClear");c.$_inputArea.find('select[name="complete"]').val(desknets.todo.VALUESTR_TODOSRCHCOMP_ALL);c.$_inputArea.find('select[name="mytask"]').val(desknets.todo.VALUESTR_TODOMYTASK)},_chkInputSearchDateChk:function(){var e=this;var d=true;var c="";e.$_inputArea.find(".jco-search-date").each(function(){if(!desknets.validation.isInputDateFromTo(b(this),false)){d=false;return false}});return d},_getMainCmd:function(){return desknets.todo.PAGE_TODOLISTSEARCH},_getSearchCmd:function(){return desknets.todo.PAGE_TODOLISTSEARCH}})})(jQuery);desknets.page(desknets.todo,"subwinuser",desknets.PageSubwinUserSel,{});(function(b){desknets.page(desknets.todo,"todolist",desknets.PageLabelList,{_formLinkBtnArea:"#cmd=todolist&mytask={{mytask}}&labelid={{labelid}}",init:function(){var c=this;c._mboAddPageLabelId=true;c.callBase("init")},_initListStart:function(){var c=this;c.$mjTableList=c.$mjListPage.find(".co-listview-scroll");c.callBase("_initListStart")},initParamsFromHash:function(d){var c=this;var e="";var f=desknets.paramanalyzer.getHashParams();e=d.cmd;if(!neo.isSet(e)||e==c._getListCmd()){c._hashUpdateListPage(d)}else{if(e==c._getListAddCmd()){c._hashUpdateAddPage()}else{if(e==c._getListModCmd()){c._hashUpdateModPage()}else{if(e==c._getListDispCmd()){c._hashUpdateDispPage()}else{c._hashUpdateOther(e)}}}}},_getLabelAjaxSuccess:function(d){var c=this;c.MyTaskSetLinkEvent();c.callBase("_getLabelAjaxSuccess",d);c.MyTaskDispSwitch();desknets.todoutil.SetDispDateTimeToDoTop(c.$mjListPage);c._setTitleLabel();if(c.$mjListPage.css("display")!="block"){c.mboLabelScrollChg=true}else{c.mboLabelScrollChg=false}c._getListAjaxSuccessEnd();if(c.mboLabelScrollChg==true){c._updateScrollTopValue()}c.mboLabelScrollChg=false},MyTaskDispSwitch:function(){var c=this;var f="";var g=c.$mjListPage.find(".jtodo-list-mytask");var e=c.$mjListPage.find(".jtodo-list-reqtask");var d=desknets.todo.CheckHashMyTask();if(d==desknets.todo.VALUESTR_TODOMYTASK){g.show();e.hide()}else{g.hide();e.show()}},MyTaskSetLinkEvent:function(){var c=this;var d=desknets.paramanalyzer.getHashParams();if(!neo.isSet(d.cmd)||!neo.isSet(d.labelid)){return}if(d.mytask!=desknets.todo.VALUESTR_TODOREQTASK){c._setLinkHashParamToReqtask(d)}else{c._setLinkHashParamToMytask(d)}},_setLinkHashParamToMytask:function(e){var d=this;var c=d._formLinkBtnArea;c=desknets.tmpl.replaceWordHtml(c,"mytask",desknets.todo.VALUESTR_TODOMYTASK);c=desknets.tmpl.replaceWordHtml(c,"labelid",e.labelid);d.$mjListPage.find(".jtodo-list-reqtask").find(".jtodo-mytasklink").attr("href",c)},_setLinkHashParamToReqtask:function(e){var d=this;desknets.todo.MyTaskComLocationAddParam(e);var c=d._formLinkBtnArea;c=desknets.tmpl.replaceWordHtml(c,"mytask",desknets.todo.VALUESTR_TODOREQTASK);c=desknets.tmpl.replaceWordHtml(c,"labelid",e.labelid);d.$mjListPage.find(".jtodo-list-mytask").find(".jtodo-mytasklink").attr("href",c)},_initListEndButton:function(){var c=this;c.callBase("_initListEndButton");c.$mjListPage.find(".jco-list-end-submit").click(function(d){desknets.todo.ListComTaskEnd(d,c)})},_getModPageParam:function(){var c=this;return this._getAddPageParam()},_getDispPageParam:function(){var c=this;return this._getAddPageParam()},_hashUpdateOther:function(e){var d=this;var f=desknets.paramanalyzer.getHashParams();var c;if(e==d._getListLimitCmd()){c="#"+d._getIdListLimitPage();if(b(c).find(".jco-title").length>0){desknets.todo.todolistlimit._getListAjax(f.row)}else{desknets.todo.todolistlimit.initPage(d._getListCmd(),d._getIdListPage())}d.mhashBackCmd=d._getListLimitCmd();d.mhashIdBack=d._getIdListLimitPage()}else{if(e==d._getListSearchCmd()){c="#"+d._getIdListSearchPage();if(b(c).find(".jco-title").length>0){desknets.todo.todolistsearch._getListAjax(f.row)}else{desknets.todo.todolistsearch.initPage(d._getListCmd(),d._getIdListPage())}d.mhashBackCmd=d._getListSearchCmd();d.mhashIdBack=d._getIdListSearchPage()}}},_getIdListLimitPage:function(){return"jco-m-todolimit-container"},_getListLimitCmd:function(){return desknets.todo.PAGE_TODOLISTLIMIT},_getIdListSearchPage:function(){return desknets.todo.todolistsearch._getIdListPage()},_getListSearchCmd:function(){return desknets.todo.PAGE_TODOLISTSEARCH},_getEndExecCmd:function(){return desknets.todo.CMD_TODOTASKCOMPLETE},_getEndAddPrm:function(){var c=this;var d={};return d},_getToDoTopAjaxSuccess:function(d){var c=this;c.$mjTableList.html(d.html);c._setTitleLabel()},_initListStartSet:function(){},_initListStartTemplate:function(){},_initListEndChk:function(){},_initListSetSort:function(){},_initListMain:function(){var c=this;var d="";c._mobjParams=c.getListParamToObj();d=desknets.paramanalyzer.getLocationHash();if(d!=""){c.funcHashObserver()}else{if((typeof jsonRest)!="undefined"){c._getLabelAjaxSuccess(jsonRest)}else{c._listPage("0")}}},updateListHeight:function(){var c=this;desknets.listviewframe.updateListHeight(c.$mjListPage.find(".co-listview"),true,false)},_listPage:function(d){var c=this;var e=desknets.getInputDataToUrl(c.$mjListPage.find(".jco-back-page-data"));e=e+"&cmd="+c._getListCmd();c._setLocationHash(e)},_getListAjax:function(f){var c=this;var g={};var e={};var h={};var d={};c._hashUpdatePageParams();e=c.getListParamToObj();h=c.getListParamToObj();c._setParamCondLabelList(h);h.cmd=c._getLabelGetCmd();g["0"]=e;g["1"]=h;c._mchkIDs=c._getListAjaxGetId();d=c._getListAjaxOptions();c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,g,d)},getListParamToObj:function(){var c=this;var d=c.callBase("getListParamToObj");desknets.todo._deleteParamTopPageToDo(d);return d},_getListAjaxSuccess:function(d){var c=this;if(typeof(d[0])=="object"){if(d[0]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(d[0]["errorno"],d[0]["errormessage"])}else{c._getToDoTopAjaxSuccess(d[0])}if(d[1]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(d[1]["errorno"],d[1]["errormessage"])}else{c._getLabelAjaxSuccess(d[1])}}else{c._getToDoTopAjaxSuccess(d);if((typeof jsonRest)!="undefined"){c._getLabelAjaxSuccess(jsonRest)}}},_getListAjaxSuccessAddData:function(){var c=this;if((typeof jsonRest)!="undefined"){c._getAddDataAjaxSuccess(jsonRest)}else{c._getAddDataAjax()}},_listPageLink:function(){},_listSortLink:function(){},_listAllChkClear:function(){},_listAllChkDataCnt:function(){},_getAreaTitle:function(c){var d=this;var e="";var f=desknets.paramanalyzer.getHashParams();if(f.mytask==desknets.todo.VALUESTR_TODOREQTASK){e=desknets.Resource.todo.title_reqtask}else{e=desknets.Resource.todo.title_mytask}e=e+d.callBase("_getAreaTitle",c);return e},_getLableTitleClass:function(){var d="";var c=desknets.paramanalyzer.getHashParams();if(neo.isSet(c)&&neo.isSet(c.mytask)){d=desknets.todo.mFormTitle}return d},_setCountItemAssignLabelDefault:function(d){var c=this;c.callBase("_setCountItemAssignLabelDefault",d);desknets.todo._setToDoCountItemAssignLabelDefault(c,d)},_labelDelMultiParams:function(){var c=this;var e={};e=c.callBase("_labelDelMultiParams");var f=e["2"];var d=e["1"];f.mytask=d.mytask;e["2"]=f;return e},_getIdListPage:function(){return desknets.todo._getIdToDoTopPage()},_getIdListPageForm:function(){return"listtop"},_getListCmd:function(){return desknets.todo.PAGE_TODOLIST},_getListExecCmd:function(){return desknets.todo.CMD_TODOLIST},_getListDispCmd:function(){return desknets.todo.PAGE_TODOTASKREF},_getListAddCmd:function(){return desknets.todo.PAGE_TODOTASKENTRY},_getListModCmd:function(){var c=this;return c._getListAddCmd()},_getDelExecCmd:function(){return desknets.todo.CMD_TODOTASKDEL},_getListEntryClass:function(){return desknets.todo.todotaskentry},_getListModClass:function(){return desknets.todo.todotaskentry},_getListDispClass:function(){return desknets.todo.todotaskref},_getLabelGetCmd:function(){return desknets.todo.CMD_TODOLABELLIST},_getLabelEntryCmd:function(){return desknets.todo.CMD_TODOPSETLABELENTRY},_getLabelDelCmd:function(){return desknets.todo.CMD_TODOPSETLABELDEL},_getDataLabelEntryCmd:function(){return desknets.todo.CMD_TODOLABELASSIGNENTRY},_getDataLabelDelCmd:function(){return desknets.todo.CMD_TODOLABELASSIGNDEL}})})(jQuery);(function(b){desknets.page(desknets.todo,"todolistother",desknets.PageListBase,{_initListStart:function(){var c=this;c.$mjTableList=c.$mjListPage.find(".jtodo-listother");c.callBase("_initListStart")},_initListEnd:function(){var c=this;c.callBase("_initListEnd");c._switchDispButtonAccess(c)},_switchDispButtonAccess:function(d){var c=this;if(!neo.isSet(d)||!neo.isSet(d.$mjListPage)){return}var e=c._checkOtherAccessAdd();if(neo.isSet(e)&&e!="1"){desknets.todo._switchDisableItemToDo(d.$mjListPage,"jco-list-add-page")}},_checkOtherAccessAdd:function(){var c=b("#jtodo-user-listother").find(".jtodo-access-add");if(!neo.isSet(c)||c.length==0){return"0"}else{if(c.val()=="1"){return c.val()}}return"0"},initParamsFromHash:function(d){var c=this;var e="";var f=desknets.paramanalyzer.getHashParams();e=d.cmd;if(!neo.isSet(e)||e==c._getListCmd()){c._hashUpdateListPage(d)}else{if(e==c._getListAddCmd()){c._hashUpdateAddPage()}else{if(e==c._getListDispCmd()){c._hashUpdateDispPage()}else{c._hashUpdateOther(e)}}}},_getToDoTopAjaxSuccess:function(d){var c=this;if(d!=null){c.$mjTableList.html(d.html)}desknets.todoutil.SetDispDateTimeToDoTop(c.$mjListPage);c._getListAjaxSuccessEnd()},inputModPage:function(c){this.inputDispPage(c)},_getDispPageParam:function(){var c=desknets.paramanalyzer.getLocationHash();return c},_hashUpdateOther:function(e){var d=this;var f=desknets.paramanalyzer.getHashParams();var c;if(e==d._getListLimitCmd()){c="#"+d._getIdListLimitPage();if(b(c).find(".jco-title").length>0){desknets.todo.todolistlimother._getListAjax(f.row)}else{desknets.todo.todolistlimother.initPage(d.mhashBackCmd,d.mhashIdBack)}d.mhashBackCmd=d._getListLimitCmd();d.mhashIdBack=d._getIdListLimitPage()}},_getIdListLimitPage:function(){return"jco-m-todolimit-container"},_getListLimitCmd:function(){return desknets.todo.PAGE_TODOLISTLIMOTHER},_setTitle:function(e){var d=this;var c={};var f=desknets.todo.mFormTitle;c.uname=e;d.callBase("_setTitle",f,c)},_initListStartSet:function(){},_initListStartTemplate:function(){},_initListEndChk:function(){},_initListSetSort:function(){},_initListMain:function(){var d=this;var c=d._getListAjaxGetId();d._mobjParams=d.getListParamToObj();var e=desknets.paramanalyzer.getLocationHash();if(e!=""){d.funcHashObserver()}else{d._getToDoTopAjaxSuccess(null)}},getListParamToObj:function(){var c=this;var d=c.callBase("getListParamToObj");desknets.todo._deleteParamTopPageToDo(d);return d},_listPage:function(d){var c=this;var e=desknets.getInputDataToUrl(c.$mjListPage.find(".jco-back-page-data"));e=e+"&cmd="+c._getListCmd();c._setLocationHash(e)},_getListAjax:function(f){var c=this;var g={};var e={};var h={};var d={};c._hashUpdatePageParams();e=c.getListParamToObj();e.uid=desknets.todo._getUserIdSetId("jtodo-user");g["0"]=e;c._mchkIDs=c._getListAjaxGetId();d=c._getListAjaxOptions();c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,g,d)},_getListAjaxSuccess:function(d){var c=this;if(typeof(d[0])=="object"){if(d[0]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.ajax.onError(d[0]["errorno"],d[0]["errormessage"])}else{c._getToDoTopAjaxSuccess(d[0])}}},_listPageLink:function(){},_listSortLink:function(){},_listAllChkClear:function(){},_listAllChkDataCnt:function(){},_getAddPageParam:function(){var c=desknets.paramanalyzer.getHashParams();return c},_getDispPageParam:function(){var c=desknets.paramanalyzer.getHashParams();return c},_getIdListPage:function(){return desknets.todo._getIdToDoTopPage()},_getListCmd:function(){return desknets.todo.PAGE_TODOLISTOTHER},_getListExecCmd:function(){return desknets.todo.CMD_TODOLISTOTHER},_getListDispCmd:function(){return desknets.todo.PAGE_TODOTASKREF},_getListAddCmd:function(){return desknets.todo.PAGE_TODOTASKENTRY},_getListEntryClass:function(){return desknets.todo.todotaskentry},_getListDispClass:function(){return desknets.todo.todotaskref},})})(jQuery);(function(b){desknets.page(desknets.todo,"todolistlimit",desknets.todo.listcomlabel,{_formLinkBtnArea:"#cmd=todolistlimit&mytask={{mytask}}&labelid={{labelid}}&limit={{limit}}&fldsort={{fldsort}}&order={{order}}&num={{num}}&row=0",_getFieldsCheckScroll:function(){return["mytask","limit"]},_listMoveScroll:function(){this._setClearScrollPosition();this.callBase("_listMoveScroll")},_getLabelAjaxSuccess:function(d){var c=this;c.ListLimitSetMyTaskLink();c.callBase("_getLabelAjaxSuccess",d)},ListLimitSetMyTaskLink:function(){var c=this;var d=desknets.paramanalyzer.getHashParams();if(!neo.isSet(d.cmd)){return}if(d.mytask!=desknets.todo.VALUESTR_TODOREQTASK){c._setLinkHashParamToReqtask(d)}else{c._setLinkHashParamToMytask(d)}},_setLinkHashParamToMytask:function(f){var d=this;var c=d._formLinkBtnArea;c=desknets.tmpl.replaceWordHtml(c,"mytask",desknets.todo.VALUESTR_TODOMYTASK);c=desknets.tmpl.replaceWordHtml(c,"limit",f.limit);c=desknets.tmpl.replaceWordHtml(c,"num",f.num);c=desknets.tmpl.replaceWordHtml(c,"labelid",f.labelid);if(!neo.isSet(f.fldsort)){f.fldsort="limdate"}c=desknets.tmpl.replaceWordHtml(c,"fldsort",f.fldsort);if(!neo.isSet(f.order)){f.order="1"}c=desknets.tmpl.replaceWordHtml(c,"order",f.order);var e=f.bproc;if(neo.isSet(e)&&e!=""){c=c+"&bproc="+e}d.$mjListPage.find(".jtodo-list-reqtask").find(".jtodo-mytasklink").attr("href",c)},_setLinkHashParamToReqtask:function(f){var d=this;desknets.todo.MyTaskComLocationAddParam(f);var c=d._formLinkBtnArea;c=desknets.tmpl.replaceWordHtml(c,"mytask",desknets.todo.VALUESTR_TODOREQTASK);c=desknets.tmpl.replaceWordHtml(c,"limit",f.limit);c=desknets.tmpl.replaceWordHtml(c,"num",f.num);c=desknets.tmpl.replaceWordHtml(c,"labelid",f.labelid);if(!neo.isSet(f.fldsort)){f.fldsort="limdate"}c=desknets.tmpl.replaceWordHtml(c,"fldsort",f.fldsort);if(!neo.isSet(f.order)){f.order="1"}c=desknets.tmpl.replaceWordHtml(c,"order",f.order);var e=f.bproc;if(neo.isSet(e)&&e!=""){c=c+"&bproc="+e}d.$mjListPage.find(".jtodo-list-mytask").find(".jtodo-mytasklink").attr("href",c)},ListChangeClassName:function(){var c=this;desknets.todo.ListComChangeClassName(c.$mjListPage)},_getAreaTitle:function(d){var e=this;var c="";var f=desknets.paramanalyzer.getHashParams();if(f.mytask&&f.mytask==desknets.todo.VALUESTR_TODOREQTASK){c=desknets.Resource.todo.title_reqtask}else{c=desknets.Resource.todo.title_mytask}c=c+desknets.todo.ListLimComCreateStringTitle(f.limit);c=c+e.callBase("_getAreaTitle",d);return c},_getLableTitleClass:function(){var d="";var c=desknets.paramanalyzer.getHashParams();if(neo.isSet(c)&&neo.isSet(c.mytask)&&neo.isSet(c.limit)){d=desknets.todo.mFormTitle}return d},_labelDelMultiParams:function(){var c=this;var e={};e=c.callBase("_labelDelMultiParams");var f=e["2"];var d=e["1"];f.mytask=d.mytask;f.limit=d.limit;e["2"]=f;return e},_getIdListPage:function(){return"jco-m-todolimit-container"},_getListCmd:function(){return desknets.todo.PAGE_TODOLISTLIMIT},_getListExecCmd:function(){return desknets.todo.CMD_TODOLISTLIMIT},_getFieldsCheckScroll:function(){return["limit","mytask"]}})})(jQuery);desknets.page(desknets.todo,"todolistlimother",desknets.todo.listcom,{_getFieldsCheckScroll:function(){return["limit"]},_listMoveScroll:function(){this._setClearScrollPosition();this.callBase("_listMoveScroll")},_initListEnd:function(){var b=this;b.callBase("_initListEnd");desknets.todo.todolistother._switchDispButtonAccess(b)},getListParamToObj:function(){var b=this;var c={};c=b.callBase("getListParamToObj");c.uid=desknets.todo._getUserIdSetId("jtodo-user");return c},_getSearchExecParam:function(){var b=this;var c=b.callBase("_getSearchExecParam");c.uid=desknets.todo._getUserIdSetId("jtodo-user");return c},_listAllChkClear:function(){return},_listAllChkDataCnt:function(){return},ListDispSwitch:function(){var b=this;var c;var d=desknets.paramanalyzer.getHashParams();b.$mjListPage.show()},ListChangeClassName:function(){var b=this;desknets.todo.ListComChangeClassName(b.$mjListPage)},_setTitle:function(f){var e=this;var h="";var d="";var c="{{uname}}";var b={};var i="#"+desknets.todo._getIdToDoTopPage();h=a(i).find(".jco-title").val();var g=desknets.paramanalyzer.getHashParams();c=desknets.todo.mFormTitle;d=c+desknets.todo.ListLimComCreateStringTitle(g.limit);b.uname=h;e.callBase("_setTitle",d,b)},_getIdListPage:function(){return"jco-m-todolimit-container"},_getListCmd:function(){return desknets.todo.PAGE_TODOLISTLIMOTHER},_getListExecCmd:function(){return desknets.todo.CMD_TODOLISTLIMOTHER},_getListAddCmd:function(){return desknets.todo.PAGE_TODOTASKENTRY},_getListDispCmd:function(){return desknets.todo.PAGE_TODOTASKREF},_getListEntryClass:function(){return desknets.todo.todotaskentry},_getListModClass:function(){return desknets.todo.todotaskentry},_getListDispClass:function(){return desknets.todo.todotaskref}});desknets.page(desknets.todo,"todolistsearch",desknets.todo.listcomlabel,{_boDelSingle:function(){return true},_initGetHtml:function(){var b=this;b.boGetHtmlSingle=b._boDelSingle();b.callBase("_initGetHtml")},ListChangeClassName:function(){var b=this;var c=b.$mjListPage.find(".co-listview-scroll");c.find(".jtodo-add-class-task").each(function(){a(this).removeClass("jtodo-add-class-task");var d=a(this).find("input[name=complete]").val();if(d==desknets.todo.VALUESTR_TODOTASKCOMPLETE){a(this).addClass("todo-tr-end")}})},_getDelAddPrm:function(){var b=this;var c={};var d=desknets.paramanalyzer.getHashParams();if(d.labelid!=undefined){c.labelid=d.labelid}if(d.srch_limdate_s!=undefined){c.srch_limdate_s=d.srch_limdate_s}if(d.srch_limdate_e!=undefined){c.srch_limdate_e=d.srch_limdate_e}if(d.complete!=undefined){c.complete=d.complete}if(d.mytask!=undefined){c.mytask=d.mytask}if(d.srch_key!=undefined){c.srch_key=d.srch_key}return c},getLocationFormParam:function(){var b=this;var c={};c.labelid="";c.mytask=desknets.todo.VALUESTR_TODOMYTASK;c.cmd=b.mBackCmd;return c},_getIdListPage:function(){return"jco-m-search-container"},_getIdListPageForm:function(){return"listfrmsrch"},_getListCmd:function(){return desknets.todo.PAGE_TODOLISTSEARCH},_getListExecCmd:function(){return desknets.todo.CMD_TODOLISTSEARCH},});desknets.page(desknets.todo,"todotaskref",desknets.PageDispBase,{mboOtherTask:null,mTargetName:"",_getDispDataParam:function(){var c=this;var d={};d=desknets.paramanalyzer.getHashParams();d.cmd=this._getDispExecCmd();var b=desknets.todo._getUserIdSetId("jtodo-user");if(b.length>0){d.uid=b;c.mboOtherTask=true}else{c.mboOtherTask=false}return d},_initHtml:function(d){var b=this;var e="";if(d[1]["status"]!=desknets.RES_STATUS_SUCCESS){b.onError(d[1]["errorno"],d[1]["errormessage"]);return}b._changeDispPage(d[1].html);var c=desknets.ajax.getItems(d[0]["target"].item);if(c[0].val){b.mTargetName=c[0].val}b._initHtmlTmplSet(d);b._initSet(d)},_initSet:function(c){var b=this;b.TaskRefDispSwitch(c[0]);desknets.tagDisp.initTagEvent(desknets.MODULE_API_MAIN,b._getToDoRefTagParam());b.TaskRefInitCabinet(c);b.callBase("_initSet",c)},getLocationFormParam:function(){var c=this;var d={};var b="";d=c.callBase("getLocationFormParam");if(d!=null){desknets.todo.CheckParamSetHash(d);desknets.todo.CheckParamSetCmd(d)}return d},TaskRefInitCabinet:function(e){var c=this;var b=true;if(!c.mboOtherTask){var d={copymodule:c._getRestModule(),copycmd:desknets.todo.CMD_TODOATTACHCOPY};d.cabtitle=e[0]["title"];if(e[0]["attach"]){b=false}desknets.cabinetregist.init(c.$mjPage,d,b)}},_getToDoRefTagParam:function(){var b=desknets.paramanalyzer.getHashParams();b.cmd=desknets.todo.CMD_TODOTAGENTRY;return b},_inputButton:function(){var b=this;b.$mjPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()});b.$mjPage.find(".jco-pagemod").click(function(c){c.preventDefault();b.inputModPage()});b.$mjPage.find(".jtodo-button-complete").click(function(c){c.preventDefault();b._onClickToDoRefComplete()});b.$mjPage.find(".jco-input-del-submit").click(function(c){c.preventDefault();b._inputDelSubmit()});b.$mjPage.find(".jco-input-del-submit-conf").click(function(c){c.preventDefault();b._inputDelConfSubmit()})},_onClickToDoRefComplete:function(){var b=this;var d=desknets.paramanalyzer.getHashParams();d.cmd=this._getToDoEndExecCmd();var c={success:function(){setTimeout(function(){b.dispBackListPage()},100)}};this._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,desknets.ajax.RESTYPE_JSON,d,c)},TaskRefDispSwitch:function(d){var b=this;var c=b.$mjPage.find(".jtodo-task-end");if(d.fintime!=undefined){c.show()}else{c.hide()}},_initSetTag:function(c){var b=this;desknets.tagDisp.initEntryPageTag(a("#co-ref-tag-options"))},TaskRefGetAttachDownloadParams:function(c){var b={};b=desknets.todo.TaskRefGetAttachParams(c);b.cmd=desknets.todo.CMD_TODODISPATTACH;return b},_setTitle:function(d){var c=this;var b={};var e=c.TaskRefAddTitleCreateString();b.uname=c.mTargetName;d=e+d;c.callBase("_setTitle",d,b)},TaskRefAddTitleCreateString:function(){var b=this;var d="";if(!b.mboOtherTask){return""}var c=b.mTargetName;if(c==null){return""}return desknets.todo.mFormTitle},_getAddExecCmd:function(){return desknets.todo.PAGE_TODOTASKENTRY},_getModExecCmd:function(){return this._getAddExecCmd()},_getToDoEndExecCmd:function(){return desknets.todo.CMD_TODOTASKCOMPLETE},_getDelExecCmd:function(){return desknets.todo.CMD_TODOTASKDEL},_getIdPage:function(){return"jco-m-disp-page"},_getDispExecCmd:function(){return desknets.todo.CMD_TODOTASKREF},_getDispModCmd:function(){return desknets.todo.PAGE_TODOTASKENTRY}});desknets.page(desknets.todo,"todotaskentry",desknets.PageLabelInput,{mObjOthertoNm:null,mObjOthertoSts:null,mObjAttachs:null,mTaskEntryDate:null,mTaskEntryTime:null,mParent:null,mTemplateOtherTo:'<span class="co-selitem"><span class="co-selitem-text" title="{{name}}{{addstatus}}">{{name}}{{addstatus}}</span><a href="#" class="co-btn co-btn-close" title="{{L_Delete}}">x</a><input type="hidden" name="{{keyName}}" value="{{id}}" /></span>',mDateFormatDefTodo:"yyyy-MM-dd",initPage:function(d,c){var b=this;b.mObjOthertoNm=null;b.mObjOthertoSts=null;b.mObjAttachs=null;b.mTemplateOtherTo=desknets.tmpl.replaceWordHtml(b.mTemplateOtherTo,"L_Delete",desknets.Resource.deselectLabel);b.callBase("initPage",d,c)},getMultiRequest:function(){var c=this;var e={};var d={};var f=0;e=desknets.paramanalyzer.getHashParams();var b=desknets.todo._getUserIdSetId("jtodo-user");if(b.length>0){e.uid=b}d[f]=e;f++;e=desknets.attach.ext.getListParam();if(e){d[f]=e}return d},_initSet:function(d){var c=this;c.TaskEntryInit();c.TaskEntrySetEvent();c.TaskEntryDispSwitch();c.callBase("_initSet",d);var e=desknets.paramanalyzer.getHashParams();var b=c.$mjPage.find("form");desknets.inputUtil.loadPresetFormValues(e.cmd,b)},TaskEntryInit:function(){var b=this;desknets.timePicker.create(b.$mjPage.find("#jtodo-deadline-time"));desknets.htmlparts.setUpForm(b.$mjPage.find("#inputfrm"));desknets.label.selectSet(b.$mjPage);b._initSetTag();b._initUserSelectDialog()},TaskEntrySetEvent:function(){var b=this;b.TaskEntryEventSetLimit();b.TaskEntryEventSetAttach();b.TaskEntryEventSetAlarm()},_initHtml:function(c){var b=this;b.$mjPage.empty();b.$mjPage.html(c[0].html);if(c[1]){desknets.attach.ext.saveList(c[1])}desknets.todo.input.attach.init(b.$mjPage,true);b._initSet(c)},_updateLabelListId:function(c){var b=this;b._updateTaskParam(c);b.callBase("_updateLabelListId",c)},_updateTaskParam:function(e){var b=this;var g=a("#"+b.mIdBack).find(".jco-back-page-data");var d=desknets.paramanalyzer.getHashParams();var f=e.mytask;var c=e.limit;if(f!=undefined){g.find("input[name=mytask]").val(f)}if(c!=undefined&&d.limit!=undefined){g.find("input[name=limit]").val(c)}},getLocationFormParam:function(){var c=this;var d={};var b="";d=c.callBase("getLocationFormParam");if(d!=null){desknets.todo.CheckParamSetHash(d);desknets.todo.CheckParamSetCmd(d)}return d},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.success=function(d){b._updateLabelListId(d);b._onSuccessToSubmit(d)};return c},_onSuccessToSubmit:function(c){var b=this;if(!!c.noticeerror){var d=desknets.dialog.alert(c.noticeerror,{type:"warn",extraClass:"co-msg-r",extraMessage:c.msgadd});d.one("dialogclose",function(){b._setLocationHashForm()})}else{b._setLocationHashForm()}},TaskEntryDispSwitch:function(){var b=this;b.TaskEntryDispSwitchLimit();b.TaskEntryDispSwitchAlarm();b.TaskEntryDispSwitchFinTime();b.TaskEntryDispSwitchChild()},TaskEntryDispSwitchChild:function(){var d=this;var c=d.$mjPage.find(".jtodo-disp-parent");var e=d.$mjPage.find(".jtodo-disp-child");d.mParent=d.$mjPage.find('input[name="parent"]').val();d.TaskEntryAttachsSet();if(d.mParent===desknets.todo.VALUESTR_TODOPARENT){c.show();e.hide()}else{c.hide();e.show();d.$mjPage.find(".co-required.jtodo-otherto").removeClass("co-required");var b=d.TaskEntryCreateOthertoList();if(b.length>0){d.$mjPage.find(".jtodo-child-othertolist").html(b)}}},TaskEntryAttachsSet:function(){var c=this;var e=c.$mjPage.find(".jtodo-attachs-child");var f=e.find('input[name="flgentrydel"]').val();if(f===desknets.todo.VALUESTR_TODOFLGON){e.children(".co-etd").text(desknets.Resource.Message.todo_attach_entrydel)}else{var d=c.$mjPage.find('input[name="srcattcnt"]').val();if(d==0){e.hide()}else{if(c.mParent===desknets.todo.VALUESTR_TODOPARENT){e.hide()}else{e.show();var b=c.TaskEntryCreateAttachList();if(b.length>0){c.$mjPage.find(".jtodo-child-attachlist").html(b);e.show()}else{e.hide()}}}}},TaskEntryCreateOthertoList:function(){var b=this;var c="";if(b.mObjOthertoNm&&b.mObjOthertoSts){c=desknets.tmpl.dispItems(b.mObjOthertoNm.name,b.mObjOthertoSts.compsts,desknets.todo.form_sts,desknets.todo.FIELD_TODOTASKSTS)}return c},TaskEntryCreateAttachList:function(){var b=this;var c="";if(b.mObjAttachs){c=desknets.attachDisp.disp(b.mObjAttachs.attach,desknets.MODULE_MAIN,b.getAttachDownloadParams())}return c},getAttachDownloadParams:function(){var c={};var d=desknets.paramanalyzer.getHashParams();var b=desknets.todo._getUserIdSetId("jtodo-user-entry");c={cmd:desknets.todo.CMD_TODODISPATTACH,id:d.id,uid:b};return c},TaskEntryDispSwitchAlarm:function(){var b=this;var c=b.$mjPage.find(".jtodo-set-alarm");var d=b.$mjPage.find('select[name="alarm"] option:selected').val();if(d===desknets.todo.VALUESTR_TODOALARMON){c.show()}else{c.hide()}},TaskEntryDispSwitchLimitEvent:function(c){var d=this;var b=d.$mjPage.find("#jtodo-deadline-date");var e=d.$mjPage.find(".co-timepicker");if(c===desknets.todo.VALUESTR_TODOLIMITNONE){b.hide();e.hide()}else{if(c===desknets.todo.VALUESTR_TODOLIMITDATEON){b.show();e.show()}else{b.hide();e.show()}}},TaskEntryDispSwitchLimit:function(){var c=this;var b;c.$mjPage.find("#jtodo-deadline-date").hide();c.$mjPage.find(".co-timepicker").show();var d=c.$mjPage.find('input[name="id"]').val();if(d){b=d.length}else{b=0}if(b==0){c.TaskEntryDispSwitchLimitInitAdd()}else{c.TaskEntryDispSwitchLimitInitMod()}},TaskEntryDispSwitchLimitInitAdd:function(){var j=this;var c=j.$mjPage.find('input[name="limdate"]');var d=j.$mjPage.find('input[name="limtime"]');var g=j.$mjPage.find("#jtodo-deadline-date");var f=j.$mjPage.find("#jtodo-deadline");var h="";var e=desknets.pageframe.getServerDate();if(e==null){return}var i=new Date(e);var b=neo.dateTime.moveDate(i,7);if(b){h=neo.dateTime.format(j.mDateFormatDefTodo,b)}f.val(7);c.val(h);g.hide()},TaskEntryDispSwitchLimitInitMod:function(){var m=this;var c;var f;var l;var b;var e;var i=m.$mjPage.find("#jtodo-deadline-date");var h=m.$mjPage.find(".co-timepicker");var d=m.$mjPage.find("#jtodo-deadline");h.show();var k=i.val();var j="";if(k&&k.length!==0){f=desknets.pageframe.getServerDate();if(f==null){return}c=new Date(k);if(c==null){return}var g=m.TaskEntryCompSvtimeDayAfter(c);if(g===0||g===1||g===2||g===7||g===14){l=new Date(f);b=neo.dateTime.moveDate(l,g);e=g}else{e=desknets.todo.VALUESTR_TODOLIMITDATEON;b=new Date(c);i.show()}}else{e=desknets.todo.VALUESTR_TODOLIMITNONE;i.hide();h.hide()}d.val(e)},TaskEntryDispSwitchFinTime:function(){var b=this;var d=b.$mjPage.find(".jtodo-task-end");var c=b.$mjPage.find("#jtodo-complete").attr("checked");if(c=="checked"){d.show()}else{d.hide()}},TaskEntryEventSetAlarm:function(){var b=this;b.$mjPage.find(".co-editarea").delegate("#jtodo-alarm","change",function(c){c.preventDefault();b.TaskEntryDispSwitchAlarm()})},TaskEntryEventSetAttach:function(){var b=this;b.$mjPage.find(".co-ebtnarea").delegate(".jtodo-attach-list","click",function(c){c.preventDefault();desknets.todo.input.attach.open(b.$mjPage)})},TaskEntryEventSetLimit:function(){var b=this;b.mTaskEntryDate=null;b.mTaskEntryTime=null;b.$mjPage.find(".co-editarea").delegate("#jtodo-deadline","change",function(c){c.preventDefault();var o;var e;var k;var h;var n;var l=desknets.Resource.dateFormat;var g=b.$mjPage.find('input[name="limdate"]');var f=b.$mjPage.find('input[name="limtime"]');var j=b.$mjPage.find("#jtodo-deadline-date");h=desknets.pageframe.getServerDate();if(h==null){return}var p=new Date(g.val());var m=neo.dateTime.format("yyyy-MM-dd",p);e=neo.dateTime.parse(m);if(e==null){e=h}var d=a(this).val();if(d===desknets.todo.VALUESTR_TODOLIMITNONE){b._taskEntryClearDatePicker();var q=neo.dateTime.parse(g.val());if(neo.isSet(q)){var i=neo.dateTime.format(l,q);b.mTaskEntryDate=i;b.mTaskEntryTime=f.val()}else{b.mTaskEntryDate=g.val();b.mTaskEntryTime=f.val()}g.val("");f.val("")}else{if(d===desknets.todo.VALUESTR_TODOLIMITDATEON){if((b.mTaskEntryDate!=null&&b.mTaskEntryTime!=null)){g.val(b.mTaskEntryDate);f.val(b.mTaskEntryTime);b.mTaskEntryDate=null;b.mTaskEntryTime=null;j.val(g.val())}else{if(j.val()==""){n=new Date(h);o=neo.dateTime.moveDate(n,7);k=neo.dateTime.format(l,o);j.val(k);k=neo.dateTime.format(b.mDateFormatDefTodo,o);g.val(k);b.mTaskEntryDate=null;b.mTaskEntryTime=null}else{k=neo.dateTime.format(l,e);j.val(k)}}}else{b._taskEntryClearDatePicker();n=new Date(h);o=neo.dateTime.moveDate(n,parseInt(d));k=neo.dateTime.format(b.mDateFormatDefTodo,o);g.val(k)}}b.TaskEntryDispSwitchLimitEvent(d)})},_taskEntryClearDatePicker:function(){var b=this;var c=b.$mjPage.find("#jtodo-deadline-date");c.val("");c.removeClass("ui-invalid-mismatch ui-invalid")},TaskEntryCompSvtimeDayAfter:function(i){var e=this;var h;var g;if(i==null){return 0}var d=desknets.pageframe.getServerDate();if(d==null){return 0}var b=new Date(i);if(b==null){return 0}if(neo.dateTime.compareOn(b,d,"day")<0){return -1}for(h=0;h<=14;h++){var f=new Date(d);var c=neo.dateTime.moveDate(f,h);g=neo.dateTime.compareOn(b,c,"day");if(g==0){break}}return h},_setTitle:function(g){var j=this;var h="";var d="";var i="";var f="";var e={};var b="#"+desknets.todo._getIdToDoTopPage();h=a(b).find(".jco-title").val();f=desknets.todo._getUserIdSetId("jtodo-user");var c=desknets.paramanalyzer.getHashParams();if(c.id){d=desknets.Resource.todo.title_entrymod}else{d=desknets.Resource.todo.title_entryadd}if(f!==""){i=desknets.todo.mFormTitle}i=i+d;e.uname=h;j.callBase("_setTitle",i,e)},_initSetTag:function(){var b=this;desknets.tagDisp.initEntryPageTag(a("#co-entry-tag-options"))},_initUserSelectDialog:function(){var b=this;var c={chooseTarget:["user"],allGroup:"choosable",choosePrivateGroup:true,unassignGroup:"choosable"};desknets.chooser.setUpEntry(a("#jco-m-input-page"),b._getTargets(),{dialogID:"jtodo-usersel-chooser-dialog",initCreate:true,dialogOptions:c,extraVars:{user:{keyName:"otherto"}},template:b.mTemplateOtherTo,filter:function(e,i){var g;var h={};var d=[];var f={};var j=b._getTargets();for(g=0;g<e.length;g++){for(oCnt=0;oCnt<j.length;oCnt++){if(e[g].id==j[oCnt].id){break}}if(oCnt>=j.length){d[d.length]=e[g].id}}h.id=d;h.cmd=desknets.todo.CMD_TODOFILTARGET;h.accesskind=desknets.todo.VALUEACC_TODOADD;if(h.id.length==0){return}f.success=function(k){b.onSuccessFreeTargetFilter(k,e,i,d)};b._sendRequestAjax(desknets.ajax.REQTYPE_SINGLE,null,h,f);return false}})},onSuccessFreeTargetFilter:function(e,h,b,i){var k;var g;var f,j,c;var d=false;g=desknets.ajax.getJsonItems(e);iMax=g.length;for(f=i.length-1;f>=0;f--){for(j=0;j<iMax;j++){k=g[j];if(k.id==i[f]){break}}if(j>=iMax){for(aCnt=0;aCnt<h.length;aCnt++){if(h[aCnt].id==i[f]){h.splice(aCnt,1);d=true}}}}for(j=0;j<h.length;j++){if(h[j].addstatus==undefined){h[j].addstatus=""}}b(h);if(d){setTimeout(function(){desknets.pageframe.viewTopMsgFromID("com_accs_otherto_add")},1)}},_getTargets:function(){var c=this;var b=[];b=desknets.chooser.getItemsFromElement(c.$mjPage.find(".jco-sel-items"),{itemFilter:function(e,d){var f=d.closest(".co-selitem").find('input[name="compstatus"]').val();e.addstatus=f;return e}});return b},_getAddExecCmd:function(){return desknets.todo.CMD_TODOTASKENTRY},_getModExecCmd:function(){return this._getAddExecCmd()},_getDelExecCmd:function(){return desknets.todo.CMD_TODOTASKDEL}});app.addInitialAction(function(){desknets.todo.init()})})(jQuery);