/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){desknets.page(desknets,"NoticeUnconfirmUserDialog",null,{_dialogId:"jco-view-notice-dialog",$dialog:null,_TMPL_DIALOG:null,_DIALOG_TITLE:null,_TMPL_USER:'<span class="co-selitem"><span class="co-selitem-text" title="{{name}}">{{name}}</span><a href="#" class="co-btn co-btn-close" title="'+desknets.Resource.deselectLabel+'">x</a><input type="hidden" name="uid" value="{{id}}" /></span>',id:null,subject:null,init:function(c){var b=this;b.destroy();b._TMPL_DIALOG=b.initSetupDialog();b._DIALOG_TITLE=b.initSetupTitle();b.id=desknets.paramanalyzer.getHashParam("id");b.subject=c},initSetupDialog:function(){return""},initSetupTitle:function(){return""},destroy:function(){var b=this;if(b.$dialog){desknets.dialog.deleteById(this._dialogId);this.$dialog=null}},open:function(){var b=this;if(b.$dialog==null){b.$dialog=desknets.dialog.make(b._dialogId,b._getDialogOptions());desknets.tmpl.load(b.$dialog,b._TMPL_DIALOG,function(){b._buildContents();b.$dialog.dialog("open");desknets.dialog.setFirstDialogOpen(b.$dialog)})}else{b._loadUnconfirmUsers();b.$dialog.dialog("open")}return b.$dialog},_getDialogOptions:function(){var b=this;var c=a.extend(desknets.dialog.getDialogOption(),{title:b._DIALOG_TITLE,dialogClass:"dn-dialog message confirm",buttons:{},width:600});c.buttons[desknets.Resource.OKButtonLabel]=function(){b._noticeSend()};c.buttons[desknets.Resource.CancelButtonLabel]=function(){b.$dialog.dialog("close")};return c},_buildContents:function(){var c=this;var d=c.$dialog.find('input[name="subject"]');var b=desknets.tmpl.replaceWordHtml(d.val(),"subject",c.subject);d.val(b);if(desknets.pageframe.getMailUse()!="1"){c.$dialog.find(".jco-notice-mail").remove();c.$dialog.find("#co-notice-memo").selected()}else{c.$dialog.find("#co-notice-mail").selected()}if(!desknets.pageframe.isShownMenu("memo")){c.$dialog.find(".jco-notice-memo").remove()}c.$dialog.find(".co-selmulti-items").on("click",".co-btn-close",function(e){e.preventDefault();a(this).parent().remove()});c._loadUnconfirmUsers()},_loadUnconfirmUsers:function(){var b=this;var c=function(h,d,i){var g=b.$dialog.find(".co-selmulti-items");g.html("");var e=h.list["item"];if(e==null){e=[]}if(!a.isArray(e)){e=[e]}var f=desknets.pageframe.getLoginUid();a.each(e,function(k,l){if(f!=l.uid){var j=b._TMPL_USER;j=desknets.tmpl.replaceWordHtml(j,"id",l.uid);j=desknets.tmpl.replaceWordChk(j,"name",l.uname);g.append(j)}})};desknets.ajax.rest({url:b._getUrl(),data:b._loadUnconfirmUsersPrm(),success:function(e,d,f){c(e,d,f)}})},_getUrl:function(){return""},_loadUnconfirmUsersPrm:function(){return{}},_noticeSend:function(){var c=this;desknets.submitform.setDialogDisabled(c.$dialog);var b=[];desknets.ajax.rest({url:c._getUrl(),data:c._noticeSendPrm(),error:function(g,e,i){var h=i;var d=a.parseJSON(g.responseText);if(!!d.errmsgadd){var f={};f.msg=d.errormessage;f.fieldid=d.errmsgadd;f.fieldname=desknets.getErrFieName(c.$dialog,d.errmsgadd);h=desknets.getErrConvMsg(f)}desknets.ajax.onError(g.status,h)},success:function(f,d,g){if(!!f.msg){var h={extraMessage:f.noticeerror,extraClass:"co-msg-r",type:"warn",close:function(){c.$dialog.dialog("close")}};var e=desknets.dialog.alert(f.msg,h);e.bind("dialogclose",function(i){desknets.dialog.deleteById("warn")})}else{var h={type:"message",close:function(){c.$dialog.dialog("close")}};desknets.dialog.alert(c._noticeSendMsg(),h)}},complete:function(f,d,e){desknets.submitform.clearDialogDisabled(c.$dialog)},traditional:true})},_noticeSendPrm:function(){return{}},_noticeSendMsg:function(){return""},_updateToContactWith:function(){var c=this;var b=0;c.$dialog.find("input[type=checkbox]:checked").each(function(){b+=Number(a(this).val())});if(b===0){return""}else{return b.toString()}}});(function(b){desknets.enq={MODULE_ENQUETE:"zenquete",MODULE_API_ENQUETE:"zrenquete",PAGE_ENQINDEX:"enqindex",PAGE_ENQ_ANSWER:"enqanswer",PAGE_ENQ_ANSWERS:"enqanswers",PAGE_ENQ_ANSWERSCSV:"enqanswerscsv",CMD_ENQFORMATEDIT:"enqcmdformatedit",CMD_ENQINDEX:"enqcmdindex",CMD_ENQLISTUNREAD:"enqcmdnoticeunread",CMD_ENQLISTREAD:"enqcmdnoticeread",CMD_ENQLISTDEL:"enqcmdnoticedel",CMD_ENQLISTDELCONF:"enqcmdnoticedelconf",CMD_ENQDISPPAGE:"enqcmddisppage",CMD_ENQDISP:"enqcmddisp",CMD_ENQENTRYPAGE:"enqcmdentrypage",CMD_ENQENTRY:"enqcmdentry",CMD_ENQCABINETPAGE:"enqcmdcabinetpage",CMD_ENQCONFIRMPAGE:"enqcmdconfirmpage",CMD_ENQDEL:"enqcmddel",CMD_ENQDELCONF:"enqcmddelconf",CMD_ENQFINISH:"enqcmdfinish",CMD_ENQFINISHCONF:"enqcmdfinishconf",CMD_ENQROUTE:"enqcmdroute",CMD_ENQANSWER:"enqcmdanswer",CMD_ENQANSWERDRAFT:"enqcmdanswerdraft",CMD_ENQSELECTFORMAT:"enqcmdselectformat",CMD_ENQADDATTACH:"enqcmdaddattach",CMD_ENQDELATTACH:"enqcmddelattach",CMD_ENQDISPATTACH:"enqcmddispattach",CMD_ENQTMPFILEDISPATTACH:"enqcmdtmpfiledispattach",CMD_ENQ_CLOSEDATE:"enqcmdclosedate",CMD_ENQUNCONFIRMNOTICE:"enqcmdnoticeunconf",CMD_ENQDRAFTINDEX:"enqcmddraftindex",CMD_ENQDRAFTPAGE:"enqcmddraftpage",CMD_ENQDRAFTDEL:"enqcmddraftdel",CMD_ENQDRAFTENTRY:"enqcmddraft",CMD_ENQDRAFTSEND:"enqcmddraftsend",CMD_ENQSEARCHPAGE:"enqcmdsearchindexpage",CMD_ENQSEARCHINDEX:"enqcmdsrchindex",CMD_ENQSEARCHDISPPAGE:"enqcmdsrchdisppage",CMD_ENQSTOPSEARCH:"enqcmdsrchstop",CMD_ENQCABATTACHCOPY:"enqcmdcabattachcopy",CMD_ENQUSERFORMATLIST:"enqcmduserformatlist",CMD_ENQFORMATLIST:"enqcmdformatlist",CMD_ENQUSERFORMATPREVIEW:"enqcmduserformatpreview",CMD_ENQFORMATPREVIEW:"enqcmdformatpreview",CMD_ENQEDITFORMATCOPYTEMP:"enqcmdeditformatcopytemp",CMD_ENQEDITFORMATPAGE:"enqcmdeditformatpage",CMD_ENQEDITFORMATPREVIEW:"enqcmdeditformatpreview",CMD_ENQEDITFORMAT:"enqcmdeditformat",CMD_ENQEDITFORMATSAVE:"enqcmdeditformatsave",CMD_ENQEDITFORMATSETSORT:"enqcmdeditformatsetsort",CMD_ENQEDITFORMATPARTENTRY:"enqcmdeditformatpartentry",CMD_ENQEDITFORMATPART:"enqcmdeditformatpart",CMD_ENQEDITFORMATPARTDEL:"enqcmdeditformatpartdel",CMD_ENQEDITFORMATNUMLIST:"enqcmdeditformatnumlist",CMD_ENQEDITFORMATADDATTACH:"enqcmdeditformataddattach",CMD_ENQEDITFORMATDELATTACH:"enqcmdeditformatdelattach",CMD_ENQEDITFORMATDISPTMPATTACH:"enqcmdeditformatdisptmpattach",CMD_ENQUSERROUTELIST:"enqcmduserroutelist",CMD_ENQROUTELIST:"enqcmdroutelist",CMD_ENQROUTESELECT:"enqcmdrouteselect",FILE_ENQUETEENTRYREPLY:"enqrpent",FILE_ENQUETEENTRYFORMUPDATE:"enqupdent",FILE_ENQUETEFORMENTRY:"enqfrment",DRAFT_FOLDER_ID:"draft",SEND_FOLDER_ID:"send",MAXNUM:"999999999",init:function(){var c=b("#jco-pv-funcid").val();desknets.pageframe.setFuncSel(c);if(c==desknets.enq.PAGE_ENQINDEX){desknets.hashobserver.init(desknets.enq);desknets.enq.enqindex.init()}else{if(c==desknets.enq.PAGE_ENQ_ANSWER){desknets.enq.enqanswer.init()}}if(c.indexOf("enq")!=-1&&!this.isEnquetePSetCmd(c)&&!this.isEnqueteMSetCmd(c)){desknets.enq.subwin.init()}},isEnquetePSetCmd:function(c){if(c.substr(0,7)=="enqpset"){return true}else{return false}},isEnqueteMSetCmd:function(c){if(c.substr(0,7)=="enqmset"){return true}else{return false}},_initEnqueteSetRegistryEvent:function(){var c=this},replaceEnqListLine:function(c,j,f,i){var h,g;if(j==="important"){switch(f[j]){case"1":g="haste";h=desknets.Resource.importance_highest;break;case"2":g="high";h=desknets.Resource.importance_high;break;case"4":g="low";h=desknets.Resource.importance_low;break;default:g="";h=""}c=desknets.tmpl.replaceWordHtml(c,"importance-cls",g);c=desknets.tmpl.replaceWordHtml(c,"importance-text",h)}else{if(j==="sts"){switch(f[j]){case"0":g="",h="";switch(f.prstatus){case"1":g="replied";if(!!i&&i.indexOf("recv")==0){h=desknets.Resource.enq.replied}break;case"2":break;default:break}break;case"4":g="finish";h=desknets.Resource.enq.finish;break;case"6":g="finish";h=desknets.Resource.enq.finish;break;case"7":g="finish";h=desknets.Resource.enq.finish;break;default:g="";h=""}c=desknets.tmpl.replaceWord(c,"status_cls",g);c=desknets.tmpl.replaceWord(c,"status_text",h)}else{if(j==="cretime"||j==="entrydate"){h=desknets.dateTime.dispDateTime(f[j],{type:"list"});c=desknets.tmpl.replaceWord(c,j,h)}else{if(j==="period"){h="";h=desknets.dateTime.dispDateTime(f[j],{type:"list"});var d=f.perioddays;var e=f.periodalert=="1";if(!neo.isSet(d,{blank:false})){}else{if(d=="0"){h+=" ";if(e){h+='<span class="enq-closedate-alert">'}h+="("+desknets.Resource.enq.byToday+")";if(e){h+="</span>"}}else{h+=" ";if(e){h+='<span class="enq-closedate-alert">'}h+="("+d+desknets.Resource.enq.daySymbol+")";if(e){h+="</span>"}}}c=desknets.tmpl.replaceWordHtml(c,j,h)}else{return null}}}}return c},ajaxFormatGet:function(f,g,c){var d=desknets.getUrl(desknets.enq.MODULE_API_ENQUETE);var e={cmd:desknets.enq.CMD_ENQFORMATPREVIEW,id:f};desknets.ajax.rest({id:c,url:d,data:e,type:"POST",success:g})},ajaxUserFormatGet:function(f,g,c){var d=desknets.getUrl(desknets.enq.MODULE_API_ENQUETE);var e={cmd:desknets.enq.CMD_ENQUSERFORMATPREVIEW,id:f};desknets.ajax.rest({id:c,url:d,data:e,type:"POST",success:g})},getAttExtListCmd:function(c){return"enq"+c},banpei:null}})(jQuery);(function(b){desknets.page(desknets.enq,"subwin",desknets.PageSubwinSearch,{init:function(){var d=b(".jco-subwindow-search");this._buildSubjectList(d);var e=desknets.paramanalyzer.getHashParams();d.find("input[name=srch_key]").val(e.srch_key);if(!!e.sw_subject){d.find("select[name=sw_subject]").val(e.sw_subject)}if(!!e.sw_status){d.find("select[name=sw_status]").val(e.sw_status)}d.find("input[name=sw_entry]").val(e.sw_entry);if(!!e.sw_important){d.find("select[name=sw_important]").val(e.sw_important)}d.find("input[name=sdate]").val(e.sdate);d.find("input[name=edate]").val(e.edate);var c=this;c.callBase("_initSearch");desknets.htmlparts.setUpForm(c.$_inputArea)},_buildSubjectList:function(e){var d=this;var f="";var c=e.find('select[name="sw_subject"]').children();b.each(c,function(g,h){if(b(h).data("type")=="usr"){f=desknets.Resource.shortprivate+" "+b(h).html();b(h).html(f)}})},_getSearchPrm:function(e){var c=this;var d=c.$_inputArea;e.fldsort="entrydate";e.order="-1";e.row="0";e.srch_key=d.find("input[name=srch_key]").val();e.sw_subject=d.find("select[name=sw_subject]").val();e.sw_status=d.find("select[name=sw_status]").val();e.sw_entry=d.find("input[name=sw_entry]").val();e.sw_important=d.find("select[name=sw_important]").val();e.sdate=d.find("input[name=sdate]").val();e.edate=d.find("input[name=edate]").val();return e},_execClear:function(){var c=this;c.callBase("_execClear");c.$_inputArea.find('select[name="sw_subject"]').val("");c.$_inputArea.find('select[name="sw_status"]').val("-1");c.$_inputArea.find('select[name="sw_important"]').val("0")},_chkInputSearchRequired:function(){var d=this.$_inputArea;var e="";var c=["[name=srch_key][value!=]","[name=sw_subject][value!=]","[name=sw_status][value!=-1]","[name=sw_entry][value!=]","[name=sw_important][value!=0]","[name=sdate][value!=]","[name=edate][value!=]"];if(d.find(c.join(",")).length==0){e=desknets.Resource.Message.com_search_nokey;desknets.dialog.alert(e,{type:"warn"});return false}return this.callBase("_chkInputSearchRequired")},_getMainCmd:function(){return desknets.enq.CMD_ENQSEARCHINDEX},_getSearchCmd:function(){return desknets.enq.CMD_ENQSEARCHPAGE}})})(jQuery);desknets.page(desknets.enq,"folderlist",desknets.tree,{_selectFirstItem:function(d){var b=this;var c;var e="recv-yet";c=d.find("li.co-listview-item[data-fid="+e+"]").eq(0);b.onSelectItemNoAjax(b.$_root,e);b._onSelectItem(null,c.children("a:first"))},banpei:null});(function(b){desknets.page(desknets.enq,"RouteSelectDialog",null,{_dialogId:"jenq-route-select-dialog",_inputFieldName:"route-id",$dialog:null,options:{},_options:{onOk:null,onCancel:null},_TMPL_DIALOG:"enq/enq.routeSelectDialog.html",_DIALOG_TITLE:desknets.Resource.enq.routeSelectDialogTitle,init:function(c){this.destroy();this.options=b.extend({},this._options,c)},destroy:function(){if(this.$dialog){this.$dialog.dialog("destroy");this.$dialog=null}b("#"+this._dialogId).remove();this.options={}},open:function(){if(this.$dialog==null){this.$dialog=b("<div />").attr("id",this._dialogId).appendTo(document.body)}if(this._isContentsIncomplete()){desknets.tmpl.load(this.$dialog,this._TMPL_DIALOG,b.proxy(function(){desknets.dialog.setUp(this.$dialog,this._getDialogOptions());this._buildContents();this.$dialog.dialog("open");desknets.dialog.setFirstDialogOpen(this.$dialog)},this),{})}else{this.$dialog.dialog("open").find('input[type="button"]').blur();this.$dialog.find(":checkbox:checked").attr("checked",false)}return this.$dialog},_buildContents:function(){this._ajaxRouteListGet()},_isContentsIncomplete:function(){return !this.$dialog||this.$dialog.find("tbody").children().length==0},_ajaxRouteListGet:function(){var c=desknets.getUrl(desknets.enq.MODULE_API_ENQUETE);var d={};d["0"]={cmd:desknets.enq.CMD_ENQROUTELIST,row:"0",order:"1"};d["1"]={cmd:desknets.enq.CMD_ENQUSERROUTELIST,row:"0",order:"1"};arPrm=desknets.ajax.arrayToMultiCmdData(d);desknets.ajax.rest({id:this._dialogId,url:c,data:arPrm,type:"POST",success:b.proxy(function(g,f,i){var e=g["0"].list;var h=g["1"].list;this._updateRouteTable(e,h)},this)})},_ajaxRouteDetailGet:function(g,d){var e=[],h=[];b.each(g,function(i,j){var k=j.routeType;var l=j.routeId;if(k=="pub"){e.push(l)}else{h.push(l)}});var c=desknets.getUrl(desknets.enq.MODULE_API_ENQUETE);var f={};f.cmd=desknets.enq.CMD_ENQROUTESELECT;f.id=e;f.pid=h;desknets.ajax.rest({url:c,data:f,type:"POST",success:d})},_updateRouteTable:function(d,e){var f=[];var h;var g=this._inputFieldName;h=d.item==null?[]:d.item;h=b.isArray(h)?h:[h];b.each(h,function(i,j){f[f.length]='<tr><td class="co-chk"><input type="checkbox" name="'+g+'"';f[f.length]=' value="pub:'+j.id+'"></td>';f[f.length]="<td>"+desknets.tmpl.escapeWord(j.Name)+"</td></tr>"});h=e.item==null?[]:e.item;h=b.isArray(h)?h:[h];b.each(h,function(i,j){f[f.length]='<tr><td class="co-chk"><input type="checkbox" name="'+g+'"';f[f.length]=' value="usr:'+j.id+'"></td>';f[f.length]="<td>"+desknets.tmpl.escapeWord(j.Name+desknets.Resource.setprivate)+"</td></tr>"});var c=this.$dialog.find("tbody");c.empty();c.html(f.join(""));desknets.htmlparts.addStripeClass(c,"co-tr-even");this.$dialog.find(".jenq-nodata").toggle(f.length<=0);this.$dialog.find(".co-table-list-scroll").toggle(f.length>0)},_onClickOk:function(d){var c=this;var f=this._getSelected();if(f==null){}if(!!this.options.onOk){if(f!=null){this._ajaxRouteDetailGet(f,function(g,e,h){c.options.onOk(g)})}else{c.options.onOk(null)}}this.$dialog.dialog("close")},_onClickCancel:function(c){if(!!this.options.onCancel){this.options.onCancel(c)}this.$dialog.dialog("close")},_onAjaxLoadRoute:function(d,c,e){this._updateRoute(d)},_getDialogOptions:function(){var c=this;var f={};f[desknets.Resource.OKButtonLabel]=b.proxy(this._onClickOk,this);f[desknets.Resource.CancelButtonLabel]=b.proxy(this._onClickCancel,this);var e=desknets.dialog.getDialogOption();var d={buttons:f,dialogClass:"dn-dialog",resizable:false,draggable:true,title:this._DIALOG_TITLE,width:"500",height:"auto",close:function(){neo.ajax.abort(c._dialogId,true)}};b.extend(e,d);return e},_getSelected:function(){var d=[];var c=this.$dialog.find("input[name="+this._inputFieldName+"]:checked").closest("tr");if(c.length<=0){return null}b.each(c,function(f,j){var i=b(j);var k=b(j).find(":checked").val();var h=new RegExp("(pub|usr):([0-9]*)");k.match(h);var g=RegExp.$1;var l=RegExp.$2;var e=i.text();d.push({routeType:g,routeId:l,routeName:e})});return d.length?d:d},banpei:null})})(jQuery);desknets.page(desknets.enq,"NoticeUnconfirmUserDialog",desknets.NoticeUnconfirmUserDialog,{initSetupDialog:function(){return"enq/enq.noticeUnconfirmUserDialog.html"},initSetupTitle:function(){return desknets.Resource.enq.noticeUnconfirmUserDialogTitle},_getUrl:function(){var b=this;return desknets.getUrl(desknets.enq.MODULE_API_ENQUETE)},_loadUnconfirmUsersPrm:function(){var b=this;var c={};c.cmd=desknets.enq.CMD_ENQROUTE;c.id=b.id;c.srchanswer="2";c.srchdeluser="1";c.num=desknets.enq.MAXNUM;return c},_noticeSendPrm:function(){var c=this;var d={};var b=[];d.cmd=desknets.enq.CMD_ENQUNCONFIRMNOTICE;d.id=c.id;d.sendhowto=c._updateToContactWith();d.subject=c.$dialog.find('input[name="subject"]').val();d.memo=c.$dialog.find("textarea").val();c.$dialog.find(".co-selitem").each(function(){b[b.length]=a(this).find('input[name="uid"]').val()});d.uid=b;return d},_noticeSendMsg:function(){var b=this;return desknets.Resource.Message.enq_notice_success},});desknets.page(desknets.enq,"EnqInputBase",desknets.PageInputBase,{format:desknets.form.FormEditor.prototype,_restUrl:"",getMultiRequest:function(){var e={};var b=desknets.paramanalyzer.getHashParams();var d=b.id;if(!neo.isSet(d)){d=b.copyid}if(!neo.isSet(d)){d=""}b.tmpno=this.getTempName();e["0"]=b;e["1"]={cmd:this.getFormPartListCmd(),tmpno:this.getTempName(),id:d};var c=desknets.attach.ext.getListParam();if(!!c){c.cmd=desknets.enq.getAttExtListCmd(c.cmd);e["2"]=c}return e},_initSet:function(d){var c=this;var b=[];if(d[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(d[1]["errorno"],d[1]["errormessage"]);return}if(!!d&&d["1"]){b=desknets.ajax.getJsonItems(d["1"])}c._setUpFormatEditor(b);if(!!d&&d["2"]){desknets.attach.ext.saveList(d["2"])}this._setTmpNm();c.$mjPage.find(".jenq-input-add-submit").click(function(e){c._inputEnqSubmit(e,true)});c.$mjPage.find(".jenq-input-mod-submit").click(function(e){c._inputEnqSubmit(e,false)});c.callBase("_initSet",d)},_inputEnqSubmit:function(d,e){var b=this;var c={cmd:desknets.enq.CMD_ENQEDITFORMATSETSORT,tmpno:b.getTempName(),values:b._getFormRequestParams()};desknets.ajax.rest({url:b._getRestUrl(),data:c,success:function(f){if(e){b._inputAddSubmit(d)}else{b._inputModSubmit(d)}b.$mjPage.find("form").submit()}})},_setTmpNm:function(){var b=this;b.$mjPage.find('input[name="tmpno"]').val(b.getTempName())},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.beforeSerialize=function(d,e){var f={format:b._getFormRequestParams(),};e.data=a.extend(f,e.data)};return c},_inputButton:function(){this.callBase("_inputButton");var b=this;b._inputButtonPreview()},_inputButtonPreview:function(){var b=this;this.$mjPage.find(".jenq-preview").hide();this.$mjPage.find(".jform-input-preview").click(function(){b._startPreview()});this.$mjPage.find(".jform-input-preview-end").click(function(c){c.preventDefault();b._endPreview()})},_getRestModule:function(){return desknets.enq.MODULE_API_ENQUETE},_getModExecCmd:function(){var b=this;return b._getAddExecCmd()},getFormPartListCmd:function(){return""},getFormPartListCmd:function(){return desknets.enq.CMD_ENQEDITFORMAT},getTempName:function(){return""},getFormatOptionsForParams:function(){var j=this;var h=desknets.paramanalyzer.getHashParams();var g=this.getTempName();var d=desknets.getUrl(desknets.enq.MODULE_ENQUETE);var e=d+"?cmd="+desknets.enq.CMD_ENQTMPFILEDISPATTACH;var c=d+"?cmd="+desknets.enq.CMD_ENQEDITFORMATDISPTMPATTACH;var i=desknets.getUrl(desknets.enq.MODULE_ENQUETE)+"?cmd="+desknets.enq.CMD_ENQEDITFORMATDISPTMPATTACH+"&fno={{id}}&filename={{name}}";var f={uploadURL:this._getRestUrl(),uploadParams:{cmd:desknets.enq.CMD_ENQEDITFORMATADDATTACH},delURL:this._getRestUrl(),delParams:{cmd:desknets.enq.CMD_ENQEDITFORMATDELATTACH},downloadURL:c+"&tmpnm={{tmpnm}}&fno={{id}}&filename={{name}}",};var b=j.gettotalSizeLimit();if(!!b){f.totalSizeLimit=Number(b)}return{attachOptions:f,paramsForSave:{tmpno:g,cmd:desknets.enq.CMD_ENQEDITFORMATPARTENTRY},paramsForRemove:{tmpno:g,cmd:desknets.enq.CMD_ENQEDITFORMATPARTDEL},paramsForOpen:{tmpno:g,cmd:"enqcmdeditformatpart"},attachDownloadURL:e+"&tmpno="+g+"&id={{id}}&fno={{fno}}&filename={{name}}"}},_setUpFormatEditor:function(d){var c=this;var b=a(c._setUpFormatEditorArea());var e=a.extend({restUrl:this._getRestUrl(),parts:d},this.getFormatOptionsForParams());this.format=new desknets.form.FormEditor(b,e)},gettotalSizeLimit:function(){var b=this;return b.$mjPage.find('input[name="attach-totalSizeLimit"]').val()},_setUpFormatEditorArea:function(){return"#enq-edit-format"},_getFormRequestParams:function(){var b=[],c=this.format.getParts();a.each(c,function(f,d){if(!!d.id){var e=d.br||"0";b.push(d.id+":"+e)}});return b},_startPreview:function(){var b=this,c=[];c.push({cmd:desknets.enq.CMD_ENQEDITFORMATSETSORT,tmpno:this.getTempName(),values:this._getFormRequestParams()});c.push({cmd:desknets.enq.CMD_ENQEDITFORMATPREVIEW,formType:"1",tmpno:this.getTempName()});desknets.ajax.rest({url:this._getRestUrl(),data:desknets.ajax.arrayToMultiCmdData(c),success:function(d){b._showPreview(d)}})},_showPreview:function(c){this.$mjPage.find(".enq-view-detail-in").html(c["1"].html);this.$mjPage.find(".jenq-editor").hide();this.$mjPage.find(".jenq-preview").show();desknets.moveScroll();var b=a("#enq-m-title").text()+a("#jco-m-sub-title").text()+" > "+this.$mjPage.find(".jenq-title-edit").val()+" > "+desknets.Resource.preview;a("#jco-m-sub-title").text(b)},_endPreview:function(){this.$mjPage.find(".jenq-preview").hide();this.$mjPage.find(".jenq-editor").show();desknets.moveScroll();this._setTitle(this._getAreaTitle(this.$mjPage))},_getRestUrl:function(){if(!this._restUrl){this._restUrl=desknets.getUrl(this._getRestModule())}return this._restUrl}});(function(b){desknets.page(desknets.enq,"enqindex",desknets.PagePaneListBase,{_tmplFolderTitle:"{{foldername}}",_folderCfg:[],_tmplTableHead:[],_tmplTableBody:[],$_elTmpls:b("#jenq-list-table-tmpls").remove(),_cmdNo:null,_loginuid:null,init:function(){var c=this;c.callBase("init");c.$mjListPage.find(".jco-list-del-submit").unbind();c.$mjListPage.find(".jco-list-del-submit").click(function(d){c._onClickDel(d)});c.$mjListPage.find(".jco-list-unread-submit").click(function(d){c._onClickUnread(d)});c.$mjListPage.find(".jco-list-finish-submit").click(function(d){c._onClickFinish(d)})},_getDelAddPrm:function(){var d={};var c=this.getListParamToObj();if(this.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){d.lcmd=c.cmd;d.type=c.type;d.sts=c.sts}if(this._cmdNo==desknets.enq.CMD_ENQFINISH){}else{if(this._cmdNo==desknets.enq.CMD_ENQLISTREAD){}else{if(this._cmdNo==desknets.enq.CMD_ENQDRAFTDEL){}else{if(this._cmdNo==desknets.enq.CMD_ENQLISTDEL){}else{if(this._cmdNo==desknets.enq.CMD_ENQDEL){}}}}}return d},_delNoChkMessage:function(){if(this._cmdNo==desknets.enq.CMD_ENQFINISH){return desknets.Resource.Message.enq_finish_nochecked}else{return this.callBase("_delNoChkMessage")}},_setDelConfirm:function(f){if(this._cmdNo==desknets.enq.CMD_ENQDRAFTDEL||this._cmdNo==desknets.enq.CMD_ENQLISTDEL||this._cmdNo==desknets.enq.CMD_ENQDEL){var c=this;var d;var e=this._getFolderId();d=desknets.dialog.confirm(f,function(){c._listDel(true,d);return false});return}return this.callBase("_setDelConfirm",f)},_getListAjaxSuccess:function(f){var d=this;var g;var i=this._makeFolderId(f.type,f.sts);var c=this._getFolderCfg(i);var e=this.$mjListPage.find(".co-actionarea>:button,.co-actionarea>.line");e.filter(":button.jco-list-add-page").toggle(true);e.filter(":button.jco-list-unread-submit").toggle(jQuery.inArray("unreadable",c.pageClass)!=-1);e.filter(":button.jco-list-finish-submit").toggle(jQuery.inArray("finishable",c.pageClass)!=-1);e.filter(":button.jco-list-del-submit").toggle(jQuery.inArray("deleteable",c.pageClass)!=-1);e.filter(".line").each(function(l,n){var k=b(n);var m=function(){return b(this).css("display")!="none"};k.toggle(k.prevAll().filter(m).eq(0).is(":button")&&k.nextAll().filter(m).eq(0).is(":button"))});var h=c.listTableCssClass;this.$mjListPage.find(".co-table-list").removeClass("recv send draft").addClass(h);var j="";if(c.type=="0"){j="enq-list-recv"}else{if(c.type=="2"){j="enq-list-send"}else{if(c.type=="3"){j="enq-list-draft"}}}d.$mjListPage.removeClass("enq-list-recv enq-list-send enq-list-draft").addClass(j);g=this._getTmplTableHeadHtml(i);this.$mjListPage.find(".co-table-list thead").html(g);g=this._getTmplTableBodyHtml(i);this._mcListTemplate=g;this._resetInitWidthPrm();this.callBase("_getListAjaxSuccess",f)},_listLine:function(e,f){var d=this;var c="";if(typeof f=="object"){var h;var g="";if(f.unread==="1"&&this._getFolderId().indexOf("recv")==0){g+="enq-tr-unread"}e=desknets.tmpl.replaceWordHtml(e,"enq-tr",g)}e=d.callBase("_listLine",e,f);return e},_replaceListLine:function(e,i,g){var d=this;var c;var h=desknets.paramanalyzer.getHashParams();var f=h.folder||this._getFolderId();c=desknets.enq.replaceEnqListLine(e,i,g,f);if(c){return c}return d.callBase("_replaceListLine",e,i,g)},getListParamToObj:function(){var e,d;e=this.callBase("getListParamToObj");d=e.folder;if(d!=null&&d!=""){delete e.folder;var c=this._getFolderCfg(d);e.type=c.type;e.sts=c.status}return e},_initListStartModLink:function(){},_hashUpdatePageView:function(d){var c=this;if(d==desknets.enq.CMD_ENQSEARCHPAGE){desknets.enq.searchindex.initPage(desknets.enq.PAGE_ENQINDEX,"jco-m-list-container");c.mhashBackErrCmd=c.mhashBackCmd;c.mhashIdErrBack=c.mhashIdBack;c.mhashBackCmd=d;c.mhashIdBack="jco-m-search-container"}else{if(d==desknets.enq.CMD_ENQSEARCHDISPPAGE){desknets.enq.searchdisp.initPage(c.mhashBackCmd,c.mhashIdBack)}}},_getSizeHideWidth:function(){return"100"},_getRestModule:function(){return desknets.enq.MODULE_API_ENQUETE},_getListCmd:function(){return desknets.enq.PAGE_ENQINDEX},_getListExecCmd:function(){var c=this._getFolderId();if(c==desknets.enq.DRAFT_FOLDER_ID){return desknets.enq.CMD_ENQDRAFTINDEX}return desknets.enq.CMD_ENQINDEX},_getMoveListConfCmd:function(){return null},_getMoveListCmd:function(){return desknets.enq.CMD_ENQLISTMOVE},_getListDispCmd:function(){return desknets.enq.CMD_ENQDISPPAGE},_getDispPageParam:function(){var d=this._getFolderId();var c=this._getFolderCfg(d).type;return{type:c}},_getListAddCmd:function(){return desknets.enq.CMD_ENQENTRYPAGE},_getListModCmd:function(){return desknets.enq.CMD_ENQDRAFTPAGE},_getDelExecCmd:function(){return this._cmdNo},_getDelCmd:function(){if(this._cmdNo==desknets.enq.CMD_ENQFINISH){return desknets.enq.CMD_ENQFINISHCONF}else{if(this._cmdNo==desknets.enq.CMD_ENQLISTDEL){return desknets.enq.CMD_ENQLISTDELCONF}}return""},_getListEntryClass:function(){return desknets.enq.enqentry},_getListModClass:function(){return desknets.enq.enqentry},_getListDispClass:function(){return desknets.enq.enqdisp},_setTitlePane:function(c){this.callBase("_setTitlePane",c)},_isMoveListItems:function(){return false},_getSpliterAddOpt:function(){var c,d;c=this.callBase("_getSpliterAddOpt");d={initClosed:false};return b.extend({},c,d)},initLeftTree:function(){var c=this;desknets.enq.folderlist.init(c.$mjListPage,c._getOptionLeftTree(),c._optTreeGetCmd())},_optTreeIsEdit:function(){return false},_optTreeSelectFunc:function(d){var c=d.data("fid");this.resetSortCondition(c);this.callBase("_optTreeSelectFunc",d)},treeUpdateList:function(){var c=this;c._boupdate=false},treeUpdateListWidth:function(){desknets.enq.folderlist._updateItemsWidth()},_updateRightListWidth:function(){this.callBase("_updateRightListWidth");desknets.listviewframe.updateListScrollWidth(this.$mjListPage)},_resetInitWidthPrm:function(){var d,c;d=this.$mjListPage.find("table.co-table-list>thead").closest("table");d.css("width","auto");c=this.$mjListPage.find("table.co-table-list>thead>tr>th.jco-listview-widauto").css("width");d.css("width","");c=parseFloat(c);this._initWidthPrm.head=c;this._initWidthPrm.scroll=c},_getLoginUid:function(){if(this._loginuid==null){this._loginuid=desknets.pageframe.getLoginUid()}return this._loginuid},_getFolderId:function(){return this.$mjListPage.find(".jco-back-page-data").find(":hidden[name=folder]").val()},_makeFolderId:function(d,c){switch(d){case"0":switch(c){case"-1":return"recv";case"0":return"recv-yet";case"3":return"recv-done";default:throw new Error("failed. type:"+d+" status:"+c)}case"2":switch(c){case"-1":return"send";case"0":return"send-open";case"1":return"send-close";default:throw new Error("failed. type:"+d+" status:"+c)}case"3":return"draft"}throw new Error("failed. type:"+d+" status:"+c)},_getFolderCfg:function(j){if(this._folderCfg[j]){return this._folderCfg[j]}var h=null;var d=null;var i=null;var e=null,g=null;var c=null;var f=[];if(j.indexOf("recv")==0){h="0";i="recv";e="cretime";g="-1";c="jenq-recv-list";if(j=="recv"){d="-1";f=["unreadable","deleteable","finishable"]}else{if(j=="recv-yet"){d="0";f=["unreadable","finishable"]}else{if(j=="recv-done"){d="3";f=["unreadable","deleteable","finishable"]}}}}else{if(j.indexOf("send")==0){h="2";i="send";e="entrydate";g="-1";c="jenq-send-list";if(j=="send"){d="-1";f=["deleteable","finishable"]}else{if(j=="send-open"){d="0";f=["deleteable","finishable"]}else{if(j=="send-close"){d="1";f=["deleteable"]}}}}else{if(j.indexOf("draft")==0){h="3";d="";i="draft";e="entrydate";g="-1";c="jenq-draft-list";f=["deleteable"]}else{if(j!=null&&j!=""){throw new Error("invalid folder. ["+j+"]")}}}}this._folderCfg[j]={type:h,status:d,listTableCssClass:i,defSortField:e,defSortOrder:g,tmplTableClass:c,pageClass:f};return this._folderCfg[j]},_getTmplTableHeadHtml:function(d){var c=this._tmplTableHead[d]||this.$_elTmpls.find("."+this._getFolderCfg(d).tmplTableClass+":first thead").html();return c},_getTmplTableBodyHtml:function(d){var c=this._tmplTableBody[d]||this.$_elTmpls.find("."+this._getFolderCfg(d).tmplTableClass+":first tbody").html();return c},_onClickDel:function(c){var d=this._getFolderId();if(d==desknets.enq.DRAFT_FOLDER_ID){this._cmdNo=desknets.enq.CMD_ENQDRAFTDEL}else{if(d.indexOf(desknets.enq.SEND_FOLDER_ID)==0){this._cmdNo=desknets.enq.CMD_ENQDEL}else{this._cmdNo=desknets.enq.CMD_ENQLISTDEL}}this._listDelSubmit(c)},_onClickFinish:function(c){this._cmdNo=desknets.enq.CMD_ENQFINISH;this._listDelSubmit(c)},_onClickUnread:function(c){this._cmdNo=desknets.enq.CMD_ENQLISTUNREAD;this._listDel(true,null)},_onClickTableRecord:function(d){var f=this._getFolderId();var c=b(d.target).closest("tr").find(".jco-id").val();switch(d.type){case"click":case"dblclick":if(f==desknets.enq.DRAFT_FOLDER_ID){this.inputModPage(c)}else{this.inputDispPage(c)}break;default:break}},resetSortCondition:function(d){if(d==this._getFolderId()){return}var c=this._getFolderCfg(d).defSortField;var e=this._getFolderCfg(d).defSortOrder;this.$mjListPage.find(".jco-back-page-data").find(":hidden[name=fldsort]").val(c);this.$mjListPage.find(".jco-back-page-data").find(":hidden[name=order]").val(e)},_initListSetSort:function(){var c=this;c.$mjListPage.find(".co-list-sort-data").click(function(f){f.preventDefault();var e="";var d=b(this);if(d.hasClass("asc")){e=-1}else{if(d.hasClass("desc")){e=1}else{if(d.data("def")=="desc"){e=-1}else{e=1}}}c._listPageSort(d.data("sort"),e)})},banpei:null})})(jQuery);desknets.page(desknets.enq,"enqformatentry",desknets.enq.EnqInputBase,{mboInit:false,$mjMain:null,init:function(e){var b=this;b.boautosave=e.autosave;if(b.mboInit==false){b.mboInit=true;b.initGetPageId();b._initSet()}var g={};var c={};var f={};f.cmd="enqcmdeditformatcopytemp";f.tmpno=b.getTempName();f.tmpfrom=b.getTempNameEntry();f.tmpto=b.getTempName();var d={};d.cmd="enqcmdeditformat";d.tmpno=b.getTempName();c["0"]=f;c["1"]=d;g.success=function(h){if(h[0]["status"]!=desknets.RES_STATUS_SUCCESS){b.onError(h[0]["errorno"],h[0]["errormessage"])}else{if(h[1]["status"]!=desknets.RES_STATUS_SUCCESS){b.onError(h[1]["errorno"],h[1]["errormessage"])}else{if(b.boautosave){desknets.autosave.formatsave()}b._initSetEnq(h)}}};b._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,c,g)},initGetPageId:function(){var b=this;b.$mjPage=a(".jenq-entry-form-area");b.$mjMain=a(".jenq-entry-main-area")},_initSet:function(){var b=this;desknets.moveScroll();b._initPageEnterKeysSubmitFormCancel();b._inputButton()},_initSetEnq:function(e){var d=this;var c=d.$mjPage.find(".co-setarea");c.empty();d.$mjPage.find(".jenq-tmpl-preview-format").tmpl({}).appendTo(c);var b=[];if(!!e&&e["1"]){b=desknets.ajax.getJsonItems(e["1"])}d._setUpFormatEditor(b)},_inputButton:function(){var b=this;b.callBase("_inputButton");b.$mjPage.find(".jenq-input-edit-ok").click(function(){desknets.enq.enqentry.boformChanged=true;b.setUpEntryPage()});b.$mjPage.find(".jenq-input-edit-cal").click(function(){b.$mjMain.show();b.$mjPage.hide()})},setUpEntryPage:function(e){var c=this;var g={};var d={};var b={};b.cmd="enqcmdeditformatsetsort";b.tmpno=c.getTempName();b.values=c._getFormRequestParams();var f={};f.cmd="enqcmdeditformatsave";f.tmpno=c.getTempName();f.tmpfrom=c.getTempName();f.tmpto=c.getTempNameEntry();d["0"]=b;d["1"]=f;d["2"]=desknets.enq.enqentry.getFormatPrm();g.success=function(h){if(h[0]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(h[0]["errorno"],h[0]["errormessage"])}else{if(h[1]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(h[1]["errorno"],h[1]["errormessage"])}else{if(h[2]["status"]!=desknets.RES_STATUS_SUCCESS){c.onError(h[2]["errorno"],h[2]["errormessage"])}else{desknets.enq.enqentry.replacePreview(h[2]["html"]);c.$mjMain.show();c.$mjPage.hide()}}}};c._sendRequestAjax(desknets.ajax.REQTYPE_MULTI,desknets.ajax.RESTYPE_JSON,d,g)},getTempName:function(){return"enqupdent"},getTempNameEntry:function(){return desknets.enq.enqentry.getTempName()},gettotalSizeLimit:function(){var b=this;return b.$mjMain.find('input[name="attach-totalSizeLimit"]').val()},});desknets.page(desknets.enq,"enqentry",desknets.enq.EnqInputBase,{_routeSelectDialog:desknets.enq.RouteSelectDialog,_routeUserChooser:null,boformChanged:false,_initSet:function(c){var b=this;b.callBase("_initSet",c);b.boformChanged=false;desknets.enq.enqformatentry.mboInit=false;b.$mjPage.find(".jenq-entry-main-area").show();b.$mjPage.find(".jenq-entry-form-area").hide();b.$mjPage.find(".jenq-preview").hide();this.$mjPage.find("#jenq-format-edit-button").click(function(){b.$mjPage.find(".jenq-entry-main-area").hide();b.$mjPage.find(".jenq-entry-form-area").show();var d={autosave:false};if(b.boautosave){d.autosave=true}desknets.enq.enqformatentry.init(d)});b.makeNameGrpSelset();b._setUpApplicate();b.setUpRoute();b.setUpFormat();desknets.htmlparts.setUpForm(this.$mjPage.find("#inputfrm"));if(desknets.pageframe.getMailUse()!="1"){b.$mjPage.find(".jenq-input-mail").hide();b.$mjPage.find('[name="endmail"]').val("1")}if(this._idResendMode()){this.$mjPage.find("#jenq-route-sel-items-area .co-select-menu").hide();this.$mjPage.find("#jenq-route-sel-items-area .co-selitem>.co-btn-close").hide()}this.$mjPage.find(".jenq-input-confirm").click(function(d){b._ajaxConfirmTmplGet()});b._initMessageArea()},_inputButtonPreview:function(){},active:function(){var c=this;desknets.submitform.clearDisabled(this.$mjPage.find("form"));this._setTitle(this._getAreaTitle(this.$mjPage));this.$mjPage.show();desknets.moveScroll();c._initBeforeUnload();var d=function(){return c.funcBeforeHashChange()};var b=a(window).data("hashobserver");if(b){b.beforeHashChangeFunc=d}},getTempName:function(){return"enqrpent"},_inputAjaxFormOption:function(){var b=this;var c=b.callBase("_inputAjaxFormOption");c.beforeSerialize=function(d,e){var f={format:b._getFormRequestParams(),};if(b.$mjPage.find("input[name=cmd]").val()==b._getAddExecCmd()){if(b.$mjPage.find("[name=makename]").val()==""){f.makename=b.$mjPage.find(".co-watermark").text();b.$mjPage.find("[name=makename]").attr("disabled","disabled")}}e.data=a.extend(f,e.data)};c.success=function(f,d,g){if(b.mBackCmd==desknets.enq.CMD_ENQSEARCHPAGE){desknets.enq.searchindex._onSrchExec=true}if(!!f.noticeerror){var h={extraMessage:f.noticeerror,extraClass:"co-msg-r",type:"warn"};var e=desknets.dialog.alert(f.msg,h);e.bind("dialogclose",function(i){desknets.dialog.deleteById("warn");b._setLocationHashForm();desknets.enq.enqconfirm.destroy()})}else{b._setLocationHashForm();desknets.enq.enqconfirm.destroy()}};return c},_onCompleteForm:function(){var b=this;b.$mjPage.find("[name=makename]").removeAttr("disabled");b.callBase("_onCompleteForm")},setUpRoute:function(){var b=this;b.$mjPage.find("#jenq-route-sel-items-area").find(".co-select-menu").bind("change.selectMenu",function(c){var d=a(this).data("value");switch(d){case"select":b._routeSelectDialog.open();break;case"edit":break;default:break}});b._routeUserChooser=b._initRouteUserChooser();b._routeSelectDialog.init({onOk:a.proxy(b._onClickOkOfRouteChooserDialog,b)})},_onClickOkOfRouteChooserDialog:function(c){var b=[],d=[];if(c==null){return}b=this._routeUserChooser.getItems();b=a.merge([],b);d=c.list.item;d=d==null?[]:d;d=a.isArray(d)?d:[d];a.each(d,function(f,e){for(var g=0;g<b.length;g++){if(b[g].id==e.id){return}}var j={};for(var h in desknets.chooser._displayFields){j[h]=e[h]}e.assign=neo.isSet(e.assigngrp)?desknets.chooser.convertAssignedGroups(e.assigngrp.Name):"";j.assign=e.assign;e.description=desknets.chooser.convertUserDescription(j);b.push({id:e.id,type:"user",name:e.Name,summary:neo.isSet(e.assigngrp)?desknets.chooser.convertAssignedGroups(e.assigngrp.Name):"",description:neo.isSet(e.description)?e.description:""})});b=desknets.chooser.Entry.sortLoginUserTop(b);this._routeUserChooser.replaceItems(b)},_initRouteUserChooser:function(){var c=this;var d;var f=this.$mjPage.find("#jenq-route-sel-items-area");var e={chooseTarget:["user"],allGroup:"choosable",choosePrivateGroup:"choosable",unassignGroup:"choosable"};var b=desknets.chooser.getItemsFromElement(f);d=desknets.chooser.setUpEntry(f,b,{dialogID:"jenq-route-user-sel",initCreate:true,dialogOptions:e,extraVars:{user:{keyName:"otherto"}},filter:function(g,h){g=desknets.chooser.Entry.sortLoginUserTop(g);h(g);return false},});return d},_ajaxConfirmTmplGet:function(){var c=this;var b=c.$mjPage.find("#inputfrm");b.formSetUp("validate");if(b.find(".ui-invalid").length>0){return}var e=b.formToArrayEx();e.cmd=desknets.enq.CMD_ENQCONFIRMPAGE;if(this._isDraftMode()){delete e.id}var d=this._inputAjaxFormOption();if(c.$mjPage.find("[name=makename]").val()==""){e.makename=c.$mjPage.find(".co-watermark").text()}a.extend(d,{dataType:desknets.ajax.RESTYPE_JSON,url:desknets.getUrl(this._getRestModule()),data:e,success:function(g,f,h){desknets.moveScroll();c._buildConfirmPage(g.html)},complete:function(h,f,g){}});desknets.ajax.rest(d)},_buildConfirmPage:function(c){var b=this;var d={};d.subject=b.$mjPage.find("[name=subject]").val();d.memo=b.$mjPage.find(".enq-view-detail-in").html();d.important=b.$mjPage.find("[name=important]").val();d.period=b.$mjPage.find("[name=period]").val();d.open=b.$mjPage.find("[name=open]").val();d.anonymouse=b.$mjPage.find(":checked[name=anonymouse]").val();d.endmail=b.$mjPage.find("[name=endmail]").val();d.makename=b.$mjPage.find("[name=makename]").val();if(d.makename==""){d.makename=b.$mjPage.find(".co-watermark").text()}d.routes=[];a.each(b.$mjPage.find("#jenq-route-sel-items-area .co-selitem-text"),function(e,f){d.routes.push({uname:a(f).text()})});b.$mjPage.hide();desknets.enq.enqconfirm.init({tmpl:c,data:d,ok:function(g){var f=b.$mjPage.find("#inputfrm");f.find(":hidden[name=cmd]").val(b._getAddExecCmd());f.submit()},cancel:function(f){desknets.enq.enqconfirm.destroy();b.active()}})},changPage:function(){var b=this;b.callBase("changPage");var c=b.$mjPage.find(".jco-input-makename");desknets.watermark.set(c);c.attr("title","")},makeNameGrpSelset:function(){var b=this;var c=0;var d={mode:"single",selectable:false,chooseTarget:["group"]};desknets.chooser.setUpEntry(a("#jenq-selgrp-area"),[],{dialogID:"jenq-group-sel",initCreate:true,template:"<span>{{Name}}</span>",dialogOptions:d,change:function(){b.$mjPage.find('input[name="makename"]').val(b.$mjPage.find(".enq-entry-makename").text()).blur()},filter:function(e){if(c===e[0]["id"]){delete e[0]["id"]}c=e[0]["id"]}})},setUpFormat:function(){var b=this;b.replacePreview(b.$mjPage.find(".enq-view-detail-in").html())},replacePreview:function(d,b){var c=this;if(b!==true&&c.boautosave){desknets.autosave.formatsave()}var e=c.$mjPage.find(".enq-view-detail-in");e.html(!!d?d:"");if(e.children().length<=0&&!e.text().match(/[^\x20]+/m)){e.html("<p>"+desknets.Resource.Message.enq_selectformat+"</p>")}},_setUpApplicate:function(){var b=this;var d=b.$mjPage.find(".jenq-combox-subject");var c=d.find(".co-combox-item");if(c.length==0){d.find(".co-combox-list").hide()}var e=d.find("input");c.click(function(){var f=a(this);if(b._formObserveisChanged()){desknets.dialog.confirm(desknets.Resource.Message.enq_confirm_subjectChange,function(){b._setUpApplicateSel(f)},{});return}else{b._setUpApplicateSel(f)}});c.each(function(){var f=a(this);if(f.data("type")=="usr"){a(this).html(desknets.Resource.shortprivate+" "+a(this).html())}})},_setUpApplicateSel:function(c){var b=this;var e=b.$mjPage.find(".jenq-combox-subject");var d=e.find(".co-combox-item");var f=e.find("input");f.val(c.attr("title"));d.removeClass("on");c.addClass("on");desknets.popUp.hide(c);b._execSetFormatCmd(c.data("id"),c.data("type"))},_formObserveisChanged:function(){var b=this;if(b.callBase("_formObserveisChanged")){return true}if(b.boformChanged){return true}return false},_execSetFormatCmd:function(f,d){var b=this;var e={};e.cmd=desknets.enq.CMD_ENQSELECTFORMAT;e.id=f;e.tmpno=b.getTempName();if(d=="usr"){e.type="1"}else{if(d=="pub"){e.type="3"}}var c={};c["0"]=e;desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),detectMultiError:true,data:desknets.ajax.arrayToMultiCmdData(c),success:function(h,g,i){b.replacePreview(h["0"].format)},complete:function(i,g,h){},traditional:true})},_initMessageArea:function(){var b=this;var c=b.$mjPage.find(".enq-edit-msgarea");var e=[];var d=[];var h="";var f;var g;c.find(".jenq-edit-msguser").each(function(){var j=a(this).val();var i=a(this).data("type");if(i=="suspended"){e.push(j)}else{if(i=="udel"){d.push(j)}}});f=e.length;if(f>0){h=desknets.Resource.Message.enq_edit_suspensionuser+'<br /><ul class="enq-edit-delmsg">';for(g=0;g<f;g++){h=h+"<li>"+desknets.tmpl.escapeWord(e[g])+"</li>"}h=h+"</ul>"}f=d.length;if(f>0){h=h+desknets.Resource.Message.enq_edit_deleteuser+'<br /><ul class="enq-edit-delmsg">';for(g=0;g<f;g++){h=h+"<li>"+desknets.tmpl.escapeWord(d[g])+"</li>"}h=h+"</ul>"}if(h.length!=""){desknets.pageframe.viewTopMsg(h,"info")}c.empty()},_isDraftMode:function(){var b=this.$mjPage.find(":hidden[name=mode]").val();return b=="draft"},_idResendMode:function(){var b=this.$mjPage.find(":hidden[name=id]").val();return b!=null&&b!=""&&!this._isDraftMode()},AutoSaveOpt:function(c){var b=this;var d=b.callBase("AutoSaveOpt",c);d.module="enq";d.format="enqrpent";d.mod=false;return d},AutoSaveChkConfirm:function(e,c){var b=this;var d=desknets.paramanalyzer.getHashParams();if(!!d.copy&&d.copy=="1"){desknets.autosave.del();desknets.autosave.start()}else{if(d.cmd==desknets.enq.CMD_ENQDRAFTPAGE){if(e.id==d.id){b.AutoSaveChkConfirmAdd(e,c)}else{desknets.autosave.del();desknets.autosave.start()}}else{if(e.id=="0"){b.AutoSaveChkConfirmAdd(e,c)}else{desknets.autosave.del();desknets.autosave.start()}}}},AutoSaveEntry:function(e){var d=this;e=d.callBase("AutoSaveEntry",e);var c=d._routeUserChooser.getItems();c=d.arrayToData(c);var b=[];var f=[];a.each(c,function(g,h){b[b.length]=h.name;f[f.length]=h.description});e.othertoname=b;e.othertodes=f;return e},AutoSaveGetData:function(d){var c=this;c.$mjPage.find('input[name="subject"]').val(d.subject);c.$mjPage.find('select[name="important"]').val(d.important);d.otherto=c.arrayToData(d.otherto);d.othertoname=c.arrayToData(d.othertoname);d.othertodes=c.arrayToData(d.othertodes);var b=[];a.each(d.otherto,function(e,f){b.push({id:f,type:"user",name:d.othertoname[e],description:d.othertodes[e]})});c._routeUserChooser.replaceItems(b);c.$mjPage.find('input[name="makename"]').val(d.makename).blur();c.$mjPage.find(".jco-input-period").datepicker("setDate",neo.dateTime.parse(d.period.replace(/\u002D/g,"")));c.$mjPage.find('select[name="endmail"]').val(d.endmail);c.$mjPage.find('select[name="open"]').val(d.open);if(!!d.anonymouse&&d.anonymouse=="1"){c.$mjPage.find("#checkbox_anonymouse").attr("checked","checked")}else{c.$mjPage.find("#checkbox_anonymouse").attr("checked",false)}},AutoSaveGet:function(e,f){var b=this;b.callBase("AutoSaveGet",e,f);var c={};c["0"]=b.getFormatPrm();var d=desknets.ajax.arrayToMultiCmdData(c);desknets.ajax.rest({url:desknets.getUrl(b._getRestModule()),data:d,success:function(h,g,i){if(h["0"]["status"]==desknets.RES_STATUS_SUCCESS){b.parts=desknets.ajax.getJsonItems(h["0"]);b.replacePreview(h["0"].html,true)}},})},getFormatPrm:function(){var b=this;var c={};c.cmd="enqcmdeditformatpreview";c.tmpno=b.getTempName();return c},_getAddExecCmd:function(){if(this._isDraftMode()){return desknets.enq.CMD_ENQDRAFTSEND}else{return desknets.enq.CMD_ENQENTRY}},_getDelExecCmd:function(){return desknets.enq.CMD_ENQDEL},_getModExecCmd:function(){return desknets.enq.CMD_ENQDRAFTENTRY},banpei:null});(function(b){desknets.page(desknets.enq,"enqconfirm",null,{_$page:null,_options:{tmpl:null,data:null,ok:function(c){},cancel:function(c){}},options:{},init:function(c){this.destroy();this.options=b.extend({},this._options,c);this._$page=b("#jenq-m-confirm-page");this._buildPage(this.options.tmpl,this.options.data)},destroy:function(){if(this._$page){this._$page.empty().unbind()}this._$page=null;this.options={}},_buildPage:function(d,e){var c=this;$page=this._$page;b(d).tmpl(e).appendTo($page);b("#jco-m-sub-title").text($page.find(".jco-title").val());if(desknets.pageframe.getMailUse()!="1"){$page.find(".jenq-input-mail").hide()}$page.find(":button.jenq-ok").click(function(f){if(c.options.ok){c.options.ok(f)}});$page.find(":button.jenq-cancel").click(function(f){if(c.options.cancel){c.options.cancel(f)}});$page.show()},banpei:null})})(jQuery);(function(b){desknets.page(desknets.enq,"enqdispfolder",desknets.folderdisp,{_getFirstTreeData:function(d){var c=this;c.copyTree(c._options.listAreaObj,c.$_root);var e=c.$_root.find("."+c._options.itemArea);e.find("ins").remove();c._createSideTree()}})})(jQuery);(function(b){desknets.page(desknets.enq,"enqdisp",desknets.PagePaneDispBase,{_initGetHtml:function(){var d=desknets.paramanalyzer.getHashParams();var c=d.type;this._getDispComponent().init({"$page":this.$mjPage,answerUserId:c==="0"?desknets.pageframe.getLoginUid():null,onCreate:b.proxy(function(){this._initSet()},this),onResize:b.proxy(function(){this._setListviewHeight(this.$mjPage)},this),onExit:b.proxy(function(){this.dispBackListPage()},this),showDelNoticeBtn:c==="0",showDelOrgEnqBtn:c!=="0",search:false,manage:false})},_initSet:function(f){var d=this;var e=[];e[e.length++]='<div class="co-listview co-list-selfolder selmulti">';e[e.length++]='  <div class="co-listview-left ui-layout-west"><!-- 左ペイン --></div>';e[e.length++]='  <div class="co-listview-list ui-layout-center"><!-- 右ペイン --></div>';e[e.length++]="</div>";d.$mjPage.find(".jco-disp-disparea").append(b(e.join("")));var c=d.$mjPage.find(".co-listview-list.ui-layout-center");d.$mjPage.find(".jco-disp-disparea").children(":not(:last)").appendTo(c);b("#jco-m-disp-page").find(".ui-layout-west").html(b("#jco-m-list-container").find(".ui-layout-west").html());b("#jco-m-disp-page").find(".ui-layout-west .co-listview-items").empty();d.initLeftTree();this.callBase("_initSet",null);this._onEditorStart()},_getIdPageForm:function(){return"dispfrm"},initLeftTree:function(){desknets.enq.enqdispfolder.init(this.$mjPage,this._getOptionLeftTree(),this._optTreeGetCmd())},_optTreeSelectFunc:function(d){var c=d.data("fid");desknets.enq.enqindex.resetSortCondition(c);this.callBase("_optTreeSelectFunc",d)},_getSpliterAddOpt:function(){return{initClosed:true}},_getRestModule:function(){return desknets.enq.MODULE_API_ENQUETE},_getDispExecCmd:function(){return desknets.enq.CMD_ENQDISP},_initDispLeftPane:function(){desknets.enq.enqfolderdisp.init()},_getDispComponent:function(){return desknets.enq.enqdispCompo},$_editorForm:null,_formObserveisChanged:function(){return !!this.$_editorForm&&!!this._formObserve_isChanged(this.$_editorForm)},_onEditorStart:function(){this._defFormVals={};this.$_editorForm=this.$mjPage.find("form");this._formObserveSave(this.$_editorForm,this._defFormVals)},_onEditorEnd:function(){this.$_editorForm=null;this._defFormVals={}},dispBackListPage:function(){var c=this;var e=desknets.paramanalyzer.getHashParams();if(neo.isSet(e.bproc)&&e.bproc!=""){desknets.execLocation(desknets.msUrl+desknets.decodeURIComponentNeo(e.bproc))}else{var d=c.getLocationFormParam();if(neo.isSet(d)){c._setLocationHash(d)}}},banpein:null})})(jQuery);(function(b){desknets.page(desknets.enq,"enqdispCompo",null,{loginUid:null,_options:{"$page":null,"answerUserId:":null,onCreate:function(){},onResize:function(){},onExit:function(){},onUpdData:function(){},showDelNoticeBtn:false,showDelOrgEnqBtn:true,search:false,manage:false},options:{},_data:{enq:{id:null,sts:null,replytime:null,entryid:null,open:null,anonymouse:null,deleteable:null},tos:{allcnt:0,row:0,uids:[]},toMap:{}},data:null,$tosTmpl:null,$tos:null,$tosTBody:null,$tosReloadBtn:null,$tosPager:null,$mclosedatedialog:null,$mjPage:null,init:function(d){this.destroy();this.options=b.extend({},this._options,d);this.$mjPage=this.options["$page"];this.data=b.extend({},this._data);var c=this.getMultiRequest();var e=null;c=desknets.ajax.arrayToMultiCmdData(c);e=b.proxy(function(k,j,r){var t=this;var l=[0,1,2,3];for(var m=0;m<l.length;m++){var s=k[l[m]];if(s!=null&&s.status!=desknets.RES_STATUS_SUCCESS){var p=s.errorno,q=s.errormessage;var h=desknets.dialog.alert(q,{errorNo:p});var g=desknets.parseErrorInfo(q,p);var o={close:function(i){desknets.dialog.deleteById(g.level);var f=t.options.onExit;if(f){f()}}};h.dialog(o);return}}this._initSet(k);var n=this.options.onCreate;if(n){n()}setTimeout(b.proxy(function(f){this._updateListviewHeight()},this),500)},this);desknets.ajax.rest({url:desknets.getUrl(this._getRestModule()),data:c,success:function(g,f,h){if(e){e(g,f,h)}},complete:function(h,f,g){}})},destroy:function(){if(this.options["$page"]){this.options["$page"].empty().unbind()}this.loginUid=null;this.data=null;this.$tosTmpl=null;this.$tos=null;this.$tosTBody=null;this.$tosReloadBtn=null;this.$tosPager=null;this.options={};if(self.$mclosedatedialog!=null){self.$mclosedatedialog.dialog("destroy");self.$mclosedatedialog=null}},isManageMode:function(){return this.options.manage},isSearchMode:function(){return this.options.search},_getLoginUid:function(){return this.loginUid||(this.loginUid=desknets.pageframe.getLoginUid())},_getAnswerUserId:function(){return this.options.answerUserId},_getResultsPerPage:function(){return this.$mjPage.find("input[name=num]").val()},_getEnqueteId:function(){return this.data.enq["id"]},_getAuthorUid:function(){return this.data.enq["entryid"]},_isFinishedEnquete:function(){return this.data.enq["sts"]=="4"||this.data.enq["sts"]=="6"},_isReplied:function(){return !!this.data.enq["replytime"]},isOpen:function(){return this.data.enq["open"]=="1"},isAnonymouse:function(){return this.data.enq["anonymouse"]=="1"},_isDeleteable:function(){return this.data.enq["deleteable"]=="1"},_setEnqueteData:function(d){var c=this.data.enq;for(var e in c){c[e]=d[e]}},_normalizeToData:function(c){},_clrTos:function(){var c=this.data;c.tos["allcnt"]=0;c.tos["row"]=0;c.tos["uids"]=[];c.toMap={}},_setTos:function(f){var d=this;var e=this.data;var c;c=f.list["item"];if(c==null){c=[]}else{if(!b.isArray(c)){c=[c]}}e.tos["allcnt"]=f.allcnt;e.tos["row"]=f.row;b.each(c,function(h,j){var g=j.uid;e.tos["uids"].push(g);d._normalizeToData(j);e.toMap[g]=j})},_pageOfTos:function(c){var d=this._getResultsPerPage();var f=desknets.paramanalyzer.getHashParams();f.row=(c-1)*d;var e=this.$mjPage.find('[name="srchanswer"]').val();if(e==="1"||e==="2"){f.srchanswer=e}else{f.srchanswer="0"}desknets.paramanalyzer.setLocationHash(f)},_updateTosPager:function(e,f){var c=this;var d=this._getResultsPerPage();desknets.Pager.output(this.$tosPager,".jco-pager",{getCount:Math.min(f-e,d),allCount:f,pageMaxView:d,startRow:e,clickFunc:function(g){c._pageOfTos((g/d)+1)}})},_updateTosTable:function(){var c=this.data.tos["allcnt"];var h=this.data.tos["row"];var g=this.data.tos["uids"];if(c=="0"){this.$tos.find(".jenq-view-nodata").show();this.$tos.find("#jenq-view-tos-table").hide()}else{this.$tos.find(".jenq-view-nodata").hide();this.$tos.find("#jenq-view-tos-table").show()}var f=[];for(var e=0;e<g.length;e++){var d=g[e];f.push(this.data.toMap[d])}this.$tosTmpl.tmpl(f,{pgContext:this}).appendTo(this.$tosTBody);this.$tosReloadBtn.removeClass("on");this._updateTosPager(h,c)},_isShowCopyBtn:function(){return !this.isManageMode()},_isShowDelNoticeBtn:function(){if(!this.options.showDelNoticeBtn){return false}return this._isFinishedEnquete()||this._isReplied()},_isShowDelBtn:function(){if(!this.options.showDelOrgEnqBtn){return false}return this._isDeleteable()},_isShowFinBtn:function(){return this._isDeleteable()&&!this._isFinishedEnquete()},_showButtons:function(){var c=this.$mjPage.find(".co-actionarea");var d=c.find(":button, .line");d.filter(":button.jco-input-copy").toggle(this._isShowCopyBtn());d.filter(":button.jenq-del-button").toggle(this._isShowDelBtn());d.filter(":button.jenq-del-notice-button").toggle(this._isShowDelNoticeBtn());d.filter(":button.jenq-finish-button").toggle(this._isShowFinBtn());d.filter(".line").each(function(f,g){var e=b(g);e.toggle(e.prevAll(':not([style*="display: none"]):first').is(":button")&&e.nextAll(':not([style*="display: none"]):first').is(":button"))})},_initViewDetail:function(){var d=this;var f=d.$mjPage.find(".enq-view-detail-in");var c=d.options["$page"].find(":hidden[name=attach-totalSizeLimit]").val();var e=function(m){var i=m.attr("data-id");var g={cmd:desknets.enq.CMD_ENQADDATTACH,id:i};var l={cmd:desknets.enq.CMD_ENQDELATTACH,id:i};var h={cmd:desknets.enq.CMD_ENQDISPATTACH,id:i};var k=desknets.getUrl(desknets.enq.MODULE_ENQUETE)+"?"+b.param(h)+"&fno={{id}}&filename={{name}}";var j={uploadURL:desknets.getUrl(desknets.enq.MODULE_API_ENQUETE),uploadParams:g,delURL:desknets.getUrl(desknets.enq.MODULE_API_ENQUETE),delParams:l,downloadURL:k,toggleTargetFunc:function(){d._updateListviewHeight()}};if(!!c){j.totalSizeLimit=Number(c)}return j};desknets.form.initForm(f,e,c)},_onClickAnswersDetail:function(f){var c,d,g={};f.preventDefault();d=b(f.target).attr("target");g={cmd:desknets.enq.PAGE_ENQ_ANSWERS,id:this._getEnqueteId(),};if(this.isManageMode()){g.cmd=desknets.enqset.PAGE_ENQMSET_ANSWERS}c=desknets.getUrl(desknets.enq.MODULE_ENQUETE)+"?"+desknets.getNeoParam(g);desknets.execLocation(c,d)},_onClickAnswersDownload:function(f){var c,d,g={};f.preventDefault();d=b(f.target).attr("target");g={cmd:desknets.enq.PAGE_ENQ_ANSWERSCSV,id:this._getEnqueteId(),};if(this.isManageMode()){g.cmd=desknets.enqset.PAGE_ENQMSET_ANSWERSCSV}c=desknets.getUrl(desknets.enq.MODULE_ENQUETE)+"?"+desknets.getNeoParam(g);desknets.execLocation(c,d)},_onClickTosReload:function(f){f.preventDefault();this.$tosReloadBtn.addClass("on");var d=desknets.paramanalyzer.getHashParams();var c=d.row;this._ajaxGetTos(c)},_onClickFinish:function(f){var c=this;var d=desknets.Resource.Message.enq_complete_confirm;$dialog=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled($dialog);c._ajaxFinish()})},_onClickDel:function(f){var c=this;var d=desknets.Resource.Message.com_del_conf;$dialog=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled($dialog);c._ajaxDel()})},_onClickDelNotice:function(f){var c=this;var d=desknets.Resource.Message.com_del_conf;$dialog=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled($dialog);c._ajaxDelNotice()})},_onClickAnswer:function(d){b(window).off("beforeunload.pageBase");this.resetFuncBeforeHashChange();var c=desknets.paramanalyzer.getHashParams();var f=b("#dispfrm");f.find("[name=cmd]").val(desknets.enq.CMD_ENQANSWER);f.find("[name=id]").val(c.id);f.submit()},_onClickAnswerDraft:function(d){b(window).off("beforeunload.pageBase");this.resetFuncBeforeHashChange();var c=desknets.paramanalyzer.getHashParams();var f=b("#dispfrm");f.find("[name=cmd]").val(desknets.enq.CMD_ENQANSWERDRAFT);f.find("[name=id]").val(c.id);f.submit()},_onClickRouteUserName:function(g){var h={},f,c,d;g.preventDefault();f=b(g.target).attr("target");d=b(g.target).closest(".enq-to-uname").find(":hidden[name=routeid]").val();h={cmd:desknets.enq.PAGE_ENQ_ANSWER,id:this._getEnqueteId(),uid:d};if(this.isManageMode()){h.cmd=desknets.enqset.PAGE_ENQMSET_ANSWER}c=desknets.getUrl(desknets.enq.MODULE_ENQUETE)+"?"+desknets.getNeoParam(h);desknets.execLocation(c,f)},_ajaxFinish:function(){var c=this;var d;var e=desknets.paramanalyzer.getHashParams();var g={};g.cmd=desknets.enq.CMD_ENQFINISH;g.id=e.id;if(this.isManageMode()){g.cmd=desknets.enqset.CMD_ENQMSET_FINISH}d=desknets.getUrl(c._getRestModule());var f=function(){var h;h=c.options.onUpdData;if(!!h){h()}c.resetFuncBeforeHashChange();h=c.options.onExit;if(!!h){h()}};desknets.ajax.rest({url:d,data:g,success:function(i,h,j){f()},complete:function(){}})},_ajaxDel:function(){var c=this;var g={};var d;var e=desknets.paramanalyzer.getHashParams();g.cmd=desknets.enq.CMD_ENQDEL;g.id=e.id;if(this.isManageMode()){g.cmd=desknets.enqset.CMD_ENQMSET_DEL}d=desknets.getUrl(c._getRestModule());var f=function(){var h;h=c.options.onUpdData;if(!!h){h()}c.resetFuncBeforeHashChange();h=c.options.onExit;if(!!h){h()}};desknets.ajax.rest({url:d,data:g,success:function(i,h,j){f()},complete:function(){}})},_ajaxDelNotice:function(){var c=this;var g={};var d;var e=desknets.paramanalyzer.getHashParams();g.cmd=desknets.enq.CMD_ENQLISTDEL;g.id=e.id;d=desknets.getUrl(c._getRestModule());var f=function(){var h;h=c.options.onUpdData;if(!!h){h()}c.resetFuncBeforeHashChange();h=c.options.onExit;if(!!h){h()}};desknets.ajax.rest({url:d,data:g,success:function(i,h,j){f()},complete:function(){}})},_getAjaxGetTosParam:function(){var c=desknets.paramanalyzer.getHashParams();var d={};d.cmd=this._getRouteExecCmd();d.id=c.id;d.row=c.row;if(c.srchanswer==="1"||c.srchanswer==="2"){d.srchanswer=c.srchanswer}else{d.srchanswer="0"}return d},_ajaxGetTos:function(d){var e=desknets.paramanalyzer.getHashParams();var c=this._getAjaxGetTosParam();c.id=e.id;c.row=d;var f=b.proxy(function(h,g,i){this._clrTos();this._setTos(h);this.$tosTBody.empty();this._updateTosTable()},this);desknets.ajax.rest({url:desknets.getUrl(this._getRestModule()),data:c,success:function(h,g,i){f(h,g,i)},complete:function(i,g,h){}})},_getDispDataParam:function(){var c;c=desknets.paramanalyzer.getHashParams();c.cmd=this._getDispExecCmd();if(!!this._getAnswerUserId()){c.uid=this._getAnswerUserId()}return c},_getDispHtmlParam:function(){return desknets.paramanalyzer.getHashParams()},_updateListviewHeight:function(){var c=this.options.onResize;if(c){c()}},getMultiRequest:function(){var c={};c["0"]=this._getDispDataParam();c["1"]=this._getDispHtmlParam();c["2"]=this._getAjaxGetTosParam();var d=desknets.attach.ext.getListParam();if(d){d.cmd="enq"+d.cmd;c["3"]=d}return c},_setupReplyForm:function(){var c=this;var f=function(){var g;g=c.options.onUpdData;if(!!g){g()}c.resetFuncBeforeHashChange();g=c.options.onExit;if(!!g){g()}};var d={async:false,error:function(i,g,h){desknets.ajax.onError(i.status,h)},success:function(h,g,i){f()}};var e=b("#dispfrm");desknets.ajax.submitForm(e,d)},_initSet:function(f){var e=this;var c=desknets.paramanalyzer.getHashParams();this._setEnqueteData(f[0]);this._clrTos();this._setTos(f[2]);if(f[3]){desknets.attach.ext.saveList(f[3])}this.$mjPage.empty();this.$mjPage.html(f[1].html);this.$mjPage.find(".jco-disp-tmplset").tmpl(f[0],{pgContext:this}).appendTo("#jco-m-disp-page");this._showButtons();this.$tosTmpl=this.$mjPage.find(".jenq-tos-tmpl");this.$tos=this.$mjPage.find(".enq-view-answers");this.$tosTBody=this.$tos.find("#jenq-view-tos-table>tbody");this.$tosPager=this.$tos.find(".jco-pager").parent();this.$tosReloadBtn=this.$tos.find(".co-btn-update");e._setCloseDateDialog();if(f[0].anonymouse=="0"){this._updateTosTable()}var d=this.$mjPage.find("form");this._setupReplyForm();this._initViewDetail();this.$mjPage.find(".jenq-close-date").click(function(j){j.preventDefault();e.$mclosedatedialog.dialog("open")});desknets.enq.NoticeUnconfirmUserDialog.init(this.$mjPage.find(".jco-cab-title").text(),f[0].anonymouse);e.$mjPage.find(".jenq-answers-not-button").click(function(j){j.preventDefault();desknets.enq.NoticeUnconfirmUserDialog.open()});var h=false;if(f[0].anonymouse=="0"){if(desknets.pageframe.getMailUse()=="1"||desknets.pageframe.isShownMenu("memo")){h=true}}if(h==false||f[2].noanwser=="0"){e.$mjPage.find(".jenq-answers-not-button").hide()}this.$mjPage.find(".enq-view-answers a.jenq-answers-detail-button").click(b.proxy(this._onClickAnswersDetail,this));this.$mjPage.find(".enq-view-answers a.jenq-answers-download-button").click(b.proxy(this._onClickAnswersDownload,this));var i=this.$mjPage.find('[name="srchanswer"]');i.val(c.srchanswer);i.change(function(){e._pageOfTos(1)});d.delegate(".jenq-finish-button","click",b.proxy(this._onClickFinish,this));d.delegate(".jenq-del-button","click",b.proxy(this._onClickDel,this));d.delegate(".jenq-del-notice-button","click",b.proxy(this._onClickDelNotice,this));d.delegate(".jenq-answer-button","click",b.proxy(this._onClickAnswer,this));d.delegate(".jenq-save-button","click",b.proxy(this._onClickAnswerDraft,this));this.$tosReloadBtn.click(b.proxy(this._onClickTosReload,this));this.$tosTBody.delegate(".enq-to-uname a","click",b.proxy(this._onClickRouteUserName,this));var g={copymodule:this._getRestModule(),copycmd:desknets.enq.CMD_ENQCABATTACHCOPY,cabtemplatename:"enq.html",cabmaketemplate:b.proxy(function(m,k,j,l){var n=function(p){l.viewdata=desknets.tmpl.replaceWordHtml(k,"body",p);desknets.cabinetregist.sendCabinetAjax(l,"detail")};var o=function(){var p=desknets.cabinetregist.$dialog;desknets.submitform.clearDialogDisabled(p)};this._buildCabinetHtmlBody(n,o);return false},this)};desknets.cabinetregist.init(this.$mjPage,g,false);d.delegate(":button.jco-input-copy","click",b.proxy(function(k){var j=desknets.paramanalyzer.getHashParams();var l={};l.cmd=desknets.enq.CMD_ENQENTRYPAGE;l.id=j.id;l.copy="1";desknets.paramanalyzer.setLocationHash(l)},this))},_setCloseDateDialog:function(){var d=this;var c=desknets.paramanalyzer.getHashParams();d.$mclosedatedialog=b("#enq-closedate-dialog");desknets.htmlparts.setUpForm(d.$mclosedatedialog);var e=desknets.dialog.getDialogOption();e.autoOpen=false;e.title=desknets.Resource.enq.closedatetitle;e.open=function(){b(this).find(".jenq-dmyinput").hide()};e.close=function(){b(this).find(".jenq-dmyinput").show()};e.buttons={};e.buttons[desknets.Resource.OKButtonLabel]=function(){var f=d.$mclosedatedialog.find(".co-datepicker");if(f.hasClass("ui-invalid")){msg=desknets.getErrConvMsg({msg:desknets.validation.getErrorMessage(f),fieldid:"period",fieldname:desknets.getErrFieName(d.$mclosedatedialog,"period")});desknets.dialog.alert(msg);return}var g={};g.cmd=desknets.enq.CMD_ENQ_CLOSEDATE;g.id=c.id;g.period=d.$mclosedatedialog.find('input[name="period"]').val();desknets.ajax.rest({url:desknets.getUrl(d._getRestModule()),data:g,success:function(j,h,k){var i=g.period;i=i.replace(/-/g,"");if(i==""){d.$mjPage.find(".jenq-closedate-disp").html(desknets.Resource.nothingLabel)}else{d.$mjPage.find(".jenq-closedate-disp").html(desknets.dateTime.dispDateTime(i))}d.$mclosedatedialog.dialog("close")},complete:function(j,h,i){}})};e.buttons[desknets.Resource.CancelButtonLabel]=function(){b(this).dialog("close")};d.$mclosedatedialog.dialog(e)},_getRestModule:function(){return desknets.enq.MODULE_API_ENQUETE},_getDispExecCmd:function(){if(this.isManageMode()){return desknets.enqset.CMD_ENQMSET_DISP}else{return desknets.enq.CMD_ENQDISP}},_getRouteExecCmd:function(){if(this.isManageMode()){return desknets.enqset.CMD_ENQMSET_ROUTE}else{return desknets.enq.CMD_ENQROUTE}},_buildCabinetHtmlBody:function(c,d){desknets.enq.enqcabinet.buildCabPageHtml(this._getEnqueteId(),c,d)},resetFuncBeforeHashChange:function(){var c=b(window).data("hashobserver");if(c){c.beforeHashChangeFunc=null}},banpei:null})})(jQuery);(function(b){desknets.page(desknets.enq,"enqcabinet",null,{buildCabPageHtml:function(e,j,d){var k=this;var c=e;var h={},g={},f={};h.cmd=desknets.enq.CMD_ENQCABINETPAGE;g.cmd=desknets.enq.CMD_ENQDISP;g.id=c;g.formType="-1";f.cmd=desknets.enq.CMD_ENQROUTE;f.id=c;f.num=desknets.enq.MAXNUM;params=desknets.ajax.arrayToMultiCmdData({"0":h,"1":g,"2":f});var i=function(m){var l;l=k._buildBody(m);j(l)};this._ajaxGetData(params,i,d)},_ajaxGetData:function(e,d,c){desknets.ajax.rest({detectMultiError:true,dataType:desknets.ajax.RESTYPE_JSON,url:desknets.getUrl(desknets.enq.MODULE_API_ENQUETE),data:e,success:function(g,f,h){d(g)},error:function(h,f,g){if(b.isFunction(c)){c()}desknets.ajax.onError(h.status,g)}})},_buildBody:function(i){var h=null;var d=i[2].list.item;if(d==null){d=[]}if(!b.isArray(d)){d=[d]}var c,g;c=i[0].html;g=i[1];g.routes=d;h=b("<div>").append(c);b.each(h.children("script[type=text/x-jquery-tmpl]"),function(k,l){var j=b(l);j.template(j.attr("id"))});var f=b.tmpl("jenq-cabinet-tmpl",g);var e=f.wrapAll("<div>").parent().html();b.each(h.children("script[type=text/x-jquery-tmpl]"),function(j,k){delete b.template[b(k).attr("id")]});return e},banpei:null})})(jQuery);desknets.page(desknets.enq,"searchindex",desknets.PageListBatSearchBase,{_cmdNo:null,_onClickDel:function(b){this._cmdNo=desknets.enq.CMD_ENQDEL;this._listDelSubmit(b)},_onClickFinish:function(b){this._cmdNo=desknets.enq.CMD_ENQFINISH;this._listDelSubmit(b)},_initListEndButton:function(){var b=this;b.callBase("_initListEndButton");this.$mjListPage.find(".jco-list-del-submit").unbind();this.$mjListPage.find(".jco-list-del-submit").click(function(c){b._onClickDel(c)});this.$mjListPage.find(".jco-list-finish-submit").click(function(c){b._onClickFinish(c)});this.$mjListPage.find(".co-pageback").click(function(c){c.preventDefault();b.dispBackListPage()})},_initListStartModLink:function(){var b=this;b.$mjTableList.dnclick(".jco-modlink",function(d){var c=a(this).parent().parent().find(".jco-id").val();b.inputDispPage(c)},function(d){var c=a(this).parent().parent().find(".jco-id").val();b.inputDispPage(c)})},_replaceListLine:function(d,f,e){var c=this;var b;b=desknets.enq.replaceEnqListLine(d,f,e);if(b){return b}return c.callBase("_replaceListLine",d,f,e)},_getDelAddPrm:function(){var b={};if(this.$mjListPage.find(".co-chk-cnt-all").css("display")=="block"){b.lcmd=this._getListExecCmd()}if(this._cmdNo==desknets.enq.CMD_ENQFINISH){return b}else{if(this._cmdNo==desknets.enq.CMD_ENQDEL){return b}}},_delNoChkMessage:function(){if(this._cmdNo==desknets.enq.CMD_ENQFINISH){return desknets.Resource.Message.enq_finish_nochecked}else{return this.callBase("_delNoChkMessage")}},_getListAjaxSuccess:function(b){this.callBase("_getListAjaxSuccess",b)},_getRestModule:function(){return desknets.enq.MODULE_API_ENQUETE},_getListCmd:function(){return desknets.enq.CMD_ENQSEARCHPAGE},_getListExecCmd:function(){return desknets.enq.CMD_ENQSEARCHINDEX},_getStopBatSearchCmd:function(){return desknets.enq.CMD_ENQSTOPSEARCH},_getListDispCmd:function(){return desknets.enq.CMD_ENQSEARCHDISPPAGE},_getDelCmd:function(){if(this._cmdNo==desknets.enq.CMD_ENQFINISH){return desknets.enq.CMD_ENQFINISHCONF}else{if(this._cmdNo==desknets.enq.CMD_ENQDEL){return desknets.enq.CMD_ENQDELCONF}}return""},_getDelExecCmd:function(){return this._cmdNo},banpei:null});(function(b){desknets.page(desknets.enq,"enqanswer",null,{init:function(){var d=b(":hidden[name=id]").val();var c=b(":hidden[name=uid]").val();this._update(d,c)},_update:function(g,d){var c=this;var f=function(j,h,k){var i=c._buildHtml(j);b("#jenqanswer-body").append(i)};var e={cmd:this._getAnswerDetailCmd(),id:g,uid:d,formType:"3"};desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:desknets.getUrl(desknets.enq.MODULE_API_ENQUETE),data:e,success:f,error:function(j,h,i){alert(i)},complete:function(j,h,i){}})},_buildHtml:function(f){var e;e=f;var d=b(".jco-answer-tmplset").tmpl(e);var c=d.wrapAll("<div>").parent().html();return c},_getAnswerDetailCmd:function(){return desknets.enq.CMD_ENQDISP},banpein:null})})(jQuery);(function(b){desknets.page(desknets.enq,"searchdisp",desknets.PagePaneDispBase,{_initGetHtml:function(){this._getDispComponent().init({"$page":this.$mjPage,onCreate:b.proxy(function(){this._initSet()},this),onResize:b.proxy(function(){this._setListviewHeight(this.$mjPage)},this),onUpdData:b.proxy(function(){desknets.enq.searchindex._onSrchExec=true},this),onExit:b.proxy(function(){this.dispBackListPage()},this),answerUserId:desknets.pageframe.getLoginUid(),search:true,manage:false})},_initSet:function(f){var d=this;var e=[];e[e.length++]='<div class="co-listview co-list-selfolder selmulti">';e[e.length++]='  <div class="co-listview-left ui-layout-west"><!-- 左ペイン --></div>';e[e.length++]='  <div class="co-listview-list ui-layout-center"><!-- 右ペイン --></div>';e[e.length++]="</div>";d.$mjPage.find(".jco-disp-disparea").append(b(e.join("")));var c=d.$mjPage.find(".co-listview-list.ui-layout-center");d.$mjPage.find(".jco-disp-disparea").children(":not(:last)").appendTo(c);b("#jco-m-disp-page").find(".ui-layout-west").html(b("#jco-m-list-container").find(".ui-layout-west").html());d.initLeftTree();this.callBase("_initSet",null);this._onEditorStart()},initLeftTree:function(){var c=b.extend({},desknets.folderdisp);c.init(this.$mjPage,this._getOptionLeftTree(),this._optTreeGetCmd())},_optTreeSelectFunc:function(d){var c=d.data("fid");desknets.enq.enqindex.resetSortCondition(c);this.callBase("_optTreeSelectFunc",d)},_optTreeSelItemParams:function(){return{}},_getSpliterAddOpt:function(){return{initClosed:true}},_optTreeGetCmd:function(){},_getRestModule:function(){return desknets.enq.MODULE_API_ENQUETE},_getDispExecCmd:function(){return desknets.enq.CMD_ENQDISP},_initDispLeftPane:function(){},_getDispComponent:function(){return desknets.enq.enqdispCompo},$_editorForm:null,_formObserveisChanged:function(){return !!this.$_editorForm&&!!this._formObserve_isChanged(this.$_editorForm)},_onEditorStart:function(){this._defFormVals={};this.$_editorForm=this.$mjPage.find("form");this._formObserveSave(this.$_editorForm,this._defFormVals)},_onEditorEnd:function(){this.$_editorForm=null;this._defFormVals={}},banpein:null})})(jQuery);app.addInitialAction(function(){desknets.enq.init()})})(jQuery);