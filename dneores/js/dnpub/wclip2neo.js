/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
var desknets=desknets?desknets:{};(desknets.webclip=function iframeFunction(){var d={mainUrl:"dneo.{{modType}}",loginUrl:"dneor.{{modType}}",postUrl:"zrcabinet.{{modType}}",statusInterval:3000};var t="";var h=false;var y=null;var l=false;var u="";var A="";var w="";function q(B,D,E){var C=new RegExp("{{"+D+"}}","ig");return B.replace(C,function(F,G,H){return E})}function s(C,B){if(l==true){return}C=C.replace(/^W:/,"");c({cmd:"err msg",msg:C})}function a(D,C){var B=d.loginUrl;B=q(B,"modType",w);xhr=new XMLHttpRequest();y=xhr;xhr.open("POST",B);xhr.onreadystatechange=function(){if(xhr.readyState==4){y=null;if(xhr.status==200){var E=JSON.parse(xhr.responseText);if(E.status=="ok"){u=E.rssid;A=E.STOKEN;n("dnzSid",E.rssid);n("dnzToken",E.STOKEN);c({cmd:"login ok"})}else{s(desknets.Resource.webclip.msgLoginError,E.errorno)}}else{xhr.abort();s(desknets.Resource.webclip.msgSendError,xhr.status)}}};xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.setRequestHeader("cache-control","no-cache");xhr.send("cmd=certify&UserID="+encodeURIComponent(D)+"&_word="+encodeURIComponent(C))}function x(G,H,D,C,B,F){t="";var E=d.postUrl;E=q(E,"modType",w);xhr=new XMLHttpRequest();y=xhr;xhr.open("POST",E);xhr.onreadystatechange=function(){if(xhr.readyState==4){y=null;if(xhr.status==200){var J=JSON.parse(xhr.responseText);if(J.status=="ok"){t=J.tmppid;if(!h){c({cmd:"connect",percent:"20"});var I=d.statusInterval;setTimeout(b,I,t)}else{if(t!=""){k(t)}}}else{s(J.errormessage,J.errorno);c({cmd:"err end"})}}else{if(xhr.status==403){if(h!=true){s(desknets.Resource.webclip.msgRetryLogin,xhr.status)}z("dnzSid");z("dnzToken");c({cmd:"need login"})}else{xhr.abort();if(h!=true){s(desknets.Resource.webclip.msgSendError,xhr.status)}c({cmd:"err end"})}}}};xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.setRequestHeader("cache-control","no-cache");param="cmd=cabclip&Name="+encodeURIComponent(G);for(i=0;i<H.length;i++){param=param+"&imgurl="+encodeURIComponent(H[i])}for(i=0;i<D.length;i++){param=param+"&login="+encodeURIComponent(D[i])}param=param+"&url="+encodeURIComponent(C);if(B!=undefined&&B!="undefined"){param=param+"&foldername="+encodeURIComponent(B)}param=param+"&clipurl="+encodeURIComponent(F);param=param+"&rssid="+u+"&"+A+"=1";xhr.send(param)}function m(H,E,D,C,B,G){t="";var F=d.postUrl;F=q(F,"modType",w);xhr=new XMLHttpRequest();y=xhr;xhr.open("POST",F);xhr.onreadystatechange=function(){if(xhr.readyState==4){y=null;if(xhr.status==200){var J=JSON.parse(xhr.responseText);if(J.status=="ok"){t=J.tmppid;if(!h){c({cmd:"connect",percent:"20"});var I=d.statusInterval;setTimeout(b,I,t)}else{if(t!=""){k(t)}}}else{s(J.errormessage,J.errorno);c({cmd:"err end"})}}else{if(xhr.status==403){if(h!=true){s(desknets.Resource.webclip.msgRetryLogin,xhr.status)}z("dnzSid");z("dnzToken");c({cmd:"need login"})}else{xhr.abort();if(h!=true){s(desknets.Resource.webclip.msgSendError,xhr.status)}c({cmd:"err end"})}}}};xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.setRequestHeader("cache-control","no-cache");param="cmd=cabclip&Name="+encodeURIComponent(H);param=param+"&viewdata="+encodeURIComponent(E);for(i=0;i<D.length;i++){param=param+"&login="+encodeURIComponent(D[i])}param=param+"&url="+encodeURIComponent(C);if(B!=undefined&&B!="undefined"){param=param+"&foldername="+encodeURIComponent(B)}param=param+"&clipurl="+encodeURIComponent(G);param=param+"&rssid="+u+"&"+A+"=1";xhr.send(param)}function b(C){var B=this;if(h){h=false;return}var D=d.postUrl;D=q(D,"modType",w);xhr=new XMLHttpRequest();y=xhr;xhr.open("POST",D);xhr.onreadystatechange=function(){if(xhr.readyState==4){y=null;if(xhr.status==200){var G=JSON.parse(xhr.responseText);if(G.status=="ok"){var F=G.percent;if(F=="100"){C="";c({cmd:"connect",percent:F});setTimeout(c,500,{cmd:"end",folder:G.folder,foldername:G.foldername})}else{c({cmd:"connect",percent:F});if(h){h=false;return}var E=d.statusInterval;setTimeout(b,E,C)}}else{if(h){h=false;return}s(G.errormessage,G.errorno);c({cmd:"err end"})}}else{xhr.abort();if(h!=true){s(desknets.Resource.webclip.msgSendError,xhr.status)}c({cmd:"err end"})}}};xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.setRequestHeader("cache-control","no-cache");param="cmd=cabclipchk&tmppid="+encodeURIComponent(C);param=param+"&rssid="+u+"&"+A+"=1";xhr.send(param)}function k(C){var B=this;var D=d.postUrl;D=q(D,"modType",w);xhr=new XMLHttpRequest();y=xhr;xhr.open("POST",D);xhr.onreadystatechange=function(){if(xhr.readyState==4){y=null;if(xhr.status==200){var F=JSON.parse(xhr.responseText);if(F.status=="ok"){C="";c({cmd:"cancel end"})}else{s(F.errormessage,F.errorno);c({cmd:"err end"})}var E=d.statusInterval;setTimeout(function(){h=false},E)}else{xhr.abort();s(desknets.Resource.webclip.msgSendError,xhr.status);c({cmd:"err end"});h=false}}};xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.setRequestHeader("cache-control","no-cache");param="cmd=cabclipstop&tmppid="+encodeURIComponent(C);param=param+"&rssid="+u+"&"+A+"=1";xhr.send(param)}function v(C){var D=new RegExp("; "+C+"=([^;]*);");var B=("; "+document.cookie+";").match(D);if(B){return B[1]}else{return undefined}}function n(B,C){document.cookie=encodeURIComponent(B)+"="+encodeURIComponent(C)+"; expires="}function z(B){var C=new Date();C.setTime(0);document.cookie=encodeURIComponent(B)+"=; expires="+C.toGMTString()}function f(){c({cmd:"event block"});var C=document.getElementById("UserID");var B=document.getElementById("_word");C.blur();B.blur();a(C.value,B.value)}function c(B){window.parent.postMessage(B,"*")}function r(B){c({cmd:"cancelBtnClick"})}function e(){var D=document.getElementsByTagName("script");var B=D[D.length-1].src;var H=B.substring(B.indexOf("?")+1);var I=H.split("&");var J=new Object();for(var E=0;E<I.length;E++){var F=I[E].split("=");var G=decodeURIComponent(F[0]);var C=decodeURIComponent(F[1]);J[G]=decodeURIComponent(C)}return J}if(window.addEventListener){window.addEventListener("message",function(G){var H=G.data;if(H.cmd=="clipImage"){var I=H.title?H.title:H.url;var L=H.imgUrl;var J=H.cookieInfo;var B=H.url;var K=H.foldername;var F=H.clipurl;c({cmd:"connect",percent:10});x(I,L,J,B,K,F)}else{if(H.cmd=="clipHtml"){var I=H.title?H.title:H.url;var E=H.html;var J=H.cookieInfo;var B=H.url;var K=H.foldername;var F=H.clipurl;c({cmd:"connect",percent:10});m(I,E,J,B,K,F)}else{if(H.cmd=="cancel"){h=true;if(y!=null){y=null}if(t!=""){k(t)}}else{if(H.cmd=="terminate"){l=true;h=true;if(y!=null){y.abort();y=null}if(t!=""){k(t)}else{c({cmd:"cancel end"})}}else{if(H.cmd=="login chk"){w=H.mod;var C=d.mainUrl;C=q(C,"modType",w);var D=document.getElementById("webclip-h-logo");D.href=C;if(u==""||A==""||u==undefined||A==undefined){c({cmd:"need login"})}else{c({cmd:"login ok"})}}else{if(H.cmd=="logout"){z("dnzSid");z("dnzToken");c({cmd:"need login"})}}}}}}})}else{if(window.attachEvent){window.attachEvent("onmessage",function(B){})}}var o=document.getElementsByClassName("webclip-header-close");for(i=0;i<o.length;i++){o[i].onclick=r}var j=document.getElementById("login");j.onclick=f;var p=document.getElementById("UserID");p.onkeypress=function(B){if(13===B.keyCode){f()}};var g=document.getElementById("_word");g.onkeypress=function(B){if(13===B.keyCode){f()}};u=v("dnzSid");A=v("dnzToken")})();