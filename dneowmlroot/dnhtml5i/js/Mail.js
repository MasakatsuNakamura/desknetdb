/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2017 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
(function(a){var d=neo.core.readyNamespace("neo.denbun.Mail");if(!d){return}var b=neo.denbun;var c=neo.denbun.Mail=new neo.core.Class({classProperties:{DROPPABLE_SCOPE:"mail",PARAM_MESSAGE_ID:"msgid",PARAM_FILE:"file",PARAM_TEMPORARY_NUMBER:"tmpnm",PARAM_TEMPORARY_MESSAGE_ID:"tmpmsgid",PARAM_FILE_NO:"fno",PARAM_ENCODING:"encoding",PARAM_FILE_NAME:"efname",PARAM_SUBJECT:"subject",PARAM_LISTDATA_KEY:"ldkey",_temporaryMessageIdForViewOfMailFile:null,_getTemporaryMessageIdForViewOfMailFile:function(){return this._temporaryMessageIdForViewOfMailFile},_setTemporaryMessageIdForViewOfMailFile:function(e){return this._temporaryMessageIdForViewOfMailFile=e},_ajaxDeleteTemporaryAreaForViewOfMailFile:null,_getAjaxDeleteTemporaryAreaForViewOfMailFile:function(){return this._ajaxDeleteTemporaryAreaForViewOfMailFile||this._initAjaxDeleteTemporaryAreaForViewOfMailFile()},_initAjaxDeleteTemporaryAreaForViewOfMailFile:function(){var e=this;var f=b.getUrl(b.CGI_EMLFILE);var g={url:f,getSendData:function(){var i={cmd:"mailfiledelete",tmpmsgid:e._getTemporaryMessageIdForViewOfMailFile()};return i}};var h=new neo.denbun.Ajax(g);h.initialize();return this._ajaxDeleteTemporaryAreaForViewOfMailFile=h},_viewer:null,getViewer:function(){return this._viewer||this._initViewer()},_initViewer:function(){var e={page:this};var f=new c.Viewer(e);f.initialize();return this._viewer=f},_operator:null,getOperator:function(){return this._operator||this._initOperator()},_initOperator:function(){var f={viewer:this.getViewer()};var e=new c.Operator(f);e.initialize();return this._operator=e},_observer:null,getObserver:function(){return this._observer||this._initObserver()},_initObserver:function(){var f={interval:b.comSetting.getAutoReceiveInterval()};var e=new c.Observer(f);e.initialize();return this._observer=e},_elFork:null,getElFork:function(){return this._elFork||this._initElFork()},_initElFork:function(){return this._elFork=a("#mail-view-fork")},_elAddToAddressBook:null,getElAddToAddressBook:function(){return this._elAddToAddressBook||this._initElAddToAddressBook()},_initElAddToAddressBook:function(){return this._elAddToAddressBook=a("#mail-view-header-add_to_address_book")},_elSetTag:null,getElSetTag:function(){return this._elSetTag||this._initElSetTag()},_initElSetTag:function(){return this._elSetTag=a(".mail-view-set_tag")},_elOtherFunc:null,getElOtherFunc:function(){return this._elOtherFunc||this._initElOtherFunc()},_initElOtherFunc:function(){return this._elOtherFunc=a(".mail-view-otherfunc")},_listDataForView:null,getListDataForView:function(){return this._listDataForView},setListDataForView:function(e){return this._listDataForView=e},constructor:function(){},updateViewerSize:function(){var e=this.getViewer();e.updateSize()},getDatetimeText:function(e,j,f){var g=e.match(/(\d\d\d\d)(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)/);if(!g){return e}var o=g[1];var m=g[2];var p=g[3];var q=g[4];var i=g[5];var s=g[6];var l=o+"/"+m+"/"+p+" "+q+":"+i+"";var k=this._datetimeTextToObj(l,j);var h=b.getLang();var r;var n;switch(h){case b.LANG_JA:case b.LANG_ZHCN:r="$YYYY$/$month$/$DD$ $hh$:$mm$";break;default:if(f){r="$month$ $D$, $YYYY$ $h12$:$m$ $AMPM$";n={month:["January","February","March","April","May","June","July","August","September","October","November","December"]}}else{r="$month$/$D$/$YY$ $h12$:$m$ $AMPM$";n={month:["1","2","3","4","5","6","7","8","9","10","11","12"]}}}var t=neo.core.buildDateByFormat(k,r,n);return t},_datetimeTextToObj:function(f,k){var i=new Date(f);var h=k.match(/(.)(..)(..)/)||[];var g=(h[1]=="+"?1:-1)*((parseInt(h[2],10)*60)+(parseInt(h[3],10)))||0;var e=parseInt(b.getTimezoneOffset(),10);var j=g+e;i.setTime(i-(j*60*1000));return i},isMailFileParams:function(f){var e=f.mimetype;if(e&&e.match(/message\/rfc822/i)){return true}return false},openViewOfMailFileFrom:function(j){if(b.parent){b.parent.Mail.openViewOfMailFileFrom(j);return}var h=[b.PARAM_FOLDER_ID,c.PARAM_MESSAGE_ID,c.PARAM_TEMPORARY_NUMBER,c.PARAM_FILE,c.PARAM_FILE_NO,c.PARAM_ENCODING];if(DENBUN_MODE_XNEO){h.push(c.PARAM_FILE_NAME)}var g={};for(var f=0;f<h.length;f++){var e=h[f];if(e in j){g[e]=j[e]}}g[b.PARAM_FORK]=1;b.app.openPage(b.PAGE_MAIL_VIEW_OF_MAIL_FILE,g)},deleteTemporaryAreaForViewOfMailFile:function(f){if(b.parent&&!b.isIpadiOS6()){try{b.parent.Mail.deleteTemporaryAreaForViewOfMailFile(f)}catch(h){}return}this._setTemporaryMessageIdForViewOfMailFile(f);var g=this._getAjaxDeleteTemporaryAreaForViewOfMailFile();g.sendRequest()},enableAddToAddressBookButton:function(){var e=this.getElAddToAddressBook();e.attr("disabled",false)},disableAddToAddressBookButton:function(){var e=this.getElAddToAddressBook();e.attr("disabled",true)},splitId:function(f){var g=f.lastIndexOf("_");var e=f.slice(0,g);var h=f.slice(g+1);var i={fid:e,id:h};return i},initMailBody:function(){var g=this.getViewer();var f=g._getElBodyFrame();var e=f.contents();e.find("body").addClass("jmail-body")},hookMailBodyMailto:function(){var g=this.getViewer();var f=g._getElBodyFrame();var e=f.contents();this._makeMailto(e)},hookMailBodyExternalLink:function(){var e=this;var h=this.getViewer();var g=h._getElBodyFrame();var f=g.contents();if(b.isAndroid()){f.on("click","a",function(i){return e._onclickMailBodyAnchor(a(i.target))})}else{f.on("mousedown","a",function(i){return e._onclickMailBodyAnchor(a(i.target))})}},_onclickMailBodyAnchor:function(f){if(!f.is("a")){f=f.closest("a")}var e=f.attr("href");if(!!e&&e.length>0){if(e.match(/^mailto:/i)===null){b.app.confirmExternalLink(e);return false}}return true},_makeMailto:function(i){var f=this;var e=b.comSetting.getMailLinkSetting();var h=i.children("html").children("head").children("meta.jco-neo-htmlmail").length>0;if(!h){var g={convertMail:true,convertURL:true,urlTarget:"_blank",urlSchemas:["http","https"]};if(e!="1"&&e!="3"){g.convertMail=false}i.detectHref(g)}if(e!="3"){return}i.find('a[href^="mailto:"]').click(function(n){n.preventDefault();if(b.app.unloaded){return}var l=a(this).attr("href")||"";var j=l.indexOf(":",0);if(j>=0){l=l.substring(j+1);j=l.indexOf("?");if(j>=0){l=l.substring(0,j)}}var k=a(this).attr("href")||"";if(k.indexOf("?")==-1){k+="?"}if(k[k.length-1]!="?"&&k[k.length-1]!="&"){k+="&"}k=k+"to="+l;var o=desknets.splitParam(desknets.unescape(k));var m={method:b.METHOD_POST,};a.extend(m,o);desknets.webmailimap.openMailEdit(m,a("#form-mailtopage"))})},getListPage:function(){var f=this;if(b.parent){return b.parent.Mail.getListPage()}else{var e=f.getOperator();return e._getListPage()}},showMailBodyCutMsg:function(){var j=this.getViewer();var h=j._getElBodyFrame();var f=h.contents();var e=(f.children("html").find('[name="bodycut"]').val()=="1");if(e){var i=b.getText("制限されている表示サイズをオーバーしたため、本文を切り捨てました。");var g='<span title="'+i+'">'+i+"</span>";b.showSlideDownMsg(g,"mail_list-bodycut")}},hideMailBodyCutMsg:function(){b.hideSlideDownMsg("mail_list-bodycut")},showMailHtmlToTextWarnMsg:function(){var j=this.getViewer();var h=j._getElBodyFrame();var e=h.contents();var g=(e.children("html").find('[name="htmltotextwarn"]').val()=="1");if(g){var i=b.getText("このメッセージはメールデータに問題があったため正しく表示されない可能性があります。");var f='<span title="'+i+'">'+i+"</span>";b.showSlideDownMsg(f,"mail_list-htmltotextwarn")}},hideMailHtmlToTextWarnMsg:function(){b.hideSlideDownMsg("mail_list-htmltotextwarn")},sendTranslationRequest:function(e){var f=a.extend(true,{data:{cmd:"translate",appid:c.getTranslationAppId()},url:b.getUrl(b.CGI_TRANSLATION),type:"POST"},e);a.ajax(f)},getTranslationAppId:function(){return"denbun_test"},parseTranslationResult:function(e){var l=a("excitetranslation",e);if(l.length>0){var i=l.find("result body");var k=i.text();var g={result:"ok",translated:k};return g}var i=a("result",e);var p="";var f="";var n=i.find("status");if(neo.core.exists(n,"text","function")){f=n.text()}if(f=="ng"){var m="";var j=i.find("errorno");if(neo.core.exists(j,"text","function")){m=j.text()}var h="";var o=i.find("errormessage");if(neo.core.exists(o,"text","function")){h=o.text()}if(h!=""){p=h}if(m!=""){p+="["+m+"]"}}if(p==""){p=b.getText("失敗しました。")}var g={result:"ng",translated:p};return g},getTranslationError:function(){var e={result:"ng",translated:b.getText("失敗しました。")};return e},__closure:b.__closure,__bind:b.__bind,banpei:null},properties:{__constructor:function(){if(this instanceof c){var e="Class <neo.denbun.Mail> is not allowed to build instances.";throw new Error("neo.denbun.Mail.__constructor : "+e)}}}});c.constructor()})(jQuery);(function(a){var e=neo.core.readyNamespace("neo.denbun.Mail.Viewer");if(!e){return}var c=neo.denbun;var d=c.Mail;var b=neo.denbun.Mail.Viewer=new neo.core.Class({classProperties:{CLS_ATTACHMENT_LIST_ITEM:"mail-view-header-attachment-item",constructor:function(){},initialize:function(){}},properties:{_viewOfMailFileMode:null,_isViewOfMailFileMode:function(){return this._viewOfMailFileMode||this._initViewOfMailFileMode()},_initViewOfMailFileMode:function(){return this._viewOfMailFileMode=false},_setViewOfMailFileMode:function(){return this._viewOfMailFileMode=true},_id:null,_getId:function(){return this._id},_setId:function(f){return this._id=f},_folderId:null,_getFolderId:function(){return this._folderId},_setFolderId:function(f){return this._folderId=f},_paramsForViewOfMailFile:null,_getParamsForViewOfMailFile:function(){return this._paramsForViewOfMailFile},_setParamsForViewOfMailFile:function(f){return this._paramsForViewOfMailFile=f},_temporaryMessageIdForViewOfMailFile:null,getTemporaryMessageIdForViewOfMailFile:function(){return this._temporaryMessageIdForViewOfMailFile},setTemporaryMessageIdForViewOfMailFile:function(f){return this._temporaryMessageIdForViewOfMailFile=f},_priority:null,_getPriority:function(){return this._priority},_initPriority:function(f){return this._priority=Number(f.children("priority").text())},_numOfAttachments:null,_getNumOfAttachments:function(){return this._numOfAttachments},_initNumOfAttachments:function(f){var g=parseInt(f.children("attcount").text())||0;return this._numOfAttachments=g},_flagged:null,_isFlagged:function(){return this._flagged},_initFlagged:function(f){return this._flagged=(f.children("flag").text()==1)},_setFlagged:function(f){return this._flagged=f},_unread:null,_isUnread:function(){return this._unread},_initUnread:function(f){return this._unread=(f.children("open").text()!=1)},_notificationStatus:null,_getNotificationStatus:function(){return this._notificationStatus},_initNotificationStatus:function(f){return this._notificationStatus=Number(f.children("notify").text())},_replyingStatus:null,_getReplyingStatus:function(){return this._replyingStatus},_initReplyingStatus:function(f){return this._replyingStatus=Number(f.children("sflg").text())},_dateText:null,_getDateText:function(){return this._dateText},_initDateText:function(f){return this._dateText=f.children("date").text()},_timezone:null,_getTimezone:function(){return this._timezone},_initTimezone:function(f){return this._timezone=f.children("zone").text()},_from:null,_getFrom:function(){return this._from},_initFrom:function(f){if(DENBUN_MODE_XNEO){if(!f){return this._from=""}}return this._from=f.children("from").text()},_realFolderType:null,getRealFolderType:function(){return this._realFolderType},_initRealFolderType:function(f){return this._realFolderType=f.children("ftype").text()},_to:null,_getTo:function(){return this._to},_initTo:function(f){var g=f.children("to").text();g=g.split(",").join(", ");return this._to=g},_cc:null,_getCc:function(){return this._cc},_initCc:function(f){var g=f.children("cc").text();g=g.split(",").join(", ");return this._cc=g},_bcc:null,_getBcc:function(){return this._bcc},_initBcc:function(f){var g=f.children("bcc").text();g=g.split(",").join(", ");return this._bcc=g},_subject:null,_getSubject:function(){return this._subject},_setSubject:function(f){return this._subject=f},_callbackLoad:null,_getCallbackLoad:function(){return this._callbackLoad},_setCallbackLoad:function(f){return this._callbackLoad=f},_readyToDownloadAttachments:null,_isReadyToDownloadAttachments:function(){return this._readyToDownloadAttachments},_initReadyToDownloadAttachments:function(){return this._readyToDownloadAttachments=false},_setReadyToDownloadAttachments:function(){return this._readyToDownloadAttachments=true},_headerList:null,getHeaderList:function(){return this._headerList},_initHeaderList:function(f){var h=[];this._setSubject("");if(DENBUN_MODE_XNEO){if(!f){return this._headerList=h}}var g=this;f.find("> list > item").each(function(l,n){var k=a(n);var j=k.attr("id");var m=k.text();h.push({key:j,value:m});if(neo.core.isString(j)&&j.toLowerCase()=="subject"){g._setSubject(m)}});return this._headerList=h},_attachmentList:null,_getAttachmentList:function(){return this._attachmentList},_initAttachmentList:function(f){var g=[];f.find("> list > item").each(function(j,h){var l=a(h);var k={encoding:l.children("encoding").text(),id:l.attr("id"),mimeType:l.children("mimetype").text(),name:l.children("attachdisp").text(),size:Number(l.children("size").text())};g.push(k)});return this._attachmentList=g},_dataToSendNotification:null,_getDataToSendNotification:function(){return this._dataToSendNotification},_setDataToSendNotification:function(f){return this._dataToSendNotification=f},_tmCheckReadyToDownloadAttachments:null,_getTmCheckReadyToDownloadAttachments:function(){return this._tmCheckReadyToDownloadAttachments},_setTmCheckReadyToDownloadAttachments:function(f){return this._tmCheckReadyToDownloadAttachments=f},_dlgBeforeDownloadingAttachments:null,_getDlgBeforeDownloadingAttachments:function(){return this._dlgBeforeDownloadingAttachments},_initDlgBeforeDownloadingAttachments:function(){var f=c.getText("準備中...");var g=c.prevent(f);return this._dlgBeforeDownloadingAttachments=g},_dlgReadyToDownloadAttachments:null,_getDlgReadyToDownloadAttachments:function(){return this._dlgReadyToDownloadAttachments||this._initDlgReadyToDownloadAttachments()},_initDlgReadyToDownloadAttachments:function(){var f={buttons:{},content:a("#dlg-mail_view-download-readying"),title:c.getText("ダウンロード"),onclose:this.__closure(function(){if(!this._isReadyToDownloadAttachments()){this._cancelDownloadingAttachments()}})};f.buttons[c.getText("キャンセル")]=this.__closure(function(h){h.close()});var g=new c.Dialog(f);g.initialize();return this._dlgReadyToDownloadAttachments=g},_dlgDownloadAttachments:null,_getDlgDownloadAttachments:function(){return this._dlgDownloadAttachments||this._initDlgDownloadAttachments()},_initDlgDownloadAttachments:function(){var f={buttons:{},content:a("#dlg-mail_view-download"),title:c.getText("ダウンロード")};f.buttons[c.getText("ダウンロード")]=this.__closure(function(){this._downloadAttachmentsLow()});var g=new c.Dialog(f);g.initialize();return this._dlgDownloadAttachments=g},_ajaxLoadHeader:null,_getAjaxLoadHeader:function(){return this._ajaxLoadHeader||this._initAjaxLoadHeader()},_initAjaxLoadHeader:function(){var f=this;var g={getSendData:this.__closure(f._getDataToLoadHeader),onsuccess:this.__closure(this.onsuccessLoadHeader)};if(DENBUN_MODE_XNEO){g.onerror=this.__closure(this.onerrorLoadHeader)}var h=new neo.denbun.Ajax(g);h.initialize();return this._ajaxLoadHeader=h},_ajaxLoadAttachmentList:null,_getAjaxLoadAttachmentList:function(){return this._ajaxLoadAttachmentList||this._initAjaxLoadAttachmentList()},_initAjaxLoadAttachmentList:function(){var f=this;var g={getSendData:this.__closure(f._getDataToLoadAttachmentList),onsuccess:this.__closure(this.onsuccessLoadAttachmentList)};var h=new neo.denbun.Ajax(g);h.initialize();return this._ajaxLoadAttachmentList=h},_ajaxDownloadAttachments:null,_getAjaxDownloadAttachments:function(){return this._ajaxDownloadAttachments||this._initAjaxDownloadAttachments()},_initAjaxDownloadAttachments:function(){var f=this;var g={getSendData:function(){var i={cmd:"mailattachzip",msgid:f.getId()};return i},onsuccess:this.__closure(this.onsuccessDownloadAttachments),onfinish:this.__closure(this.onfinishDownloadAttachments)};var h=new c.Ajax(g);h.initialize();return this._ajaxDownloadAttachments=h},_ajaxCheckReadyToDownloadAttachments:null,_getAjaxCheckReadyToDownloadAttachments:function(){return this._ajaxCheckReadyToDownloadAttachments||this._initAjaxCheckReadyToDownloadAttachments()},_initAjaxCheckReadyToDownloadAttachments:function(){var f=this;var g={getSendData:function(){var i={cmd:"mailattachzipstatus"};return i},onsuccess:this.__closure(this.onsuccessCheckReadyToDownloadAttachments),onerror:this.__closure(this.onerrorCheckReadyToDownloadAttachments)};var h=new c.Ajax(g);h.initialize();return this._ajaxCheckReadyToDownloadAttachments=h},_ajaxCancelDownloadAttachments:null,_getAjaxCancelDownloadAttachments:function(){return this._ajaxCancelDownloadAttachments||this._initAjaxCancelDownloadAttachments()},_initAjaxCancelDownloadAttachments:function(){var f=this;var g={getSendData:function(){var i={cmd:"mailattachzipcancel"};return i}};var h=new c.Ajax(g);h.initialize();return this._ajaxCancelDownloadAttachments=h},_ajaxCreateTemporaryAreaForViewOfMailFile:null,_getAjaxCreateTemporaryAreaForViewOfMailFile:function(){return this._ajaxCreateTemporaryAreaForViewOfMailFile||this._initAjaxCreateTemporaryAreaForViewOfMailFile()},_initAjaxCreateTemporaryAreaForViewOfMailFile:function(){var f=this;var g=c.getUrl(c.CGI_EMLFILE);var h={url:g,getSendData:this.__closure(f._getDataToCreateTemporaryAreaForViewOfMailFile),onsuccess:this.__closure(this.onsuccessCreateTemporaryAreaForViewOfMailFile)};if(DENBUN_MODE_XNEO){h.url=c.getUrl(c.CGI_EML)}var i=new neo.denbun.Ajax(h);i.initialize();return this._ajaxCreateTemporaryAreaForViewOfMailFile=i},_ajaxSendNotification:null,_getAjaxSendNotification:function(){return this._ajaxSendNotification||this._initAjaxSendNotification()},_initAjaxSendNotification:function(){var f=this;var g={getSendData:function(){var i=f._getDataToSendNotification();i.cmd="mailnotifysend";i.msgid=f.getId();return i}};var h=new c.Ajax(g);h.initialize();return this._ajaxSendNotification=h},_elHeader:null,_getElHeader:function(){return this._elHeader||this._initElHeader()},_initElHeader:function(){return this._elHeader=a("#mail-view-header-expanded, #mail-view-header-shortened")},_elHeaderList:null,_getElHeaderList:function(){return this._elHeaderList||this._initElHeaderList()},_initElHeaderList:function(){return this._elHeaderList=a(".mail-view-header-list")},_elSubject:null,_getElSubject:function(){return this._elSubject||this._initElSubject()},_initElSubject:function(){return this._elSubject=a("#mail-view-subject")},_elStatusMessage:null,_getElStatusMessage:function(){return this._elStatusMessage||this._initElStatusMessage()},_initElStatusMessage:function(){return this._elStatusMessage=a("#mail-view-status-message")},_elFrom:null,_getElFrom:function(){return this._elFrom||this._initElFrom()},_initElFrom:function(){return this._elFrom=a(".mail-view-header-from")},_elTo:null,_getElTo:function(){return this._elTo||this._initElTo()},_initElTo:function(){return this._elTo=a(".mail-view-header-to")},_elCc:null,_getElCc:function(){return this._elCc||this._initElCc()},_initElCc:function(){return this._elCc=a(".mail-view-header-cc")},_elBcc:null,_getElBcc:function(){return this._elBcc||this._initElBcc()},_initElBcc:function(){return this._elBcc=a(".mail-view-header-bcc")},_elBccRow:null,_getElBccRow:function(){return this._elBccRow||this._initElBccRow()},_initElBccRow:function(){return this._elBccRow=a("#mail-view-header-bcc-row")},_elDatetime:null,_getElDatetime:function(){return this._elDatetime||this._initElDatetime()},_initElDatetime:function(){return this._elDatetime=a(".mail-view-header-datetime")},_elAttachmentsList:null,_getElAttachmentsList:function(){return this._elAttachmentsList||this._initElAttachmentsList()},_initElAttachmentsList:function(){return this._elAttachmentsList=a("#mail-view-header-attachment-list")},_elDownloadAttachments:null,_getElDownloadAttachments:function(){return this._elDownloadAttachments||this._initElDownloadAttachments()},_initElDownloadAttachments:function(){return this._elDownloadAttachments=a("#mail-view-header-attachment-item-download_all")},_elShowAttachment:null,_getElShowAttachment:function(){return this._elShowAttachment||this._initElShowAttachment()},_initElShowAttachment:function(){return this._elShowAttachment=a("#mail-view-header-show_attachment")},_elToggleHeader:null,_getElToggleHeader:function(){return this._elToggleHeader||this._initElToggleHeader()},_initElToggleHeader:function(){return this._elToggleHeader=a(".mail-view-header-toggle")},_elBody:null,_getElBody:function(){return this._elBody||this._initElBody()},_initElBody:function(){return this._elBody=a("#mail-view-body")},_elBodyFrame:null,_getElBodyFrame:function(){return this._elBodyFrame||this._initElBodyFrame()},_initElBodyFrame:function(){return this._elBodyFrame=a("#mail-view-body-frame")},_dataToAddAddressBookParam:null,_getDataToAddAddressBookParam:function(){return this._dataToAddAddressBookParam},_setDataToAddAddressBookParam:function(f){return this._dataToAddAddressBookParam=f},_dataToCheckDuplicateAddress:null,_getDataToCheckDuplicateAddress:function(){return this._dataToCheckDuplicateAddress},_setDataToCheckDuplicateAddress:function(f){return this._dataToCheckDuplicateAddress=f},_ajaxCheckDuplicateAddress:null,_getAjaxCheckDuplicateAddress:function(){return this._ajaxCheckDuplicateAddress||this._initAjaxCheckDuplicateAddress()},_initAjaxCheckDuplicateAddress:function(){var f=this;var g={getSendData:function(){var i=f._getDataToCheckDuplicateAddress();i.cmd="addrchkduplicate";return i},onsuccess:this.__closure(this.onsuccessCheckDuplicateAddress)};if(DENBUN_MODE_XNEO){g.url=c.getUrl(c.CGI_WMAIL_EML)}var h=new c.Ajax(g);h.initialize();return this._ajaxCheckDuplicateAddress=h},_ajaxCabinetAttachCopy:null,_getAjaxCabinetAttachCopy:function(){return this._ajaxCabinetAttachCopy||this._initAjaxCabinetAttachCopy()},_initAjaxCabinetAttachCopy:function(){var f=this;var g={getSendData:function(){var i={cmd:"mailcmdcopyattach",msgid:f.getId()};return i},onsuccess:this.__closure(this.onsuccessCabinetAttachCopy),onerror:this.__closure(this.onerrorCabinetAttachCopy)};var h=new c.Ajax(g);h.initialize();return this._ajaxCabinetAttachCopy=h},_ajaxCabinetRegist:null,_getAjaxCabinetRegist:function(){return this._ajaxCabinetRegist||this._initAjaxCabinetRegist()},_initAjaxCabinetRegist:function(){var f=this;var g=c.getUrl(c.CGI_ZRCABINET);var h={url:g,type:"POST",getSendData:this.__closure(f._getDataToCabinetRegist),onsuccess:this.__closure(this.onsuccessCabinetRegist),onerror:this.__closure(this.onerrorCabinetRegist)};var i=new c.Ajax(h);i.initialize();return this._ajaxCabinetRegist=i},_dlgCabinetRegist:null,_getDlgCabinetRegist:function(){return this._dlgCabinetRegist},_initDlgCabinetRegist:function(){var f=c.getText("登録中...");var g=c.prevent(f);return this._dlgCabinetRegist=g},_dlgCabinetRegistErr:null,_getDlgCabinetRegistErr:function(){return this._dlgCabinetRegistErr||this._initDlgCabinetRegistErr()},_initDlgCabinetRegistErr:function(){var f={buttons:{},content:a("#dlg-add_cabinet_error"),title:c.getText("警告")};f.buttons[c.getText("OK")]=this.__closure(function(h){h.close()});var g=new c.Dialog(f);g.initialize();return this._dlgCabinetRegistErr=g},_cabTmpnm:null,_getCabTmpnm:function(){return this._cabTmpnm},_setCabTmpnm:function(f){return this._cabTmpnm=f},_cabSubject:null,_getCabSubject:function(){return this._cabSubject},_setCabSubject:function(f){return this._cabSubject=f},_forceChkDispositionNotification:null,_isForceChkDispositionNotification:function(){return this._forceChkDispositionNotification||this._initForceChkDispositionNotification()},_initForceChkDispositionNotification:function(){return this._forceChkDispositionNotification=false},setForceChkDispositionNotification:function(){return this._forceChkDispositionNotification=true},__constructor:function(){},initialize:function(){this._initElDownloadAttachments();this._hook();var h=false;var j=a("[data-action=addSch]");var f=a("[data-action=addCreport]");var g=a("[data-action=addInfo]");var i=a("[data-action=addCab]");if(!c.comSetting.isAvailableSch()){j.hide();h=true}if(!c.comSetting.isAvailableCreport()){f.hide().prev(".popup_menu-item-separator").hide()}else{if(h){f.prev(".popup_menu-item-separator").hide();h=false}}if(!c.comSetting.isAvailableInfo()){g.hide().prev(".popup_menu-item-separator").hide()}else{if(h){g.prev(".popup_menu-item-separator").hide();h=false}}if(!c.comSetting.isAvailableCabinet()){i.hide().prev(".popup_menu-item-separator").hide()}else{if(h){i.prev(".popup_menu-item-separator").hide();h=false}}},_hook:function(){var f;f=c.Mail.getElFork();this.__bind(f,"click","Fork");if(DENBUN_MODE_XNEO){if(c.comSetting.isAvailableSch()||c.comSetting.isAvailableCreport()||c.comSetting.isAvailableInfo()||c.comSetting.isAvailableCabinet()){f=c.Mail.getElOtherFunc();this.__bind(f,"click","OtherFunc")}}f=this._getElToggleHeader();this.__bind(f,"click","ToggleHeader");f=c.Mail.getElAddToAddressBook();this.__bind(f,"click","AddToAddressBook");f=this._getElAttachmentsList();this.__bind(f,"click","AttachmentList");f=this._getElDownloadAttachments();this.__bind(f,"click","DownloadAttachment")},load:function(g,m){var j=d.splitId(g);var i=j.id;var f=j.fid;var l=this._getId();if(i==l){return false}this.clean();this._setId(i);this._setFolderId(f);var k=this._getElBodyFrame();k.css({visibility:"hidden"});if(!i||!f){return false}this._setCallbackLoad(m);var h=this;setTimeout(function(){if(!h._getId()){return}k.css({visibility:"visible"});var n=h._getAjaxLoadHeader();n.sendRequest();h._loadBody()},1);return true},loadForViewOfMailFile:function(h,i){this.clean();this._setViewOfMailFileMode();this._setParamsForViewOfMailFile(h);var g=this._getElBodyFrame();g.css({visibility:"hidden"});if(!h.msgid&&!h.tmpnm){return}this._setCallbackLoad(i);var f=this;setTimeout(function(){g.css({visibility:"visible"});var j=f._getAjaxCreateTemporaryAreaForViewOfMailFile();j.sendRequest()},1)},_getDataToCreateTemporaryAreaForViewOfMailFile:function(){var j=this._getParamsForViewOfMailFile();var i=j[c.PARAM_FOLDER_ID];var f=j[d.PARAM_MESSAGE_ID];var h=j[d.PARAM_TEMPORARY_NUMBER];var g={cmd:"mailfilecreate",encoding:j[d.PARAM_ENCODING]};if(i&&f){g[c.PARAM_FOLDER_ID]=i;g[d.PARAM_MESSAGE_ID]=f;g[d.PARAM_FILE]=j[d.PARAM_FILE];if(DENBUN_MODE_XNEO){g[d.PARAM_FILE_NAME]=j[d.PARAM_FILE_NAME]}}else{if(f){g[d.PARAM_TEMPORARY_MESSAGE_ID]=f;g[d.PARAM_FILE_NO]=j[d.PARAM_FILE];if(DENBUN_MODE_XNEO){g[d.PARAM_FILE_NAME]=j[d.PARAM_FILE_NAME]}}else{if(h){g[d.PARAM_TEMPORARY_NUMBER]=h;g[d.PARAM_FILE_NO]=j[d.PARAM_FILE_NO]}else{return}}}return g},_getDataToLoadHeader:function(){var f;if(this._isViewOfMailFileMode()){f={url:c.getUrl(c.CGI_EMLFILE),cmd:"maildisphead",msgid:this.getTemporaryMessageIdForViewOfMailFile(),proc:"disp"}}else{f={cmd:"maildisphead",msgid:this.getId(),proc:"disp"}}return f},_getDataToLoadAttachmentList:function(){var f;if(this._isViewOfMailFileMode()){f={url:c.getUrl(c.CGI_EMLFILE),cmd:"maildispattach",msgid:this.getTemporaryMessageIdForViewOfMailFile(),proc:"disp"};return f}else{f={cmd:"maildispattach",msgid:this.getId(),proc:"disp"}}return f},_loadBody:function(){var g=this._getBodyUrl();var i=this._getElBodyFrame();if(c.isChrome()||c.isAndroid()){i.attr({src:"about:blank"});setTimeout(function(){i.attr({src:g});i.contents().find("html").empty()},200)}else{i.attr({src:g})}this._getElBody().scrollTop(0);this._getElBody().scrollLeft(0);i.contents().find("html").empty();var h=this;var f=setInterval(function(){if(i.contents().find("body").length===0){return}c.Mail.hookMailBodyExternalLink();if(c.isIpad()){var j=i.contents().find("head")[0];j.appendChild(h._getIframeScript())}clearInterval(f)},200)},_iframeScript:null,_getIframeScript:function(){return this._iframeScript||this._initIframeScript()},_initIframeScript:function(){var f=document.createElement("script");f.type="text/javascript";f.innerHTML=["","(function(){","var startY = 0;","var startX = 0;","var b = document.body;","b.addEventListener('touchstart', function (event) {","    startY = event.targetTouches[0].pageY;","    startX = event.targetTouches[0].pageX;","});","b.addEventListener('touchmove', function (event) {","	   if (event.touches.length !== 1) return;","    event.preventDefault();","    var h = parent.document.getElementById('mail-view-body');","    ","    var posy = event.targetTouches[0].pageY;","    var sty = h.scrollTop - (posy - startY);","    if (window.innerHeight - h.clientHeight - sty <= 0)","        sty = window.innerHeight - h.clientHeight;","    ","    var posx = event.targetTouches[0].pageX;","    var stx = h.scrollLeft - (posx - startX);","    if (window.innterWidth - h.clientWidth - stx <= 0)","        stx = window.innterWidth - h.clientWidth;","    ","    h.scrollTop = sty;","    h.scrollLeft = stx;","});","})();"].join("");return f},_getBodyUrl:function(){var f;if(this._isViewOfMailFileMode()){var h={cmd:"maildispbody",msgid:this.getTemporaryMessageIdForViewOfMailFile(),proc:"html",read:"no"};var g=c.getUrl(c.CGI_EMLFILE);var i=neo.core.joinParam(h);f=g+"?"+i}else{var h={cmd:"maildispbody",msgid:this.getId(),proc:"html",read:"no"};var g=c.getUrl(c.CGI_EML);var i=neo.core.joinParam(h);f=g+"?"+i}return f},_initHeaderData:function(g){var f=a(g).children();this._initPriority(f);this._initNumOfAttachments(f);this._initFlagged(f);this._initUnread(f);this._initNotificationStatus(f);this._initReplyingStatus(f);this._initDateText(f);this._initTimezone(f);this._initFrom(f);this._initTo(f);this._initCc(f);this._initBcc(f);this._initRealFolderType(f);this._initHeaderList(f)},_updateHeader:function(){var h;var i;var k;h=c.Mail.getElFork();h.show();if(DENBUN_MODE_XNEO){if(!this._isViewOfMailFileMode()){if(c.comSetting.isAvailableSch()||c.comSetting.isAvailableCreport()||c.comSetting.isAvailableInfo()||c.comSetting.isAvailableCabinet()){h=c.Mail.getElOtherFunc();h.css("display","inline-block")}}}i=this._getSubject();h=this._getElSubject();k=neo.core.escape(i);if(DENBUN_MODE_XNEO){k=desknets.escapeSpace(k)}else{k=c.escapeSpace(k)}h.html(k);if(c.getCurPageName()!=c.PAGE_MAIL_LIST){this._updateStatusMessages()}i=this._getFrom();h=this._getElFrom();this._addLinkedMail(h,i);i=this._getTo();h=this._getElTo();this._addLinkedMail(h,i);i=this._getCc();h=this._getElCc();this._addLinkedMail(h,i);i=this._getBcc();if(i&&i!=""){h=this._getElBcc();this._addLinkedMail(h,i);h=this._getElBccRow();h.show()}if(DENBUN_MODE_XNEO){var j=this._getDateText();if(j&&j!=""){i=desknets.dateTime.dispDateTime(j)}}else{i=d.getDatetimeText(this._getDateText(),this._getTimezone(),true)}h=this._getElDatetime();h.text(i);if(a.browser.webkit){var f=this._getElHeader().filter(":visible");f.hide();setTimeout(function(){f.show();d.updateViewerSize()},1)}var g=this._getElHeaderList();g.css({visibility:"visible"});this._sendDispositionNotification()},_addLinkedMail:function(g,h){g.append(this._getLinkedMailElement(h));if(!DENBUN_MODE_XNEO||c.comSetting.isAvailableAddress()){var f=g.find("a");this.__bind(f,"click","linkedMail")}return},_getLinkedMailElement:function(l){var n=c.getParsedAddressesToAddrAndName(l);var j=a("<span />");var k=n.length;for(var h=0;h<k;h++){var f=n[h];if(h){j.append("<span>, </span>")}if(f.name!=""){var m=c.getEncodeQuotEscape(f.name);m=neo.core.escape(m);if(DENBUN_MODE_XNEO){m=desknets.escapeSpace(m)}else{m=c.escapeSpace(m)}j.append("<span>&quot;"+m+"&quot;&lt;</span>")}if(DENBUN_MODE_XNEO&&!c.comSetting.isAvailableAddress()){var g=a("<span>"+f.address+"</span>")}else{var g=a('<a href="#">'+f.address+"</a>");var l="";if(f.name!=""){l='"'+c.getEncodeQuotEscape(f.name)+'"'}l+="<"+f.address+">";g.attr("data-value",l)}j.append(g);if(f.name!=""){j.append("<span>&gt;</span>")}}return j},setFlag:function(f){this._setFlagged(f);if(c.getCurPageName()!=c.PAGE_MAIL_LIST){this._updateStatusMessages()}},_cleanStatusMessages:function(){var f=this._getElStatusMessage();f.hide().empty()},_updateStatusMessages:function(){this._cleanStatusMessages();var g=this._getStatusMessages();var j=this._getElStatusMessage();for(var h=0;h<g.length;h++){var k=g[h];var f=a("<li />").text(k);j.append(f)}if(g.length>0){j.show()}},_getStatusMessages:function(){var f=[];var g=this._getPriorityMessage();if(g){f.push(g)}g=this._getFlagMessage();if(g){f.push(g)}g=this._getReplyingMessage();if(g){f.push(g)}return f},_getPriorityMessage:function(){var h=1;var f=5;var g=this._getPriority();var i;switch(g){case h:i=c.getText("このメッセージは、重要度は「高」が設定されています");break;case f:i=c.getText("このメッセージは、重要度は「低」が設定されています");break;default:i=null}return i},_getFlagMessage:function(){var f=this._isFlagged();var g;if(f){g=c.getText("このメッセージは、フラグが設定されています")}else{g=null}return g},_getReplyingMessage:function(){var f=1;var g=2;var i=this._getReplyingStatus();var h;switch(i){case f:h=c.getText("このメッセージは、返信しました");break;case g:h=c.getText("このメッセージは、転送しました");break;default:h=null}return h},_sendDispositionNotification:function(){if(!this._isForceChkDispositionNotification()){if(c.parent){return}}if(!this._hasDispositionNotification()){return}if(!this._getFlgConfirmBeforeSendNotification()){return}var i=c.getText("開封確認メールを送信しますか？");var f="no";var g=this;var h={onok:function(){f=undefined},onclose:function(){var k={proc:f};g._setDataToSendNotification(k);var j=g._getAjaxSendNotification();j.sendRequest()}};c.confirm(i,h)},_hasDispositionNotification:function(){var f=this._getNotificationStatus();return(f=="1")},_getFlgConfirmBeforeSendNotification:function(){return c.comSetting.getFlgConfirmBeforeSendNotification()},_initAttachmentListData:function(g){var f=a(g).children();this._initAttachmentList(f)},_updateAttachmentList:function(){var j=this._getAttachmentList();var g=this._getElAttachmentsList();var m=this._getElShowAttachment();if(j.length<1){g.hide();m.css({visibility:"hidden"})}else{g.empty();if(!this._isViewOfMailFileMode()&&j.length>1){var f=this._getElDownloadAttachments();g.append(f)}for(var h=0;h<j.length;h++){var l=j[h];var k=this._buildElAttachmentItem(l,h);g.append(k)}g.show();m.css({visibility:"visible"})}},_buildElAttachmentItem:function(k,j){var i=this._getAttachmentUrl(k,j);var h=k.name;var g=a("<a />").attr({href:i,target:"_blank",title:h}).text(h);var f=a("<li />").addClass([c.CLS_INLINE_LIST_ITEM,b.CLS_ATTACHMENT_LIST_ITEM,].join(" "));f.append(g);return f},_getAttachmentUrl:function(i,g){var f;if(this._isViewOfMailFileMode()){var h={cmd:"maildownloadattach",efname:i.name,file:i.id,mimetype:i.mimeType,msgid:this.getTemporaryMessageIdForViewOfMailFile()};var f=[c.getUrl(c.CGI_EMLFILE),"?",neo.core.joinParam(h)].join("")}else{var h={cmd:"maildownloadattach",efname:i.name,encoding:i.encoding,fid:this._getFolderId(),file:i.id,mimetype:i.mimeType,msgid:this._getId()};var f=[c.getUrl(c.CGI_EML),"?",neo.core.joinParam(h)].join("")}return f},_loadAttachments:function(){if(this._getNumOfAttachments()>0&&(this._isViewOfMailFileMode()||this._getId())){var f=this._getAjaxLoadAttachmentList();f.sendRequest()}},clean:function(){var h;this._initViewOfMailFileMode();this._setId(null);this._setFolderId(null);h=c.Mail.getElFork();h.hide();if(DENBUN_MODE_XNEO){h=c.Mail.getElOtherFunc();h.hide();c.Mail.hideMailBodyCutMsg();c.Mail.hideMailHtmlToTextWarnMsg()}var f=this._getElHeaderList();f.css({visibility:""});var g=c.Mail.getElAddToAddressBook();g.blur();h=this._getElSubject();h.text("");this._cleanStatusMessages();h=this._getElFrom();h.find("a").die();h.empty();h=this._getElTo();h.find("a").die();h.empty();h=this._getElCc();h.find("a").die();h.empty();h=this._getElBcc();h.find("a").die();h.empty();h=this._getElBccRow();h.hide();h=this._getElDatetime();h.text("");h=this._getElAttachmentsList();h.hide();h=this._getElShowAttachment();h.css({visibility:"hidden"});if(c.isIpad()){h=this._getElBody();h.scrollTop(0)}h=this._getElBodyFrame();h.attr({src:"about:blank"}).width("")},_fork:function(f){var g={};g[c.PARAM_MAIL_ID]=this._getId();g[c.PARAM_FOLDER_ID]=this._getFolderId();g[c.PARAM_FORK]=1;var h=c.Mail.getListDataForView();if(h){g[c.Mail.PARAM_LISTDATA_KEY]=h[c.Mail.PARAM_LISTDATA_KEY]}c.openPage(c.PAGE_MAIL_VIEW,g)},toggleHeader:function(g){var f=this._getElHeader();f.toggle();d.updateViewerSize()},addToAddressBook:function(k){if(!DENBUN_MODE_XNEO){k=this._getFrom()}var j=c.getParsedMailToAddressAndName(k);var f=j.address;var h={destination:k};this._setDataToAddAddressBookParam(h);var i={Mail:f};this._setDataToCheckDuplicateAddress(i);var g=this._getAjaxCheckDuplicateAddress();g.sendRequest()},_addToAddressBookFromMailLink:function(g){var f=g.text();var j=g.attr("data-value");var i={destination:j};this._setDataToAddAddressBookParam(i);var k={Mail:f};this._setDataToCheckDuplicateAddress(k);var h=this._getAjaxCheckDuplicateAddress();h.sendRequest()},_openAddressEdit:function(g){var f=c.getCurPageName();g[c.PARAM_BACK_PAGE]=f;c.openPage(c.PAGE_ADDRESS_EDIT,g)},_downloadAttachments:function(){this._initReadyToDownloadAttachments();var g=this._initDlgBeforeDownloadingAttachments();g.open();var f=this._getAjaxDownloadAttachments();f.sendRequest()},_checkReadyToDownloadAttachments:function(){var h=3000;var g=this;var f=setTimeout(function(){var i=g._getAjaxCheckReadyToDownloadAttachments();i.sendRequest()},h);this._setTmCheckReadyToDownloadAttachments(f)},_isReadyToDownloadAttachmentsComplete:function(g){var f=g.batchstscode;return(f=="0")},_showDownloadingAttachmentsError:function(j){var i=-10018;if(DENBUN_MODE_XNEO){i=-6028}var h=parseInt(j.batchstscode)||-1;if(h==0||h==i){return false}else{var g=j.batchstsmsg;var f={title:c.getText("ダウンロード")};c.alert(g,f,"E");return true}},_openDlgDownloadAttachments:function(){var g=this._getDlgReadyToDownloadAttachments();g.close();var f=this._getDlgDownloadAttachments();f.open()},_downloadAttachmentsLow:function(){var f=this._getDownloadAttachmentsUrl();window.open(f,"_blank");var g=this._getDlgDownloadAttachments();g.close()},_getDownloadAttachmentsUrl:function(){var h="$YYYY$$month$$DD$$hh$$mm$$ss$.zip";var g=neo.core.buildDateByFormat(new Date(),h);var f=c.getUrl(c.CGI_EML)+"?"+neo.core.joinParam({archivename:g,cmd:"mailattachzipdl"});return f},_cancelDownloadingAttachments:function(){var f=this._getTmCheckReadyToDownloadAttachments();clearTimeout(f);this._setTmCheckReadyToDownloadAttachments(f);var g=this._getAjaxCancelDownloadAttachments();g.sendRequest()},addSch:function(){var f=this;var g=desknets.Resource.Message.com_open_schadd;c.confirm(g,{onok:function(){var h=f._getConnectAppOption();desknets.connectapp.connectSchNoConf(h)}})},addCreport:function(){var f=this;var g=desknets.Resource.Message.com_open_creportadd;c.confirm(g,{onok:function(){var h=f._getConnectAppOption();desknets.connectapp.connectCreportNoConf(h)}})},addInfo:function(){var f=this;desknets.connectapp.checkAccsInfoCategory(function(i){if(i===true){var h=desknets.Resource.Message.com_open_infoadd;c.confirm(h,{onok:function(){var j=f._getConnectAppOption();desknets.connectapp.connectInfo(j,true)}})}else{var g=desknets.parseErrorInfo(desknets.Resource.Message.info_guide_add_noperm);c.alert(g.message)}})},addCab:function(){var f=this;f.onclickAddCabinet()},_getConnectAppOption:function(){var f=this;var h;var g;var i={};h=f.getId();i.connectid=h;i.restmodule=c.CGI_EML;i.restcmd="mailcmdconnectapp";return i},updateSize:function(){this._updateBodySize()},_updateBodySize:function(){var g=this._getElBody();var j=g.get(0).getBoundingClientRect().top;var i=c.getClientSize();var h=i.height;var f=h-j;g.height(f)},_updateSideAreaSize:function(g){var f=this._getElBodyFrame();var i=f.offset();var h=g-i.left;f.width(h)},getId:function(){var f=this._getFolderId();var g=this._getId();var h;if(f&&g){h=f+"_"+g}else{h=null}return h},_getDataToCabinetRegist:function(){var f=this._getCabSubject();if(!f||f==""){f="(no subject)"}var g={cmd:"cabregist",modulecmd:"mailimapcmdcopyattach",resformat:"xml",tmppid:this._getCabTmpnm()||"",Name:f};return g},onsuccessLoadHeader:function(g,f,i){if(!this._isViewOfMailFileMode()){var j=c.getAjaxSendParams(f);var h=j.msgid;if(h!=this.getId()){return}}this._initHeaderData(g);this._updateHeader();this._loadAttachments();d.updateViewerSize();var k=this._getCallbackLoad();if(typeof k=="function"){k()}},onerrorLoadHeader:function(){this._initFrom(null);this._initHeaderList(null)},onsuccessLoadAttachmentList:function(g,f,i){if(!this._isViewOfMailFileMode()){var j=c.getAjaxSendParams(f);var h=j.msgid;if(h!=this.getId()){return}}this._initAttachmentListData(g);this._updateAttachmentList();d.updateViewerSize()},onsuccessCreateTemporaryAreaForViewOfMailFile:function(h,g,i){var f=a(h).children();var j=f.children("tmpmsgid").text();this.setTemporaryMessageIdForViewOfMailFile(j);var k=this._getAjaxLoadHeader();k.sendRequest();this._loadBody()},onclickFork:function(f,g){this._fork()},onclickToggleHeader:function(f,g){this.toggleHeader(a(g))},onclickAddToAddressBook:function(f,g){this.addToAddressBook()},onclickAttachmentList:function(h,i){var g=a(h.target);var f=g.attr("href");if(!f){return}var j=neo.core.splitParam(f);if(d.isMailFileParams(j)){d.openViewOfMailFileFrom(j);h.preventDefault()}},onclickDownloadAttachment:function(f,g){this._downloadAttachments()},onsuccessDownloadAttachments:function(g,f,h){var i=this._getDlgReadyToDownloadAttachments();i.open();this._checkReadyToDownloadAttachments()},onfinishDownloadAttachments:function(){var f=this._getDlgBeforeDownloadingAttachments();f.close()},onsuccessCheckReadyToDownloadAttachments:function(g,f,h){var i=c.parseFlatData(g);if(this._isReadyToDownloadAttachmentsComplete(i)){this._setReadyToDownloadAttachments(true);this._openDlgDownloadAttachments()}else{if(this._showDownloadingAttachmentsError(i)){this._setReadyToDownloadAttachments(true);var j=this._getDlgReadyToDownloadAttachments();j.close()}else{this._checkReadyToDownloadAttachments()}}},onerrorCheckReadyToDownloadAttachments:function(){var f=this._getDlgReadyToDownloadAttachments();f.close()},onclicklinkedMail:function(h,i){var g=a(h.target);var f=g.attr("href");if(!f){return}this._addToAddressBookFromMailLink(g)},onsuccessCheckDuplicateAddress:function(i,h,k){var f=a(i).children();var j=f.children("exist").text();var m=this._getDataToAddAddressBookParam();if(j=="1"){var l=c.getText("既に同じメールアドレスが登録されていますが、\nアドレス帳に追加しますか？");var g=this;c.confirm(l,{onok:function(){g._openAddressEdit(m)}})}else{this._openAddressEdit(m)}},onclickAddCabinet:function(h,i){var g=desknets.Resource.Message.com_cab_regist;var f=this;c.confirm(g,{onok:function(){f._setCabTmpnm(null);f._setCabSubject(null);var k=f._initDlgCabinetRegist();k.open();var j=f._getAjaxCabinetAttachCopy();j.sendRequest()}})},onerrorCabinetAttachCopy:function(){var f=this._getDlgCabinetRegist();f.close()},onsuccessCabinetAttachCopy:function(g,f,h){var j=c.parseFlatData(g);this._setCabTmpnm(j[d.PARAM_TEMPORARY_NUMBER]);this._setCabSubject(j[d.PARAM_SUBJECT]);var i=this._getAjaxCabinetRegist();i.sendRequest()},onerrorCabinetRegist:function(j,i,l){var k=this._getDlgCabinetRegist();k.close();if(l.errorno=="-5110"){var j=(l.errormessage||"");var g=j.indexOf(":",0);if(g>=0){g++;j=j.substring(g)}var h='<a href="'+c.getUrl(c.CGI_ZCABINET)+'?cmd=cabindex" target="_blank">'+desknets.Resource.com_cab+"</a>";var f=desknets.Resource.Message.com_cab_folderadd;f=f.replace("{{cabinet}}",h);a("#dlg-add_cabinet_error-message").text(j);a("#dlg-add_cabinet_error-link").html(f);var k=this._getDlgCabinetRegistErr();k.open();return false}},onsuccessCabinetRegist:function(g,f,h){var m=this._getDlgCabinetRegist();m.close();var k=c.parseFlatData(g);var j=k.folder;var l=c.getText("キャビネットのフォルダ（$$）に追加しました。");var i=neo.core.replace(l,j);c.notify(i)},onclickOtherFunc:function(h,i){var f=a(h.target).closest(".mail-view-otherfunc");var g=c.getRect(f,true);var j={left:g.left,top:g.top+g.height};c.app.showMenu("mail_view","otherfunc",j)},__closure:c.__closure,__bind:c.__bind,banpei:null}});b.constructor()})(jQuery);(function(b){var d=neo.core.readyNamespace("neo.denbun.Mail.Operator");if(!d){return}var c=neo.denbun;var a=neo.denbun.Mail.Operator=new neo.core.Class({classProperties:{SPAM_TYPE_DOMAIN:"1",SPAM_TYPE_ADDRESS:"2",constructor:function(){}},properties:{_tmGetReadyingDownloadStatus:null,_getTmGetReadyingDownloadStatus:function(){return this._tmGetReadyingDownloadStatus},_setTmGetReadyingDownloadStatus:function(e){return this._tmGetReadyingDownloadStatus=e},_dataToGetNewMessageContent:null,_getDataToGetNewMessageContent:function(){return this._dataToGetNewMessageContent},_setDataToGetNewMessageContent:function(e){return this._dataToGetNewMessageContent=e},_dataToRemove:null,_getDataToRemove:function(){return this._dataToRemove},_setDataToRemove:function(e){return this._dataToRemove=e},_callbackRemove:null,_getCallbackRemove:function(){return this._callbackRemove},_setCallbackRemove:function(e){return this._callbackRemove=e},_dataToDownload:null,_getDataToDownload:function(){return this._dataToDownload},_setDataToDownload:function(e){return this._dataToDownload=e},_dataToAddSpam:null,_getDataToAddSpam:function(){return this._dataToAddSpam},_setDataToAddSpam:function(e){return this._dataToAddSpam=e},_dataToFilter:null,_getDataToFilter:function(){return this._dataToFilter},_setDataToFilter:function(e){return this._dataToFilter=e},_dataToSetFlag:null,_getDataToSetFlag:function(){return this._dataToSetFlag},_setDataToSetFlag:function(e){return this._dataToSetFlag=e},_dataToSetUnread:null,_getDataToSetUnread:function(){return this._dataToSetUnread},_setDataToSetUnread:function(e){return this._dataToSetUnread=e},_dataToMoveMails:null,_getDataToMoveMails:function(){return this._dataToMoveMails},_setDataToMoveMails:function(e){return this._dataToMoveMails=e},_readiedDownload:null,_isReadiedDownload:function(){return this._readiedDownload||this._initReadiedDownload()},_initReadiedDownload:function(){return this._readiedDownload=false},_setReadiedDownload:function(e){return this._readiedDownload=e},_dlgBeforeDownloading:null,_getDlgBeforeDownloading:function(){return this._dlgBeforeDownloading},_initDlgBeforeDownloading:function(){var e=c.getText("準備中...");var f=c.prevent(e);return this._dlgBeforeDownloading=f},_dlgReadyingDownload:null,_getDlgReadyingDownload:function(){return this._dlgReadyingDownload||this._initDlgReadyingDownload()},_initDlgReadyingDownload:function(){var e={buttons:{},content:b("#dlg-mail_list-download-readying"),title:c.getText("ダウンロード"),onclose:this.__closure(function(){if(!this._isReadiedDownload()){this._cancelDownload()}})};e.buttons[c.getText("キャンセル")]=this.__closure(function(g){g.close()});var f=new c.Dialog(e);f.initialize();return this._dlgReadyingDownload=f},_dlgDownload:null,_getDlgDownload:function(){return this._dlgDownload||this._initDlgDownload()},_initDlgDownload:function(){var e={buttons:{},content:b("#dlg-mail_list-download"),title:c.getText("ダウンロード")};e.buttons[c.getText("ダウンロード")]=this.__closure(function(){this._downloadLow()});var f=new c.Dialog(e);f.initialize();return this._dlgDownload=f},_dlgFiltering:null,_getDlgFiltering:function(){return this._dlgFiltering},_initDlgFiltering:function(){var e=c.getText("実行中...");var f=c.prevent(e);return this._dlgFiltering=f},_ajaxRemove:null,_getAjaxRemove:function(){return this._ajaxRemove||this._initAjaxRemove()},_initAjaxRemove:function(){var e=this;var f={getSendData:function(){var h=e._getDataToRemove();if(e._isSearchModeTable()){h.cmd="mailsearchdel"}else{h.cmd="maildel"}return h},onsuccess:this.__closure(this.onsuccessRemove)};var g=new c.Ajax(f);g.initialize();return this._ajaxRemove=g},_ajaxDownload:null,_getAjaxDownload:function(){return this._ajaxDownload||this._initAjaxDownload()},_initAjaxDownload:function(){var e=this;var f={getSendData:function(){var h=e._getDataToDownload();h.cmd="mailcomp_l";return h},onsuccess:this.__closure(this.onsuccessDownload),onfinish:this.__closure(this.onfinishDownload)};var g=new c.Ajax(f);g.initialize();return this._ajaxDownload=g},_ajaxDownloadSearchResult:null,_getAjaxDownloadSearchResult:function(){return this._ajaxDownloadSearchResult||this._initAjaxDownloadSearchResult()},_initAjaxDownloadSearchResult:function(){var e=this;var f={getSendData:function(){var h={};h.cmd="mailcomp_s";return h},onsuccess:this.__closure(this.onsuccessDownload),onfinish:this.__closure(this.onfinishDownload)};var g=new c.Ajax(f);g.initialize();return this._ajaxDownloadSearchResult=g},_ajaxGetReadyingDownloadStatus:null,_getAjaxGetReadyingDownloadStatus:function(){return this._ajaxGetReadyingDownloadStatus||this._initAjaxGetReadyingDownloadStatus()},_initAjaxGetReadyingDownloadStatus:function(){var e=this;var f={getSendData:function(){var h={cmd:"mailcompstatus"};return h},onsuccess:this.__closure(this.onsuccessGetReadyingDownloadStatus),onerror:this.__closure(this.onerrorGetReadyingDownloadStatus)};var g=new c.Ajax(f);g.initialize();return this._ajaxGetReadyingDownloadStatus=g},_ajaxCancelDownload:null,_getAjaxCancelDownload:function(){return this._ajaxCancelDownload||this._initAjaxCancelDownload()},_initAjaxCancelDownload:function(){var e=this;var f={getSendData:function(){var h={cmd:"mailcompcancel"};return h}};var g=new c.Ajax(f);g.initialize();return this._ajaxCancelDownload=g},_ajaxAddSpam:null,_getAjaxAddSpam:function(){return this._ajaxAddSpam||this._initAjaxAddSpam()},_initAjaxAddSpam:function(){var e=this;var f={getSendData:function(){var h=e._getDataToAddSpam();h.cmd="mailtroubleadd";return h},onsuccess:this.__closure(this.onsuccessAddSpam)};var g=new c.Ajax(f);g.initialize();return this._ajaxAddSpam=g},_ajaxFilter:null,_getAjaxFilter:function(){return this._ajaxFilter||this._initAjaxFilter()},_initAjaxFilter:function(){var e=this;var f={getSendData:function(){var h=e._getDataToFilter();h.cmd="maillistfilter";return h},onsuccess:this.__closure(this.onsuccessFilter),onerror:this.__closure(this.onerrorFilter)};var g=new c.Ajax(f);g.initialize();return this._ajaxFilter=g},_ajaxSetFlag:null,_getAjaxSetFlag:function(){return this._ajaxSetFlag||this._initAjaxSetFlag()},_initAjaxSetFlag:function(){var e=this;var f={getSendData:function(){var h=e._getDataToSetFlag();if(e._isSearchModeTable()){h.cmd="mailsearchflag"}else{h.cmd="mailflag"}return h},onsuccess:this.__closure(this.onsuccessSetFlag)};var g=new c.Ajax(f);g.initialize();return this._ajaxSetFlag=g},_ajaxSetUnread:null,_getAjaxSetUnread:function(){return this._ajaxSetUnread||this._initAjaxSetUnread()},_initAjaxSetUnread:function(){var e=this;var f={getSendData:function(){var h=e._getDataToSetUnread();if(e._isSearchModeTable()){h.cmd="mailsearchopen"}else{h.cmd="mailopen"}return h},onsuccess:this.__closure(this.onsuccessSetUnread)};var g=new c.Ajax(f);g.initialize();return this._ajaxSetUnread=g},_ajaxMoveMails:null,_getAjaxMoveMails:function(){return this._ajaxMoveMails||this._initAjaxMoveMails()},_initAjaxMoveMails:function(){var e=this;var f={getSendData:function(){var h=e._getDataToMoveMails();if(e._isSearchModeTable()){h.cmd="mailsearchmove"}else{h.cmd="mailmove"}return h},onsuccess:this.__closure(this.onsuccessMoveMails)};var g=new c.Ajax(f);g.initialize();return this._ajaxMoveMails=g},_elDownloadSuccessMessage:null,_getElDownloadSuccessMessage:function(){return this._elDownloadSuccessMessage||this._initElDownloadSuccessMessage()},_initElDownloadSuccessMessage:function(){return this._elDownloadSuccessMessage=b("#dlg-mail_list-download-message-success")},_elDownloadFailureMessage:null,_getElDownloadFailureMessage:function(){return this._elDownloadFailureMessage||this._initElDownloadFailureMessage()},_initElDownloadFailureMessage:function(){return this._elDownloadFailureMessage=b("#dlg-mail_list-download-message-failure")},setting:null,_getListPage:function(){return this.setting.listPage},_getFolders:function(){return this.setting.folders},_getTable:function(){return this.setting.table},_getViewer:function(){return this.setting.viewer},_getViewPage:function(){return this.setting.viewPage},__constructor:function(e){this.setting=e},initialize:function(){this._hook()},_hook:function(){var e;e=c.Mail.getElFork();this.__bind(e,"click","ForkViewer")},receive:function(){this._updateFolders()},_updateFolders:function(g,e){var f=this._getListPage();f.updateFolders(g,e)},reply:function(g,f){var e={};e[c.Mail.EditPage.PARAM_MAIL_MODE]=c.Mail.EditPage.MODE_REPLY;e[c.Mail.EditPage.PARAM_MAIL_ID]=g;this._edit(e,f);if(!c.isIpadiOS6()){this.setUnread([g],false)}},replyAll:function(g,f){var e={};e[c.Mail.EditPage.PARAM_MAIL_MODE]=c.Mail.EditPage.MODE_REPLY_ALL;e[c.Mail.EditPage.PARAM_MAIL_ID]=g;this._edit(e,f);if(!c.isIpadiOS6()){this.setUnread([g],false)}},forward:function(g,f){var e={};e[c.Mail.EditPage.PARAM_MAIL_MODE]=c.Mail.EditPage.MODE_FORWARD;e[c.Mail.EditPage.PARAM_MAIL_ID]=g;this._edit(e,f);if(!c.isIpadiOS6()){this.setUnread([g],false)}},editAgain:function(g,f){var e={};e[c.Mail.EditPage.PARAM_MAIL_MODE]=c.Mail.EditPage.MODE_EDIT_AGAIN;e[c.Mail.EditPage.PARAM_MAIL_ID]=g;this._edit(e,f)},writeToSender:function(g,f){var e={};e[c.Mail.EditPage.PARAM_MAIL_MODE]=c.Mail.EditPage.MODE_WRITE_TO_SENDER;e[c.Mail.EditPage.PARAM_MAIL_ID]=g;this._edit(e,f)},restartEditting:function(f){var e={};e[c.Mail.EditPage.PARAM_MAIL_MODE]=c.Mail.EditPage.MODE_RESTART_EDITTING;e[c.Mail.EditPage.PARAM_MAIL_ID]=f;this._edit(e,true);if(!c.isIpadiOS6()){this.setUnread([f],false)}},_edit:function(g,f){if(f===true){g[c.PARAM_FORK]=1}var e=this._getListPage();if(e){e._getElToolbar().find("."+c.App.Menu.CLS_BUTTON).blur()}c.app.openPage(c.PAGE_MAIL_EDIT,g)},remove:function(i,j){this._setCallbackRemove(j);var g=this;var e;var f={};if(c.getCurPageName()==c.PAGE_MAIL_LIST){e=this._getListPage()}else{if(c.getCurPageName()==c.PAGE_MAIL_VIEW){e=this._getViewPage()}}if(e){f=e.getRemoveMessage()}var h={onok:function(){g._removeLow(i)}};c.confirm(f.message,h,f.addmessage)},_removeLow:function(e){var g={msgid:e};this._setDataToRemove(g);var f=this._getAjaxRemove();f.sendRequest()},print:function(i,h){if(!DENBUN_MODE_XNEO){var j=this._getViewer();j.print()}var e=this._getUrlToPrint(i,h);if(!e){return}var g="";if(!c.isAndroid()){g="menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=yes,height=600,width=650"}var f=window.open(e,null,g)},_getUrlToPrint:function(j,i){var f;if(!!i){if(!j){return null}f=c.getUrl(c.CGI_EMLFILE)+"?"+neo.core.joinParam({cmd:"mailprint",msgid:j})}else{var h=c.Mail.splitId(j);var e=h.fid;var g=h.id;if(!e||!g){return null}f=c.getUrl(c.CGI_EML)+"?"+neo.core.joinParam({cmd:"mailprint",fid:e,msgid:g})}return f},download:function(e){this._initReadiedDownload();var g={msgid:e};this._setDataToDownload(g);var h=this._initDlgBeforeDownloading();h.open();var f=this._getAjaxDownload();f.sendRequest()},downloadSearchResult:function(){this._initReadiedDownload();var f=this._initDlgBeforeDownloading();f.open();var e=this._getAjaxDownloadSearchResult();e.sendRequest()},_kickGetReadyingDownloadStatus:function(){var g=3000;var f=this;var e=setTimeout(function(){var h=f._getAjaxGetReadyingDownloadStatus();h.sendRequest()},g);this._setTmGetReadyingDownloadStatus(e)},_killGetReadyingDownloadStatus:function(){var e=this._getTmGetReadyingDownloadStatus();clearTimeout(e);this._setTmGetReadyingDownloadStatus(null)},_isDownloadComplete:function(f){var e=f.batchstscode;return(e=="0")},_isDownloadSucceeded:function(f){var g=parseInt(f.procnum)||-1;var e=parseInt(f.totalnum)||-1;return(g>0&&g==e)},_showDownloadError:function(i){var h=-10018;if(DENBUN_MODE_XNEO){h=-6028}var g=parseInt(i.batchstscode)||-1;if(g==0||g==h){return false}else{var f=i.batchstsmsg;var e={title:c.getText("ダウンロード")};c.alert(f,e,"E");return true}},_openDlgDownload:function(h){var f=this._getDlgReadyingDownload();f.close();var g=this._getElDownloadSuccessMessage();g.toggle(h);var i=this._getElDownloadFailureMessage();i.toggle(!h);var e=this._getDlgDownload();e.open()},_downloadLow:function(){var f=this._getDownloadUrl();window.open(f,"_blank");var e=this._getDlgDownload();e.close()},_getDownloadUrl:function(){var g="$YYYY$$month$$DD$$hh$$mm$$ss$.zip";var f=neo.core.buildDateByFormat(new Date(),g);var e=c.getUrl(c.CGI_EML)+"?"+neo.core.joinParam({archivename:f,cmd:"mailcompdl"});return e},_cancelDownload:function(){this._killGetReadyingDownloadStatus();var e=this._getAjaxCancelDownload();e.sendRequest()},addToAddressBook:function(g,f){var e=this;this._loadMailHeaderContent(g,f,true,function(j,h,m){var k=e._getMailHeaderList(j);var o="";for(var l=0;l<k.length;l++){var n=k[l];if(neo.core.isString(n.key)&&n.key.toLowerCase()=="from"){o=n.value;break}}e._addToAddressBook(o)})},_addToAddressBook:function(f){var e=this._getViewer();e.addToAddressBook(f)},addSpamDomain:function(e){this._addSpam(e,a.SPAM_TYPE_DOMAIN)},addSpamAddress:function(e){this._addSpam(e,a.SPAM_TYPE_ADDRESS)},_addSpam:function(f,e){var h={msgid:f,proc:e};this._setDataToAddSpam(h);var g=this._getAjaxAddSpam();g.sendRequest()},_showSuccessMessageToAddSpam:function(f,e){var g;if(f==a.SPAM_TYPE_DOMAIN){g=c.getText("選択されたメールの差出人のドメインは「迷惑メール設定」に追加されました。")}else{g=c.getText("選択されたメールの差出人のアドレスは「迷惑メール設定」に追加されました。")}if(!e){g+="\n\n"+c.getText("「迷惑メール設定」を有効にするには[設定]-[迷惑メール設定]で「迷惑メール処理」を「行う」に設定してください。")}c.notify(g)},showHeaderDetail:function(i,h){if(!DENBUN_MODE_XNEO){var g=this._getMailHeaderContent();if(!g){return}var f={content:"<pre>"+g+"</pre>",height:600,title:c.getText("メールヘッダー"),width:620};this._openNewWindow(f);return}var e=this;this._loadMailHeaderContent(i,h,false,function(k,j,m){var l=e._getMailHeaderContent(k);var n="<pre>"+l+"</pre>";var m={height:600,width:620,title:c.getText("メールヘッダー"),content:n};e._openNewWindow(m)})},_getMailHeaderContent:function(e){var f;if(DENBUN_MODE_XNEO){f=this._getMailHeaderList(e)}else{var j=this._getViewer();if(!j){return null}var f=j.getHeaderList();if(!f){return null}}var h="";for(var g=0;g<f.length;g++){var k=f[g];h+=neo.core.escape(k.key)+": "+neo.core.escape(k.value)+"\n"}return h},_getMailHeaderList:function(f){var g=[];var e=b(f).children();if(!!e){e.find("> list > item").each(function(k,m){var j=b(m);var h=j.attr("id");var l=j.text();g.push({key:h,value:l})})}return g},_loadMailHeaderContent:function(l,k,h,e){var f=this;var j;if(!!k){j={url:c.getUrl(c.CGI_EMLFILE),cmd:"maildisphead",msgid:l,proc:"disp"}}else{j={cmd:"maildisphead",msgid:l,proc:"disp"}}var g={async:h,getSendData:function(){return j},onsuccess:e};var i=new neo.denbun.Ajax(g);i.initialize();i.sendRequest()},filter:function(f){var e=c.getText("選択したメールを振分けてもよろしいですか？");c.confirm(e,{onok:this.__closure(function(){var h={msgid:f};this._setDataToFilter(h);var g=this._getAjaxFilter();g.sendRequest();this._openDlgFiltering()})})},_openDlgFiltering:function(){var e=this._initDlgFiltering();e.open()},_closeDlgFiltering:function(){var e=this._getDlgFiltering();e.close()},setFlag:function(f,e){this._updateFlagData(f,e)},_updateFlagData:function(f,e){var h={msgid:f,proc:(e?"on":"off")};this._setDataToSetFlag(h);var g=this._getAjaxSetFlag();g.sendRequest()},_updateFlagStyle:function(g,e){var f=this._getTable();f.updateFlagStyle(g,e)},setUnread:function(j,g){var h=this._getTable();var f=[];for(var e=0;e<j.length;e++){var l=j[e];if(DENBUN_MODE_XNEO){if(!h||l&&h.isUnread(l)!=g){f.push(l)}}else{if(l&&h&&h.isUnread(l)!=g){f.push(l)}}}if(f.length>0){this._updateUnreadData(f,g)}var k=this._getListPage();k&&k.killReadTimer()},_updateUnreadData:function(f,e){var h={msgid:f,proc:(e?"close":"open")};this._setDataToSetUnread(h);var g=this._getAjaxSetUnread();g.sendRequest()},_updateUnreadStyle:function(g,e){var f=this._getTable();f.updateUnreadStyle(g,e)},openMail:function(h){var e=this;var f=c.Mail.splitId(h);var g=c.Mail.getListDataForView();if(g){f[c.Mail.PARAM_LISTDATA_KEY]=g[c.Mail.PARAM_LISTDATA_KEY]}f[c.PARAM_FORK]=1;c.app.openPage(c.PAGE_MAIL_VIEW,f)},moveMails:function(h,g){var f={msgid:h,tofid:g};this._setDataToMoveMails(f);var e=this._getAjaxMoveMails();e.sendRequest()},_openNewWindow:function(f){var h="";if(!c.isAndroid()){h="menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=yes"+(f.height?",height="+f.height:"")+(f.width?",width="+f.width:"")}var g=window.open("about:blank",null,h);var e=this._getNewWindowHtmlTemplate(f.title,f.content);g.document.open();g.document.write(e);g.document.close();return g},_getNewWindowHtmlTemplate:function(i,g){var h=b("<div />").append(g);var e=h.html();var f="";f="<html><head><title>"+i+'</title></head><body id="header-detail">'+e+"</body></html>";return f},_getCurFolderId:function(){var e=this._getTable();var f=e.getFolderId();return f},_isSearchModeTable:function(){var e=this._getListPage();return(e&&e.isSearchModeTable())},onclickForkViewer:function(e,f){if(!c.isIpadiOS6()){var g=this._getViewer();var h=g.getId();if(h){this._updateUnreadData([h],false)}}},onsuccessRemove:function(f,e,g){var h=this._getListPage();if(h){this._updateFolders()}var i=this._getCallbackRemove();if(typeof i=="function"){i()}},onsuccessDownload:function(f,e,h){var g=this._getDlgReadyingDownload();g.open();this._kickGetReadyingDownloadStatus()},onfinishDownload:function(){var e=this._getDlgBeforeDownloading();e.close()},onsuccessGetReadyingDownloadStatus:function(f,e,g){var h=c.parseFlatData(f);if(this._isDownloadComplete(h)){this._setReadiedDownload(true);var j=this._isDownloadSucceeded(h);this._openDlgDownload(j)}else{if(this._showDownloadError(h)){this._setReadiedDownload(true);var i=this._getDlgReadyingDownload();i.close()}else{this._kickGetReadyingDownloadStatus()}}},onerrorGetReadyingDownloadStatus:function(){var e=this._getDlgReadyingDownload();e.close()},onsuccessAddSpam:function(g,f,j){var k=c.getAjaxSendParams(f);var i=k.proc;var e=b("proc",g);var h=(e.text()=="2");this._showSuccessMessageToAddSpam(i,h)},onsuccessFilter:function(g,f,h){var e=this;this._updateFolders(function(){e._closeDlgFiltering()})},onerrorFilter:function(f,e,g){this._closeDlgFiltering()},onsuccessSetFlag:function(g,f,h){var l=c.getAjaxSendParams(f);var e=(l.proc=="on");var j=this._getListPage();if(j){var i=b.makeArray(l.msgid);this._updateFlagStyle(i,e)}else{if(c.parent&&!c.isIpadiOS6()){c.parent.app.updateMailList()}}var k=this._getViewer();k.setFlag(e)},onsuccessSetUnread:function(h,j,n){if(DENBUN_MODE_XNEO){var l=this._getListPage();if(!l){return}}var g=c.getAjaxSendParams(j);var k=b.makeArray(g.msgid);var f=(g.proc=="close");this._updateUnreadStyle(k,f);var i=c.parseFlatData(h);if(i.fid&&i.closemail){var e=this._getFolders();var m=parseInt(i.closemail)||0;e.setUnreadCountOf(i.fid,m);e.updateView();return}this._updateFolders(null,false)},onsuccessMoveMails:function(f,e,g){this._updateFolders()},__closure:c.__closure,__bind:c.__bind,banpei:null}});a.constructor()})(jQuery);(function(b){var d=neo.core.readyNamespace("neo.denbun.Mail.Observer");if(!d){return}var c=neo.denbun;var a=neo.denbun.Mail.Observer=new neo.core.Class({classProperties:{constructor:function(){}},properties:{_tmReceive:null,_kickTmReceive:function(f,e){this._clearTmReceive();this._tmReceive=setTimeout(f,e*60*1000)},_clearTmReceive:function(){var e=this._tmReceive;clearTimeout(e);this._tmReceive=null},_tmSend:null,_getTmSend:function(){return this._tmSend},_setTmSend:function(e){return this._tmSend=e},_tmHideStatusSent:null,_getTmHideStatusSent:function(){return this._tmHideStatusSent},_setTmHideStatusSent:function(e){return this._tmHideStatusSent=e},_sendIdList:null,_getSendIdList:function(){return this._sendIdList||this._initSendIdList()},_initSendIdList:function(){return this._sendIdList=[]},_ajaxSend:null,_getAjaxSend:function(){return this._ajaxSend||this._initAjaxSend()},_initAjaxSend:function(){var e=this;var f={getSendData:function(){var h=e._dequeueSendId();var i={cmd:"mailsendwaiting",msgid:h.own,orgmsgid:h.org};return i},onsuccess:this.__closure(this.onsuccessSend),onerror:this.__closure(this.onerrorSend)};var g=new c.Ajax(f);g.initialize();return this._ajaxSend=g},_elStatus:null,_getElStatus:function(){return this._elStatus||this._initElStatus()},_initElStatus:function(){return this._elStatus=b(".mail_list-sending_status")},_elStatusSending:null,_getElStatusSending:function(){return this._elStatusSending||this._initElStatusSending()},_initElStatusSending:function(){return this._elStatusSending=b("#mail_list-sending_status-sending")},_elCancelSending:null,_getElCancelSending:function(){return this._elCancelSending||this._initElCancelSending()},_initElCancelSending:function(){return this._elCancelSending=b("#mail_list-sending_status-cancel")},_elStatusSent:null,_getElStatusSent:function(){return this._elStatusSent||this._initElStatusSent()},_initElStatusSent:function(){return this._elStatusSent=b("#mail_list-sending_status-sent")},_elStatusSaved:null,_getElStatusSaved:function(){return this._elStatusSaved||this._initElStatusSaved()},_initElStatusSaved:function(){return this._elStatusSaved=b("#mail_list-sending_status-saved")},setting:null,_getPage:function(){return this.setting.page},_getInterval:function(){return this.setting.interval},__constructor:function(e){this.setting=e},initialize:function(){this._hook()},_hook:function(){var e;e=this._getElCancelSending();this.__bind(e,"click","CancelSending");e=this._getElStatusSent();this.__bind(e,"click","StatusSent");e=this._getElStatusSaved();this.__bind(e,"click","StatusSaved")},kickAutoReceiving:function(){var e=this._getInterval();if(e>0){var f=(this.__closure(this._receive));this._kickTmReceive(f,Math.max(e,10))}},clearAutoReceiving:function(){this._clearTmReceive()},_receive:function(){if(c.getCurPageName()!=c.PAGE_MAIL_LIST){this.kickAutoReceiving();return}var e=this._getPage();if(e.isSearchModeTable()==true){this.kickAutoReceiving();return}e.receive()},waitToSend:function(i,e){if(!DNNEO.neo.isSet(i,{blank:false})){this._cancelSending();var h=c.getText("メールの送信に失敗しました。");c.alert(h,{},"E");return}this._enqueueSendId(i,e);this._showStatusSending();var g=c.comSetting.getWaitTimeToSend();var f=this;this._kickTmSend(function(){f._send()},g)},_send:function(){var e=this._getAjaxSend();e.sendRequest()},_finishSending:function(){this._updateMailListAfterSending();this._showStatusSent();var g=3*1000;var f=this;var e=setTimeout(function(){f._hideStatusSent()},g);this._setTmHideStatusSent(e)},_updateMailListAfterSending:function(f){var j=this._getPage();if(!j){return}var k=[];for(var g=0;f&&g<f.length;g++){var h=f[g];var m=h.own;var e=m.split("_")[0];var l=j.getAccountIdOfFolder(e);k.push(l)}c.app.updateMailListAfterSending(k)},_cancelSending:function(){this._clearTmSend();var e=this._getSendIdList();this._updateMailListAfterSending(e);this._initSendIdList();this._showStatusSaved()},_hideStatus:function(){var e=this._getElStatus();e.hide();c.resetAnimation(e)},_showStatusSending:function(){this._hideStatus();var e=this._getElStatusSending();c.slideDownSlideDownMsg(e)},_showStatusSent:function(){this._hideStatus();var e=this._getElStatusSent();c.slideDownSlideDownMsg(e)},_hideStatusSent:function(){var f=this._getElStatusSent();c.slideUpSlideDownMsg(f);var e=this._getTmHideStatusSent();clearTimeout(e);this._setTmHideStatusSent(null)},_showStatusSaved:function(){this._hideStatus();var e=this._getElStatusSaved();c.slideDownSlideDownMsg(e)},_hideStatusSaved:function(){var e=this._getElStatusSaved();c.slideUpSlideDownMsg(e)},_kickTmSend:function(g,f){this._clearTmSend();var e=setTimeout(g,f*1000);this._setTmSend(e)},_clearTmSend:function(){var e=this._getTmSend();clearTimeout(e);this._setTmSend(null)},_enqueueSendId:function(g,e){if(g){var f=this._getSendIdList();f.push({own:g,org:e})}},_dequeueSendId:function(){var f=this._getSendIdList();var e=f.shift();return e},_getSendIdLength:function(){var e=this._getSendIdList();return e.length},_hasSendId:function(){var e=this._getSendIdLength();return(e>0)},onclickCancelSending:function(e,f){this._cancelSending()},onclickStatusSent:function(e,f){this._hideStatusSent()},onclickStatusSaved:function(e,f){this._hideStatusSaved()},onsuccessSend:function(f,e,g){if(this._hasSendId()){this._send()}else{this._finishSending()}},onerrorSend:function(f,e,g){this._cancelSending()},__closure:c.__closure,__bind:c.__bind,banpei:null}});a.constructor()})(jQuery);(function(a){var e=neo.core.readyNamespace("neo.denbun.Mail.ListPage");if(!e){return}var c=neo.denbun;var d=c.Mail;var b=neo.denbun.Mail.ListPage=new neo.core.Class({superClass:c.Page,classProperties:{CLS_NOT_FOR_OWN:"mail_list-not_for_own",CLS_FOR_DRAFT:"mail_list-for_draft",CLS_VIEWER_MODE:"mail_viewer_mode",PARAM_UPDATE:"update",constructor:function(){}},properties:{_ready:null,isReady:function(){return this._ready},_initReady:function(){return this._ready=false},setReady:function(){return this._ready=true},_tmSetRead:null,_getTmSetRead:function(){return this._tmSetRead},_setTmSetRead:function(f){return this._tmSetRead=f},_searchPanel:null,_getSearchPanel:function(){return this._searchPanel||this._initSearchPanel()},_initSearchPanel:function(){var g={page:this};var f=new b.SearchPanel(g);f.initialize();return this._searchPanel=f},_area:null,_getArea:function(){return this._area||this._initArea()},_initArea:function(){var f={page:this};var g=new b.Area(f);g.initialize();g.toggleMailViewerArea(false);return this._area=g},_folders:null,_getFolders:function(){return this._folders},_initFolders:function(){var g={page:this};var f=new b.Folders(g);f.initialize();return this._folders=f},_table:null,_getTable:function(){return this._table||this._initTable()},_initTable:function(){var f={page:this};var g=new b.Table(f);g.initialize();return this._table=g},_operator:null,_getOperator:function(){return this._operator||this._initOperator()},_initOperator:function(){var f=d.getOperator();f.setting.folders=this._getFolders();f.setting.table=this._getTable();f.setting.listPage=this;return this._operator=f},_getObserver:function(){return d.getObserver()},_dlgRemoveExpiredMails:null,_getDlgRemoveExpiredMails:function(){return this._dlgRemoveExpiredMails||this._initDlgRemoveExpiredMails()},_initDlgRemoveExpiredMails:function(){var f={content:this._getElDlgRemoveExpiredMails(),title:c.getText("確認"),onok:this.__closure(this._removeExpiredMailsLow)};var g=new c.Dialog(f);g.initialize();return this._dlgRemoveExpiredMails=g},_ajaxRemoveExpiredMails:null,_getAjaxRemoveExpiredMails:function(){return this._ajaxRemoveExpiredMails||this._initAjaxRemoveExpiredMails()},_initAjaxRemoveExpiredMails:function(){var f=this;var g={getSendData:function(){var i=f._getElRemoveExpiredMailsMode();var j={cmd:"mailcmdlistsavedel",delkind:i.filter(":checked").val()};return j},onsuccess:this.__closure(this.onsuccessRemoveExpiredMails)};var h=new c.Ajax(g);h.initialize();return this._ajaxRemoveExpiredMails=h},_elBodyFrame:null,_getElBodyFrame:function(){return this._elBodyFrame||this._initElBodyFrame()},_initElBodyFrame:function(){return this._elBodyFrame=a("#mail-view-body-frame")},_elDlgRemoveExpiredMails:null,_getElDlgRemoveExpiredMails:function(){return this._elDlgRemoveExpiredMails||this._initElDlgRemoveExpiredMails()},_initElDlgRemoveExpiredMails:function(){return this._elDlgRemoveExpiredMails=a("#dlg-remove_expired_mails")},_elRemoveExpiredMailsMode:null,_getElRemoveExpiredMailsMode:function(){return this._elRemoveExpiredMailsMode||this._initElRemoveExpiredMailsMode()},_initElRemoveExpiredMailsMode:function(){return this._elRemoveExpiredMailsMode=a("[name=remove_expired_mails-mode]")},_elTagLink:null,_getTagLink:function(){return this._elTagLink||this._initTagLink()},_initTagLink:function(){return this._elTagLink=c.Mail.getElSetTag()},_flgScrollReadExec:null,_isScrollReadExec:function(){return this._flgScrollReadExec},_initScrollReadExec:function(){return this._flgScrollReadExec=false},_setScrollReadExec:function(){return this._flgScrollReadExec=true},__constructor:function(){this._initReady()},initialize:function(){this._initArea();if(DENBUN_MODE_XNEO){if(!c.comSetting.isAvailableAddress()){a("[data-action=addToAddressBook]").hide()}}this._registerMenuCallbacks();var f=this;var g=0;var h=2;var i=function(k){g++;if(g<h){return}f._initFolders();f._initOperator();f._initObserver();var j=c.comSetting.getMainPageLayout()=="2";f._getArea().toggleMailViewerArea(!j);f._kickAutoReceiving();if(c.comSetting.hasExpiredMails()){f.removeExpiredMails()}};setTimeout(function(){c.comSetting.getMailSetting(i);c.comSetting.getNotification(i)},1)},_registerMenuCallbacks:function(){var f=this.__closure(this._updateMenuStatus);c.app.registerMenuCallback(f,"mail_list","operation");c.app.registerMenuCallback(f,"mail_list","status");c.app.registerMenuCallback(f,"mail_list","mail_table")},_updateMenuStatus:function(i){if(this.isReady()){var h=this;var g=function(l){var n=h._getSelectedIdList();var m=n.length;c.app.updateMenuEnabledByLength(l,m);if(h.isOwnMailFolder()){var k=l.find("."+c.App.Menu.CLS_MENU_ITEM+"."+b.CLS_NOT_FOR_OWN);k.addClass(c.CLS_DISABLED)}if(h.isDraftFolder()){var k=l.find("."+c.App.Menu.CLS_MENU_ITEM).not("."+b.CLS_FOR_DRAFT);k.addClass(c.CLS_DISABLED)}if(!c.comSetting.isAllowedToDownloadMails()){var j=l.find("["+c.App.Menu.DATA_ACTION+"=download]");j.addClass(c.CLS_DISABLED)}};setTimeout(function(){g(i)},1)}else{var f=i.find("."+c.App.Menu.CLS_MENU_ITEM);f.addClass(c.CLS_DISABLED)}},_initObserver:function(){var f=d.getObserver();f.setting.page=this},proposeCreatingAccount:function(){if(DENBUN_MODE_XNEO){if(!c.comSetting.isAllowedToAccountSetting()){var g=c.getText("アカウントが設定されていません。管理者へお問い合わせください。");c.notify(g);return}}var f=c.getText("アカウントがありません。アカウントを設定しますか？");c.confirm(f,{onok:function(){c.app.openPage(c.PAGE_SETTING_ACCOUNT_EDIT)}})},_initOnOpening:function(){this._showLeft();this._hideRight();this.updateMenuEnabled(true);if(c.app.getFlgUpdateMailList()){this.updateFolders()}if(c.getParameter(c.PARAM_INIT)){this.finishSearching();if(this.isReady()){var f=this._getFolders();f.openFirstNode()}}},_getElOwnItemsLow:function(){return a(".page-mail_list-item")},_clean:function(){var f=c.getParameter(b.PARAM_UPDATE);if(this._isInitialized()&&f!=null){var g=this._getFolders();g.update()}},runAction:function(f,g){if(this.isReady()){this.__call("runAction",arguments)}},removeExpiredMails:function(){if(c.comSetting.getFlgOpenDlgRemoveExpiredMails()){var f=this._getDlgRemoveExpiredMails();f.open()}},_removeExpiredMailsLow:function(){var f=this._getAjaxRemoveExpiredMails();f.sendRequest()},getFolderNameOf:function(h){var g=this._getFolders();var f=g.getNameOf(h);return f},updateMenuEnabled:function(i){if(this.isReady()){var l;if(i){l=0}else{var k=this._getTable();var j=k.getSelectedIdList();l=j.length}var h=this._getElToolbar();c.app.updateToolbarEnabledByLength(h,l);if(!i&&this.isDraftFolder()){var f=h.find("."+c.App.Menu.CLS_ITEM).not("."+b.CLS_FOR_DRAFT);f.addClass(c.CLS_DISABLED)}}else{var g=this._getElToolbar().find("."+c.App.Menu.CLS_ITEM);g.addClass(c.CLS_DISABLED)}},showFolder:function(h,f){var g=this._getTable();g.showFolder(h,f)},cleanMailList:function(){var f=this._getTable();f.clean()},reloadTable:function(g){var f=this._getTable();f.reload(g)},showMail:function(i){var h=this._getViewer();if(!i){h.clean();return}var g=this;var f=h.load(i,function(){g._hookFrameScroll();var j=g._getReadTimerInterval();if(!isNaN(j)){g._kickReadTimer(j)}});if(f){this._unhookFrameScroll()}},_hookFrameScroll:function(){if(!c.comSetting.getFlgReadOnScrolling()){return}var f=this;(function(){var h=f._getElBodyFrame();var i=neo.core.get(h,"0.contentWindow");var g=neo.core.get(i,"document");if(g&&g.URL!="about:blank"&&g.body){a(i).bind("scroll",f.__closure(f.onscrollBodyFrame));a(i).trigger("scroll")}else{setTimeout(arguments.callee,500)}})()},_unhookFrameScroll:function(){var g=this._getElBodyFrame();var h=neo.core.get(g,"0.contentWindow");try{a(h).unbind("scroll")}catch(f){}},_isBodyFrameScrollComplete:function(){var f=this._getElBodyFrame();var g=f[0].contentWindow.document.body;if(c.isMsie()){if(f[0].contentWindow.document.documentElement.clientHeight>0){g=f[0].contentWindow.document.documentElement}}return(g.clientHeight>=g.scrollHeight||g.scrollTop+g.clientHeight>=g.scrollHeight)},_getReadTimerInterval:function(){return c.comSetting.getReadInterval()},_kickReadTimer:function(h){this.killReadTimer();var g=this;var f=setTimeout(function(){var j=g._getViewer();var k=j.getId();var i=g._getOperator();i.setUnread([k],false)},h*1000);this._setTmSetRead(f)},killReadTimer:function(){var f=this._getTmSetRead();clearTimeout(f);this._setTmSetRead(null)},_setReadForViewer:function(){var g=this._getViewer();var h=g.getId();var f=this._getOperator();f.setUnread([h],false)},cleanViewer:function(){var f=this._getViewer();f.clean();d.enableAddToAddressBookButton()},search:function(){var f=this._getSearchPanel();f.open()},finishSearching:function(){var f=this._getSearchPanel();f.close()},translate:function(){var f=this._getViewer();f.translate()},updateFolders:function(i,h){var g=this._getFolders();var f=this;g.update(i,h);c.app.setFlgUpdateMailList(false)},updateMailListAfterSending:function(f,j){if(!this._folders||!this._table){return}if(this.isOwnMailFolder()||j===true){this.reloadTable()}var h=this._getFolders();for(var g=0;f&&g<f.length;g++){var k=f[g];h.addDraftCount(k,1)}},_getSelectedIdList:function(){var g=this._getTable();var f=g.getSelectedIdList();return f},_getSelectedSingleId:function(){var f=this._getSelectedIdList();var g;if(f.length==1){g=f[0]}else{g=null}return g},_kickAutoReceiving:function(){var f=this._getObserver();f.kickAutoReceiving()},clearAutoReceiving:function(){if(!this._folders||!this._table){return}var f=this._getObserver();f.clearAutoReceiving()},disableReceiveButton:function(){this._getElToolbar().find("[data-action=receive]").addClass(c.CLS_DISABLED)},receive:function(){if(DENBUN_MODE_XNEO){this.disableReceiveButton()}var f=this._getOperator();f.receive();this._kickAutoReceiving()},write:function(){var f={};f[c.PARAM_FORK]=1;this._getElToolbar().find("."+c.App.Menu.CLS_BUTTON).blur();c.openPage(c.PAGE_MAIL_EDIT,f)},reply:function(){var g=this._getSelectedSingleId();if(!g){return}var f=this._getOperator();f.reply(g,true)},replyAll:function(){var g=this._getSelectedSingleId();if(!g){return}var f=this._getOperator();f.replyAll(g,true)},forward:function(){var g=this._getSelectedSingleId();if(!g){return}var f=this._getOperator();f.forward(g,true)},remove:function(){var g=this._getSelectedIdList();if(g.length<1){return}var f=this._getOperator();f.remove(g)},openMail:function(){var g=this._getSelectedSingleId();if(!g){return}var f=this._getOperator();if(this.isDraftFolder()){f.restartEditting(g)}else{f.openMail(g)}},editAgain:function(){var g=this._getSelectedSingleId();if(!g){return}var f=this._getOperator();f.editAgain(g,true)},writeToSender:function(){var g=this._getSelectedSingleId();if(!g){return}var f=this._getOperator();f.writeToSender(g,true)},print:function(){var g=this._getSelectedSingleId();if(!g){return}var f=this._getOperator();f.print(g,false)},download:function(){var g=this._getSelectedIdList();if(g.length<1){return}var f=this._getOperator();f.download(g)},addToAddressBook:function(){var g=this._getSelectedSingleId();if(!g){return}var f=this._getOperator();f.addToAddressBook(g,false)},addSpamDomain:function(){var g=this._getSelectedIdList();if(g.length<1){return}var f=this._getOperator();f.addSpamDomain(g)},addSpamAddress:function(){var g=this._getSelectedIdList();if(g.length<1){return}var f=this._getOperator();f.addSpamAddress(g)},showHeaderDetail:function(){var g=this._getSelectedSingleId();if(!g){return}var f=this._getOperator();f.showHeaderDetail(g,false)},filter:function(){var g=this._getSelectedIdList();if(g.length<1){return}var f=this._getOperator();f.filter(g)},addFlag:function(){var g=this._getSelectedIdList();if(g.length<1){return}var f=this._getOperator();f.setFlag(g,true)},removeFlag:function(){var g=this._getSelectedIdList();if(g.length<1){return}var f=this._getOperator();f.setFlag(g,false)},setRead:function(){var g=this._getSelectedIdList();if(g.length<1){return}var f=this._getOperator();f.setUnread(g,false)},setUnread:function(){var g=this._getSelectedIdList();if(g.length<1){return}var f=this._getOperator();f.setUnread(g,true)},addSch:function(){var f=this._getViewer();f.addSch()},addCreport:function(){var f=this._getViewer();f.addCreport()},addInfo:function(){var f=this._getViewer();f.addInfo()},addCab:function(){var f=this._getViewer();f.addCab()},moveMails:function(h,g){var f=this._getOperator();f.moveMails(h,g)},createFolder:function(){var f=this._getFolders();f.create()},moveFolder:function(){var f=this._getFolders();f.move()},removeFolder:function(){var f=this._getFolders();f.remove()},renameFolder:function(){var f=this._getFolders();f.rename()},updateFolderNameInTable:function(){var f=this._getTable();f.updateTitle()},emptyTrash:function(){var f=this._getFolders();f.emptyTrash()},execSearch:function(){var f=this._getSearchPanel();f.exec()},execEasySearch:function(g,h){var f=this._getSearchPanel();f.execEasySearch(g,h)},setEasySearchKeyword:function(f){var g=this._getTable();var h=g.getElSearchKeyword();h.val(f)},showSearchResult:function(h,i){if(i){this.cleanMailList()}else{var f=this._getFolders();f.unselect();f.kickOnChange()}var g=this._getTable();g.showSearchResult(h,i)},clearSearch:function(){var f=this._getSearchPanel();f.clear()},enableDownloadSearchResultButton:function(){var f=this._getSearchPanel();f.enableDownloadButton()},downloadSearchResult:function(){var f=this._getOperator();f.downloadSearchResult()},_getViewer:function(){return d.getViewer()},buildClonedFolderTree:function(k){var f=this._getFolders();k.tree=f;var h=new c.ClonedTree(k);var l=["getNodeIdFrom","getElNodeOf","_getAccountId","_getElAccountNodeOf","isDescendantOf","isDescendantElementOf","getAccountIdOfFolder","_getElAccountNodeFrom"];for(var j=0;j<l.length;j++){var g=l[j];h[g]=f[g]}return h},isSearchModeTable:function(){var f=this._getTable();return f.isSearchMode()},isOwnMailFolder:function(g){var f=this._getTable();return f.isOwnMails()},isOwnMailFolderId:function(g){var f=this._getFolders();return f.isOwnMailFolderId(g)},isDraftFolder:function(){var f=this._getTable();return f.isDraft()},isDraftFolderId:function(g){var f=this._getFolders();return f.isDraftNodeId(g)},isTrashFolder:function(){var f=this._getTable();return f.isTrash()},isTrashFolderId:function(g){var f=this._getFolders();return f.isTrashNodeId(g)},getAccountIdOfFolder:function(f){var g=this._getFolders();var h=g.getAccountIdOfFolder(f);return h},getRemoveMessage:function(){var g=this;var f={};if(g.isSearchModeTable()){f.message=c.getText("選択したメールをゴミ箱に移動してよろしいですか？");f.addmessage=c.getText("※ゴミ箱に保存されているメールの場合は、完全に削除されます。")}else{if(g.isTrashFolder()){f.message=c.getText("選択したメールを完全に削除してよろしいですか？")}else{f.message=c.getText("選択したメールをゴミ箱に移動してよろしいですか？")}}return f},onresize:function(h){var g=this._getArea();g.onresize(h);if(this._table){var f=this._getTable();f.onresize(h)}},onsuccessRemoveExpiredMails:function(g,f,h){this.updateFolders()},onscrollBodyFrame:function(g,h){if(this._isBodyFrameScrollComplete()){if(this._isScrollReadExec()!==true){this._setScrollReadExec();this._setReadForViewer();var f=this;setTimeout(function(){f._initScrollReadExec()},100)}}},onclose:function(g){if(this.isReady()){var f=this._getTable();f.close()}g()},banpei:null}});b.constructor()})(jQuery);(function(b){var d=neo.core.readyNamespace("neo.denbun.Mail.ListPage.SearchPanel");if(!d){return}var c=neo.denbun;var a=neo.denbun.Mail.ListPage.SearchPanel=new neo.core.Class({classProperties:{ID_SELECT_DATE_START:"mail-search-date-start",PARAM_KEYWORD:"key",PARAM_IN_FROM:"from",PARAM_IN_TO:"tocc",PARAM_IN_SUBJECT:"subject",PARAM_IN_BODY:"body",PARAM_START_YEAR:"syear",PARAM_START_MONTH:"smonth",PARAM_START_DATE:"sday",PARAM_END_YEAR:"eyear",PARAM_END_MONTH:"emonth",PARAM_END_DATE:"eday",PARAM_FOLDER_ID:"fid",PARAM_ACCOUNT_ID:"accid",PARAM_INCLUDING_SUB_FOLDERS:"sfolder",YEAR_MIN:1990,YEAR_MAX:2030,constructor:function(){}},properties:{_lastOpendFolderId:null,_getLastOpendFolderId:function(){return this._lastOpendFolderId},_setLastOpendFolderId:function(e){return this._lastOpendFolderId=e},_startDatepicker:null,_getStartDatepicker:function(){return this._startDatepicker||this._initStartDatepicker()},_initStartDatepicker:function(){var e={elDate:this._getElStartDate(),elInput:this._getElStartInput(),elMonth:this._getElStartMonth(),elYear:this._getElStartYear(),uiSetting:{maxDate:a.YEAR_MAX+"/12/31",minDate:a.YEAR_MIN+"/1/1"}};var f=new c.Datepicker(e);f.initialize();return this._startDatepicker=f},_endDatepicker:null,_getEndDatepicker:function(){return this._endDatepicker||this._initEndDatepicker()},_initEndDatepicker:function(){var e={elDate:this._getElEndDate(),elInput:this._getElEndInput(),elMonth:this._getElEndMonth(),elYear:this._getElEndYear(),uiSetting:{maxDate:a.YEAR_MAX+"/12/31",minDate:a.YEAR_MIN+"/1/1"}};var f=new c.Datepicker(e);f.initialize();return this._endDatepicker=f},_foldersToSearch:null,_getFoldersToSearch:function(){return this._foldersToSearch||this._initFoldersToSearch()},_initFoldersToSearch:function(){var f={elContainer:b("#mail-search-folder-container")};var g=this._getPage();var e=g.buildClonedFolderTree(f);e.initialize();return this._foldersToSearch=e},_elContainer:null,_getElContainer:function(){return this._elContainer||this._initElContainer()},_initElContainer:function(){return this._elContainer=b("#mail-search-container")},_elClose:null,_getElClose:function(){return this._elClose||this._initElClose()},_initElClose:function(){return this._elClose=b("#mail-search-close")},_elForm:null,_getElForm:function(){return this._elForm||this._initElForm()},_initElForm:function(){return this._elForm=b("#mail-search")},_elKeyword:null,_getElKeyword:function(){return this._elKeyword||this._initElKeyword()},_initElKeyword:function(){var f=this._getElContainer();var e=f.find("[name=key]");return this._elKeyword=e},_elInFrom:null,_getElInFrom:function(){return this._elInFrom||this._initElInFrom()},_initElInFrom:function(){var f=this._getElContainer();var e=f.find("[name=from]");return this._elInFrom=e},_elInTo:null,_getElInTo:function(){return this._elInTo||this._initElInTo()},_initElInTo:function(){var f=this._getElContainer();var e=f.find("[name=tocc]");return this._elInTo=e},_elInSubject:null,_getElInSubject:function(){return this._elInSubject||this._initElInSubject()},_initElInSubject:function(){var f=this._getElContainer();var e=f.find("[name=subject]");return this._elInSubject=e},_elInBody:null,_getElInBody:function(){return this._elInBody||this._initElInBody()},_initElInBody:function(){var f=this._getElContainer();var e=f.find("[name=body]");return this._elInBody=e},_elDate:null,_getElDate:function(){return this._elDate||this._initElDate()},_initElDate:function(){var g=b("#mail-search-date");if(!DENBUN_MODE_XNEO){var e=g.text();var f=c.getText(e);g.html(f)}return this._elDate=g},_elStartYear:null,_getElStartYear:function(){return this._elStartYear||this._initElStartYear()},_initElStartYear:function(){var f=this._getElDate();var e=f.find("[name=syear]");return this._elStartYear=e},_elStartMonth:null,_getElStartMonth:function(){return this._elStartMonth||this._initElStartMonth()},_initElStartMonth:function(){var f=this._getElDate();var e=f.find("[name=smonth]");return this._elStartMonth=e},_elStartDate:null,_getElStartDate:function(){return this._elStartDate||this._initElStartDate()},_initElStartDate:function(){var f=this._getElDate();var e=f.find("[name=sday]");return this._elStartDate=e},_elStartInput:null,_getElStartInput:function(){return this._elStartInput||this._initElStartInput()},_initElStartInput:function(){return this._elStartInput=b("#mail-search-date-start")},_elEndYear:null,_getElEndYear:function(){return this._elEndYear||this._initElEndYear()},_initElEndYear:function(){var f=this._getElDate();var e=f.find("[name=eyear]");return this._elEndYear=e},_elEndMonth:null,_getElEndMonth:function(){return this._elEndMonth||this._initElEndMonth()},_initElEndMonth:function(){var f=this._getElDate();var e=f.find("[name=emonth]");return this._elEndMonth=e},_elEndDate:null,_getElEndDate:function(){return this._elEndDate||this._initElEndDate()},_initElEndDate:function(){var f=this._getElDate();var e=f.find("[name=eday]");return this._elEndDate=e},_elEndInput:null,_getElEndInput:function(){return this._elEndInput||this._initElEndInput()},_initElEndInput:function(){return this._elEndInput=b("#mail-search-date-end")},_elFolderContainer:null,_getElFolderContainer:function(){return this._elFolderContainer||this._initElFolderContainer()},_initElFolderContainer:function(){return this._elFolderContainer=b("#mail-folder-container")},_elIncludingSubFolders:null,_getElIncludingSubFolders:function(){return this._elIncludingSubFolders||this._initElIncludingSubFolders()},_initElIncludingSubFolders:function(){var f=this._getElContainer();var e=f.find("[name=sfolder]");return this._elIncludingSubFolders=e},_elDownload:null,_getElDownload:function(){return this._elDownload||this._initElDownload()},_initElDownload:function(){return this._elDownload=b("[data-action=download_search_result]")},setting:null,_getPage:function(){return this.setting.page},__constructor:function(e){this.setting=e},initialize:function(){if(DENBUN_MODE_XNEO){var e=this._getElDate();desknets.htmlparts.setUpForm(e)}else{this._initStartDatepicker();this._initEndDatepicker()}this._initDownloadButton();this._hook()},_initDownloadButton:function(){if(!c.comSetting.isAllowedToDownloadMails()){var e=this._getElDownload();e.remove()}},_hook:function(){var e;e=this._getElClose();this.__bind(e,"click","Close")},open:function(){this.clear();var g=this._getElFolderContainer();g.hide();this._updateFolders();var i=this._getElContainer();i.show();var h=this._getFolderId();if(h){var f=this._getFoldersToSearch();f.scrollToShow(h)}var e=this._getElKeyword();e.focus()},close:function(){var f=this._getElContainer();f.hide();var e=this._getElFolderContainer();e.show()},_updateFolders:function(e){if(e===undefined){e=true}var h;if(e){h=this._getFolderId()}var f=this._getFoldersToSearch();f.update();var g=f.setting.elContainer;c.Mail.ListPage.Folders.killUnreadClass(g);if(e&&h){f.select(h)}else{h=f.getCurNodeId();if(h){this._setLastOpendFolderId(h)}else{h=this._getLastOpendFolderId();f.select(h)}}},_getFolderId:function(){var e=this._getFoldersToSearch();var f=e.getCurNodeId();return f},_getAccountId:function(){var e=this._getFoldersToSearch();var f=e.getCurNodeId();var g=e.getAccountIdOfFolder(f);return g},exec:function(){var f=this._gather();var e=this._getErrorMessageList(f);if(e.length>0){c.alert("- "+e.join("\n- "));return}this._sendRequest(f)},_gather:function(){var i={};var g,k;var j=this._getElContainer();var f=j.find("form");var h=f.serialize();var i=neo.core.splitParam(h);var e=this._getFolderId();i[a.PARAM_FOLDER_ID]=e;var l=this._getAccountId();i[a.PARAM_ACCOUNT_ID]=l;return i},_getErrorMessageList:function(j){var i=[];var h;if(DENBUN_MODE_XNEO){var e;e=this._getElStartInput().hasClass("ui-invalid");if(e){h=c.getText("日付が不正です。");i.push(h)}e=this._getElEndInput().hasClass("ui-invalid");if(e){h=c.getText("日付が不正です。");i.push(h)}}else{if(j[a.PARAM_START_YEAR]||j[a.PARAM_START_MONTH]||j[a.PARAM_START_DATE]||j[a.PARAM_END_YEAR]||j[a.PARAM_END_MONTH]||j[a.PARAM_END_DATE]){this._getDateErrorMessageList(j[a.PARAM_START_YEAR],j[a.PARAM_START_MONTH],j[a.PARAM_START_DATE],i);this._getDateErrorMessageList(j[a.PARAM_END_YEAR],j[a.PARAM_END_MONTH],j[a.PARAM_END_DATE],i)}}if(DENBUN_MODE_XNEO){var g=j[a.PARAM_KEYWORD];if(g&&g.length>desknets.SRCHKEY_MAXLENGTH){var f=desknets.Resource.Message.com_search_keyword_toolarge;i.push(f)}}this._getFolderErrorMessageList(j[a.PARAM_FOLDER_ID],j[a.PARAM_ACCOUNT_ID],i);return i},_getDateErrorMessageList:function(m,j,l,i){if(!i){i=[]}var h;try{if(l&&!m){throw false}if(l&&!j){throw false}if(j&&!m){throw false}if(!Number(m||1)||!Number(j||1)||!Number(l||1)){throw false}var f=[m||2000,j||1,l||1].join("/");var g=new Date(f);if((m&&g.getFullYear()!=m)||(j&&g.getMonth()+1!=j)){throw false}}catch(k){h=c.getText("日付が不正です。");i.push(h)}if(m&&m<a.YEAR_MIN){h=c.getText("日付が小さすぎます。");i.push(h)}if(m&&m>a.YEAR_MAX){h=c.getText("日付が大きすぎます。");i.push(h)}return i},_getFolderErrorMessageList:function(e,g,f){if(!f){f=[]}if(e==null&&(!g==null||g==undefined)){message=c.getText("検索対象フォルダを選択してください。");f.push(message)}return f},_sendRequest:function(f,g){var e=this._getPage();e.showSearchResult(f,g)},clear:function(){this._clearInput();this._clearFolder()},_clearInput:function(){var e=this._getElForm();e[0].reset();if(DENBUN_MODE_XNEO){e.find(".co-datepicker").val("").removeClass("ui-invalid-mismatch ui-invalid");this._getElDate().find("input").val("")}this.enableDownloadButton(false)},_clearFolder:function(){this._updateFolders(false);var f=this._getFolderId();if(f){var e=this._getFoldersToSearch();e.scrollToShow(f)}},enableDownloadButton:function(e){if(e==undefined){e=true}var f=this._getElDownload();f.attr("disabled",!e)},execEasySearch:function(f,h){if(DENBUN_MODE_XNEO){if(f&&f.length>desknets.SRCHKEY_MAXLENGTH){var e=desknets.Resource.Message.com_search_keyword_toolarge;c.alert(e);return}if(!DNNEO.neo.isSet(h,{blank:false})){return}}var g=this._getEasySearchParameters(f,h);this._sendRequest(g,true)},_getEasySearchParameters:function(e,g){var f={body:1,fid:g,from:1,key:e,subject:1,tocc:1};return f},onclickClose:function(e,f){this.close()},__closure:c.__closure,__bind:c.__bind,banpei:null}});a.constructor()})(jQuery);(function(b){var e=neo.core.readyNamespace("neo.denbun.Mail.ListPage.Area");if(!e){return}var c=neo.denbun;var d=c.Mail;var a=neo.denbun.Mail.ListPage.Area=new neo.core.Class({classProperties:{ID_LEFT_SLIDE_BAR:"slide_bar-left",ID_RIGHT_SLIDE_BAR:"slide_bar-right",CLS_SLIDE_BAR_OVERLAY:"overlay-slide_bar-h",DEFAULT_SLIDE_BAR_DRAGGABLE_SETTING:{axis:"y",iframeFix:true,scroll:false},_instance:null,getInstance:function(){return this._instance},_setInstance:function(f){return this._instance=f},constructor:function(){},initialize:function(){var f=new a();f.initialize();this._setInstance(f)},banpei:null},properties:{_initialized:null,_isInitialized:function(){return this._initialized},_setInitialized:function(f){return this._initialized=f},_elMailTableContainer:null,_getElMailTableContainer:function(){return this._elMailTableContainer||this._initElMailTableContainer()},_initElMailTableContainer:function(){return this._elMailTableContainer=b("#mail-table-container")},_elSlideBar:null,_getElSlideBar:function(){return this._elSlideBar||this._initElSlideBar()},_initElSlideBar:function(){return this._elSlideBar=b("#mail-slide_bar")},_elMailViewerHeader:null,_getElMailViewerHeader:function(){return this._elMailViewerHeader||this._initElMailViewerHeader()},_initElMailViewerHeader:function(){return this._elMailViewerHeader=b("#mail-view-header")},_getPage:function(){return this.setting.page},__constructor:function(f){if(a.getInstance()){var g="Dupulicated.";throw new Error("neo.denbun.Mail.ListPage.Area.__constructor : "+g)}this._initialized=false;this.setting=f},initialize:function(){if(this._isInitialized()){return}this._hook();this._setInitialized(true)},_hook:function(){var f;f=this._getElSlideBar();var g=this._getSlideBarSetting();f.draggable(g)},_getSlideBarSetting:function(){var f=b.extend({},a.DEFAULT_SLIDE_BAR_DRAGGABLE_SETTING);var g=this._getElSlideBar();f.helper=function(){var h=b('<div class="slide_bar-helper mail-slide_bar-helper" />').css({left:g.offset().left,width:g.width()}).appendTo("body");return h};f.start=this.__closure(this.ondragstartSlideBar);f.stop=this.__closure(this.ondragstopSlideBar);return f},_updateRectSize:function(){this._updateMailViewerAreaSize();this._updateSlideBarContainment()},_updateSlideBarContainment:function(){var g=this._getElMailTableContainer();var j=g.position();var k=j.top;var n=this._getElSlideBar();var o=n.outerHeight();var i=c.getClientSize();var l=i.height;var m=75;var h=21;var f=[0,k+m,0,l-o-h];n.draggable("option","containment",f)},_showSlideBarOverlay:function(){var f=c.getElOverlay();f.addClass(a.CLS_SLIDE_BAR_OVERLAY).show()},_hideSlideBarOverlay:function(){var f=c.getElOverlay();f.removeClass(a.CLS_SLIDE_BAR_OVERLAY).hide()},_updateAreaSize:function(f){this._updateMailTableAreaSize(f);this._updateMailViewerAreaSize(f)},_updateMailTableAreaSize:function(g){var h=this._getElMailTableContainer();var k=h.position();var j=k.top;var f=g-j;if(c.isIe7()){var i=parseInt(h.css("paddingTop"));f-=i}h.height(f);c.app.updateComContentSize(h)},_updateMailViewerAreaSize:function(f){d.updateViewerSize()},toggleMailViewerArea:function(f){this._getElMailTableContainer().height(!!f?"":"100%")},onresize:function(f){this._updateRectSize()},ondragstartSlideBar:function(f,g,h){this._showSlideBarOverlay()},ondragstopSlideBar:function(f,g,i){var h=g.offset.top;this._updateAreaSize(h);this._hideSlideBarOverlay();c.$window.resize()},__closure:c.__closure,__bind:c.__bind,banpei:null}});a.constructor()})(jQuery);(function(b){var e=neo.core.readyNamespace("neo.denbun.Mail.ListPage.Folders");if(!e){return}var d=neo.denbun;var c=d.Tree;var a=neo.denbun.Mail.ListPage.Folders=new neo.core.Class({superClass:d.Tree,classProperties:{ID_DRAGGABLE_HELPER:"mail_folder-draggable-helper",CLS_ACCOUNT:"mail-folder-node-account",CLS_RECEIVED:"mail-folder-node-received",CLS_SENT:"mail-folder-node-sent",CLS_TRASH:"mail-folder-node-trash",CLS_DRAFT:"mail-folder-node-draft",CLS_UNREAD_COUNT_CONTAINER:"mail-folder-unread-container",CLS_UNREAD_COUNT:"mail-folder-unread",CLS_HAS_UNREAD:"mail-folder-node-has_unread",CLS_HAS_UNREAD_DESCENDANTS:"mail-folder-node-has_unread_descendants",CLS_HAS_UNREAD_DESCENDANTS_ICON:"mail-folder-node-has_unread_descendants-icon",CLS_MENU_ITEM_FOR_USER_FOLDER:"mail_list-for_user_folder",DATA_ACCOUNT_ID:"data-aid",KEY_NODE_TYPE:"sysid",ID_ROOT:"",NODE_TYPE_ACCOUNT:"0",NODE_TYPE_RECEIVED:"1",NODE_TYPE_SENT:"2",NODE_TYPE_TRASH:"3",NODE_TYPE_DRAFT:"4",NODE_TYPE_OTHER:"",IMAP_SERVER_TYPE_GMAIL:"gmail",killUnreadClass:function(g){var f=a.CLS_HAS_UNREAD;g.find("."+f).removeClass(f);f=a.CLS_HAS_UNREAD_DESCENDANTS;g.find("."+f).removeClass(f)}},properties:{_lastUpdateConnectionKey:null,_getLastUpdateConnectionKey:function(){return this._lastUpdateConnectionKey||this._initLastUpdateConnectionKey()},_setLastUpdateConnectionKey:function(f){return this._lastUpdateConnectionKey=f},_callbackForUpdating:null,_getCallbackForUpdating:function(){return this._callbackForUpdating},_setCallbackForUpdating:function(f){return this._callbackForUpdating=f},_dataToMove:null,_getDataToMove:function(){return this._dataToMove},_setDataToMove:function(f){return this._dataToMove=f},_dataToEmptyTrash:null,_getDataToEmptyTrash:function(){return this._dataToEmptyTrash},_setDataToEmptyTrash:function(f){return this._dataToEmptyTrash=f},_delimiter:null,_getDelimiter:function(){return this._delimiter},_initDelimiter:function(f){var h=f.find("fdelm");var g=h.text();return this._delimiter=g},_imapServer:null,_getImapServer:function(){return this._imapServer},_initImapServer:function(g){var h=g.find("imapserver");var f=h.text();return this._imapServer=f},_getAjaxUpdate:function(h){var j;if(h===false){j=this.__closure(this.onsuccessUpdateNoMailList)}else{j=this.__closure(this.onsuccessUpdate)}var f=this;var g={getSendData:function(){var l={cmd:"mailfolders"};if(h!==false){var k=String(new Date().getTime());f._setLastUpdateConnectionKey(k);l._=k}return l},onsuccess:j,onfinish:this.__closure(this.onfinishUpdate)};if(h!==false){g.cache=true}if(DENBUN_MODE_XNEO){g.onerror=this.__closure(this.onerrorUpdate)}var i=new d.Ajax(g);i.initialize();return i},_ajaxCreate:null,_getAjaxCreate:function(){return this._ajaxCreate||this._initAjaxCreate()},_initAjaxCreate:function(){var f=this;var g={getSendData:this.__closure(function(){var i=this._getFoldersToCreate();var k=i.getCurNodeId();var j={cmd:"mailcmdfolderentry",Name:this._getElNewFolderName().val(),pfid:k};return j}),onsuccess:this.__closure(this.onsuccessCreate)};var h=new d.Ajax(g);h.initialize();return this._ajaxCreate=h},_ajaxMove:null,_getAjaxMove:function(){return this._ajaxMove||this._initAjaxMove()},_initAjaxMove:function(){var f=this;var g={getSendData:function(){var i=f._getDataToMove();i.cmd="mailfoldermove";return i},onsuccess:this.__closure(this.onsuccessMove)};var h=new d.Ajax(g);h.initialize();return this._ajaxMove=h},_ajaxRemove:null,_getAjaxRemove:function(){return this._ajaxRemove||this._initAjaxRemove()},_initAjaxRemove:function(){var f=this;var g={getSendData:function(){var i={cmd:"mailfolderdel",id:f.getCurNodeId()};return i},onsuccess:this.__closure(this.onsuccessRemove)};var h=new d.Ajax(g);h.initialize();return this._ajaxRemove=h},_ajaxRename:null,_getAjaxRename:function(){return this._ajaxRename||this._initAjaxRename()},_initAjaxRename:function(){var f=this;var g={getSendData:this.__closure(function(){var j=this.getCurNodeId();var i={cmd:"mailcmdfolderentry",id:j,Name:this._getElRenameFolderName().val()};return i}),onsuccess:this.__closure(this.onsuccessRename)};var h=new d.Ajax(g);h.initialize();return this._ajaxRename=h},_ajaxEmptyTrash:null,_getAjaxEmptyTrash:function(){return this._ajaxEmptyTrash||this._initAjaxEmptyTrash()},_initAjaxEmptyTrash:function(){var f=this;var g={getSendData:function(){var i=f._getDataToEmptyTrash();i.cmd="maildel";return i},onsuccess:this.__closure(this.onsuccessEmptyTrash)};var h=new d.Ajax(g);h.initialize();return this._ajaxEmptyTrash=h},_dlgCreate:null,_getDlgCreate:function(){return this._dlgCreate||this._initDlgCreate()},_initDlgCreate:function(){var f={content:b("#dlg-mail_list-folder-create"),title:d.getText("フォルダ作成"),onopen:this.__closure(this._updateDlgCreate),onok:this.__closure(this._sendRequestToCreate)};var g=new d.Dialog(f);g.initialize();return this._dlgCreate=g},_foldersToCreate:null,_getFoldersToCreate:function(){return this._foldersToCreate||this._initFoldersToCreate()},_initFoldersToCreate:function(){var g={elContainer:b("#mail_list-folder-create-tree")};var h=this._getPage();var f=h.buildClonedFolderTree(g);f.initialize();return this._foldersToCreate=f},_dlgMove:null,_getDlgMove:function(){return this._dlgMove||this._initDlgMove()},_initDlgMove:function(){var f={content:b("#dlg-mail_list-folder-move"),title:d.getText("フォルダ移動"),onopen:this.__closure(this._updateDlgMove),onok:this.__closure(this._decideToMoveOnDialog)};var g=new d.Dialog(f);g.initialize();return this._dlgMove=g},_foldersToMove:null,_getFoldersToMove:function(){return this._foldersToMove||this._initFoldersToMove()},_initFoldersToMove:function(){var g={elContainer:b("#mail_list-folder-move-tree")};var h=this._getPage();var f=h.buildClonedFolderTree(g);f.initialize();return this._foldersToMove=f},_dlgRename:null,_getDlgRename:function(){return this._dlgRename||this._initDlgRename()},_initDlgRename:function(){var f={content:b("#dlg-mail_list-folder-rename"),title:d.getText("フォルダ名変更"),onopen:this.__closure(this._updateDlgRename),onok:this.__closure(this._sendRequestToRename)};var g=new d.Dialog(f);g.initialize();return this._dlgRename=g},_elCreate:null,_getElCreate:function(){return this._elCreate||this._initElCreate()},_initElCreate:function(){return this._elCreate=b("#mail-folder-create")},_elRemove:null,_getElRemove:function(){return this._elRemove||this._initElRemove()},_initElRemove:function(){return this._elRemove=b("#mail-folder-remove")},_elEmptyTrash:null,_getElEmptyTrash:function(){return this._elEmptyTrash||this._initElEmptyTrash()},_initElEmptyTrash:function(){return this._elEmptyTrash=b(".mail-folder-empty_trash")},_elDraggableHelper:null,_getElDraggableHelper:function(){return this._elDraggableHelper||this._initElDraggableHelper()},_initElDraggableHelper:function(){var g=this.getElContainer();var f=b("#"+a.ID_DRAGGABLE_HELPER).appendTo(g);return this._elDraggableHelper=f},_elNewFolderName:null,_getElNewFolderName:function(){return this._elNewFolderName||this._initElNewFolderName()},_initElNewFolderName:function(){return this._elNewFolderName=b("#mail_list-folder-create-name")},_elRenameFolderName:null,_getElRenameFolderName:function(){return this._elRenameFolderName||this._initElRenameFolderName()},_initElRenameFolderName:function(){return this._elRenameFolderName=b("#mail_list-folder-rename-name")},setting:null,_getPage:function(){return this.setting.page},_getElContainerLow:function(){return b("#mail-folder")},_getSendDataToLoad:function(){var f={cmd:"mailfolders"};return f},initialize:function(){this.__call("initialize",arguments)},openFirstNode:function(){var g;var m=d.getParameter("fid");if(!DNNEO.neo.isSet(m,{blank:false})){var k=this.getElRoot();var f=k.find("."+a.CLS_RECEIVED);m=this.getNodeIdFrom(f)}if(DNNEO.neo.isSet(m,{blank:false})){g=this.getElNodeOf(m)}if(g){this._selectElNode(g);this.open(m);if(DENBUN_MODE_XNEO){var i=d.getParameter("key");if(i&&i!=""){var h=this._getTmOnChange();clearTimeout(h);var l=this.getNodeIdFrom(g);var j=this._getPage();j.setEasySearchKeyword(i);j.execEasySearch(i,l)}else{this.kickOnChange(m)}}else{this.kickOnChange(m)}}var j=this._getPage();j.setReady();j.updateMenuEnabled()},kickOnChange:function(){var f=this._getTmOnChange();clearTimeout(f);var g=this.getCurNodeId();this.onchange(g)},_build:function(f){this.__call("_build",arguments)},_hook:function(){this.__call("_hook",arguments);var k=this.getElRoot();var f=k.find("."+c.CLS_LINK);var h=this;var g=b(b.grep(f,function(l){var m=h._getElNodeFrom(b(l));return !h._isSystemFolder(m)}));this._hookDraggable(g);this._hookDroppable(f);var i=this._getElEmptyTrash();this.__bind(i,"click","EmptyTrash");var j=this.__closure(this._updateMenuStatus);d.app.registerMenuCallback(j,"mail_list","mail_folders")},_hookDraggable:function(f){var g=this._getDraggableOptions();f.draggable(g)},_getDraggableOptions:function(){var f={cursor:"move",cursorAt:{left:-5,bottom:-5},iframeFix:true,opacity:0.8,scope:d.Mail.DROPPABLE_SCOPE,helper:this.__closure(this._getElDraggableHelper),start:this.__closure(this.ondragstart)};return f},_hookDroppable:function(f){var g=this._getDroppableOptions();f.droppable(g)},_getDroppableOptions:function(){var f={scope:d.Mail.DROPPABLE_SCOPE,tolerance:"pointer",drop:this.__closure(this.ondrop),over:this.__closure(this.ondropover),out:this.__closure(this.ondropout)};return f},_parseResponse:function(h){var f=this.__call("_parseResponse",arguments);var g=this._buildRootNode(f);return g},_parseNode:function(f){var g=this.__call("_parseNode",arguments);return g},_buildRootNode:function(f){var i=a.ID_ROOT;var g=this._createTree();var h={aid:i,children:f,id:i,Name:d.getText("ウェブメールIMAP")};h[a.KEY_NODE_TYPE]=a.NODE_TYPE_ACCOUNT;g.add(i,h);return g},_buildElNode:function(g){var f=this.__call("_buildElNode",arguments);if(f.find("."+a.CLS_HAS_UNREAD).length>0){f.addClass(a.CLS_HAS_UNREAD_DESCENDANTS)}return f},_buildElNodeLow:function(l){var h=l[a.KEY_NODE_TYPE];var j;switch(h){case a.NODE_TYPE_ACCOUNT:j=this._buildElAccountNode(l);break;case a.NODE_TYPE_TRASH:j=this._buildElTrashNode(l);break;default:j=this.__call("_buildElNodeLow",arguments)}var k=this._buildElUnreadCount(l);var i=this._getElLinkFrom(j);i.append(k);var g=this._getClsNodeType(l);j.addClass(g);if(!this._isAccountNode(l)){var f=this._getNodeUnreadCount(l);if(f>0){j.addClass(a.CLS_HAS_UNREAD)}}return j},_buildElAccountNode:function(g){var f=this.__call("_buildElNodeLow",arguments);f.attr(c.DATA_ID,g.id).attr(a.DATA_ACCOUNT_ID,g.aid);return f},_buildElTrashNode:function(i){var f=this.__call("_buildElNodeLow",arguments);var h=d.getText("空にする");var g=b("<span />").addClass("link mail-folder-empty_trash").text(h);var j=b("<span />").addClass("mail-folder-empty_trash-container").append("[").append(g).append("]");f.append(j);return f},_buildElUnreadCount:function(i){var f=this._getNodeUnreadCount(i);var h=b("<span />").addClass([a.CLS_UNREAD_COUNT,].join(" ")).text(f);var g=b("<span />").addClass([a.CLS_HAS_UNREAD_DESCENDANTS_ICON,].join(" ")).text(d.getText("+"));var j=b("<span />").addClass([a.CLS_UNREAD_COUNT_CONTAINER,].join(" ")).append("(").append(h).append(g).append(")");return j},_getClsNodeType:function(h){var g=h[a.KEY_NODE_TYPE];var f;switch(g){case a.NODE_TYPE_ACCOUNT:f=a.CLS_ACCOUNT;break;case a.NODE_TYPE_RECEIVED:f=a.CLS_RECEIVED;break;case a.NODE_TYPE_SENT:f=a.CLS_SENT;break;case a.NODE_TYPE_TRASH:f=a.CLS_TRASH;break;case a.NODE_TYPE_DRAFT:f=a.CLS_DRAFT;break}return f},_isValidDraggable:function(h,g){if(h.is("#"+a.ID_DRAGGABLE_HELPER)){return true}else{var f=this._getElNodeFrom(g);return(this._isMailDroppableFolder(f))}},_getNodeId:function(f){var g;if(this._isAccountNode(f)){g=f.aid}else{g=f.id}return g},_isAccountNode:function(f){return(f[a.KEY_NODE_TYPE]==a.NODE_TYPE_ACCOUNT)},_isTrashNode:function(f){return(f[a.KEY_NODE_TYPE]==a.NODE_TYPE_TRASH)},_isDraft:function(f){return(!!f&&f[a.KEY_NODE_TYPE]==a.NODE_TYPE_DRAFT)},isDraftNodeId:function(g){var f=this._getNodeOf(g);return this._isDraft(f)},isTrashNodeId:function(g){var f=this._getNodeOf(g);return this._isTrashNode(f)},_getNodeUnreadCount:function(g){var f=parseInt(g.closemail)||0;return f},_setNodeUnreadCount:function(g,f){f=Math.max(parseInt(f)||0,0);g.closemail=f;var h=this._getNodeId(g);this._updateNodeUnreadCount(h,f)},_getNodeSize:function(g){var f=parseInt(g.size)||0;return f},getUnreadCountOf:function(h){var g=this._getNodeOf(h);var f=this._getNodeUnreadCount(g);return f},setUnreadCountOf:function(i,h){var g=this._getNodeOf(i);g.closemail=h;var f=this.getElNodeOf(i);f.addClass("dirty");f.parents("."+c.CLS_NODE).addClass("dirty")},_openFolder:function(h,f){neo.denbun.keysearch.cleanUp("mail-easy_search-keyword");var g=this._getPage();g.showFolder(h,f)},_getRemoveMessage:function(){var g=this;var f={};var h=this.getCurNodeId();if(!h){return f}if(g._isTrashDescendantId(h)){f.message=d.getText("選択中のフォルダを削除してよろしいですか？");f.addmessage=d.getText("※フォルダに保存されているメール及びサブフォルダもすべて削除されます。")}else{f.message=d.getText("選択中のフォルダをゴミ箱に移動してよろしいですか？")}return f},_getElAccountNodeOf:function(h){var g=this.getElRoot();var f=g.find("["+a.DATA_ACCOUNT_ID+"="+h+"]");return f},_getAccountId:function(f){var g=f.attr(a.DATA_ACCOUNT_ID);return g},_getElReceiveNode:function(h){var g=this._getElAccountNodeOf(h);var f=g.find("."+a.CLS_RECEIVED);return f},_getElUnreadCount:function(f){var g=f.find(">."+c.CLS_LINK+">."+a.CLS_UNREAD_COUNT_CONTAINER+">."+a.CLS_UNREAD_COUNT+"");return g},updateView:function(l){var o=this;var k=o.getElContainer();var f=k.find("."+c.CLS_NODE+(l?"":".dirty"));for(var m=0;m<f.length;m++){var h=f.eq(m);var g=o.getNodeIdFrom(h);var j=o._getNodeOf(g);if(!j){continue}var n=o._getNodeUnreadCount(j);o._updateNodeUnreadCount(g,n)}o._updateHavingUnreadDescendants();if(!l){f.removeClass("dirty")}},update:function(h,f){this._setCallbackForUpdating(h);var g=this._getAjaxUpdate(f);g.sendRequest()},_updateLow:function(g){var f=this._parseResponse(g);for(var h=0;h<f.getLength();h++){var j=f.getAt(h);this._updateAccountCount(j)}this._updateHavingUnreadDescendants()},_updateAccountCount:function(f){this._updateChildNodes(f)},_updateChildNodes:function(h){var g=h.children;for(var f=0;f<g.getLength();f++){var j=g.getAt(f);this._updateNode(j)}},_updateNode:function(g){this._addNode(g);var h=this._getNodeId(g);var f=this._getNodeUnreadCount(g);this._updateNodeUnreadCount(h,f);this._updateChildNodes(g);return},_updateNodeUnreadCount:function(i,h){var f=this.getElNodeOf(i);var g=this._getElUnreadCount(f);g.text(h);f.toggleClass(a.CLS_HAS_UNREAD,(h>0))},_updateHavingUnreadDescendants:function(){var j=this.getElContainer();var f=j.find("."+c.CLS_NODE);for(var h=0;h<f.length;h++){var g=f.eq(h);g.toggleClass(a.CLS_HAS_UNREAD_DESCENDANTS,(g.find("."+a.CLS_HAS_UNREAD).length>0))}},addDraftCount:function(k,j){if(this._getImapServer()==a.IMAP_SERVER_TYPE_GMAIL){return}var g=this.getDraftIdIn(k);var f=this._getNodeOf(g);var i=this.getUnreadCountOf(g);var h=i+j;this._setNodeUnreadCount(f,h)},_hookOneNode:function(g){var f=this._getElLinkFrom(g);this._hookDraggable(f);this._hookDroppable(f)},_updateDraggableHelper:function(i,h){var g=this._getElLinkFrom(i);var f=i.clone().empty().append(g.clone());h.empty().append(f);var j=this.getNodeIdFrom(i);this._setIdToHelper(h,j)},_setIdToHelper:function(f,g){f.data(d.DATA_ID,g)},_getIdFromHelper:function(f){var g=f.data(d.DATA_ID);return g},_moveMails:function(j,i){if(!this._isMailDroppableFolder(j)){return}var g=i.data(d.Table.DATA_SELECTED_DATA_LIST);var f=this.getNodeIdFrom(j);var h=this._getPage();h.moveMails(g,f)},_isMailDroppableFolder:function(f){if(f.hasClass(a.CLS_ACCOUNT)){return false}if(f.hasClass(a.CLS_DRAFT)){return false}return true},create:function(){var f=this._getDlgCreate();f.open()},_updateDlgCreate:function(h){var j=this._getElNewFolderName();j.val("");setTimeout(function(){j.select()},1);var f=this._getFoldersToCreate();f.update();var g=f.setting.elContainer;d.Mail.ListPage.Folders.killUnreadClass(g);var i=this.getCurNodeId();f.select(i)},_sendRequestToCreate:function(){var f=this._getErrorMessageToCreate();if(f){d.alert(f);return false}var g=this._getAjaxCreate();g.sendRequest()},_getErrorMessageToCreate:function(){var i=null;var j=this._getElNewFolderName();var h=j.val();if(/^[ 　]*$/.test(h)){i=d.getText("フォルダ名を入力してください。");return i}var f=this._getFoldersToCreate();var g=f.getCurNodeId();if(g==null){i=d.getText("フォルダを選択してください。");return i}return i},_appendCreatedFolder:function(i,l){var h=this.getElNodeOf(l);var f=this._searchElNodeToInsertBefore(i,h);var j;if(f){var g=this.getNodeIdFrom(f);j=this.insertBefore(i,g)}else{j=this.append(i,l)}var k=this.getNodeIdFrom(j);this._openPathTo(k);this.scrollToShow(k)},move:function(){var f=this.getElCurNode();if(this._isSystemFolder(f)){return}var g=this._getDlgMove();g.open()},_updateDlgMove:function(h){var f=this._getFoldersToMove();f.update();var g=f.setting.elContainer;d.Mail.ListPage.Folders.killUnreadClass(g);var i=this.getCurNodeId();f.select(i)},_decideToMoveOnDialog:function(){var h=this._getErrorMessageToMove();if(h){d.alert(h);return false}var i=this.getCurNodeId();var f=this._getFoldersToMove();var g=f.getCurNodeId();this._moveFolderLow(i,g)},_getErrorMessageToMove:function(){var g=null;var f=this._getFoldersToMove();var i=f.getCurNodeId();var h=this.getCurNodeId();if(i==h||f.isDescendantOf(i,h)){g=d.getText("親フォルダをサブフォルダに移動することはできません。");return g}return g},_decideToMoveOnTree:function(j,i){var k=this._getIdFromHelper(i);var f=this.getElNodeOf(k);var h=this._getElParentNode(f);if(j[0]==h[0]){return}if(this.isDescendantElementOf(j,k)){return}var g=this.getNodeIdFrom(j);this._moveFolderLow(k,g)},_moveFolderLow:function(i,f){var h={id:i,tofid:f};this._setDataToMove(h);var g=this._getAjaxMove();g.sendRequest()},_finishMoving:function(j,h,g,f){this._updateId(j,h);this._moveElFolder(h,f);var i=this.getCurNodeId();if(i==j){this.select(h)}},_moveElFolder:function(k,g){elTarget=this.getElNodeOf(g);var i={id:k,Name:this.getNameOf(k)};var f=this._searchElNodeToInsertBefore(i,elTarget);var j=this.getElNodeOf(k);if(f){var h=this.getNodeIdFrom(f);this.insertElNodeBefore(j,h)}else{this.appendElNode(j,g)}this._updateHavingUnreadDescendants();this._openPathTo(k);this.scrollToShow(k);if(DENBUN_MODE_XNEO){this._openFolder(k,false)}},_searchElNodeToInsertBefore:function(h,k){var m=null;var f=this._getNodeId(h);var o=this._getElTree(k);var g=o.children();for(var l=0;l<g.length;l++){var n=g.eq(l);if(this._isSystemFolder(n)){continue}var j=this.getNodeIdFrom(n);if(f<j){m=n;break}}return m},remove:function(){var j=this.getCurNodeId();if(!j){return}var h=this.getElCurNode();if(this._isSystemFolder(h)){return}var g=this;var f=g._getRemoveMessage();var i={onok:function(){if(g._isTrashDescendantId(j)){g._removeLow()}else{g._moveUnderTrash(j)}}};d.confirm(f.message,i,f.addmessage)},_removeLow:function(){var f=this._getAjaxRemove();f.sendRequest()},_moveUnderTrash:function(i){var g=this.getElNodeOf(i);var f=this._getElTrashFrom(g);var h=this.getNodeIdFrom(f);this._moveFolderLow(i,h)},rename:function(){var h=this.getCurNodeId();if(!h){return}var f=this.getElCurNode();if(this._isSystemFolder(f)){return}var g=this._getDlgRename();g.open()},_updateDlgRename:function(h){var g=this.getCurNodeId();var f=this.getNameOf(g);var i=this._getElRenameFolderName();i.val(f);setTimeout(function(){i.select()},1)},_sendRequestToRename:function(){var h=this._getErrorMessageToRename();if(h){d.alert(h);return false}var k=this._getElRenameFolderName();var g=k.val();var j=this.getCurNodeId();var f=this.getNameOf(j);if(g==f){return}var i=this._getAjaxRename();i.sendRequest()},_getErrorMessageToRename:function(){var g=null;var h=this._getElRenameFolderName();var f=h.val();if(/^[ 　]*$/.test(f)){g=d.getText("フォルダ名を入力してください。");return g}return g},_finishRenaming:function(i,g,f){this._updateId(i,g);this._updateNameLow(g,f);var h=this.getCurNodeId();if(h==i){this.select(g)}},_updateNameLow:function(g,f){this.__call("_updateNameLow",arguments);this._updateNameInTable()},_updateNameInTable:function(){var f=this._getPage();f.updateFolderNameInTable()},emptyTrash:function(h){var g=d.getText("ゴミ箱に保存されているデータを全て削除します。\nよろしいですか？");var f=this;d.confirm(g,{onok:function(){f._emptyTrashLow(h)}})},_emptyTrashLow:function(i){if(!i){i=this.getElCurNode()}var f=this._getElTrashFrom(i);var j=this.getNodeIdFrom(f);var h={fid:j};this._setDataToEmptyTrash(h);var g=this._getAjaxEmptyTrash();g.sendRequest()},_updateEmptiedTrash:function(i){var f=true;var g=this._getPage();var h=this.getCurNodeId();if(!this._isTrashId(h)&&!g.isSearchModeTable()){f=false}if(this._isTrashDescendantId(h)){this.select(i)}this._cleanupTrashDescendants(i);this.update(null,f)},_cleanupTrashDescendants:function(i){if(!this._isTrashId(i)){return}var h=this.getElNodeOf(i);var f=h.find(">."+c.CLS_TREE+">*");var g=this;f.each(function(k,j){var l=j.getAttribute(c.DATA_ID);g._execRemovingLow(l)});h.removeClass(c.CLS_WITH_CHILDREN)},_getElTrashFrom:function(h){var g=this._getElAccountNodeFrom(h);var f=g.find("."+a.CLS_TRASH);return f},_updateMenuStatus:function(i){var g=this.getElCurNode();if(g.length<1){var f=i.find("."+d.App.Menu.CLS_MENU_ITEM);f.addClass(d.CLS_DISABLED)}else{var k=this.getCurNodeId();var f=i.find("."+d.App.Menu.CLS_MENU_ITEM);f.removeClass(d.CLS_DISABLED);var l=f.filter("."+a.CLS_MENU_ITEM_FOR_USER_FOLDER);var h=(this._isSystemFolder(g));l.toggleClass(d.CLS_DISABLED,h);var j=f.filter("[data-action=empty_trash]");h=!this._isTrashId(k);j.toggleClass(d.CLS_DISABLED,h)}},_updateOperatorStatus:function(){var h=this._getElCreate();h.attr("disabled",false);var f=this._getElRemove();var g=this.getElCurNode();if(g.length<1||this._isSystemFolder(g)){f.attr("disabled",true)}else{f.attr("disabled",false)}},getAccountIdOfFolder:function(f){var g=this.getElNodeOf(f);var h=this._getElAccountNodeFrom(g);var i=this._getAccountId(h);return i},_getElAccountNodeFrom:function(g){var f=g.closest("."+a.CLS_ACCOUNT);return f},getTrashIdIn:function(i){var g=this._getElAccountNodeOf(i);var f=g.find("."+a.CLS_TRASH);var h=this.getNodeIdFrom(f);return h},getDraftIdIn:function(i){var g=this._getElAccountNodeOf(i);var f=g.find("."+a.CLS_DRAFT);var h=this.getNodeIdFrom(f);return h},_isSystemFolder:function(f){return(f.hasClass(a.CLS_ACCOUNT)||f.hasClass(a.CLS_RECEIVED)||f.hasClass(a.CLS_SENT)||f.hasClass(a.CLS_TRASH)||f.hasClass(a.CLS_DRAFT))},isOwnMailFolderId:function(h){if(h<0||h==null){return false}var g=this._getNodeOf(h);var f=g[a.KEY_NODE_TYPE];if(DENBUN_MODE_XNEO){if(f==a.NODE_TYPE_OTHER){return this._isSentDescendantId(h)}}return(f==a.NODE_TYPE_SENT||f==a.NODE_TYPE_DRAFT)},_isSentDescendantId:function(h){var f=this.getElNodeOf(h);var g=f.parents("."+a.CLS_SENT);return(g.length>0)},_isTrashId:function(g){var f=this.getElNodeOf(g);return(f&&f.hasClass(a.CLS_TRASH))},_isTrashDescendantId:function(h){var g=this.getElNodeOf(h);var f=g.parents("."+a.CLS_TRASH);return(f.length>0)},_isFolderDraggableHelper:function(f){var g=f.attr("id");return(g==a.ID_DRAGGABLE_HELPER)},_updateId:function(j,l){var n=this._getNodeOf(j);n.id=l;var m=this.getElNodeOf(j);m.attr(c.DATA_ID,l);var g=this._getNodes();g.remove(j);g.set(l,n);var m=this.getElNodeOf(l);var s=this._getElTree(m);var k=s.children();var h=this._getDelimiter();for(var q=0;q<k.length;q++){var r=k.eq(q);var o=this.getNodeIdFrom(r);var f=o.slice(o.lastIndexOf(h)+1);var p=l+h+f;this._updateId(o,p)}},onsuccessLoad:function(g,f,h){this.__call("onsuccessLoad",arguments);this._initDelimiter(b(":first",g));this._initImapServer(b(":first",g));this.openFirstNode()},onerrorLoad:function(j,h,l){var k=this._getPage();k.clearAutoReceiving();var i=-6201192;if(l.errorno==i){var f=this._getElRemove();f.attr("disabled",true);var g=this._getElCreate();g.attr("disabled",true);var k=this._getPage();setTimeout(function(){k.proposeCreatingAccount()},1);return false}return},onchange:function(h){var f=this._getNodeOf(h);if(f&&!this._isAccountNode(f)){this._openFolder(h)}else{var g=this._getPage();g.cleanMailList()}this._updateOperatorStatus()},onsuccessUpdate:function(h,g,j){var i=d.getAjaxSendParams(g)["_"];var f=this._getLastUpdateConnectionKey();if(i!=f){return}this._updateLow(h);var k=this._getPage();k.reloadTable()},onerrorUpdate:function(j,h,l){var k=this._getPage();k.clearAutoReceiving();var i=-6201192;if(l.errorno==i){var f=this._getElRemove();f.attr("disabled",true);var g=this._getElCreate();g.attr("disabled",true);var k=this._getPage();setTimeout(function(){k.proposeCreatingAccount()},1);return false}return},onsuccessUpdateNoMailList:function(g,f,h){this._updateLow(g)},onfinishUpdate:function(){var f=this._getCallbackForUpdating();if(typeof f=="function"){f()}},ondragstart:function(g,h,j){var f=b(j);var i=this._getElNodeFrom(f);this._updateDraggableHelper(i,h.helper)},ondrop:function(g,i,j){var h=this._getPage();var f=h._getElLeftContainer().width()||0;if(f<i.position.left-3){return}this._setElLastHoveredNode(null);var k=this._getElNodeFrom(b(j));if(this._isFolderDraggableHelper(i.helper)){this._decideToMoveOnTree(k,i.helper)}else{this._moveMails(k,i.helper)}},onsuccessCreate:function(g,f,h){var j=d.getAjaxSendParams(f);var i={id:b(g).find("id").text(),Name:j.Name};var k=j.pfid;this._appendCreatedFolder(i,k)},onsuccessMove:function(g,f,k){var l=d.getAjaxSendParams(f);var m=l.id;var j=b("id",g).text();var i=l.Name;var h=l.tofid;this._finishMoving(m,j,i,h)},onsuccessRemove:function(g,f,h){var i=d.getAjaxSendParams(f);var j=i.id;this.execRemoving(j)},onsuccessRename:function(g,f,j){var k=d.getAjaxSendParams(f);var l=k.id;var i=b("id",g).text();var h=k.Name;this._finishRenaming(l,i,h)},onclickEmptyTrash:function(f,g){this.emptyTrash(b(g))},onsuccessEmptyTrash:function(g,f,h){var i=d.getAjaxSendParams(f);var j=i.fid;this._updateEmptiedTrash(j)},__bind:d.__bind,banpei:null}})})(jQuery);(function(b){var d=neo.core.readyNamespace("neo.denbun.Mail.ListPage.Table");if(!d){return}var c=neo.denbun;var a=neo.denbun.Mail.ListPage.Table=new neo.core.Class({superClass:c.Table,classProperties:{CLS_CELL_PRIORITY:"mail-table-cell-priority",CLS_CELL_ATTACHMENT:"mail-table-cell-attachment",CLS_CELL_FLAG:"mail-table-cell-flag",CLS_CELL_FROM:"mail-table-cell-from",CLS_CELL_SUBJECT:"mail-table-cell-subject",CLS_CELL_DATETIME:"mail-table-cell-datetime",CLS_CELL_SIZE:"mail-table-cell-size",CLS_CELL_FOLDER:"mail-table-cell-folder",CLS_UNREAD_ROW:"mail-table-row-unread",CLS_HIGH_PRIORITIZED_ROW:"mail-table-row-high_prioritized",CLS_LOW_PRIORITIZED_ROW:"mail-table-row-low_prioritized",CLS_ROW_WITH_ATTACHMENT:"mail-table-row-with_attachment",CLS_FLAGED_ROW:"mail-table-row-flaged",CLS_REPLIED_ROW:"mail-table-row-replied",CLS_FORWARDED_ROW:"mail-table-row-forwarded",CLS_ERROR_NAME:"mail-table-error-name",CLS_ERROR_MESSAGE:"mail-table-error-message",CLS_SEARCH_MODE:"mail-table-search_result",CLS_OWN_MAILS:"mail-table-own_mails",PARAM_FOLDER_ID:"fid",PARAM_SORT:"fldsort",PARAM_SORT_ORDER:"order",CMD_GET_LIST:"maillist",CMD_SEARCH:"mailsearch",CMD_GET_SEARCH_RESULT:"mailsearchlist",CMD_STOP_SEARCHING:"mailsearchstop",SORT_PRIORITY:"important",SORT_ATTACHMENT:"attach",SORT_FLAG:"flag",SORT_FROM:"from",SORT_SUBJECT:"subject",SORT_DATETIME:"date",SORT_SIZE:"size",SORT_FOLDER:"fid",SORT_ORDER_ASC:"1",SORT_ORDER_DESC:"-1",constructor:function(){}},properties:{_cmd:null,_getCmd:function(){return this._cmd},_setCmd:function(e){return this._cmd=e},_folderId:null,getFolderId:function(){return this._folderId||this._initFolderId()},_initFolderId:function(){var e=this._getConditions(a.PARAM_FOLDER_ID);return this._folderId=e},_flgSearchMode:null,isSearchMode:function(){return this._flgSearchMode},_setFlgSearchMode:function(e){return this._flgSearchMode=e},_startedSearching:null,_isStartedSearching:function(){return this._startedSearching},_initStartedSearching:function(){return this._startedSearching=false},_setStartedSearching:function(){return this._startedSearching=true},_stoppedSearching:null,_isStoppedSearching:function(){return this._stoppedSearching},_initStoppedSearching:function(){return this._stoppedSearching=false},_setStoppedSearching:function(){return this._stoppedSearching=true},_flgOwnMails:null,isOwnMails:function(){return this._flgOwnMails},_setFlgOwnMails:function(e){return this._flgOwnMails=e},_dlgSearching:null,_getDlgSearching:function(){return this._dlgSearching||this._initDlgSearching()},_initDlgSearching:function(){var e=this;var g={buttons:{},content:c.getText("検索中..."),title:c.getText("お待ちください"),oncancel:function(){e._stopSearching()}};g.buttons[c.getText("キャンセル")]=function(){var h=this;h.cancel()};var f=new c.Dialog(g);f.initialize();return this._dlgSearching=f},_elAreaContainer:null,_getElAreaContainer:function(){return this._elAreaContainer||this._initElAreaContainer()},_initElAreaContainer:function(){return this._elAreaContainer=b("#mail-table-container")},_searchForm:null,_getSearchForm:function(){return this._searchForm||this._initSearchForm()},_initSearchForm:function(){return this._searchForm=b("#mail-easy_search")},_elSearchKeyword:null,getElSearchKeyword:function(){return this._elSearchKeyword||this._initElSearchKeyword()},_initElSearchKeyword:function(){return this._elSearchKeyword=b("#mail-easy_search-keyword")},_elSearchExec:null,_getElSearchExec:function(){return this._elSearchExec||this._initElSearchExec()},_initElSearchExec:function(){return this._elSearchExec=b("#mail-easy_search-exec")},_elNumOfAll:null,_getElNumOfAll:function(){return this._elNumOfAll||this._initElNumOfAll()},_initElNumOfAll:function(){return this._elNumOfAll=b("#mail-table-counter-all")},_elError:null,_getElError:function(){return this._elError||this._initElError()},_initElError:function(){return this._elError=b("#mail-table-error")},_elErrorItemTemplate:null,_getElErrorItemTemplate:function(){return this._elErrorItemTemplate},_initElErrorItemTemplate:function(){var f=this._getElError();var e=c.CLS_TEMPLATE;var g=f.find("."+e).removeClass(e).remove();return this._elErrorItemTemplate=g},_elErrorAccount:null,_getElErrorAccount:function(){return this._elErrorAccount||this._initElErrorAccount()},_initElErrorAccount:function(){return this._elErrorAccount=b(".mail-table-error-name")},_elArea:null,_getElArea:function(){return this._elArea||this._initElArea()},_initElArea:function(){return this._elArea=b("#mail-table")},_elTitleBox:null,_getElTitleBox:function(){return this._elTitleBox||this._initElTitleBox()},_initElTitleBox:function(){var e=this._getElArea();var f=e.find(" ."+c.Table.CLS_HEADER_CONTAINER+" ."+c.Table.CLS_BOX+"");return this._elTitleBox=f},setting:null,_getPage:function(){return this.setting.page},_getElSectionTitleLow:function(){return b("#mail-table-title")},_getElPagerLow:function(){return b("#mail-table-pager")},_getElContainerLow:function(){return b("#mail-table")},_getElDraggableHelperLow:function(){var g=b("#mail-draggable-helper");if(!DENBUN_MODE_XNEO){var f=g.text();var e=c.getText(f);g.html(e)}return g},_getElDraggableHelperCounterLow:function(){return b("#mail-draggable-helper-length")},_setConditions:function(e){this.__call("_setConditions",arguments);this._initFolderId();return this._conditions},_getUrlToLoad:function(){return c.getUrl(c.CGI_EML)},_getDataToLoad:function(){var e=this._getConditions();e.cmd=this._getCmd();return e},_dataToRemoveError:null,_getDataToRemoveError:function(){return this._dataToRemoveError},_setDataToRemoveError:function(e){return this._dataToRemoveError=e},_ajaxRemoveError:null,_getAjaxRemoveError:function(){return this._ajaxRemoveError||this._initAjaxRemoveError()},_initAjaxRemoveError:function(){var e=this;var f={getSendData:function(){var h=e._getDataToRemoveError();h.cmd="mailcmdaccount";return h}};var g=new c.Ajax(f);g.initialize();return this._ajaxRemoveError=g},initialize:function(){this._initElErrorItemTemplate();this.__call("initialize",arguments)},_hook:function(){this.__call("_hook",arguments);var e;e=this._getElErrorAccount();this.__bind(e,"click","Error");e=this._getElTitleBox();this.__bind(e,"click","TitleBox");e=this._getSearchForm();this.__bind(e,"submit","Search");if(c.isIe7()){e=this._getElSearchExec();this.__bind(e,"click","ExecSearch")}this._hookDraggable()},_getDraggableSetting:function(){var e=this.__call("_getDraggableSetting",arguments);e.scope=c.Mail.DROPPABLE_SCOPE;return e},load:function(e){if(!e.fid&&!this.isSearchMode()){return}this._updateToolbarEnabled(true);this._cleanViewer();if(!e[a.PARAM_SORT_ORDER]){this._cleanSortIcons()}return this.__call("load",arguments)},_parse:function(f){var g=this.__call("_parse",arguments);var e=b(f).children();g.errorList=this._parseErrorList(e);return g},_parseErrorList:function(f){var e=f.find(">recverr");var j=[];for(var h=0;h<e.length;h++){var g=e.eq(h);var k=c.parseAttributes({},g);k.message=g.text();j.push(k)}return j},_update:function(f){var e=this._getPage();if(f&&f.savedel=="1"){e.removeExpiredMails()}this._updateFlgOwnMails();this.__call("_update",arguments);this._updateListDataForView();this._updateCapacity();this.updateCount();this._updateError(f);if(this.isSearchMode()){e.enableDownloadSearchResultButton()}this._updateFolder(f)},_updateListDataForView:function(){var f=this;if(f._getData()){var g={};var e=[];var h;var m;var j=b.extend(true,{},f._getConditions());g.cond=j;var k=f._getIdList();for(h=-1;m=k[++h];){var l=c.Mail.splitId(m);e.push(l)}g.idListCnt=h;g.idList=e;g[c.Table.PARAM_OFFSET]=j[c.Table.PARAM_OFFSET]||0;g.range=f._getTableRange();g.allcnt=f._getCount();g[c.Mail.PARAM_LISTDATA_KEY]=desknets.createRandomId();c.Mail.setListDataForView(g)}else{c.Mail.setListDataForView(null)}},_updateFlgOwnMails:function(){var k=this.getFolderId();var g=this._getPage();var j=g.isOwnMailFolderId(k);this._setFlgOwnMails(j);var h=this._getElAreaContainer();h.toggleClass(a.CLS_OWN_MAILS,j);if(DENBUN_MODE_XNEO){var e=this._getElHeaderContainer();var f=e.find("."+a.CLS_CELL_FROM);var i="";if(j){i=f.find("#mail-table-label-to").text()}else{i=f.find("#mail-table-label-from").text()}f.attr("title",i)}},_getTitle:function(){var f;if(this.isSearchMode()){f=c.getText("検索結果")}else{var e=this.getFolderId();f=this._getFolderNameOf(e)||""}return f},_getFolderNameOf:function(e){var g=this._getPage();var f=g.getFolderNameOf(e);return f},_updateCapacity:function(){var f=this._getData();var g;var e;if(f){var g=f.fusage;var e=f.flimit}c.app.updateCapacity(g,e)},updateCount:function(){var e=this._getCount();var f=this._getElNumOfAll();f.text(e)},_updateError:function(k){var f=this._getElError();f.scrollTop(0).empty().hide();var j=k&&k.errorList;var h=k&&k.filtererr;if((j&&j.length>0)||h){for(var g=0;g<j.length;g++){var k=j[g];var e=this._buildElErrorItem(k);f.append(e)}if(h){var e=this._buildElFilterErrorItem(h);f.append(e)}f.show();c.$window.trigger("resize")}},_buildElErrorItem:function(i){var h=this._getElErrorItemTemplate();var e=h.clone();var g=e.find("."+a.CLS_ERROR_NAME);g.attr(c.DATA_ID,i.id);g.text(i.recverracc);var f=e.find("."+a.CLS_ERROR_MESSAGE);f.text(i.message);return e},_buildElFilterErrorItem:function(h){var g=this._getElErrorItemTemplate();var e=g.clone();var f=e.find("."+a.CLS_ERROR_MESSAGE);f.text(h);e.children().empty().append(f);return e},_updateFolder:function(f){if(f&&f.moveflg=="1"){var e=this._getPage();e.updateFolders(null,false)}},clean:function(){this._setConditions(null);this._switchSearchMode(false);if(DENBUN_MODE_XNEO){var f=this._getElSearchExec();f.attr("disabled",true);var e=this.getElSearchKeyword();e.attr("disabled",true);this._updateToolbarEnabled(true)}this.__call("clean",arguments)},_getRowClassList:function(k){var j=["com_table-row"];var f="0";if(k.data.open==f){j.push(a.CLS_UNREAD_ROW)}var h="1";var i="2";switch(k.data.sflg){case h:j.push(a.CLS_REPLIED_ROW);break;case i:j.push(a.CLS_FORWARDED_ROW);break}var g="1";var e="5";switch(k.data.priority){case g:j.push(a.CLS_HIGH_PRIORITIZED_ROW);break;case e:j.push(a.CLS_LOW_PRIORITIZED_ROW);break}if(k.data.attcount!="0"){j.push(a.CLS_ROW_WITH_ATTACHMENT)}if(k.data.flag!="0"){j.push(a.CLS_FLAGED_ROW)}return j},_buildTableCellsHtml:function(f,p,h){var j='<img class="mail-table-icon" src="'+c.PATH_IMG_SPACER+'" width="14" height="14" alt="">';var n=0;var l=this._getTableCellEndHtml();var i=p.data;f.push(this._getTableCellStartHtml([a.CLS_CELL_PRIORITY],h[n++]));f.push(j);f.push(l);f.push(this._getTableCellStartHtml([a.CLS_CELL_ATTACHMENT],h[n++]));f.push(j);f.push(l);f.push(this._getTableCellStartHtml([a.CLS_CELL_FLAG],h[n++]));f.push(j);f.push(l);f.push(this._getTableCellStartHtml([a.CLS_CELL_FROM],h[n++]));f.pushText(i.from);f.push(l);f.push(this._getTableCellStartHtml([a.CLS_CELL_SUBJECT,c.Table.CLS_FLEXIBLE_CELL],h[n++]));f.push(j);f.pushText(i.subject);f.push(l);var k="";if(DENBUN_MODE_XNEO){if(i.date&&i.date!=""){k=desknets.dateTime.dispDateTime(i.date,{type:"list"})}}else{k=c.Mail.getDatetimeText(i.date,i.zone)}f.push(this._getTableCellStartHtml([a.CLS_CELL_DATETIME],h[n++]));f.push(k);f.push(l);var m=parseInt(i.size||"0",10);var o=desknets.numberFormatByte(m,0,0,2);f.push(this._getTableCellStartHtml([a.CLS_CELL_SIZE],h[n++]));f.push(o);f.push(l);if(this.isSearchMode()){var e=c.Mail.splitId(i.id).fid;var g=this._getFolderNameOf(e);f.push(this._getTableCellStartHtml([a.CLS_CELL_FOLDER],h[n++]));f.pushText(g);f.push(l)}return f},showFolder:function(h,f){var g={fid:h};this._switchSearchMode(false);this._setCmd(a.CMD_GET_LIST);var e=this.getElSearchKeyword();e.val("");if(f===false){this.reload(g)}else{this.load(g)}},showSearchResult:function(e,f){this._switchSearchMode(true,f);this._setCmd(a.CMD_SEARCH);this._showSearchingDialog();this.load(e)},_switchSearchMode:function(g,i){this._setFlgSearchMode(g);this._initStartedSearching();this._initStoppedSearching();var h=this._getElAreaContainer();h.toggleClass(a.CLS_SEARCH_MODE,g);var f=this._getElSearchExec();f.attr("disabled",g&&!i);var e=this.getElSearchKeyword();e.attr("disabled",g&&!i);if(g&&!i){e.val("")}},_stopSearching:function(){this._setTmSearch(null);this._setStoppedSearching();this._setCmd(a.CMD_STOP_SEARCHING);this.reload()},_showSearchingDialog:function(){var e=this._getDlgSearching();e.open()},_hideSearchingDialog:function(){var e=this._getDlgSearching();e.close()},open:function(){var f=this.getCurId();var e=this._getPage();e.openMail(f)},remove:function(){var e=this._getPage();e.remove()},_sort:function(k){var i=this._getSortType(k);if(!this._isSortableType(i)){return}var l={};l[c.Table.PARAM_OFFSET]="";var g=this._getConditions();var h=g[a.PARAM_SORT];if(i==h){var j=g[a.PARAM_SORT_ORDER];var e;if(j==a.SORT_ORDER_ASC){e=a.SORT_ORDER_DESC}else{e=a.SORT_ORDER_ASC}l[a.PARAM_SORT_ORDER]=e}else{l[a.PARAM_SORT]=i;var e=this._getDefaultSortOrder(i);l[a.PARAM_SORT_ORDER]=e}this.reload(l,false);this._cleanSortIcons();var f=k.find("."+c.CLS_COM_TRIANGLE);if(l[a.PARAM_SORT_ORDER]==a.SORT_ORDER_ASC){f.addClass(c.CLS_COM_TRIANGLE_UP)}else{f.addClass(c.CLS_COM_TRIANGLE_DOWN)}},_getSortType:function(e){var f;b.each([{cls:a.CLS_CELL_PRIORITY,sortType:a.SORT_PRIORITY},{cls:a.CLS_CELL_ATTACHMENT,sortType:a.SORT_ATTACHMENT},{cls:a.CLS_CELL_FLAG,sortType:a.SORT_FLAG},{cls:a.CLS_CELL_FROM,sortType:a.SORT_FROM},{cls:a.CLS_CELL_SUBJECT,sortType:a.SORT_SUBJECT},{cls:a.CLS_CELL_DATETIME,sortType:a.SORT_DATETIME},{cls:a.CLS_CELL_SIZE,sortType:a.SORT_SIZE},{cls:a.CLS_CELL_FOLDER,sortType:a.SORT_FOLDER},],function(g,h){if(!h){return}if(e.hasClass(h.cls)){f=h.sortType;return false}});return f},_isSortableType:function(e){return(e!=a.SORT_PRIORITY&&e!=a.SORT_ATTACHMENT&&e!=a.SORT_FLAG)},_getDefaultSortOrder:function(f){var e;switch(f){case a.SORT_PRIORITY:case a.SORT_ATTACHMENT:case a.SORT_FLAG:e=a.SORT_ORDER_DESC;break;case a.SORT_FROM:case a.SORT_SUBJECT:case a.SORT_DATETIME:case a.SORT_SIZE:case a.SORT_FOLDER:e=a.SORT_ORDER_ASC;break}return e},_cleanSortIcons:function(){var f=this._getElContainer();var e=f.find("."+c.CLS_COM_TRIANGLE);e.removeClass(c.CLS_COM_TRIANGLE_UP).removeClass(c.CLS_COM_TRIANGLE_DOWN)},search:function(){var e=this.getElSearchKeyword();var f=e.val();var h=this.getFolderId();if(f){var g=this._getPage();g.execEasySearch(f,h)}else{this.showFolder(h)}},updateFlagStyle:function(g,e){for(var f=0;f<g.length;f++){var h=g[f];this._updateFlagStyleOne(h,e)}},_updateFlagStyleOne:function(h,f){var g=this._getRowOf(h);g.data.flag=(f?"1":"0");var e=this._getElRowOf(h);e.toggleClass(a.CLS_FLAGED_ROW,f)},updateUnreadStyle:function(g,f){for(var e=0;e<g.length;e++){var j=g[e];this._updateUnreadStyleOne(j,f);var h=this._getRowOf(j);if(h){h.data.open=(f?"0":"1")}}},_updateUnreadStyleOne:function(g,f){var e=this._getElRowOf(g);e.toggleClass(a.CLS_UNREAD_ROW,f)},_updateToolbarEnabled:function(e){var f=this._getPage();f.updateMenuEnabled(e)},_cleanViewer:function(){var e=this._getPage();e.cleanViewer()},_updateDraggableHelper:function(h){var e=this._getDragingDataList();var g=e.length+"";var i=c.getText("$$ 件のメール");var f=neo.core.replace(i,g);h.text(f);var h=this._getElDraggableHelper();h.data(a.DATA_SELECTED_DATA_LIST,e)},_getDragingDataList:function(){var e=this.getSelectedIdList();return e},_getTableRange:function(){var e=parseInt(c.comSetting.getMailRow());return e},_showMail:function(f){var e=this._getPage();e.showMail(f)},_removeError:function(f){var h=c.getText("[OK]ボタンをクリックするとエラーを解除します。\nエラーが消えない場合は[設定]-[アカウント設定]にて設定内容を確認してください。");var e=this;var g={onok:function(){var l={id:f.attr(c.DATA_ID)};e._setDataToRemoveError(l);var k=e._getAjaxRemoveError();k.sendRequest();var i=f.closest(".mail-table-error-item");i.remove();var j=e._getElError();if(j.children().length<1){j.hide();c.$window.trigger("resize")}}};c.confirm(h,g)},isDraft:function(){var e;if(this.isSearchMode()){var g=this.getSelectedIdList();e=this._hasDraftMail(g)}else{var h=this.getFolderId();var f=this._getPage();e=f.isDraftFolderId(h)}return e},_hasDraftMail:function(l){var j=false;var k=this._getPage();for(var g=0;g<l.length;g++){var f=l[g];var h=c.Mail.splitId(f);var e=h.fid;if(k.isDraftFolderId(e)){j=true;break}}return j},isTrash:function(){var e=this;if(e.isSearchMode()){return false}var g=e.getFolderId();var f=e._getPage();return f.isTrashFolderId(g)},isUnread:function(f){var e;if(f){e=this._getRowOf(f)}return(e&&e.data.open!="1")},onsuccessLoad:function(g,f,i){var j=c.getAjaxSendParams(f);var h=j._;var e=this._getLastConnectionKey();if(h!=e){return}if(this._isStoppedSearching()){return}var l=j.cmd;if(l==a.CMD_SEARCH){this._setCmd(a.CMD_GET_SEARCH_RESULT);this._setStartedSearching();this.reload()}else{if(l==a.CMD_GET_SEARCH_RESULT){this._hideSearchingDialog()}var k=this._parse(g);this._update(k)}},_tmSearch:null,_getTmSearch:function(){return this._tmSearch},_setTmSearch:function(e){clearTimeout(this._tmSearch);return this._tmSearch=e},onerrorLoad:function(h,g,k){if(this._isStoppedSearching()){return false}else{if(this._isStartedSearching()&&k.errorno=="1"){var f=this;var j=1000;var e=setTimeout(function(){f.reload()},j);this._setTmSearch(e);return false}else{if(DENBUN_MODE_XNEO){var i=this._getPage();i.clearAutoReceiving()}this._hideSearchingDialog();return undefined}}},onchangeImmediately:function(){this._updateToolbarEnabled()},onchange:function(e){if(c.comSetting.getMainPageLayout()=="2"){return}this._showMail(e)},onclickError:function(f,g){var e=b(g);this._removeError(e)},onclickTitleBox:function(e,g){var f=b(g).closest("."+c.Table.CLS_CELL);this._sort(f)},onsubmitSearch:function(e,f){e.preventDefault();this.search()},onclickExecSearch:function(e,f){this.search()},ondragstart:function(e,f,g){this.__call("ondragstart",arguments)},banpei:null}});a.constructor()})(jQuery);(function(b){var f=neo.core.readyNamespace("neo.denbun.Mail.ViewPage");if(!f){return}var d=neo.denbun;var e=d.Mail;var c=e.ListPage;var a=neo.denbun.Mail.ViewPage=new neo.core.Class({superClass:d.Page,classProperties:{CLS_TOOLBAR_LIST_RIGHT:"toolbar-list-right",CLS_MAIL_VIEWER_PREV:"mail_viewer-prev",CLS_MAIL_VIEWER_NEXT:"mail_viewer-next",constructor:function(){}},properties:{_operator:null,_getOperator:function(){return this._operator||this._initOperator()},_initOperator:function(){var g=e.getOperator();g.setting.viewPage=this;return this._operator=g},_elTagLink:null,_getTagLink:function(){return this._elTagLink||this._initTagLink()},_initTagLink:function(){return this._elTagLink=d.Mail.getElSetTag()},_listDataForView:null,_getListDataForView:function(){return this._listDataForView},_setListDataForView:function(g){return this._listDataForView=g},_ajaxMailList:null,_getAjaxMailList:function(){return this._ajaxMailList||this._initAjaxMailList()},_initAjaxMailList:function(){var g=this;var h=d.getUrl(d.CGI_EML);var i={url:h,getSendData:g.__closure(g._getDataToMailList),onsuccess:g.__closure(g.onsuccessMailList)};var j=new d.Ajax(i);j.initialize();return this._ajaxMailList=j},__constructor:function(){},initialize:function(){d.app.hideHeader();d.Mail.getElFork().remove();if(DENBUN_MODE_XNEO){if(!d.comSetting.isAvailableAddress()){b("[data-action=addToAddressBook]").hide()}}if(d.isIe7()){setTimeout(function(){d.$window.resize()},1)}if(d.parent&&d.parent.Mail){var g=d.getParameter(d.Mail.PARAM_LISTDATA_KEY);var i=d.parent.Mail.getListDataForView();if(i&&g&&g!=""){if(g==i[d.Mail.PARAM_LISTDATA_KEY]){var k=b.extend(true,{},i);if(desknets.browser.msie8||desknets.browser.msie9){if(!!k&&!!k.idList){var l=[];var j;var h=k.idListCnt;for(j=0;j<h;j++){l.push(k.idList[j])}k.idList=l}}this._setListDataForView(k)}}}},open:function(){this._hideLeft();this._hideRight();var g=this;var h=arguments;var i=0;var j=2;var k=function(l){i++;if(i<j){return}if(d.comSetting.getMainPageLayout()=="2"){var m=g._getViewer();m.setForceChkDispositionNotification()}d.Page.prototype.open.apply(g,h)};d.comSetting.getMailSetting(k);d.comSetting.getNotification(k)},_initOnOpening:function(){d.Page.prototype._initOnOpening.apply(this,arguments);this._hideLeft();this._hideRight();d.$body.addClass(d.Mail.ListPage.CLS_VIEWER_MODE)},_getElOwnItemsLow:function(){return b(".page-mail_list-item")},_clean:function(){if(!this._getListDataForView()){b("."+a.CLS_TOOLBAR_LIST_RIGHT).hide()}e.enableAddToAddressBookButton();var h=d.getParameter(d.PARAM_MAIL_ID);var g=d.getParameter(d.PARAM_FOLDER_ID);var k=g+"_"+h;var i=this._getViewer();var j=function(){this._updateToolbarEnabled();var m=(d.parent||d);if(d.isIpadiOS6()){m=d}var l=m.Mail.getOperator();l.setUnread([k],false)};i.load(k,this.__closure(j))},onclose:function(g){d.$body.removeClass(d.Mail.ListPage.CLS_VIEWER_MODE);g()},reply:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.reply(h)},replyAll:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.replyAll(h)},forward:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.forward(h)},remove:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.remove([h],function(){if(d.parent&&!d.isIpadiOS6()){d.parent.app.updateMailList()}window.close();if(d.isIpadiOS8()){var i=d.getText("メールを削除しました。")+"\n"+d.getText("自動的にタブが閉じない場合は、手動でタブを閉じてください。");d.notifyAndOverlay(i);return}})},editAgain:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.editAgain(h)},writeToSender:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.writeToSender(h)},print:function(){var j=this._getSelectedSingleId();if(!j){return}var i=this._getViewer();var h=i._isViewOfMailFileMode();var g=this._getOperator();g.print(j,h)},addToAddressBook:function(){var j=this._getSelectedSingleId();if(!j){return}var i=this._getViewer();var h=i._isViewOfMailFileMode();var g=this._getOperator();g.addToAddressBook(j,h)},addSpamDomain:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.addSpamDomain([h])},addSpamAddress:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.addSpamAddress([h])},showHeaderDetail:function(){var j=this._getSelectedSingleId();if(!j){return}var i=this._getViewer();var h=i._isViewOfMailFileMode();var g=this._getOperator();g.showHeaderDetail(j,h)},addFlag:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.setFlag([h],true)},removeFlag:function(){var h=this._getSelectedSingleId();if(!h){return}var g=this._getOperator();g.setFlag([h],false)},addSch:function(){var g=this._getViewer();g.addSch()},addCreport:function(){var g=this._getViewer();g.addCreport()},addInfo:function(){var g=this._getViewer();g.addInfo()},addCab:function(){var g=this._getViewer();g.addCab()},prev:function(){var g=this;g._updateToolbarDisabled();g._prevMailView(true)},next:function(){var g=this;g._updateToolbarDisabled();g._nextMailView(true)},_getDataToMailList:function(){var g=this;var h={};var i=g._getListDataForView();if(i){h=i.cond}return h},_prevMailView:function(k){var h=this;var i=h._getPrevDataId();if(i){h._openMailView(i);return}if(!h._hasFirstPageData()&&k===true){var l=h._getListDataForView();var g=(l.row||0)-l.range;if(g<0){g=0}l.cond["row"]=g;var j=this._getAjaxMailList();j.sendRequest();return}h._updateToolbarEnabled()},_nextMailView:function(k){var h=this;var i=h._getNextDataId();if(i){h._openMailView(i);return}if(!h._hasLastPageData()&&k===true){var l=h._getListDataForView();var g=(l.row||0)+l.idList.length;l.cond["row"]=g;var j=this._getAjaxMailList();j.sendRequest();return}h._updateToolbarEnabled()},_openMailView:function(h){var g=this;var j={};var i=this._getViewer();j[d.PARAM_MAIL_ID]=h.id;j[d.PARAM_FOLDER_ID]=h.fid;i.setForceChkDispositionNotification();d.openPage(d.PAGE_MAIL_VIEW,j)},_getPrevDataId:function(){var h=this;var i;var j=h._getListDataForView();if(j&&j.idList){var g=h._getIndexOwnId(j.idList);if(g>0){i=j.idList[g-1]}}return i},_getNextDataId:function(){var h=this;var j;var k=h._getListDataForView();if(k&&k.idList){var g=h._getIndexOwnId(k.idList);var i=k.idList.length;if(g>=0&&g<i-1){j=k.idList[g+1]}}return j},_getIndexOwnId:function(l,g,i){var p=this;if(l){var m;var j=p._getViewer();var o={id:g,fid:i};if(!g||!i){var k=j.getId();o=d.Mail.splitId(k)}var h=l.length;for(m=0;m<h;m++){var n=l[m];if(n&&n.id==o.id&&n.fid==o.fid){return m}}}return -1},_hasFirstPageData:function(){var h=this;var i=h._getListDataForView();if(i.hasFirst===true){return true}var g=i.row||0;if(g==0){i.hasFirst=true;return true}return false},_hasLastPageData:function(){var j=this;var m=j._getListDataForView();if(m.hasLast===true){return true}if(m){var i=m.allcnt;var h=m.range;var k=m.row;var g=Math.max(Math.ceil(i/h),1);var l=(g-1)*h;if((k+m.idList.length)>l){m.hasLast=true;return true}}return false},_updateToolbarEnabled:function(){var i=this;var h=true;var g=true;var k=i._getElToolbar();var j;if(this._getListDataForView()){var m;var l;m=i._getPrevDataId();if(!m&&i._hasFirstPageData()){h=false}l=i._getNextDataId();if(!l&&i._hasLastPageData()){g=false}}k.find("."+d.App.Menu.CLS_BUTTON).blur();j=k.find("."+d.App.Menu.CLS_ITEM);j.removeClass(d.CLS_DISABLED);if(!h){k.find("."+a.CLS_MAIL_VIEWER_PREV).addClass(d.CLS_DISABLED)}if(!g){k.find("."+a.CLS_MAIL_VIEWER_NEXT).addClass(d.CLS_DISABLED)}},_updateToolbarDisabled:function(){var g=this;var i=g._getElToolbar();i.find("."+d.App.Menu.CLS_BUTTON).blur();var h=i.find("."+d.App.Menu.CLS_ITEM);h.addClass(d.CLS_DISABLED)},getRemoveMessage:function(){var h=this;var g={};if(h._isTrashFolder()){g.message=d.getText("このメールを完全に削除してよろしいですか？")}else{g.message=d.getText("このメールをゴミ箱に移動してよろしいですか？")}return g},_isTrashFolder:function(){var h=this;var i=h._getViewer();if(i){var g=i.getRealFolderType();if(g=="3"){return true}}return false},_getSelectedSingleId:function(){var g=this._getViewer();var h=g.getId();return h},_getViewer:function(){return e.getViewer()},onresize:function(g){e.updateViewerSize()},onsuccessMailList:function(g,x,v){var t=this;var n=0;var j=[];var o=b("result",g);var p=d.parseNode(o);var w=p.row||0;var m=t._getListDataForView();m.allcnt=p.allcnt;var r=o.find("item");for(n=0;n<r.length;n++){var k=d.parseNode(r.eq(n));var l=k.id.indexOf("_");var u=k.id.slice(l+1);var h=k.id.slice(0,l);var s=t._getIndexOwnId(m.idList,u,h);if(s>=0){continue}var q={id:u,fid:h};j.push(q)}if(w<m.row){m.row=w;var i=j.concat(m.idList);m.idList=i;t._prevMailView(false)}else{var i=m.idList.concat(j);m.idList=i;t._nextMailView(false)}},banpei:null}});a.constructor()})(jQuery);(function(b){var e=neo.core.readyNamespace("neo.denbun.Mail.EditPage");if(!e){return}var c=neo.denbun;var d=c.Mail;var a=neo.denbun.Mail.EditPage=new neo.core.Class({superClass:c.Page,classProperties:{PARAM_FOLDER_ID:"fid",PARAM_MAIL_ID:"msgid",PARAM_MAIL_SIZE:"size",PARAM_MAIL_MODE:"mode",PARAM_ACCOUNT:"accid",PARAM_TO:"to",PARAM_CC:"cc",PARAM_BCC:"bcc",PARAM_PRIORITY:"priority",PARAM_NOTIFICATION:"send",PARAM_SIGNATURE:"sign",PARAM_SUBJECT:"subject",PARAM_FLG_HTML:"htmlmail",PARAM_BODY_TYPE:"textkind",PARAM_BODY_TEXT:"body",PARAM_BODY_HTML:"edithtml",PARAM_TMPNM:"tmpnm",PARAM_CHARSET:"charset",PARAM_ATTACHMENTS:"attach",MODE_REPLY:"re",MODE_REPLY_ALL:"allre",MODE_FORWARD:"fw",MODE_EDIT_AGAIN:"again",MODE_WRITE_TO_SENDER:"sender",MODE_RESTART_EDITTING:"df",BODY_TYPE_TEXT:"0",BODY_TYPE_HTML:"1",SIGN_METHOD_DONTINSERT:"0",SIGN_METHOD_TOP:"1",SIGN_METHOD_END:"2",SIGN_METHOD_CARET:"caret",constructor:function(){}},properties:{_id:null,getId:function(){return this._id},_initId:function(){return this._id=c.getParameter(a.PARAM_MAIL_ID)},_settingLoaded:null,_isSettingLoaded:function(){return this._settingLoaded},_setSettingLoaded:function(){return this._settingLoaded=true},_edittingValue:null,_isEdittingValue:function(){return this._edittingValue},_initEdittingValue:function(){return this._edittingValue=false},setEdittingValue:function(f){return this._edittingValue=f},_valueChanged:null,_isValueChanged:function(){return this._valueChanged},_initValueChanged:function(){return this._valueChanged=false},setValueChanged:function(){return this._valueChanged=true},_closing:null,_isClosing:function(){return this._closing},_initClosing:function(){return this._closing=false},_setClosing:function(){return this._closing=true},_dataToGetNewMessageContent:null,_getDataToGetNewMessageContent:function(){return this._dataToGetNewMessageContent},_setDataToGetNewMessageContent:function(f){return this._dataToGetNewMessageContent=f},_readyingDialogCounter:null,_dlgReadying:null,_getDlgReadying:function(){return this._dlgReadying},_setDlgReadying:function(f){return this._dlgReadying=f},_dlgWaitForManaged:null,_getDlgWaitForManaged:function(){return this._dlgWaitForManaged||this._initDlgWaitForManaged()},_initDlgWaitForManaged:function(){var f=c.getText("準備中");var g=c.prevent(f);return this._dlgWaitForManaged=g},_ajaxGetNewMessageContent:null,_getAjaxGetNewMessageContent:function(){return this._ajaxGetNewMessageContent||this._initAjaxGetNewMessageContent()},_initAjaxGetNewMessageContent:function(){var f=this;var g={getSendData:function(){var i=f._getDataToGetNewMessageContent();i.cmd="mailsenddraft";return i},onsuccess:this.__closure(this.onsuccessGetNewMessageContent)};if(DENBUN_MODE_XNEO){g.onerror=this.__closure(this.onerrorGetNewMessageContent)}var h=new c.Ajax(g);h.initialize();return this._ajaxGetNewMessageContent=h},_area:null,_getArea:function(){return this._area||this._initArea()},_initArea:function(){var f={body:this._getBody(),page:this};var g=new a.Area(f);g.initialize();return this._area=g},_header:null,_getHeader:function(){return this._header||this._initHeader()},_initHeader:function(){var f={elBcc:this._getElBcc(),elCc:this._getElCc(),elCharsetList:this._getElCharsetList(),elFrom:this._getElFrom(),elTo:this._getElTo(),elSignatureList:this._getElSignatureList(),elSubject:this._getElSubject(),page:this};var g=new a.Header(f);g.initialize();return this._header=g},_body:null,_getBody:function(){return this._body||this._initBody()},_initBody:function(){var g={elBody:this._getElTextBody(),page:this};var f=new a.Body(g);f.initialize();return this._body=f},_sender:null,_getSender:function(){return this._sender||this._initSender()},_initSender:function(){var g=this;var f=function(){return g._getAutoSave()};var i={elCc:this._getElCc(),elBcc:this._getElBcc(),elCharsetList:this._getElCharsetList(),elFrom:this._getElFrom(),elSignatureList:this._getElSignatureList(),elSubject:this._getElSubject(),elTextBody:this._getElTextBody(),elTo:this._getElTo(),elTmpnm:this._getElTmpnm(),autosave:f,page:this};var h=new a.Sender(i);h.initialize();return this._sender=h},_elCharsetList:null,_getElCharsetList:function(){return this._elCharsetList||this._initElCharsetList()},_initElCharsetList:function(){return this._elCharsetList=b("#mail-edit-charset-list")},_elFrom:null,_getElFrom:function(){return this._elFrom||this._initElFrom()},_initElFrom:function(){return this._elFrom=b("#mail-edit-from")},_elTo:null,_getElTo:function(){return this._elTo||this._initElTo()},_initElTo:function(){return this._elTo=b("#mail-edit-to")},_elCc:null,_getElCc:function(){return this._elCc||this._initElCc()},_initElCc:function(){return this._elCc=b("#mail-edit-cc")},_elBcc:null,_getElBcc:function(){return this._elBcc||this._initElBcc()},_initElBcc:function(){return this._elBcc=b("#mail-edit-bcc")},_elSubject:null,_getElSubject:function(){return this._elSubject||this._initElSubject()},_initElSubject:function(){return this._elSubject=b("#mail-edit-subject")},_elTextBody:null,_getElTextBody:function(){return this._elTextBody||this._initElTextBody()},_initElTextBody:function(){return this._elTextBody=b("#mail-edit-body-text")},_elSignatureList:null,_getElSignatureList:function(){return this._elSignatureList||this._initElSignatureList()},_initElSignatureList:function(){return this._elSignatureList=b("#mail-edit-signature")},_elTmpnm:null,_getElTmpnm:function(){return this._elTmpnm||this._initElTmpnm()},_initElTmpnm:function(f){return this._elTmpnm=b("#mail-edit-attachment-tmpnm")},_elLimit:null,_getElLimit:function(){return this._elLimit||this._initElLimit()},_initElLimit:function(f){return this._elLimit=b("#mail-edit-attachment-limit")},_elAttFileList:null,_getElAttFileList:function(){return this._elAttFileList||this._initElAttFileLis()},_initElAttFileLis:function(f){return this._elAttFileList=b("#mail-edit-attach-list")},_defAttFileInfo:{tmpnm:"",files:[]},_getDefAttFileInfo:function(){return this._defAttFileInfo},_setDefAttFileInfo:function(f){return this._defAttFileInfo=f},_dataToGetAttList:null,_getDataToGetAttList:function(){return this._dataToGetAttList},_setDataToGetAttList:function(f){return this._dataToGetAttList=f},_ajaxGetAttList:null,_getAjaxGetAttList:function(){return this._ajaxGetAttList||this._initAjaxGetAttList()},_initAjaxGetAttList:function(){var f=this;var g={getSendData:function(){var i=f._getDataToGetAttList();i.cmd="mailsendgetatt";return i},onsuccess:this.__closure(this.onsuccessGetAttList)};var h=new c.Ajax(g);h.initialize();return this._ajaxGetAttList=h},_dataToGetSign:null,_getDataToGetSign:function(){return this._dataToGetSign},_setDataToGetSign:function(f){return this._dataToGetSign=f},_ajaxGetSign:null,_getAjaxGetSign:function(){return this._ajaxGetSign||this._initAjaxGetSign()},_initAjaxGetSign:function(){var f=this;var g={getSendData:function(){var i=f._getDataToGetSign();i.cmd="mailsignentry";return i},onsuccess:this.__closure(this.onsuccessGetSign)};var h=new c.Ajax(g);h.initialize();return this._ajaxGetSign=h},_signMethod:null,_getSignMethod:function(){return this._signMethod},_setSignMethod:function(f){this._signMethod=f},_autoSave:null,_getAutoSave:function(){return this._autoSave},_setAutoSave:function(f){this._autoSave=f},_autoSaveChk:true,_getAutoSaveChk:function(){return this._autoSaveChk},_setAutoSaveChk:function(f){this._autoSaveChk=f},_elAutoSaveSetting:null,_getElAutoSaveSetting:function(){return this._elAutoSaveSetting||this._initElAutoSaveSetting()},_initElAutoSaveSetting:function(){return this._elAutoSaveSetting=b("#jmail-autosave")},__constructor:function(){this._settingLoaded=false;this._readyingDialogCounter=0},initialize:function(){this._initArea();this._initHeader();c.app.hideHeader()},open:function(){this._hideLeft();this._hideRight();this._openDlgReadying();var f=this;var g=arguments;c.comSetting.getNotification(function(){f.__call("open",g)})},_getElOwnItemsLow:function(){return b(".page-mail_edit-item")},_clean:function(){var i=this._getHeader();i.clean();var f=this._getBody();f.clean();var h=this._getSender();h.clean();this._initEdittingValue();this._initValueChanged();var g=this;(function(){if(g._isSettingLoaded()){g._loadNewMessageContent();if(Number(g._getAutoSaveTime())>0){g._setAutoSave(true)}if(g._getAutoSave()){g._autosave()}}else{setTimeout(arguments.callee,100)}})()},_loadNewMessageContent:function(){var k=this._getMailMode(true);if(k){var h={};var f=c.getParameter(a.PARAM_MAIL_ID);h[a.PARAM_MAIL_MODE]=k;h[a.PARAM_MAIL_ID]=f;this._setDataToGetNewMessageContent(h);var l=this._getAjaxGetNewMessageContent();l.sendRequest();this._openDlgReadying();if(c.isIpadiOS6()){var g=d.getOperator();g.setUnread([f],false)}}if(!k){this.applyDefaultSignature();var m=c.getParameter(a.PARAM_TMPNM);if(m&&m!=""){var h={};h[a.PARAM_TMPNM]=m;this._setDataToGetAttList(h);var l=this._getAjaxGetAttList();l.sendRequest();this._openDlgReadying()}else{this._initAttachNeo()}var n=this;if((typeof gObjMailEdit)!="undefined"){if(!!gObjMailEdit.subject||!!gObjMailEdit.body){this._setAutoSaveChk(false)}var i=n._getHeader();i._updateSubject(gObjMailEdit);var j=n._getBody();j.update(gObjMailEdit);this._initValueChanged()}}},applySignature:function(j,i){var g=this;this._setSignMethod(i);var f={id:j};g._setDataToGetSign(f);var h=g._getAjaxGetSign();h.sendRequest()},applyDefaultSignature:function(){var g=this;var f=c.comSetting.getMailSettingData();var h=f.signmethod;if(h!==a.SIGN_METHOD_DONTINSERT){(function(){var i=c.comSetting.getSignatureData();if(i){if(!!i.defaultId){g.applySignature(i.defaultId,h)}}else{setTimeout(arguments.callee,100)}})()}},_insertSignatureText:function(g,i){var k;if(!g){return}var f=this._getBody();if(i==a.SIGN_METHOD_CARET){f.insertAtCaret("\n"+g+"\n")}else{if(i==a.SIGN_METHOD_TOP||i==a.SIGN_METHOD_END){var j="";if(i==a.SIGN_METHOD_TOP){k="\n\n"+g+"\n\n";if(f.getType()==a.BODY_TYPE_HTML){k=desknets.tmpl.escapeWordLF(k)}j+=k}if(f.getType()==a.BODY_TYPE_HTML){if(!!f.getHtml()){j+=f.getHtml()}}else{if(!!f.getText()){j+=f.getText()}}if(i==a.SIGN_METHOD_END){k="\n\n"+g;if(f.getType()==a.BODY_TYPE_HTML){k=desknets.tmpl.escapeWordLF(k)}j+=k}var h={};h[a.PARAM_FLG_HTML]=f.getType();if(f.getType()==a.BODY_TYPE_HTML){h[a.PARAM_BODY_HTML]=j}else{h[a.PARAM_BODY_TEXT]=j}f.update(h)}}},_getMailMode:function(f){var g=c.getParameter(a.PARAM_MAIL_MODE);if(f===true){switch(g){case a.MODE_REPLY:case a.MODE_REPLY_ALL:case a.MODE_FORWARD:case a.MODE_EDIT_AGAIN:case a.MODE_RESTART_EDITTING:break;case a.MODE_WRITE_TO_SENDER:g=a.MODE_REPLY;break;default:g=null}}return g},_parseResponseOfNewMessageContent:function(f){var i=c.parseFlatData(f);var h=b("attach",f);var g=c.parseListElements(h);i.attach=g;return i},setValues:function(g,i){g=this._regulateValues(g,i);var j=this._getHeader();j.update(g,i);var f=this._getBody();f.update(g);this._setAttValues(g);var h=this._getSender();h.update(g,i);this._initValueChanged()},_regulateValues:function(g,h){var f;if(h==a.MODE_WRITE_TO_SENDER){f={to:g.to}}else{f=g}return f},_setAttValues:function(f){this._saveAttFileList(f);this._initAttachNeo();this.closeDlgReadying()},_saveAttFileList:function(f){var l=c.getParameter(a.PARAM_TMPNM);if(!l){l=f[a.PARAM_TMPNM]}var k=f[a.PARAM_ATTACHMENTS];var h=this._getDefAttFileInfo();if(k&&l){h.tmpnm=l;for(var g=0;g<k.length;g++){var j=k[g];h.files.push({fno:j.id,attachdisp:j.attachdisp,size:parseInt(j.size)||0,mimetype:j.mimetype})}var m=this._getElTmpnm();m.val(l);this._setDefAttFileInfo(h)}},_initAttachNeo:function(){var r=this;var f=this._getElAttFileList();var j=this._getDefAttFileInfo();if(j.tmpnm==""){var k=DNNEO.neo.dateTime.parse(b("#jco-servertime").val());var n=DNNEO.neo.dateTime.format("yyyyMMdd",k);var p=n+Math.floor(new Date().getTime()%86400000);var j=this._getDefAttFileInfo();j.tmpnm=p;var m=this._getElTmpnm();m.val(p)}var o="";var i=c.comSetting.getAttLimitSize();var g={};g.cmd="mailattach";g.tmpnm=j.tmpnm;var h={};h.cmd="mailattachdel";h.tmpnm=j.tmpnm;var q=c.getUrl(c.CGI_EMLC);q=q+"?cmd=maildispattache&tmpnm={{tmpnm}}&fno={{id}}";q=q+"&filename={{name}}";var l={tmpnm:j.tmpnm,files:j.files,hideElementOnEmpty:null,uploadURL:c.getUrl(c.CGI_EML),uploadParams:g,delURL:c.getUrl(c.CGI_EML),delParams:h,downloadURL:q,toggleTargetFunc:function(){if(r._getAutoSave()){desknets.autosave.attachsave()}}};if(!isNaN(i)){l.totalSizeLimit=i*1024*1024}f.dnAttachList(l);this.__bind(f,"click","List")},_initOnOpening:function(){if(!this.getId()){this._initId()}this._hideLeft();this._hideRight();this.updateRectSize();var f=this;c.comSetting.getMailSetting(function(){f._setSettingLoaded();f._loadDestination();f.closeDlgReadying()})},updateRectSize:function(){var f=this._getArea();f.updateRectSize()},_loadDestination:function(){var f=c.getParameters();if(a.PARAM_TO in f){this._setAutoSaveChk(false);var g=this._getHeader();g._updateDisinations(f)}},_autosave:function(){var h=this;var j=function(k){h._autosavechk(k)};var i=function(k){return h._autosaveentry(k)};var g=function(l,k){h._autosaveget(l,k)};var f={};f.module="mailimap";f.time=h._getAutoSaveTime();f.userid=h._getAutoAaveId();f.fieldid=a.PARAM_MAIL_ID;f.attachname="mailatt";f.funcchk=j;f.funcentry=i;f.funcget=g;setTimeout(function(){var k=h._getElTmpnm();f.tmpnm=k.val();desknets.autosave.init(f);if(h._getAutoSaveChk()){desknets.autosave.chk()}else{desknets.autosave.del();desknets.autosave.start()}},300)},_getAutoSaveTime:function(){var f=this._getElAutoSaveSetting();if(f.length>0){return f.data("time")}return"0"},_getAutoAaveId:function(){var f=this._getElAutoSaveSetting();if(f.length>0){return f.val()}return""},_autosavechk:function(g){var f=this;if(!!g.id){var i=c.getParameter(a.PARAM_MAIL_ID);var h=c.getParameter(a.PARAM_MAIL_MODE);if(!!i){if(!!h){i=i+"_"+h}if(!!g.sub&&g.sub==i){f._autosavechkdialog();return}}else{if(g.id=="0"){f._autosavechkdialog();return}}desknets.autosave.del()}desknets.autosave.start()},_autosavechkdialog:function(){var g=this;var j={cancel:function(){desknets.autosave.del();desknets.autosave.start()}};var i=desknets.Resource.Message.auto_save_msg;var f=desknets.dialog.confirm(i,function(k){desknets.autosave.get()},j);desknets.submitform.setDialogDisabled(f);var h=setInterval(function(){if(g._readyingDialogCounter<=0){desknets.submitform.clearDialogDisabled(f);clearInterval(h)}},1000)},_autosaveentry:function(g){var f=this;var h=this._getSender();h.readySendingData();g=b.extend(g,h._getDataToSend());var i=c.getParameter(a.PARAM_MAIL_MODE);if(!!i){g.msgid=g.msgid+"_"+i}return g},_autosaveget:function(g,h){var f=this;b.each(h,function(j,k){if(k=="cmdget"){f._autosaveset(g[j])}else{if(k=="cmdgetatt"){var i=f._getElAttFileList();if(!!g[j]&&!!g[j].attach&&!!g[j].attach.item){if(!b.isArray(g[j].attach.item)){g[j].attach.item=[g[j].attach.item]}i.dnAttachList("updateFile",g[j].attach.item)}else{i.dnAttachList("updateFile",{})}}}});this._initEdittingValue();this._initValueChanged()},_autosaveset:function(l){var i=this;var g;var h={};var m=this._getHeader();var j=this._getSender();var f=i._getBody();g=i._getElFrom();g.val(l[a.PARAM_ACCOUNT]);g=i._getElSubject();g.val(l[a.PARAM_SUBJECT]);g=i._getElTo();g.val(l[a.PARAM_TO]);if(!!l[a.PARAM_CC]){m.onclickAddCc();g=i._getElCc();g.val(l[a.PARAM_CC])}if(!!l[a.PARAM_BCC]){m.onclickAddBcc();g=i._getElBcc();g.val(l[a.PARAM_BCC])}h={};h[a.PARAM_FLG_HTML]=l[a.PARAM_BODY_TYPE];if(h[a.PARAM_FLG_HTML]==a.BODY_TYPE_HTML){h[a.PARAM_BODY_HTML]=l[a.PARAM_BODY_HTML];var k=f._getRte();if(!!k){k.setData(l[a.PARAM_BODY_HTML])}}else{h[a.PARAM_BODY_TEXT]=l[a.PARAM_BODY_TEXT]}f.update(h);m.setCharset(l[a.PARAM_CHARSET]);if(l[a.PARAM_PRIORITY]=="1"){i.setHighPriority()}else{if(l[a.PARAM_PRIORITY]=="3"){i.setNormalPriority()}else{if(l[a.PARAM_PRIORITY]=="5"){i.setLowPriority()}}}if(l[a.PARAM_NOTIFICATION]=="2"){i.setNotification()}else{if(l[a.PARAM_NOTIFICATION]=="0"){i.setNoNotification()}}},_loadFrom:function(){var g={};var f=c.getParameter(c.PARAM_SHARE_ACCOUNT_ID);if(f&&f!=""){g[c.PARAM_SHARE_ACCOUNT_ID]=f}var h=c.getParameter(a.PARAM_ACCOUNT);if(h&&h!=""){g[a.PARAM_ACCOUNT]=h}var i=this._getHeader();i._updateFrom(g)},setDestinations:function(g,f,h){var i=this._getHeader();i.setDestinations(g,f,h)},send:function(){var f=this._getSender();f.initSaveFlg();f.exec()},_getDataToSend:function(){var g=this._getHeader();var f=b.extend({},g.getDataToSend(),undefined);return f},draft:function(){var f=this._getSender();f.initSaveFlg();f.draft()},print:function(){var g=c.getUrl(c.CGI_EML);var j=b("<form></form>",{action:g,target:"printedit",method:"POST"}).hide();var f=b("body");f.append(j);var h=this._getSender();var l=h.readySendingData();b.each(l,function(m,n){j.append(b("<input>",{type:"hidden",name:m,value:n}))});j.append(b("<input>",{type:"hidden",name:"cmd",value:"mailprintedit"}));var k="";if(!c.isAndroid()){k="menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=yes,height=600,width=650"}var i=window.open("about:blank","printedit",k);j.submit()},setHighPriority:function(){var f=this._getHeader();f.setHighPriority()},setNormalPriority:function(){var f=this._getHeader();f.setNormalPriority()},setLowPriority:function(){var f=this._getHeader();f.setLowPriority()},switchPriority:function(){var f=this._getHeader();f.switchPriority()},setNotification:function(){var f=this._getHeader();f.setNotification()},setNoNotification:function(){var f=this._getHeader();f.setNoNotification()},switchNotification:function(){var f=this._getHeader();f.switchNotification()},setCharset:function(){var f=this._getHeader();f.openDlgSetCharset()},translate:function(){var f=this._getBody();f.translate()},close:function(f,g,i){this._setClosing();if(f&&c.parent&&!c.isIpadiOS6()){c.parent.app.updateMailListAfterSending(g,i)}window.close();if(c.isIpadiOS8()){if(f){var j;var h=this._getSender();if(h._isDraft()||h._isTemplate()){j=c.getText("メールを保存しました。")}else{j=c.getText("メールを送信しました。")}j=j+"\n"+c.getText("自動的にタブが閉じない場合は、手動でタブを閉じてください。");c.notifyAndOverlay(j)}return}},getCharset:function(){var f=this._getHeader();return f.getCharset()},getPriority:function(){var f=this._getHeader();return f.getPriority()},getNotification:function(){var f=this._getHeader();return f.getNotification()},getBodyType:function(){var f=this._getBody();return f.getType()},getTextBody:function(){var f=this._getBody();return f.getText()},getHtmlBody:function(){var f=this._getBody();return f.getHtml()},_cleanUploading:function(){},_openDlgReadying:function(){if(this._readyingDialogCounter<1){var f=c.getText("準備中...");var g=c.prevent(f);this._setDlgReadying(g);this._readyingDialogCounter=1}else{this._readyingDialogCounter++}},closeDlgReadying:function(){if(this._readyingDialogCounter<2){var f=this._getDlgReadying(f);f.close();this._readyingDialogCounter=0}else{this._readyingDialogCounter--}},isEditting:function(){if(DENBUN_MODE_XNEO){var h=b("#mail-edit-attach-list").hasClass("jco-files-modify");var f=this._getBody();var i=f.isDirtyRte();var g=(!this._isClosing()&&(this._isEdittingValue()||this._isValueChanged()||h==true||i==true));if(g){if(this._getAutoSave()){desknets.autosave.save()}}return g}else{return(!this._isClosing()&&(this._isEdittingValue()||this._isValueChanged()||this.getBodyType()==a.BODY_TYPE_HTML))}},isEdittingAutoSave:function(){return this._getAutoSave()},onresize:function(g){var f=this._getArea();f.onresize(g)},onsuccessGetNewMessageContent:function(g,f,h){var i=this._parseResponseOfNewMessageContent(g);var j=this._getMailMode();this.setValues(i,j);if(j==a.MODE_WRITE_TO_SENDER){this.applyDefaultSignature()}},onerrorGetNewMessageContent:function(){this._initAttachNeo();this.closeDlgReadying()},onsuccessGetAttList:function(g,f,h){var i=this._parseResponseOfNewMessageContent(g);this._setAttValues(i)},onclickList:function(h,i){var g=b(h.target);var f=g.attr("href");if(!f){return}var j=neo.core.splitParam(f);if(d.isMailFileParams(j)){d.openViewOfMailFileFrom(j);h.preventDefault()}},onsuccessGetSign:function(g,f,h){var j=c.parseFlatData(g);var i=this._getSignMethod();this._insertSignatureText(j.sign,i)},__closure:c.__closure,__bind:c.__bind,banpei:null}});a.constructor()})(jQuery);(function(b){var e=neo.core.readyNamespace("neo.denbun.Mail.EditPage.Area");if(!e){return}var c=neo.denbun;var d=c.Mail;var a=neo.denbun.Mail.EditPage.Area=new neo.core.Class({classProperties:{_instance:null,getInstance:function(){return this._instance},_setInstance:function(f){return this._instance=f},constructor:function(){},initialize:function(){var f=new a();f.initialize();this._setInstance(f)},banpei:null},properties:{_initialized:null,_isInitialized:function(){return this._initialized},_setInitialized:function(f){return this._initialized=f},_elFooterSection:null,_getElFooterSection:function(){return this._elFooterSection||this._initElFooterSection()},_initElFooterSection:function(){return this._elFooterSection=b("#mail-edit-footer-section")},_getPage:function(){return this.setting.page},_getBody:function(){return this.setting.body},__constructor:function(f){if(a.getInstance()){var g="Dupulicated.";throw new Error("neo.denbun.Mail.EditPage.Area.__constructor : "+g)}this._initialized=false;this.setting=f},initialize:function(){if(this._isInitialized()){return}this._setInitialized(true)},updateRectSize:function(){var i=c.getClientSize();var g=this._getElFooterSection();var h=g.outerHeight();var f=this._getBody();f.updateSize(i,h)},onresize:function(f){this.updateRectSize()},__closure:c.__closure,__bind:c.__bind,banpei:null}});a.constructor()})(jQuery);(function(b){var e=neo.core.readyNamespace("neo.denbun.Mail.EditPage.Header");if(!e){return}var c=neo.denbun;var a=c.Mail.EditPage;var d=neo.denbun.Mail.EditPage.Header=new neo.core.Class({classProperties:{ID_DESTINATION_CONDIDATE_LIST:"mail-list-destination-condidate-list",CLS_PRIORITY_HIGH:"mail-edit-priority-high",CLS_PRIORITY_LOW:"mail-edit-priority-low",CLS_NOTIFICATION_USE:"mail-edit-notification-use",CLS_CHARSET_ITEM:"mail-edit-charset-item",CLS_CHARSET_VAL:"mail-edit-charset-value",CLS_CHARSET_ITEM_SELECTED:"mail-edit-charset-item-selected",CLS_CHARSET_NAME:"mail-edit-charset-name",CLS_DESTINATION_CONDIDATE_ITEM:"mail-list-destination-condidate-item",CLS_EDIT_ADDRESS_ROW:"mail-edit-address-row",PRIORITY_HIGH:1,PRIORITY_LITTLE_HIGH:2,PRIORITY_NORMAL:3,PRIORITY_LITTLE_LOW:4,PRIORITY_LOW:5,NOTIFICATION_ON:2,NOTIFICATION_OFF:0,DATA_DESTINATION_TYPE:"data-destination-type",constructor:function(){}},properties:{_values:null,_getValues:function(){return this._values},_setValues:function(f){return this._values=f},_draftMode:null,_isDraftMode:function(){return this._draftMode||this._initDraftMode()},_initDraftMode:function(){return this._draftMode=false},_updateDraftMode:function(f){return this._draftMode=(f==a.MODE_RESTART_EDITTING)},_defaultSignatureId:null,_getDefaultSignatureId:function(){return this._defaultSignatureId},_setDefaultSignatureId:function(f){return this._defaultSignatureId=f},_tmObserveDestination:null,_getTmObserveDestination:function(){return this._tmObserveDestination},_setTmObserveDestination:function(f){clearInterval(this._tmObserveDestination);return this._tmObserveDestination=f},_curDestinationElement:null,_getCurDestinationElement:function(){return this._curDestinationElement},_setCurDestinationElement:function(f){return this._curDestinationElement=f},_lastDestinationValue:null,_getLastDestinationValue:function(){return this._lastDestinationValue},_setLastDestinationValue:function(f){return this._lastDestinationValue=f},_destinationLastModified:null,_getDestinationLastModified:function(){return this._destinationLastModified},_initDestinationLastModified:function(){return this._destinationLastModified=null},_setDestinationLastModified:function(){return this._destinationLastModified=new Date},_allAddressListData:null,_getAllAddressListData:function(){return this._allAddressListData},_initAllAddressListData:function(){var f=this;c.comSetting.getAllAddressList(function(g){f._allAddressListData=g})},_dlgSetCharset:null,_getDlgSetCharset:function(){return this._dlgSetCharset||this._initDlgSetCharset()},_initDlgSetCharset:function(){var g={buttons:{},content:b("#dlg-set_charset"),title:c.getText("言語")};g.buttons[c.getText("閉じる")]=function(){this.close()};if(DENBUN_MODE_XNEO){g.onopen=this.__closure(this._updateDlgCharset)}var f=new c.Dialog(g);f.initialize();return this._dlgSetCharset=f},_elSwitchPriority:null,_getElSwitchPriority:function(){return this._elSwitchPriority||this._initElSwitchPriority()},_initElSwitchPriority:function(){var g=this._getPage();var f=g.getElToolbarItemOf("switch_priority");return this._elSwitchPriority=f},_elSwitchNotification:null,_getElSwitchNotification:function(){return this._elSwitchNotification||this._initElSwitchNotification()},_initElSwitchNotification:function(){var g=this._getPage();var f=g.getElToolbarItemOf("switch_notification");return this._elSwitchNotification=f},_elSelectedCharsetVal:null,_getElSelectedCharsetVal:function(){return this._elSelectedCharsetVal},_setElSelectedCharsetVal:function(f){return this._elSelectedCharsetVal=f},_elSelectInAddressBook:null,_getElSelectInAddressBook:function(){return this._elSelectInAddressBook||this._initElSelectInAddressBook()},_initElSelectInAddressBook:function(){return this._elSelectInAddressBook=b(".mail-edit-open_address_book")},_elAddCc:null,_getElAddCc:function(){return this._elAddCc||this._initElAddCc()},_initElAddCc:function(){return this._elAddCc=b("#mail-edit-add_cc")},_elAddBcc:null,_getElAddBcc:function(){return this._elAddBcc||this._initElAddBcc()},_initElAddBcc:function(){return this._elAddBcc=b("#mail-edit-add_bcc")},_elCcRow:null,_getElCcRow:function(){return this._elCcRow||this._initElCcRow()},_initElCcRow:function(){return this._elCcRow=b("#mail-edit-cc-row")},_elBccRow:null,_getElBccRow:function(){return this._elBccRow||this._initElBccRow()},_initElBccRow:function(){return this._elBccRow=b("#mail-edit-bcc-row")},_elCharsetVal:null,_getElCharsetVal:function(){return this._elCharsetVal||this._initElCharsetVal()},_initElCharsetVal:function(){return this._elCharsetVal=b("."+d.CLS_CHARSET_VAL)},_elDestination:null,_getElDestination:function(){return this._elDestination||this._initElDestination()},_initElDestination:function(f){return this._elDestination=b(".mail-edit-destination")},_elDestinationCandidateList:null,_getElDestinationCandidateList:function(){return this._elDestinationCandidateList||this._initElDestinationCandidateList()},_initElDestinationCandidateList:function(){var f=b("#"+d.ID_DESTINATION_CONDIDATE_LIST);return this._elDestinationCandidateList=f},_getElDestinationCandidateItem:function(){var f=b("#"+d.ID_DESTINATION_CONDIDATE_LIST+" ."+d.CLS_DESTINATION_CONDIDATE_ITEM);return f},setting:null,_getPage:function(){return this.setting.page},_getElCharsetList:function(){return this.setting.elCharsetList},_getElFrom:function(){return this.setting.elFrom},_getElTo:function(){return this.setting.elTo},_getElCc:function(){return this.setting.elCc},_getElBcc:function(){return this.setting.elBcc},_getElSubject:function(){return this.setting.elSubject},_getElSignatureList:function(){return this.setting.elSignatureList},_dataToGetDestinationCandidateList:null,_getDataToGetDestinationCandidateList:function(){return this._dataToGetDestinationCandidateList},_setDataToGetDestinationCandidateList:function(f){return this._dataToGetDestinationCandidateList=f},_ajaxGetDestinationCandidateList:null,_getAjaxGetDestinationCandidateList:function(){return this._ajaxGetDestinationCandidateList||this._initAjaxGetDestinationCandidateList()},_initAjaxGetDestinationCandidateList:function(){var f=this;var g={getSendData:function(){var i=f._getDataToGetDestinationCandidateList();i.cmd="addrsrchmaillist";return i},onsuccess:this.__closure(this.onsuccessGetDestinationCandidateList)};if(DENBUN_MODE_XNEO){g.url=c.getUrl(c.CGI_WMAIL_EML)}var h=new c.Ajax(g);h.initialize();return this._ajaxGetDestinationCandidateList=h},__constructor:function(f){this.setting=f},initialize:function(){this._loadCharset();this._loadFrom();this._loadSignatures();this._loadAttExt();if(!DENBUN_MODE_XNEO){this._initAllAddressListData()}this._hook()},_loadCharset:function(){if(DENBUN_MODE_XNEO){this._buildCharsetList(null)}else{var f=this;c.comSetting.getCharset(function(g){f._buildCharsetList(g)})}},_loadFrom:function(){var f=this;if(DENBUN_MODE_XNEO){c.comSetting.getAccount(function(i){var h=c.comSetting.getAccountUserName();var g=c.comSetting.getAccountMail();f._buildFrom(h,g)})}else{c.comSetting.getPSetUser(function(i){var h=c.comSetting.getUserName();var g=c.comSetting.getUserMail();f._buildFrom(h,g)})}},_loadSignatures:function(){var f=this;c.comSetting.getSignature(function(g){f._buildSignatureList(g)})},_loadAttExt:function(){c.comSetting.getAttExtList(function(g){var f={list:{item:g}};desknets.attach.ext.saveList(f)})},_hook:function(){var g;var f=this;g=this._getElCharsetVal();this.__bind(g,"click","SelectCharset");g=this._getElFrom();this.__bind(g,"focus","Value");this.__bind(g,"blur","Value");this.__bind(g,"change","Value");if(DENBUN_MODE_XNEO){c.comSetting.getDirectoryServiceList(function(){var i=c.comSetting.hasDirectoryService();var h=f._getElSelectInAddressBook();if(!i&&!c.comSetting.isAvailableAddress()&&!c.comSetting.isAvailableUserList()){h.removeClass("link").removeAttr("title")}else{f.__bind(h,"click","SelectInAddressBook");h.live("click",f.__closure(f.onchangeValue))}})}else{g=this._getElSelectInAddressBook();this.__bind(g,"click","SelectInAddressBook");g.live("click",this.__closure(this.onchangeValue))}g=this._getElDestination();if(!DENBUN_MODE_XNEO||c.comSetting.isAvailableAddress()||c.comSetting.isAvailableUserList()){neo.jq.bindListener(g,"focus","Destination",this);neo.jq.bindListener(g,"blur","Destination",this)}this.__bind(g,"focus","Value");this.__bind(g,"blur","Value");this.__bind(g,"change","Value");g=this._getElAddCc();this.__bind(g,"click","AddCc");this.__bind(g,"focus","Value");this.__bind(g,"blur","Value");this.__bind(g,"change","Value");g=this._getElAddBcc();this.__bind(g,"click","AddBcc");this.__bind(g,"focus","Value");this.__bind(g,"blur","Value");this.__bind(g,"change","Value");g=this._getElSubject();this.__bind(g,"focus","Value");this.__bind(g,"blur","Value");this.__bind(g,"change","Value");g=this._getElSignatureList();this.__bind(g,"focus","Value");this.__bind(g,"blur","Value");this.__bind(g,"change","SignatureValue");if(!DENBUN_MODE_XNEO||c.comSetting.isAvailableAddress()){g=this._getElDestinationCandidateList();g.delegate("."+d.CLS_DESTINATION_CONDIDATE_ITEM,"mousedown",this.__closure(this.onmousedownDestinationCondidate))}},clean:function(){this._initDraftMode();var j=this._getElTo();j.val("");var i=this._getElCc();i.val("");var k=this._getElBcc();k.val("");this._hideCcAndBccRow();var h=this._getElSubject();h.val("");var g=this._getElSignatureList();var f=this._getDefaultSignatureId();g.val(f);this._selectFirstCharset();this.setNormalPriority();if(this._getDefaultFlgUseNotification()){this.setNotification()}else{this.setNoNotification()}this._setValues(null)},_buildCharsetList:function(l){if(DENBUN_MODE_XNEO){var m=this._getElCharsetList();var h=c.getText("encoding").split(",");var n=h.length;for(var k=n-1;k>=0;k--){var f=m.find("input[value="+h[k]+"]").closest("li");if(f.length>0){m.prepend(f)}}}else{var m=this._getElCharsetList();var g=m.find("."+d.CLS_CHARSET_ITEM+"."+c.CLS_TEMPLATE+"").remove();for(var k=0;k<l.length;k++){var j=l[k];var p=g.clone().removeClass(c.CLS_TEMPLATE);p.find("[type=radio]").val(j.id);p.find("."+d.CLS_CHARSET_NAME).text(j.Name);m.append(p)}this._initElCharsetVal()}var o=this._getValues();var j=neo.core.get(o,a.PARAM_CHARSET);if(j){this.setCharset(j)}else{this._selectFirstCharset()}},_buildFrom:function(g,f){var h=this._getElFrom();var i=g+" <"+f+">";i=neo.core.escape(i);if(DENBUN_MODE_XNEO){i=desknets.escapeSpace(i)}else{i=c.escapeSpace(i)}h.html(i)},setCharset:function(g){if(g){var f=this._getElCharsetVal().filter('[value="'+g+'"]');f.attr("checked",true);this._selectCharset(f);this._setValueChanged()}},_selectCharset:function(f){if(f.length<1){return}var h=this._getElSelectedCharsetVal();if(h){h.removeClass(d.CLS_CHARSET_ITEM_SELECTED)}var g=f.closest("."+d.CLS_CHARSET_ITEM);g.addClass(d.CLS_CHARSET_ITEM_SELECTED);this._setElSelectedCharsetVal(g)},_selectFirstCharset:function(){var f=this._getElCharsetList();var g=f.find("."+d.CLS_CHARSET_VAL+":first");if(g.closest("."+c.CLS_TEMPLATE).length<1){g.attr("checked",true);this._selectCharset(g)}},_buildSignatureList:function(l){var m;var h=this._getElSignatureList();var k=h.children("."+c.CLS_TEMPLATE).remove();for(var j=0;j<l.list.length;j++){var f=l.list[j];var g=k.clone().removeClass(c.CLS_TEMPLATE);g.val(f.id);m=neo.core.escape(f.Name);if(DENBUN_MODE_XNEO){m=desknets.escapeSpace(m)}else{m=c.escapeSpace(m)}g.html(m);h.append(g)}if(h.find("option[value="+l.defaultId+"]").length==0){l.defaultId=""}},update:function(f,g){this._updateDraftMode(g);this._updatePriority(f);this._updateNotification(f);this._updateCharset(f);this._updateDisinations(f);this._updateSubject(f);this._setValues(f)},_updatePriority:function(f){var g=parseInt(f[a.PARAM_PRIORITY]);this._setPriority(g)},_updateNotification:function(f){var g=parseInt(f[a.PARAM_NOTIFICATION]);this._setNotificationValue(g)},_updateCharset:function(f){var g=f[a.PARAM_CHARSET];this.setCharset(g)},_updateDisinations:function(f){var i=f[a.PARAM_TO];this._setToToLow(i);var h=f[a.PARAM_CC];this._setToCcLow(h);if(h){this._showCcRow()}var g=f[a.PARAM_BCC];this._setToBccLow(g);if(g){this._showBccRow()}},setDistinations:function(g,f,h){this._setToTo(g);this._setToCc(f);this._setToBcc(h)},_setToTo:function(j){var h=[];for(var f in j){var g=j[f];var i=c.getDistinationText(g,f);h.push(i)}var i=h.join(", ");this._setToToLow(i)},_setToToLow:function(f){var g=this._getElTo();if(c.isSendGroupFormat(f)){var h=function(i){var j=c.getMailAddressForToMailInputItem(i);g.val(j)};c.getMailAddressByAddressSendGroup(f,h)}else{g.val(f)}},_setToCc:function(j){var h=[];for(var f in j){var g=j[f];var i=c.getDistinationText(g,f);h.push(i)}if(h.length>0){this._showCcRow()}var i=h.join(", ");this._setToCcLow(i)},_setToCcLow:function(f){var g=this._getElCc();g.val(f)},_setToBcc:function(j){var h=[];for(var f in j){var g=j[f];var i=c.getDistinationText(g,f);h.push(i)}if(h.length>0){this._showBccRow()}var i=h.join(", ");this._setToBccLow(i)},_setToBccLow:function(f){var g=this._getElBcc();g.val(f)},_updateSubject:function(g){var h=g[a.PARAM_SUBJECT];var f=this._getElSubject();f.val(h)},openDlgSetCharset:function(){if(c.isIe7()){var g=this._getElCharsetList();var f=g.find(":checked")}var h=this._getDlgSetCharset();h.open();if(c.isIe7()){f.attr("checked",true)}},_updateDlgCharset:function(l){var j=0;var m=this._getElCharsetList();var h=m[0].clientHeight;m.scrollTop(0);var g=m.find(":checked").closest("li");var i=c.getRect(g,false);var f=i.top-m.position().top;var k=f+i.height;if(k>h){j=k-h;m.scrollTop(j)}},_showCcRow:function(){var f=this._getElCcRow();f.show();var g=this._getElAddCc();g.hide();var h=this._getPage();h.updateRectSize()},_showBccRow:function(){var f=this._getElBccRow();f.show();var g=this._getElAddBcc();g.hide();var h=this._getPage();h.updateRectSize()},_hideCcAndBccRow:function(){var f=this._getElCcRow();f.hide();var f=this._getElBccRow();f.hide();var g=this._getElAddCc();g.show();var i=this._getElAddBcc();i.show();var h=this._getPage();h.updateRectSize()},_setPriority:function(f){switch(f){case d.PRIORITY_HIGH:case d.PRIORITY_LITTLE_HIGH:this.setHighPriority();break;case d.PRIORITY_LOW:case d.PRIORITY_LITTLE_LOW:this.setLowPriority();break;default:this.setNormalPriority()}},setHighPriority:function(){var f=this._getElSwitchPriority();f.removeClass(d.CLS_PRIORITY_LOW).addClass(d.CLS_PRIORITY_HIGH);this._setValueChanged()},setNormalPriority:function(){var f=this._getElSwitchPriority();if(f){f.removeClass(d.CLS_PRIORITY_HIGH).removeClass(d.CLS_PRIORITY_LOW)}this._setValueChanged()},setLowPriority:function(){var f=this._getElSwitchPriority();f.removeClass(d.CLS_PRIORITY_HIGH).addClass(d.CLS_PRIORITY_LOW);this._setValueChanged()},switchPriority:function(){var f=this._getElSwitchPriority();if(f.hasClass(d.CLS_PRIORITY_HIGH)){this.setLowPriority()}else{if(f.hasClass(d.CLS_PRIORITY_LOW)){this.setNormalPriority()}else{this.setHighPriority()}}},_setNotificationValue:function(f){switch(f){case d.NOTIFICATION_ON:this.setNotification();break;default:this.setNoNotification()}},setNotification:function(){var f=this;(function(){var g=f._getElSwitchNotification();if(g){g.addClass(d.CLS_NOTIFICATION_USE);f._setValueChanged()}else{f._initElSwitchNotification();setTimeout(arguments.callee,100)}})()},setNoNotification:function(){var f=this._getElSwitchNotification();if(f){f.removeClass(d.CLS_NOTIFICATION_USE)}this._setValueChanged()},switchNotification:function(){var f=this._getElSwitchNotification();if(f.hasClass(d.CLS_NOTIFICATION_USE)){this.setNoNotification()}else{this.setNotification()}},getCharset:function(){var h=this._getElCharsetVal();var f=h.filter(":checked");var g=f.val();return g},getPriority:function(){var g;var f=this._getElSwitchPriority();if(f.hasClass(d.CLS_PRIORITY_HIGH)){g=d.PRIORITY_HIGH}else{if(f.hasClass(d.CLS_PRIORITY_LOW)){g=d.PRIORITY_LOW}else{g=d.PRIORITY_NORMAL}}return g},getNotification:function(){var g;var f=this._getElSwitchNotification();if(f.hasClass(d.CLS_NOTIFICATION_USE)){g=d.NOTIFICATION_ON}else{g=d.NOTIFICATION_OFF}return g},_openAddressSelectPage:function(f){var g=this._getParametersToOpenAddressSelectPage(f);if(DENBUN_MODE_XNEO){if(c.comSetting.isAvailableAddress()){c.openPage(c.PAGE_ADDRESS_LIST,g)}else{if(c.comSetting.isAvailableUserList()){c.openPage(c.PAGE_ADDRESS_USERS_LIST,g)}else{c.openPage(c.PAGE_ADDRESS_DIRECTORY_LIST,g)}}}else{c.openPage(c.PAGE_ADDRESS_LIST,g)}},_getParametersToOpenAddressSelectPage:function(f){var i={};i.mode="selector";i[c.PARAM_METHOD]=c.METHOD_POST;var h=this._getElTo();i.to=h.val();var g=this._getElCc();i.cc=g.val();var j=this._getElBcc();i.bcc=j.val();i.targetList=f;return i},_startObservingDestination:function(i){var j=500;this._setLastDestinationValue("");var h=this._getSelectedDestinationValue();if(h){this._setLastDestinationValue(h);this._setSelectedDestinationValue(null)}this._setCurDestinationElement(i);var g=this;var f=setInterval(function(){g._checkDestinationInput(i)},j);this._setTmObserveDestination(f)},_stopObservingDestination:function(g){this._setCurDestinationElement(null);this._setTmObserveDestination(null);var f=this._getElDestinationCandidateList();f.hide()},_checkDestinationInput:function(f){var i=0;var n=f.val();var g=n.lastIndexOf(",");if(g>=0){if(n.charAt(g+1)==" "){g+=1}n=n.substr(g+1)}var m=this._getLastDestinationValue();if(n!=m){this._setLastDestinationValue(n);this._setDestinationLastModified()}else{if(this._getDestinationLastModified()&&new Date()-this._getDestinationLastModified()>i){this._initDestinationLastModified();if(DENBUN_MODE_XNEO){if(!n){var j=this._getElDestinationCandidateList();this._updateDestinationCandidates(n,j,[]);this._updateDestinationCandidatesPos(j,f);return}var h={};h.key=n;this._setDataToGetDestinationCandidateList(h);var l=this._getAjaxGetDestinationCandidateList();l.sendRequest()}else{var k=this._getDestinationCandidateList(n);var j=this._getElDestinationCandidateList();this._updateDestinationCandidates(n,j,k);this._updateDestinationCandidatesPos(j,f)}}}},_getDestinationCandidateList:function(l){var h=30;var k=[];if(!l){return k}var j=this._getAllAddressListData()||[];for(var g=-1,f;f=j[++g];){if(f.Mail.indexOf(l)==0||f.Name.indexOf(l)==0){k.push(f);if(k.length>=h){break}}}return k},_updateDestinationCandidates:function(n,l,m){var g=[];for(var h=-1,o;o=m[++h];){var f=o.Name;var j=o.Mail;var k;if(f.indexOf(n)==0){f="<strong>"+neo.core.escape(f.slice(0,n.length))+"</strong>"+neo.core.escape(f.slice(n.length))}else{f=neo.core.escape(f)}if(j.indexOf(n)==0){j="<strong>"+neo.core.escape(j.slice(0,n.length))+"</strong>"+neo.core.escape(j.slice(n.length))}else{j=neo.core.escape(j)}k='<li class="'+d.CLS_DESTINATION_CONDIDATE_ITEM+'">"'+f+'"&lt;'+j+"&gt;";g.push(k)}l.html(g.join(""))},_updateDestinationCandidatesPos:function(f,g){if(f.children().length>0){var h=c.getRect(g,true);var i={left:h.left,top:h.top+h.height};f.css(i);c.app.setKeyboardOperableTarget(this);this._updateCurItem(null);f.show()}else{f.hide()}},_selectDestinationCondidate:function(i){var j=i.text();var h=this._getCurDestinationElement();h.blur();var g=h.val();var f=g.lastIndexOf(",");if(f>=0){g=g.substring(0,f);j=g+", "+j}h.val(j)},getElKeyboardContainer:function(){var f=this._getElDestinationCandidateList();return f},_elCurItem:null,_getElCurItem:function(){return this._elCurItem},_setElCurItem:function(f){return this._elCurItem=f},_updateCurItem:function(g){var f="popup_menu-item-current";var h=this._getElCurItem();if(h){h.removeClass(f)}this._setElCurItem(g);if(g){g.addClass(f)}},moveToPrev:function(){var f=this._getElCurItem();if(f){var g=f.prevAll(":visible:first");if(g.length<1){this._updateCurItem(null);g=null}}else{var h=this._getElDestinationCandidateList();g=h.children(":visible:last")}this._updateCurItem(g)},moveToNext:function(){var g=this._getElCurItem();var f;if(g){f=g.nextAll(":visible:first");if(f.length<1){this._updateCurItem(null);f=null}}else{var h=this._getElDestinationCandidateList();f=h.children(":visible:first")}this._updateCurItem(f)},onenterkey:function(){var f=this._getElCurItem();if(f){this.onmousedownDestinationCondidate(null,f)}},_selectedDestinationValue:null,_getSelectedDestinationValue:function(){return this._selectedDestinationValue},_setSelectedDestinationValue:function(f){return this._selectedDestinationValue=f},_setEdittingValue:function(g){var f=this._getPage();f.setEdittingValue(g)},_setValueChanged:function(){var f=this._getPage();f.setValueChanged()},_getElAddressRowFrom:function(f){var g=f.closest("."+d.CLS_EDIT_ADDRESS_ROW);return g},_getDestinationTypeFrom:function(g){var h=this._getElAddressRowFrom(g);var f=h.attr(d.DATA_DESTINATION_TYPE);return f},_getDefaultFlgUseNotification:function(){var f=c.comSetting.getFlgUseNotification();return f},onfocusValue:function(f,g){this._setEdittingValue(true)},onblurValue:function(f,g){this._setEdittingValue(false)},onchangeValue:function(f,g){this._setValueChanged()},onclickSelectCharset:function(g,h){var f=b(h);this._selectCharset(f);this._setValueChanged()},onclickSelectInAddressBook:function(g,h){var i=b(g.target);var f=this._getDestinationTypeFrom(i);this._openAddressSelectPage(f)},onfocusDestination:function(g){var f=b(arguments[arguments.length-1]);this._startObservingDestination(f)},onblurDestination:function(f){c.app.setKeyboardOperableTarget(null);this._stopObservingDestination()},onclickAddCc:function(f,g){this._showCcRow()},onclickAddBcc:function(f,g){this._showBccRow()},onmousedownDestinationCondidate:function(h,i){var g=this._getCurDestinationElement();this._selectDestinationCondidate(b(i));if(g){var f=this;setTimeout(function(){if(DENBUN_MODE_XNEO){var k=b(i).text();f._setSelectedDestinationValue(k);if(b.browser.msie){g[0].focus()}else{g.focus()}}else{g.focus()}if(b.browser.msie){var j=g[0].createTextRange();j.move("character",g.val().length);j.select()}},1)}},onsuccessGetDestinationCandidateList:function(g,j,n){var m=c.getAjaxSendParams(j);var l=m.key;var h=b("list",g);var i=c.parseListElements(h);var f=this._getCurDestinationElement();var k=this._getElDestinationCandidateList();this._updateDestinationCandidates(l,k,i);this._updateDestinationCandidatesPos(k,f)},onchangeSignatureValue:function(f,h){var g=this._getPage();var i=this._getElSignatureList().val();if(!i){return}g.applySignature(i,a.SIGN_METHOD_CARET);this._setValueChanged()},runMethod:c.App.Keyboard.runCandidateListMethod,onkeydownKeyboardContainer:c.App.Keyboard.onkeydown,__closure:c.__closure,__bind:c.__bind,banpei:null}});d.constructor()})(jQuery);(function(b){var e=neo.core.readyNamespace("neo.denbun.Mail.EditPage.Body");if(!e){return}var d=neo.denbun;var a=d.Mail.EditPage;var c=neo.denbun.Mail.EditPage.Body=new neo.core.Class({classProperties:{constructor:function(){}},properties:{_rte:null,_getRte:function(){return this._rte},_initRte:function(){var f=CKEDITOR.instances["mail-edit-body-html"];return this._rte=f},_elSwitchToHtml:null,_getElSwitchToHtml:function(){return this._elSwitchToHtml||this._initElSwitchToHtml()},_initElSwitchToHtml:function(){return this._elSwitchToHtml=b("#mail-edit-switch_to_html")},_elSwitchToText:null,_getElSwitchToText:function(){return this._elSwitchToText||this._initElSwitchToText()},_initElSwitchToText:function(){return this._elSwitchToText=b("#mail-edit-switch_to_text")},_elBodySection:null,_getElBodySection:function(){return this._elBodySection||this._initElBodySection()},_initElBodySection:function(){return this._elBodySection=b("#mail-edit-body-section")},_elText:null,_getElText:function(){return this._elText||this._initElText()},_initElText:function(){var f=b("#mail-edit-body-text");if(b.browser.msie&&b.browser.version==8){f.attr("cols",9999)}return this._elText=f},_elHtml:null,_getElHtml:function(){return this._elHtml||this._initElHtml()},_initElHtml:function(){return this._elHtml=b("#mail-edit-body-html")},setting:null,_getPage:function(){return this.setting.page},__constructor:function(f){this.setting=f},initialize:function(){this._hook()},_hook:function(){var f;if(this._isAllowedHtml()){f=this._getElSwitchToHtml();this.__bind(f,"click","SwitchToHtml");f=this._getElSwitchToText();this.__bind(f,"click","SwitchToText")}else{f=this._getElSwitchToHtml();f.addClass(d.CLS_DISABLED)}f=this._getElText();this.__bind(f,"focus","Value");this.__bind(f,"blur","Value");this.__bind(f,"change","Value")},clean:function(){this._switchToTextLow();var g=this._getElText();g.val("");var f=this._getRte();if(f){f.setData("")}},update:function(f){var g=f[a.PARAM_FLG_HTML];if(g==a.BODY_TYPE_HTML){if(this._isAllowedHtml()){this._updateAsHtml(f)}else{this._updateAsConvertedText(f)}}else{this._updateAsText(f)}},_updateAsHtml:function(g){var h=g[a.PARAM_BODY_HTML];var f=this._getElHtml();if(d.isMsie()&&!d.isMsie7()&&!d.isMsie8()){h=h.replace(/<div\/>/g,"<div>&nbsp;</div>")}else{h=h.replace(/<div>&nbsp;<\/div>/g,"<div></div>")}f.val(h);this._switchToHtml()},_updateAsConvertedText:function(f){var g=f[a.PARAM_BODY_HTML];var i=neo.Rte.htmlToText(g);var h=this._getElText();h.val(i);this._switchToTextLow()},_updateAsText:function(f){var h=f[a.PARAM_BODY_TEXT];var g=this._getElText();g.val(h);this._switchToTextLow()},_switchToHtml:function(){this._switchStyleToHtml();this._showRte()},_switchStyleToHtml:function(){var f=this._getElSwitchToHtml();f.hide();var i=this._getElSwitchToText();i.show();var g=this._getElText();g.hide();var h=this._getElBodySection();h.css({visibility:"hidden"})},_moveTextToHtml:function(){var i=this._getElText();var j=i.val();var g=neo.Rte.textToHtml(j);if(d.isMsie()&&!d.isMsie7()&&!d.isMsie8()){g=g.replace(/<div><\/div>/g,"<div>&nbsp;</div>")}var f=this._getElHtml();f.val(g);var h=this._getRte();if(h){var f=this._getElHtml();h.setData(f.val())}},_showRte:function(){d.app.initRte();var f=this;(function(){var g=f._getRte();if(g&&g.container){var h=f._getElBodySection();h.css({visibility:"visible"});g.container.show();d.$window.trigger("resize")}else{f._initRte();setTimeout(arguments.callee,100)}})();if(DENBUN_MODE_XNEO){}else{this._setValueChanged()}},_switchToText:function(){var g=d.getText("テキスト形式に変更すると現在の書式がすべて失われます。よろしいですか？");var h=this.__closure(this._switchToTextLow);d.confirm(g,{onok:h})},_switchToTextLow:function(){this._switchStyleToText();this._hideRte();this._setValueChanged()},_switchStyleToText:function(){var f=this._getElSwitchToHtml();f.show();var h=this._getElSwitchToText();h.hide();var g=this._getElText();g.show()},_moveHtmlToText:function(){var h=this._getRte();var f=h.getData();var i=neo.Rte.htmlToText(f);var g=this._getElText();g.val(i)},_hideRte:function(){var f=this._getRte();if(f){f.container.hide()}},insertAtCaret:function(l){if(this.getType()==a.BODY_TYPE_HTML){var g=desknets.tmpl.escapeWordLF(l);var h=this._getRte();h.insertHtml(g)}else{var i=this._getElText().get(0);i.focus();if(d.isMsie()&&i.selectionStart===undefined){var f=document.selection.createRange();f.text=l;f.select()}else{var k=i.value;var m=i.selectionStart;var j=m+l.length;i.value=k.substr(0,m)+l+k.substr(m);i.setSelectionRange(j,j)}}},updateSize:function(k,i){var l=this._getElBodySection();var h=l.offset();var f=h.top;var j=k.height-(f+i);if(d.isIpad()){l.height("auto")}else{l.height(j)}this._updateTextSize(k,j);var g=this._getRte();if(g){this._updateHtmlSize(g,j)}},_updateTextSize:function(j,i){if(!d.isIe7()&&!d.isIpad()){return}var f=i-4;var h=this._getElText();h.height(f);var g=j.width-2;var h=this._getElText();h.width(g)},_updateHtmlSize:function(f,g){if(!f||!f.container){return}f.resize("100%",g,false)},getType:function(){var f;if(this._isTextMode()){f=a.BODY_TYPE_TEXT}else{f=a.BODY_TYPE_HTML}return f},getText:function(){var g=undefined;if(this._isTextMode()){var f=this._getElText();g=f.val()}return g},getHtml:function(){var f=undefined;if(!this._isTextMode()){var g=this._getRte();if(g){f=g.getData();f=f.replace(/<div><\/div>/g,"<div>&nbsp;</div>")}}return f},_isTextMode:function(){var f=this._getElText();return(f.is(":visible"))},_setEdittingValue:function(g){var f=this._getPage();f.setEdittingValue(g)},_setValueChanged:function(){var f=this._getPage();f.setValueChanged()},isDirtyRte:function(){var f=this._getRte();if(f){return f.checkDirty()}return false},_isAllowedHtml:function(){return d.comSetting.isAllowedToEditHtml()},onfocusValue:function(f,g){this._setEdittingValue(true)},onblurValue:function(f,g){this._setEdittingValue(false)},onchangeValue:function(f,g){this._setValueChanged()},onclickSwitchToHtml:function(f,g){this._moveTextToHtml();this._switchToHtml()},onclickSwitchToText:function(f,g){this._moveHtmlToText();this._switchToText()},__closure:d.__closure,__bind:d.__bind,banpei:null}});c.constructor()})(jQuery);(function(c){var e=neo.core.readyNamespace("neo.denbun.Mail.EditPage.Sender");if(!e){return}var d=neo.denbun;var b=neo.denbun.Mail.EditPage;var a=neo.denbun.Mail.EditPage.Sender=new neo.core.Class({classProperties:{PARAM_FROM:"accid",PARAM_TO:"to",PARAM_CC:"cc",PARAM_BCC:"bcc",PARAM_SUBJECT:"subject",PARAM_BODY_TYPE:"textkind",PARAM_BODY_TEXT:"body",PARAM_BODY_HTML:"edithtml",PARAM_SIGNATURE:"sign",PARAM_CHARSET:"charset",PARAM_PRIORITY:"priority",PARAM_NOTIFICATION:"send",PARAM_TMPNM:"tmpnm",PARAM_MODE:"mode",PARAM_FOLDER_ID:"fid",PARAM_MAIL_ID:"msgid",PARAM_FORCE:"force",constructor:function(){}},properties:{_flgUseUnicode:null,_getFlgUseUnicode:function(){return this._flgUseUnicode||this._initFlgUseUnicode()},_initFlgUseUnicode:function(){return this._flgUseUnicode=false},_setFlgUseUnicode:function(f){return this._flgUseUnicode=f},_flgForce:null,_getFlgForce:function(){return this._flgForce||this._initFlgForce()},_initFlgForce:function(){return this._flgForce=false},_setFlgForce:function(f){return this._flgForce=f},_draft:null,_isDraft:function(){return this._draft||this._initDraft()},_initDraft:function(){return this._draft=false},_setDraft:function(f){return this._draft=f},_values:null,_getValues:function(){return this._values||{}},_setValues:function(f){return this._values=f},_mode:null,_getMode:function(){return this._mode},_setMode:function(f){return this._mode=f},_dataToSend:null,_getDataToSend:function(){return this._dataToSend},_setDataToSend:function(f){return this._dataToSend=f},_ajaxSend:null,_getAjaxSend:function(){return this._ajaxSend||this._initAjaxSend()},_initAjaxSend:function(){var f=this;var g={type:"POST",getSendData:function(){var i=f._getDataToSend();i.cmd="mailsend";if(f._isDraft()){i.proc="save"}else{if(d.comSetting.isWaitingToSendAvailable()){i.proc="wait"}}return i},onsuccess:this.__closure(this.onsuccessSend),onerror:this.__closure(this.onerrorSend),onfinish:this.__closure(this.onfinishSend)};var h=new d.Ajax(g);h.initialize();return this._ajaxSend=h},_dlgSending:null,_getDlgSending:function(){return this._dlgSending||this._initDlgSending()},_initDlgSending:function(){var f;if(this._isDraft()){f=d.getText("保存中...")}else{f=d.getText("送信中...")}return this._dlgSending=d.prevent(f)},_dlgEncodingError:null,_getDlgEncodingError:function(){return this._dlgEncodingError||this._initDlgEncodingError()},_initDlgEncodingError:function(){var f=this;var g={content:c("#dlg-mail_edit-encoding_error"),title:d.getText("確認"),onopen:function(){this.content.find("[type=radio]:first").attr("checked",true)},onok:function(){setTimeout(function(){f._execAgain()},1)}};var h=new d.Dialog(g);h.initialize();return this._dlgEncodingError=h},_elActionOnEncodingError:null,_getElActionOnEncodingError:function(){return this._elActionOnEncodingError||this._initElActionOnEncodingError()},_initElActionOnEncodingError:function(){return this._elActionOnEncodingError=c('[name="mail_edit-encoding_error-action"]')},_dlgSendConf:null,_getDlgSendConf:function(){return this._dlgSendConf||this._initDlgSendConf()},_initDlgSendConf:function(){var f=this;var g={content:c("#dlg-mail_edit-send_conf"),title:d.getText("送信内容確認"),onbeforeopen:this.__closure(this._updateSendConf),onopen:function(){if(f._getBodyType()=="1"){setTimeout(function(){f._startMonitorFrameContentSize()},300)}var i=h.getElDialog();i.find("#mail_edit-send_conf_table_area").scrollLeft(0).scrollTop(0)},onclose:this.__closure(function(j){var i=j.getElDialog();if(f._getBodyType()=="1"){f._stopMonitorFrameContentSize(null);i.find("#send_conf-body-iframe").remove()}i.find("#mail_edit-send_conf_table_area").scrollLeft(0).scrollTop(0)}),onok:this.__closure(function(i){setTimeout(function(){f._sendLow()},1)})};var h=new d.Dialog(g);h.initialize();return this._dlgSendConf=h},_tmFrameContentSize:null,_getTmFrameContentSize:function(){return this._tmFrameContentSize},_setTmFrameContentSize:function(f){clearInterval(this._tmFrameContentSize);return this._tmFrameContentSize=f},_elSendConfScrollArea:null,_getElSendConfScrollArea:function(){return this._elSendConfScrollArea||this._initElSendConfScrollArea()},_initElSendConfScrollArea:function(){return this._elSendConfScrollArea=c("#mail_edit-send_conf_table_area")},setting:null,_getPage:function(){return this.setting.page},_getElCharsetList:function(){return this.setting.elCharsetList},_getElFrom:function(){return this.setting.elFrom},_getElTo:function(){return this.setting.elTo},_getElCc:function(){return this.setting.elCc},_getElBcc:function(){return this.setting.elBcc},_getElSubject:function(){return this.setting.elSubject},_getElSignatureList:function(){return this.setting.elSignatureList},_getElTextBody:function(){return this.setting.elTextBody},_getElTmpnm:function(){return this.setting.elTmpnm},_getAutoSave:function(){return this.setting.autosave()},__constructor:function(f){this.setting=f},initialize:function(){if(DENBUN_MODE_XNEO){this._hook()}},_hook:function(){var f=this;this._loadMailSetting(function(){if(d.comSetting.getFlgCheckValueBeforeSend()){var g=f._getElSendConfScrollArea().find("input[type=checkbox]");f.__bind(g,"click","Checkbox")}})},_loadMailSetting:function(j){var f=this;var g=0;var h=2;var i=function(){g++;if(g<h){return}j()};(function(){var k=d.comSetting.getMailGeneralSettingData();if(k){i()}else{setTimeout(arguments.callee,100)}})();(function(){var k=d.comSetting.getMailSettingData();if(k){i()}else{setTimeout(arguments.callee,100)}})()},clean:function(){this._initFlgUseUnicode();this._initFlgForce();this._initDraft();this._setValues(null)},update:function(f,g){this._setValues(f);this._setMode(g)},exec:function(){this.readySendingData();if(this._getFlgForce()){this._sendLow();this._initFlgUseUnicode();this._initFlgForce()}else{var g=this._getErrorMessageToSend();if(g){this._showErrorMessageToSend(g);return}if(d.comSetting.getFlgConfirmBeforeSend()){var g=d.getText("送信してもよろしいですか？");var f=this;d.confirm(g,{onok:function(){setTimeout(function(){f._sendLow()},1)}})}else{if(d.comSetting.getFlgDispValueBeforeSend()||d.comSetting.getFlgCheckValueBeforeSend()){var h=this._getDlgSendConf();h.open()}else{this._sendLow()}}}},_updateSendConf:function(n){var j;var s;var q=n.getElDialog();var k=q.find(".dialog-body");var f=n.getElButton(d.getText("OK"));var i="("+d.getText("未入力")+")";var u=false;var h=d.comSetting.getFlgCheckValueBeforeSend();if(h){k.find(".mail_edit-send_conf_chk").show();k.find(".mail_edit-send_conf_nochk").hide();k.find("#mail_edit-send_conf").removeClass("none");f.attr("disabled",true)}else{k.find(".mail_edit-send_conf_chk").hide();k.find(".mail_edit-send_conf_nochk").show();k.find("#mail_edit-send_conf").removeClass("none");f.attr("disabled",false)}j=k.find(".send_conf-from").empty();s=c("#mail-edit-from").text();if(d.comSetting.isSendConfTargetFrom()){k.find(".send_conf_item-from").show();this._addSendConfItemOne(s,j,h);u=true}else{k.find(".send_conf_item-from").hide()}var g=d.getParsedAddresses(this._getTo());j=k.find(".send_conf-to").empty();if(d.comSetting.isSendConfTargetTo()){k.find(".send_conf_item-to").show();this._updateSendConfAddr(g,j,h,i);u=true}else{k.find(".send_conf_item-to").hide()}var m=d.getParsedAddresses(this._getCc());j=k.find(".send_conf-cc").empty();if(d.comSetting.isSendConfTargetCc()){k.find(".send_conf_item-cc").show();this._updateSendConfAddr(m,j,h,i);u=true}else{k.find(".send_conf_item-cc").hide()}var o=d.getParsedAddresses(this._getBcc());j=k.find(".send_conf-bcc").empty();if(d.comSetting.isSendConfTargetBcc()){k.find(".send_conf_item-bcc").show();this._updateSendConfAddr(o,j,h,i);u=true}else{k.find(".send_conf_item-bcc").hide()}j=k.find(".send_conf-priority").empty();s=this._getSendConfPriorityText();if(d.comSetting.isSendConfTargetPriority()){k.find(".send_conf_item-priority").show();this._addSendConfItemOne(s,j,h);u=true}else{k.find(".send_conf_item-priority").hide()}j=k.find(".send_conf-notify").empty();s=this._getSendConfNotifyText();if(d.comSetting.isSendConfTargetNotify()){k.find(".send_conf_item-notify").show();this._addSendConfItemOne(s,j,h);u=true}else{k.find(".send_conf_item-notify").hide()}j=k.find(".send_conf-charset").empty();s=this._getElCharsetList().find(".mail-edit-charset-value").filter(":checked").next().text();if(d.comSetting.isSendConfTargetCharset()){k.find(".send_conf_item-charset").show();this._addSendConfItemOne(s,j,h);u=true}else{k.find(".send_conf_item-charset").hide()}j=k.find(".send_conf-subject").empty();s=this._getSubject();if(!DNNEO.neo.isSet(s,{blank:false})){s=i}if(d.comSetting.isSendConfTargetSubject()){k.find(".send_conf_item-subject").show();this._addSendConfItemOne(s,j,h);u=true}else{k.find(".send_conf_item-subject").hide()}j=k.find(".send_conf-body").empty();if(d.comSetting.isSendConfTargetBody()){k.find(".send_conf_item-body").show();this._updateSendConfBody(j,h);u=true}else{k.find(".send_conf_item-body").hide()}j=k.find(".send_conf-att").empty();if(d.comSetting.isSendConfTargetAtt()){k.find(".send_conf_item-att").show();this._updateSendConfAtt(j,h);u=true}else{k.find(".send_conf_item-att").hide()}j=k.find(".send_conf-warning").empty();if(d.comSetting.isSendConfManySend()){var r=g.length+m.length;var t=d.comSetting.getSendConfManySendCount();if(r>=t){var s=neo.core.escape(d.getText("宛先，CCに多数のアドレスが指定され情報漏洩の危険性があります。BCCの使用をご検討ください。"));s=desknets.escapeSpace(s);if(h){j.append('<div><label><input type="checkbox" class="send_conf-check" />'+s+"</label></div>")}else{j.append("<div>"+s+"</div>")}}}var p=j.html();if(DNNEO.neo.isSet(p,{blank:false})){k.find(".send_conf_item-warning").show();u=true}else{k.find(".send_conf_item-warning").hide()}if(!u){k.find(".mail_edit-send_conf_chk").hide();k.find(".mail_edit-send_conf_nochk").hide();k.find("#mail_edit-send_conf").addClass("none")}if(h){if(f.is(":disabled")){var j=this._getElSendConfScrollArea().find("input[type=checkbox]:not(:checked)");var l=j.length;if(l==0){f.attr("disabled",false)}}}},_addSendConfItemOne:function(i,h,f){var g=neo.core.escape(i);g=desknets.escapeSpace(g);if(f){h.append('<div><label><input type="checkbox" class="send_conf-check" />'+g+"</label></div>");return}h.append("<div>"+g+"</div>");return},_addSendConfItemOneAddr:function(l,k,g){var j=neo.core.escape(l);j=desknets.escapeSpace(j);var h;if(g){h=c('<div><label><input type="checkbox" class="send_conf-check" />'+j+"</label></div>")}else{h=c("<div>"+j+"</div>")}var i=d.comSetting.isWhiteListAddr(l);if(i&&d.comSetting.isSendConfExceptWhiteList()){var f=h.find("input:checkbox");f.prop("checked",true);f.prop("disabled",true)}else{if(!i){h.addClass("caution")}}k.append(h);return},_updateSendConfAddr:function(g,l,f,j){for(var h=0;h<g.length;h++){var k=g[h];this._addSendConfItemOneAddr(k.text,l,f)}if(g.length==0){this._addSendConfItemOne(j,l,f)}},_updateSendConfAtt:function(i,f){var h=0;c("#mail-edit-attachment-list .mail-edit-attachment-link").each(function(){var k=c(this).clone().removeClass("mail-edit-attachment-link");var j;if(f){j=c('<div><label><input type="checkbox" class="send_conf-check" /></label></div>');j.find("label").append(k)}else{j=c("<div></div>").append(k)}i.append(j);h++});if(h==0){var g="("+d.getText("未選択")+")";this._addSendConfItemOne(g,i,f)}},_updateSendConfBody:function(f,i){if(i){var m=neo.core.escape(d.getText("本文を確認"));m=desknets.escapeSpace(m);f.append('<div><label><input type="checkbox" class="send_conf-check" />'+m+"</label></div>");f.find("div").css({"margin-bottom":"20px"})}if(this._getBodyType()=="1"){f.append('<iframe id="send_conf-body-iframe" src="about:blank" frameborder="0"></iframe>');var l=this._getHtmlBody();var k=d.getAntiCache();var g=d.getLang();var n=f.find("#send_conf-body-iframe");var j=n.contents()[0];j.open();j.write(["<html>\n","<head>\n",'<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">\n','<meta content="telephone=no" name="format-detection">\n','<link rel="stylesheet" href="/dneowmlroot/lang/',g,"/themes/common.css?v=",k,'">\n','<link rel="stylesheet" href="/dneowmlroot/dnhtml5i/css/body.css?v=',k,'">\n',"<title></title>\n","</head>",'<body class="send_conf-body-iframe-body">\n',l,"\n</body>\n","</html>"].join(""));j.close();if(d.isIpad()){f.css("position","relative");var h=c('<div id="send_conf-body-overlay"></div>');f.append(h)}}else{var l=this._getTextBody();l=neo.core.escape(l);l=l.replace(/[\r\n]+$/g,"");l=l.replace(/(\r\n|\r|\n) /g,"$1&nbsp;");l=desknets.escapeSpace(l);l=l.replace(/(\r\n|\r|\n)/g,"<br />");l="<div>"+l+"</div>";f.append(l)}},_prevWidth:0,_prevHeight:0,_equalCount:0,_resetContentSizeInfo:function(){this._prevWidth=0;this._prevHeight=0;this._equalCount=0},_judgeLoadingContent:function(h,j){var i=10;var f=j;var g=h;if(d.isMsie8()){f-=5}if(this._prevWidth==g&&this._prevHeight==f){this._equalCount++;if(this._equalCount>=i){this._stopMonitorFrameContentSize(null)}return false}else{this._equalCount=0;this._prevWidth=h;this._prevHeight=j;return true}},_startMonitorFrameContentSize:function(){var g=this;var h=300;g._resetContentSizeInfo();var f=setInterval(function(){var n=c("#send_conf-body-iframe");var j=n.contents().width();var m=n.contents().height();var k=n.closest(".send_conf-body").width()-10;if(j<k){j=k}var o=g._judgeLoadingContent(j,m);if(o){if(d.isMsie8()){m+=5}n.width(j).height(m);if(d.isIpad()){var l=d.getRect(n,false);var i=c("#send_conf-body-overlay");if(!!i){i.width(j).height(m).css({top:l.top+"px",left:l.left+"px"})}}}},h);this._setTmFrameContentSize(f)},_stopMonitorFrameContentSize:function(){this._setTmFrameContentSize(null)},_getSendConfPriorityText:function(){var f=this._getPriority();switch(f){case 1:case 2:return d.getText("高い");case 3:return d.getText("普通");case 4:case 5:return d.getText("低い")}return""},_getSendConfNotifyText:function(){var f=this._getNotification();switch(f){case 0:return d.getText("要求しない");case 2:return d.getText("要求する")}return""},draft:function(){this._setDraft(true);this.readySendingData();this._sendLow()},initSaveFlg:function(){this._initDraft()},_sendLow:function(){var g=this._initDlgSending();g.open();if(this._getAutoSave()===true){desknets.autosave.stop()}var f=this._getAjaxSend();f.sendRequest()},readySendingData:function(){var f={};f[a.PARAM_TO]=this._getTo();f[a.PARAM_CC]=this._getCc();f[a.PARAM_BCC]=this._getBcc();f[a.PARAM_SUBJECT]=this._getSubject();f[a.PARAM_BODY_TYPE]=this._getBodyType();f[a.PARAM_BODY_TEXT]=this._getTextBody();f[a.PARAM_BODY_HTML]=this._getHtmlBody();f[a.PARAM_CHARSET]=this._getCharset();f[a.PARAM_PRIORITY]=this._getPriority();f[a.PARAM_NOTIFICATION]=this._getNotification();f[a.PARAM_TMPNM]=this._getTmpnm();f[a.PARAM_MODE]=this._getMode();f[a.PARAM_MAIL_ID]=this._getMailId();f[a.PARAM_FORCE]=this._getForce();this._setDataToSend(f);return f},_getFrom:function(){var f=this._getElFrom();var g=f.val();return g},_getTo:function(){var f=this._getElTo();var g=f.val();return g},_getCc:function(){var f=this._getElCc();var g=f.val();return g},_getBcc:function(){var g=this._getElBcc();var f=g.val();return f},_getSubject:function(){var f=this._getElSubject();var g=f.val();return g},_getBodyType:function(){var g=this._getPage();var f=g.getBodyType();return f},_getTextBody:function(){var g=this._getPage();var f=g.getTextBody();return f},_getHtmlBody:function(){var g=this._getPage();var f=g.getHtmlBody();return f},_getSignature:function(){var g=this._getElSignatureList();var f=g.val();return f},_getTmpnm:function(){var f=this._getElTmpnm();var g=f.val();return g},_getMailId:function(){var f=this._getPage();var g=f.getId();return g},_getCharset:function(){var g;if(this._getFlgUseUnicode()){g=""}else{var f=this._getPage();g=f.getCharset()}return g},_getPriority:function(){var f=this._getPage();return f.getPriority()},_getNotification:function(){var f=this._getPage();return f.getNotification()},_getForce:function(){var f;if(this._getFlgForce()){f="1"}else{f="0"}return f},_getErrorMessageToSend:function(){var g;var h=this._getDataToSend();var j=h[a.PARAM_TO];var i=h[a.PARAM_CC];var f=h[a.PARAM_BCC];if(j==""&&i==""&&f==""){g=d.getText("宛先を指定してください。");return g}return null},_showErrorMessageToSend:function(f){d.alert(f)},_execAgain:function(){if(this._getFlgChangeEncode()){this._setFlgUseUnicode(true)}this._setFlgForce(true);this.exec()},_getFlgChangeEncode:function(){var f=this._getElActionOnEncodingError().filter(":checked");return(f.val()=="1")},_close:function(f,g,h){d.app.forceToClose();var i=this._getPage();i.close(f,g,h)},_isReply:function(){var f=this._getMode();return(f==b.MODE_REPLY||f==b.MODE_REPLY_ALL)},onsuccessSend:function(j,n,q){var k=this._isDraft();var h=d.comSetting.isWaitingToSendAvailable();if(!k&&h&&d.parent){var l=c("id",j);var g=l.text();var i;if(this._isReply()){i=this._getMailId()}d.parent.app.waitToSendMail(g,i)}var m;if(k){var p=this._getFrom();m=[p]}var f=false;var o=this._getMode();if(!k&&!h&&(o==b.MODE_REPLY||o==b.MODE_REPLY_ALL||o==b.MODE_FORWARD||o==b.MODE_RESTART_EDITTING)){f=true}if(this._getAutoSave()===true){desknets.autosave.del("1")}this._close(true,m,f)},onerrorSend:function(h,g,j){var f=-22400;if(DENBUN_MODE_XNEO){f=-25}if(j.errorno==f){if(this._isDraft()){c(".mail_edit-encoding_error-text-send").hide();c(".mail_edit-encoding_error-text-save").show()}else{c(".mail_edit-encoding_error-text-send").show();c(".mail_edit-encoding_error-text-save").hide()}var i=this._getDlgEncodingError();setTimeout(function(){i.open()},1);return false}if(this._getAutoSave()===true){desknets.autosave.start()}return},onfinishSend:function(){var f=this._getDlgSending();f.close()},onclickCheckbox:function(i,j){var k=this._getDlgSendConf();if(!k.isOpened()){return}var g=k.getElButton(d.getText("OK"));var f=c(j);var l=f.attr("checked");if(l){if(g.is(":disabled")){var f=this._getElSendConfScrollArea().find("input[type=checkbox]:not(:checked)");var h=f.length;if(h==0){g.attr("disabled",false)}}}else{if(!g.is(":disabled")){g.attr("disabled",true)}}},__closure:d.__closure,__bind:d.__bind,banpei:null}});a.constructor()})(jQuery);(function(a){var f=neo.core.readyNamespace("neo.denbun.Mail.ViewOfMailFilePage");if(!f){return}var c=neo.denbun;var e=c.Mail;var b=e.ListPage;var d=neo.denbun.Mail.ViewOfMailFilePage=new neo.core.Class({superClass:e.ViewPage,classProperties:{CLS_FOR_VIEW_OF_MAIL_FILE:"mail_list-for_view_of_mail_file",constructor:function(){}},properties:{initialize:function(){this.__call("initialize",arguments);this._hook();this._registerMenuCallbacks();a("."+e.ViewPage.CLS_TOOLBAR_LIST_RIGHT).hide()},_registerMenuCallbacks:function(){var g=this.__closure(this._updateMenuStatus);c.app.registerMenuCallback(g,"mail_list","operation")},_updateMenuStatus:function(h){var g=h.find("."+c.App.Menu.CLS_MENU_ITEM).not("."+d.CLS_FOR_VIEW_OF_MAIL_FILE);g.addClass(c.CLS_DISABLED)},_hook:function(){c.$window.bind("unload",this.__closure(this.onunload))},_clean:function(){this.updateMenuEnabled(true);e.disableAddToAddressBookButton();var h=c.getParameters();var g=this._getViewer();g.loadForViewOfMailFile(h)},updateMenuEnabled:function(i){var h=c.CLS_DISABLED;var g=this._getElToolbar();var j=g.find("."+c.App.Menu.CLS_ITEM);j.removeClass(h);var k=j.not("."+d.CLS_FOR_VIEW_OF_MAIL_FILE);k.addClass(h)},_getSelectedSingleId:function(){var g=this._getViewer();var h=g.getTemporaryMessageIdForViewOfMailFile();return h},onclose:function(g){this.__call("onclose",arguments)},_deleteTemporaryArea:function(){var h=this._getViewer();var g=h.getTemporaryMessageIdForViewOfMailFile();if(g){e.deleteTemporaryAreaForViewOfMailFile(g);h.setTemporaryMessageIdForViewOfMailFile(null)}},onunload:function(){this._deleteTemporaryArea()},banpei:null}});d.constructor()})(jQuery);