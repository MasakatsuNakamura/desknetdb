/*
 * desknet's NEO
 * https://www.desknets.com/
 * Copyright (C)2012-2016 NEOJAPAN Inc. All Rights Reserved.
 * 本製品は日本国著作権法および国際条約により保護されています。 
 * 本製品の全部または一部を無断で複製したり、無断で複製物を頒 
 * 布すると著作権の侵害となりますのでご注意ください。 
 */
$.extend(desknets,{MODULE_MAIN:"dneo",MODULE_API_MAIN:"dneor",MODULE_REFER:"zrefer",MODULE_API_OPT:"zropt",MODULE_HTML_MAIN:"zhtml",DIR_RESHOME:"dneores",CMD_DOWNLOAD:"referdownload",CMD_TMPLHTML:"tmplhtml",COOKIENAME_SESSION_ID:"dnzSid",COOKIENAME_STOKEN:"dnzToken",COOKIENAME_ATTACH_IE_FLASH:"dnzAttFlash",ERRORNO_MAILSELTRANSMIT:-40007,PRM_VAL_ALLDEL:"all",CACHE_VERSION:"2.5.0.0",msUrl:"",msSubDirectory:"",msModuleName:"",RES_STATUS_SUCCESS:"ok",merrMsgConnect:'<span class="co-colon-span">:</span>',_msExtension:"",_initSetUp:function(){var b=this;var f=document.URL;var d=0;var c="";var h="";var g="";var e="";var a="";d=f.indexOf("?");if(d>0){f=f.substring(0,d)}d=f.indexOf("#");if(d>0){f=f.substring(0,d)}d=f.lastIndexOf("/");if(d>=0){c=f.substring(0,d+1);b.msUrl=c;h=f.substring(d+1,f.length);d=h.lastIndexOf(".");if(d>=0){g=h.substring(0,d);b.msModuleName=g;e=h.substring(d+1,h.length);b._msExtension=e}d=c.indexOf("//");if(d>=0){a=c.substring(d+2,c.length);d=a.indexOf("/");if(d>=0){a=a.substring(d,a.length);b.msSubDirectory=a}}}},getUrl:function(a){var b=this;var c=0;var d="";if(typeof(a)==="string"){d=a}if(d!==""&&b._msExtension){d=d+"."+b._msExtension}return b.msUrl+d},getExtension:function(){return this._msExtension},createRandomId:function(){var a=""+(new Date()).getTime()+parseInt(Math.random()*10000);return a},formatFileSize:function(c,a){var b=Number(c);if(isNaN(c)||c<0){return desknets.Resource.attachInvSize}b=Math.ceil(b/1024);return desknets.numberFormat(b)+" KB"},numberFormat:function(b){var a=[];var c="";if((b.toString()).indexOf(".")!=-1){a=(b.toString()).split(".")}else{a[0]=b;a[1]=""}c=new String(a[0]).replace(/,/g,"");while(c!=(c=c.replace(/^(-?\d+)(\d{3})/,"$1,$2"))){}if(a[1].length>0){c=c+"."+a[1]}return c},escape:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescape:function(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},escapeValue:function(a){return a.replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},escapeSpace:function(c,b){var a;if(b){a="\u00A0"}else{a="&nbsp;"}if(c.charAt(0)===" "){c=a+c.slice(1)}return c.replace(/  /g," "+a)},encodeURIComponentNeo:function(a){return encodeURIComponent(a)},decodeURIComponentNeo:function(a){a=a.replace(/\+/g," ");try{return decodeURIComponent(a)}catch(b){return a}},getNeoParam:function(e){var g="";var a=[];for(var c in e){var b=e[c];if(!(b instanceof Array)){b=[b]}for(var d=0;d<b.length;d++){var f=b[d];if(f!=null){var h=desknets.encodeURIComponentNeo(f);a.push(c+"="+h)}}}g=a.join("&");return g},splitParam:function(e){var f={};e=e.substr(e.indexOf("?")+1,e.length);if(e==""){return{}}var a=e.split("&");for(var c=0;c<a.length;c++){a[c]=a[c].split("=");if(!DNNEO.neo.isSet(a[c][0],{blank:false})||!DNNEO.neo.isSet(a[c][1])){continue}var b=a[c][0];var d=desknets.decodeURIComponentNeo(a[c][1]);if(DNNEO.neo.isSet(f[b])){if(f[b] instanceof Array){f[b].push(d)}else{f[b]=[f[b],d]}}else{f[b]=d}}return f},parseErrorInfo:function(c,b){var a={level:"error",message:c};var d={E:"error",W:"warn",M:"message"};if(c.charAt(1)==":"){a.level=d[c.charAt(0)];a.message=c.substring(2)}if(!!b&&a.level=="error"){var e="";if(typeof b==="number"&&b>=500){e="HTTP"}a.message+="\n["+e+String(b)+"]"}else{if(!!b&&b===this.ERRORNO_MAILSELTRANSMIT){a.message+=this.getErrMailTransmitMsg()}}return a},getErrMailTransmitMsg:function(){return""},getErrField:function(c,e){var d={};var a="";var b="";if(c==DNNEO.neo.ajax.NEOAJAX_OBJXML){b=e.find("errormessage").text();a=e.find("errmsgadd").text()}else{b=e.errormessage;a=e.errmsgadd}d.fieldid=a;d.msg=b;return d},getErrFieName:function(b,a){var c="";c=b.find(".jco-input-"+a).closest("td").prev().find(".co-colon").eq(0).text();if(DNNEO.neo.isSet(c)&&c.length>0){c=c+desknets.merrMsgConnect}return c},getErrConvMsg:function(e){var a=e.msg;var c=e.fieldid;var d=e.fieldname;var b="";if(DNNEO.neo.isSet(c)){if(DNNEO.neo.isSet(d)&&d.length>0){if(a.charAt(1)==":"){b=a.substring(0,2);a=a.substring(2)}return b+d+a}}return a},saveHashCmdCookie:function(b){var a=this;$.cookie(desknets.COOKIENAME_HASHCMD_FLG,b)},saveCookie:function(c,e,b){var a=this;var d={};if(typeof(b)=="object"){$.extend(d,b)}if(!d.path&&!!a.msSubDirectory){d.path=a.msSubDirectory}$.cookie(c,e,d)},saveCookieToDisk:function(b,d){var c=new Date(2050,11,31,23,59,59);var a=this;a.saveCookie(b,d,{expires:c})},convertToSafeHtml:function(b,a){var c=$.extend({allowedFrameUri:["http://www.youtube.com/","http://libura.com/"],allowedSchemas:["http","https","file"]},a);return DNNEO.neo.html.convertToSafeHtml(b,c)}});(function(b){var a=b(document.documentElement);desknets.browser={};desknets.browser.msie=a.hasClass("co-browser-IE");desknets.browser.msie8=a.hasClass("co-browser-IE-8");desknets.browser.msie9=a.hasClass("co-browser-IE-9");desknets.browser.firefox=a.hasClass("co-browser-Firefox");desknets.browser.chrome=a.hasClass("co-browser-Chrome");desknets.browser.safari=a.hasClass("co-browser-Safari");desknets.browser.ipad=a.hasClass("co-device-iPad");desknets.browser.android=a.hasClass("co-device-Android");desknets.browser.tablet=desknets.browser.ipad||desknets.browser.android;desknets.support={};desknets.support.cssTransform=DNNEO.neo.supportStyle("transform");desknets.support.cssTransition=DNNEO.neo.supportStyle("transition");desknets.support.cssPositionFixed=DNNEO.neo.supportStyle("position","fixed")})(jQuery);$.extend(desknets,{ERRORNO_LOGIN_LICENSE1:-9002,ERRORNO_LOGIN_LICENSE2:-9056,ERRORNO_GRPERR_ITEMNOTHING:-110,DBVAL_ADMINISTRATORS_ROLE_ID:1,DBVAL_EVERYONE_ROLE_ID:2,DBVAL_ROLE_LOCK_MAX:999,DBVAL_STARTTAB_SHARE:"0",DBVAL_MID_KOUBAI:"16",DBVAL_MID_PAY:"18",CMD_CHOOSERMSETUSERSEL:"constructmsetcmdusersearch",CMD_PSETINDEX:"psetindex",COOKIENAME_LOGIN_SAVE:"dnzSv",COOKIENAME_LOGIN_INFO:"dnzInfo",COOKIENAME_LEFT_MENU:"dnzLeftmenu",COOKIENAME_HASHCMD_FLG:"dnzHashcmd",COOKIENAME_PORTAL_TAB:"dnzPtab",COOKIENAME_ATTACHDISP_LIST:"dnzAttlist",COOKIENAME_IMEX_CCODE:"dnzImExCcode",COOKIENAME_IMEX_CSEP:"dnzImExCsep",COOKIEVALUE_HASHCMD_FIN:"fin",COOKIEVALUE_STARTTAB_SHARE:"S",CMD_FILAGROUPUSER:"filagrpuser",RES_TAG_MSGDISPLIMIT:"msgdisplimit",RES_TAG_MSGGETLIMIT:"msggetlimit",TIME_GETLIST_LAG:900,TIME_LIMIT_WAIT:5000,EVENT_SCROLL:desknets.browser.android?"touchmove":"scroll",_CLSNAME_MODFILES:"jco-files-modify",_isCallExecLocation:false,SRCHKEY_MAXLENGTH:127,init:function(){var a=this;a._initSetUp();a._initSetDatepicker();desknets.ajax.init();desknets.logout.init();desknets.pageframe.init()},_initSetDatepicker:function(){$.datepicker.setDefaults({changeMonth:true,changeYear:true,showButtonPanel:true,shortYearCutoff:38,selectOtherMonths:true,showOtherMonths:true,minDate:new Date(1970,0,3),maxDate:new Date(2038,0,16)});return},getProcUrl:function(e){var a=this;var d=document.URL;var b="";var c=0;c=d.indexOf("?");if(c>0){b=d.substring(c,d.length);d=d.substring(0,c)}c=d.lastIndexOf("/");if(c>=0){b=d.substring(c+1,d.length)+b}if(e){b=desknets.encodeURIComponentNeo(b)}return b},parseNumber:function(c,b){var a=typeof(c);var d=Number.NaN;if(a=="string"){c=c.replace(/[\uFF10-\uFF19]/g,function(e){return(e.charCodeAt(0)-65296).toString()});d=Number(c)}else{if(a=="number"){d=c}}if(isNaN(d)&&typeof(b)!="undefined"){return b}return d},zeroPadding:function(b,a){var c=b.toString();while(c.length<a){c="0"+c}return c},numberFormatByte:function(f,b,e,a){var d,g;var c=["B","KB","MB","GB"];var h=c.length;f=Number(f);if(isNaN(f)||f<0){return desknets.Resource.attachInvSize}b=0<b?Number(b):0;e=(0<e&&e<h)?Number(e):0;a=(DNNEO.neo.isSet(a)&&0<=a&&a<h)?Number(a):h-1;for(d=e;d<a&&f>1023;d++){e++;f/=1024}g=Math.pow(10,b);f=Math.ceil(f*g)/g;return desknets.numberFormat(f)+" "+c[e]},stripTags:function(a){return this.escape($("<div />").html(a).text())},chkInArray:function(d,c,a){var b=0;for(b=c.length;b>=0;b--){if(a===true){if(c[b]===d){break}}else{if(c[b]==d){break}}}return b},getInputDataToUrl:function(b){var a=this;var d={};var c="";d=a.getInputDataToObj(b);c=desknets.getNeoParam(d);return c},getInputDataToObj:function(d){var c=this;var a={};var e="";var b="";var f;if(typeof(d)==="string"){f=$(d)}else{f=d}f.each(function(){$(this).find("input").each(function(){e=$(this).attr("name");if(e!==undefined&&e!==""){b=desknets.unescape($(this).val());a[e]=b}})});return a},execLocation:function(b,d){var a=this;this._isCallExecLocation=true;if(DNNEO.neo.isSet(d)){window.open(b,d).focus()}else{try{location.href=b}catch(c){}}},isCallExecLocation:function(){return this._isCallExecLocation},clickAlink:function(a){var b=a.attr("href");var c=a.attr("target");desknets.execLocation(b,c)},moveScroll:function(){$("html, body").scrollTop(0)},getErrMailTransmitMsg:function(){var b=this;var a=desknets.Resource.Message.com_notice_settransmit;a=desknets.tmpl.replaceWordHtml(a,"module",b.getUrl(b.MODULE_MAIN));a=desknets.tmpl.replaceWordHtml(a,"cmd",b.CMD_PSETINDEX);return a}});(function(a){desknets.submitform={setButton:function(b,d){var c=b.find(":image, :submit, :button");c.attr("disabled",d)},setDisabled:function(c){var b=this;b.setButton(c,true)},clearDisabled:function(c){var b=this;b.setButton(c,false)},setDialogDisabled:function(c){var b=this;var d=c.parent();b.setButton(d,true);d.find(".ui-icon-closethick").bind("click",function(){return false})},clearDialogDisabled:function(c){var b=this;var d=c.parent();b.setButton(d,false);d.find(".ui-icon-closethick").unbind("click")}}})(jQuery);desknets.ajax={RESTYPE_JSON:"json",RESTYPE_HTML:"html",REQTYPE_MULTI:"multi",REQTYPE_SINGLE:"single",_showErrorDialog:true,numberForStatus:{parsererror:1000,abort:1001},onError:function(a,b){if(this._showErrorDialog&&a!=this.numberForStatus.abort){desknets.dialog.alert(b,{errorNo:a})}},rest:function(a){if(typeof a.data=="object"&&a.processData!==false){if(a.allowCsrfTempl!==false){this._addParamForCsrf(a.data)}delete a.allowCsrfTempl;if(a.allowCacheTempl!==false){this._addParamForNoCache(a.data)}delete a.allowCacheTempl}this._setUpOptions(a);DNNEO.neo.ajax.rest(a)},getJsonItems:function(a){if(!a||!a.list){return[]}else{return this.getItems(a.list.item)}},getItems:function(a){if(!a){return[]}else{if(!$.isArray(a)){return[a]}else{return a}}},arrayToMultiCmdData:function(b){var a={};$.each(b,function(c,d){a[c.toString()]=d});return{multicmd:JSON.stringify(a)}},addParamForCsrf:function(a){this._addParamForCsrf(a)},addParamForNoCache:function(a){this._addParamForNoCache(a)},getErrorNumber:function(b,a){if(b.status!=0){return b.status}else{return this.numberForStatus[a]||0}},_setUpOptions:function(b){var a=this;if(typeof(b.dataType)!=="string"){b.dataType="json"}if(!$.isFunction(b.error)){b.error=function(d,c,e){a.onError(a.getErrorNumber(d,c),e)}}},_addParamForCsrf:function(b){var a=$.cookie(desknets.COOKIENAME_STOKEN);if(!!a&&!b[a]){b[a]="1"}},_addParamForNoCache:function(b){var a=desknets.createRandomId();if(!!a&&!b[a]){b[a]=""}}};$.extend(desknets.ajax,{_$loading:$(),init:function(){var a=this;a._$loading=$("#dn-loading");$.ajaxSetup({traditional:true});$(document).bind("ajaxStart",function(){a._showLoadingTip()});$(document).bind("ajaxStop",function(){a._hideLoadingTip()});$(window).bind("beforeunload.ajax",function(){a._showErrorDialog=false});$(document).bind("ajaxSend",function(){a._showErrorDialog=true})},submitForm:function(a,b){if(!b.data){b.data={}}if(typeof b.data=="object"&&b.processData!==false){this._addParamForCsrf(b.data)}this._setUpFormOptions(b);DNNEO.neo.ajax.submitForm(a,b)},chkAjaxHtmlError:function(e){var d={status:"ok"};var a=$("<div>"+e+"</div>");var c=a.find(".co-message-box");if(c.hasClass("alert")||c.hasClass("error")){var b=c.find(".co-message").find("span").html();if(c.hasClass("alert")){b="W:"+b}d.status="ng";d.no="";d.message=b}return d},_showLoadingTip:function(){var a=this;this._$loading.show();if(desknets.browser.tablet){this._updateLoadingTipPosition();$(window).on("resize scroll",function(){a._updateLoadingTipPosition()})}},_hideLoadingTip:function(){var a=this;if(desknets.browser.tablet){$(window).off("resize scroll",function(){a._updateLoadingTipPosition()})}this._$loading.hide()},_updateLoadingTipPosition:function(){if(this._$loading.length>0){desknets.pageframe.updateFixedPosition(this._$loading)}},_setUpFormOptions:function(c){var b=this;var a=c.beforeSerialize;c.beforeSerialize=function(d,e){b._addParamForNoCache(e.data);if(typeof a=="function"){return a.apply(d,[d,e])}};this._setUpOptions(c)}});desknets.pageframe={ID_SUBWIN_OPEN_TOGGLE:"#dn-s-toggle",DATA_HELPCMD:"helpcmd",_TMPL_PROCESSING:'<div id="dn-processing" class="co-position-fixed co-bottom-tip" data-position="center bottom"><div class="dn-loading-message">{{L_Processing}}</div></div>',_layers:[],_availableModules:null,_$topMsgPwd:null,_$processing:$(),init:function(){var a=this;this._initPsetMenu();this._initSideMenu();desknets.ntwi.init();desknets.tags.init();desknets.hsearch.init();this._viewTopMsgPwd();a._initPageFrameRegistryEvent();a._initLayerManager();desknets.dateTime.init();desknets.dialog.init();desknets.popUp.init();desknets.chooser.init();desknets.refDialog.init();$("#co-m-h-setting-link").data("position","bottom");this.setUpSetmenu($("#co-m-h-setting-menus"))},getLoginUid:function(){return $("#jco-loginuid").val()},getLoginName:function(){return $("#dn-h-username").text()},getLoginDefGroup:function(){return $("#jco-logindefgroup").val()},getLoginImageUrl:function(){return $("#jco-loginimg").val()},getLoginMailLink:function(){return $("#jco-loginmaillink").val()},getCommonLang:function(){return $("#jco-commonlang").val()},getMailUse:function(){return $("#jco-mailuse").val()},getServerDate:function(){return desknets.dateTime.current},isShownMenu:function(a){if($.type(this._availableModules)!="array"){var b=String($(document.body).data("available-modules"));this._availableModules=b.split(",")}return $.inArray(a,this._availableModules)>=0},isUserInfoDisp:function(){return $("#jco-userinfodisp").val()=="1"?true:false},getUserNoDispItems:function(){return $("#jco-usernodispitems").val()},getUserDispItems:function(){return $("#jco-user-dispitems").val()},isSubWinOpen:function(){var a=$("body");return a.hasClass("dn-side-open")||a.hasClass("dn-side-fit")},closeSubWin:function(){if($("body").hasClass("dn-side-open")){$("#dn-s-c-icon").trigger("click").trigger("click")}},setFuncSel:function(a){$("#"+a).addClass("on")},setUpSetmenu:function(b){var a=b.find(":not(.hplink)>a.co-m-h-setting-list-label");var c=$("#jco-pv-funcid").val();a.click(function(f){a.not($(this)).removeClass("on").next().hide().removeClass("on");$(this).toggleClass("on").next().toggle(0,function(){$(this).toggleClass("on",!!$(this).filter(":visible").length)});f.preventDefault()});b.find("li.co-setting-toggle").children("a").click(function(e){e.preventDefault();var f=$(this).parent();f.siblings().removeClass("open");f.toggleClass("open")});a.filter(":first").addClass("on").next().show().addClass("on");var d=a.eq(1);if(!$.isEmptyObject(d)&&d.parent().hasClass("mglink")){d.addClass("on").next().show().addClass("on")}if(c){$("li.co-setting-toggle").find("#"+c).parents("li.co-setting-toggle",$("li.co-setting-toggle")).addClass("open")}},executeDefaultClickAction:function(){$(document.body).click()},viewTopMsg:function(b,f,a){var e=this.getTopMsg();if(this._$topMsgPwd&&this._$topMsgPwd.length>0){this._$topMsgPwd.hide()}if(e.length<=0){var d='<div class="co-topmsg"><span class="co-topmsg-text"><a class="co-btn co-btn-close" href="#" title="'+desknets.Resource.closeLabel+'">x</a><span id="co-topmsg-text-set"></span></span></div>';$(d).appendTo(document.body);e=this.getTopMsg()}if(b!==""){e.find("#co-topmsg-text-set").html(b)}if(f!==""){e.removeClass();e.addClass("co-topmsg-text");if(f!=""){e.addClass(f)}}var c=true;if(e.hasClass("error")||e.hasClass("alert")||a===false){c=false}this._viewTopMsg(e,c)},_viewTopMsg:function(d,a){var e=true;var b=null;var c=10000;d.closest(".co-topmsg").appendTo(document.body);if(d.css("display")=="none"){if(a===true){b=setInterval(function(){if(e){d.fadeOut("slow");clearInterval(b)}},c)}}if(d.length>0){d.css({top:-1*d.height(),display:"inline-block"}).animate({top:0},{duration:"slow"}).hover(function(){e=false},function(){e=true}).find(".co-btn-close").click(function(f){f.preventDefault();$(this).parent().hide();if(b!==null){clearInterval(b)}})}},closeTopMsg:function(){this.getTopMsg().hide()},viewTopMsgFromID:function(c){var b={error:"error",warn:"alert",message:"info"};c=c.split(",");var d="";var g;for(var e=0;e<c.length;e++){var f=desknets.Resource.Message[c[e]];var a=desknets.parseErrorInfo(f);if(d!=""){d+="<br />"}else{g=a.level}d=d+a.message}if(d!=""){this.viewTopMsg(d,b[g])}},getTopMsg:function(){return $(".co-topmsg-text").filter(":not(.jco-topmsg-pwdlimit-text)")},_viewTopMsgPwd:function(){this._$topMsgPwd=$(".jco-topmsg-pwdlimit-text");this._viewTopMsg(this._$topMsgPwd,false)},executeOnTipShown:function(b){var c=this._getProcessingTip();var a=function(){if(c.length>0){desknets.pageframe.updateFixedPosition(c)}};c.show();if(desknets.browser.tablet){a();$(window).on("resize scroll",a)}setTimeout(function(){b();if(desknets.browser.tablet){$(window).off("resize scroll",a)}c.hide()},1)},updateFixedPosition:function(a){var b=a.data("position");a.css("left",this._getFixedX(a,b)+"px");a.css("top",this._getFixedY(a,b)+"px")},notifyToShowLayer:function(a){var b=this;a.each(function(){if($.inArray(this,b._layers)<0){if(b._layers.length<=0){$("html").addClass("co-has-layers")}b._layers.push(this)}})},notifyToHideLayer:function(a){var b=this;a.each(function(){var c=$.inArray(this,b._layers);if(c>=0){b._layers.splice(c,1);if(b._layers.length<=0){$("html").removeClass("co-has-layers")}}})},_initSideMenu:function(){var a=$(document.body);if(a.is(".dn-palette-menu")){desknets.menu.bar.initSideMenu()}else{if(a.is(".dn-slide-menu")){desknets.menu.frame.initSideMenu()}}},_initPsetMenu:function(){$("#dn-h-usermenu > ul").accordion({header:".expandable",autoHeight:false,animated:false,collapsible:true})},_initPageFrameRegistryEvent:function(){var a=this;$(".co-guide-toggle").click(function(b){b.preventDefault();$(this).closest(".co-guide-item").toggleClass("on")});$(".jco-helplink").click(function(c){c.preventDefault();$("body").click();var d=$(this).data(a.DATA_HELPCMD);var b=$(this).attr("href");var e=$(this).attr("target");if(DNNEO.neo.isSet(d)){b=b+d+".html"}desknets.execLocation(b,e)})},_initLayerManager:function(){var a=this;var b=$(document);b.bind("dialogopen",function(c){a.notifyToShowLayer($(c.target))});b.bind("dialogclose",function(c){a.notifyToHideLayer($(c.target))});b.bind("open.popup",function(c){a.notifyToShowLayer($(c.target))});b.bind("close.popup",function(c){a.notifyToHideLayer($(c.target))})},_getProcessingTip:function(){if(this._$processing.length<=0){var b=desknets.Resource,a=this._TMPL_PROCESSING;a=desknets.tmpl.replaceWordHtml(a,"L_Processing",b.processingLabel);this._$processing=$(a).appendTo(document.body)}return this._$processing},_getFixedX:function(b,a){var d=["left","center","right"];for(var c=0;c<d.length;c++){if(a.indexOf(d[c])>=0){return window.scrollX+(window.innerWidth-b.outerWidth())*(c/2)}}return 0},_getFixedY:function(b,a){var d=["top","middle","bottom"];for(var c=0;c<d.length;c++){if(a.indexOf(d[c])>=0){return window.scrollY+(window.innerHeight-b.outerHeight())*(c/2)}}return 0}};desknets.dialog={_idPrefix:"neodialog-",_dialogOptions:{modal:true,closeOnEscape:false,dialogClass:"dn-dialog",width:400,minHeight:63,closeText:desknets.Resource.closeLabel,draggable:true,resizable:false},init:function(){var a=this;$(window).bind("hashchange",function(b){a.closeAll()});$(document).bind("dialogopen",function(b){var c=$(b.target);if(desknets.browser.msie8){a._reflectBeforeStyle(c)}a.moveToDefaultPosition(c)})},alert:function(d,b){var a=this;var c=$.extend({extraMessage:null,extraClass:"",btnLabel:desknets.Resource.closeLabel},b);var f={buttons:{},beforeclose:function(g){if(typeof(c.close)=="function"){return c.close.apply(this)}},close:function(g){a.deleteById(c.type)}};var e=this._createMessage(d,c);f.title=desknets.Resource[c.type+"DefaultTitle"],f.buttons[c.btnLabel]=function(){$(this).dialog("close")};return this._openMessageDialog(e,c,f)},confirm:function(e,b,c){var a=this;var d=$.extend({extraMessage:null,extraClass:"",btnLabelOk:desknets.Resource.ConfOKButtonLabel,btnLabelCancel:desknets.Resource.ConfCancelButtonLabel},c);var f={title:desknets.Resource.confirmDefaultTitle,beforeclose:function(g){return a._onBeforeCloseConfirm(g,$(this),b,d.cancel)},close:function(g){a.deleteById("confirm")},buttons:{},open:function(){$(this).parent().find(".ui-dialog-buttonpane button:eq(1)").focus()}};f.buttons[d.btnLabelOk]=function(){$(this).data("result","ok").dialog("close")};f.buttons[d.btnLabelCancel]=function(){$(this).data("result","cancel").dialog("close")};return this._openMessageDialog(e,d,f)},ask:function(a,c,b){return this.confirm(a,b,{answers:c,btnLabelOk:desknets.Resource.OKButtonLabel,btnLabelCancel:desknets.Resource.CancelButtonLabel})},make:function(d,a){var c={error:"error",warn:"alert",message:"info",confirm:"confirm"};var b=this._getById(d);if(!b){if(!!c[d]){a.dialogClass=a.dialogClass||this._dialogOptions.dialogClass;a.dialogClass+=" message "+c[d]}b=$("<div />").addClass(d).appendTo($(document.body));this.setUp(b,a);b.closest(".ui-dialog").attr("id",this._idPrefix+d)}return b},setUp:function(a,b){if(a.closest(".ui-dialog").length<=0){var d=this._getActualOptions(b);a.dialog(d)}var c=a.closest(".ui-dialog").find(".ui-dialog-titlebar-close");c.attr("title",c.text());return a},moveToDefaultPosition:function(b){var a=$(window).innerWidth();var f=$(window).innerHeight();var d=b.width();var i=b.height();var e,h;var c=Math.floor((a-d)/2);var g=Math.min(Math.floor((f-i)/2),100);if(desknets.browser.tablet){e=window.top.scrollY;h=window.top.scrollX;c=c-h;g=g-e}b.dialog("option","position",[c,g]);if(desknets.browser.tablet){$(window).scrollTop(g+e);$(window).scrollLeft(c+h)}},closeAll:function(){$(".ui-dialog-content:visible").each(function(){var a=$(this);if(a.dialog("isOpen")){a.dialog("close")}})},deleteById:function(b){var a=this._getById(b);if(a){a.dialog("destroy").remove()}},deleteAll:function(a){$(".ui-dialog-content").each(function(){var b=$(this);if(!a||!b.dialog("isOpen")){b.dialog("destroy").remove()}})},getDialogOption:function(){var a=$.extend({},this._dialogOptions);return a},setFirstDialogOpen:function(a){this.moveToDefaultPosition(a)},isCloseButtonEvent:function(c){var b=".ui-dialog-titlebar-close";while(!!c){var a=$(c.target);if(c.type=="click"&&a.closest(b).length>0){return true}c=c.originalEvent}return false},_onBeforeCloseConfirm:function(c,d,b,e){var a=d.data("result");d.data("result","");if(this.isCloseButtonEvent(c)){a="cancel"}if(a=="ok"&&typeof(b)=="function"){return b.apply(d[0],[this._getCheckedOptions(d)])}if(a=="cancel"&&typeof(e)=="function"){return e.apply(d[0])}},_openMessageDialog:function(c,e,a){var f=e.type||"confirm";var b=this._getById(f);var d=this.make(f,a);this._setMessage(d,c);this._setCheckableOptions(d,f,e.checkableOptions);this._setAnswers(d,e.answers);this._setAddMessage(d,e.extraMessage,e.extraClass);d.dialog("open");if(!b){this.setFirstDialogOpen(d)}return d},_getCheckedOptions:function(b){var a={};b.find("input:checked").each(function(){a[this.name]=this.value});return a},_createMessage:function(c,b){var a=desknets.parseErrorInfo(c,b.errorNo);if(!b.type){b.type=a.level}c=a.message.replace(/\r?\n/g,"<br />");return c},_setMessage:function(c,b){var a=c.find(">.co-message>span");if(a.length<=0){a=$("<span />");$('<h3 class="co-message" />').append(a).appendTo(c)}a.html(b)},_setAddMessage:function(c,b,d){var a=c.find(">.co-submessage>span");if(!!b){if(a.length<=0){a=$("<span />");$('<div class="co-submessage" />').append(a).appendTo(c)}a.attr("class",d).html(b)}else{if(a.length>0){a.parent().remove()}}},_setCheckableOptions:function(e,g,b){if(!!b){var a=$("<ul />");for(var c in b){var f=$("<li />").appendTo(a);var d="co-option-"+g+"-"+c;$('<input type="checkbox" value="on" />').attr("id",d).attr("name",c).appendTo(f);$("<label/>").attr("for",d).html(b[c]).appendTo(f)}$('<div class="co-dialog-answers co-checkboxes" />').append(a).appendTo(e)}},_setAnswers:function(d,e){if(!!e){var a=$("<ul />");for(var b in e){var f=$("<li />").appendTo(a);var c="jco-dialog-answer-"+b;$('<input type="radio" name="answer" />').attr("id",c).val(b).appendTo(f);$("<label/>").attr("for",c).html(e[b]).appendTo(f)}$('<div class="co-dialog-answers co-radios" />').append(a).appendTo(d);a.find("input").eq(0).attr("checked",true)}},_getById:function(b){var a=$("#"+this._idPrefix+b);if(a.length>0){return a.children(".ui-dialog-content")}return null},_getActualOptions:function(a){var b={autoOpen:false};$.extend(b,this._dialogOptions,a);if($.type(b.zIndex)=="undefined"){b.zIndex=b.modal?4000:1000}return b},_reflectBeforeStyle:function(c){var a=c.find(".co-colon");var b=c.find(".co-required");a.attr("class","");b.attr("class","");setTimeout(function(){a.attr("class","co-colon");b.attr("class","co-required")},1)}};desknets.dateTime={current:new Date(2000,0,1),_dtTimer:null,init:function(){var a=this;var b=DNNEO.neo.dateTime.parse($("#jco-servertime").val());if(!!b){a.setDateTime(b);$(document).bind("ajaxComplete",function(d,e,c){a._updateWithServerTime(e)})}},setDateTime:function(a){var b=this.current;this.current=a;this._updateDateTimeAtNextMinute(a);if(DNNEO.neo.dateTime.compareOn(b,a,"minute")!=0){$(document).trigger("minuteChanged.desknets")}},moveDate:function(b,c){var a=DNNEO.neo.dateTime.parse(b);if(a==null){return null}a=DNNEO.neo.dateTime.moveDate(a,Number(c));return DNNEO.neo.dateTime.format("yyyyMMdd",a)},moveMonth:function(b,a){b=String(b).substr(0,6);return this.computeMonth(b,a)},computeMonth:function(c,a){var b=DNNEO.neo.dateTime.parse(String(c));if(b==null){return null}b=DNNEO.neo.dateTime.moveMonth(b,Number(a));return DNNEO.neo.dateTime.format("yyyyMMdd",b)},formatDate:function(c,b){var d=desknets.Resource.dateFormat;var a=desknets.dateTime.current;if($.type(b)!="date"){b=DNNEO.neo.dateTime.parse(b)}if(c=="s"&&a.getFullYear()==b.getFullYear()){d=desknets.Resource.shortDateFormat}return DNNEO.neo.dateTime.format(d,b)},formatDateTime:function(c,b){var d=desknets.Resource.dateTimeFormat;var a=desknets.dateTime.current;if($.type(b)!="date"){b=DNNEO.neo.dateTime.parse(b)}if(c=="s"&&a.getFullYear()==b.getFullYear()){d=desknets.Resource.shortDateTimeFormat}return DNNEO.neo.dateTime.format(d,b)},formatHour:function(d,c){var b="20120101"+c;var a=DNNEO.neo.dateTime.parse(b);return DNNEO.neo.dateTime.format(d,a)},dispDateTime:function(e,b){var d;if(!DNNEO.neo.isSet(e,{blank:false})){return"&nbsp;"}d=DNNEO.neo.dateTime.parse(e);if(jQuery.type(b)==="string"){return DNNEO.neo.dateTime.format(desknets.Resource[b],d)}else{var c=false;if(e.length>=12){c=true}else{if(e.length>=8){c=false}else{return"&nbsp;"}}var a={type:""};if(DNNEO.neo.isSet(b)){$.extend(a,b)}if(a.type=="list"){if(c){return desknets.dateTime.dispListDateTime("datetime",d)}else{return desknets.dateTime.dispListDateTime("date",d)}}else{if(c){b="longDateTimeFormat"}else{b="longDateFormat"}return DNNEO.neo.dateTime.format(desknets.Resource[b],d)}}},dispListDateTime:function(c,b){var d=desknets.Resource.dateFormat;var a=desknets.dateTime.current;if($.type(b)!="date"){b=DNNEO.neo.dateTime.parse(b)}if(a.getFullYear()==b.getFullYear()){if(c=="datetime"){d=desknets.Resource.shortDateTimeFormat}else{d=desknets.Resource.shortDateFormat}}else{if(c=="datetime"){d=desknets.Resource.dateTimeFormat}else{d=desknets.Resource.dateFormat}}return DNNEO.neo.dateTime.format(d,b)},_updateDateTimeAtNextMinute:function(c){var b=this;var a=(60-c.getSeconds())*1000-c.getMilliseconds();var d=new Date(c.getTime()+a);if(!!b._dtTimer){clearTimeout(b._dtTimer)}b._dtTimer=setTimeout(function(){b._dtTimer=null;b.setDateTime(d)},Math.max(a,100))},_updateWithServerTime:function(c){var b=DNNEO.neo.ajax.getDataValue(c,"servertime");var a=DNNEO.neo.dateTime.parse(String(b));if(!!a){this.setDateTime(a)}},};desknets.tmpl={replaceWordChk:function(c,b,a){if(DNNEO.neo.isSet(a)){return this.replaceWord(c,b,a)}else{return this.replaceWord(c,b,"")}},replaceWordChkHtml:function(c,b,a){if(DNNEO.neo.isSet(a)){return this.replaceWordHtml(c,b,a)}else{return this.replaceWordHtml(c,b,"")}},replaceWordLF:function(a,b,c){c=this.escapeWordLF(c);return this.replaceWordHtml(a,b,c)},replaceWord:function(a,b,c){c=this.escapeWord(c);return this.replaceWordHtml(a,b,c)},replaceWordHtml:function(a,c,d){var b=new RegExp("{{"+c+"}}","ig");return a.replace(b,function(e,f,g){return d})},escapeWord:function(a){if(typeof a=="string"){a=desknets.escape(a);a=desknets.escapeValue(a);a=desknets.escapeSpace(a)}return a},escapeWordLF:function(a){a=this.escapeWord(a);a=a.replace(/\r\n/g,"<br />");a=a.replace(/(\n|\r)/g,"<br />");return a},dispStr:function(a){var b;if(DNNEO.neo.isSet(a,{blank:false})){b=desknets.tmpl.escapeWordLF(a)}else{b="&nbsp;"}return b},dispItems:function(i,n,d,e,c){var g="";var j=[];var h=[];if(!i||!i.item){return"&nbsp;"}j=desknets.ajax.getItems(i.item);if(j.length==0){return"&nbsp;"}if(n!=undefined){if(!(!n||!n.item)){h=desknets.ajax.getItems(n.item)}}for(var m=0;m<j.length;m++){var o="";var l="";var b=j[m];if(m!=0){if(c==undefined){o=",&#x0A;"}else{o=c}}if(b.val!=undefined){l=desknets.tmpl.escapeWord(b.val)}o=o+l;if(h.length>m){var f="";var a=h[m];if(a.val){f=desknets.tmpl.escapeWord(a.val)}if(f.length>0){if(d){var k=desknets.tmpl.replaceWordChkHtml(d,e,f);o=o+k}else{o=o+"("+f+")"}}}g=g+o}return g},dispMember:function(a){if(neo.isSet(a,{blank:false})){return desknets.tmpl.replaceWord(desknets.Resource.members,"members",a)}else{return"&nbsp;"}},CreateNameDelimValueHtml:function(a,b){return(a+" : "+b)},CreateNameDelimValue:function(a,b){return this.escapeWordLF(a+"&nbsp;:&nbsp;"+b)}};$.extend(desknets.tmpl,{_templates:{},load:function(a,c,e,d){var b=this;var g;function f(h){a.html(h);if(typeof(e)=="function"){e()}}if(!!b._templates[c]){f(b._templates[c]);return}g={dataType:desknets.ajax.RESTYPE_HTML,type:"GET",url:desknets.getUrl(desknets.MODULE_HTML_MAIN),data:{cmd:desknets.CMD_TMPLHTML,html:c,fldlang:desknets.Resource.code,v:desknets.CACHE_VERSION},allowCacheTempl:false,allowCsrfTempl:false,success:function(j){var h=desknets.ajax.chkAjaxHtmlError(j);if(h.status=="ok"){if(!!d&&!!d.cache){b._templates[c]=j}f(j)}else{var i=desknets.dialog.alert(h.message,{errorNo:h.no})}}};if(!!d&&typeof d.error=="function"){g.error=function(j,h,i){d.error(j,h,i)}}desknets.ajax.rest(g)}});desknets.htmlparts={setSelectOption:function(b,g,c,i,j){var k=[];var d=0;var h;var f=null;var a=$.extend({tval:null,tstr:null,bval:null,bstr:null},j);if(!b.is("select")){return}if(DNNEO.neo.isSet(g)){d=g.length}if(DNNEO.neo.isSet(a.selected)){for(h=0;h<d;h++){var e=g[h];if(e[c]==a.selected){f=e[c];break}}}if(f==null&&DNNEO.neo.isSet(a.selected)&&DNNEO.neo.isSet(a.bstr,{blank:false})){if(a.bval==a.selected){f=a.bval}}if(DNNEO.neo.isSet(a.tstr,{blank:false})){if(f==null){f=a.tval}k[k.length]=this._getSelectTag(a.tval,a.tstr,f)}for(h=0;h<d;h++){var e=g[h];if(f==null){f=e[c]}k[k.length]=this._getSelectTag(e[c],e[i],f)}if(DNNEO.neo.isSet(a.bstr,{blank:false})){if(f==null){f=a.bval}k[k.length]=this._getSelectTag(a.bval,a.bstr,f)}b.html(k.join(""))},addStripeClass:function(b,c){if(desknets.browser.msie8){var a=b.children();a.removeClass(c);a.filter(":nth-child(even)").addClass(c)}},addLastClass:function(a,b){if(desknets.browser.msie8){a.children(":last").addClass(b)}},removeLastClass:function(a,b){if(desknets.browser.msie8){a.children(":last").removeClass(b)}},convertHrefInText:function(a){var b=Number(desknets.pageframe.getLoginMailLink());a.detectHref({convertMail:b>0,urlSchemas:["http","https","ftp"]});if(b>0){desknets.htmlparts.setUpMailLink(a)}},setUpForm:function(a,b){var c={required:false};if(desknets.browser.tablet){a.find("input[type=date]").prop("readOnly",true)}if(!!b){$.extend(c,b)}a.formSetUp(c);a.find(".hasDatepicker").blur(function(e){if(this.value==""){var d=$(this).datepicker("option","altField");$(d).val("")}})},setUpDateNav:function(a,b){var d=a.find(".co-ymd-cur");var c=d.data("date");d.removeData("date").removeAttr("data-date");d.click(function(f){f.preventDefault();var e=desknets.dateTime.current;if(c=="thisMonth"){e=new Date(e.getFullYear(),e.getMonth(),1)}a.neoDateNav("date",e)});a.neoDateNav($.extend({date:desknets.dateTime.current},b))},setUpMailLink:function(b){function a(g){var e=desknets.pageframe.getLoginMailLink();if(e=="2"||e=="3"){var h=String(this.href).substring(7);var d=h;var c=d.indexOf("?");if(c>=0){d=d.substring(0,c)}if(h.indexOf("?")==-1){h+="?"}if(h[h.length-1]!="?"&&h[h.length-1]!="&"){h+="&"}h=h+"to="+d;var f=desknets.splitParam(desknets.unescape(h));if(e=="2"){desknets.webmail.openMailEdit(f)}else{desknets.webmailimap.openMailEdit(f)}g.preventDefault()}}if(b.is('a[href^="mailto:"]')){b.click(a)}else{b.find('a[href^="mailto:"]').click(a)}},_getSelectTag:function(d,a,c){var b;if(c==d){b='<option value="'+d+'" selected="selected">'}else{b='<option value="'+d+'">'}a=desknets.tmpl.escapeWord(a);b=b+a+"</option>";return b}};desknets.attach={options:{dropFilesLimit:10,totalSizeLimit:0,existSize:0,previewFileTypes:/^image\/(gif|jpeg|png)$/,previewFileExtension:/(.gif|.jpg|.png|.jpeg|.bmp)$/i,previewMaxWidth:41,previewMaxHeight:50,previewAsCanvas:true,uploadURL:"http://192.168.210.104/cgi-bin/newdd/upload.cgi",uploadParams:{cmd:"cmd",id:"id",folder:"folder"},icon:{".xls":"/newdd/images_sample/doc/ic_sample_filetype1.gif",".xlsx":"/newdd/images_sample/doc/ic_sample_filetype2.gif",".txt":"/newdd/images_sample/doc/ic_sample_filetype2.gif",".png":"/newdd/images_sample/doc/png.png",".jpg":"/newdd/images_sample/doc/co_ext_jpg.png",none:"/newdd/images_sample/doc/none.png"},file:{tmpnm:"",files:{}},flashObjectURL:DENBUN_DOC_ROOT+"/dneores/objects/uploader.swf",fileSelMsgColorNormal:"#0000FF",fileSelMsgColorEnter:"#FF0000",dragColorNormal:"#E6E6E6",dragColorEnter:"#6495ed",templ:{dialog:'<div class="co-pop-body" id="jco-attachdlg">  <div class="co-pop-tp-meta">    <input class="co-pop-tp-clear-btn" type="button" value="{{deleteAll}}" disabled="disabled">    <input type="button" disabled="disabled" value="{{cancelAllUpload}}" class="co-pop-tp-stop-btn">  </div>  <div class="co-pop-tp-file">    <div class="co-pop-tp-drop">    </div>    <div class="co-pop-tp-drop-bottom">      <div class="co-pop-tp-drop-bottom-msg">            <span class="co-pop-tp-drop-msg" style="display: none;">              {{dropHere}}            </span>            <span class="co-pop-tp-choose-link" style="display: none;">              <label for="ifiles">{{clickFileSelect}}</label><br>            </span>      </div>    </div>  </div>  <div class="co-pop-tp-console">    <div class="co-pop-tp-console-msg">      {{uploadMsg}}    </div>  </div><!-- #co-pop-tp-console --></div>',area:'<div class="co-pop-tp-file-drop edit">  <div class="co-pop-tp-meta">    <input class="co-pop-tp-clear-btn" type="button" value="{{deleteAll}}" disabled="disabled">    <input class="co-pop-tp-stop-btn" type="button" value="{{cancelAllUpload}}"  disabled="disabled">  </div><!-- #co-pop-tp-meta -->  <div class="co-pop-tp-file">    <div class="co-pop-tp-drop">      <div class="co-pop-tp-def-msg demo-start">        <div class="co-pop-tp-drop-msg">        {{dropHere}}<br />        </div>        <span class="co-pop-tp-choose-link">          <label for="ifiles">{{clickFileSelect}}</label>          <input type="file" id="ifiles" size="299" multiple />        </span>      </div>    </div><!-- .co-pop-tp-drop -->    <div class="co-pop-tp-drop-bottom">      <div class="co-pop-tp-drop-bottom-msg">            <span class="co-pop-tp-drop-msg">              {{dropHere}}            </span>            <span class="co-pop-tp-choose-link">              <label for="ifiles">{{clickFileSelect}}</label><br>            </span>      </div>    </div>  </div><!-- .co-pop-tp-file -->  <div class="co-pop-tp-console">    <div class="co-pop-tp-console-msg">      {{uploadMsg}}    </div>  </div><!-- #co-pop-tp-console --></div>',detail:'<div class="co-pop-tp-file-dtl">  <div title="{{filename}}" class="co-pop-tp-file-name">{{filename}}</div>  <div class="co-pop-tp-file-size">    <div class="co-pop-tp-file-size-in">      {{filesize}}    </div>  </div>  <a href="#" class="co-pop-tp-file-del" title="{{release}}">{{delete}}</a></div>',btmMsg:'<div class="co-pop-tp-drop-bottom">  <div class="co-pop-tp-drop-bottom-msg">        <span class="co-pop-tp-drop-msg">          {{dropHere}}        </span>        <span class="co-pop-tp-choose-link">          <label for="ifiles">{{clickFileSelect}}</label><br>        </span>  </div></div>',topMsg:'<div class="co-pop-tp-console-msg">{{uploadMsg}}</div>',dropMsg:'<div class="co-pop-tp-def-msg demo-start">  <div class="co-pop-tp-drop-msg">  {{dropHere}}<br>  </div>  <span class="co-pop-tp-choose-link">    <label for="ifiles">{{clickFileSelect}}</label>  </span></div>',flashInput:'<INPUT name="s_attach" type="submit" value="{{attach}}">',flashDropMsg:'<div class="co-pop-tp-drop-msg">{{selectFromButton}}</div>',flashDropMsgOrg:'<div class="co-pop-tp-drop-msg">{{dropHere}}<br /></div>',flashBtmMsg:'<div class="co-pop-tp-drop-bottom">  <div class="co-pop-tp-drop-bottom-msg">        <span class="co-pop-tp-drop-msg">          {{selectFromButton}}        </span>  </div></div>',uploadMsg:"{{filenum}}/{{totalfilenum}}{{fileUpload}} ({{totalfilesize}})"},attResource:null,msgPrefix:"att_",allowOverlapFile:false,enableSoftAbort:false,enableCancelOnClose:true,},debug:0,dialog:$(document),dropArea:$(document),autoUpload:true,tmpnm:"",totalSize:0,totalUploadSize:0,totalFileNum:0,totalUploadNum:0,jqXHR:"",abort:false,fileInput:{},dragEnter:false,inputDisabled:"",flashAttachElement:null,confirmDialog:null,normalElements:{},closeFunction:function(){},uploadNowDialog:$(document),ipadFileName:"ipadimg",ipadFileNo:0,uploadDialog:function(i){var g=this;this.totalSize=0;this.totalUploadSize=0;this.totalFileNum=0;this.totalUploadNum=0;var b;if(i.file!=undefined&&i.file.files!=undefined){this._ipadInitFileName(i.file.files)}$.extend(this.options,i);var f={title:g._getLcString("dialogTitle"),width:600,close:function(j){$("#jco-attachdlg").remove()},buttons:{}};var h=this._makeDialog();var d={tmpnm:"",files:new Array()};this.autoUpload=false;f.buttons[desknets.Resource.OKButtonLabel]=function(){var j=this;g._setDialogDisabled(g.dialog);g._disableFileAppend();var l=g._getUploadFile();if(l!=undefined){var k=$(l).data("file");$(l).data("sending",true);g._send(l,$(l).data("attachdisp"),k)}else{if(g.flashAttachElement!=null){if(!g._getExistFile()){b=g._getLcMessage("att_file_select");desknets.dialog.alert(b);g._clearDialogDisabled(g.dialog);$(".co-pop-tp-stop-btn").attr("disabled","disabled");if($(".co-pop-tp-file-thumbs>li").size()==0){$(".co-pop-tp-clear-btn").attr("disabled","disabled")}g._enableFileAppend()}else{g._doneUploadDialog()}}else{if(!g._getExistFile()){b=g._getLcMessage("att_file_select");desknets.dialog.alert(b);g._clearDialogDisabled(g.dialog);$(".co-pop-tp-stop-btn").attr("disabled","disabled");if($(".co-pop-tp-file-thumbs>li").size()==0){$(".co-pop-tp-clear-btn").attr("disabled","disabled")}g._enableFileAppend()}else{g._doneUploadDialog()}}}return};this.closeFunction=function(m){var k=this;var j=$(".co-pop-tp-flash-mode-change-btn");if(j.data("progress")!=undefined){desknets.attach._console("uploadDialog closeFunction modeBtn != undefined");return false}g._setDialogDisabled(g.dialog);g._disableFileAppend();if($(".co-pop-tp-file-thumbs>li").size()!=0){b=g._getLcMessage("att_close_dialog");var l=desknets.dialog.confirm(b,function(){g.confirmDialog=k;$(".co-pop-tp-file").data("close",true);$(l).dialog("close");if(g.options.enableCancelOnClose==false){g._doneUploadDialog()}else{g._someDeleteAttachFile()}},{cancel:function(){g._clearDialogDisabled(g.dialog);$(".co-pop-tp-stop-btn").attr("disabled","disabled");if($(".co-pop-tp-file-thumbs>li").size()==0){$(".co-pop-tp-clear-btn").attr("disabled","disabled")}g._enableFileAppend()}})}else{if(g.flashAttachElement!=null){if($(".co-pop-tp-file-thumbs>li").size()!=0){g._setDialogDisabled(g.dialog);b=g._getLcMessage("att_close_clear");var l=desknets.dialog.confirm(b,function(){g.confirmDialog=k;$(".co-pop-tp-file").data("close",true);$(l).dialog("close");if(g.options.enableCancelOnClose==false){g._doneUploadDialog()}else{g._someDeleteAttachFile()}},{cancel:function(){g._clearDialogDisabled(g.dialog);$(".co-pop-tp-stop-btn").attr("disabled","disabled");if($(".co-pop-tp-file-thumbs>li").size()==0){$(".co-pop-tp-clear-btn").attr("disabled","disabled")}g._enableFileAppend()}})}else{g._destroy();$(this).dialog("close");return true}}else{g._destroy();$(this).dialog("close");return true}}return false};if(g.options.enableCancelOnClose==false){f.buttons[desknets.Resource.CloseButtonLabel]=this.closeFunction}else{f.buttons[desknets.Resource.CancelButtonLabel]=this.closeFunction}var c=desknets.dialog.getDialogOption();$.extend(c,f);this.dialog=desknets.dialog.setUp($(h),c);this.dialog.dialog("open");var e=this.dialog.parent();e.find(".ui-icon-closethick").bind("click",f.buttons[desknets.Resource.CancelButtonLabel]);this._appendDropMessage();g._changeTopMessage(0);this._hoverDropMessage();if(!window.File){$(".co-pop-tp-drop-msg").hide()}this.dropArea=$(".co-pop-tp-file");this._initEventHandlers();if(!window.File&&g.options.allowOverlapFile==false){g._flashAddModeChangeButton();var a=$.cookie(desknets.COOKIENAME_ATTACH_IE_FLASH);if(a==null||a=="flash"){this._flashModeChange()}else{g._flashSetModeChangeButton("flash")}}if(i.file!=undefined){g.options.existSize=0;$.each(i.file.files,function(j){g.options.existSize+=this.size})}if(i.file!=undefined&&i.file.tmpnm!=undefined){if(i.file.tmpnm==""){this.tmpnm==""}else{this.tmpnm=i.file.tmpnm}}$(".co-pop-tp-stop-btn").attr("disabled","disabled");this._hoverDropMessage()},_doneUploadDialog:function(){var a={tmpnm:this.tmpnm,files:new Array()};var b=$(".co-pop-tp-file-thumbs>li.end");$.each(b,function(c){var d=$(this).data("response");if(d!=undefined){a.files[c]=d;a.files[c]["overwrite"]=$(this).data("overwrite")}else{a.files[c]={attachdisp:$(this).data("attachdisp"),size:$(this).data("size"),fno:$(this).data("fno"),overwrite:$(this).data("overwrite")}}});this.options.done(a);this._destroy();$(this.dialog).dialog("close")},_console:function(a){if(desknets.attach.debug){if(window.console){console.log(a)}}},upload:function(b){var e=this;this.totalSize=0;this.totalUploadSize=0;this.totalFileNum=0;this.totalUploadNum=0;if(b.file!=undefined&&b.file.files!=undefined){this._ipadInitFileName(b.file.files)}$.extend(this.options,b);var a=this._makeDropArea();$(b.fileDrop).append(a);if(!window.File){$(".co-pop-tp-drop-msg").hide()}this.dropArea=$(".co-pop-tp-file");this._initEventHandlers();$(".co-pop-tp-stop-btn").hide();this._removeButtomMessage();this.attachInput();if(this.options.file.tmpnm!=undefined){if(this.options.file.tmpnm==""){this.tmpnm==""}else{this.tmpnm=this.options.file.tmpnm}}var d;if(b.file!=undefined){$.each(b.file.files,function(g){if(this.updtime==undefined){this.updtime=desknets.createRandomId()}var f=e._getDownloadUrl(b.downloadURL,this.fno,this.attachdisp,this.updtime);d={name:this.attachdisp,fname:this.attachdisp,size:this.size,fno:this.fno,updtime:this.updtime,srcUrl:f};e._addFile(d,true);e._changeTopMessage(this.size)})}if(this.fileInput===undefined){this.fileInput=$("#ifiles")}else{if(!this.fileInput){this.fileInput=$()}}this.autoUpload=true;$(".co-pop-tp-stop-btn").attr("disabled","disabled");this._hoverDropMessage();this._setDropMessage();this._changeTopMessage(0);if(!window.File&&e.options.allowOverlapFile==false){e._flashAddModeChangeButton();var c=$.cookie(desknets.COOKIENAME_ATTACH_IE_FLASH);if(c==null||c=="flash"){this._flashModeChange()}else{e._flashSetModeChangeButton("flash")}}},getAttachFileInfo:function(){var a={tmpnm:"",files:new Array()};a.tmpnm=this.tmpnm;var b=$(".co-pop-tp-file-thumbs>li");$.each(b,function(c){var d=$(this).data("response");if(d!=undefined){a.files[c]=d}else{a.files[c]={attachdisp:$(this).data("attachdisp"),size:$(this).data("size"),fno:$(this).data("fno")}}});return a},deleteAttachFile:function(b){var a=b.delURL;var c=b.delParams;if(c.tmpnm==undefined){if(this.tmpnm!=""){c.tmpnm=this.tmpnm}}else{if(c.tmpnm==""){delete c.tmpnm;this.tmpnm==""}}c.resformat="xml";desknets.ajax.rest({dataType:"xml",url:a,data:c,type:"POST",headers:{"cache-control":"no-cache"},success:function(f,d,g){var e=$(f.documentElement);var d=e.find("status").text();b.done(d)}})},getDownloadUrl:function(a){if(a.updtime==undefined){a.updtime=desknets.createRandomId()}return(this._getDownloadUrl(a.downloadURL,a.fno,a.attachdisp,a.updtime))},getThumbnailImage:function(c,b){var e=this,f;var a=$('<img alt="img">').hide().on("load",function(){e._scaleImage(this,b)});if(b!=undefined){$.extend(this.options,b)}if(c.updtime==undefined){c.updtime=desknets.createRandomId()}if(c.fname==undefined){c.fname=c.name}if(!this.options.previewFileExtension||this.options.previewFileExtension.test(this._getFileExtension(c.fname))){f=this._getDownloadUrl(c.url,c.fno,c.fname,c.updtime);$(a).attr({src:f})}else{var d=e._getFileExtension(c.fname);$.each(e.options.icon,function(g){reg=new RegExp(g+"$","i");if(reg.test(d)){f=this;return false}});if(f){$(a).attr("src",f)}else{$(a).attr({src:this.options.icon.none})}}return a},detachInput:function(){$("#ifiles").detach()},attachInput:function(){$(".co-pop-tp-choose-link:visible").append('<input type="file" id="ifiles" size="299" tabindex="-1" multiple>');if($(".co-pop-tp-file").data("disableFileAppend")==true){$("#ifiles").attr("disabled","disbled")}$("#ifiles").on("change",{attach:this},this._onChange)},_destroy:function(){this.totalSize=0;this.totalUploadSize=0;this.totalFileNum=0;this.totalUploadNum=0;this.flashAttachElement=null;this._destroyEventHandlers();$(".co-pop-tp-file-thumbs").remove();$(".co-pop-tp-drop-bottom").remove()},_makeDialog:function(){var a;a=this.options.templ.dialog;a=desknets.tmpl.replaceWord(a,"deleteAll",this._getLcString("deleteAllLabel"));a=desknets.tmpl.replaceWord(a,"cancelAllUpload",this._getLcString("cancelAllUploadLabel"));a=desknets.tmpl.replaceWord(a,"dropHere",this._getLcString("dropHereLabel"));a=desknets.tmpl.replaceWord(a,"clickFileSelect",this._getLcString("clickFileSelectLabel"));a=desknets.tmpl.replaceWord(a,"uploadMsg",this.options.templ.uploadMsg);a=desknets.tmpl.replaceWord(a,"fileUpload",this._getLcString("fileUploadLabel"));a=desknets.tmpl.replaceWord(a,"filenum","0");a=desknets.tmpl.replaceWord(a,"totalfilenum","0");a=desknets.tmpl.replaceWord(a,"totalfilesize","0 B/0 B");return a},_makeDropArea:function(){var a;a=this.options.templ.area;a=desknets.tmpl.replaceWord(a,"deleteAll",this._getLcString("deleteAllLabel"));a=desknets.tmpl.replaceWord(a,"cancelAllUpload",this._getLcString("cancelAllUploadLabel"));a=desknets.tmpl.replaceWord(a,"dropHere",this._getLcString("dropHereLabel"));a=desknets.tmpl.replaceWord(a,"clickFileSelect",this._getLcString("clickFileSelectLabel"));a=desknets.tmpl.replaceWord(a,"uploadMsg",this.options.templ.uploadMsg);a=desknets.tmpl.replaceWord(a,"fileUpload",this._getLcString("fileUploadLabel"));a=desknets.tmpl.replaceWord(a,"filenum","0");a=desknets.tmpl.replaceWord(a,"totalfilenum","0");a=desknets.tmpl.replaceWord(a,"totalfilesize","0 B/0 B");return a},_appendThumbnailArea:function(){var a;a='<ul class="co-pop-tp-file-thumbs"></ul><!-- #cab-add-filelist -->';if($(".co-pop-tp-file-thumbs").size()==0){$(".co-pop-tp-drop").append(a)}},_formatFileSize:function(a,c){if(typeof a!=="number"||a==undefined){return desknets.Resource.attachInvSize}var b=desknets.attachDisp.getSize(a);if(b=="NaN GB"){return desknets.Resource.attachInvSize}if(c!=undefined){b=b.replace(/\s/g,"")}return b},_appendThumbnail:function(c,i,e,d){var f=this;var h=f.options.templ.detail;var k=f._getLcString("uploadMsg");var b;desknets.attach._console("_appendThumbnail file.name="+c.name);desknets.attach._console("_appendThumbnail exist="+i);if(c.fname==undefined){c.fname=c.name}if(c.fname==undefined){b=c.name}else{b=c.fname}var j=$('<li class="load"></li>');$(j).css("display","inline-block").data("attachdisp",b).data("size",c.size).data("updtime",c.updtime).data("file",c).data("fileInput",e);if(c.overlap!=undefined){$(j).data("overwrite",true)}if(d!=undefined){$(j).data("overwriteFile",d)}h=desknets.tmpl.replaceWord(h,"filename",b);if(c.size==undefined){h=desknets.tmpl.replaceWord(h,"filesize",k)}else{h=desknets.tmpl.replaceWord(h,"filesize",this._formatFileSize(c.size))}h=desknets.tmpl.replaceWord(h,"release",f._getLcString("releaseLabel"));h=desknets.tmpl.replaceWord(h,"delete",f._getLcString("deleteLabel"));var g=i;if(i!=undefined){$(j).data("exist",true);$(j).data("fno",c.fno)}var a=$('<div class="co-pop-tp-file-thumbnail"></div>');f._loadImage(c,function(l){$(l).css("line-height","0");$(l).css("vertical-align","middle");$(a).append(l);$(j).append(a);$(j).append(h);if(g!=undefined){$(".co-pop-tp-file-size-in",j).css("width","100%")}else{$(".co-pop-tp-file-size-in",j).css("width","0%")}$(j).hide().appendTo(".co-pop-tp-file-thumbs:last").css("display","inline-block").fadeIn();$(j).find(".co-pop-tp-file-del").css("cursor","not-allowed");$(".co-pop-tp-file-del",j).on("click",{attach:f},f._deleteAttachFile);if(f.autoUpload&&g==undefined){f._uploadFile()}else{if(f.autoUpload&&g!=undefined){$("img",j).wrap('<a target="attach" href="'+c.srcUrl+'"></a>');$(j).addClass("end");$(j).removeClass("load");f._enableFileAppend()}else{f._enableFileAppend()}}},{maxWidth:f.options.previewMaxWidth,maxHeight:f.options.previewMaxHeight,fileTypes:f.options.previewFileTypes,fileExtension:f.options.previewFileExtension,canvas:f.options.previewAsCanvas,icon:f.options.icon},i)},_removeButtomMessage:function(){var a=$(".co-pop-tp-drop-bottom-msg");$(".co-pop-tp-drop-msg",a).fadeOut().hide();$(".co-pop-tp-choose-link",a).fadeOut().hide();this.detachInput()},_appendBottomMessage:function(){var b;var a=this;var c=$(".co-pop-tp-drop-bottom-msg");if(a.flashAttachElement==null){b=a.options.templ.btmMsg;b=desknets.tmpl.replaceWord(b,"dropHere",a._getLcString("dropHereLabel"));b=desknets.tmpl.replaceWord(b,"clickFileSelect",a._getLcString("clickFileSelectLabel"));if($(".co-pop-tp-drop-msg",c).length&&$(".co-pop-tp-choose-link",c).length){if($(".co-pop-tp-drop-msg",c)[0].style.display=="none"&&$(".co-pop-tp-choose-link",c)[0].style.display=="none"){$(".co-pop-tp-drop-msg",c).fadeIn().show();$(".co-pop-tp-choose-link",c).fadeIn().show();if(!window.File){$(".co-pop-tp-drop-msg").hide()}this.attachInput();this._hoverDropMessage()}}}else{b=a.options.templ.flashDropMsg;b=desknets.tmpl.replaceWord(b,"selectFromButton",a._getLcString("selectFromButtonLabel"));$(".co-pop-tp-drop-msg",c).remove();c.append(b)}},_changeTopMessage:function(a){var b=this;if(b.flashAttachElement!=null){return}this.totalSize+=a;if(this.totalSize<0){this.totalSize=0}if(a<0){if(this.totalFileNum>0){this.totalFileNum-=1}}else{if(a>0){this.totalFileNum+=1}}var d=b.options.templ.topMsg;d=desknets.tmpl.replaceWord(d,"uploadMsg",b.options.templ.uploadMsg);d=desknets.tmpl.replaceWord(d,"fileUpload",b._getLcString("fileUploadLabel"));d=desknets.tmpl.replaceWord(d,"filenum",String(this.totalFileNum));d=desknets.tmpl.replaceWord(d,"totalfilenum",String(this.totalUploadNum));if(!window.File){var c=this._formatFileSize(this.totalSize)}else{var c=this._formatFileSize(this.totalSize)+"/"+this._formatFileSize(this.totalUploadSize)}d=desknets.tmpl.replaceWord(d,"totalfilesize",c);$(".co-pop-tp-console-msg").fadeOut().remove();$(d).prependTo(".co-pop-tp-console");desknets.attach._console("_changeTopMessage  totalFileNum="+this.totalFileNum+" totalUploadNum="+this.totalUploadNum);desknets.attach._console("_changeTopMessage  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize)},_updateTopMessage:function(){var a=0;var c=this.options.templ.topMsg;var b=$(".co-pop-tp-file-thumbs>li");$.each(b,function(d){a+=parseInt($(this).data("size"),10)});c=desknets.tmpl.replaceWord(c,"uploadMsg",this.options.templ.uploadMsg);c=desknets.tmpl.replaceWord(c,"fileUpload",this._getLcString("fileUploadLabel"));c=desknets.tmpl.replaceWord(c,"filenum",String(b.size()));c=desknets.tmpl.replaceWord(c,"totalfilesize",this._formatFileSize(a));$(".co-pop-tp-console-msg").fadeOut().remove();$(c).appendTo(".co-pop-tp-console")},_removeDropMessage:function(){$(".co-pop-tp-def-msg").fadeOut().remove()},_appendDropMessage:function(){var b=this;$(".co-pop-tp-def-msg").fadeOut().remove();var a;if(b.flashAttachElement==null){a=b.options.templ.dropMsg;a=desknets.tmpl.replaceWord(a,"dropHere",b._getLcString("dropHereLabel"));a=desknets.tmpl.replaceWord(a,"clickFileSelect",b._getLcString("clickFileSelectLabel"))}else{a=b.options.templ.flashDropMsg;a=desknets.tmpl.replaceWord(a,"selectFromButton",b._getLcString("selectFromButtonLabel"))}if($(".co-pop-tp-def-msg").size()==0){if(b.flashAttachElement!=null){$(".co-pop-tp-drop").append('<div class="co-pop-tp-def-msg demo-start"></div>');$(".co-pop-tp-def-msg").append(a)}else{$(".co-pop-tp-drop").append(a)}if(!window.File){if(b.flashAttachElement==null){$(".co-pop-tp-drop-msg").hide()}}if(b.flashAttachElement==null){this.attachInput();this._hoverDropMessage()}}b._setDropMessage()},_hoverDropMessage:function(){var a=this;$(".co-pop-tp-choose-link").hover(function(){if($(".co-pop-tp-file").data("disableFileAppend")!=true){a._changeDropMessageColorEnter()}},function(){a._changeDropMessageColorNormal()})},_changeDropMessageColorEnter:function(){$(".co-pop-tp-choose-link").css("color",this.options.fileSelMsgColorEnter).css("text-decoration","none")},_changeDropMessageColorNormal:function(){$(".co-pop-tp-choose-link").css("color",this.options.fileSelMsgColorNormal).css("text-decoration","underline")},_getTargetByFileName:function(c){var a=$(".co-pop-tp-file-thumbs>li");var b;$.each(a,function(d){if($(this).data("attachdisp")==c){b=this;return false}});return b},_flashAppendThumbnail:function(f){var i=this,b;var c;var m;var j=i.options.templ.detail;if(f.fname==undefined){f.fname=f.name}var l=i._getTargetByFileName(f.fname);if(l){return}var k=$('<li class="load"></li>');$(k).css("display","inline-block").data("attachdisp",f.fname).data("size",f.size).data("updtime",f.updtime).data("file",f);$.each(i.options.file.files,function(n){c=this.attachdisp;m=i._getTargetByFileName(c);if(m==undefined){if(c==f.fname){$(k).data("overwrite",true);return false}}});j=desknets.tmpl.replaceWord(j,"filename",f.fname);j=desknets.tmpl.replaceWord(j,"filesize",this._formatFileSize(f.size));j=desknets.tmpl.replaceWord(j,"release",i._getLcString("releaseLabel"));$(k).data("fno",f.fno);$(k).data("exist",true);var a=$('<div class="co-pop-tp-file-thumbnail"></div>');var g=desknets.createRandomId();$(k).data("updtime",g);f.srcUrl=this._getDownloadUrl(this.options.downloadURL,f.fno,f.fname,g);var h=$('<img alt="img">').hide().on("load",function(){i._scaleImage(this,i.options)});if(!this.options.previewFileExtension||this.options.previewFileExtension.test(this._getFileExtension(f.fname))){$(h).hide().attr("src",f.srcUrl).on("load",function(){i._scaleImage(this,i.options)})}else{var e;var d=i._getFileExtension(f.fname);$.each(i.options.icon,function(n){e=new RegExp(n+"$","i");if(e.test(d)){b=this;return false}});if(b){$(h).attr("src",b)}else{$(h).attr({src:i.options.icon.none})}}$(h).css("line-height","0");$(h).css("vertical-align","middle");$(a).append(h);$(h).wrap('<a target="attach" href="'+f.srcUrl+'"></a>');$(k).append(a);$(k).append(j);$(".co-pop-tp-file-size-in",k).css("width","100%");$(k).hide().appendTo(".co-pop-tp-file-thumbs:last").css("display","inline-block").fadeIn();$(k).addClass("end");$(k).removeClass("load");$(".co-pop-tp-file-del",k).on("click",{attach:i},i._deleteAttachFile);i._enableFileAppend()},flashAddFile:function(a){this._removeDropMessage();this._appendBottomMessage();this._appendThumbnailArea();this._flashAppendThumbnail(a);modeChangeMsg=$(".co-pop-tp-console>.co-msg");if(modeChangeMsg.length>0){modeChangeMsg.remove();$(document).off("click",".co-pop-tp-flash-mode-change-btn")}},_addFile:function(b,c,e){desknets.attach._console("_addFile  filename="+b.name+" overlap="+b.overlap);var d=this;var g;var a;if(b.fname==undefined){a=b.name}else{a=b.fname}if(b.overlap==true){g=this._getTargetByFileName(a);if(g==undefined){if(this.autoUpload==false){this._removeDropMessage();this._appendBottomMessage();this._appendThumbnailArea();this._appendThumbnail(b,c,e);this.totalUploadNum+=1;this.totalUploadSize+=b.size;desknets.attach._console("4  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize);this._changeTopMessage(0)}}else{this.totalUploadNum-=1;this.totalUploadSize-=$(g).data("size");desknets.attach._console("3  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize);if(this.autoUpload!=false){d.totalSize-=$(g).data("size");d.totalFileNum-=1}var f=$(g).data("file");this._removeFile(g);this._removeDropMessage();this._appendBottomMessage();this._appendThumbnailArea();this._appendThumbnail(b,c,e,f);this.totalUploadNum+=1;this.totalUploadSize+=b.size;desknets.attach._console("1  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize);this._changeTopMessage(0)}}else{this._removeDropMessage();this._appendBottomMessage();this._appendThumbnailArea();this._appendThumbnail(b,c,e);this.totalUploadNum+=1;this.totalUploadSize+=b.size;desknets.attach._console("2  totalSize="+this.totalSize+" totalUploadSize="+this.totalUploadSize);if(this.autoUpload==false){this._changeTopMessage(0)}}},_normalizeFile:function(a,b){if(b.name===undefined&&b.size===undefined){b.name=b.fileName;b.size=b.fileSize}else{if(b.fileName===undefined&&b.fileSize===undefined){b.fileName=b.name;b.fileSize=b.size}}},_removeZeroFile:function(d,c){var b=this;var f,a=0,e;var g=$.map(d,function(h,i){if(h.size==0){if(!a){if(h.fname==undefined){e=h.name}else{e=h.fname}}a+=1;return null}else{return h}});if(a){f=b._getLcMessage("att_filesize_zero");if(a>1){e=e+b._getLcMessage("att_other_files");e=desknets.tmpl.replaceWord(e,"num",String(a-1))}f=desknets.tmpl.replaceWord(f,"filenames",e);desknets.dialog.alert(f,function(){b._checkOverlapFile(g)});if(a==d.length){if(b.options.afterUpload!=undefined&&typeof b.options.afterUpload=="function"){b.options.afterUpload()}b._enableFileAppend()}}else{b._checkOverlapFile(g,c)}},_checkOverlapFile:function(d,i){var k=this;var f,j=0,l;var e,g,m,h,c;var b;if(k.options.allowOverlapFile==true){k._totalSizeCheck(d,i);return}$.each(d,function(n){if(this.fname==undefined){b=this.name}else{b=this.fname}m=k._getTargetByFileName(b);if(m!=undefined){e=$(m).data("attachdisp");if(e==b){this.overlap=true;if(!j){l=b}j+=1}else{if(this.overlap==undefined){this.overlap=false}}}});if(k.autoUpload==false){$.each(k.options.file.files,function(n){e=this.attachdisp;c=this.fno;m=k._getTargetByFileName(e);if(m!=undefined){return false}else{$.each(d,function(o){if(this.fname==undefined){b=this.name}else{b=this.fname}if(e==b){this.overlap=true;this.overlapfno=c;if(!j){l=b}j+=1}})}})}if(!j){k._totalSizeCheck(d,i);return}if(j>1){f=k._getLcMessage("att_overlap_file_multi");f=desknets.tmpl.replaceWord(f,"num",String(j));l=l+k._getLcMessage("att_other_files");l=desknets.tmpl.replaceWord(l,"num",String(j-1))}else{f=k._getLcMessage("att_overlap_file_single");l=l}f=desknets.tmpl.replaceWord(f,"filenames",l);var a=desknets.dialog.confirm(f,function(){k._totalSizeCheck(d,i)},{cancel:function(){if(k.options.afterUpload!=undefined&&typeof k.options.afterUpload=="function"){k.options.afterUpload()}k._enableFileAppend()}})},_getEntryTotalSize:function(d){var g=this;var j=$(".co-pop-tp-file-thumbs>li");var h=0;var b=0;var i,e;var f=d;var a;var c;$.each(j,function(k){e=$(this).data("attachdisp");i=0;$.each(f,function(l){if(this.fname==undefined){a=this.name}else{a=this.fname}if(a==e){b+=this.size;return false}});h+=$(this).data("size")});if(g.autoUpload==false){$.each(g.options.file.files,function(k){e=this.attachdisp;c=this.fno;j=g._getTargetByFileName(e);if(j==undefined){$.each(f,function(l){if(e==this.fname){b+=this.size;return false}});h+=this.size}})}h-=b;return h},_totalSizeCheck:function(e,d){var c=this;var f;var b=0;$.each(e,function(g){b+=this.size});var a=this._getEntryTotalSize(e);if(a+b>c.options.totalSizeLimit){f=c._getLcMessage("att_total_size_over");f=desknets.tmpl.replaceWord(f,"total",c._formatFileSize(a+b,true));f=desknets.tmpl.replaceWord(f,"limit",c._formatFileSize(c.options.totalSizeLimit,true));desknets.dialog.alert(f);if(c.options.afterUpload!=undefined&&typeof c.options.afterUpload=="function"){c.options.afterUpload()}c._enableFileAppend();return}if(this.autoUpload==true){c._showUploadNowDialog()}setTimeout(function(){c._launchAddFile(e,d)},0)},_launchAddFile:function(c,b){var a=this;var d;$.each(c,function(e){if(this.add==undefined){this.add=true;d=this;return false}});if(d){if(b==undefined){a._addFile(d)}else{a._addFile(d,undefined,b)}setTimeout(function(){a._launchAddFile(c,b)},0)}},_onDrop:function(g){var h;g.preventDefault();if($(".co-pop-tp-file").data("disableFileAppend")!=undefined){return}var c=g.data.attach,f=g.dataTransfer=g.originalEvent.dataTransfer;if(f.files==undefined){desknets.attach._console("_onDrop no drop files");return}var b=f.files.length;c._changeDragColorNormal();desknets.attach._console("_onDrop dataTransfer.files.length="+b);$.each(f.files,function(e){desknets.attach._console("_onDrop filename["+e+"]="+this.name)});$.each(f.files,function(e){if(desknets.browser.ipad){this.fname=c._ipadCreateFileName(this.name)}else{this.fname=c._unicodeNormalizationFormC(this.name)}});if(b==0){return}c._disableFileAppend();if(c.options.beforUpload!=undefined&&typeof c.options.beforUpload=="function"){c.options.beforUpload()}if(b>c.options.dropFilesLimit){h=c._getLcMessage("att_drop_max_over");h=desknets.tmpl.replaceWord(h,"num",String(b));h=desknets.tmpl.replaceWord(h,"max",String(c.options.dropFilesLimit));desknets.dialog.alert(h);c._enableFileAppend();if(c.options.afterUpload!=undefined&&typeof c.options.afterUpload=="function"){c.options.afterUpload()}}else{var d={files:$.each($.makeArray(f&&f.files),c._normalizeFile)};$.each(d.files,function(e){this.name=c._unicodeNormalizationFormC(this.name);this.fname=c._unicodeNormalizationFormC(this.name)});c._removeZeroFile(d.files)}var a=c._getUploadStatus()},_onDragOver:function(c){if(!window.File){c.preventDefault();return}var a=c.data.attach,b=c.dataTransfer=c.originalEvent.dataTransfer;if(b){if($(".co-pop-tp-file").data("disableFileAppend")!=undefined){if(b.dropEffect.effectAllowed!=undefined){b.dropEffect=b.effectAllowed="none"}else{b.dropEffect="none"}}else{if(b.dropEffect.effectAllowed!=undefined){b.dropEffect=b.effectAllowed="copy"}else{b.dropEffect="copy"}a._changeDragColorEnter()}}c.preventDefault()},_parentContains:function(b,a){if(a.parentElement==b){return true}else{if(a.parent==undefined){return false}else{this._parentContains(a.parentElement,a)}}},_onDragEnter:function(b){if(!window.File){return}var a=b.data.attach;b.stopPropagation();if($(".co-pop-tp-file").data("disableFileAppend")!=undefined){return}a._changeDragColorEnter()},_onDragLeave:function(f){if(!window.File){return}var d=f.data.attach,a;f.stopPropagation();if(f.originalEvent.clientX==0&&f.originalEvent.clientY==0){d._changeDragColorNormal()}var c=$(".co-pop-tp-file")[0];var b=$(".co-pop-tp-file").offset();if(f.originalEvent.clientX<(b.left-window.scrollX)||f.originalEvent.clientY<(b.top-window.scrollY)||f.originalEvent.clientX>(b.left+c.clientWidth-window.scrollX)||f.originalEvent.clientY>(b.top+c.clientHeight-window.scrollY)){d._changeDragColorNormal()}if(f.clientX>=document.documentElement.clientWidth||f.clientY>=document.documentElement.clientHeight){d._changeDragColorNormal()}},_changeDragColorEnter:function(){$(".co-pop-tp-file").css("background","none repeat scroll 0 0 "+this.options.dragColorEnter)},_changeDragColorNormal:function(){$(".co-pop-tp-file").css("background","none repeat scroll 0 0 "+this.options.dragColorNormal)},_onBeforUnload:function(a){this.abort=true;return},_initEventHandlers:function(){$(document);this.dropArea.on("dragover",{attach:this},this._onDragOver);this.dropArea.on("drop",{attach:this},this._onDrop);$(".co-pop-tp-file").on("dragenter",{attach:this},this._onDragEnter);$(".co-pop-tp-file").on("dragleave",{attach:this},this._onDragLeave);$(".co-pop-tp-stop-btn").on("click",{attach:this},this._onCancel);if(this.autoUpload==false){$(".co-pop-tp-clear-btn").on("click",{attach:this},this._clickAllDeleteAttachFile)}else{$(".co-pop-tp-clear-btn").on("click",{attach:this},this._allDeleteAttachFile)}},_destroyEventHandlers:function(){this.dropArea.off("dragover");this.dropArea.off("drop");$(".co-pop-tp-file").off("dragenter");$(".co-pop-tp-file").off("dragleave");$(".co-pop-tp-file-del").off("click");$("#ifiles").off("change");$(".co-pop-tp-stop-btn").off("click");$(".co-pop-tp-clear-btn").off("click")},_scaleCanvas:function(a,c){c=c||{};var b=document.createElement("canvas"),d=Math.min((c.maxWidth||a.width)/a.width,(c.maxHeight||a.height)/a.height);if(d>=1){d=Math.max((c.minWidth||a.width)/a.width,(c.minHeight||a.height)/a.height)}a.width=parseInt(a.width*d,10);a.height=parseInt(a.height*d,10);if(!c.canvas||!b.getContext){return a}b.width=a.width;b.height=a.height;b.getContext("2d").drawImage(a,0,0,a.width,a.height);return b},_scaleImage:function(c,d){$.extend(this.options,d);$(c).off("load");if(!c.width&&!c.height){$(c).show()}var e=Math.min((this.options.previewMaxWidth||c.width)/c.width,(this.options.previewMaxHeight||c.height)/c.height);if(e>=1){e=Math.max((this.options.previewMinWidth||c.width)/c.width,(this.options.previewMinHeight||c.height)/c.height)}var b=parseInt(c.width*e,10);var a=parseInt(c.height*e,10);if(!b&&!a){b=this.options.previewMaxWidth;a=this.options.previewMaxHeight}c.width=b;c.height=a;$(c).fadeIn()},_createObjectURL:function(a){var c="undefined",b=(typeof window.createObjectURL!==c&&window)||(typeof URL!==c&&URL)||(typeof webkitURL!==c&&webkitURL);return b?b.createObjectURL(a):false},_revokeObjectURL:function(a){var c="undefined",b=(typeof window.revokeObjectURL!==c&&window)||(typeof URL!==c&&URL)||(typeof webkitURL!==c&&webkitURL);return b?b.revokeObjectURL(a):false},_loadFile:function(b,c){if(typeof FileReader!=="undefined"&&FileReader.prototype.readAsDataURL){var a=new FileReader();a.onload=function(d){c(d.target.result)};a.readAsDataURL(b);return true}return false},_getFileExtension:function(a){if(a.match(/\.([a-z\d]+$)/i)){return(a.match(/\.([a-z\d]+$)/i)[0])}},_supportCanvas:function(){return !!document.createElement("canvas").getContext},_loadImage:function(f,j,k,i){var h=this,c,b,g;var a;if(f.fname==undefined){a=f.name}else{a=f.fname}if(i!=undefined){g=$('<img alt="img">').hide().on("load",function(){h._scaleImage(this,h.options)});if(!k||!k.fileExtension||k.fileExtension.test(h._getFileExtension(a))){b=f.srcUrl}else{var e;var d=h._getFileExtension(a);$.each(k.icon,function(l){e=new RegExp(l+"$","i");if(e.test(d)){b=this;return false}});if(!b){b=k.icon.none}}$(g).attr({src:b});j(g)}else{if(f.type!=undefined&&h._supportCanvas()&&(!k||!k.fileExtension||k.fileExtension.test(h._getFileExtension(a)))&&this._createObjectURL(f)!=false){c=this._createObjectURL(f);g=$("<img>").on("load",function(){$(this).off("load");h._revokeObjectURL(c);j(h._scaleCanvas(g[0],k))});if(c){g.prop("src",c)}else{this._loadFile(f,function(l){g.prop("src",l)})}if(desknets.browser.msie){h._loadFile(f,function(l){g.prop("src",l)})}else{if(c){g.prop("src",c)}else{this._loadFile(f,function(l){g.prop("src",l)})}}}else{g=$('<img alt="img">').hide().on("load",function(){h._scaleImage(this,h.options)});var d=h._getFileExtension(a);$.each(k.icon,function(l){e=new RegExp(l+"$","i");if(e.test(d)){b=this;return false}});if(b){$(g).attr("src",b)}else{$(g).attr({src:k.icon.none})}j(g)}}},_deleteAttachFile:function(f,h){if(f!=undefined){var c=f.data.attach;f.preventDefault();var d=$(this).closest("li");if($(".co-pop-tp-file").data("disableFileAppend")==true){return}}else{var c=this;var d=h}if(c.autoUpload==false){if(c.flashAttachElement!=null){if($(d).data("overwrite")==true){var b=c._getLcMessage("att_flash_reject_delete");b=desknets.tmpl.replaceWordHtml(b,"filenames",$(d).data("attachdisp"));desknets.dialog.alert(b);return}}}delFunc=function(){c._disableFileAppend();if($(d).data("exist")==true){c._deleteFile(d)}else{var e=$(d).data("sending");if(e!=undefined){if(e==true){c.abort=true;if(c.jqXHR!=""){c.jqXHR.abort()}else{c._abort_iframe()}}}c.totalUploadNum-=1;c.totalUploadSize-=$(d).data("size");c._changeTopMessage(0);c._removeFile(d);c._enableFileAppend()}};if($(".co-pop-tp-file").data("close")==true||$(".co-pop-tp-clear-btn").data("allDelete")==true){delFunc()}else{var g=c._getLcMessage("att_del_confirm");g=desknets.tmpl.replaceWord(g,"filenames",$(d).data("attachdisp"));var a=desknets.dialog.confirm(g,delFunc)}},_deleteFile:function(l,e,i,n,j,d){desknets.attach._console("_deleteFile() fname="+d);var k=this;var c=k.options.delURL;if(k.options.beforUpload!=undefined&&typeof k.options.beforUpload=="function"){k.options.beforUpload()}var h=k.options.delParams;if(n==undefined){if(j!=undefined&&d!=undefined){$.each(k.options.file.files,function(p){if(d==this.attachdisp){h.fno=this.fno;return null}})}else{if(l==undefined){$.each(k.options.file.files,function(p){if(e.fname==this.attachdisp){h.fno=this.fno;return null}})}else{var b=$(l).data("fno");if(b!=undefined){h.fno=b}else{var f=$(l).data("file");h.fno=f.overlapfno}}}}else{delete h.fno}if(k.tmpnm!=""){h.tmpnm=k.tmpnm}h.resformat="xml";var g=l;var m=e;var a=i;var o=$(".co-pop-tp-clear-btn");desknets.ajax.rest({dataType:"xml",url:c,data:h,type:"POST",headers:{"cache-control":"no-cache"},success:function(r,p,s){desknets.attach._console("delete ajax success");if(n!=undefined&&n==true){k.totalSize=0;k.totalUploadSize=0;k.totalFileNum=0;k.totalUploadNum=0;k._changeTopMessage(0);var q=$(".co-pop-tp-file-thumbs>li");$.each(q,function(t){k._removeFile(this)});k._enableFileAppend();if(k.options.afterUpload!=undefined&&typeof k.options.afterUpload=="function"){k.options.afterUpload()}}else{if(m!=undefined&&k.autoUpload==false){$(l).data("sending",true);k._send(l,$(l).data("attachdisp"),$(l).data("file"))}else{if(j!=undefined){k.totalUploadNum-=1;k.totalUploadSize-=$(g).data("size");k._changeTopMessage(-1*$(g).data("size"));k._removeFile(g);j.resolveCurrentFile(true)}else{if(g!=undefined){k.totalUploadNum-=1;k.totalUploadSize-=$(g).data("size");k._changeTopMessage(-1*$(g).data("size"));k._removeFile(g);k._enableFileAppend();if(k.options.afterUpload!=undefined&&typeof k.options.afterUpload=="function"){k.options.afterUpload()}}}if(m!=undefined){m.overlap=false;m.overlapdel=true;if(a!=undefined){k._addFile(m,undefined,a)}else{k._addFile(m)}}}}},error:function(r,p,q){desknets.attach._console("delete ajax error xhr.status="+r.status);if($(".co-pop-tp-file-thumbs>li").size()!=0){o.removeAttr("disabled")}if(o.data("allDelete")!=undefined){o.removeData("allDelete")}k._enableFileAppend();if(k.options.afterUpload!=undefined&&typeof k.options.afterUpload=="function"){k.options.afterUpload()}if(j!=undefined){j.resolveCurrentFile(false)}if(k.abort!=true){desknets.ajax.onError(r.status,q)}}})},_flashUpdateFiles:function(e){var c=this;if(c.flashAttachElement==null){return}var b=[];var d=$(".co-pop-tp-file-thumbs>li");$.each(d,function(g){b[g]={id:$(this).data("fno"),name:$(this).data("attachdisp"),size:$(this).data("size")}});var f=$(e).data("fno");var a=$(e).data("attachdisp");c.flashAttachElement.dnUploader("deleteFile",c.flashAttachElement,f,a)},_removeFile:function(d){var c=this;c._flashUpdateFiles(d);$(d).fadeOut().remove();var b=$(".co-pop-tp-clear-btn");if($(".co-pop-tp-file-thumbs>li").size()==0){this._removeButtomMessage();this._appendDropMessage();b.attr("disabled","disabled");if(b.data("allDelete")!=undefined){b.removeData("allDelete")}var a=$(".co-pop-tp-flash-mode-change-btn");if(a.data("progress")!=undefined){c._enableFileAppend();if(a.data("progress")=="flash"){c._flashModeChange()}else{c._flashModeChangeNormal()}a.removeData("progress");c._clearDialogDisabled(c.dialog)}if($(".co-pop-tp-file").data("close")==true){$(".co-pop-tp-file").removeData("close");c._destroy();$(c.confirmDialog).dialog("close");$("#jco-attachdlg").remove()}}else{if(b.data("allDelete")!=undefined){if(this.autoUpload==false){this._someDeleteAttachFile()}}}},_allDeleteAttachFile:function(d){desknets.attach._console("_allDeleteAttachFile() ");if(d!=undefined){var b=d.data.attach}else{var b=this}var c=$(".co-pop-tp-file-thumbs>li");if(c.size()==0){return}if(b.flashAttachElement!=null){b.flashAttachElement.dnUploader("disable",b.flashAttachElement)}var f=b._getLcMessage("att_detach_all");var a=desknets.dialog.confirm(f,function(){b._ExecuteAllDeleteAttachFile(c)},{cancel:function(){if(b.flashAttachElement!=null){b.flashAttachElement.dnUploader("enable",b.flashAttachElement)}}})},_clickAllDeleteAttachFile:function(d){if(d!=undefined){var b=d.data.attach}else{var b=this}var c=$(".co-pop-tp-file-thumbs>li");if(c.size()==0){return}if(b.flashAttachElement!=null){b.flashAttachElement.dnUploader("disable",b.flashAttachElement)}var f=b._getLcMessage("att_detach_all");var a=desknets.dialog.confirm(f,function(){b._someDeleteAttachFile()},{cancel:function(){if(b.flashAttachElement!=null){b.flashAttachElement.dnUploader("enable",b.flashAttachElement)}}})},_ExecuteAllDeleteAttachFile:function(c,a){var b=this;var d=false;$.each(c,function(e){var f=$(this).data("exist");if(f!=undefined){if(f==true){d=true}}});$(".co-pop-tp-clear-btn").attr("disabled","disabled").data("allDelete",true);b._disableFileAppend();if(d==true){b._deleteFile(null,null,null,true)}else{b.totalSize=0;b.totalUploadSize=0;b.totalFileNum=0;b.totalUploadNum=0;b._changeTopMessage(0);$.each(c,function(e){b._removeFile(this)});if(a==undefined){b._enableFileAppend()}}},_someDeleteAttachFile:function(g){if(g!=undefined){var d=g.data.attach}else{var d=this}var b=$(".co-pop-tp-clear-btn");b.attr("disabled","disabled").data("allDelete",true);var f=d._getSomeDeleteTarget();if(f!=undefined){desknets.attach._console("_someDeleteAttachFile() target filename="+$(f).data("attachdisp"));if(g==undefined){desknets.attach._console("_someDeleteAttachFile() _deleteAttachFile filename="+$(f).data("attachdisp"));d._deleteAttachFile(undefined,f)}else{if(d.flashAttachElement!=null){d.flashAttachElement.dnUploader("disable",d.flashAttachElement)}var h=d._getLcMessage("att_detach_all");var c=desknets.dialog.confirm(h,function(){desknets.attach._console("_someDeleteAttachFile() _deleteAttachFile filename="+$(f).data("attachdisp"));d._deleteAttachFile(undefined,f)},{cancel:function(){b.removeData("allDelete").removeAttr("disabled");if(d.flashAttachElement!=null){d.flashAttachElement.dnUploader("enable",d.flashAttachElement)}}})}}else{b.removeData("allDelete").removeAttr("disabled");var a=$(".co-pop-tp-flash-mode-change-btn");if(a.data("progress")!=undefined){d._enableFileAppend();if(a.data("progress")=="flash"){d._flashModeChange()}else{d._flashModeChangeNormal()}a.removeData("progress");d._clearDialogDisabled(d.dialog)}if($(".co-pop-tp-file").data("close")==true){$(".co-pop-tp-file").removeData("close");d._doneUploadDialog();$("#jco-attachdlg").remove()}else{if(d.flashAttachElement!=null){d.flashAttachElement.dnUploader("enable",d.flashAttachElement)}}}},_getSomeDeleteTarget:function(){var b=this;var e=undefined;var d=undefined;var a=0;var f;var c=$(".co-pop-tp-file-del");$.each(c,function(h){var g=this.parentNode.parentElement;if($(this).data("overlap")==undefined){$.each(b.options.file.files,function(i){desknets.attach._console("_getSomeDeleteTarget() exist  filename="+this.attachdisp);desknets.attach._console("_getSomeDeleteTarget() check filename="+$(g).data("attachdisp"));if($(g).data("attachdisp")==this.attachdisp&&$(g).data("exist")==true){desknets.attach._console("_getSomeDeleteTarget() overlap !! "+this.attachdisp);if(d==undefined){d=this.attachdisp}a++;$(g).data("overlap",true)}});if($(g).data("overlap")==undefined){if(e==undefined){e=g}}}});desknets.attach._console("_getSomeDeleteTarget() num="+a);if(a>0){if(a==1){f=b._getLcMessage("att_flash_reject_cancel_single");f=desknets.tmpl.replaceWordHtml(f,"filenames",d)}else{f=b._getLcMessage("att_flash_reject_cancel_multi");f=desknets.tmpl.replaceWordHtml(f,"filenames",d);f=desknets.tmpl.replaceWordHtml(f,"num",a-1)}desknets.dialog.alert(f)}desknets.attach._console("_getSomeDeleteTarget() target="+e);if(e!=undefined){return e}else{return undefined}},_uploadFile:function(){var a=this;var b=this._getUploadFile();if(b!=undefined){$(b).data("sending",true);desknets.attach._console("_uploadFile _send="+$(b).data("attachdisp"));this._send(b,$(b).data("attachdisp"),$(b).data("file"))}return},_getUploadStatus:function(){var b=this;var a=false;var c=$(".co-pop-tp-file-thumbs>li");$.each(c,function(e){var d=$(this).data("sending");if(d!=undefined){if(d==true){a=true}}});return a},_getUploadFile:function(){var b=this;var a=false;var c=$(".co-pop-tp-file-thumbs>li");$.each(c,function(f){var e=$(this).data("sending");if(e!=undefined){if(e==true){a=true;return false}}});if(a==true){return}var d;$.each(c,function(g){var h=$(this).data("exist");if(h==undefined){var f=$(this).data("sending");var e=$(this).data("attachdisp");if(f==undefined){d=this;return false}}});return d},_getExistFile:function(){var b=this;var a=false;var c=$(".co-pop-tp-file-thumbs>li");$.each(c,function(d){var e=$(this).data("exist");if(e!=undefined){if(e==true){a=true;return false}}});return a},_send:function(d,a,b){desknets.attach._console("_send file="+a);var c="undefined";if(typeof XMLHttpRequest!==c&&typeof File!==c&&typeof FormData!==c){this._submit_ajax(d,a,b)}else{this._submit_iframe(d,a,b)}},_submit_ajax:function(h,a,d){var g=this;var b=this.options.uploadURL;desknets.attach._console("_submit_ajax file.name="+d.name);var c=new FormData();for(var k in this.options.uploadParams){c.append(k,this.options.uploadParams[k])}c.append(String($.cookie(desknets.COOKIENAME_STOKEN)),1);c.append("resformat","xml");c.append("Filename",a);if(this.tmpnm!=""){c.append("tmpnm",this.tmpnm)}c.append("attach",d);var e=h;var j=jQuery.ajaxSettings.xhr();if(j.upload){j.upload.addEventListener("progress",function(l){g._onProgress(l,g.options,e)},false)}var i=function(){return j};this.jqXHR=j;var f=$(".co-pop-tp-stop-btn");desknets.ajax.rest({xhr:i,dataType:"xml",url:b,data:c,type:"POST",headers:{"cache-control":"no-cache"},processData:false,contentType:false,success:function(m,l,n){desknets.attach._console("success");g._onSuccess(m,l,n,e)},error:function(n,l,m){desknets.attach._console("error xhr.status="+n.status);if(g.abort!=true){if(n.status=="404"){m=g._getLcMessage("att_404_errorMessage")}desknets.ajax.onError(n.status,m);f.trigger("click")}g.abort=false;g._enableFileAppend();f.attr("disabled","disabled");if(g.autoUpload==true){g.uploadNowDialog.dialog("close")}}});f.removeAttr("disabled")},_onProgress:function(f,b,d){var c=this;var h;if(f.loaded!=f.total){h=Math.round(f.loaded/f.total*100)+"%"}else{h="100%"}var a=$(".co-pop-tp-file-size-in",d);a.css("width",h);if(Math.round(f.loaded/f.total*100)>=100){if($(d).hasClass("load")){var g=c._getLcString("saveMsg");$(d).addClass("end").removeClass("load").data("fileSizeDisp",$(".co-pop-tp-file-size-in",d));a.detach();$(".co-pop-tp-file-size",d).append(g);desknets.attach._console("_onProgress over 100% sameMsg")}}},_getDownloadUrl:function(c,e,a,b){var d=c;d=desknets.tmpl.replaceWord(d,"id",e);d=desknets.tmpl.replaceWord(d,"name",encodeURIComponent(a).replace(/'/g,"%27"));d=desknets.tmpl.replaceWord(d,"updtime",b);if(this.tmpnm!=""){d=desknets.tmpl.replaceWord(d,"tmpnm",this.tmpnm)}return d},_onSuccess:function(k,j,p,m){var l=this;if($(m).hasClass("load")){$(".co-pop-tp-file-size-in",m).css("width","100%");$(m).addClass("end").removeClass("load")}$(".co-pop-tp-file-save",m).remove();$(".co-pop-tp-file-size",m).append($(m).data("fileSizeDisp"));var a=$(m).data("attachdisp");desknets.attach._console("_onSuccess filename="+$(m).data("attachdisp"));var d=$(k.documentElement);var c=d.find("fno").text();var q=d.find("size").text();var g=desknets.createRandomId();$(m).data("exist",true).removeData("sending").data("fno",c).data("size",parseInt(q,10)).data("updtime",g);var f=$(m).data("file");if(f.overlap==true){$(m).data("overwrite",true)}if(d.find("tmpnm").size()!=0){this.tmpnm=d.find("tmpnm").text()}var b=this._getDownloadUrl(this.options.downloadURL,c,a,g);f.srcUrl=b;if(!b){}else{if($("img",m).length){if(!this.options.previewFileExtension||this.options.previewFileExtension.test(this._getFileExtension(a))){var n=$("img",m).parent();$("img",m).remove();$(n).append('<img alt="img">');$("img",m).hide().attr("src",b).on("load",function(){l._scaleImage(this,l.options)})}$("img",m).wrap('<a target="attach" href="'+b+'"></a>')}else{$("canvas",m).wrap('<a target="attach" href="'+b+'"></a>')}}desknets.attach._console("_onSuccess fno  ="+d.find("fno").text());desknets.attach._console("_onSuccess size ="+d.find("size").text());desknets.attach._console("_onSuccess tmpnm="+d.find("tmpnm").text());var i={};$.each(d.children(),function(s){var r="";if(this.textContent==undefined){var r=this.text}else{var r=this.textContent}if(this.tagName!="status"){if(this.tagName=="size"){i[this.tagName]=parseInt(r,10)}else{if(this.tagName=="attachdisp"){i[this.tagName]=a}else{i[this.tagName]=r}}}});if(i.attachdisp==undefined){i.attachdisp=a}$(m).data("response",i);var e=this._formatFileSize($(m).data("size"));var o=$(".co-pop-tp-file-size-in",m);if(o.length==0){o.parent().append('<div class="co-pop-tp-file-size-in" style="width: 100%;">'+e+"</div>")}else{if(o[0].textContent==undefined){o.text(this._formatFileSize($(m).data("size")))}else{o[0].textContent=this._formatFileSize($(m).data("size"))}}this._changeTopMessage($(m).data("size"));if(l.abort==false){var h=this._getUploadFile();if(h!=undefined){$(h).data("sending",true);this._send(h,$(h).data("attachdisp"),$(h).data("file"))}else{desknets.attach._console("_onSuccess upload Complete");if(this.autoUpload==false){this._doneUploadDialog()}else{if(l.sendFileNum!=undefined){l.sendFileNum--;desknets.attach._console("_onSuccess sendFileNum="+l.sendFileNum);l.sendFileNum=undefined}}if(this.options.afterUpload!=undefined&&typeof this.options.afterUpload=="function"){this.options.afterUpload()}$(".co-pop-tp-stop-btn").attr("disabled","disabled");this._enableFileAppend();if(l.autoUpload==true){desknets.attach._console("_onSuccess uploadNowDialog close");l.uploadNowDialog.dialog("close")}}}else{l.abort=false;if(this.options.afterUpload!=undefined&&typeof this.options.afterUpload=="function"){this.options.afterUpload()}$(".co-pop-tp-stop-btn").attr("disabled","disabled");this._enableFileAppend();if(l.autoUpload==true){desknets.attach._console("_onSuccess uploadNowDialog close");l.uploadNowDialog.dialog("close")}}},_ipadCreateFileName:function(a){desknets.attach._console("_ipadCreateFileName name="+a);desknets.attach._console("_ipadCreateFileName _getFileExtension="+this._getFileExtension(a));var c=++this.ipadFileNo;if(c>9999){this.ipadFileNo=0;c=++this.ipadFileNo}var b="";if(c<10){var b="000"}else{if(c<100){var b="00"}else{if(c<1000){var b="0"}}}return(this.ipadFileName+b+c+this._getFileExtension(a))},_ipadInitFileName:function(d){var a=0;var c;var e;var b;$.each(d,function(f){var g=this.attachdisp;c=new RegExp("^ipadimg([0-9]{4})","i");if(c.test(g)){e=RegExp.$1;b=parseInt(RegExp.$1,10);desknets.attach._console("_ipadInitFileName no="+e+" cnt="+b);if(a<b){a=b}}});this.ipadFileNo=a;desknets.attach._console("_ipadInitFileName max="+a)},_onChange:function(d){var a=d.data.attach;var f;var b={files:$.each($.makeArray(d.target.files),a._normalizeFile),fileInput:$(d.target),form:$(d.target.form)};$.each(b.files,function(e){if(desknets.browser.ipad){this.fname=a._ipadCreateFileName(this.name)}else{this.fname=a._unicodeNormalizationFormC(this.name)}desknets.attach._console("_onChange fname="+this.fname)});if(!b.files.length){b.files=[{name:d.target.value.replace(/^.*\\/,"")}];b.files[0].fname=b.files[0].name}if(b.files[0].name.length==0){f=a._getLcMessage("att_illegal_filename");desknets.dialog.alert(f);return}if(b.files[0].size==undefined){}if(a.options.beforUpload!=undefined&&typeof a.options.beforUpload=="function"){a.options.beforUpload()}b.fileInput.attr("name","attach");var c=b.fileInput.parent();b.fileInput.detach();c.append('<input type="file" id="ifiles" size="299" tabindex="-1" multiple>');$("#ifiles").on("change",{attach:a},a._onChange);a._hoverDropMessage();a._disableFileAppend();b.files=a._removeZeroFile(b.files,b.fileInput);a._changeDropMessageColorNormal()},_onCancel:function(f){var b=f.data.attach;desknets.attach._console("_onCancel");b.abort=true;if(b.options.enableSoftAbort==true){}else{if(b.jqXHR!=""){b.jqXHR.abort()}else{b._abort_iframe()}}var d=0;var a=0;var c=$(".co-pop-tp-file-thumbs>li");if(b.autoUpload==true){$.each(c,function(e){if($(this).data("sending")==true){var g=$(this).data("overwriteFile");b._removeFile(this);if(g!=undefined){g.overlap=false;b._addFile(g,true);d+=1;a+=g.size}}else{if($(this).data("exist")==undefined){b._removeFile(this)}else{d+=1;a+=$(this).data("size")}}});b.totalFileNum=d;b.totalSize=a}else{$.each(c,function(e){if($(this).data("sending")==true){$(this).removeClass("end");$(this).addClass("load");$(".co-pop-tp-file-save",this).remove();$(this).removeData("sending");$(".co-pop-tp-file-dtl",this).remove();var g=b.options.templ.detail;g=desknets.tmpl.replaceWord(g,"filename",$(this).data("attachdisp"));if($(this).data("size")==undefined){g=desknets.tmpl.replaceWord(g,"filesize","アップロード中")}else{g=desknets.tmpl.replaceWord(g,"filesize",b._formatFileSize($(this).data("size")))}g=desknets.tmpl.replaceWord(g,"release",b._getLcString("releaseLabel"));g=desknets.tmpl.replaceWord(g,"delete",b._getLcString("deleteLabel"));$(this).append(g);$(".co-pop-tp-file-size-in",this).css("width","0%");$(".co-pop-tp-file-del",$(this)).on("click",{attach:b},b._deleteAttachFile)}else{if($(this).data("exist")==undefined){$(".co-pop-tp-file-size-in",this).css("width","0%")}}d+=1;a+=$(this).data("size")})}b.totalUploadNum=d;b.totalUploadSize=a;b._changeTopMessage(0);if(b.options.afterUpload!=undefined&&typeof b.options.afterUpload=="function"){b.options.afterUpload()}b._enableFileAppend();if(b.autoUpload==false){b._clearDialogDisabled(b.dialog)}$(".co-pop-tp-stop-btn").attr("disabled","disabled");if(b.autoUpload==true){if(!f.data.close){b.uploadNowDialog.dialog("close")}}},_submit_iframe:function(k,a,f){var j=this;var c;var b=0;c=this.options.uploadURL;var g=k;var e=a;var i=false;var d=$('<form id="iframe-send-form"></form>');var h=$('<iframe id="iframe-send" src="javascript:false;" name="iframe-transport-'+(b+=1)+'"></iframe>').on("load",function(){h.off("load").on("load",function(){var q;try{q=h.contents();if(!q.length||!q[0].firstChild){throw new Error()}}catch(t){q=undefined}if(q==undefined){var u=j._getLcMessage("att_network_err");desknets.dialog.alert(u,{errorNo:-1});$(".co-pop-tp-stop-btn").trigger("click");j.abort=false;j._enableFileAppend()}else{var s=j._handleData(this,"xml");var r=$(s.documentElement);var p=r.find("status").text();if(p=="ok"){j._onSuccess(s,200,"success",g)}else{if(p=="ng"){if(j.abort!=true){var u=r.find("errormessage").text();var o=r.find("errorno").text();desknets.dialog.alert(u,{errorNo:o});$(".co-pop-tp-stop-btn").trigger("click")}j.abort=false;j._enableFileAppend()}}}d.remove();if(j.autoUpload==true){j.uploadNowDialog.dialog("close")}}).on("error",function(p){if(j.autoUpload==true){j.uploadNowDialog.dialog("close")}if(j.abort!=true){var q=$this.contentDocument.message;var o=$this.contentDocument.number;desknets.dialog.alert(q,{errorNo:o});$(".co-pop-tp-stop-btn").trigger("click")}j.abort=false;j._enableFileAppend();d.remove()});d.prop("target",h.prop("name")).prop("action",c).prop("method","POST");$('<iframe src="javascript:false;"></iframe>').appendTo(d);if(j.options.uploadParams){$.each(j.options.uploadParams,function(o,p){$('<input type="hidden"/>').prop("name",o).val(p).appendTo(d)})}var n=String($.cookie(desknets.COOKIENAME_STOKEN));$('<input type="hidden"/>').prop("name",n).val("1").appendTo(d);$('<input type="hidden"/>').prop("name","Filename").val(e).appendTo(d);$('<input type="hidden"/>').prop("name","resformat").val("xml").appendTo(d);if(j.tmpnm!=""){$('<input type="hidden"/>').prop("name","tmpnm").val(j.tmpnm).appendTo(d)}var m=$(g).data("fileInput");if(m&&m.length){m.prop("name","attach");d.append(m).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")}var l=$(".co-pop-tp-file-size-in",k);l.css("width","70%");$(".co-pop-tp-file-size-in",k).css("text-indent","0px");if(l.length!=0){if(l[0].textContent!=undefined){l[0].textContent=j._getLcString("uploadMsg")}}d.submit()});d.append(h).appendTo("body");$(".co-pop-tp-stop-btn").removeAttr("disabled")},_abort_iframe:function(){$("#iframe-send").off("load").prop("src","javascript".concat(":false;"));$("#iframe-send-form").remove()},_handleData:function(b,a){var d,c=$(b).contents().get(0);if($.isXMLDoc(c)||c.XMLDocument){return c.XMLDocument||c}d=$(c).find("body").html();switch(a){case"xml":d=parseXml(d);break}return d},_disableFileAppend:function(){var a=this;$(".co-pop-tp-file").data("disableFileAppend",true);$("#ifiles").attr("disabled","disabled");$(".co-pop-tp-clear-btn").attr("disabled","disabled");$(".co-pop-tp-file-del").css("cursor","not-allowed");$(".co-pop-tp-flash-mode-change-btn").css("cursor","not-allowed");if(a.flashAttachElement!=null){a.flashAttachElement.dnUploader("disable",a.flashAttachElement)}},_enableFileAppend:function(){var a=this;$(".co-pop-tp-file").removeData("disableFileAppend");$("#ifiles").removeAttr("disabled");if($(".co-pop-tp-file-thumbs>li").size()>0){$(".co-pop-tp-clear-btn").removeAttr("disabled")}$(".co-pop-tp-file-del").css("cursor","");$(".co-pop-tp-flash-mode-change-btn").css("cursor","");if(a.flashAttachElement!=null){setTimeout(function(){if(a.flashAttachElement!=null){a.flashAttachElement.dnUploader("enable",a.flashAttachElement)}},0)}},_clickUploadMessage:function(b){var a=b.data.attach;b.preventDefault();$("#ifiles").trigger("click")},_flashAddModeChangeButton:function(){var b=this;var a=b._getLcString("flashChangeMsg");$(".co-pop-tp-console").append(a)},_flashCheckModeChange:function(f){if(f!=undefined){var c=f.data.attach;f.preventDefault()}else{var c=this}var a=$(".co-pop-tp-flash-mode-change-btn");if(c.autoUpload==false){c._setDialogDisabled(c.dialog);var d=$(".co-pop-tp-file-thumbs>li");if(d.length){if(c.flashAttachElement!=null){c.flashAttachElement.dnUploader("disable",c.flashAttachElement)}var g=c._getLcMessage("att_detach_all");var b=desknets.dialog.confirm(g,function(){if(a.hasClass("co-pop-tp-go-flash-mode")){a.data("progress","flash");c._someDeleteAttachFile();c._clearDialogDisabled(c.dialog)}else{a.data("progress","Normal");c._someDeleteAttachFile();c._clearDialogDisabled(c.dialog)}},{cancel:function(){if(c.flashAttachElement!=null){c.flashAttachElement.dnUploader("enable",c.flashAttachElement)}c._clearDialogDisabled(c.dialog)}})}else{if(a.hasClass("co-pop-tp-go-flash-mode")){c._flashModeChange()}else{c._flashModeChangeNormal()}c._clearDialogDisabled(c.dialog);if($(".co-pop-tp-file-thumbs>li").size()==0){$(".co-pop-tp-clear-btn").attr("disabled","disabled")}if(!a.hasClass("co-pop-tp-go-flash-mode")){$(".co-pop-tp-stop-btn").attr("disabled","disabled")}}}else{if(a.hasClass("co-pop-tp-go-flash-mode")){c._flashModeChange()}else{c._flashModeChangeNormal()}}},_flashSetModeChangeButton:function(c){var b=this;var a;if(c=="flash"){$(".co-pop-tp-console>.co-msg").remove();a=b._getLcString("flashChangeMsg");$(".co-pop-tp-console").append(a);$(".co-pop-tp-flash-mode-change-btn").removeClass("co-pop-tp-go-normal-mode").addClass("co-pop-tp-go-flash-mode");$(document).off("click",".co-pop-tp-flash-mode-change-btn").on("click",".co-pop-tp-flash-mode-change-btn",{attach:b},b._flashCheckModeChange)}else{$(".co-pop-tp-console>.co-msg").remove();a=b._getLcString("flashChangeMsgNormal");$(".co-pop-tp-console").append(a);$(".co-pop-tp-flash-mode-change-btn").removeClass("co-pop-tp-go-flash-mode").addClass("co-pop-tp-go-normal-mode");$(document).off("click",".co-pop-tp-flash-mode-change-btn").on("click",".co-pop-tp-flash-mode-change-btn",{attach:b},b._flashCheckModeChange)}},_flashModeChange:function(i){if(i!=undefined){var h=i.data.attach;i.preventDefault()}else{var h=this}if($(".co-pop-tp-file").data("disableFileAppend")!=undefined){return}h._flashSetModeChangeButton("normal");var c=null;if(!$.plugins||$.plugins.isSupported("flash","10.0.0.0")){$(".co-pop-tp-meta").append('<div class="co-pop-tp-flash" />');var f=h.options.templ.flashInput;f=desknets.tmpl.replaceWord(f,"attach",h._getLcString("attachLabel"));$(".co-pop-tp-flash").append(f);c=$(".co-pop-tp-flash")}else{if(this.autoUpload==false){$(".co-pop-body").append(h._getLcString("flashDownloadMsg"))}else{$(".co-pop-tp-file-drop").append(h._getLcString("flashDownloadMsg"))}$(".co-pop-tp-console>.co-msg").hide()}if(c!=null&&c.length>0){$(".co-pop-tp-choose-link").hide();h.normalElements.topDropMsg=$(".co-pop-tp-def-msg>.co-pop-tp-drop-msg");h.normalElements.bottomDropMsg=$(".co-pop-tp-drop-bottom-msg>.co-pop-tp-drop-msg");$(".co-pop-tp-def-msg>.co-pop-tp-drop-msg").detach();$(".co-pop-tp-drop-bottom-msg>.co-pop-tp-drop-msg").detach();var d=h.options.templ.flashDropMsg;d=desknets.tmpl.replaceWord(d,"selectFromButton",h._getLcString("selectFromButtonLabel"));$(".co-pop-tp-def-msg").prepend(d);$(".co-pop-tp-drop-bottom-msg").prepend(d);h.normalElements.stopBtn=$(".co-pop-tp-stop-btn");$(".co-pop-tp-stop-btn").detach();h.normalElements.console=$(".co-pop-tp-console");$(".co-pop-tp-console-msg").remove();var j={resformat:"xml",rssid:h._getSessionId()};if(h.tmpnm!=""){j.tmpnm=h.tmpnm}j[String($.cookie(desknets.COOKIENAME_STOKEN))]=1;var g={localeChain:desknets.Resource.code,cancelText:desknets.Resource.abortLabel,uploadText:desknets.Resource.attachLabel,processingText:h._getLcString("saveLabel"),url:h.options.uploadURL,downloadURL:h.options.downloadURL,downloadTarget:"attach",addParams:h.options.uploadParams,deleteParams:h.options.delParams,deleteIDParamName:"fno",maxTotalSize:h.options.totalSizeLimit/1024/1024,objectURL:h.options.flashObjectURL,error:function(m,e){if(h.abort!=true){desknets.dialog.alert(e.message,{})}},nameDuplicated:function(n,e){var m=h._getLcMessage("att_overlap_file_single");m=desknets.tmpl.replaceWordHtml(m,"filenames",e.name);desknets.dialog.confirm(m,function(){var o=h._getTargetByFileName(e.name);if(o==undefined){setTimeout(function(){e.resolveCurrentFile(true)},0)}else{if($(o).data("exist")==true){h._removeFile(o);setTimeout(function(){e.resolveCurrentFile(true)},0)}else{h._removeFile(o);setTimeout(function(){e.resolveCurrentFile(true)},0)}}},{cancel:function(){setTimeout(function(){e.resolveCurrentFile(false)},0)}})}};$.extend(g.addParams,j);$.extend(g.deleteParams,j);if(h.autoUpload==false){g.start=function(){h._setDialogDisabled(h.dialog);h._disableFileAppend();if(h.options.beforUpload!=undefined&&typeof h.options.beforUpload=="function"){h.options.beforUpload()}};g.stop=function(){h._clearDialogDisabled(h.dialog);h._enableFileAppend();if($(".co-pop-tp-file-thumbs>li").size()==0){$(".co-pop-tp-clear-btn").attr("disabled","disabled")}if(h.options.afterUpload!=undefined&&typeof h.options.afterUpload=="function"){h.options.afterUpload()}}}else{g.start=function(){h._disableFileAppend();if(h.options.beforUpload!=undefined&&typeof h.options.beforUpload=="function"){h.options.beforUpload()}h._showUploadNowDialog()};g.stop=function(){h._enableFileAppend();h.uploadNowDialog.dialog("close");if(h.options.afterUpload!=undefined&&typeof h.options.afterUpload=="function"){h.options.afterUpload()}}}$(".co-pop-tp-clear-btn").css("float","right");g.files=[];if(h.autoUpload==false){$.each(h.options.file.files,function(e){g.files[e]={id:this.fno,name:this.attachdisp,size:this.size}});var l=$(".co-pop-tp-file-thumbs>li");$.each(l,function(e){g.files[e+h.options.file.files.length]={id:$(this).data("fno"),name:$(this).data("attachdisp"),size:$(this).data("size")}})}else{var l=$(".co-pop-tp-file-thumbs>li");$.each(l,function(e){g.files[e]={id:$(this).data("fno"),name:$(this).data("attachdisp"),size:$(this).data("size")}})}$(".co-pop-tp-meta").find("input[name='s_attach']").remove();h.flashAttachElement=$(".co-pop-tp-flash");h.flashAttachElement.dnUploader(g);$("#ifiles").remove();if($(".co-pop-tp-file-thumbs>li").size()==0){h._removeButtomMessage()}var k=$(".co-pop-tp-drop-bottom-msg");var a=$(".co-pop-tp-choose-link",k);var b=$(".co-pop-tp-choose-link",k).parent();$(".co-pop-tp-choose-link",k).remove();$(b).append(a)}if(h.autoUpload==false){desknets.attach._console("_flashModeChange() off/on co-pop-tp-clear-btn");$(document).off("click",".co-pop-tp-clear-btn").on("click",".co-pop-tp-clear-btn",{attach:h},h._clickAllDeleteAttachFile)}desknets.saveCookieToDisk(desknets.COOKIENAME_ATTACH_IE_FLASH,"flash")},_flashModeChangeNormal:function(g){if(g!=undefined){var c=g.data.attach;g.preventDefault()}else{var c=this}if($(".co-pop-tp-file").data("disableFileAppend")!=undefined){return}c._flashSetModeChangeButton("flash");$(".co-pop-tp-flash").remove();c.flashAttachElement=null;$(".co-pop-tp-drop-msg").remove();$(".co-pop-tp-def-msg").prepend(c.normalElements.topDropMsg);var a=$(".co-pop-tp-drop-bottom-msg");a.prepend(c.normalElements.bottomDropMsg);$(".co-pop-tp-drop-msg",a).hide();if($(".co-pop-tp-file-thumbs>li").size()==0){c._removeButtomMessage();c._appendDropMessage()}else{c._removeDropMessage();c._appendBottomMessage()}$(".co-pop-tp-meta").append(c.normalElements.stopBtn);if(this.autoUpload==false){$(document).off("click",".co-pop-tp-clear-btn").on("click",".co-pop-tp-clear-btn",{attach:c},c._clickAllDeleteAttachFile)}$(".co-pop-tp-clear-btn").css("float","");c.totalSize=0;c.totalFileNum=0;var f=0;var b=0;var d=$(".co-pop-tp-file-thumbs>li");$.each(d,function(e){f+=1;b+=$(this).data("size");c._changeTopMessage($(this).data("size"))});c.totalUploadNum=f;c.totalUploadSize=b;c._changeTopMessage(0);c._setDropMessage();desknets.saveCookieToDisk(desknets.COOKIENAME_ATTACH_IE_FLASH,"normal")},_setDropMessage:function(){var a=this;if(!window.File){return}var b=a._getLcString("dropMaxMsg");b=desknets.tmpl.replaceWord(b,"maxdrop",a.options.dropFilesLimit);var c;c=$(".co-pop-tp-def-msg>.co-pop-tp-drop-msg")[0];if(c!=undefined){c.textContent=b}c=$(".co-pop-tp-def-msg>.co-pop-tp-drop-msg")[0];if(c!=undefined){c.textContent=b}},_setDialogDisabled:function(b){var a=this;var c=b.parent();desknets.submitform.setButton(c,true);c.find(".ui-icon-closethick").unbind("click").bind("click",function(){return false})},_clearDialogDisabled:function(b){var a=this;var c=b.parent();desknets.submitform.setButton(c,false);c.find(".ui-icon-closethick").unbind("click").bind("click",this.closeFunction)},_showUploadNowDialog:function(){var a=this;var b={type:"message",extraMessage:a._getLcMessage("com_dialog_execaddmsg"),extraClass:"co-loading-dialog",btnLabel:desknets.Resource.abortLabel,close:function(){var e=$(".co-pop-tp-stop-btn");if(e.length){a._onCancel({data:{attach:a,close:true}})}else{$(".co-ie-uploader-cancel").trigger("click")}}};var d=a._getLcMessage("com_dialog_execmsg");d=desknets.tmpl.replaceWordHtml(d,"msg",a._getLcMessage("att_upload_now"));a.uploadNowDialog=desknets.dialog.alert(d,b);var c={};c[desknets.Resource.abortLabel]=function(){a.uploadNowDialog.dialog("close");a._onCancel({data:{attach:a,close:true}})};a.uploadNowDialog.dialog("option","buttons",c)},_unicodeNormalizationFormC:function(e){var c="";var d="";var a=function(j,h){var g="";for(var f=0;f<desknets.attach.unicodeNfdTable.length-1;f++){if(desknets.attach.unicodeNfdTable[f][1]==j&&desknets.attach.unicodeNfdTable[f][2]==h){return(String.fromCharCode(desknets.attach.unicodeNfdTable[f][0]))}}return g};desknets.attach._console("_unicodeNormalizationFormC befor="+this._stringDump(e));for(var b=0;b<e.length;b++){d=a(e.charCodeAt(b),e.charCodeAt(b+1));if(d==""){c+=String.fromCharCode(e.charCodeAt(b))}else{c+=d;b++}}desknets.attach._console("_unicodeNormalizationFormC after="+this._stringDump(c));desknets.attach._console("_unicodeNormalizationFormC after="+this._stringDump(c));return c},unicodeNfdTable:[[12364,12363,12441],[12366,12365,12441],[12368,12367,12441],[12370,12369,12441],[12372,12371,12441],[12374,12373,12441],[12376,12375,12441],[12378,12377,12441],[12380,12379,12441],[12382,12381,12441],[12384,12383,12441],[12386,12385,12441],[12389,12388,12441],[12391,12390,12441],[12393,12392,12441],[12400,12399,12441],[12401,12399,12442],[12403,12402,12441],[12404,12402,12442],[12406,12405,12441],[12407,12405,12442],[12409,12408,12441],[12410,12408,12442],[12412,12411,12441],[12413,12411,12442],[12436,12358,12441],[12446,12445,12441],[12460,12459,12441],[12462,12461,12441],[12464,12463,12441],[12466,12465,12441],[12468,12467,12441],[12470,12469,12441],[12472,12471,12441],[12474,12473,12441],[12476,12475,12441],[12478,12477,12441],[12480,12479,12441],[12482,12481,12441],[12485,12484,12441],[12487,12486,12441],[12489,12488,12441],[12496,12495,12441],[12497,12495,12442],[12499,12498,12441],[12500,12498,12442],[12502,12501,12441],[12503,12501,12442],[12505,12504,12441],[12506,12504,12442],[12508,12507,12441],[12509,12507,12442],[12532,12454,12441],[12535,12527,12441],[12536,12528,12441],[12537,12529,12441],[12538,12530,12441],[12542,12541,12441],[0,0,0]],_stringDump:function(c){var b="";for(var a=0;a<c.length;a++){b+="\\u"+(c.charCodeAt(a)).toString(16)}return b},_getSessionId:function(){return $.cookie(desknets.COOKIENAME_SESSION_ID)},_getLcString:function(a){var c=this.options.attResource;if(!c){c=desknets.Resource.attach}var b=c[a];return b},_getLcMessage:function(b){var c;if(!!this.options.msgPrefix){var a=b.replace(/^att_/,this.options.msgPrefix);c=desknets.Resource.Message[a]}if(!c){c=desknets.Resource.Message[b]}return c},};desknets.attach.ext={CMD_ATTEXTLIST:"getextlist",_extlist:null,_TMPL_IMAGE:DENBUN_DOC_ROOT+"/"+desknets.DIR_RESHOME+"/images/com/ext/co_ext_{{ext}}.png",IMAGE_NONE:DENBUN_DOC_ROOT+"/"+desknets.DIR_RESHOME+"/images/com/ext/co_ext_unknown.png",getListParam:function(){var a={};if(this._extlist==null){a.cmd=this.CMD_ATTEXTLIST;return a}else{return null}},saveList:function(d){this._extlist={};if(d){var b=desknets.ajax.getJsonItems(d);var a=b.length;for(var c=0;c<a;c++){var e=b[c];this._extlist["."+e.id]=desknets.tmpl.replaceWord(this._TMPL_IMAGE,"ext",e.id)}}this._extlist.none=this.IMAGE_NONE},getIconList:function(){if(this._extlist==null){this.saveList(null)}return this._extlist}};desknets.storage={FIELD_FORM_VALUES:"dnFormValues",FIELD_CHOOSER_TAB:"dnChooserTab",FIELD_CHOOSER_HISTORY:"dnChooserHistory",FIELD_NTWI_NEWS:"dnNtwiNews",FIELD_NTWI_SEARCHES:"dnNtwiHistory",FIELD_ZSEARCH_EXEC:"dnZSsearchExec",_fields:null,loadData:function(a){if(!this._fields){this._init()}var d=this._fields[a],c;if(!!d){if(d.store=="session"){try{c=window.sessionStorage[a]}catch(b){}}else{if(d.store=="local"){try{c=window.localStorage[a]}catch(b){}}}if(typeof c=="undefined"){c=d.defValue}else{if(d.type=="object"){c=$.parseJSON(c)}}}return c},saveData:function(a,d){if(!this._fields){this._init()}var e=this._fields[a],b=d;if(!!e){if(e.type=="object"){b=JSON.stringify(d)}if(e.store=="session"){try{window.sessionStorage[a]=b}catch(c){}}else{if(e.store=="local"){try{window.localStorage[a]=b}catch(c){}}}}},clearData:function(a){if(!this._fields){this._init()}var c=this._fields[a];if(!!c){if(c.store=="session"){try{delete window.sessionStorage[a]}catch(b){}}else{if(c.store=="local"){try{delete window.localStorage[a]}catch(b){}}}}},clearPrivateData:function(){var a=this;var b=[this.FIELD_FORM_VALUES,this.FIELD_NTWI_NEWS,this.FIELD_NTWI_SEARCHES,this.FIELD_ZSEARCH_EXEC];$.each(b,function(d,c){a.clearData(c)})},_init:function(){this._fields={};this._fields[this.FIELD_FORM_VALUES]={store:"session",type:"object",defValue:{}};this._fields[this.FIELD_CHOOSER_TAB]={store:"local",type:"string",defValue:"not-found"};this._fields[this.FIELD_CHOOSER_HISTORY]={store:"local",type:"object",defValue:[]};this._fields[this.FIELD_NTWI_NEWS]={store:"session",type:"object",defValue:{}};this._fields[this.FIELD_NTWI_SEARCHES]={store:"local",type:"object",defValue:[]};this._fields[this.FIELD_ZSEARCH_EXEC]={store:"session",type:"string",defValue:""}}};desknets.Resource.Pager={msgPageNavi:"{{allcnt}} Records",msgPageMove:"{{nowpage}}/{{allpage}}",msgPageInput:"Page:  ",msgPageInputBtn:"Move",msgPageFirst:"Top",msgPagePrev:"Prev",msgPageNext:"Next",msgPageLast:"Last"};desknets.Pager={objDefOptions:{getCount:0,allCount:0,pageMaxView:100,startRow:0,clickFunc:null,classPageNavi:"co-cnt",classPagePaging:"co-paging",classPageMeta:"co-page-meta",classPageLink:"co-page-link",classPageToggle:"co-drop-down-button",classPageInput:"co-page-input",classPageBtn:"co-page-btn",classPageFirst:"co-page-first",classPagePrev:"co-page-prev",classPageNext:"co-page-next",classPageLast:"co-page-last",classPageOn:"on",idPageDropDown:"co-page-drop-down",msgPageNavi:desknets.Resource.Pager.msgPageNavi,msgPageMove:desknets.Resource.Pager.msgPageMove,msgPageInput:desknets.Resource.Pager.msgPageInput,msgPageInputBtn:desknets.Resource.Pager.msgPageInputBtn,msgPageFirst:desknets.Resource.Pager.msgPageFirst,msgPagePrev:desknets.Resource.Pager.msgPagePrev,msgPageNext:desknets.Resource.Pager.msgPageNext,msgPageLast:desknets.Resource.Pager.msgPageLast},output:function(d,a,e){var b={};var c="";$(d).find(a).each(function(){$(this).empty()});if(e.allCount>0){$.extend(b,this.objDefOptions,e);b=this._setOptionsMath(b);c=this._makeHtml(b)}$(d).find(a).each(function(){$(this).html(c)});if(b.maxPage>1&&typeof b.clickFunc=="function"){this._makeJs(d,a,b)}},_setOptionsMath:function(e){var h=e.getCount;var m=e.allCount;var g=e.pageMaxView;var c=e.startRow;var f=0;var l=0;var k=0;var b=0;h=desknets.parseNumber(h,0);m=desknets.parseNumber(m,0);g=desknets.parseNumber(g,100);c=desknets.parseNumber(c,0);if(g<=0){g=m;if(g<=0){g=100}}f=m/g;f=parseInt(f,10);b=m%g;if(b>0){f+=1}var a=1;a=parseInt(c/g+1,10);if(a>f){a=f}else{if(a<1){a=1}}l=(a-1)*g+1;if(l<0){l=0}k=l+h-1;if(k<0){k=0}var j=false;var i=false;var d=false;var n=false;if(a>1){j=true;i=true}if(a!=f){d=true;n=true}e.pageMaxView=g;e.startRow=c;e.nowPage=a;e.maxPage=f;e.viewStart=l;e.viewEnd=k;e.boFirst=j;e.boBefore=i;e.boAfter=d;e.boEnd=n;return e},_makeHtml:function(d){var b="";var a=[];var c=null;b=d.msgPageNavi;c=new RegExp("{{allcnt}}","ig");b=b.replace(c,d.allCount);c=new RegExp("{{start}}","ig");b=b.replace(c,d.viewStart);c=new RegExp("{{end}}","ig");b=b.replace(c,d.viewEnd);a[a.length]='<div class="co-page-text ';a[a.length]=d.classPageNavi;a[a.length]='">';a[a.length]=b;a[a.length]="</div>";if(d.maxPage>1){if($("#"+d.idPageDropDown).length<=0){this._createDropDown(d)}a[a.length]='<ul class="';a[a.length]=d.classPagePaging;a[a.length]='">';a[a.length]='<li class="';a[a.length]=d.classPageMeta;a[a.length]='">';a[a.length]='<a class="';a[a.length]=d.classPageLink;a[a.length]=" ";a[a.length]=d.classPageToggle;a[a.length]='" data-for="';a[a.length]=d.idPageDropDown;a[a.length]='" href="#" >';b=d.msgPageMove;c=new RegExp("{{allpage}}","ig");b=b.replace(c,d.maxPage);c=new RegExp("{{nowpage}}","ig");b=b.replace(c,d.nowPage);a[a.length]=b;a[a.length]="</a>";a[a.length]="</li>";a[a.length]='<li class="';a[a.length]=d.classPageFirst;a[a.length]='">';if(d.boFirst){a[a.length]='<a class="';a[a.length]=d.classPageLink;a[a.length]='" href="#" title="';a[a.length]=d.msgPageFirst;a[a.length]='">';a[a.length]=d.msgPageFirst;a[a.length]="</a>"}else{a[a.length]='<span class="';a[a.length]=d.classPageLink;a[a.length]=' nolink" title="';a[a.length]=d.msgPageFirst;a[a.length]='">';a[a.length]=d.msgPageFirst;a[a.length]="</span>"}a[a.length]="</li>";a[a.length]='<li class="';a[a.length]=d.classPagePrev;a[a.length]='">';if(d.boBefore){a[a.length]='<a class="';a[a.length]=d.classPageLink;a[a.length]='" href="#" title="';a[a.length]=d.msgPagePrev;a[a.length]='">';a[a.length]=d.msgPagePrev;a[a.length]="</a>"}else{a[a.length]='<span class="';a[a.length]=d.classPageLink;a[a.length]=' nolink" title="';a[a.length]=d.msgPagePrev;a[a.length]='">';a[a.length]=d.msgPagePrev;a[a.length]="</span>"}a[a.length]="</li>";a[a.length]='<li class="';a[a.length]=d.classPageNext;a[a.length]='">';if(d.boAfter){a[a.length]='<a class="';a[a.length]=d.classPageLink;a[a.length]='" href="#" title="';a[a.length]=d.msgPageNext;a[a.length]='">';a[a.length]=d.msgPageNext;a[a.length]="</a>"}else{a[a.length]='<span class="';a[a.length]=d.classPageLink;a[a.length]=' nolink" title="';a[a.length]=d.msgPageNext;a[a.length]='">';a[a.length]=d.msgPageNext;a[a.length]="</span>"}a[a.length]="</li>";a[a.length]='<li class="';a[a.length]=d.classPageLast;a[a.length]='">';if(d.boEnd){a[a.length]='<a class="';a[a.length]=d.classPageLink;a[a.length]='" href="#" title="';a[a.length]=d.msgPageLast;a[a.length]='">';a[a.length]=d.msgPageLast;a[a.length]="</a>"}else{a[a.length]='<span class="';a[a.length]=d.classPageLink;a[a.length]=' nolink" title="';a[a.length]=d.msgPageLast;a[a.length]='">';a[a.length]=d.msgPageLast;a[a.length]="</span>"}a[a.length]="</li>";a[a.length]="</ul>"}return a.join("")},_createDropDown:function(d){var b=this;var a=[];var c=$('<div class="co-pop-up-box" />');c.attr("id",d.idPageDropDown);a[a.length]=d.msgPageInput;a[a.length]='<input class="';a[a.length]=d.classPageInput;a[a.length]='" maxlength="7" type="text" />';a[a.length]='<input class="';a[a.length]=d.classPageBtn;a[a.length]='" type="button" value="';a[a.length]=d.msgPageInputBtn;a[a.length]='" />';c.html(a.join("")).appendTo(document.body);c.find("input:button").click(function(e){b._triggerDropDownPageChange($(this).closest(".co-pop-up-box"))});c.find("input:text").bind("keyup",function(e){if(e.keyCode==13){b._triggerDropDownPageChange($(this).closest(".co-pop-up-box"));this.blur()}})},_triggerDropDownPageChange:function(a){var d=a.find("input:text");var c=a.data("source");var b=Math.floor(desknets.parseNumber(d.val(),0));if(b>0){desknets.popUp.hideAll();d.blur().val("");c.trigger("pageChanged.desknetsPager",{pageNo:b})}},_makeJs:function(c,b,d){var a=b+" ."+d.classPageLink;$(c).find(a).bind("pageChanged.desknetsPager",function(f,g){var e=(g.pageNo-1)*d.pageMaxView;d.clickFunc(e.toString())});if(d.boFirst){$(c).find(b+" ."+d.classPageFirst).click(function(e){e.preventDefault();d.clickFunc("0")})}if(d.boBefore){$(c).find(b+" ."+d.classPagePrev).click(function(g){g.preventDefault();var e=(d.nowPage-2)*d.pageMaxView;var f=""+e;d.clickFunc(f)})}if(d.boAfter){$(c).find(b+" ."+d.classPageNext).click(function(g){g.preventDefault();var e=(d.nowPage)*d.pageMaxView;var f=""+e;d.clickFunc(f)})}if(d.boEnd){$(c).find(b+" ."+d.classPageLast).click(function(g){g.preventDefault();var e=(d.maxPage-1)*d.pageMaxView;var f=""+e;d.clickFunc(f)})}}};desknets.popUp={TMPL_POP_UP:'<div class="co-baloon" ><div class="co-baloon-connecter"><div class="co-baloon-connecter-inner"></div></div><div class="co-baloon-body"></div></div>',init:function(){var a=this;var b="hashchange ";a._initPopUpBox();a._initDropDown($(document.body));a._initSelectMenu($(document.body));b+=desknets.browser.tablet?"orientationchange":"resize";$(window).bind(b,function(c){$(document.body).mousedown()})},open:function(b,a){var c=$();if(!!a.target){c=$(a.target);c.data("position",a.position);c.data("align",a.align)}if(c.length>0){b.addClass("co-pop-up-box");this._showPopUp(b,c)}},setToHoverPopup:function(a,c){var b=this;a.each(function(){b._hoverOn($(this),c,function(){b._showPopUpWithoutClick($(this))})})},hide:function(b){var a=$(b).closest(".co-pop-up-box.show");if(a.length>0){this._hidePopUp(a)}},hideAll:function(){var a=this;$(".co-pop-up-box.show").each(function(){a._hidePopUp($(this))})},getSource:function(b){var a=b.closest(".co-pop-up-box").data("source");return !!a?a:$([])},updateConnecter:function(a){var d=this.getSource(a);if(a.hasClass("co-baloon")&&d.length>0){var c=this._getActualPosition(a,d);var b=a.attr("class");b=b.replace(/co-baloon-at-\w+-\w+/g,"");a.attr("class",b+" co-baloon-at-"+c)}},setSelectValue:function(b,c){var a=$("#"+b.data("for"));var d=a.find("a").filter(function(){return $(this).data("value")==c});if(d.length<=0){d=a.find("a").eq(0);c=d.data("value")}b.data("value",c);b.children(".co-select-menu-text").text(d.eq(0).text())},_initPopUpBox:function(){var a=this;$(document.body).mousedown(function(b){a._hidePopUpExceptFor($(b.target))})},_initDropDown:function(b){var a=this;b.delegate(".co-drop-down-button","click",function(c){c.preventDefault();a._togglePopUpOfType($(this))})},_initSelectMenu:function(b){var a=this;b.delegate(".co-select-menu","click",function(c){c.preventDefault();var d=$(this);if(!d.hasClass("co-disabled")){a._togglePopUpOfType($(this),a._setUpSelectMenuPopUp)}})},_togglePopUpOfType:function(c,b){var a=$("#"+c.data("for"));if(a.length<=0){return}if(a.hasClass("show")){this._hidePopUp(a)}else{if(!a.data("source")&&$.isFunction(b)){b.apply(this,[a])}this._showPopUp(a,c)}},_showPopUpWithoutClick:function(b){var a=$("#"+b.data("for"));this._hidePopUpExceptFor(b);if(a.length>0&&!a.hasClass("show")){this._showPopUp(a,b)}},_showPopUp:function(a,d){var b=this;var c=this._getPosition(d);a.data("source",d);a.addClass("show").position(c);if(c.collision=="flip"){setTimeout(function(){b.updateConnecter(a)},0)}d.trigger("open.popup")},_hidePopUpExceptFor:function(b){var a=this;$(".co-pop-up-box.show").each(function(){var c=$(this);var d=a.getSource(c);if(b.closest(c).length>0||b.closest(d).length>0){return}a._hidePopUp(c)})},_hidePopUp:function(a){var b=this.getSource(a);a.removeClass("show");if(!!b&&b.length>0){a.data("source",$([]))}b.trigger("close.popup")},_setUpSelectMenuPopUp:function(a){var b=this;a.delegate("a","click",function(e){e.preventDefault();var d=$(this);var c=d.closest(".co-pop-up-box");var g=b.getSource(c);var f=d.data("value");g.find(".co-select-menu-text").html(d.html());g.find("input").val(f);g.data("value",f);g.trigger("change.selectMenu");b._hidePopUp(c)})},_getPosition:function(d){var c=d.data("position");var b=d.data("align");var a={of:d,collision:d.data("collision")};if(!a.collision){a.collision=!!c?"none":"flip"}if(c=="center"){b=b||"left top";return $.extend(a,{my:b,at:b})}else{if(c=="left"){b=b||"top";return $.extend(a,{my:"right "+b,at:"left "+b})}else{if(c=="right"){b=b||"top";return $.extend(a,{my:"left "+b,at:"right "+b})}else{if(c=="top"){b=b||"left";return $.extend(a,{my:b+" bottom",at:b+" top"})}else{b=b||"left";$.extend(a,{my:b+" top",at:b+" bottom"});return a}}}}},_getActualPosition:function(a,f){var b=a.offset();var c=f.offset();var e=b.top<c.top?"top":"bottom";var d=Math.abs(b.left-c.left)<=2?"right":"left";return e+"-"+d},_hoverOn:function(a,c,d){var f=null;function b(){f=setTimeout(function(){f=null;d.apply(a)},c)}function e(){if(!!f){clearTimeout(f)}}a.hover(b,e)}};$.widget("desknets.dnAttachList",{_TMPL_FILENAME:"mail/attach.list.html",_$tbody:null,_tmplItem:null,options:{files:[],uploadURL:"/",uploadParams:{},delURL:"/",delParams:{},downloadURL:"/",totalSizeLimit:2147483648,hideElementOnEmpty:null,toggleTargetFunc:null,tmpnm:""},_create:function(){var b=this;var a=desknets.Resource.Message;b._initOptionsWithElement();desknets.tmpl.load(this.element,this._TMPL_FILENAME,function(){b._$tbody=$("#mail-edit-attachment-list");b._tmplItem=b._$tbody.html().replace("data-href","href");b._$tbody.empty();b._$tbody.css({visibility:"visible"});b._initItems();b.element.find(".jco-selfile-button").click(function(c){b.openChooser()});b.element.find(".jco-remove-all-button").click(function(c){desknets.dialog.confirm(a.com_attachlist_confirm_all,function(){b.removeAll()})});b._$tbody.delegate(".mail-edit-attachment-remove","click",function(d){d.preventDefault();var c=$(this).closest("li");desknets.dialog.confirm(a.com_attachlist_confirm_one,function(){b._beginToDeleteItem(c)})})},{cache:true})},openChooser:function(){var b=this;var c={uploadURL:this.options.uploadURL,uploadParams:this.options.uploadParams,delURL:this.options.delURL,delParams:$.extend({},this.options.delParams),downloadURL:this.options.downloadURL,totalSizeLimit:this.options.totalSizeLimit,file:{tmpnm:this.options.tmpnm,files:this.options.files},done:function(d){b._addItems(d.files,d.tmpnm)}};var a=desknets.attach.ext.getIconList();if(a){c.icon=a}desknets.attach.uploadDialog(c)},removeAll:function(){var a=this;desknets.attach.deleteAttachFile({delURL:a.options.delURL,delParams:$.extend({},a.options.delParams),done:function(){a._deleteAllItems()}})},updateFile:function(c){var a=this;var b=[];$.each(c,function(d,e){b.push({fno:e.id,attachdisp:e.attachdisp,size:Number(e.size),})});a.options.files=b;a._$tbody.empty();a._initItems()},_initOptionsWithElement:function(){var a=this.element.data("totalsizelimit");if(!!a){this.options.totalSizeLimit=a}this._initFilesWithElement()},_initFilesWithElement:function(){var a=this;var c=[];var b=this.element.find(".jco-attach-file");if(b.length>0){b.each(function(){var d=$(this);c.push({fno:this.value,attachdisp:d.data("name"),size:d.data("size")})});this.options.files=c}},_initItems:function(){this._addItemElements(this.options.files);this._updateTempName(this.options.tmpnm);this._updateToggleTarget(true)},_beginToDeleteItem:function(b){var a=this;var c=b.data("fno");var d=$.extend({},this.options.delParams);d.fno=c;desknets.attach.deleteAttachFile({delURL:this.options.delURL,delParams:d,done:function(){a._deleteItem(b,c)}})},_addItems:function(a,c){for(var b=a.length-1;b>=0;b--){this._deleteWithName(a[b].attachdisp)}this._addItemElements(a);$.merge(this.options.files,a);this._updateTempName(c);this._updateToggleTarget(false)},_deleteWithName:function(a){var c=this.options.files;for(var b=c.length-1;b>=0;b--){if(c[b].attachdisp==a){this._deleteItem(this._$tbody.children().eq(b),c[b].fno);break}}},_deleteItem:function(b,d){var c=this.options.files;var a=function(e,f){return e.fno==f};b.remove();this.options.files=DNNEO.neo.array.remove(c,d,a);this._updateToggleTarget(false)},_deleteAllItems:function(){this._$tbody.empty();this.options.files=[];this._updateToggleTarget(false)},_addItemElements:function(a){for(var d=0;d<a.length;d++){var c=this._tmplItem,b;c=desknets.tmpl.replaceWordHtml(c,"fno",a[d].fno);c=desknets.tmpl.replaceWord(c,"attachdisp",a[d].attachdisp);if(a[d].size==-1){c=desknets.tmpl.replaceWordHtml(c,"displaySize",desknets.Resource.attachInvSize)}else{b=desknets.formatFileSize(a[d].size,{minUnit:"KB",maxUnit:"KB"});c=desknets.tmpl.replaceWordHtml(c,"displaySize",b)}c=desknets.tmpl.replaceWord(c,"downloadURL",this._getDownloadURL(a[d]));$(c).appendTo(this._$tbody)}},_updateTempName:function(b){if(!!b){var c=this.element.prev('input[name="tmpnm"]');if(c.length<=0){var a=this.element.find(".jco-selfile-button");c=$('<input type="hidden" name="tmpnm" />').insertAfter(a)}c.val(b);this.options.tmpnm=b}},_updateToggleTarget:function(a){if(!!this.options.hideElementOnEmpty){if(!!this.options.files&&this.options.files.length>0){$(this.options.hideElementOnEmpty).show()}else{$(this.options.hideElementOnEmpty).hide()}}if(!!this.options.toggleTargetFunc){this.options.toggleTargetFunc()}if(!a){this.element.addClass(desknets._CLSNAME_MODFILES)}},_getDownloadURL:function(b){var a=String(this.options.downloadURL);if(!!this.options.tmpnm){a=desknets.tmpl.replaceWordHtml(a,"tmpnm",this.options.tmpnm)}return desknets.attach.getDownloadUrl({downloadURL:a,fno:b.fno,attachdisp:b.attachdisp})},_getTotalSize:function(){var b=0;if(!!this.options.files){for(var a=0;a<this.options.files.length;a++){b+=this.options.files[a].size}}return b}});desknets.attachDisp={_TMP_ATTACHAREA:'<div class="jco-attach-area co-tp-e-file"><table class="co-selfile"><tbody>{{tmpl}}</tbody></table></div>',disp:function(e,a,b){var k=this;if(!e||!e.item){return"&nbsp;"}var d="";var c,i;var g={};if(a!=null){a=desknets.getUrl(a)}var f=desknets.ajax.getItems(e.item);var h=desknets.getNeoParam(b);c=f.length;if(c==0){return"&nbsp;"}g.cgi=a;g.query=h;for(i=0;i<c;i++){var j=k.editDispItem(i,f[i],g);d=d+j}if(i>0){d=desknets.tmpl.replaceWordHtml(k._TMP_ATTACHAREA,"tmpl",d)}return d},editDispItem:function(f,d,a){var b=this;var g="",c,e="";var h=desknets.tmpl.escapeWord(d.attachdisp);if(d.size){e=desknets.attachDisp.getSize(d.size)}else{e=desknets.Resource.attachInvSize}if(a.cgi==null){g="<td>"+h+'</td><td class="co-td-num">'+e+"</td>"}else{c=a.cgi+"?"+a.query+"&fno="+d.id+"&filename="+h;g='<td><a target="attach" href="'+c+'">'+h+'</a></td><td class="co-td-num">'+e+"</td>"}g="<tr>"+g+"</tr>";return g},dispDelimited:function(){return",\n"},getSize:function(a){return desknets.formatFileSize(a,{minUnit:"KB",maxUnit:"KB"})}};$.extend(desknets.attachDisp,{VAL_ATTACHDISP_THUM:"0",VAL_ATTACHDISP_LIST:"1",_listDispAtts:{},removeAttachAlink:function(a,d){var c="";var b=neo.isSet(d)?d:true;var e=a.find(".jco-attach-area");$.each(e.find("tr"),function(j,k){var h=$(this);var g="";if(b){g="<td>"+h.find("td:first").text()+"</td>";h.find("td:first").remove();h.prepend(g)}else{var l="",f="";if(j>0){c=c+", "}l=h.find("a").text();f=h.find("td").eq(1).text();g=l+"("+f+")";c=c+g}});if(!b){e.text(c)}return},displist:function(p,l,q){if(!p||!p.item){return""}var k=this;var h="";var o,n;k._listDispAtts={};l=desknets.getUrl(l);var f=desknets.ajax.getItems(p.item);var e=desknets.getNeoParam(q);o=f.length;if(o==0){return""}k._listDispAtts.fCnt=o;for(n=0;n<o;n++){var c="",d,j="",r={};var m;var i=$("<div />");var g=f[n];var s=desknets.tmpl.escapeWord(g.attachdisp);var a=g.id;if(g.size){j=desknets.attachDisp.getSize(g.size)}else{j=desknets.Resource.attachInvSize}d=l+"?"+e+"&fno="+a+"&filename="+s;r={name:s,fno:a,url:d+"&updtime={{updtime}}"};k._listDispAtts[n]=r;c='<li id="co-pop-tp-file-fno'+a+'"><div class="co-pop-tp-file-dtl"><div class="co-pop-tp-file-name"><a title="'+s+'" href="'+d+'" target="attach">'+s+'</a></div><div class="co-pop-tp-file-size"><div class="co-pop-tp-file-size-in">'+j+"</div></div></li>";var b=$('<a href="'+d+'" target="attach" class="co-pop-tp-file-thumbnail"></a>');i.append($(c).prepend(b));h=h+i.html()}return h},displistThumb:function(a,c){var h=this;var f={};var g=0;if(!DNNEO.neo.isSet(a)){return}if($.isEmptyObject(h._listDispAtts)||h._listDispAtts.fCnt==0){return}$.extend(f,h._listDispAtts);if(DNNEO.neo.isSet(c)&&c.list){desknets.attach.ext.saveList(c)}var e={};var b=desknets.attach.ext.getIconList();if(b){e.icon=b}for(g=0;g<f.fCnt;g++){var d;d=desknets.attach.getThumbnailImage(f[g],e);var i=a.find("#co-pop-tp-file-fno"+f[g].fno).eq(0);i.find("a.co-pop-tp-file-thumbnail").append(d)}},initDispList:function(d){var a=this;var b=d.find(".co-pop-tp-meta-switch");var c=$.cookie(desknets.COOKIENAME_ATTACHDISP_LIST);if(c&&c==a.VAL_ATTACHDISP_LIST){b.closest(".co-pop-tp-file-drop").addClass("list")}b.delegate(".thumb","click",function(e){e.preventDefault();$(this).closest(".co-pop-tp-file-drop").removeClass("list");desknets.saveCookieToDisk(desknets.COOKIENAME_ATTACHDISP_LIST,a.VAL_ATTACHDISP_THUM)});b.delegate(".list","click",function(e){e.preventDefault();$(this).closest(".co-pop-tp-file-drop").addClass("list");desknets.saveCookieToDisk(desknets.COOKIENAME_ATTACHDISP_LIST,a.VAL_ATTACHDISP_LIST)})},});(function(a){desknets.tagDisp={_COLORS:{"1":"blue","2":"green","3":"yellow","4":"pink","5":"red","6":"gray"},color0:"x",getTagColorClass:function(c){var b=this._COLORS[c];if(DNNEO.neo.isSet(b)){return b}else{return"none"}},getTagColorTitle:function(c){var b=desknets.Resource.tags["color"+c];if(DNNEO.neo.isSet(b)){return b}else{return this.color0}}}})(jQuery);(function(a){desknets.page=function(d,g,e,c){var f={callBase:function(l){var k=this;function m(o,p){for(var n in o){if(o[n]==p){return true}}return false}function j(o,p){for(var n=o;!!n;n=n._baseClass){if(m(n,p)){return n._baseClass}}return null}function i(p,o){for(var n=p;!!n;n=n._baseClass){if(a.isFunction(n[l])){return n[l].apply(k,o)}}throw"No method in base class"}return i(j(this._thisClass,arguments.callee.caller),Array.prototype.slice.call(arguments,1))}};function h(){var i=a.extend({},c);i._baseClass=!!e?e._thisClass:null;return i}function b(){var j={};var i=!!e?e:f;a.extend(j,i,c);j._thisClass=h();return j}d[g]=b()}})(jQuery);desknets.chooser={MODULE:"zrconst",MODULE_ROLE:"zrconst",CMD_GROUPS:"constructugroups",CMD_GROUPTREE:"constructcmdgrouptree",CMD_USERS:"constructcmdusersearch",CMD_ROLE:"setrolelist",_history:null,init:function(){this.setUserFieldsToShow(desknets.pageframe.getUserDispItems())},setUpEntry:function(d,a,b){var c=$("#"+b.dialogID);if(c.length>0){desknets.chooser.destroyDialog(c)}return new desknets.chooser.Entry(d,a,b)},open:function(d,b){if(!!b&&b.mode=="single"&&String(b.chooseTarget)=="group"){if($.type(b.items)=="array"&&b.items.length==1&&b.items[0].type=="group"){b.defaultGroupId=b.items[0].id}return desknets.chooser.singleGroup.open(d,b)}if(b.chooseAssignedGroup){return desknets.chooser.assignedGroup.open(d,b)}var a=this,c=$("#"+d);if(c.length>0){desknets.pageframe.executeOnTipShown(function(){if(!!b&&!!b.items){c.children(".co-sel").dnChooser("items",b.items)}c.dialog("open")});return c}c=$("<div />").attr("id",d).appendTo(document.body);desknets.pageframe.executeOnTipShown(function(){a.setUpDialog(c,b)});return c},close:function(b,a){b.dialog("close");if(a){desknets.chooser.saveHistory(b.children().dnChooser("items"))}},setUpDialog:function(e,c){var a=this,d={};var b=$("<div />").appendTo(e);if(!!c){$.extend(d,c);this._setUpChooseEvent(e,c.choose)}e.bind("dnchooserload",function(){var f=(d.mode=="single")?"com_chooser_note_single":"com_chooser_note";desknets.dialog.setUp(e,a._getChooserDialogOptions(c));$('<div class="co-msg co-sel-dialog-note" />').text(desknets.Resource.Message[f]).appendTo(e.closest(".ui-dialog"));if(d.mode=="single"){e.on("dnchooseritemlistadd",function(g){a._onChooseItems(e,d)})}e.dialog("open")});b.dnChooser(d)},destroyDialog:function(a){a.children().dnChooser("destroy");a.dialog("destroy").remove()},_ajaxRest:function(b,d,e,i){var f;if((!!i&&i.mode=="single"&&String(i.chooseTarget)=="group")||(i.chooseAssignedGroup)){f=desknets.Resource.chooser.allGroupName}else{f=desknets.Resource.chooser.allUserName}var a=$.extend({allGroupLabel:f,unassignGroupLabel:desknets.Resource.chooser.unassignGroupName},i);var h=this,c=d;h._ajaxRestPrefilter(d,a);if($.isArray(d)){var g={};$.each(d,function(k,j){g[k.toString()]=j});c={multicmd:JSON.stringify(g)}}desknets.ajax.rest({id:"desknets-chooser",url:b,data:c,type:"POST",success:function(k,j,l){h._ajaxRestPostfilter(d,k,a);e(k,j,l)},error:function(l,k,j){if(k!="abort"){desknets.ajax.onError(l.status,j)}}})},_getSubType:function(b){var a=b.type;if(b.type=="group"){if(b.id=="all"){return"all-"+b.type}else{if(b.id=="0"){return"unassigned-"+b.type}else{if(Number(b.id)<0){return"private-"+b.type}else{return"shared-"+b.type}}}}if(b.type=="role"){if(Number(b.id)<=desknets.DBVAL_ROLE_LOCK_MAX){return"system-"+b.type}else{return"user-"+b.type}}else{return b.type}},_ajaxRestPrefilter:function(c,a){if($.isArray(c)){for(var b=0;b<c.length;b++){this._ajaxRestPrefilterSingle(c[b],a)}}else{this._ajaxRestPrefilterSingle(c,a)}},_ajaxRestPrefilterSingle:function(b,a){b.row=!!b.row?b.row:0;if(this._isRootGroupRequest(b,a)){if(!!a.allGroup){this._ajaxRestPrefilterAllGroup(b,a)}}},_ajaxRestPrefilterAllGroup:function(b,a){if(b.row>0){b.row--}else{if(!!b.num&&b.num>0){b.num--}}},_ajaxRestPostfilter:function(d,c,a){if($.isArray(d)){for(var b=0;b<d.length;b++){this._ajaxRestPostfilterSingle(d[b],c[b],a)}}else{this._ajaxRestPostfilterSingle(d,c,a)}},_ajaxRestPostfilterSingle:function(c,b,a){this._ajaxRestPostfilterCommon(c,b,a);if(this._isRootGroupRequest(c,a)){if(!!a.allGroup){this._ajaxRestPostfilterAllGroup(c,b,a)}if(!!a.unassignGroup){this._ajaxRestPostfilterUnassignGroup(c,b,a)}}},_ajaxRestPostfilterCommon:function(e,c,b){var d=Number(c.allcnt);var f=Number(c.row)||0;var a=desknets.ajax.getJsonItems(c);if(f==e.row){c.list={item:a}}else{if(f<e.row){c.list={item:a.slice(e.row-f)}}else{c.list={item:[]}}}c.allcnt=!!d?d:c.list.item.length},_ajaxRestPostfilterAllGroup:function(c,b,a){b.allcnt++;if(c.row==0){b.list.item.unshift({id:"all",children:"0",parent:"",Name:a.allGroupLabel})}},_ajaxRestPostfilterUnassignGroup:function(c,b,a){b.allcnt++;if(!c.num||c.num>b.list.item.length){b.list.item.push({id:"0",children:"0",parent:"",Name:a.unassignGroupLabel})}},_isRootGroupRequest:function(b,a){if(b.cmd==a.cmdgrouptree){return true}if(b.cmd==a.cmdgroups&&!b.pgid&&b.area=="2"){return true}return false},_getChooserDialogOptions:function(b){var a=this,c={};c[desknets.Resource.OKButtonLabel]=function(){var d=$(this);desknets.pageframe.executeOnTipShown(function(){a._onChooseItems(d,b)})};c[desknets.Resource.CancelButtonLabel]=function(){a.close($(this),false)};return{buttons:c,dialogClass:"dn-dialog co-sel-dialog",title:b.title||desknets.Resource.selectLabel,width:800,open:b.open,close:function(){DNNEO.neo.ajax.abort("desknets-chooser",true)}}},_onChooseItems:function(d,b){var a=d.children().dnChooser("items");var c=$.Event("choose.dnChooser");if(!this._validate(a,d)){return}d.trigger(c,[a]);if(!c.isDefaultPrevented()){if(b.chooseHistory||b.chooseHistory==undefined){this.close(d,true)}else{this.close(d,false)}}},_setUpChooseEvent:function(a,b){if($.isFunction(b)){a.bind("choose.dnChooser",function(e,d){var c=b.apply(this,[d]);if(c===false){e.preventDefault()}})}},_validate:function(a,e){var b=e.find(".co-sel").dnChooser("option");var f=b.chooseTarget;if(b.mode=="single"&&a.length<=0){var c=f.join("_");var d=desknets.Resource.Message["com_chooser_required_"+c];desknets.dialog.alert(d);return false}return true}};$.widget("desknets.dnChooser",{_TMPL:"com/chooser.html",_MAX_HISTORY:20,_tabs:null,_activeTab:null,_$choosenList:null,options:{items:[],lockedItems:[],chooseTarget:["user"],mode:"multi",search:true,chooseGroup:true,choosePrivateGroup:false,chooseDisplayGroup:false,chooseHistory:true,selectedTabIndex:-1,allGroup:null,unassignGroup:null,defaultGroupId:"",choosenListPlugIn:"dnChooserChoosenList",itemListPlugIn:"dnChooserItemList",module:desknets.chooser.MODULE,cmdusers:desknets.chooser.CMD_USERS,cmdgroups:desknets.chooser.CMD_GROUPS,cmdgrouptree:desknets.chooser.CMD_GROUPTREE},_create:function(){var a=this;a._tabs=[];a.element.addClass("co-sel co-sel-"+a.options.mode);desknets.tmpl.load(a.element,a._TMPL,function(){a._createLayout(a.element.find(".co-sel-content"));a._createChoosenList(a.element.find(".co-sel-bottom"));a._createTabs(a.element.find(".co-sel-tabs"));a._trigger("load")},{cache:true})},items:function(a){if($.isArray(a)){if(this._$choosenList!=null){this._$choosenList[this.options.choosenListPlugIn]("items",a)}return this}else{return this._getItems()}},_createLayout:function(b){var a=this;b.layout({zIndex:0,size:220,minSize:120,maxSize:560,spacing_open:12,resizerTip:desknets.Resource.resizeWidthLabel,closable:false,scrollToBookmarkOnLoad:false,onresize_end:function(){a._activeTab.resizeMenu()}});if(this.options.mode=="single"){b.find(".co-sel-bottom").remove()}else{b.find(".co-sel-center").layout({zIndex:0,size:220,minSize:80,maxSize:360,spacing_open:12,resizerTip:desknets.Resource.resizeHeightLabel,scrollToBookmarkOnLoad:false,closable:false})}},_createChoosenList:function(c){var a=this;if(a.options.mode!="single"){var b=$.extend({},a.options,{editDescendant:a.options.editDescendant&&$.inArray("group",a.options.chooseTarget)>=0,change:function(){a._updateSelectedItemsInActiveTab()}});a._$choosenList=$("<div />").appendTo(c);a._$choosenList[a.options.choosenListPlugIn](b)}},_createTabs:function(c){var b=this,a;if(this.options.extraTab){this._createExtraTab(c,this.options.extraTab)}if(this.options.search){this._createTab(c,desknets.chooser.searchTabItem)}if(this.options.chooseGroup){this._createTab(c,desknets.chooser.treeTabItem)}if($.inArray("role",this.options.chooseTarget)>=0){this._createTab(c,desknets.chooser.roleTabItem)}if(this.options.choosePrivateGroup){this._createTab(c,desknets.chooser.privateGroupTabItem)}if(this.options.chooseDisplayGroup){this._createTab(c,desknets.chooser.displayGroupTabItem)}if(this.options.chooseHistory){this._createTab(c,desknets.chooser.historyTabItem)}c.delegate("li","click",function(d){d.preventDefault();b._selectTab($(this));b._saveTabSelection()});a=c.children("li:not(.co-sel-disabled)");if(a.length<=this.options.selectedTabIndex){this.options.selectedTabIndex=0}this.element.on("dnchooseritemlistload",function(d){b._updateSelectedItemsInActiveTab()});this._selectTab(this._getDefaultTabSelection(a))},_createExtraTab:function(a,b){b.item.rootClass="co-sel-extra";this.element.find(".co-sel-tabs>.co-sel-extra>a").text(b.title);this._createTab(a,b.item)},_createTab:function(c,d){var b=".co-sel-tabs>."+d.rootClass;var a=$.extend({},d);this.element.find(b).removeClass("co-sel-disabled");a.init(this.element,this.options);this._tabs.push(a)},_selectTab:function(b){var a=b.prevAll("li:not(.co-sel-disabled)").length;if(this._activeTab!=null){this._activeTab.hide();this._setSelectedItemsInActiveTab([]);b.siblings(".on").removeClass("on")}this._activeTab=this._tabs[a];this._updateSelectedItemsInActiveTab();this._activeTab.show();b.addClass("on")},_updateSelectedItemsInActiveTab:function(){if(!!this._$choosenList){var a=this._$choosenList[this.options.choosenListPlugIn]("items");this._setSelectedItemsInActiveTab(a)}},_setSelectedItemsInActiveTab:function(a){if(!!this._activeTab){this._activeTab.$itemList.dnChooserItemList("select",a)}},_getDefaultTabSelection:function(a){var d,b,c;b=this.options.selectedTabIndex;if(0<=b&&b<a.length){return a.eq(b)}c=desknets.storage.loadData(desknets.storage.FIELD_CHOOSER_TAB);d=a.filter("."+c);if(d.length==1){return d}d=a.filter("."+desknets.chooser.treeTabItem.rootClass);if(d.length==1){return d}return a.eq(0)},_saveTabSelection:function(){if(!!this._activeTab&&!!this._activeTab.rootClass){desknets.storage.saveData(desknets.storage.FIELD_CHOOSER_TAB,this._activeTab.rootClass)}},_getItems:function(){var b,a=null;if(this._$choosenList!=null){return this._$choosenList[this.options.choosenListPlugIn]("items")}b=this.element.find(".co-sel-chooser-items").filter(function(){return $(this).css("display")!="none"});if(b.length>0){a=b[this.options.itemListPlugIn]("getSelected")}return !!a?[a]:[]},_filterHistory:function(b){var a=this,c=[];var d={group:{num:0,id:{}},role:{num:0,id:{}},user:{num:0,id:{}}};$.each(b,function(f,g){var e=d[g.type];if(!!e&&e.num<a._MAX_HISTORY&&!e.id[g.id]){c.push({id:g.id,type:g.type,name:g.name,description:g.description});d[g.type].num++;d[g.type].id[g.id]=true}});return c}});desknets.chooser.tabItem={$sideMenu:$(),$itemList:$(),$pager:$(),rootClass:"",created:false,perPage:100,_linkToChild:false,_components:null,_$choosenList:$(),_options:null};desknets.chooser.tabItem.init=function(c,b){var a;this._$choosenList=c.find(".co-sel-choosen-items");this._options=$.extend({},b);this.$sideMenu=c.find(".co-sel-side ."+this.rootClass);a=c.find(".co-sel-pager");this.$pager=$("<div />").appendTo(a).hide();this.$pager.attr("class","co-page "+this.rootClass);a=c.find(".co-sel-top>.co-sel-explaination").eq(0);this.$itemList=$("<div />").insertBefore(a).hide();this.$itemList.attr("class",this.rootClass);this._components=[this.$sideMenu,this.$pager,this.$itemList]};desknets.chooser.tabItem.destroy=function(){if(this.$itemList!=null){this.$itemList.dnChooserItemList("destroy")}};desknets.chooser.tabItem.show=function(){if(!this.created){this.created=true;this._create(this._$chooserBase)}$.each(this._components,function(b,a){a.show()})};desknets.chooser.tabItem.hide=function(){$.each(this._components,function(b,a){a.hide()})};desknets.chooser.tabItem.resizeMenu=function(){};desknets.chooser.tabItem._create=function(){this._createSideMenu();this._createItemList();this._createPager();this._createOthers()};desknets.chooser.tabItem._createSideMenu=function(a){this.$sideMenu=$()};desknets.chooser.tabItem._createItemList=function(){var a=this;var b=$.extend({},a._options,{mode:(this._options.mode=="single")?"radio":"add",linkToChild:this._linkToChild,add:function(d,c){a._$choosenList[a._options.choosenListPlugIn]("add",c)},sourceChange:function(d){var c=a.$itemList.dnChooserItemList("getTotalPage");a._updatePager(1,c)},open:function(d,c){a._openGroup(c)}});this.$itemList.dnChooserItemList(b)};desknets.chooser.tabItem._createPager=function(){this._updatePager(0,0)};desknets.chooser.tabItem._createOthers=function(){};desknets.chooser.tabItem._openGroup=function(a){};desknets.chooser.tabItem._removeNonTargetElement=function(b){var a=["group","role","user"];for(var c=0;c<a.length;c++){if($.inArray(a[c],this._options.chooseTarget)<0){b.find(".jco-sel-target-"+a[c]).remove()}}};desknets.chooser.tabItem._updatePager=function(a,d){var b=this,c=100;desknets.Pager.output(this.$pager.parent(),"."+this.rootClass,{getCount:d>0?c:0,allCount:d*c,pageMaxView:c,startRow:(a-1)*c,clickFunc:function(e){b._changePage((e/c)+1)}})};desknets.chooser.tabItem._changePage=function(a){if(this.$itemList!=null){var b=this.$itemList.dnChooserItemList("getTotalPage");this.$itemList.dnChooserItemList("setPage",a);this._updatePager(a,b)}};desknets.chooser.groupListTabItem=$.extend({},desknets.chooser.tabItem,{_linkToChild:true,_area:"",_itemHtml:"",_groupItems:[],_$rootItem:$(),_$list:$()});desknets.chooser.groupListTabItem._createSideMenu=function(b){var a=this;this._$rootItem=this.$sideMenu.find("> ul > li").eq(0);this._$list=this.$sideMenu.find("> ul > li > ul");this.created=false;if(!this._itemHtml){this._itemHtml=this._$list.html();this._$list.empty()}this._$rootItem.children("a").click(function(c){c.preventDefault();a._openRootGroup()});this._$list.delegate("a","click",function(d){d.preventDefault();var c={id:$(this).closest("li").data("id")};a._openGroup(c)});this._createList()};desknets.chooser.groupListTabItem._openRootGroup=function(){this._$rootItem.addClass("on");this._$list.children().removeClass("on");this.$itemList.dnChooserItemList("setItems",this._groupItems)},desknets.chooser.groupListTabItem._openGroup=function(a){if($.inArray("user",this._options.chooseTarget)>=0){this._$rootItem.removeClass("on");this._$list.children().each(function(){var b=$(this);if(b.data("id")==a.id){b.addClass("on")}else{b.removeClass("on")}});this.$itemList.dnChooserItemList("setDataSources",{user:{cmd:this._options.cmdusers,gid:a.id,num:this.perPage}})}};desknets.chooser.groupListTabItem._createList=function(){var a=this;var c={cmd:a._options.cmdgroups,area:a._area};var b=desknets.getUrl(a._options.module);desknets.chooser._ajaxRest(b,c,function(e){var d=desknets.ajax.getJsonItems(e);a._groupItems=a._convertItems(d);a._createListElement();a._openRootGroup();a.created=true},a._options)};desknets.chooser.groupListTabItem._createListElement=function(){if($.inArray("user",this._options.chooseTarget)>=0){this._$list.html(this._getListHtml(this._groupItems))}};desknets.chooser.groupListTabItem._convertItems=function(a){var b=[];$.each(a,function(c,d){b.push(desknets.chooser.convertGroupItem(d))});return b};desknets.chooser.groupListTabItem._getListHtml=function(b){var a=this,c=[];$.each(b,function(d,f){var e=a._itemHtml;var g=desknets.chooser._getSubType(f);e=desknets.tmpl.replaceWordHtml(e,"id",f.id);e=desknets.tmpl.replaceWord(e,"name",f.name);e=desknets.tmpl.replaceWordHtml(e,"subType",g);c.push(e)});return c.join("")};desknets.chooser.searchTabItem=$.extend({},desknets.chooser.tabItem,{rootClass:"co-sel-search",_$explaination:null});desknets.chooser.searchTabItem._createSideMenu=function(b){var a=this;a._removeNonTargetElement(a.$sideMenu);a.$sideMenu.find("dl:last").addClass("active");a._initFields();this.$sideMenu.find("input:text").bind("focus",function(c){a._updateActiveFieldSet($(this).closest("dl"))});this.$sideMenu.find("form").bind("submit",function(c){c.preventDefault();a._beginToSearch()})};desknets.chooser.searchTabItem._createOthers=function(){var a=this;a._$explaination=a.$itemList.siblings(".co-sel-search.co-sel-explaination");a._initUserGuide();$.each(a._options.chooseTarget,function(b,c){a._$explaination.addClass("co-sel-search-"+c)});a._components.push(a._$explaination)};desknets.chooser.searchTabItem._initFields=function(){this.$sideMenu.find(".co-guide-label").each(function(){var a=$(this);desknets.user.removeFieldIfHidden(a,a.next())})};desknets.chooser.searchTabItem._initUserGuide=function(){var a=[],c="";var b=this._$explaination.find(".co-sel-msg-user");this.$sideMenu.find(".jco-sel-target-user .co-guide-label").each(function(){a.push('"'+$(this).text()+'"')});c=b.text();c=desknets.tmpl.replaceWordHtml(c,"fields",a.join(desknets.Resource.comma));b.text(c)};desknets.chooser.searchTabItem._updateActiveFieldSet=function(a){a.siblings().removeClass("active");a.addClass("active")};desknets.chooser.searchTabItem._beginToSearch=function(){var a=this,b={},d="group";var c=this.$sideMenu.find("dl.active");var e={cmd:this._options.cmdgroups,num:this.perPage};c.find("input").each(function(){e[this.name]=this.value});if(c.hasClass("co-sel-search-users")){e.cmd=this._options.cmdusers;d="user"}b[d]=e;this.$itemList.dnChooserItemList("setDataSources",b);this._$explaination.addClass("searched")};desknets.chooser.treeTabItem=$.extend({},desknets.chooser.tabItem,{rootClass:"co-sel-groups",_linkToChild:true,_tree:null,_$parentButton:$(),_lastID:null});desknets.chooser.treeTabItem._createSideMenu=function(b){var a=this;a.created=false;a._createTree();a.$itemList.bind("dnchooseritemlistsourcechange",function(c){a._tree.openItemById(a._lastID)})};desknets.chooser.treeTabItem._createOthers=function(){var a=this;var b=a._options.defaultGroupId;a._$parentButton=a.$itemList.siblings(".co-sel-groups.co-sel-parent-button");a._components.push(a._$parentButton);a._$parentButton.find(".jco-sel-go-parent").click(function(c){c.preventDefault();a._tree.selectParent()});if(!!b){a.$itemList.one("dnchooseritemlistsourcechange",function(c){a.$itemList.dnChooserItemList("select",b,"group")})}};desknets.chooser.treeTabItem.resizeMenu=function(){this._tree.resize()};desknets.chooser.treeTabItem._createTree=function(){var a=this;a._tree=$.extend({},desknets.groupTree);a._tree.options=$.extend({},a._options,{leafChoosable:$.inArray("user",a._options.chooseTarget)>=0});a._tree.init(a.$sideMenu,{idName:"data-id",isLag:false,selFunc:function(c){var b=!c.hasClass("jstree-leaf");a._getListItemsInGroup(c.data("id"),b)}});a.$sideMenu.find(".co-listview-items").bind("loaded.jstree",function(){a.created=true})};desknets.chooser.treeTabItem._openGroup=function(a){this._tree.selectItemById(a.id)};desknets.chooser.treeTabItem._getListItemsInGroup=function(c,b){var a={};c=DNNEO.neo.isSet(c)?String(c):"";this._lastID=c;if(c!=="all"&&c!=="0"&&b){a.group={cmd:this._options.cmdgroups,area:"2",pgid:c,num:this.perPage}}if($.inArray("user",this._options.chooseTarget)>=0&&c!==""){a.user={cmd:this._options.cmdusers,gid:c,num:this.perPage}}if(!$.isEmptyObject(a)){this.$itemList.dnChooserItemList("setDataSources",a)}else{this._tree.openItemById(this._lastID)}};desknets.chooser.roleTabItem=$.extend({},desknets.chooser.tabItem,{rootClass:"co-sel-roles",_$history:$(),_$all:$()});desknets.chooser.roleTabItem._createSideMenu=function(b){var a=this;a._$history=this.$sideMenu.find(".co-sel-role-history");a._$all=this.$sideMenu.find(".co-sel-all-roles");if(!a._options.chooseHistory){a._$history.hide()}a._$history.find("a").click(function(c){c.preventDefault();a._beginToGetFromHistory()});a._$all.find("a").click(function(c){c.preventDefault();a._beginToGetFromList()});setTimeout(function(){a._beginToGetFromList()},0)};desknets.chooser.roleTabItem._beginToGetFromHistory=function(){var a=this;desknets.chooser.loadHistory(["role"],this._options,function(b){a.$itemList.dnChooserItemList("setItems",b);a._$history.addClass("on");a._$all.removeClass("on")})};desknets.chooser.roleTabItem._beginToGetFromList=function(){var a={cmd:desknets.chooser.CMD_ROLE,num:this.perPage};if(!!this._options.noAdministrators){a.noadmin="1"}if(!!this._options.noEveryone){a.noeveryone="1"}this.$itemList.dnChooserItemList("setDataSources",{role:a});this._$all.addClass("on");this._$history.removeClass("on")};desknets.chooser.privateGroupTabItem=$.extend({},desknets.chooser.groupListTabItem,{rootClass:"co-sel-private-groups",_area:"1"});desknets.chooser.privateGroupTabItem._convertItems=function(a){var b=[];$.each(a,function(c,d){var e=desknets.chooser.convertGroupItem(d);e.id=-Math.abs(Number(e.id));b.push(e)});return b};desknets.chooser.displayGroupTabItem=$.extend({},desknets.chooser.groupListTabItem,{rootClass:"co-sel-display-groups",_area:"3"});desknets.chooser.historyTabItem=$.extend({},desknets.chooser.tabItem,{rootClass:"co-sel-history"});desknets.chooser.historyTabItem._createSideMenu=function(b){var a=this;a._removeNonTargetListItem();a.$sideMenu.delegate("li","click",function(c){c.preventDefault();a._beginToGetFromHistory($(this).closest("li"))});setTimeout(function(){var c=a.$sideMenu.find("li").eq(0);a._beginToGetFromHistory(c)},0)};desknets.chooser.historyTabItem._removeNonTargetListItem=function(){this._removeNonTargetElement(this.$sideMenu);if(this._options.chooseTarget.length<=1){this.$sideMenu.find("li").slice(1).remove()}};desknets.chooser.historyTabItem._beginToGetFromHistory=function(d){var b=this;var c=d.data("area");var a=!!c?[c]:b._options.chooseTarget;desknets.chooser.loadHistory(a,b._options,function(e){b.$itemList.dnChooserItemList("setItems",e)});d.siblings().removeClass("on");d.addClass("on")};$.widget("desknets.dnChooserItemList",{_TMPL:"com/chooser.itemList.",_$tbody:null,_itemHtml:null,_loaded:false,_pageNo:1,_totals:null,_sources:null,_selectedItems:null,options:{allGroup:null,chooseTarget:["user"],editDescendant:false,mode:"add",linkToChild:false,perPage:100,unassignGroup:null},_create:function(){var b=this;var a=b._TMPL+b.options.mode+".html";b.element.addClass("co-sel-chooser-items");if(b.options.editDescendant){b.element.addClass("co-sel-edit-descendant")}desknets.tmpl.load(b.element,a,function(){b._$tbody=b.element.find("tbody");b._itemHtml=b._$tbody.find("script").html();b._$tbody.empty();b._createEvents();b._setUpClasses();b._loaded=true;b._trigger("load")},{cache:true})},destroy:function(){this.element.find("thead .add-all").unbind("click");this._$tbody.undelegate(".add-item","click");this._$tbody.undelegate("tr.group .namelink","click");this.element.empty()},setItems:function(b){var a=this;if(!a._loaded){a.element.bind("dnchooseritemlistload",function(){a.setItems(b)});return}a._totals={};a._sources=null;this._$tbody.empty();$.each(b,function(c,d){a._addItemElement(d)});this._onReplaceList();this._trigger("sourceChange")},setDataSources:function(b){var a=this;var c=DNNEO.neo.array.getKeyArray(b);var d=DNNEO.neo.array.getValueArray(b);a._getList(c,d,function(){a._totals={};a._sources=b;a._pageNo=1},function(){a._onReplaceList();a._trigger("sourceChange")})},setPage:function(a){a=this._coercePageNo(a);var j=this;var b=(a-1)*this.options.perPage;var d=b+this.options.perPage;var h=0,g=[],c=[];this._pageNo=a;for(var i in this._sources){var f=h+this._totals[i];if(h<d&&b<f){var e=$.extend({},this._sources[i]);e.row=Math.max(b-h,0);g.push(i);c.push(e)}h=f}this._getList(g,c,null,function(){j._onReplaceList()})},getTotalPage:function(){var a=0;if(this._sources==null){return this._$tbody.children().length>0?1:0}for(var b in this._totals){a+=this._totals[b]}return Math.ceil(a/this.options.perPage)},getSelected:function(){var a=null;if(this.options.mode=="radio"){a=this._$tbody.find("tr.co-tr-selected").data("item");a=!!a?a:null}return a},select:function(d,b){var c=d,a={};if(!$.isArray(d)){c=[{id:d,type:b}]}$.each(c,function(e,f){a[f.type+f.id]=true});this._selectedItems=a;if(this.options.mode=="radio"){this._updateRadio()}else{this._updateListItems()}},_createEvents:function(){var a=this;this.element.find("thead .add-all").click(function(b){b.preventDefault();a._onAddAllItems()});this._$tbody.on("dblclick","tr",function(b){b.preventDefault();var c=$(b.target).closest("a");if(c.css("cursor")!="pointer"){a._onClickRow($(this))}});this._$tbody.delegate(".add-item","click",function(b){b.preventDefault();a._onAddItem($(this).closest("tr"),"")});this._$tbody.delegate(".add-descendant","click",function(b){b.preventDefault();a._onAddItem($(this).closest("tr"),"all")});this._$tbody.on("click","input:radio",function(c){var b=$(this).closest("tr").data("item");a.select([b])});this._$tbody.delegate("tr.group .namelink","click",function(c){c.preventDefault();var b=$(this).closest("tr").data("item");a._trigger("open",null,b)})},_setUpClasses:function(){var a=this.element.find(".co-sel-table-list");var b=this.options.choosePrivateGroup;$.each(this.options.chooseTarget,function(c,d){a.addClass(d+"-choosable")});if(!!b&&b!="readonly"&&a.hasClass("group-choosable")){a.addClass("private-group-choosable")}},_getList:function(d,g,c,f){var a=this;var e=(g.length==1)?g[0]:g;var b=desknets.getUrl(this.options.module);desknets.chooser._ajaxRest(b,e,function(h){if(typeof c=="function"){c()}var i=!!h["0"]?h:{"0":h};a._$tbody.empty();a._processResponses(d,i);if(typeof f=="function"){f()}},a.options)},_processResponses:function(b,c){var a=this;var d=a.options.perPage;$.each(b,function(e,g){var f=c[e.toString()];d=a._processResponse(g,f,d)})},_processResponse:function(e,d,g){var b=this;var a=d.list.item;this._totals[e]=d.allcnt;for(var c=0;c<g&&c<a.length;c++){var f=b._convertJsonItem(a[c],e);if(!!f){b._addItemElement(f)}}return g-c},_addItemElement:function(f){var b=$("<tr />"),e=this._itemHtml;var a="name-text namelink";var d=f.type+" "+desknets.chooser._getSubType(f);var c=$.inArray("user",this.options.chooseTarget)>=0;var g="allDescendantsLabel";if(d.indexOf("private-group")>=0){g="privateGroupUsersLabel"}else{if($.inArray("group",this.options.chooseTarget)<0){g="descendantUsersLabel"}}if(f.type=="user"){a+=" jco-ref-dialog-link"}e=desknets.tmpl.replaceWord(e,"id",f.id);e=desknets.tmpl.replaceWord(e,"type",f.type);e=desknets.tmpl.replaceWord(e,"name",f.name);e=desknets.tmpl.replaceWordHtml(e,"description",f.description);e=desknets.tmpl.replaceWord(e,"descendantLabel",desknets.Resource.chooser[g]);e=desknets.tmpl.replaceWordHtml(e,"linkClasses",a);if(this.options.linkToChild&&f.type=="group"&&(!!f.hasChildren||c)){d+=" co-sel-has-children"}b.attr("class",d);b.data("item",f).html(e).appendTo(this._$tbody);this._updateSpecialGroup(b,f)},_updateSpecialGroup:function(a,b){if(b.type=="group"){if(b.id=="all"&&this.options.allGroup=="readonly"){a.find(".co-sel-button").addClass("co-sel-readonly")}if(b.id=="0"&&this.options.unassignGroup=="readonly"){a.find(".co-sel-button").addClass("co-sel-disabled co-sel-readonly")}}},_onReplaceList:function(){var a=this._$tbody.closest(".co-sel-list-scroll");a.scrollTop(0);a.scrollLeft(0);if(!!this._selectedItems&&this.options.mode=="add"){this._updateListItems()}},_updateListItems:function(){var a=this;this._$tbody.children("tr").each(function(){var c=$(this);var b=c.data("item");if(!!b&&!!a._selectedItems[b.type+b.id]){c.addClass("co-tr-selected")}else{c.removeClass("co-tr-selected")}})},_updateRadio:function(){var b=this;var a=b._$tbody.children("tr").filter(function(){var c=$(this).data("item");return !!b._selectedItems[c.type+c.id]});a.siblings().removeClass("co-tr-selected");a.addClass("co-tr-selected");a.find("input:radio").attr("checked",true)},_onClickRow:function(b){var a=b.find("input:radio");var c=b.find("td.co-sel-button>*");if(a.length>0){a.prop("checked",true).click()}if(c.css("visibility")=="visible"){this._onAddItem(b,"")}},_onAddAllItems:function(){var a=this,f=[],b=[];if(!this._sources||this.getTotalPage()<=1){this._triggerAdd(a._$tbody.children(),"")}else{var d=$.extend({},a.options,{allGroup:null});d.unassignGroup=d.unassignGroup=="choosable"?"choosable":null;for(var c in this._sources){if($.inArray(c,this.options.chooseTarget)>=0){var e=$.extend({},this._sources[c],{row:0});if(typeof e.num!="undefined"){delete e.num}f.push(e);b.push(c)}}if(f.length>0){desknets.chooser._ajaxRest(desknets.getUrl(this.options.module),f,function(g){a._triggerAddByJson(g,b)},d)}}},_onAddItem:function(a,b){var c=a.data("item");var d=a.find("td.co-sel-button>*");if(b==""&&a.find(".co-sel-button").hasClass("co-sel-readonly")){this._triggerAddChildren(c.id,b)}else{if(b=="all"&&$.inArray("group",this.options.chooseTarget)<0){this._triggerAddChildren(c.id,b)}else{if(d.css("visibility")=="visible"){this._triggerAdd(a,b)}}}},_triggerAdd:function(d,c){var b=this,a=[];var e=this.element.find(".co-sel-table-list").hasClass("private-group-choosable");d.each(function(){var g=$(this);var f=g.data("item");if(g.find(".co-sel-button").hasClass("co-sel-readonly")){return}if(!f||$.inArray(f.type,b.options.chooseTarget)<0){return}if(f.type=="group"&&Number(f.id)<0&&!e){return}if(b.options.editDescendant){f.descendant=c}a.push(f)});this._trigger("add",null,a)},_triggerAddChildren:function(d,c){var a=this;var b=desknets.getUrl(this.options.module);desknets.ajax.rest({url:b,data:{cmd:this.options.cmdusers,gid:d,descendant:c=="all"?"1":undefined},success:function(e){a._triggerAddByJson(e,["user"])}})},_triggerAddByJson:function(f,e){var d,c=[],b=this;var a=!!f["0"]?f:{"0":f};for(d=0;d<e.length&&!!a[d.toString()];d++){$.each(desknets.ajax.getJsonItems(a[d.toString()]),function(g,h){c.push(b._convertJsonItem(h,e[d]))})}b._trigger("add",null,c)},_convertJsonItem:function(d,b){var c={group:"convertGroupItem",role:"convertRoleItem",user:"convertUserItem"};var a=c[b];return !!a?desknets.chooser[a](d):null},_coercePageNo:function(a){a=Math.floor(a);return Math.min(Math.max(a,1),this.getTotalPage())}});$.widget("desknets.dnChooserChoosenList",{_TMPL:"com/chooser.choosenList.html",_$tbody:null,_initialized:false,_itemHtml:null,_choosenItems:null,_lockedItems:null,options:{editDescendant:false,items:[],lockedItems:[]},_create:function(){var a=this;a.element.addClass("co-sel-choosen-items");if(a.options.editDescendant){a.element.addClass("co-sel-edit-descendant")}desknets.tmpl.load(a.element,a._TMPL,function(){a._$tbody=a.element.find("tbody");a._itemHtml=a._$tbody.children().html();a._createEvents();a._createLockedItems();if(a.options.editDescendant){a._createDescendantOptions()}a._setItems(a.options.items);a._initialized=true},{cache:true})},destroy:function(){this.element.find("thead .remove-all").unbind("click");this._$tbody.undelegate(".remove","click");this.element.empty()},items:function(a){if($.isArray(a)){this._setItems(a);return this}else{return DNNEO.neo.array.getValueArray(this._choosenItems)}},add:function(a){if(!$.isArray(a)){a=[a]}this._addItems(a)},_createDescendantOptions:function(){var a=this.element.find("script.jco-sel-descendant-drop-down");if($("#co-sel-descendant-options").length<=0){$(a.html()).appendTo("body")}a.remove()},_createEvents:function(){var a=this;this.element.find("thead .remove-all").click(function(b){b.preventDefault();a._removeAllItems()});this._$tbody.delegate(".remove-item","click",function(b){b.preventDefault();a._removeSelectedItem($(this))});this._$tbody.delegate(".co-select-menu","change.selectMenu",function(b){a._updateDescendantState($(this).closest("tr"))})},_createLockedItems:function(){var a=this;a._lockedItems={};$.each(this.options.lockedItems,function(b,c){a._lockedItems[c.type+"-"+c.id]=true})},_setItems:function(a){this._$tbody.empty();this._choosenItems={};this._addItems(a)},_addItems:function(b){var a=this;$.each(b,function(c,e){var d=e.type+"-"+e.id;a._filterItem(e);if(a._choosenItems[d]){a._updateItem(d,e)}else{a._addItem(d,e)}});a._onChangeItems()},_removeAllItems:function(){var a=this;a._$tbody.children().each(function(){a._removeItem($(this))});a._onChangeItems()},_removeSelectedItem:function(a){this._removeItem(a.closest("tr"));this._onChangeItems()},_filterItem:function(a){if(this.options.editDescendant&&a.type=="group"&&Number(a.id)>0){a.descendant=(a.descendant=="all")?"all":""}else{a.descendant=undefined}},_onChangeItems:function(){if(this._initialized){this._trigger("change")}},_updateDescendantState:function(a){var b=a.data("type")+"-"+a.data("id");if(this._choosenItems[b]){this._choosenItems[b].descendant=a.find(".co-select-menu").data("value")}},_addItem:function(a,c){var d=desknets.chooser._getSubType(c);var b=$("<tr />");b.attr("class",c.type+" "+d).html(this._itemHtml);b.data("id",c.id).data("type",c.type).appendTo(this._$tbody);if(!!this._lockedItems[a]){b.addClass("locked")}this._updateItemElement(b,c);this._choosenItems[a]=c},_updateItem:function(a,c){var b=this._$tbody.children().filter(function(){var d=$(this);return d.data("id")==c.id&&d.data("type")==c.type});this._updateItemElement(b,c);this._choosenItems[a]=c},_removeItem:function(a){var b=a.data("type")+"-"+a.data("id");if(!this._lockedItems[b]){delete this._choosenItems[b];a.remove()}},_updateItemElement:function(a,d){var f=a.find(".co-sel-name");var e=f.children(".name-text");var c=a.find(".co-sel-description");var b=this._convertText(d.name);f.attr("title",b);e.text(b).data("refid",d.type+d.id);if(d.type=="user"){e.addClass("namelink jco-ref-dialog-link")}c.html(d.description);if(this.options.editDescendant&&a.hasClass("shared-group")){desknets.popUp.setSelectValue(a.find(".co-select-menu"),d.descendant||"")}},_convertText:function(a){return DNNEO.neo.isSet(a)?desknets.escapeSpace(String(a),true):""}});desknets.chooser.Entry=function(d,b,c){var a=this._defaultOptions.template;a=desknets.tmpl.replaceWordHtml(a,"L_Delete",desknets.Resource.deselectLabel);this._defaultOptions.template=a;this.init(d,b,c);return this};desknets.chooser.Entry.convertItem=function(a){for(var b=0;b<a.length;b++){var c=String(a[b].description);a[b].descriptionAsText=desknets.escapeValue(desknets.stripTags(c))}};desknets.chooser.Entry.sortLoginUserTop=function(a){var c=[];var d,b;d=desknets.pageframe.getLoginUid();for(b=0;b<a.length;b++){if(a[b]["type"]=="user"&&a[b]["id"]==d){c.push(a[b]);break}}if(b==a.length){return a}for(var b=0;b<a.length;b++){if(a[b]["type"]=="user"&&a[b]["id"]==d){continue}c.push(a[b])}return c};desknets.chooser.entry={_$root:$(),_$items:$(),_options:null,_items:null,_defaultOptions:{change:null,dialogOptions:{},dialogID:"co-sel-chooser-dialog",extraVars:{group:{keyName:"gid"},role:{keyName:"rid"},user:{keyName:"uid"}},filter:null,initCreate:true,template:'<span class="co-selitem"><span class="co-selitem-text" title="{{name}}">{{name}}</span><a href="#" class="co-btn co-btn-close" title="{{L_Delete}}">x</a><input type="hidden" name="{{keyName}}" value="{{id}}" /></span>'},init:function(c,a,b){this._$root=c.addClass("co-sel-no-items");this._items=[];this._options=$.extend({},this._defaultOptions,b);this._$items=c.find(".jco-sel-items");this._initEvents(c.find(".jco-sel-btn"));if(this._options.initCreate){this.replaceItems(a)}this._updateElement()},destroy:function(){var a=$("#"+this._options.dialogID);if(a.length>0){desknets.chooser.destroyDialog(a)}this._$items.undelegate(".co-btn-close");this._$root.find(".jco-sel-btn").unbind("click")},getItems:function(){return this._items},replaceItems:function(a){if(this._isChanged(a)){this._$items.empty();this._addItemElements(a);this._items=a;this._updateElement(true)}},removeItems:function(d){var a={},c;d.each(function(){var e=$(this);c=e.data("type")+e.data("id");a[c]=true});for(var b=this._items.length-1;b>=0;b--){c=this._items[b].type+this._items[b].id;if(!!a[c]){this._items.splice(b,1)}}d.remove();this._updateElement(true)},_initEvents:function(b){var a=this;a._options.dialogOptions.choose=function(c){a._onChooseItem(c)};b.click(function(c){c.preventDefault();a._options.dialogOptions.items=a._items;desknets.chooser.open(a._options.dialogID,a._options.dialogOptions)});a._$items.delegate(".co-btn-close","click",function(c){c.preventDefault();a.removeItems(a._closestItem($(this)))})},_isChanged:function(a){if(this._items.length!=a.length){return true}for(var b=0;b<a.length;b++){for(var c in {id:"id",type:"type"}){if(this._items[b][c]!=a[b][c]){return true}}}return false},_onChooseItem:function(c){var b=this,a;if(typeof(b._options.filter)=="function"){a=b._options.filter(c,function(d){b.replaceItems(d)})}if(a!==false){b.replaceItems(c)}},_addItemElements:function(b){var a=this;$.each(b,function(d,e){var c=a._createItemElement(e);c.data("id",e.id).data("type",e.type);a._removeCloseButtonIfLocked(c,e);a._$items.append(c);c.on("mouseenter",function(f){var g=$(this);setTimeout(function(){g.addClass("hover")},0)});c.on("mouseleave",function(f){var g=$(this);setTimeout(function(){g.removeClass("hover")},0)})})},_createItemElement:function(d){var c=this._options.template;var a=$.extend({},d);a.iconType=desknets.chooser._getSubType(d);a.name=desknets.tmpl.escapeWord(a.name);if(!a.longName){a.longName=desknets.tmpl.escapeWord(desknets.chooser.getLongName(d))}if(typeof a.summary=="string"&&!a.summaryAsText){a.summaryAsText=desknets.escapeValue(desknets.stripTags(a.summary))}if(typeof a.description=="string"&&!a.descriptionAsText){a.descriptionAsText=desknets.escapeValue(desknets.stripTags(a.description))}if(!!this._options.extraVars[d.type]){$.extend(a,this._options.extraVars[d.type])}for(var b in a){c=desknets.tmpl.replaceWordHtml(c,b,a[b])}return $(c)},_updateElement:function(a){if(this._items.length>0){this._$root.removeClass("co-sel-no-items")}else{this._$root.addClass("co-sel-no-items")}if(!!a&&typeof(this._options.change)=="function"){this._options.change()}},_removeCloseButtonIfLocked:function(c,e){var b=this,d;var a=this._options.dialogOptions.lockedItems;if($.isArray(a)){for(d=0;d<a.length;d++){if(a[d].id==e.id&&a[d].type==e.type){c.find(".co-btn-close").remove()}}}},_closestItem:function(a){if(this._$items.length>0){while(a.length>0&&!a.is("html")){var b=a.parent();if(b.length>0&&b[0]==this._$items[0]){return a}a=b}}return $()}};desknets.chooser.Entry.prototype=desknets.chooser.entry;desknets.chooser._displayFields={assign:0};desknets.chooser.setUserFieldsToShow=function(b){var c={};var a=String(b).split(",");$.each(a,function(e,g){var h=g.split(":");var d=h[0];var f=(a.length>1)?Number(h[1]):0;if(!!d&&(f>0||a.length==1)){c[d]=f}});this._displayFields=c};desknets.chooser.getItemsFromElement=function(d,c){var b=this,a=[];var e=$.extend({},c);d.find(".jco-sel-item").each(function(){var f=$(this),j={};var h={id:f.data("id"),type:"user",name:f.data("name")||"",description:f.data("description")||"",summary:""};if(typeof h.id=="string"&&h.id.match(/^[a-z]/)){var g={g:"group",r:"role"};h.type=g[h.id.charAt(0)]||"user";h.id=Number(h.id.substring(1))||0}if(h.type=="user"){if(!DNNEO.neo.isSet(h.description,{blank:false})){for(var i in b._displayFields){j[i]=f.data(i.toLowerCase())}h.description=b.convertUserDescription(j)}h.summary=f.data("assign")||""}else{h.description=desknets.tmpl.escapeWord(h.description);h.summary=h.description}if(typeof e.itemFilter=="function"){h=e.itemFilter(h,f)}a.push(h)});return a};desknets.chooser.convertGroupItem=function(b){var a={id:b.id,type:"group",name:b.Name,description:"",summary:"",hasChildren:false};if(!!b.parent){a.description=desknets.tmpl.escapeWord(b.parent)}a.summary=a.description;if(!!b.children){a.hasChildren=b.children>0}return a};desknets.chooser.convertRoleItem=function(b){var a={id:b.id,type:"role",name:b.Name,description:"",hasChildren:false};if(!!b.memo){a.description=desknets.tmpl.escapeWord(b.memo)}a.summary=a.description;return a};desknets.chooser.convertUserItem=function(b){var a={id:b.id,type:"user",name:b.Name,description:this.convertUserDescription(b),summary:"",hasChildren:false};if(!!b.assigngrp&&!!b.assigngrp.Name){a.summary=this.convertAssignedGroups(b.assigngrp.Name)}return a};desknets.chooser.convertUserDescription=function(g){var d=[];for(var f in this._displayFields){var e=DNNEO.neo.isSet(g[f],{blank:false})?g[f]:"";var c=this._displayFields[f];var b='<span class="co-sel-user-field">{{value}}</span>';var a="_convertUserDescription_"+f;if(c>0){b='<span class="co-sel-user-field" style="width:{{width}}px" title="{{asText}}">{{value}}</span>';b=desknets.tmpl.replaceWordHtml(b,"width",String(c))}if(typeof this[a]=="function"){e=this[a](e,g);b=desknets.tmpl.replaceWordHtml(b,"value",e);b=desknets.tmpl.replaceWordHtml(b,"asText",desknets.escapeValue(desknets.stripTags(e)))}else{b=desknets.tmpl.replaceWord(b,"value",e);b=desknets.tmpl.replaceWord(b,"asText",e)}d.push(b)}return d.join("\n")};desknets.chooser.convertAssignedGroups=function(a){var b=desknets.user.getListAssignGroups(a);return b.assign};desknets.chooser.getLongName=function(a){if(a.type=="group"&&!!a.description){var b=$("<div/>").html(a.description).text();return String(b+"\u00A0-\u00A0"+a.name)}return String(a.name)};desknets.chooser._convertUserDescription_level=function(a,b){return desknets.Resource["userLevel_"+a]||""};desknets.chooser._convertUserDescription_assign=function(a,b){if(!a&&!!b.assigngrp&&!!b.assigngrp.Name){a=this.convertAssignedGroups(b.assigngrp.Name)}return a};desknets.chooser._convertUserDescription_gender=function(a,b){return desknets.Resource["userGender_"+a]||""};desknets.chooser._convertUserDescription_birthday=function(a,b){return !!a?desknets.dateTime.dispDateTime(a,"shortDateFormat"):""};desknets.chooser._MAX_HISTORY=20;desknets.chooser._histories={};desknets.chooser.loadHistory=function(d,c,f){var a=this;var e=[],b=[];$.each(d,function(g,h){e.push({cmd:"constructcmd"+h+"historylist"});b.push(h);if(h=="group"&&c.choosePrivateGroup=="choosable"){e.push({cmd:"constructcmdpgrouphistorylist"});b.push("pgroup")}});desknets.chooser._ajaxRest(desknets.getUrl(desknets.chooser.MODULE),e,function(g){f(a._getHistoriesFromMultiJson(g,b,c))},c)};desknets.chooser.saveHistory=function(b){var e=this._filterHistory(b);var d={cmd:"constructcmdsavehistory"};for(var c=0;c<e.length;c++){var a=(c+1).toString();d["id"+a]=e[c].id;d["type"+a]=e[c].type;d["Name"+a]=e[c].name;d["memo"+a]=e[c].description;if(e[c].type=="user"){d["summary"+a]=e[c].summary}}desknets.ajax.rest({url:desknets.getUrl(desknets.chooser.MODULE),data:d})};desknets.chooser._getHistoriesFromMultiJson=function(l,j,m){var f=0,e=[],b=[],g=[];for(f=0;!!l[String(f)];f++){b.push(desknets.ajax.getJsonItems(l[String(f)]));g.push(0)}for(;;){var a="",d=-1,h=false;var c,k;$.each(b,function(i,n){var o=n[g[i]];if(!!o&&a<String(o.updtime)){d=i;a=String(o.updtime)}});if(d<0){break}c=b[d][g[d]];k=j[d];if(k=="role"){if(!!m.noAdministrators&&c.id==desknets.DBVAL_ADMINISTRATORS_ROLE_ID){h=true}else{if(!!m.noEveryone&&c.id==desknets.DBVAL_EVERYONE_ROLE_ID){h=true}}}if(!h){e.push({id:k=="pgroup"?-c.id:c.id,type:k=="pgroup"?"group":k,name:c.Name,description:c.memo,summary:c.summary||c.memo})}g[d]++}return e};desknets.chooser._filterHistory=function(b){var a=this,c=[];var d={group:{num:0,id:{}},pgroup:{num:0,id:{}},role:{num:0,id:{}},user:{num:0,id:{}}};$.each(b,function(f,h){var g=Number(h.id)<0&&h.type=="group"?"pgroup":h.type;var e=d[g];if(h.type=="group"&&(h.id=="0"||h.id=="all")){return}if(!e||e.num>=a._MAX_HISTORY||!!e.id[h.id]){return}c.push({id:h.id,type:h.type,name:h.name,description:h.description,summary:h.summary});d[g].num++;d[g].id[h.id]=true});return c};(function(a){desknets.page(desknets,"tree",null,{$_root:null,$_tree:null,_defOptions:{idName:"id",selFunc:null,isLag:true,isOnAlready:false},_options:{},_firstTime:true,_timelag:true,_itemid:"",_isLag:true,_isOnAlready:false,_maxWidth:0,_objMove:{iTop:false,iLeft:false,treeOff:false,treeWidth:false,treeHeight:false},VAL_TREE_SHOWWIDTH:100,_tmplRoot:"",_tmplItem:"",init:function(e,c){var b=this;var d;b.$_root=e;b._options=a.extend({},b._defOptions,c);b._itemid=b._options.idName;d=b._getListParent();if(!DNNEO.neo.isSet(b.$_tree)){b.$_tree=d.find("."+b._getTreeItemName())}if(DNNEO.neo.isSet(b._options.isLag)&&b._options.isLag==false){b._isLag=false}b._create(d)},_getListParent:function(){if(DNNEO.neo.isSet(this.$_root)){return this.$_root.find(".co-listview-tree")}return a(".co-listview-tree")},_create:function(c){var b=this;var d=b.$_tree;c.hide();b._createSideMenu(d);b._createEventCommon(c);b._createEventOnItem(c)},_getTreeItemName:function(){return"co-listview-items"},_createSideMenu:function(c){var b=this;b._getSideTreeList(c);c.bind("open_node.jstree",function(d,f){var e=c.find("a.co-listview-item-inside");var g=f.rslt.obj;d.preventDefault();b._onOpenItem(c);a("li.co-listview-item").each(function(){var h=a(this);var i=h.children("ins");if(i.children("a").length==0&&h.hasClass("jstree-leaf")==false){i.append("<a href=#>&nbsp;</a>")}if(h.hasClass("jstree-leaf")){i.children("a").remove()}});setTimeout(function(){b._updateItemsWidth();b._updateScrollTopValue(g)},600);this._firstTime=false})},_getSideTreeList:function(c){var b=this;c.jstree({plugins:["html_data"]});c.bind("loaded.jstree",function(d,e){b._openNodeFirstTime(b._getListParent());b._selectFirstItem(c)})},_selectFirstItem:function(d){var b=this;var c;c=d.find("li.co-listview-item:not(.co-listview-tree-rootli-nosel)").eq(0);if(c.length==0){return}var e=c.attr(b._itemid);b.onSelectItemNoAjax(b._getListParent(),e);b._onSelectItem(null,c.children("a:first"))},_createEventCommon:function(c){var b=this;c.delegate(".co-listview-item>ins","click",function(d){b._createEventToggleIcon(d,a(this))});c.delegate(".co-listview-item>ins>a","click",function(d){d.preventDefault()})},_createEventOnItem:function(c){var b=this;var d="";var e;c.delegate("a.co-listview-item-inside","click",function(j){var f=a(this);var l=f.parent();var i=true;var g=desknets.TIME_GETLIST_LAG;if((b._firstTime==false&&f.hasClass("on")==true&&b._options.isOnAlready==false)||f.hasClass("co-tree-noselect")){j.preventDefault()}if(j.isDefaultPrevented()==true){return}j.preventDefault();if(DNNEO.neo.isSet(e)){clearTimeout(e)}c.find("a.co-listview-item-inside").removeClass("on");f.addClass("on");b._setButtonErea(f);if(b._timelag==false||b._isLag==false){b._selectItem(j,f)}else{var h=desknets.paramanalyzer.getHashParams();var k=a(".co-table-list");if(k.length>0){a('<div class="co-move-list-overlay" />').insertBefore(k)}e=setTimeout(function(){var m=desknets.paramanalyzer.getHashParams();if(d!=l.attr(b._itemid)){i=false}else{if(h.cmd!=m.cmd){i=false}}if(i==true&&b._timelag==true){b._selectItem(j,f)}},g)}d=l.attr(b._itemid);b._timelag=true})},_createEventToggleIcon:function(d,c){var b=this;d.preventDefault();if(c.parent().hasClass("jstree-closed")){setTimeout(function(){b._updateItemsWidth()},550)}},_selectItem:function(d,b){var c=this;b.attr("action","active");c._onSelectItem(d,b);c._updateItemsWidth();a(".co-move-list-overlay").remove()},_setButtonErea:function(b){},_onSelectItem:function(d,b){var c=this;if(c._options.selFunc&&a.isFunction(c._options.selFunc)){c._options.selFunc(b.parent())}},_updateItemsWidth:function(){var c=this;var d=c._getListParent();if(d.css("display")=="none"){return}var b=d.find("div.jstree");var g=0;a.each(b,function(h,j){g=g+a(this).height()});var f=d.closest("div.co-listview-left").width();if(g>d.height()){var e=desknets.listviewframe.getScrollBarWidth();f=f-e}b.css("min-width",f)},_updateScrollTopValue:function(f,j){var k=this;var l;if(!f||f.length==0){return}var d=desknets.listviewframe.getScrollBarWidth();if(d<=0&&!desknets.browser.tablet){return}if(DNNEO.neo.isSet(j)&&j.length>0){l=j}else{l=k._getListParent()}if(!l.hasClass("co-listview-tree")||l.css("display")=="none"){return}var c=f.offset();var b=l.offset();var h=l.height()-d;var g=c.top-b.top+f.height()-h;if(g>0){var i=l.scrollTop();if(f.height()>h){l.scrollTop(c.top-b.top+i)}else{l.scrollTop(g+i)}}else{if((c.top-b.top)<0){var e=l.children("div:first");if(e.length>0){l.scrollTop(c.top-e.offset().top)}}}g=c.left-b.left-l.width()-d+k.VAL_TREE_SHOWWIDTH;if(g>0){var i=l.scrollLeft();l.scrollLeft(i+g)}else{if(c.left<b.left){var e=l.children("div:first");l.scrollLeft(c.left-e.offset().left)}}},_onOpenItem:function(b){},_openNodeFirstTime:function(c){var b=this;this._firstTime=false;setTimeout(function(){b._getListParent().show();b._updateItemsWidth()},100)},_setUpScrollDraggable:function(c){var b=this;c.bind("mousemove.jstreeMove",function(g){if(a.vakata.dnd.is_drag&&b._objMove.treeOff!=false){var d=a(this);var f=b._objMove;var e=0;if(g.pageX+30>f.treeOff.left+f.treeWidth){if(f.iLeft){clearInterval(f.iLeft)}f.iLeft=setInterval(function(){e=d.scrollLeft();d.scrollLeft(e+a.vakata.dnd.scroll_spd)},100)}else{if(g.pageX-30<f.treeOff.left){if(f.iLeft){clearInterval(f.iLeft)}f.iLeft=setInterval(function(){e=d.scrollLeft();d.scrollLeft(e-a.vakata.dnd.scroll_spd)},100)}else{if(f.iLeft){clearInterval(f.iLeft)}}}if(g.pageY+30>f.treeOff.top+f.treeHeight){if(f.iTop){clearInterval(f.iTop)}f.iTop=setInterval(function(){e=d.scrollTop();d.scrollTop(e+a.vakata.dnd.scroll_spd)},100)}else{if(g.pageY-30<f.treeOff.top){if(f.iTop){clearInterval(f.iTop)}f.iTop=setInterval(function(){e=d.scrollTop();d.scrollTop(e-a.vakata.dnd.scroll_spd)},100)}else{if(f.iTop){clearInterval(f.iTop)}}}}});a("body").bind("mouseup.jstreeMove",function(e){var d=b._objMove;if(d.iLeft){clearInterval(d.iLeft)}if(d.iTop){clearInterval(d.iTop)}})},onSelectItemExternal:function(e,h,c,f){var d=this;var b=d.getItemObject_li(e,h,f);if(b.length==0){return}d._timelag=false;b.children("a:first").trigger("click");if(c==true){var g=a.jstree._reference(d.$_tree);g.open_node(b)}d._timelag=true},onSelectItemNoAjax:function(d,g,f){var c=this;var b=c.getItemObject_li(d,g,f);var e=b.children("a:first");if(e.hasClass("on")==false){d.find("a.co-listview-item-inside").removeClass("on");e.addClass("on")}c._updateScrollTopValue(b,d)},getItemObject_li:function(c,f,d){var b=this;var e=b._itemid;if(DNNEO.neo.isSet(d)&&DNNEO.neo.isSet(d.idName)){e=d.idName}return c.find("["+e+"="+f+"]").eq(0)},getItemTitle:function(c){var b="";if(DNNEO.neo.isSet(c)&&c.length>0){b=c.children("a:first").contents().filter(function(){return this.nodeType==3}).text()}return b}})})(jQuery);desknets.page(desknets,"groupTree",desknets.tree,{TMPL_ROOT_START:'<ul><li data-id="" class="jstree-open co-listview-item"><a href="#" class="co-listview-item-inside root-group">{{name}}</a>',TMPL_START:"<ul>",TMPL_ITEM:'<li data-id="{{id}}" class="jstree-{{state}} co-listview-item"><a href="#" class="co-listview-item-inside {{classes}} {{subType}}">{{name}}</a>',TMPL_ITEM_END:"</li>",TMPL_END:"</ul>",TMPL_ROOT_END:"</li></ul>",options:{},destroy:function(){if(!!this.$_tree&&this.$_tree.length>0){this.$_tree.unbind("loaded.jstree");this.$_tree.jstree("destroy")}},resize:function(){this._updateItemsWidth()},selectParent:function(){var a=this._getSelectedItem();a=a.parent().closest("li");if(a.length>0){a.children("a:first").trigger("click")}},selectItemById:function(b){var a=this.getItemObject_li(this.$_tree,b,this._options);a.children("a:first").trigger("click")},openItemById:function(b){var a=this.getItemObject_li(this.$_tree,b,this._options);if(a.length>0){this.$_tree.jstree("open_node",a)}},loadTree:function(d){var a=this;var c={cmd:this.options.cmdgrouptree,gid:this.options.defaultGroupId};var b=desknets.getUrl(this.options.module);desknets.chooser._ajaxRest(b,c,function(e){a._createTree(d,a._getFirstHtmlFromJson(e))},this.options)},getRequestParams:function(b){var a={cmd:this.options.cmdgroups,pgid:b.data("id"),area:"2"};desknets.ajax.addParamForCsrf(a);desknets.ajax.addParamForNoCache(a);return a},getHtmlFromJson:function(d){var b=this;var c=[];var a=desknets.ajax.getJsonItems(d);if(a.length<=0){return" "}c.push(b.TMPL_START);$.each(a,function(e,f){var h=b._getItemHtmlFromItemData(f);var g="";if(Number(f.children)>0){g=b.getHtmlFromJson(f)}c.push(h+g+b.TMPL_ITEM_END)});c.push(b.TMPL_END);return c.join("")},_getSideTreeList:function(b){var a=this;a.loadTree(b)},_selectOnLoaded:function(a){var c=this.options.defaultGroupId||"";var b=this.getItemObject_li(a,c,this._options);if(this._options.defaultSelectionRel=="parent"){b=b.parent().closest("li")}if(b.length<=0){b=a.find("li").eq(0)}b.children("a:first").trigger("click")},_createTree:function(d,c){var a=this;var b=desknets.getUrl(this.options.module);d.bind("loaded.jstree",function(e,f){a._selectOnLoaded(d);setTimeout(function(){d.closest(".co-listview-tree").show();a._updateItemsWidth()},1)});d.jstree({plugins:["html_data"],html_data:{data:c,ajax:{type:"POST",dataType:"json",url:b,data:function(e){return a.getRequestParams(e)},success:function(e){if(!e||e.status=="ng"){desknets.ajax.onError(e.errorno,e.errormessage);return'<li class="folder_dumy"></li>'}return a.getHtmlFromJson(e)},error:function(g,e,f){desknets.ajax.onError(g.status,neo.ajax.getErrorMessage(g))}}}});a.resize()},_getFirstHtmlFromJson:function(c){var b=this._getRootItemName();var d=this.getHtmlFromJson(c);if(this._options.showRoot){var a=this.TMPL_ROOT_START;a=desknets.tmpl.replaceWordHtml(a,"name",b);d=a+d+this.TMPL_ROOT_END}return d},_getRootItemName:function(){return desknets.Resource.folderselect.folderRoot},_getItemHtmlFromItemData:function(b){var e=this.TMPL_ITEM,d="leaf";var f=desknets.chooser._getSubType({id:b.id,type:"group"});var c=Number(b.children)>0;var g=this.options.leafChoosable!==false||c;var a=g?"":"co-tree-noselect";if(c){d=!!b.list&&!!b.list.item?"open":"closed"}e=desknets.tmpl.replaceWordHtml(e,"id",b.id);e=desknets.tmpl.replaceWordHtml(e,"state",d);e=desknets.tmpl.replaceWordHtml(e,"classes",a);e=desknets.tmpl.replaceWord(e,"name",b.Name);e=desknets.tmpl.replaceWordHtml(e,"subType",f);return e},_getSelectedItem:function(){return this.$_tree.find(".co-listview-item-inside.on").parent()}});desknets.groupTree._defOptions.showRoot=true;desknets.groupTree._defOptions.defaultSelectionRel="self";desknets.user={KEY_ASSIGNGROUP:"assigngrp",KEY_GROUP:"Group",KEY_NAME:"val",VAL_DEFGROUP:"1",_hiddenFields:null,getListAssignGroups:function(f){var k=this;var e=[];var j=[];var b;var i;var c;var g;var l="";var a="";var d={assign:"",assigntitle:""};var h;if(!DNNEO.neo.isSet(f)){return d}if($.isArray(f)){e=f}else{e[0]=f}b=e.length;for(i=0;i<b;i++){j=e[i];if(typeof j!="object"){g=j;h=false}else{g=j[k.KEY_NAME];h=true}if(l.length!=0){l=l+",\n";a=a+",&#x0A;"}g=desknets.tmpl.escapeWord(g);if(h&&j[k.KEY_GROUP]==k.VAL_DEFGROUP){c='<span class="co-busyo-def">'+g+"</span>"}else{c=g}l=l+c;a=a+g}d.assign=l;d.assigntitle=a;return d},removeFieldIfHidden:function(a,b){this._loadHiddenFields();if(this._isFieldToHide(a)){a.remove();if(!!b){b.remove()}}},_isFieldToHide:function(a){var b=a.data("fields");if(!b){return false}var d=b.split(",");for(var c=0;c<d.length;c++){if($.inArray(d[c],this._hiddenFields)<0){return false}}return true},_loadHiddenFields:function(){if($.type(this._hiddenFields)!="array"){this._hiddenFields=String(desknets.pageframe.getUserNoDispItems()).split(",")}return this._hiddenFields}};desknets.listviewframe={VAL_LISTVIEWFRAME_MINHEIGHT:330,VAL_LISTVIEWFRAME_BOTTOMBTN:80,VAL_LISTVIEWFRAME_HEAD:30,_barWidth:0,updateListHeight:function(a,e,d,j){var k=this;var i=a.find(".co-btnarea");if(i.length==0||i.offset().top==0){return}var f=i.outerHeight();var g=$(window).height()-a.offset().top-f-k.VAL_LISTVIEWFRAME_BOTTOMBTN;g=Math.max(g,this._getListViewMinHeight(a));a.height(g+f);var h=g+f;if(a.find(".co-listview-left-title").length>0){h=h-k.VAL_LISTVIEWFRAME_HEAD}if(e!==false){h=h-k.VAL_LISTVIEWFRAME_HEAD}if(j===true){h=h-k.VAL_LISTVIEWFRAME_HEAD}a.find(".co-listview-left-data").height(h);var c=g;if(d!=false){c=g-k.VAL_LISTVIEWFRAME_HEAD}var b=a.find(".co-listview-scroll");b.height(c)},updateListHeightScroll:function(b,c,d){var a=this;a.updateListHeight(b,c,d);a.updateListScrollWidth(b)},updateListScrollWidth:function(a){var k=this;var h=a.find(".co-listview-listhead").find(".co-table-list");var g=a.find(".co-listview-scroll");var c=g.find(".co-table-list");if(h.length==0||g.length==0){return}var j=h.find("tr:first").find("th:last");var b=c.find("tr:first").find("td:last");var d=g.scrollLeft();var f=k.getScrollBarWidth();var e=g.height();var i=c.height();if(e<i||(c.width()-g.width()>2&&i+f>e)){b.width(j.width()-f-1)}else{b.width(j.width()-1)}if(Number(d)>0){g.scrollLeft(d)}},updateInputHeight:function(d){var c=this;var b=d.find(".co-ebtnarea");if(b.length==0){b=d.find(".co-vbtnarea")}if(b.length==0||b.offset().top==0){return}var a=b.outerHeight();var e=d.find(".co-listview-edit").height();d.height(e);d.find(".co-listview-left").height(e);d.find(".co-listview-list").height(e);var f=e-a;d.find(".co-listview-left-data").height(f)},setListviewHeight:function(d){var a=d.find(".co-listview-list");if(a.length>0){a.height("auto");var b=a.closest(".co-listview"),f=30,g=a.outerHeight(),c=b.find(".co-listview-items").outerHeight(g-f),e=c.outerHeight();if(e>g){a.outerHeight(e+f)}}},setLeftTitleMenu:function(a){a.find(".co-listview-item-setlink").click(function(c){c.preventDefault();var b=$(this).find(".co-listview-item-setmenu");b.toggle();$(this).parent().hover(function(){},function(d){b.hide();$(this).unbind(d)})})},toggleLeftArea:function(a){a.find(".co-listview").toggleClass("co-listview-left-close")},showLeftArea:function(a){a.find(".co-listview").removeClass("co-listview-left-close")},getScrollBarWidth:function(){var a=this;if(!DNNEO.neo.isSet(a._barWidth)||a._barWidth<=0){var b=$('<div class="jco-listview-checker" />').css("overflow-x","scroll");b.appendTo(document.body);a._barWidth=b.height();$(".jco-listview-checker").remove()}return a._barWidth},_getListViewMinHeight:function(b){var a=String(b.css("min-height")).match(/^(\d+)px$/);return !!a&&a[1]>0?Number(a[1]):this.VAL_LISTVIEWFRAME_MINHEIGHT}};desknets.capacity={_tmpl:'<div id="co-capacity-detail"><table><tr><th class="co-capacity-th"><span class="co-colon">{{UseCapacity}}</span></th><td class="co-capacity-val">{{sUseSize}}</td><td class="co-capacity-percent">({{sUsePercent}})</td></tr><tr><th class="co-capacity-th"><span class="co-colon">{{FreeCapacity}}</span></th><td class="co-capacity-val">{{sFreeSize}}</td><td class="co-capacity-percent">&nbsp;</td></tr><tr><th class="co-capacity-th"><span class="co-colon">{{Capacity}}</span></th><td class="co-capacity-val">{{iLimitCapa}} MB</td><td class="co-capacity-percent">&nbsp;</td></tr></table></div>{{Capacity}}<span class="co-colon-span">:</span><div class="co-capacity-bar"><div class="co-capacity-bar-in"></div></div>',formatPercentage:function(a,b){return this._formatPercentage(this._getPercentage(a,b),a)},makeHtml:function(j,i,k){var f="";var b="";var c="";var d=false;if(DNNEO.neo.isSet(i)&&i>0){b=desknets.numberFormatByte(k,0,0,2);var g=i*1024*1024;var a=this._getPercentage(k,g);var e=this._formatPercentage(a,k);var h=g-k;if(h<0){h=0}c=desknets.numberFormatByte(h,0,0,2);f=this._tmpl;f=desknets.tmpl.replaceWordHtml(f,"UseCapacity",desknets.Resource.capacity.UseCapacity);f=desknets.tmpl.replaceWordHtml(f,"FreeCapacity",desknets.Resource.capacity.FreeCapacity);f=desknets.tmpl.replaceWordHtml(f,"Capacity",desknets.Resource.capacity.Capacity);f=desknets.tmpl.replaceWordHtml(f,"sUseSize",b);f=desknets.tmpl.replaceWordHtml(f,"sUsePercent",e);f=desknets.tmpl.replaceWordHtml(f,"sFreeSize",c);f=desknets.tmpl.replaceWordHtml(f,"iLimitCapa",desknets.numberFormat(i))}else{b=desknets.numberFormatByte(k);f=desknets.Resource.capacity.Capacity+'<span class="co-colon-span">:</span>'+b}j.html(f).find(".co-capacity-bar-in").css("width",a+"%")},_getPercentage:function(b,c){var a=Math.round(b/c*100);return Math.max(0,Math.min(100,a))},_formatPercentage:function(a,b){return(a<1&&b>0)?desknets.Resource.capacity.LessThanOne:a.toString()+"%"}};desknets.webmail={WINDOW_NAME_DNP:"dnwmail",MODULE_DNP_MAILJS:"zwmljs",MODULE_DNP_MAILC:"zrwemlc",MODULE_DNP_MAIL:"zrweml",CMD_DNP_MAILVIEW:"mailcmdview",CMD_MAILACCOUNTS:"mailaccounts",PAGENAME_DNP_MAILLIST:"MailList",PAGENAME_DNP_MAILEDIT:"MailEdit",PAGENAME_DNP_ADDRLIST:"AddressList",PAGENAME_DNP_SETACCEDIT:"SettingAccountEdit",PAGENAME_DNP_SETSHAREACCEDIT:"SettingShareAccountEdit",MODULE_API_MAIL:"zrmail",CMD_MAILLOGCOUNTUP:"mailcmdlogcountup",CMD_ADDRLOGCOUNTUP:"addrcmdlogcountup",openMailList:function(b){var a=this;a.openMailListCom(null,b,a._getMailListSetting())},openMailSearchList:function(b,c){var a=this;a.openMailListCom(b,c,a._getMailListSetting())},_getMailListSetting:function(){var a=this;var b={listmodule:a.MODULE_DNP_MAILJS,listcmd:a.PAGENAME_DNP_MAILLIST,logcntmodule:a.MODULE_API_MAIL,logcntcmd:a.CMD_MAILLOGCOUNTUP,wndname:a.WINDOW_NAME_DNP};return b},openMailListCom:function(b,f,d){var a=this;var c={};c.page=d.listcmd;if(DNNEO.neo.isSet(b,{blank:false})){c.key=b}url=desknets.getUrl(d.listmodule)+"?"+desknets.getNeoParam(a.getUniqueParams())+"#"+desknets.getNeoParam(c);try{if(window.name==d.wndname){window.name=""}window.open(url,d.wndname);if(f===true){a.loggingCountUp(d.logcntcmd,d.logcntmodule)}}catch(g){}},openMailView:function(d,e){var b=this;var c=b.getUrlMailView(d);var a=b.getWindowOpenOption();window.open(c,"_blank",a);if(e===true){b.loggingCountUp(b.CMD_MAILLOGCOUNTUP,b.MODULE_API_MAIL)}},openMailViewShare:function(e,d,f){var b=this;var c=b.getUrlMailView(e,d);var a=b.getWindowOpenOption();window.open(c,"_blank",a);if(f===true){b.loggingCountUp(b.CMD_MAILLOGCOUNTUP,b.MODULE_API_MAIL)}},getUrlMailView:function(e,c){var a=this;var d={};d.cmd=a.CMD_DNP_MAILVIEW;d.msgid=e;if(DNNEO.neo.isSet(c,{blank:false})){d.said=c}var b=a.MODULE_DNP_MAILC+"."+desknets.getExtension()+"?"+desknets.getNeoParam(d);return b},openMailEditByMailLink:function(c,d,b){var a=this;if(DNNEO.neo.isSet(b,{blank:false})){if(b=="3"){desknets.webmailimap.openMailEdit(c,d);return}}a.openMailEdit(c,d)},openMailEdit:function(b,d){var a=this;var c={};c.cmd=desknets.webmail.CMD_MAILACCOUNTS;c.proc=3;desknets.ajax.rest({async:false,url:desknets.getUrl(desknets.webmail.MODULE_DNP_MAIL),data:c,dataType:"xml",success:function(e){a._successGetAccount(b,d,$(e.documentElement))}})},_getMailEditSetting:function(){var a=this;var b={editmodule:a.MODULE_DNP_MAILJS,editcmd:a.PAGENAME_DNP_MAILEDIT};return b},_successGetAccount:function(d,e,c){var a=this;if(c.find(">list>item").length>0){a.openMailEditCom(d,e,a._getMailEditSetting())}else{var b="";b=c.find("accsetting").text();setTimeout(function(){if(b==="1"){var f=desknets.Resource.Message.mail_move_accset;desknets.dialog.confirm(f,function(){a.openSettingAccount()})}else{var f=desknets.Resource.Message.mail_noaccset;desknets.dialog.alert(f,{type:"warn"})}},10)}},openMailEditCom:function(g,e,k){var j=this;var i={};i.page=k.editcmd;i.method="POST";if(g){if(g.tmpnm){i.tmpnm=g.tmpnm}if(g.to){i.to=g.to}if(g.cc){i.cc=g.cc}if(g.bcc){i.bcc=g.bcc}if(g.accid){i.accid=g.accid}if(g.said){i.said=g.said}}var a=desknets.getUrl(k.editmodule)+"#"+desknets.getNeoParam(i);var f=j.getWindowOpenOption();if(!!g.subject||!!g.body){if(!e){e=$("body").find("#jco-mail-edit-form");if(e.length==0){e=$("<form />").attr("id","jco-mail-edit-form");e.appendTo("body")}}var h=j._getUniqueValue();var c=$('<input type="hidden" name="subject" />').val(g.subject||"");var d=$('<input type="hidden" name="body" />').val(g.body||"");var b=$('<input type="hidden" name="_" />').val(h||"");e.attr("method","POST").attr("target",h).attr("action",a).empty().append(c).append(d).append(b);window.open("",h,f);e.submit()}else{window.open(a,"_blank",f)}},openAddressList:function(b){var a=this;a.openAddressListCom(null,b,a._getAddressListSetting())},openAddressSearchList:function(b,c){var a=this;a.openAddressListCom(b,c,a._getAddressListSetting())},_getAddressListSetting:function(){var a=this;var b={listmodule:a.MODULE_DNP_MAILJS,wndname:a.WINDOW_NAME_DNP};return b},openAddressListCom:function(b,f,d){var a=this;var c={};c.page=a.PAGENAME_DNP_ADDRLIST;if(DNNEO.neo.isSet(b,{blank:false})){c.key=b}url=desknets.getUrl(d.listmodule)+"?"+desknets.getNeoParam(a.getUniqueParams())+"#"+desknets.getNeoParam(c);try{if(window.name==d.wndname){window.name=""}window.open(url,d.wndname);if(f===true){a.loggingCountUp(a.CMD_ADDRLOGCOUNTUP,a.MODULE_API_MAIL)}}catch(g){}},openSettingPage:function(b,d){var a=this;var c={};c.page=b;a.openSettingAccountCom(c,d,a._getSettingAccountSetting())},openSettingAccount:function(d,c){var a=this;var b={};b.page=a.PAGENAME_DNP_SETACCEDIT;if(!!d){b.id=d}a.openSettingAccountCom(b,c,a._getSettingAccountSetting())},openSettingAccountShare:function(d,c){var a=this;var b={};b.page=a.PAGENAME_DNP_SETSHAREACCEDIT;if(!!d){b.id=d}a.openSettingAccountCom(b,c,a._getSettingAccountSetting())},_getSettingAccountSetting:function(){var a=this;var b={accsetmodule:a.MODULE_DNP_MAILJS,logcntmodule:a.MODULE_API_MAIL,logcntcmd:a.CMD_MAILLOGCOUNTUP,wndname:a.WINDOW_NAME_DNP};return b},openSettingAccountCom:function(c,d,b){var a=this;url=desknets.getUrl(b.accsetmodule)+"?"+desknets.getNeoParam(a.getUniqueParams())+"#"+desknets.getNeoParam(c);try{if(window.name==b.wndname){window.name=""}window.open(url,b.wndname);if(d===true){a.loggingCountUp(b.logcntcmd,b.logcntmodule)}}catch(f){}},getWindowOpenOption:function(){var a="";if(!desknets.browser.android){var b=$(window);a=["location=no","menubar=no","resizable=yes","scrollbars=yes","status=no","toolbar=no","width="+b.width(),"height="+b.height()].join(",")}return a},getUniqueParams:function(){var a=this;var b={};b._=a._getUniqueValue();return b},_getUniqueValue:function(){var a=new Date().getTime();return a+""},loggingCountUp:function(b,a){desknets.ajax.rest({url:desknets.getUrl(a),data:{cmd:b,log:"on"}})},isDispAccountSettingLink:function(a){switch(a){case"-2710":case"-2711":case"-2712":case"-2719":case"-2727":case"-6040":case"-6083":return true}return false}};desknets.webmailimap={WINDOW_NAME_DNP:"dnwmailimap",MODULE_DNP_MAILJS:"zwimapwmljs",MODULE_DNP_MAIL:"zrwimapeml",CMD_MAILACCOUNTS:"mailaccountentry",PAGENAME_DNP_MAILLIST:"MailList",PAGENAME_DNP_MAILVIEW:"MailView",PAGENAME_DNP_MAILEDIT:"MailEdit",PAGENAME_DNP_SETACCEDIT:"SettingAccountEdit",MODULE_API_MAIL:"zrmailimap",CMD_MAILLOGCOUNTUP:"mailimapcmdlogcountup",openMailList:function(b){var a=this;desknets.webmail.openMailListCom(null,b,a._getMailListSetting())},openMailSearchList:function(b,c){var a=this;desknets.webmail.openMailListCom(b,c,a._getMailListSetting())},_getMailListSetting:function(){var a=this;var b={listmodule:a.MODULE_DNP_MAILJS,listcmd:a.PAGENAME_DNP_MAILLIST,logcntmodule:a.MODULE_API_MAIL,logcntcmd:a.CMD_MAILLOGCOUNTUP,wndname:a.WINDOW_NAME_DNP};return b},openMailView:function(d,f,e){var b=this;var c=b.getUrlMailView(d,f);var a=desknets.webmail.getWindowOpenOption();window.open(c,"_blank",a);if(e===true){desknets.webmail.loggingCountUp(b.CMD_MAILLOGCOUNTUP,b.MODULE_API_MAIL)}},getUrlMailView:function(d,e){var a=this;var c={};c.page=a.PAGENAME_DNP_MAILVIEW;c.id=d;c.fid=e;var b=a.MODULE_DNP_MAILJS+"."+desknets.getExtension()+"?"+desknets.getNeoParam(desknets.webmail.getUniqueParams())+"#"+desknets.getNeoParam(c);return b},openMailEdit:function(b,d){var a=this;var c={};c.cmd=a.CMD_MAILACCOUNTS;desknets.ajax.rest({async:false,url:desknets.getUrl(a.MODULE_DNP_MAIL),data:c,dataType:"xml",success:function(e){a._successGetAccount(b,d,$(e.documentElement))}})},_getMailEditSetting:function(){var a=this;var b={editmodule:a.MODULE_DNP_MAILJS,editcmd:a.PAGENAME_DNP_MAILEDIT};return b},_successGetAccount:function(e,f,d){var b=this;var a=d.find("userid").text();if(DNNEO.neo.isSet(a,{blank:false})){desknets.webmail.openMailEditCom(e,f,b._getMailEditSetting())}else{var c=d.find("accsetting").text();setTimeout(function(){if(c==="1"){var g=desknets.Resource.Message.mail_move_accset;desknets.dialog.confirm(g,function(){b.openSettingAccount()})}else{var g=desknets.Resource.Message.mail_noaccset;desknets.dialog.alert(g,{type:"warn"})}},10)}},openAddressList:function(b){var a=this;desknets.webmail.openAddressListCom(null,b,a._getAddressListSetting())},openAddressSearchList:function(b,c){var a=this;desknets.webmail.openAddressListCom(b,c,a._getAddressListSetting())},_getAddressListSetting:function(){var a=this;var b={listmodule:a.MODULE_DNP_MAILJS,wndname:a.WINDOW_NAME_DNP};return b},openSettingPage:function(b,d){var a=this;var c={};c.page=b;desknets.webmail.openSettingAccountCom(c,d,a._getSettingAccountSetting())},openSettingAccount:function(d,c){var a=this;var b={};b.page=a.PAGENAME_DNP_SETACCEDIT;if(!!d){b.id=d}desknets.webmail.openSettingAccountCom(b,c,a._getSettingAccountSetting())},_getSettingAccountSetting:function(){var a=this;var b={accsetmodule:a.MODULE_DNP_MAILJS,logcntmodule:a.MODULE_API_MAIL,logcntcmd:a.CMD_MAILLOGCOUNTUP,wndname:a.WINDOW_NAME_DNP};return b}};desknets.autosave={mtimer:null,mtimersec:60000,mobjprm:{},moption:{},_mdeloption:{cmdsave:"autosave",cmdatt:"autosaveatt",cmdattrte:"autosaveatt",cmdchk:"autosavechk",cmddel:"autosavedel",cmdformat:"autosaveformat",cmdget:"autosaveget",cmdgetatt:"autosavegetatt",cmdgetrte:"autosavegetatt",cmdgetformat:"autosavegetformat"},init:function(b){var a=this;a._mdeloption.url=desknets.getUrl("zrautosave");a.moption=$.extend({},a._mdeloption,b);a.mtimersec=Number(b.time)*60000},start:function(){var a=this;if(a.mtimer===null){a.mtimer=setInterval(function(){a.save(false,false)},a.mtimersec)}a.mobjprm=a.savePrm()},stop:function(){var a=this;if(!!a.mtimer){clearTimeout(a.mtimer);a.mtimer=null}},restart:function(){var a=this;a.stop();a.start()},save:function(d,c){var b=this;var a=b.savePrm();if(d==="1"){b.stop()}else{if(c!=="1"){if(JSON.stringify(b.mobjprm)==JSON.stringify(a)){return}}}var e=true;if(c==="1"){e=false}desknets.ajax.rest({url:b.moption.url,async:e,data:$.extend({},a),success:function(g,f,h){b.mobjprm=a},error:function(h,f,g){desknets.ajax.onError(h.status,g)},})},savePrm:function(){var a=this;var b={};b=a.comPrm(b);b.cmd=a.moption.cmdsave;if($.isFunction(a.moption.funcentry)){b=a.moption.funcentry(b)}return b},comPrm:function(b){var a=this;if(a.moption.mod){b.flag="1"}else{b.flag="0"}b.module=a.moption.module;b.autosaveid=a.moption.userid;return b},chk:function(){var a=this;desknets.ajax.rest({url:a.moption.url,data:a.chkPrm(),success:function(c,b,d){if($.isFunction(a.moption.funcchk)){a.moption.funcchk(c)}},error:function(d,b,c){desknets.ajax.onError(d.status,c)},})},chkPrm:function(){var a=this;var b={};b=a.comPrm(b);b.cmd=a.moption.cmdchk;b.fieldid=a.moption.fieldid;return b},get:function(){var b=this;var c={};var g=0;var h={};c[g]=b.getPrm();h[g]="cmdget";var e=b.getAttPrm();if(e!=null){g++;c[g]=e;h[g]="cmdgetatt"}var a=b.getRtePrm();if(a!=null){g++;c[g]=a;h[g]="cmdgetrte"}var d=b.getFormatPrm();if(d!=null){g++;c[g]=d;h[g]="cmdgetformat"}var f=desknets.ajax.arrayToMultiCmdData(c);desknets.ajax.rest({url:b.moption.url,async:false,data:f,success:function(j,i,k){if($.isFunction(b.moption.funcget)){b.moption.funcget(j,h)}b.start()},error:function(k,i,j){desknets.ajax.onError(k.status,j)},detectMultiError:true,})},getPrm:function(){var a=this;var b={};b=a.comPrm(b);b.cmd=a.moption.cmdget;return b},getAttPrm:function(){var a=this;var b={};if(!a.moption.cmdgetatt||!a.moption.attachname){return null}b=a.comPrm(b);b.cmd=a.moption.cmdgetatt;b.attachname=a.moption.attachname;if(!!a.moption.tmpnm){b.tmpnm=a.moption.tmpnm}return b},getRtePrm:function(){var a=this;var b={};if(!a.moption.cmdgetrte||!a.moption.rtename){return null}b=a.comPrm(b);b.cmd=a.moption.cmdgetrte;b.attachname=a.moption.rtename;return b},getFormatPrm:function(){var a=this;var b={};if(!a.moption.cmdgetformat||!a.moption.format){return null}b=a.comPrm(b);b.cmd=a.moption.cmdgetformat;b.format=a.moption.format;return b},del:function(b){var a=this;var c=true;if(b==="1"){c=false}desknets.ajax.rest({url:a.moption.url,async:c,data:a.delPrm(),success:function(e,d,f){if($.isFunction(a.moption.funcdel)){a.moption.funcdel(e)}},error:function(f,d,e){desknets.ajax.onError(f.status,e)},})},delPrm:function(){var a=this;var b={};b=a.comPrm(b);b.cmd=a.moption.cmddel;return b},attachsave:function(){var a=this;if(!!a.mtimer){var b={};b[0]=a.savePrm();b[1]=a.attachPrm();var c=desknets.ajax.arrayToMultiCmdData(b);desknets.ajax.rest({url:a.moption.url,data:c,success:function(e,d,f){a.mobjprm=b[0]},error:function(f,d,e){desknets.ajax.onError(f.status,e)},detectMultiError:true,})}},attachPrm:function(){var a=this;var b={};b=a.comPrm(b);b.cmd=a.moption.cmdatt;b.attachname=a.moption.attachname;if(!!a.moption.tmpnm){b.tmpnm=a.moption.tmpnm}return b},attachrtesave:function(){var a=this;if(!!a.mtimer){var b={};b[0]=a.savePrm();b[1]=a.attachrtePrm();var c=desknets.ajax.arrayToMultiCmdData(b);desknets.ajax.rest({url:a.moption.url,data:c,success:function(e,d,f){a.mobjprm=b[0]},error:function(f,d,e){desknets.ajax.onError(f.status,e)},detectMultiError:true,})}},attachrtePrm:function(){var a=this;var b={};b=a.comPrm(b);b.cmd=a.moption.cmdattrte;b.attachname=a.moption.rtename;return b},formatsave:function(){var a=this;if(!!a.mtimer){var b={};b[0]=a.savePrm();b[1]=a.formatPrm();var c=desknets.ajax.arrayToMultiCmdData(b);desknets.ajax.rest({url:a.moption.url,data:c,success:function(e,d,f){},error:function(f,d,e){desknets.ajax.onError(f.status,e)},detectMultiError:true,})}},formatPrm:function(){var a=this;var b={};b=a.comPrm(b);b.cmd=a.moption.cmdformat;b.format=a.moption.format;return b},};desknets.connectapp={MODULE_INFO:"zinfo",MODULE_CREPORT:"zcreport",MODULE_API_INFO:"zrinfo",objConnectData:{},getConnectData:function(b){var a=this;return a.objConnectData[b]},_setConnectData:function(b,c){var a=this;a.objConnectData[b]=c},connectMail:function(b){var a=this;var c;var d=desknets.Resource.Message.com_open_mailadd;c=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled(c);a._connectMail(b)})},_connectMail:function(e){var c=this;var h={};var g={};var d={};var a=desknets.pageframe.getLoginConnectMail();var b="2";var f="mail";if(a=="2"){b="3";f="mailimap"}g.cmd=e.restcmd;g.connectid=e.connectid;g.module=f;d.async=false;d.url=desknets.getUrl(e.restmodule);d.data=g;d.success=function(j,i,k){if(d.dataType=="xml"){j=c._convXmlToObj(j)}h.subject=j.title;h.body=j.content;h.tmpnm=j.tmpnm;desknets.webmail.openMailEditByMailLink(h,null,b)};if(e.restcmd&&e.restcmd.indexOf("mail")==0){d.dataType="xml"}desknets.ajax.rest(d)},connectInfo:function(e,f){var b=this;var d={};var a={};var c;d.cmd="infoeditindex";a.cmd="infoentry";a.fid="0";c=b._getURL(b.MODULE_INFO,d,a);e.connectto="info";e.entrypageurl=c;if(f===true){b._connectApp(e)}else{b.checkAccsInfoCategory(function(g){if(g===true){b._connectInfo(e)}else{desknets.dialog.alert(desknets.Resource.Message.info_guide_add_noperm,{type:"warn"})}})}},_checkAccsInfoCategory:function(c){var a=this;var d={};var b={};d.cmd="infocatelist";d.folder="0";b.async=false;b.url=desknets.getUrl(a.MODULE_API_INFO);b.data=d;b.success=function(f,e,h){var g=false;if(f&&f.list){g=a._hasAccsInfoCategory(f.list)}if(g==false){desknets.dialog.alert(desknets.Resource.Message.info_guide_add_noperm,{type:"warn"});return}a._connectInfo(c)};desknets.ajax.rest(b)},checkAccsInfoCategory:function(d){var a=this;var c={};var b={};c.cmd="infocatelist";c.folder="0";b.async=false;b.url=desknets.getUrl(a.MODULE_API_INFO);b.data=c;b.success=function(f,e,h){var g=false;if(f&&f.list){g=a._hasAccsInfoCategory(f.list)}if($.isFunction(d)){d(g)}};desknets.ajax.rest(b)},_hasAccsInfoCategory:function(d){var b=this;var a;var e=false;var c=2;if(!d||!d.item){return false}a=$.isArray(d.item)?d.item:[d.item];$.each(a,function(g,h){var f=h.accesskind;if(f&&((Number(f)&c)==c)){e=true;return false}if(h.list){if(b._hasAccsInfoCategory(h.list)){e=true;return false}}});return e},_connectInfo:function(b){var a=this;var c;var d=desknets.Resource.Message.com_open_infoadd;c=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled(c);a._connectApp(b)})},connectCreport:function(b){var a=this;var c;var d=desknets.Resource.Message.com_open_creportadd;c=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled(c);a.connectCreportNoConf(b)})},connectCreportNoConf:function(e){var b=this;var d={};var a={};var c;d.cmd="creportindex";a.cmd="creportcmdentrypage";c=b._getURL(b.MODULE_CREPORT,d,a);e.connectto="creport";e.entrypageurl=c;b._connectApp(e)},connectSch:function(b){var a=this;var c;var d=desknets.Resource.Message.com_open_schadd;c=desknets.dialog.confirm(d,function(){desknets.submitform.setDialogDisabled(c);a.connectSchNoConf(b)})},connectSchNoConf:function(e){var b=this;var d={};var a={};var c;var g=desknets.pageframe.getLoginUid();var f=DNNEO.neo.dateTime.format("yyyyMMdd",desknets.pageframe.getServerDate());d.cmd="schindex";a.cmd="schadd";a.date=f;a.enddate=f;a.id=g;c=b._getURL(desknets.MODULE_MAIN,d,a);e.connectto="sch";e.entrypageurl=c;b._connectApp(e)},_getURL:function(f,e,a){var b=this;var d={};var c;d.link="1";$.extend(a,d);c=desknets.getUrl(f);c+="?"+desknets.getNeoParam(e);c+="#"+desknets.getNeoParam(a);return c},_connectApp:function(c){var a=this;var d={};var b={};d.cmd=c.restcmd;d.connectid=c.connectid;d.module=c.connectto;b.async=false;b.url=desknets.getUrl(c.restmodule);b.data=d;if(c.restcmd&&c.restcmd.indexOf("mail")==0){b.dataType="xml"}b.success=function(f,e,g){if(b.dataType=="xml"){f=a._convXmlToObj(f)}a._setConnectData(c.connectto,f);desknets.execLocation(c.entrypageurl,"_blank")};desknets.ajax.rest(b)},_convXmlToObj:function(d){var l=this;var i,h;var e={};var a=$(d);e.title=a.find("title").text();e.content=a.find("content").text();h=a.find("tmpnm");if(h.length>0){e.tmpnm=h.text()}i=a.find("rteatt");if(i.length>0){var g=[];var b={item:g};var f=i.find("item");for(var k=0;k<f.length;k++){var j=f.eq(k);var c={id:j.attr("id"),attachdisp:j.find("attachdisp").text(),mimetype:j.find("mimetype").text(),size:j.find("size").text()};g.push(c)}e.rteatt={attach:b}}return e},};desknets.RefDialog=function(){return this};desknets.refDialog={_option:{module:"zrconst",linkClass:"jco-ref-dialog-link",idName:"refid",dlgId:"jco-ref-dialog-",closedDel:true,uProfCmd:"constructcmduserinfo",uProfMsetCmd:"constructmsetcmduserinfo",uLdentClass:"co-userprof-dialog",uTmpl:"com/userprofile.html",uTmplObj:null,uMakeFunc:null,gProfCmd:"constructgroupinfo",gLdentClass:"co-groupprof-dialog",gTmpl:"com/groupprofile.html"},_arrMail:["Mail","mailmobile","mailprivate","mailother"],_arrOfficeTel:["TelHand","Tel1","Tel2","Naisen","TelFax"],_arrPrivateTel:["TelHome","TelOther"],$_area:null,$_uTmpl:null,$_gTmpl:null,_tmplMLink:'<a class="jco-userprof-maillink" href="mailto:{{mAddr}}">{{mAddr}}</a>',_tmplMLinkNoLink:'<span title="{{mAddr}}">{{mAddr}}</span>',init:function(){var b=this;var a;if(DNNEO.neo.isSet(b.$_area)){a=b.$_area}else{a=$(document.body)}b.setLinkDisabled(a);a.delegate("."+b._option.linkClass,"click",function(c){c.preventDefault();b._openWithElement($(this))});if(DNNEO.neo.isSet(b._option.uTmplObj)&&b._option.uTmplObj.length){b.$_uTmpl=b._option.uTmplObj}},setLinkDisabled:function(a){var c=this;var b;if(DNNEO.neo.isSet(a)){b=a}else{b=$(document.body)}if(!desknets.pageframe.isUserInfoDisp()){b.find("."+c._option.linkClass).filter(function(){var d=$(this).data(c._option.idName).match(/user/);return !!d&&d.length==1}).addClass("co-page-linkdisable")}},_openWithElement:function(a){var b=this;var e=a.data(b._option.idName);var d=e.match(/(user|group|role)(\w+|-\w+)/i);if(d&&d.length>2){var c=$("#jco-user-dispitems").data("cmdtype");b._open(d[1],d[2],c)}},_open:function(c,d,b){var a=this;if(DNNEO.neo.isSet(c)&&c=="user"){if(!!desknets.pageframe.isUserInfoDisp()){a._openUserProf(d,b)}}else{if(DNNEO.neo.isSet(c)&&c=="group"){a._openGroupProf(d)}}},_getProfileInfoAjax:function(d,e){var a=this;var c=desknets.getUrl(a._option.module);var b=desknets.ajax.arrayToMultiCmdData(d);desknets.ajax.rest({dataType:desknets.ajax.RESTYPE_JSON,url:c,data:b,success:function(g,f,h){if(g[0]["status"]!=desknets.RES_STATUS_SUCCESS){desknets.dialog.alert(g[0]["errormessage"],{errorNo:g[0]["errorno"]})}else{if($.isFunction(e)){e(g)}}}})},_openUserProf:function(e,b){var a=this;var c=$("#"+a._option.dlgId+"user-"+e);if(c.length>0){c.dialog("open");c.find(".co-userprof-status").scrollTop(0);return}else{if(!DNNEO.neo.isSet(a.$_uTmpl)||a.$_uTmpl.length==0){a.$_uTmpl=$("<div />");var d=function(){a._makeUserProf(e,b)};desknets.tmpl.load(a.$_uTmpl,a._option.uTmpl,d);return}}a._makeUserProf(e,b)},_makeUserProf:function(h,e){var c=this;var f={};var b=c._option.dlgId+"user-"+h;var g;var a=function(j){var n={};var q=$.extend(desknets.dialog.getDialogOption(),{dialogClass:"dn-dialog",width:500,title:desknets.Resource.profUserTitle,open:function(){g.next().find("button").focus()},close:function(r){if(c._option.closedDel==true){c._deleteClosedUserAll()}}});var o={};o[desknets.Resource.CloseButtonLabel]=function(r){$(this).dialog("close")};q.buttons=o;g=$('<div class="'+c._option.uLdentClass+'"/>').attr("id",b).appendTo(document.body);var l=$("<div />").html(c.$_uTmpl.html());var i="";for(i in j[0]){if(typeof j[0][i]=="string"){n[i]=desknets.tmpl.dispStr(j[0][i]);if($.inArray(i,c._arrMail)>=0){var m=c._tmplMLink;var k=desknets.pageframe.getLoginMailLink();if((DNNEO.neo.isSet(k)&&k<=0)||!DNNEO.neo.isSet(k)){m=c._tmplMLinkNoLink}if(DNNEO.neo.isSet(n[i],{blank:false})&&n[i]!=="&nbsp;"){n[i]=desknets.tmpl.replaceWordChkHtml(m,"mAddr",n[i])}if(!n.mailAddress){n.mailAddress="1"}}else{if(!n.officeTel&&$.inArray(i,c._arrOfficeTel)>=0){n.officeTel="1"}else{if(!n.privateTel&&$.inArray(i,c._arrPrivateTel)>=0){n.privateTel="1"}}}}else{n[i]=j[0][i]}}n.uid=h;l.find("#co-userprof-tmpl").tmpl(n).appendTo(g);var p=g.find(".co-userprof-status");if($.trim(p.text())==""){p.remove()}$.each(g.find(".jco-userprof-maillink"),function(r,s){desknets.htmlparts.setUpMailLink($(this))});desknets.dialog.setUp(g,q);g.dialog("open");g.find(".co-userprof-status").scrollTop(0);desknets.dialog.setFirstDialogOpen(g);if(c._option.uMakeFunc&&$.isFunction(c._option.uMakeFunc)){c._option.uMakeFunc(g)}};var d;if(DNNEO.neo.isSet(e)&&(e=="mset"||e=="set")){d=c._option.uProfMsetCmd}else{d=c._option.uProfCmd}f["0"]={cmd:d,id:h};c._getProfileInfoAjax(f,a)},_deleteClosedUserAll:function(){$("."+this._option.uLdentClass).each(function(){var a=$(this);if(!a.dialog("isOpen")){a.dialog("destroy").remove()}})},_openGroupProf:function(d){var a=this;var b=$("#"+a._option.dlgId+"group-"+d);if(b.length>0){b.dialog("open");return}else{if(!DNNEO.neo.isSet(a.$_gTmpl)||a.$_gTmpl.length==0){a.$_gTmpl=$("<div />");var c=function(){a._makeGroupProf(d)};desknets.tmpl.load(a.$_gTmpl,a._option.gTmpl,c);return}}a._makeGroupProf(d)},_makeGroupProf:function(f){var c=this;var d={};var b=c._option.dlgId+"group-"+f;var e;var a=function(k){var g={};var i=$.extend(desknets.dialog.getDialogOption(),{dialogClass:"dn-dialog",width:500,title:desknets.Resource.profGroupTitle,close:function(l){if(c._option.closedDel==true){c._deleteClosedGroupAll()}}});var j={};j[desknets.Resource.CloseButtonLabel]=function(l){$(this).dialog("close")};i.buttons=j;e=$('<div class="'+c._option.gLdentClass+'"/>').attr("id",b).appendTo(document.body);var h=$("<div />").html(c.$_gTmpl.html());k[0]["gid"]=f;h.find("#co-groupprof-tmpl").tmpl(k[0]).appendTo(e);desknets.dialog.setUp(e,i);e.dialog("open");desknets.dialog.setFirstDialogOpen(e)};d["0"]={cmd:c._option.gProfCmd,id:f};c._getProfileInfoAjax(d,a)},_deleteClosedGroupAll:function(){$("."+this._option.gLdentClass).each(function(){var a=$(this);if(!a.dialog("isOpen")){a.dialog("destroy").remove()}})},userProfSetUp:function(c,b){var a=this;if(DNNEO.neo.isSet(c)){a._option=$.extend({},a._option,c)}if(DNNEO.neo.isSet(b)&&b.length>0){a.$_area=b}a.init()}};desknets.refDialog.editGroups=function(c){var b="&nbsp;";if(DNNEO.neo.isSet(c)&&DNNEO.neo.isSet(c.Name)){var a=desknets.ajax.getItems(c.Name);$.each(a,function(d,e){a[d]=desknets.tmpl.dispStr(e)});b=a.join(", ")}return b};desknets.RefDialog.prototype=desknets.refDialog;